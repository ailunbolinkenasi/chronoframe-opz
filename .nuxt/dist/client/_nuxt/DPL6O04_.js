import{C as fe,a9 as ve,u as ge,r as v,K as _e,j as U,v as ye,M as B,w as n,aj as P,ac as xe,o as c,a as l,c as u,b as o,O as e,ah as ke,t as i,a7 as we,ay as Ce,d as f,e as Pe,a6 as $e,av as S,a1 as Ue,R as y,F as J,a5 as Q,aI as je,aJ as ze,a2 as Se,Y as G}from"./Do4Ulm4h.js";import{_ as Ae,a as De}from"./BxJwlH6u.js";import{_ as Ve}from"./DOw8EvtE.js";import{_ as Fe}from"./D_BgBUvd.js";import{_ as Ee,a as Te}from"./CPK4N6jr.js";import{_ as Be}from"./DMIzqIME.js";import{_ as Ie,a as Le}from"./BRFgOYk5.js";import{_ as Ke}from"./Ccp_Usjl.js";import"./D4m22CMA.js";import"./DN8WM3HB.js";import"./Bzg-qYo_.js";import"./DBhqu3Ka.js";import"./lxpLfLs2.js";import"./CTn4-S8R.js";import"./D8I6Rcxg.js";import"./DdhnkgWh.js";import"./MPJDxmQh.js";import"./Duon1tOp.js";import"./y8VeKFcA.js";import"./Qxlw5ViT.js";const Oe={class:"flex flex-col gap-6"},Re={key:0,class:"bg-white dark:bg-neutral-900 rounded-lg border border-gray-200 dark:border-neutral-800"},Me={class:"w-16 h-12 rounded-lg overflow-hidden bg-gray-100 dark:bg-neutral-800 shrink-0"},Ne=["src","alt"],qe={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600"},Ye={key:0,class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-1"},He={key:1,class:"text-sm text-gray-400 dark:text-gray-600"},Je={class:"text-sm text-gray-600 dark:text-gray-400"},Qe={class:"flex gap-1"},Ge={key:1,class:"flex flex-col items-center justify-center py-12 text-center"},We={class:"text-lg font-semibold text-gray-700 dark:text-gray-300"},Xe={class:"text-sm text-gray-500 dark:text-gray-400 mt-2 mb-4"},Ze={key:2,class:"flex items-center justify-center py-12"},et={key:0,class:"relative w-full aspect-video bg-gray-100 dark:bg-neutral-800 overflow-hidden"},tt={class:"text-sm font-medium"},at={class:"space-y-4 px-4"},st={class:"space-y-3"},ot={key:0,class:"space-y-2"},lt={class:"flex items-center justify-between"},rt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},it={class:"grid grid-cols-4 gap-2 p-3 bg-gray-50 dark:bg-neutral-800/50 rounded-lg border border-gray-200 dark:border-neutral-700"},nt=["src","alt"],dt={key:0,class:"absolute top-1 left-1 bg-primary-500 text-white px-1.5 py-0.5 rounded text-xs font-medium"},ct=["onClick"],ut={class:"flex flex-col h-[85vh] max-h-[85vh]"},mt={class:"shrink-0 border-b border-gray-200 dark:border-neutral-700 p-3 sm:p-4 md:p-6"},bt={class:"flex items-center justify-between mb-3 sm:mb-4"},ht={class:"text-lg sm:text-xl font-bold"},pt={class:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1"},ft={class:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center"},vt={class:"hidden sm:flex items-center gap-2 px-3 py-2 bg-gray-100 dark:bg-neutral-800 rounded-lg whitespace-nowrap"},gt={class:"text-sm font-medium"},_t={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},yt={class:"flex-1 overflow-y-auto p-2 sm:p-3 md:p-6"},xt={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-3"},kt=["onClick"],wt={key:0,class:"absolute top-1 left-1 sm:top-2 sm:left-2 flex items-center justify-center w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-primary-500 border-2 border-white shadow-md"},Ct={class:"hidden sm:inline ml-1"},Pt=["onClick"],$t={key:1,class:"flex flex-col items-center justify-center h-64 text-gray-500"},Ut={class:"font-medium"},jt={key:0,class:"text-sm mt-1"},zt={class:"shrink-0 border-t border-gray-200 dark:border-neutral-700 bg-gray-50 dark:bg-neutral-900/50 p-3 sm:p-4 md:p-6"},St={class:"flex flex-col sm:flex-row gap-3 sm:gap-4 items-center justify-between"},At={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4 text-xs sm:text-sm w-full sm:w-auto"},Dt={class:"font-medium"},Vt={class:"text-primary-600 dark:text-primary-400 font-bold"},Ft={class:"text-gray-600 dark:text-gray-400"},Et={key:0,class:"text-amber-600 dark:text-amber-400 flex items-center gap-1"},Tt={class:"flex gap-2 w-full sm:w-auto"},Bt={class:"p-6 space-y-4"},It={class:"flex items-center gap-3"},Lt={class:"shrink-0 w-10 h-10 bg-error-100 dark:bg-error-900/30 rounded-full flex items-center justify-center"},Kt={class:"text-lg font-semibold"},Ot={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Rt={class:"flex justify-end gap-2 pt-4"},ca=fe({__name:"albums",setup(Mt){const{t}=ve();ge({title:t("title.albums")});const j=v([]),A=v(!1),h=v([]),I=v(!1),w=v(!1),$=v(!1),x=v(!1),g=v(null),_=_e({title:"",description:""}),z=v(),D=v(!1),d=v([]),b=v(""),C=v(""),W=r=>{const s=[];return r.title?.trim()||s.push({name:"title",message:t("dashboard.albums.form.titleRequired")}),s},V=async()=>{A.value=!0;try{const r=await $fetch("/api/albums");j.value=r.map(s=>({...s,photoCount:s.photoIds?.length||0}));for(const s of j.value)if(s.coverPhotoId&&h.value.length>0){const m=h.value.find(T=>T.id===s.coverPhotoId);m&&(s.coverPhoto=m)}}catch(r){console.error("Failed to load albums:",r),P().add({title:t("dashboard.albums.messages.loadError"),color:"error"})}finally{A.value=!1}},X=async()=>{I.value=!0;try{const{photos:r}=xe();h.value=r.value}catch(r){console.error("Failed to load photos:",r)}finally{I.value=!1}},L=()=>{g.value=null,_.title="",_.description="",d.value=[],b.value="",z.value?.clear(),w.value=!0},Z=async r=>{g.value=r;try{const s=await $fetch(`/api/albums/${r.id}`);_.title=r.title,_.description=r.description||"",d.value=(s.photos||[]).map(m=>m.id),b.value=r.coverPhotoId||"",z.value?.clear()}catch(s){console.error("Failed to load album details:",s),P().add({title:t("dashboard.albums.messages.loadDetailError"),color:"error"})}w.value=!0},ee=r=>{g.value=r,$.value=!0},te=async r=>{D.value=!0;try{g.value?(await $fetch(`/api/albums/${g.value.id}`,{method:"PUT",body:{title:r.data.title,description:r.data.description||void 0,coverPhotoId:b.value||void 0,photoIds:d.value}}),P().add({title:t("dashboard.albums.messages.updateSuccess"),color:"success"}),w.value=!1):(await $fetch("/api/albums",{method:"POST",body:{title:r.data.title,description:r.data.description||void 0,coverPhotoId:b.value||void 0,photoIds:d.value}}),P().add({title:t("dashboard.albums.messages.createSuccess"),color:"success"}),w.value=!1),await V()}catch(s){console.error("Failed to save album:",s),P().add({title:g.value?t("dashboard.albums.messages.updateError"):t("dashboard.albums.messages.createError"),color:"error"})}finally{D.value=!1}},ae=async()=>{if(g.value)try{await $fetch(`/api/albums/${g.value.id}`,{method:"DELETE"}),P().add({title:t("dashboard.albums.messages.deleteSuccess"),color:"success"}),$.value=!1,await V()}catch(r){console.error("Failed to delete album:",r),P().add({title:t("dashboard.albums.messages.deleteError"),color:"error"})}},K=r=>{const s=d.value.indexOf(r);s>-1?(d.value.splice(s,1),b.value===r&&(b.value="")):d.value.push(r)},O=r=>{d.value.includes(r)||d.value.push(r),b.value=r},F=U(()=>h.value.length>0&&d.value.length===h.value.length),se=U(()=>d.value.length>0&&d.value.length<h.value.length),R=()=>{F.value?d.value=[]:d.value=h.value.map(r=>r.id)},E=U(()=>{const r=C.value.toLowerCase();return r?h.value.filter(s=>(s.title?.toLowerCase()||"").includes(r)||(s.description?.toLowerCase()||"").includes(r)):h.value});ye(async()=>{await Promise.all([X(),V()])});const oe=we(),le=U(()=>g.value?t("dashboard.albums.slideover.edit.title"):t("dashboard.albums.slideover.create.title")),re=U(()=>g.value?t("dashboard.albums.slideover.edit.description"):t("dashboard.albums.slideover.create.description")),ie=U(()=>g.value?t("dashboard.albums.slideover.submitEdit"):t("dashboard.albums.slideover.submitCreate")),ne=[{id:"coverPhoto",accessorKey:"coverPhoto",header:t("dashboard.albums.table.columns.cover")},{id:"title",accessorKey:"title",header:t("dashboard.albums.table.columns.title")},{id:"description",accessorKey:"description",header:t("dashboard.albums.table.columns.description")},{id:"photoCount",accessorKey:"photoCount",header:t("dashboard.albums.table.columns.photoCount")},{id:"createdAt",accessorKey:"createdAt",header:t("dashboard.albums.table.columns.createdAt")},{id:"actions",header:t("dashboard.albums.table.columns.actions")}];return(r,s)=>{const m=ke,T=De,p=$e,de=Pe,M=Ce,ce=Ve,N=Ue,q=Fe,Y=Te,ue=Be,me=Ee,be=Ie,he=Ke,H=Le,pe=Ae;return c(),B(pe,null,{header:n(()=>[o(T,{title:e(t)("title.albums")},{right:n(()=>[o(m,{icon:"tabler:plus",variant:"soft",onClick:L},{default:n(()=>[f(i(e(t)("dashboard.albums.createButton")),1)]),_:1})]),_:1},8,["title"])]),body:n(()=>[l("div",Oe,[e(j).length>0?(c(),u("div",Re,[o(ce,{data:e(j),columns:ne},{"coverPhoto-cell":n(({row:a})=>[l("div",Me,[a.original.coverPhoto?(c(),u("img",{key:0,src:a.original.coverPhoto?.thumbnailUrl||"",alt:a.original.title,class:"w-full h-full object-cover"},null,8,Ne)):(c(),u("div",qe,[o(p,{name:"tabler:image",size:"20"})]))])]),"title-cell":n(({row:a})=>[o(de,{to:`/albums/${a.original.id}`,target:"_blank",class:"font-medium text-primary-600 dark:text-primary-400 hover:underline cursor-pointer inline-flex items-center gap-2"},{default:n(()=>[f(i(a.original.title)+" ",1),o(p,{name:"tabler:external-link",size:"16",class:"shrink-0 opacity-60 hover:opacity-100 transition-opacity"})]),_:2},1032,["to"])]),"description-cell":n(({row:a})=>[a.original.description?(c(),u("div",Ye,i(a.original.description),1)):(c(),u("div",He," - "))]),"photoCount-cell":n(({row:a})=>[o(M,{variant:"soft",color:"neutral"},{default:n(()=>[f(i(a.original.photoCount||0)+" 张 ",1)]),_:2},1024)]),"createdAt-cell":n(({row:a})=>[l("div",Je,i(e(oe)(a.original.createdAt).format("YYYY-MM-DD")),1)]),"actions-cell":n(({row:a})=>[l("div",Qe,[o(m,{variant:"ghost",color:"primary",size:"xs",icon:"tabler:edit",onClick:k=>Z(a.original)},null,8,["onClick"]),o(m,{variant:"ghost",color:"error",size:"xs",icon:"tabler:trash",onClick:k=>ee(a.original)},null,8,["onClick"])])]),_:1},8,["data"])])):e(A)?(c(),u("div",Ze,[o(p,{name:"tabler:loader",size:"32",class:"animate-spin text-primary-500"})])):(c(),u("div",Ge,[o(p,{name:"tabler:album",size:"48",class:"text-gray-400 dark:text-gray-600 mb-4"}),l("h3",We,i(e(t)("dashboard.albums.noAlbums")),1),l("p",Xe,i(e(t)("dashboard.albums.noAlbumsTip")),1),o(m,{icon:"tabler:plus",onClick:L},{default:n(()=>[f(i(e(t)("dashboard.albums.createButton")),1)]),_:1})])),o(be,{open:e(w),"onUpdate:open":s[7]||(s[7]=a=>S(w)?w.value=a:null),title:e(le),description:e(re),ui:{footer:"justify-end",body:"p-0 sm:p-0 space-y-4"}},{body:n(()=>[e(b)?(c(),u("div",et,[o(N,{src:e(h).find(a=>a.id===e(b))?.thumbnailUrl||"",alt:e(b),class:"absolute inset-0 w-full h-full object-cover"},null,8,["src","alt"]),l("button",{class:"absolute inset-0 bg-black/50 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center",onClick:s[0]||(s[0]=a=>b.value="")},[o(p,{name:"tabler:x",class:"text-white"})])])):(c(),u("button",{key:1,class:"w-full h-48 bg-gray-100 dark:bg-neutral-800 flex flex-col items-center justify-center text-gray-500 hover:text-gray-600 dark:hover:text-gray-400 hover:bg-gray-200 dark:hover:bg-neutral-700 transition-colors cursor-pointer",onClick:s[1]||(s[1]=a=>x.value=!0)},[o(p,{name:"tabler:photo",size:"40",class:"mb-2"}),l("p",tt,i(e(t)("dashboard.albums.form.addCoverPhoto")),1)])),l("div",at,[o(me,{ref_key:"formRef",ref:z,state:e(_),validate:W,class:"space-y-4",onSubmit:te},{default:n(()=>[o(Y,{label:e(t)("dashboard.albums.form.title"),name:"title",required:""},{default:n(()=>[o(q,{modelValue:e(_).title,"onUpdate:modelValue":s[2]||(s[2]=a=>e(_).title=a),class:"w-full",placeholder:e(t)("dashboard.albums.form.titlePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(Y,{label:e(t)("dashboard.albums.form.description"),name:"description"},{default:n(()=>[o(ue,{modelValue:e(_).description,"onUpdate:modelValue":s[3]||(s[3]=a=>e(_).description=a),class:"w-full",placeholder:e(t)("dashboard.albums.form.descriptionPlaceholder"),rows:3},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["state"]),l("div",st,[o(m,{variant:"outline",color:"primary",icon:"tabler:photo-plus",size:"lg",class:"w-full",onClick:s[4]||(s[4]=a=>x.value=!0)},{default:n(()=>[f(i(e(d).length>0?e(t)("dashboard.albums.form.editPhotos"):e(t)("dashboard.albums.form.selectPhotos")),1)]),_:1}),e(d).length>0?(c(),u("div",ot,[l("div",lt,[l("label",rt,i(e(t)("dashboard.albums.form.selectedCount",{count:e(d).length})),1),o(m,{variant:"ghost",color:"neutral",size:"xs",icon:"tabler:trash",onClick:s[5]||(s[5]=a=>d.value=[])},{default:n(()=>[f(i(e(t)("dashboard.albums.form.clearAll")),1)]),_:1})]),l("div",it,[(c(!0),u(J,null,Q(e(d),a=>(c(),u("div",{key:a,class:"relative group aspect-square rounded-lg overflow-hidden bg-gray-200 dark:bg-neutral-700"},[l("img",{src:e(h).find(k=>k.id===a)?.thumbnailUrl||"",alt:a,class:"w-full h-full object-cover"},null,8,nt),e(b)===a?(c(),u("div",dt,i(e(t)("dashboard.albums.modal.setCover")),1)):y("",!0),l("button",{class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",onClick:k=>K(a)},[o(p,{name:"tabler:x",class:"text-white"})],8,ct)]))),128))])])):y("",!0)])])]),footer:n(({close:a})=>[o(m,{variant:"ghost",color:"neutral",onClick:a},{default:n(()=>[f(i(e(t)("dashboard.albums.slideover.cancel")),1)]),_:1},8,["onClick"]),o(m,{icon:"tabler:check",loading:e(D),onClick:s[6]||(s[6]=k=>e(z)?.submit())},{default:n(()=>[f(i(e(ie)),1)]),_:1},8,["loading"])]),_:1},8,["open","title","description"]),o(H,{open:e(x),"onUpdate:open":s[12]||(s[12]=a=>S(x)?x.value=a:null),ui:{content:"w-full max-w-6xl overflow-hidden"}},{content:n(()=>[l("div",ut,[l("div",mt,[l("div",bt,[l("div",null,[l("h2",ht,i(e(t)("dashboard.albums.modal.selectPhotos")),1),l("p",pt,i(e(t)("dashboard.albums.modal.totalPhotos",{count:e(h).length}))+" · "+i(e(t)("dashboard.albums.modal.selectedPhotos",{count:e(d).length})),1)]),o(m,{variant:"ghost",color:"neutral",size:"md",icon:"tabler:x",onClick:s[8]||(s[8]=a=>x.value=!1)})]),l("div",ft,[o(q,{modelValue:e(C),"onUpdate:modelValue":s[9]||(s[9]=a=>S(C)?C.value=a:null),icon:"tabler:search",placeholder:e(t)("dashboard.albums.modal.searchPlaceholder"),class:"flex-1 text-sm"},null,8,["modelValue","placeholder"]),l("div",vt,[o(he,{"model-value":e(F),indeterminate:e(se),"onUpdate:modelValue":R},null,8,["model-value","indeterminate"]),l("span",gt,i(e(t)("dashboard.albums.modal.selectAll")),1)]),je(o(m,{class:"sm:hidden",size:"sm",color:"neutral",variant:"soft",onClick:R},{default:n(()=>[f(i(e(t)("dashboard.albums.modal.selectAll")),1)]),_:1},512),[[ze,!e(F)&&e(h).length>0]])]),e(C)?(c(),u("div",_t,i(e(t)("dashboard.albums.modal.searchResults",{current:e(E).length,total:e(h).length})),1)):y("",!0)]),l("div",yt,[e(E).length>0?(c(),u("div",xt,[(c(!0),u(J,null,Q(e(E),a=>(c(),u("div",{key:a.id,class:"relative group cursor-pointer",onClick:k=>K(a.id)},[l("div",{class:Se(["relative aspect-square rounded-lg overflow-hidden bg-gray-200 dark:bg-neutral-700 border-2 sm:border-3 transition-all",{"border-primary-500 shadow-lg ring-2 ring-primary-300 dark:ring-primary-700":e(d).includes(a.id),"border-gray-300 dark:border-neutral-600 hover:border-gray-400 dark:hover:border-neutral-500":!e(d).includes(a.id)}])},[o(N,{src:a.thumbnailUrl||"",alt:a.title||"Photo",class:"w-full h-full object-cover"},null,8,["src","alt"]),e(d).includes(a.id)?(c(),u("div",wt,[o(p,{name:"tabler:check",size:"12",class:"text-white sm:hidden"}),o(p,{name:"tabler:check",size:"14",class:"text-white hidden sm:block"})])):y("",!0),e(b)===a.id?(c(),B(M,{key:1,class:"absolute top-1 right-1 sm:top-2 sm:right-2",variant:"solid",color:"warning",size:"sm"},{default:n(()=>[o(p,{name:"tabler:star-filled",class:"inline mr-0.5",size:"14"}),f(" "+i(e(t)("dashboard.albums.modal.setCover")),1)]),_:1})):y("",!0),e(b)!==a.id?(c(),B(m,{key:2,class:"absolute bottom-1 right-1 sm:bottom-2 sm:right-2 opacity-0 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",variant:"solid",color:"warning",size:"xs",onClick:G(k=>O(a.id),["stop"])},{default:n(()=>[o(p,{name:"tabler:star",class:"inline",size:"12"}),l("span",Ct,i(e(t)("dashboard.albums.modal.setCover")),1)]),_:1},8,["onClick"])):y("",!0),e(b)!==a.id?(c(),u("button",{key:3,class:"sm:hidden absolute bottom-0 right-0 left-0 bg-linear-to-t from-black/80 to-transparent p-1 text-white flex items-center justify-center text-xs gap-1 rounded-b-lg",onClick:G(k=>O(a.id),["stop"])},[o(p,{name:"tabler:star",size:"14"}),l("span",null,i(e(t)("dashboard.albums.modal.setCover")),1)],8,Pt)):y("",!0)],2)],8,kt))),128))])):(c(),u("div",$t,[o(p,{name:"tabler:image-off",size:"48",class:"mb-3 opacity-50"}),l("p",Ut,i(e(C)?e(t)("dashboard.albums.modal.noResults"):e(t)("dashboard.albums.modal.noPhotos")),1),e(C)?(c(),u("p",jt,i(e(t)("dashboard.albums.modal.tryOtherKeywords")),1)):y("",!0)]))]),l("div",zt,[l("div",St,[l("div",At,[l("div",null,[l("span",Dt,i(e(t)("dashboard.albums.modal.selectedInfo")),1),l("span",Vt,i(e(d).length),1),l("span",Ft,"/ "+i(e(h).length),1)]),e(b)?(c(),u("div",Et,[o(p,{name:"tabler:star-filled",size:"16"}),f(" "+i(e(t)("dashboard.albums.modal.coverSetInfo")),1)])):y("",!0)]),l("div",Tt,[o(m,{variant:"outline",color:"neutral",class:"flex-1 sm:flex-none",size:"sm",onClick:s[10]||(s[10]=a=>x.value=!1)},{default:n(()=>[f(i(e(t)("dashboard.albums.slideover.cancel")),1)]),_:1}),o(m,{icon:"tabler:check",color:"primary",class:"flex-1 sm:flex-none",size:"sm",disabled:e(d).length===0,onClick:s[11]||(s[11]=a=>x.value=!1)},{default:n(()=>[f(i(e(t)("dashboard.albums.modal.confirm",{count:e(d).length})),1)]),_:1},8,["disabled"])])])])])]),_:1},8,["open"]),o(H,{open:e($),"onUpdate:open":s[14]||(s[14]=a=>S($)?$.value=a:null)},{content:n(()=>[l("div",Bt,[l("div",It,[l("div",Lt,[o(p,{name:"tabler:alert-circle",class:"text-error-500"})]),l("div",null,[l("h3",Kt,i(e(t)("dashboard.albums.delete.title")),1),l("p",Ot,i(e(t)("dashboard.albums.delete.message",{title:e(g)?.title})),1)])]),l("div",Rt,[o(m,{variant:"ghost",color:"neutral",onClick:s[13]||(s[13]=a=>$.value=!1)},{default:n(()=>[f(i(e(t)("dashboard.albums.delete.cancel")),1)]),_:1}),o(m,{color:"error",icon:"tabler:trash",onClick:ae},{default:n(()=>[f(i(e(t)("dashboard.albums.delete.confirm")),1)]),_:1})])])]),_:1},8,["open"])])]),_:1})}}});export{ca as default};
