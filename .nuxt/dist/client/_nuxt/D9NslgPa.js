import{C as W,j as v,c as h,o as c,b as a,O as t,a4 as Pt,w as s,M as A,R as M,a as n,t as x,a0 as at,ai as Rt,N as nt,Z as Ct,H as Mt,ab as mt,bt as Tt,r as I,P as st,ar as C,a6 as zt,a2 as J,ah as pt,bj as It,F as jt,a5 as Ot,d as ut,a9 as Ut,an as At,am as Vt,au as Yt,c3 as Lt,c4 as Dt,c5 as dt,y as et,v as Bt,ag as Ft,A as Z,z as Ht,aH as Et,a7 as Wt,as as Nt,_ as it,u as qt,ac as Gt,ae as Qt}from"./Do4Ulm4h.js";import{_ as ft}from"./BBFWqhkk.js";import{_ as Zt}from"./BEhpCpui.js";import{_ as Jt}from"./Dt03dVmC.js";import{_ as Kt}from"./Be18tplX.js";import{u as ht,a as gt}from"./B_ZWtxNr.js";import{_ as Xt}from"./CmvcNlLb.js";import{_ as te}from"./BcZAMJLg.js";import"./Du2f8F9w.js";import"./zoi52lI1.js";import"./DBhqu3Ka.js";import"./D_BgBUvd.js";import"./BN_V-WW3.js";import"./y8VeKFcA.js";import"./Duon1tOp.js";import"./MPJDxmQh.js";import"./DdhnkgWh.js";import"./lxpLfLs2.js";import"./Bzg-qYo_.js";import"./KzhxPVJs.js";import"./C8barOil.js";import"./CrhNAChg.js";const ee={class:"text-white text-4xl font-black leading-normal tracking-wide"},oe={key:0,class:"text-white/80 text-xl font-bold"},ae={class:"bg-black/60 backdrop-blur-3xl border-b border-white/10 px-4 py-2 shadow-2xl flex flex-col"},ne={class:"text-white text-lg font-medium"},se={key:0,class:"text-white/80 text-xs"},ie=W({__name:"DateRangeIndicator",props:{dateRange:{},locations:{},isVisible:{type:Boolean},isMobile:{type:Boolean},class:{}},setup(r){const p=r,f=v(()=>p.isVisible&&!!p.dateRange),d={initial:{opacity:0,x:-20,scale:.95},animate:{opacity:1,x:0,scale:1}},y={initial:{opacity:0,y:-20},animate:{opacity:1,y:0}};return(O,j)=>(c(),h("div",null,[a(t(Pt),null,{default:s(()=>[t(f)&&!r.isMobile?(c(),A(t(at).div,{key:0,class:"fixed top-4 left-4 z-50 lg:top-6 lg:left-6 flex flex-col gap-1 bg-black/40 backdrop-blur-3xl rounded-xl border border-white/10 px-4 py-2 pb-4 shadow-2xl",initial:d.initial,animate:d.animate,exit:d.initial,transition:{type:"spring",duration:.4,bounce:.15}},{default:s(()=>[n("span",ee,x(r.dateRange),1),r.locations?(c(),h("span",oe,x(r.locations),1)):M("",!0)]),_:1},8,["initial","animate","exit"])):M("",!0),t(f)&&r.isMobile?(c(),A(t(at).div,{key:1,class:"fixed inset-0 bottom-auto z-50",initial:y.initial,animate:y.animate,exit:y.initial,transition:{type:"spring",duration:.3,bounce:.1}},{default:s(()=>[n("div",ae,[n("span",ne,x(r.dateRange),1),r.locations?(c(),h("span",se,x(r.locations),1)):M("",!0)])]),_:1},8,["initial","animate","exit"])):M("",!0)]),_:1})]))}}),re=Object.assign(ie,{__name:"DateRangeIndicator"}),le=W({__name:"AuthState",setup(r){const{loggedIn:p,user:f,session:d,clear:y,ready:O}=Rt();return(j,D)=>t(O)?nt(j.$slots,"default",Ct(Mt({key:0},{loggedIn:t(p),user:t(f),session:t(d),clear:t(y)}))):nt(j.$slots,"placeholder",{key:1})}}),ce=Object.assign(le,{__name:"AuthState"}),ue={class:"w-full relative overflow-hidden"},de={class:"flex flex-col items-center py-6 pb-0 gap-2"},me={class:"flex flex-col items-center gap-2"},pe={class:"relative mx-auto"},fe={key:0,class:"absolute -bottom-0.5 -right-0.5 bg-amber-500 text-white rounded-full flex items-center justify-center size-5 text-xs drop-shadow-lg drop-shadow-amber-500/30"},he=["src","onClick"],ge={class:"text-2xl font-bold text-neutral-900 dark:text-white/90 mb-2"},_e={class:"text-neutral-600 dark:text-white/30 space-y-1 text-center"},ve={key:0,class:"text-xs font-medium"},be={key:1,class:"text-xs font-medium"},xe={key:2,class:"font-[Pacifico]"},ye={class:"flex items-center gap-0 p-1 bg-white/30 dark:bg-neutral-900/50 rounded-full"},we={class:"font-bold text-sm p-1"},ke={class:"space-y-1"},$e={class:"w-full px-2 pb-1 pt-1.5 bg-neutral-200/50 dark:bg-neutral-900/50 flex justify-between items-center gap-2"},Se={key:0,class:"text-xs text-neutral-500/80 dark:text-neutral-500 font-medium truncate"},Pe={class:"text-xs text-neutral-500/60 dark:text-neutral-500/80 font-medium inline-flex justify-center items-center gap-0.5"},Re=W({__name:"Header",props:{stats:{},dateRangeText:{}},setup(r){const p=mt(),f=Tt(),d=v({get(){return f.value==="dark"},set(o){f.preference=o?"dark":"light"}}),y=()=>{p.push("/signin")},{hasActiveFilters:O,selectedCounts:j}=ht(),{currentSortLabel:D,currentSortIcon:w,currentSortOption:B,availableSorts:K,setSortOption:F}=gt(),X=v(()=>Object.values(j.value).reduce((o,i)=>o+i,0)),k=I(!1);return(o,i)=>{const N=zt,$=pt,T=ft,q=It,U=Zt,G=Jt,H=Kt,V=ce;return c(),h("div",ue,[n("div",{class:"absolute inset-0 -z-10 blur-3xl scale-110 bg-cover bg-center opacity-35",style:st({backgroundImage:`url(${("getSetting"in o?o.getSetting:t(C))("app:avatarUrl")||"/web-app-manifest-192x192.png"})`})},null,4),i[4]||(i[4]=n("div",{class:"absolute inset-0 -z-10 bg-white/50 dark:bg-neutral-900/50"},null,-1)),n("div",de,[a(V,null,{default:s(({loggedIn:z,clear:Q})=>[n("div",me,[n("div",pe,[z?(c(),h("div",fe,[a(N,{name:"tabler:star-filled"})])):M("",!0),n("img",{src:("getSetting"in o?o.getSetting:t(C))("app:avatarUrl")||"/web-app-manifest-192x192.png",class:J(["size-16 rounded-full object-cover",!z&&"cursor-pointer"]),alt:"Author's avatar",onClick:S=>!z&&y()},null,10,he)]),n("h1",ge,x(("getSetting"in o?o.getSetting:t(C))("app:title")),1)]),n("div",_e,[r.stats?.total?(c(),h("p",ve,x(o.$t("ui.stats.totalPhotosWithRange",{range:r.dateRangeText,count:r.stats?.total})),1)):(c(),h("p",be,x(o.$t("ui.stats.noPhotosTip")),1)),("getSetting"in o?o.getSetting:t(C))("app:slogan")?(c(),h("p",xe,x(("getSetting"in o?o.getSetting:t(C))("app:slogan")),1)):M("",!0)]),n("div",ye,[a(T,{text:o.$t("ui.action.globe.tooltip")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:map-pin-2",size:"sm",to:"/globe"})]),_:1},8,["text"]),a(T,{text:o.$t("title.albums")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:photo",size:"sm",to:"/albums"})]),_:1},8,["text"]),a(H,null,{content:s(()=>[a(G,{variant:"glassmorphism"},{default:s(()=>[a(U)]),_:1})]),default:s(()=>[a(T,{text:o.$t("ui.action.filter.tooltip")},{default:s(()=>[a(q,{inset:"",size:"sm",color:"info",show:t(X)>0},{default:s(()=>[a($,{variant:"soft",color:t(O)?"info":"neutral",class:"bg-transparent rounded-full cursor-pointer relative",icon:"tabler:filter",size:"sm"},null,8,["color"])]),_:1},8,["show"])]),_:1},8,["text"])]),_:1}),a(H,null,{content:s(()=>[a(G,{variant:"glassmorphism",class:"w-3xs"},{header:s(()=>[n("h3",we,x(o.$t("ui.action.sort.title")),1)]),default:s(()=>[n("div",ke,[(c(!0),h(jt,null,Ot(t(K),S=>(c(),A($,{key:S.key,variant:t(D)===S.labelI18n?"soft":"ghost",color:t(D)===S.labelI18n?"info":"neutral",icon:S.icon,size:"sm",block:"",class:"justify-start",onClick:E=>t(F)(S.key)},{default:s(()=>[ut(x(o.$t(S.labelI18n)),1)]),_:2},1032,["variant","color","icon","onClick"]))),128))])]),_:1})]),default:s(()=>[a(T,{text:o.$t("ui.action.sort.tooltip")},{default:s(()=>[a($,{variant:"soft",color:t(B)?.key==="dateTaken-desc"?"neutral":"info",class:"bg-transparent rounded-full cursor-pointer",icon:t(w),size:"sm"},null,8,["color","icon"])]),_:1},8,["text"])]),_:1}),a(T,{text:o.$t("ui.action.theme.tooltip")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:t(d)?"tabler:sun":"tabler:moon",size:"sm",onClick:i[0]||(i[0]=S=>d.value=!t(d))},null,8,["icon"])]),_:1},8,["text"]),z?(c(),A(T,{key:0,text:o.$t("ui.action.dashboard.tooltip")},{default:s(()=>[a($,{size:"sm",color:"info",variant:"soft",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:dashboard",to:"/dashboard"})]),_:1},8,["text"])):M("",!0),z?(c(),A(T,{key:1,text:o.$t("ui.action.logout.tooltip")},{default:s(()=>[a($,{size:"sm",color:"error",variant:"soft",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:logout",onClick:Q},null,8,["onClick"])]),_:2},1032,["text"])):M("",!0)])]),_:1}),n("div",$e,[("getSetting"in o?o.getSetting:t(C))("app:author")||("getSetting"in o?o.getSetting:t(C))("app:title")?(c(),h("div",Se," © "+x(o.$dayjs().format("YYYY"))+" "+x(("getSetting"in o?o.getSetting:t(C))("app:author")||("getSetting"in o?o.getSetting:t(C))("app:title")),1)):M("",!0),n("div",Pe,[n("a",{ref:"projectLink",href:"https://github.com/ailunbolinkenasi/chronoframe-opz",target:"_blank",rel:"noopener noreferrer",class:"hover:underline inline-flex items-center gap-0.5 group",onMouseenter:i[1]||(i[1]=z=>k.value=!0),onMouseleave:i[2]||(i[2]=z=>k.value=!1)},[a(N,{name:"mdi:github",class:"inline-block text-sm -mt-px",mode:"svg"}),i[3]||(i[3]=ut(" ChronoFrame-fix-2025-12-31 ",-1))],544)])])])])}}}),Ce=Object.assign(Re,{__name:"MasonryItemHeader"}),Me={class:"relative w-full"},Te=50,ot=8,ze=W({__name:"Root",props:{photos:{},columns:{default:"auto"}},setup(r){const{t:p}=Ut(),f=r,d=Wt(),y=mt(),{filteredPhotos:O,hasActiveFilters:j}=ht(),{sortedPhotos:D}=gt(),w=v(()=>j.value?O.value:D.value),{currentPhotoIndex:B,isViewerOpen:K}=At(Vt()),F=I(),X=I(!1),k=I(),o=I(new Set),i=Yt("(max-width: 768px)"),{batchProcessLivePhotos:N}=Lt(),$=I(new Set),T=I(),q=I(0),U=I(0),{y:G}=Dt(),H=v(()=>G.value>500),V=v(()=>(f.columns==="auto"&&i.value,280)),z=v(()=>f.columns!=="auto"?f.columns:i.value?2:8),Q=v(()=>f.columns!=="auto"?f.columns:2),S=v(()=>w.value?.map((e,l)=>({id:e.id,photo:e,originalIndex:l}))??[]);dt(T,e=>{const l=e[0];l&&(q.value=l.contentRect.height)});const E=()=>{requestAnimationFrame(()=>{if(i.value){U.value=0;return}const e=F.value?.querySelector(".masonry-wall .masonry-column");if(e){U.value=e.getBoundingClientRect().width;return}U.value=V.value})},tt=Ft(E,100);dt(F,()=>{tt()});const _t=v(()=>i.value?0:q.value+ot),vt=v(()=>{const e={};if(i.value)return e.width="100%",e.marginBottom=`${ot}px`,e;const l=U.value||V.value;return e.width=`${l}px`,e});et([V,z,Q],()=>{i.value||Z(E)}),et(i,e=>{if(e){U.value=0;return}Z(E)});const rt=v(()=>{const e=w.value||[],l=e.length;if(l===0)return{total:0,withDates:0,withTitles:0,withExif:0,dateRange:null};let g=0,m=0,_=0,P="",b="";for(const u of e)u.dateTaken&&(g++,(!P||u.dateTaken<P)&&(P=u.dateTaken),(!b||u.dateTaken>b)&&(b=u.dateTaken)),u.title&&m++,u.exif&&_++;const R=P&&b?{start:d(P).format("ll"),end:d(b).format("ll")}:null;return{total:l,withDates:g,withTitles:m,withExif:_,dateRange:R}}),bt=v(()=>{const e=rt.value?.dateRange;return!e||!e.start||!e.end?"":`${e.start} - ${e.end}`}),xt=Nt(()=>{kt(),wt()},150),yt=({index:e,isVisible:l})=>{l?o.value.add(e):o.value.delete(e),xt()},wt=async()=>{if(o.value.size===0)return;const e=Array.from(o.value),l=[];for(const g of e){const m=w.value[g];m&&m.isLivePhoto===1&&m.livePhotoVideoUrl&&!$.value.has(m.id)&&(l.push(m),$.value.add(m.id))}l.length!==0&&N(l.map(g=>({id:g.id,livePhotoVideoUrl:g.livePhotoVideoUrl})))},Y=I(),kt=()=>{if(o.value.size===0){k.value=void 0,Y.value=void 0;return}const e=Array.from(o.value);if(e.length===0)return;const l=Math.min(...e),g=Math.max(...e),m=e.map(L=>w.value[L]?.city).filter(L=>!!L),_=[...new Set(m)];_.length===0?Y.value=void 0:_.length===1?Y.value=_[0]:_.length<=3?Y.value=_.join("、"):Y.value=`${_.slice(0,2).join("、")} `+p("ui.indexPanelCountCity",{count:_.length});const P=w.value[l],b=w.value[g];if(!P?.dateTaken||!b?.dateTaken){k.value=void 0;return}const R=d(P.dateTaken),u=d(b.dateTaken);R.isSame(u,"day")?k.value=R.format("ll"):R.isSame(u,"month")?k.value=R.format("MMM YYYY"):R.isSame(u,"year")?k.value=`${R.format("MMM")} - ${u.format("MMM YYYY")}`:k.value=`${R.format("ll")} - ${u.format("ll")}`},$t=()=>{window.scrollTo({top:0,behavior:"smooth"})};Bt(()=>{window.addEventListener("resize",tt),Z(()=>{E(),B.value&&lt(B.value)})}),Ht(()=>{window.removeEventListener("resize",tt)});const St=e=>{y.push(`/${w.value[e]?.id}`)},lt=e=>{if(!w.value[e])return;const l=w.value[e].id,g=document.querySelector(`[data-photo-id="${l}"]`);if(g){const m=g.getBoundingClientRect(),_=window.innerHeight,b=window.pageYOffset+m.top-_/2+m.height/2;window.scrollTo({top:Math.max(0,b),behavior:"smooth"})}};return et(B,e=>{K.value&&e>=0&&Z(()=>{lt(e)})}),(e,l)=>{const g=re,m=pt,_=ft,P=Ce,b=Xt,R=Et("MasonryWall");return c(),h("div",Me,[a(g,{"date-range":t(k),locations:t(Y),"is-visible":!!t(k)&&t(H),"is-mobile":t(i)},null,8,["date-range","locations","is-visible","is-mobile"]),t(H)?(c(),A(t(at).div,{key:0,class:"fixed bottom-6 right-6 z-50",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2}},{default:s(()=>[a(_,{text:t(p)("ui.action.backtotop.tooltip")||"回到顶部"},{default:s(()=>[a(m,{variant:"soft",color:"neutral",class:"cursor-pointer bg-white/80 dark:bg-neutral-900/80 backdrop-blur-sm flex justify-center items-center rounded-full shadow-lg hover:bg-white dark:hover:bg-neutral-800 transition-all duration-300 border border-neutral-200/50 dark:border-neutral-700/50",icon:"tabler:arrow-up",size:"lg","aria-label":t(p)("ui.action.backtotop.ariaLabel")||"回到顶部",onClick:$t},null,8,["aria-label"])]),_:1},8,["text"])]),_:1})):M("",!0),n("div",{class:J(["lg:px-0 lg:pb-0",t(i)?"px-1 pb-1":"p-1"])},[n("div",{ref_key:"masonryWrapper",ref:F,class:J(["relative",{"pt-2":t(i)}]),style:st({"--masonry-header-offset":`${t(_t)}px`})},[n("div",{ref_key:"headerRef",ref:T,class:J(["masonry-header-wrapper",{"masonry-header-desktop":!t(i)}]),style:st(t(vt))},[a(P,{stats:t(rt),"date-range-text":t(bt)},null,8,["stats","date-range-text"])],6),a(R,{class:"masonry-wall-with-header",items:t(S),"column-width":t(V),gap:ot,"min-columns":t(Q),"max-columns":t(z),"ssr-columns":2,"key-mapper":(u,L,Ee,ct)=>t(S)[ct]?.originalIndex??ct},{default:s(({item:u})=>[u.photo&&typeof u.originalIndex=="number"?(c(),A(b,{key:u.photo.id,photo:u.photo,index:u.originalIndex,"has-animated":t(X),"first-screen-items":Te,class:"masonry-item-optimizer",onVisibilityChange:yt,onOpenViewer:l[0]||(l[0]=L=>St(L))},null,8,["photo","index","has-animated"])):M("",!0)]),_:1},8,["items","column-width","min-columns","max-columns","key-mapper"])],6)],2)])}}}),Ie=Object.assign(it(ze,[["__scopeId","data-v-c8b2d7b3"]]),{__name:"MasonryRoot"}),je={},Oe={class:"relative size-24"},Ue={class:"absolute inset-1 rounded-full overflow-hidden drop-shadow-xl drop-shadow-primary/10 bg-neutral-100 dark:bg-neutral-800"},Ae=["src"],Ve={key:1,class:"w-full h-full object-cover",src:te,alt:"Loading..."};function Ye(r,p){return c(),h("div",Oe,[p[0]||(p[0]=n("div",{class:"absolute inset-0 rounded-full border-2 border-transparent border-x-primary-600 border-y-secondary-600 dark:border-x-primary-400 dark:border-y-secondary-400 animate-spin drop-shadow-xl drop-shadow-primary/10"},null,-1)),n("div",Ue,[("getSetting"in r?r.getSetting:t(C))("app:avatarUrl")?(c(),h("img",{key:0,class:"w-full h-full object-cover",src:("getSetting"in r?r.getSetting:t(C))("app:avatarUrl")?.toString(),alt:"Loading..."},null,8,Ae)):(c(),h("img",Ve))])])}const Le=Object.assign(it(je,[["render",Ye],["__scopeId","data-v-715727ec"]]),{__name:"LoaderAvatar"}),De={class:"relative h-screen"},Be={class:"h-svh px-1"},Fe={class:"fixed inset-0 flex flex-col gap-4 items-center justify-center"},He=W({__name:"masonry",setup(r){qt({title:""});const{photos:p}=Gt();return(f,d)=>{const y=Ie,O=Le,j=Qt;return c(),h("div",De,[n("div",Be,[a(j,null,{fallback:s(()=>[n("div",Fe,[a(O),d[0]||(d[0]=n("span",{class:"loading-scan-wrapper"},[n("span",{class:"text-base font-medium loading-scan-text"}," LOADING ")],-1))])]),default:s(()=>[a(y,{photos:t(p),columns:"auto"},null,8,["photos"])]),_:1}),nt(f.$slots,"default",{},void 0,!0)])])}}}),fo=it(He,[["__scopeId","data-v-866278bf"]]);export{fo as default};
