import{_ as Y,a as Z}from"./BxJwlH6u.js";import{C as K,r as n,j as W,y as X,v as ee,z as te,M as ae,w as C,A as se,o as v,a as s,c as f,R as L,O as r,a2 as E,t as w,b as g,av as V,aw as oe,ah as le,ax as re,P as ne,F as ie,a5 as ce,ay as ue,d as de,_ as ve}from"./Do4Ulm4h.js";import{_ as me}from"./D_BgBUvd.js";import{_ as pe}from"./BV9sba6H.js";import"./D4m22CMA.js";import"./y8VeKFcA.js";import"./D8I6Rcxg.js";import"./Du2f8F9w.js";import"./zoi52lI1.js";import"./Bzg-qYo_.js";import"./KzhxPVJs.js";import"./C8barOil.js";import"./lxpLfLs2.js";import"./DBhqu3Ka.js";const fe={class:"flex-1 overflow-hidden bg-neutral-100 dark:bg-neutral-950 rounded-md relative"},ge={class:"px-4 py-2 border-b border-neutral-300 dark:border-neutral-900 flex items-center justify-between"},_e={class:"text-xs text-gray-500 dark:text-gray-400"},he={class:"flex items-center gap-2"},be={key:0,class:"absolute inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-10"},xe={class:"text-center"},ye={class:"mb-4"},we={class:"w-64 bg-gray-200 dark:bg-gray-700 rounded-full h-2"},ke={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Se={class:"p-2 space-y-1"},Ce={class:"flex items-start space-x-3 text-sm"},Le={class:"text-neutral-400 dark:text-neutral-500 text-xs whitespace-nowrap min-w-0 flex-shrink-0 mt-0.5"},Te={class:"flex-1 min-w-0"},$e=["innerHTML"],Be={key:0,class:"text-xs whitespace-nowrap flex-shrink-0 truncate text-neutral-400/80"},Ue={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Me={key:0},Ee={key:1},Ve=10,ze=16,He=K({__name:"logs",setup(Ae){const m=n([]),i=n(""),_=n([]),c=n(!0),$=n(!1),u=n(""),h=n(),b=n(!1),y=n(0),x=n([]),k=n(!1),z=["error","warn","info","success","debug"],S=t=>({0:"error",1:"warn",2:"info",3:"info",4:"debug"})[t]||"info";let p=null;const B=t=>{x.value.push(t),k.value||H()},H=async()=>{if(!(k.value||x.value.length===0)){for(k.value=!0;x.value.length>0;){const t=x.value.splice(0,Ve);if(m.value.push(...t),m.value.length>1e4&&(m.value=m.value.slice(-5e3)),b.value){const e=m.value.length;y.value=Math.min(100,e/512*100)}c.value&&await T(),x.value.length>0&&await new Promise(e=>setTimeout(e,ze))}k.value=!1}},A=t=>{try{const e=JSON.parse(t);return{date:e.date,args:e.args||[],type:e.type||"info",level:e.level||3,tag:e.tag||"",timestamp:new Date(e.date),raw:t}}catch(e){return console.warn("Failed to parse log line:",t,e),{date:new Date().toISOString(),args:[t],type:"info",level:3,tag:"fallback",timestamp:new Date,raw:t}}},U=W(()=>{let t=m.value;if(_.value.length>0&&(t=t.filter(e=>{const o=e.type||S(e.level);return _.value.includes(o)})),i.value.trim()){const e=i.value.toLowerCase();t=t.filter(o=>{const l=o.args.join(" ").toLowerCase(),d=o.tag.toLowerCase();return l.includes(e)||d.includes(e)})}return t}),D=t=>({error:"error",warn:"warning",info:"info",success:"success",debug:"neutral"})[t]||"info",I=t=>{const e="hover:bg-neutral-200 dark:hover:bg-neutral-800",o=t.type||S(t.level),l={error:"text-red-500 dark:text-red-400 border-l-2 border-red-500 font-bold",warn:"text-yellow-500 dark:text-yellow-400 border-l-2 border-yellow-500 font-bold",info:"text-neutral-400 dark:text-neutral-300 border-l-2 border-blue-500",success:"text-green-500 dark:text-green-400 border-l-2 border-green-500",debug:"text-neutral-300 dark:text-neutral-400 border-l-2 border-neutral-500"};return`${e} ${l[o]||l.info} border-none`},N=()=>u.value.includes("实时")?"text-success":u.value.includes("连接")?"text-info":u.value.includes("错误")?"text-error":"text-warning",j=t=>{if(!i.value.trim())return t;const e=i.value.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${e})`,"gi");return t.replace(o,'<mark class="bg-yellow-300 dark:bg-yellow-700 text-black dark:text-white rounded">$1</mark>')},P=t=>t.join(" "),M=()=>{c.value=!c.value,c.value&&T()},T=async()=>{await se(),h.value&&(h.value.scrollTop=h.value.scrollHeight)},O=()=>{if(!h.value)return;const{scrollTop:t,scrollHeight:e,clientHeight:o}=h.value,l=t+o>=e-50,d=t+o<e-200;l&&!c.value?c.value=!0:d&&c.value&&(c.value=!1)},F=()=>{p&&p.close(),m.value=[],x.value=[],b.value=!0,y.value=0,u.value="正在连接...",p=new EventSource("/api/system/logs");let t=null;const e=2e3;p.onopen=()=>{$.value=!0,u.value="加载历史日志..."},p.onmessage=o=>{const l=o.data;if(l&&l.trim()){const d=A(l);d&&(t&&(clearTimeout(t),t=null),b.value?(B(d),t=setTimeout(()=>{b.value&&(u.value="实时",setTimeout(()=>{b.value=!1,y.value=0,M()},500))},e)):B(d))}},p.onerror=o=>{$.value=!1,u.value="连接错误",console.error("EventSource error:",o)}};return X([_,i],()=>{c.value&&T()},{deep:!0}),ee(()=>{F()}),te(()=>{p&&p.close()}),(t,e)=>{const o=Z,l=le,d=me,R=pe,q=re,Q=ue,G=Y;return v(),ae(G,null,{header:C(()=>[g(o,{title:t.$t("title.logs")},null,8,["title"])]),body:C(()=>[s("div",fe,[s("div",ge,[s("div",null,[e[3]||(e[3]=s("h2",{class:"text-lg font-medium text-blue-600"},"app.log",-1)),s("p",_e,[r(u)?(v(),f("span",{key:0,class:E(N())},w(r(u)),3)):L("",!0)])]),s("div",he,[g(d,{modelValue:r(i),"onUpdate:modelValue":e[1]||(e[1]=a=>V(i)?i.value=a:null),placeholder:"搜索日志内容...",size:"sm",class:"w-48",icon:"tabler:search",ui:{trailing:"pe-1"}},oe({_:2},[r(i)?.length?{name:"trailing",fn:C(()=>[g(l,{color:"neutral",variant:"link",size:"sm",icon:"tabler:x","aria-label":"Clear search input",onClick:e[0]||(e[0]=a=>i.value="")})]),key:"0"}:void 0]),1032,["modelValue"]),g(R,{modelValue:r(_),"onUpdate:modelValue":e[2]||(e[2]=a=>V(_)?_.value=a:null),items:z.map(a=>({label:a.toUpperCase(),value:a})),multiple:"",size:"sm",placeholder:"过滤级别",class:"w-24",clearable:!1},null,8,["modelValue","items"]),g(l,{icon:"tabler:arrow-bar-to-down",color:"neutral",size:"sm",variant:r(c)?"outline":"soft",onClick:M},null,8,["variant"])])]),r(b)?(v(),f("div",be,[s("div",xe,[s("div",ye,[g(q,{name:"tabler:loader-2",class:"animate-spin w-8 h-8 text-blue-500"})]),e[4]||(e[4]=s("div",{class:"text-sm text-gray-600 dark:text-gray-400 mb-2"}," 正在加载历史日志... ",-1)),s("div",we,[s("div",{class:"bg-blue-500 h-2 rounded-full transition-all duration-300 ease-out",style:ne({width:`${r(y)}%`})},null,4)]),s("div",ke,w(Math.round(r(y)))+"% ",1)])])):L("",!0),s("div",{ref_key:"logContainer",ref:h,class:"h-[calc(100vh-10rem)] overflow-y-auto overflow-x-auto scroll-smooth font-mono text-sm relative",onScroll:O},[s("div",Se,[(v(!0),f(ie,null,ce(r(U),(a,J)=>(v(),f("div",{key:J,class:E(["px-2 py-0.5 rounded border-l-4",I(a)])},[s("div",Ce,[s("span",Le,w(t.$dayjs(a.date).format("HH:mm:ss.SSS")),1),g(Q,{size:"sm",variant:a.level<=1?"solid":"soft",color:D(a.type||S(a.level))},{default:C(()=>[de(w((a.type||S(a.level)).toUpperCase().slice(0,4)),1)]),_:2},1032,["variant","color"]),s("div",Te,[s("span",{class:"whitespace-pre-wrap break-words",innerHTML:j(P(a.args))},null,8,$e)]),a.tag?(v(),f("span",Be,w(a.tag),1)):L("",!0)])],2))),128)),r(U).length===0?(v(),f("div",Ue,[r(m).length===0?(v(),f("div",Me,"等待日志数据...")):(v(),f("div",Ee,"没有匹配的日志条目"))])):L("",!0)])],544)])]),_:1})}}}),Ke=ve(He,[["__scopeId","data-v-90e8dcbf"]]);export{Ke as default};
