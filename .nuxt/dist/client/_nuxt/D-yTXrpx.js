import{_ as ht}from"./Ccp_Usjl.js";import{C as we,aK as xt,D as wt,W as xa,aL as Ue,aM as wa,aN as kt,r as j,j as D,M as C,o as c,w as r,b as n,O as e,aO as Le,N as G,R as q,v as it,aP as Ne,A as st,H as de,aQ as ka,d as te,t as x,y as $e,z as rt,a as g,a0 as ie,a2 as V,a6 as Ce,a4 as _e,c as O,F as ge,a5 as xe,P as Ia,ay as ye,ah as Ge,aE as It,_ as zt,K as _t,aR as za,aS as _a,aT as vt,aU as Qe,aV as $a,aW as Ye,aX as $t,aY as St,aZ as Tt,a_ as Me,l as De,a$ as He,Y as We,b0 as qt,ax as be,b1 as Sa,b2 as Ta,b3 as nt,b4 as qa,b5 as Fa,b6 as ze,aw as Ft,b7 as Ct,b8 as Ca,b9 as Ma,ba as La,Z as lt,$ as ot,bb as Mt,bc as Pa,bd as Ra,be as Aa,bf as Lt,bg as Da,a9 as Pt,az as Ua,af as Ba,bh as Va,u as Oa,ac as Ka,aj as Ea,E as oe,aD as at,a1 as ja,bi as bt,a7 as Na,aH as Ha,e as Wa,av as ve,bj as Ga,aB as Qa}from"./Do4Ulm4h.js";import{_ as Ya,a as Xa}from"./BxJwlH6u.js";import{_ as Za}from"./Axqrd8Wi.js";import{_ as Ja,a as es}from"./BRFgOYk5.js";import{a as ts,_ as as}from"./BBFWqhkk.js";import{_ as ss}from"./BEhpCpui.js";import{_ as ls}from"./Dt03dVmC.js";import{u as os,D as me,a as is,b as rs,c as ns,_ as ds}from"./Be18tplX.js";import{_ as us}from"./D2mnJjkG.js";import{_ as cs}from"./DOw8EvtE.js";import{_ as ps}from"./D_BgBUvd.js";import{_ as gs,a as fs}from"./CPK4N6jr.js";import{_ as ms}from"./DMIzqIME.js";import{u as hs}from"./y8VeKFcA.js";import{u as vs}from"./D8I6Rcxg.js";import{V as bs}from"./Qxlw5ViT.js";import{u as ys}from"./DBhqu3Ka.js";import{_ as xs}from"./BC21tflR.js";import{_ as ws}from"./CrhNAChg.js";import{u as ks}from"./B_ZWtxNr.js";import"./CTn4-S8R.js";import"./DdhnkgWh.js";import"./MPJDxmQh.js";import"./Duon1tOp.js";import"./D4m22CMA.js";import"./Bzg-qYo_.js";import"./lxpLfLs2.js";import"./Du2f8F9w.js";import"./zoi52lI1.js";import"./BN_V-WW3.js";import"./KzhxPVJs.js";import"./C8barOil.js";import"./DN8WM3HB.js";const[dt,Is]=xt("TagsInputRoot");var zs=we({__name:"TagsInputRoot",props:{modelValue:{type:[Array,null],required:!1},defaultValue:{type:Array,required:!1,default:()=>[]},addOnPaste:{type:Boolean,required:!1},addOnTab:{type:Boolean,required:!1},addOnBlur:{type:Boolean,required:!1},duplicate:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},delimiter:{type:null,required:!1,default:","},dir:{type:String,required:!1},max:{type:Number,required:!1,default:0},id:{type:String,required:!1},convertValue:{type:Function,required:!1},displayValue:{type:Function,required:!1,default:l=>l.toString()},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue","invalid","addTag","removeTag"],setup(l,{emit:t}){const p=l,i=t,{addOnPaste:A,disabled:f,delimiter:k,max:w,id:J,dir:N,addOnBlur:H,addOnTab:S}=wt(p),d=hs(N),u=xa(p,"modelValue",i,{defaultValue:p.defaultValue,passive:!0,deep:!0}),{forwardRef:h,currentElement:_}=Ue(),{focused:o}=wa(_),B=vs(_),{getItems:b,CollectionSlot:ee}=kt({isProvider:!0}),$=j(),W=j(!1),se=D(()=>Array.isArray(u.value)?[...u.value]:[]);function ne(M){if(M!==-1){const R=b().filter(F=>F.ref.dataset.disabled!=="");u.value=u.value.filter((F,L)=>L!==M),i("removeTag",R[M].value)}}return Is({modelValue:u,onAddValue:M=>{const R=[...se.value],F=R.length>0&&typeof R[0]=="object",L=R.length>0&&typeof p.defaultValue[0]=="object";if((F||L)&&typeof p.convertValue!="function")throw new Error("You must provide a `convertValue` function when using objects as values.");const T=p.convertValue?p.convertValue(M):M;if(R.length>=w.value&&w.value)return i("invalid",T),!1;if(p.duplicate)return u.value=[...R,T],i("addTag",T),!0;if(R.includes(T))W.value=!0;else return u.value=[...R,T],i("addTag",T),!0;return i("invalid",T),!1},onRemoveValue:ne,onInputKeydown:M=>{const R=M.target,F=b().map(T=>T.ref).filter(T=>T.dataset.disabled!=="");if(!F.length)return;const L=F.at(-1);switch(M.key){case"Delete":case"Backspace":{if(R.selectionStart!==0||R.selectionEnd!==0)break;if($.value){const T=F.findIndex(P=>P===$.value);ne(T),$.value=$.value===L?F.at(T-1):F.at(T+1),M.preventDefault()}else M.key==="Backspace"&&($.value=L,M.preventDefault());break}case"Home":case"End":case"ArrowRight":case"ArrowLeft":{const T=M.key==="ArrowRight"&&d.value==="ltr"||M.key==="ArrowLeft"&&d.value==="rtl",P=!T;if(R.selectionStart!==0||R.selectionEnd!==0)break;if(P&&!$.value)$.value=L,M.preventDefault();else if(T&&L&&$.value===L)$.value=void 0,M.preventDefault();else if($.value){const X=os(M,$.value,void 0,{itemsArray:F,loop:!1,dir:d.value});X&&($.value=X),M.preventDefault()}break}case"ArrowUp":case"ArrowDown":{$.value&&M.preventDefault();break}default:$.value=void 0}},selectedElement:$,isInvalidInput:W,addOnPaste:A,addOnBlur:H,addOnTab:S,dir:d,disabled:f,delimiter:k,max:w,id:J,displayValue:p.displayValue}),(M,R)=>(c(),C(e(ee),null,{default:r(()=>[n(e(Le),{ref:e(h),dir:e(d),as:M.as,"as-child":M.asChild,"data-invalid":W.value?"":void 0,"data-disabled":e(f)?"":void 0,"data-focused":e(o)?"":void 0},{default:r(()=>[G(M.$slots,"default",{modelValue:e(u)}),e(B)&&M.name?(c(),C(e(bs),{key:0,name:M.name,value:e(u),required:M.required,disabled:e(f)},null,8,["name","value","required","disabled"])):q("v-if",!0)]),_:3},8,["dir","as","as-child","data-invalid","data-disabled","data-focused"])]),_:3}))}}),_s=zs,$s=we({__name:"TagsInputInput",props:{placeholder:{type:String,required:!1},autoFocus:{type:Boolean,required:!1},maxLength:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"input"}},setup(l){const t=l,p=dt(),{forwardRef:i,currentElement:A}=Ue();function f(u){if(p.selectedElement.value=void 0,!p.addOnBlur.value)return;const h=u.target;if(!h.value)return;p.onAddValue(h.value)&&(h.value="")}function k(u){p.addOnTab.value&&H(u)}const w=j(!1);function J(){w.value=!0}function N(){st(()=>{w.value=!1})}async function H(u){if(w.value||(await st(),u.defaultPrevented))return;const h=u.target;if(!h.value)return;p.onAddValue(h.value)&&(h.value=""),u.preventDefault()}function S(u){if(p.isInvalidInput.value=!1,u.data===null)return;const h=p.delimiter.value;if(h===u.data||h instanceof RegExp&&h.test(u.data)){const o=u.target;if(o.value=o.value.replace(h,""),o.value.trim()===""){o.value="";return}p.onAddValue(o.value)&&(o.value="")}}function d(u){if(p.addOnPaste.value){u.preventDefault();const h=u.clipboardData;if(!h)return;const _=h.getData("text");p.delimiter.value?_.split(p.delimiter.value).forEach(B=>{p.onAddValue(B)}):p.onAddValue(_)}}return it(()=>{const u=A.value.nodeName==="INPUT"?A.value:A.value.querySelector("input");u&&setTimeout(()=>{t.autoFocus&&u?.focus()},1)}),(u,h)=>(c(),C(e(Le),{id:e(p).id?.value,ref:e(i),type:"text",autocomplete:"off",autocorrect:"off",autocapitalize:"off",as:u.as,"as-child":u.asChild,maxlength:u.maxLength,placeholder:u.placeholder,disabled:e(p).disabled.value,"data-invalid":e(p).isInvalidInput.value?"":void 0,onInput:S,onKeydown:[Ne(H,["enter"]),Ne(k,["tab"]),e(p).onInputKeydown],onBlur:f,onCompositionstart:J,onCompositionend:N,onPaste:d},{default:r(()=>[G(u.$slots,"default")]),_:3},8,["id","as","as-child","maxlength","placeholder","disabled","data-invalid","onKeydown"]))}}),Ss=$s;const[Rt,Ts]=xt("TagsInputItem");var qs=we({__name:"TagsInputItem",props:{value:{type:null,required:!0},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(l){const t=l,{value:p}=wt(t),i=dt(),{forwardRef:A,currentElement:f}=Ue(),{CollectionItem:k}=kt(),w=D(()=>i.selectedElement.value===f.value),J=D(()=>t.disabled||i.disabled.value),N=Ts({value:p,isSelected:w,disabled:J,textId:"",displayValue:D(()=>i.displayValue(p.value))});return(H,S)=>(c(),C(e(k),{value:e(p)},{default:r(()=>[n(e(Le),{ref:e(A),as:H.as,"as-child":H.asChild,"aria-labelledby":e(N).textId,"aria-current":w.value,"data-disabled":J.value?"":void 0,"data-state":w.value?"active":"inactive"},{default:r(()=>[G(H.$slots,"default")]),_:3},8,["as","as-child","aria-labelledby","aria-current","data-disabled","data-state"])]),_:3},8,["value"]))}}),Fs=qs,Cs=we({__name:"TagsInputItemDelete",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(l){const t=l;Ue();const p=dt(),i=Rt(),A=D(()=>i.disabled?.value||p.disabled.value);function f(){if(A.value)return;const k=p.modelValue.value.findIndex(w=>ka(w,i.value.value));p.onRemoveValue(k)}return(k,w)=>(c(),C(e(Le),de({tabindex:"-1"},t,{"aria-labelledby":e(i).textId,"aria-current":e(i).isSelected.value,"data-state":e(i).isSelected.value?"active":"inactive","data-disabled":A.value?"":void 0,type:k.as==="button"?"button":void 0,onClick:f}),{default:r(()=>[G(k.$slots,"default")]),_:3},16,["aria-labelledby","aria-current","data-state","data-disabled","type"]))}}),Ms=Cs,Ls=we({__name:"TagsInputItemText",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(l){const t=l,p=Rt();return Ue(),p.textId||=ys(void 0,"reka-tags-input-item-text"),(i,A)=>(c(),C(e(Le),de(t,{id:e(p).textId}),{default:r(()=>[G(i.$slots,"default",{},()=>[te(x(e(p).displayValue.value),1)])]),_:3},16,["id"]))}}),Ps=Ls;const Rs={class:"flex items-start justify-between"},As={class:"flex items-center gap-3 flex-1 min-w-0"},Ds={class:"flex-1 min-w-0"},Us={class:"flex items-center gap-2 mb-1"},Bs={class:"font-medium text-sm truncate text-neutral-900 dark:text-neutral-100"},Vs={class:"flex items-center gap-1 text-xs text-neutral-500 dark:text-neutral-400"},Os={key:0,class:"hidden sm:inline"},Ks={class:"flex items-center gap-2 ml-2"},Es={key:0,class:"space-y-1"},js={class:"flex justify-between items-center"},Ns={class:"text-xs font-mono text-neutral-600 dark:text-neutral-400"},Hs={key:0,class:"text-xs text-neutral-500 dark:text-neutral-400"},Ws={key:1,class:"space-y-1"},Gs={class:"flex justify-between items-center"},yt=12,Qs=we({__name:"UploadQueueItem",props:{uploadingFile:{},fileId:{}},emits:["removeFile"],setup(l,{emit:t}){const p=l,i=t,A=D(()=>{const h=p.uploadingFile.file;return h.type.startsWith("image/")?"tabler:photo":h.type.startsWith("video/")?"tabler:video":"tabler:file"}),f=D(()=>{switch(p.uploadingFile.status){case"waiting":return"neutral";case"preparing":return"primary";case"uploading":return"primary";case"processing":return"info";case"completed":return"success";case"error":return"error";case"skipped":return"warning";case"blocked":return"error";default:return"neutral"}}),k=D(()=>{switch(p.uploadingFile.status){case"waiting":return"等待上传";case"preparing":return"准备中";case"uploading":return`上传中 ${p.uploadingFile.progress||0}%`;case"processing":return p.uploadingFile.stage?w(p.uploadingFile.stage):"等待处理";case"completed":return"完成";case"error":return"错误";case"skipped":return"已跳过";case"blocked":return"被阻止";default:return"未知"}}),w=h=>({preprocessing:"预处理中",metadata:"提取元数据",thumbnail:"生成缩略图",exif:"处理 EXIF","reverse-geocoding":"地理解析","live-photo":"检测 LivePhoto"})[h]||h,J=h=>{if(h===0)return"0 B";const _=1024,o=["B","KB","MB","GB"],B=Math.floor(Math.log(h)/Math.log(_));return parseFloat((h/Math.pow(_,B)).toFixed(1))+" "+o[B]},N=j(!1),H=j(!1),S=j(null);let d=null;$e(()=>p.uploadingFile.status,async(h,_)=>{h==="completed"&&_!=="completed"&&(await st(),setTimeout(()=>{N.value=!0,setTimeout(()=>{N.value=!1},2e3)},300)),h==="processing"&&_!=="processing"?(S.value=Date.now(),H.value=!1,d=setTimeout(()=>{p.uploadingFile.status==="processing"&&(H.value=!0)},3e4)):_==="processing"&&h!=="processing"&&(d&&(clearTimeout(d),d=null),H.value=!1,S.value=null)}),rt(()=>{d&&clearTimeout(d)});const u=h=>{const _=360/yt*h,o=60+Math.random()*40,B=1.5+Math.random()*.5;return{"--angle":`${_}deg`,"--distance":`${o}px`,"--duration":`${B}s`,"--delay":`${Math.random()*.3}s`}};return(h,_)=>{const o=Ce,B=ye,b=Ge,ee=It,$=Za;return c(),C(e(ie).div,{class:"bg-white dark:bg-neutral-800 rounded-lg p-3 shadow-sm border border-neutral-200 dark:border-neutral-700",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{duration:.3,ease:"easeOut"},layout:""},{default:r(()=>[g("div",Rs,[g("div",As,[n(e(ie).div,{class:"relative flex-shrink-0",transition:{duration:l.uploadingFile.status==="processing"?2:.3,repeat:l.uploadingFile.status==="processing"?1/0:0,ease:"linear"}},{default:r(()=>[g("div",{class:V(["w-10 h-10 rounded-lg border flex items-center justify-center",{"bg-blue-100 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800/50":f.value==="primary"||f.value==="info","bg-green-100 dark:bg-green-900/30 border-green-200 dark:border-green-800/50":f.value==="success","bg-red-100 dark:bg-red-900/30 border-red-200 dark:border-red-800/50":f.value==="error","bg-yellow-100 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-800/50":f.value==="warning","bg-neutral-100 dark:bg-neutral-900/30 border-neutral-200 dark:border-neutral-800/50":f.value==="neutral"}])},[n(o,{name:A.value,class:V(["w-5 h-5",{"text-blue-600/80 dark:text-blue-400/80":f.value==="primary"||f.value==="info","text-green-600/80 dark:text-green-400/80":f.value==="success","text-red-600/80 dark:text-red-400/80":f.value==="error","text-yellow-600/80 dark:text-yellow-400/80":f.value==="warning","text-neutral-600/80 dark:text-neutral-400/80":f.value==="neutral"}])},null,8,["name","class"])],2),l.uploadingFile.status==="completed"?(c(),C(e(ie).div,{key:0,class:"absolute -top-2 -right-2 size-5 bg-green-900 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3,ease:"backOut"}},{default:r(()=>[n(o,{name:"tabler:check",class:"size-3 text-white"})]),_:1})):q("",!0),l.uploadingFile.status==="skipped"?(c(),C(e(ie).div,{key:1,class:"absolute -top-2 -right-2 size-5 bg-yellow-600 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3,ease:"backOut"}},{default:r(()=>[n(o,{name:"tabler:arrow-big-right-lines",class:"size-3 text-white"})]),_:1})):q("",!0),l.uploadingFile.status==="blocked"?(c(),C(e(ie).div,{key:2,class:"absolute -top-2 -right-2 size-5 bg-red-600 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3,ease:"backOut"}},{default:r(()=>[n(o,{name:"tabler:cancel",class:"size-3 text-white"})]),_:1})):q("",!0),n(e(_e),null,{default:r(()=>[N.value&&l.uploadingFile.status==="completed"?(c(),C(e(ie).div,{key:0,class:"absolute -top-2 -right-2 size-5 pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}},{default:r(()=>[(c(),O(ge,null,xe(yt,W=>g("div",{key:W,class:"absolute top-1/2 left-1/2 w-1.5 h-1.5 rounded-full particle-burst",style:Ia(u(W-1))},null,4)),64))]),_:1})):q("",!0)]),_:1})]),_:1},8,["transition"]),g("div",Ds,[g("div",Us,[g("p",Bs,x(l.uploadingFile.fileName),1),n(B,{color:f.value,variant:"soft",size:"sm"},{default:r(()=>[te(x(k.value),1)]),_:1},8,["color"])]),g("div",Vs,[g("span",null,x(J(l.uploadingFile.file.size)),1),l.uploadingFile.uploadProgress?.speedText&&l.uploadingFile.status==="uploading"?(c(),O("span",Os," • "+x(l.uploadingFile.uploadProgress.speedText),1)):q("",!0)])])]),g("div",Ks,[l.uploadingFile.status==="uploading"&&l.uploadingFile.canAbort?(c(),C(e(ie).div,{key:0,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8}},{default:r(()=>[n(b,{size:"xs",color:"error",variant:"ghost",icon:"tabler:x",onClick:_[0]||(_[0]=W=>l.uploadingFile.abortUpload?.())},{default:r(()=>[..._[2]||(_[2]=[te(" 中止 ",-1)])]),_:1})]),_:1})):q("",!0),l.uploadingFile.status==="completed"||l.uploadingFile.status==="error"?(c(),C(e(ie).div,{key:1,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8}},{default:r(()=>[n(b,{size:"xs",color:"neutral",variant:"soft",icon:"tabler:x",onClick:_[1]||(_[1]=W=>i("removeFile",l.fileId))},{default:r(()=>[..._[3]||(_[3]=[te(" 清除 ",-1)])]),_:1})]),_:1})):q("",!0)])]),n(e(_e),null,{default:r(()=>[l.uploadingFile.status==="uploading"||l.uploadingFile.status==="processing"?(c(),C(e(ie).div,{key:0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},class:"space-y-2 mt-3"},{default:r(()=>[l.uploadingFile.status==="uploading"?(c(),O("div",Es,[g("div",js,[_[4]||(_[4]=g("span",{class:"text-xs text-neutral-600 dark:text-neutral-400"}," 上传进度 ",-1)),g("span",Ns,x(l.uploadingFile.progress)+"% ",1)]),n(e(ie).div,{class:"relative",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.5}},{default:r(()=>[n(ee,{"model-value":l.uploadingFile.progress,color:f.value},null,8,["model-value","color"])]),_:1}),l.uploadingFile.uploadProgress?.timeRemainingText?(c(),O("div",Hs," 剩余时间: "+x(l.uploadingFile.uploadProgress.timeRemainingText),1)):q("",!0)])):q("",!0),l.uploadingFile.status==="processing"?(c(),O("div",Ws,[g("div",Gs,[_[5]||(_[5]=g("span",{class:"text-xs text-neutral-600 dark:text-neutral-400"}," 处理状态 ",-1)),n(e(ie).span,{class:"text-xs text-info-600 dark:text-info-400",animate:{opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0}},{default:r(()=>[te(x(w(l.uploadingFile.stage||"pending")),1)]),_:1})]),n(ee,{"model-value":null,animation:"swing",color:"info"})])):q("",!0)]),_:1})):q("",!0)]),_:1}),n(e(_e),null,{default:r(()=>[l.uploadingFile.status==="error"&&l.uploadingFile.error?(c(),C(e(ie).div,{key:0,initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3},class:"mt-3"},{default:r(()=>[n($,{description:l.uploadingFile.error,color:"error",variant:"soft",icon:"tabler:alert-circle",ui:{root:"px-2.5 py-2"}},null,8,["description"])]),_:1})):q("",!0)]),_:1}),n(e(_e),null,{default:r(()=>[H.value&&l.uploadingFile.status==="processing"?(c(),C(e(ie).div,{key:0,initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3},class:"mt-3"},{default:r(()=>[n($,{description:"大文件处理时间较长，为正常现象",color:"info",variant:"soft",icon:"tabler:info-circle",ui:{root:"px-2.5 py-2"}})]),_:1})):q("",!0)]),_:1}),n(e(_e),null,{default:r(()=>[l.uploadingFile.status==="completed"?(c(),C(e(ie).div,{key:0,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:[.8,1.1,1],y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.6,ease:"backOut"},class:"mt-3"},{default:r(()=>[n($,{description:"文件已成功上传并处理",color:"success",variant:"soft",icon:"tabler:circle-check",ui:{root:"px-2.5 py-2"}})]),_:1})):q("",!0)]),_:1})]),_:1})}}}),Ys=Object.assign(zt(Qs,[["__scopeId","data-v-967c796b"]]),{__name:"UploadQueueItem"}),Xs={key:0,class:"fixed bottom-2 inset-x-2 sm:inset-x-6 sm:bottom-6 sm:left-auto z-50 min-w-sm sm:w-md"},Zs={class:"flex items-center justify-between"},Js={class:"flex items-center gap-3"},el={class:"font-semibold text-sm text-neutral-900 dark:text-neutral-100"},tl={class:"text-neutral-500 dark:text-neutral-400"},al={class:"flex items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400 mt-1"},sl={key:0,class:"text-neutral-600 dark:text-neutral-400"},ll={key:1,class:"text-blue-600 dark:text-blue-400"},ol={key:2,class:"text-green-600 dark:text-green-400"},il={key:3,class:"text-red-600 dark:text-red-400"},rl={key:4,class:"text-yellow-600 dark:text-yellow-400"},nl={key:5,class:"text-red-600 dark:text-red-400"},dl={class:"flex items-center gap-2"},ul={key:0,class:"text-xs text-neutral-500 dark:text-neutral-400 font-mono"},cl={class:"p-2 space-y-2"},pl={class:"flex items-center justify-between gap-2"},gl={class:"text-xs text-neutral-500 dark:text-neutral-400"},fl={class:"flex items-center gap-0.5"},ml=we({__name:"UploadQueuePanel",props:{uploadingFiles:{},collapsed:{type:Boolean}},emits:["removeFile","clearCompleted","clearAll","toggle","goToQueue"],setup(l,{emit:t}){const p=l,i=t,A=j(p.collapsed||!1),f=D(()=>{const S=Array.from(p.uploadingFiles.values());return{total:S.length,waiting:S.filter(d=>d.status==="waiting").length,uploading:S.filter(d=>d.status==="uploading").length,processing:S.filter(d=>d.status==="processing").length,completed:S.filter(d=>d.status==="completed").length,error:S.filter(d=>d.status==="error").length,skipped:S.filter(d=>d.status==="skipped").length,blocked:S.filter(d=>d.status==="blocked").length,active:S.filter(d=>d.status==="uploading"||d.status==="processing").length,pending:S.filter(d=>d.status==="waiting"||d.status==="preparing").length}}),k=D(()=>{const S=Array.from(p.uploadingFiles.values());if(S.length===0)return 0;let d=0;return S.forEach(u=>{u.status==="completed"?d+=100:u.status==="uploading"&&u.progress!==void 0?d+=u.progress*.7:u.status==="processing"?d+=70:(u.status==="preparing"||u.status==="waiting"||u.status==="skipped"||u.status==="blocked")&&(d+=0)}),Math.round(d/S.length)}),w=D(()=>f.value.error>0||f.value.blocked>0?"error":f.value.active>0?"primary":f.value.skipped>0&&f.value.active===0?"warning":f.value.completed>0&&f.value.active===0?"success":"neutral"),J=()=>{A.value=!A.value,i("toggle")},N=()=>{i("clearCompleted")},H=()=>{i("clearAll")};return(S,d)=>{const u=Ce,h=It,_=Ys,o=Ge;return l.uploadingFiles.size>0?(c(),O("div",Xs,[n(e(ie).div,{class:"bg-white dark:bg-neutral-900 rounded-xl shadow-2xl border border-neutral-200 dark:border-neutral-700 overflow-hidden",initial:{opacity:0,y:100,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:100,scale:.9},transition:{duration:.4,ease:"backOut"},layout:""},{default:r(()=>[n(e(ie).div,{class:"p-4 border-b border-neutral-200 dark:border-neutral-700 cursor-pointer","while-hover":{backgroundColor:"rgba(0,0,0,0.02)"},"while-tap":{scale:.98},onClick:J},{default:r(()=>[g("div",Zs,[g("div",Js,[n(u,{name:{primary:"tabler:upload",success:"tabler:circle-check",error:"tabler:alert-circle",warning:"tabler:alert-triangle",neutral:"tabler:info-circle"}[e(w)],class:V(["size-5",{"text-blue-600 dark:text-blue-400":e(w)==="primary","text-green-600 dark:text-green-400":e(w)==="success","text-red-600 dark:text-red-400":e(w)==="error","text-yellow-600 dark:text-yellow-400":e(w)==="warning","text-neutral-600 dark:text-neutral-400":e(w)==="neutral"}])},null,8,["name","class"]),g("div",null,[g("h3",el,[d[2]||(d[2]=te(" 文件上传队列 ",-1)),g("span",tl," ("+x(e(f).total)+") ",1)]),g("div",al,[e(f).waiting>0?(c(),O("span",sl,x(e(f).waiting)+" 等待 ",1)):q("",!0),e(f).active>0?(c(),O("span",ll,x(e(f).active)+" 进行中 ",1)):q("",!0),e(f).completed>0?(c(),O("span",ol,x(e(f).completed)+" 完成 ",1)):q("",!0),e(f).error>0?(c(),O("span",il,x(e(f).error)+" 失败 ",1)):q("",!0),e(f).skipped>0?(c(),O("span",rl,x(e(f).skipped)+" 跳过 ",1)):q("",!0),e(f).blocked>0?(c(),O("span",nl,x(e(f).blocked)+" 被阻止 ",1)):q("",!0)])])]),g("div",dl,[e(f).active>0?(c(),O("div",ul,x(e(k))+"% ",1)):q("",!0),n(e(ie).div,{animate:{rotate:e(A)?0:180},transition:{duration:.3}},{default:r(()=>[n(u,{name:"tabler:chevron-down",class:"size-5 text-neutral-500 dark:text-neutral-400 block"})]),_:1},8,["animate"])])]),e(f).active>0?(c(),C(e(ie).div,{key:0,class:"mt-3",initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},exit:{opacity:0,scaleX:0},transition:{duration:.3},style:{"transform-origin":"left"}},{default:r(()=>[n(h,{"model-value":e(k),color:e(w)},null,8,["model-value","color"])]),_:1})):q("",!0)]),_:1}),n(e(_e),null,{default:r(()=>[e(A)?q("",!0):(c(),C(e(ie).div,{key:0,initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},class:"max-h-[calc(100vh-25.3rem)] sm:max-h-[600px] overflow-hidden overflow-y-auto filelist-container"},{default:r(()=>[g("div",cl,[n(e(_e),{mode:"popLayout"},{default:r(()=>[(c(!0),O(ge,null,xe(l.uploadingFiles,([B,b])=>(c(),C(_,{key:B,"uploading-file":b,"file-id":B,onRemoveFile:d[0]||(d[0]=ee=>i("removeFile",ee))},null,8,["uploading-file","file-id"]))),128))]),_:1})])]),_:1}))]),_:1}),n(e(_e),null,{default:r(()=>[!e(A)&&(e(f).completed>0||e(f).error>0)?(c(),C(e(ie).div,{key:0,initial:{opacity:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,scaleY:0},transition:{duration:.3},style:{"transform-origin":"bottom"},class:"p-3 border-t border-neutral-200 dark:border-neutral-700 bg-neutral-50 dark:bg-neutral-800/50"},{default:r(()=>[g("div",pl,[g("div",gl,x(e(f).completed)+" 完成, "+x(e(f).error)+" 失败 ",1),g("div",fl,[e(f).completed>0?(c(),C(o,{key:0,size:"xs",variant:"ghost",color:"neutral",onClick:N},{default:r(()=>[...d[3]||(d[3]=[te(" 清除已完成 ",-1)])]),_:1})):q("",!0),n(o,{size:"xs",variant:"ghost",color:"error",icon:"tabler:trash",onClick:H},{default:r(()=>[...d[4]||(d[4]=[te(" 清除全部 ",-1)])]),_:1}),n(o,{size:"xs",variant:"ghost",color:"info",icon:"tabler:list-check",onClick:d[1]||(d[1]=B=>i("goToQueue"))},{default:r(()=>[...d[5]||(d[5]=[te(" 队列管理 ",-1)])]),_:1})])])]),_:1})):q("",!0)]),_:1})]),_:1})])):q("",!0)}}}),hl=Object.assign(zt(ml,[["__scopeId","data-v-ba2f3ab9"]]),{__name:"UploadQueuePanel"});function vl(l){if(!l||l==="*")return;const t=l.split(",").map(p=>{const i=p.trim();return i.includes("/")&&i.endsWith("/*")&&i.split("/")[0]||i}).filter(p=>!p.startsWith("."));return t.length>0?t:void 0}function bl(l){const{accept:t="*",reset:p=!1,multiple:i=!1,dropzone:A=!0,onUpdate:f}=l,k=j(),w=j(),J=D(()=>vl(e(t))),N=(u,h=!1)=>{if(!(!u||u.length===0)){if(u instanceof FileList&&(u=Array.from(u)),u.length>1&&!i&&(u=[u[0]]),h&&k.value?.$el)try{const _=new DataTransfer;u.forEach(o=>_.items.add(o)),k.value.$el.files=_.files}catch(_){console.warn("Could not sync files to input element:",_)}f(u)}},H=j(!1),S=_t({open:()=>{}});function d(){S.open()}return it(()=>{const{isOverDropZone:u}=A?za(w,{dataTypes:J.value,onDrop:o=>N(o,!0)}):{isOverDropZone:j(!1)};$e(u,o=>{H.value=o});const{onChange:h,open:_}=_a({accept:e(t),multiple:i,input:e(k)?.$el,reset:p});S.open=_,h(o=>N(o,!1))}),{isDragging:H,open:d,inputRef:k,dropzoneRef:w}}const yl={slots:{root:"relative flex flex-col",base:["w-full flex-1 bg-default border border-default flex flex-col gap-2 items-stretch justify-center rounded-lg focus-visible:outline-2","transition-[background]"],wrapper:"flex flex-col items-center justify-center text-center",icon:"shrink-0",avatar:"shrink-0",label:"font-medium text-default mt-2",description:"text-muted mt-1",actions:"flex flex-wrap gap-1.5 shrink-0 mt-4",files:"",file:"relative",fileLeadingAvatar:"shrink-0",fileWrapper:"flex flex-col min-w-0",fileName:"text-default truncate",fileSize:"text-muted truncate",fileTrailingButton:""},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{area:{wrapper:"px-4 py-3",base:"p-4"},button:{}},size:{xs:{base:"text-xs",icon:"size-4",file:"text-xs px-2 py-1 gap-1",fileWrapper:"flex-row gap-1"},sm:{base:"text-xs",icon:"size-4",file:"text-xs px-2.5 py-1.5 gap-1.5",fileWrapper:"flex-row gap-1"},md:{base:"text-sm",icon:"size-5",file:"text-xs px-2.5 py-1.5 gap-1.5"},lg:{base:"text-sm",icon:"size-5",file:"text-sm px-3 py-2 gap-2",fileSize:"text-xs"},xl:{base:"text-base",icon:"size-6",file:"text-sm px-3 py-2 gap-2"}},layout:{list:{root:"gap-2 items-start",files:"flex flex-col w-full gap-2",file:"min-w-0 flex items-center border border-default rounded-md w-full",fileTrailingButton:"ms-auto"},grid:{fileWrapper:"hidden",fileLeadingAvatar:"size-full rounded-lg",fileTrailingButton:"absolute -top-1.5 -end-1.5 p-0 rounded-full border-2 border-bg"}},position:{inside:"",outside:""},dropzone:{true:"border-dashed data-[dragging=true]:bg-elevated/25"},interactive:{true:""},highlight:{true:""},multiple:{true:""},disabled:{true:"cursor-not-allowed opacity-75"}},compoundVariants:[{color:"primary",class:"focus-visible:outline-primary"},{color:"secondary",class:"focus-visible:outline-secondary"},{color:"success",class:"focus-visible:outline-success"},{color:"info",class:"focus-visible:outline-info"},{color:"warning",class:"focus-visible:outline-warning"},{color:"error",class:"focus-visible:outline-error"},{color:"primary",highlight:!0,class:"border-primary"},{color:"secondary",highlight:!0,class:"border-secondary"},{color:"success",highlight:!0,class:"border-success"},{color:"info",highlight:!0,class:"border-info"},{color:"warning",highlight:!0,class:"border-warning"},{color:"error",highlight:!0,class:"border-error"},{color:"neutral",class:"focus-visible:outline-inverted"},{color:"neutral",highlight:!0,class:"border-inverted"},{size:"xs",layout:"list",class:{fileTrailingButton:"-me-1"}},{size:"sm",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"md",layout:"list",class:{fileTrailingButton:"-me-1.5"}},{size:"lg",layout:"list",class:{fileTrailingButton:"-me-2"}},{size:"xl",layout:"list",class:{fileTrailingButton:"-me-2"}},{variant:"button",size:"xs",class:{base:"p-1"}},{variant:"button",size:"sm",class:{base:"p-1.5"}},{variant:"button",size:"md",class:{base:"p-1.5"}},{variant:"button",size:"lg",class:{base:"p-2"}},{variant:"button",size:"xl",class:{base:"p-2"}},{layout:"grid",multiple:!0,class:{files:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full",file:"p-0 aspect-square"}},{layout:"grid",multiple:!1,class:{file:"absolute inset-0 p-0"}},{interactive:!0,disabled:!1,class:"hover:bg-elevated/25"}],defaultVariants:{color:"primary",variant:"area",size:"md"}},xl=Object.assign({inheritAttrs:!1},{__name:"UFileUpload",props:vt({as:{type:null,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},icon:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},layout:{type:null,required:!1,default:"grid"},position:{type:null,required:!1,default:"outside"},highlight:{type:Boolean,required:!1},accept:{type:String,required:!1,default:"*"},multiple:{type:Boolean,required:!1,default:!1},reset:{type:Boolean,required:!1,default:!1},dropzone:{type:Boolean,required:!1,default:!0},interactive:{type:Boolean,required:!1,default:!0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},fileIcon:{type:null,required:!1},fileDelete:{type:[Boolean,Object],required:!1,default:!0},fileDeleteIcon:{type:null,required:!1},preview:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:null},modelModifiers:{}}),emits:vt(["change"],["update:modelValue"]),setup(l,{expose:t,emit:p}){const i=l,A=p,f=Qe(),k=$a(l,"modelValue"),w=Ye(),{t:J}=$t(),[N,H]=St(),{isDragging:S,open:d,inputRef:u,dropzoneRef:h}=bl({accept:i.accept,reset:i.reset,multiple:i.multiple,dropzone:i.dropzone,onUpdate:L}),{emitFormInput:_,emitFormChange:o,id:B,name:b,disabled:ee,ariaAttrs:$}=Tt(i),W=D(()=>i.multiple?"area":i.variant),se=D(()=>i.variant==="button"&&!i.multiple?"grid":i.layout),ne=D(()=>se.value==="grid"&&i.multiple?"inside":W.value==="button"?"outside":i.position),M=D(()=>Me({extend:Me(yl),...w.ui?.fileUpload||{}})({dropzone:i.dropzone,interactive:i.interactive,color:i.color,size:i.size,variant:W.value,layout:se.value,position:ne.value,multiple:i.multiple,highlight:i.highlight,disabled:i.disabled}));function R(P){return URL.createObjectURL(P)}function F(P){if(P===0)return"0B";const X=1024,z=["B","KB","MB","GB"],Z=Math.floor(Math.log(P)/Math.log(X)),ae=P/Math.pow(X,Z);return`${Z===0?ae.toString():ae.toFixed(0)}${z[Z]}`}function L(P,X=!1){if(i.multiple)if(X)k.value=P;else{const Z=k.value||[];k.value=[...Z,...P||[]]}else k.value=P?.[0];const z=new Event("change",{target:{value:k.value}});A("change",z),o(),_()}function T(P){if(!k.value)return;if(!i.multiple||P===void 0){L([],!0),h.value?.focus();return}const X=[...k.value];X.splice(P,1),L(X,!0),h.value?.focus()}return $e(k,P=>{(i.multiple?!P?.length:!P)&&u.value?.$el&&(u.value.$el.value="")}),t({inputRef:De(()=>u.value?.$el),dropzoneRef:h}),(P,X)=>(c(),O(ge,null,[n(e(N),null,{default:r(()=>[i.preview&&k.value&&(!Array.isArray(k.value)||k.value.length)?(c(),O(ge,{key:0},[G(P.$slots,"files-top",{files:k.value,open:e(d),removeFile:T}),g("div",{"data-slot":"files",class:V(M.value.files({class:i.ui?.files}))},[G(P.$slots,"files",{files:k.value},()=>[(c(!0),O(ge,null,xe(Array.isArray(k.value)?k.value:[k.value],(z,Z)=>(c(),O("div",{key:z.name,"data-slot":"file",class:V(M.value.file({class:i.ui?.file}))},[G(P.$slots,"file",{file:z,index:Z},()=>[G(P.$slots,"file-leading",{file:z,index:Z,ui:M.value},()=>[n(He,{as:{img:"img"},src:R(z),icon:l.fileIcon||e(w).ui.icons.file,size:i.size,"data-slot":"fileLeadingAvatar",class:V(M.value.fileLeadingAvatar({class:i.ui?.fileLeadingAvatar}))},null,8,["src","icon","size","class"])]),g("div",{"data-slot":"fileWrapper",class:V(M.value.fileWrapper({class:i.ui?.fileWrapper}))},[g("span",{"data-slot":"fileName",class:V(M.value.fileName({class:i.ui?.fileName}))},[G(P.$slots,"file-name",{file:z,index:Z},()=>[te(x(z.name),1)])],2),g("span",{"data-slot":"fileSize",class:V(M.value.fileSize({class:i.ui?.fileSize}))},[G(P.$slots,"file-size",{file:z,index:Z},()=>[te(x(F(z.size)),1)])],2)],2),G(P.$slots,"file-trailing",{file:z,index:Z,ui:M.value},()=>[l.fileDelete?(c(),C(Ge,de({key:0,color:"neutral"},{ref_for:!0},{...se.value==="grid"?{variant:"solid",size:"xs"}:{variant:"link",size:l.size},...typeof l.fileDelete=="object"?l.fileDelete:void 0},{"aria-label":e(J)("fileUpload.removeFile",{filename:z.name}),"trailing-icon":l.fileDeleteIcon||e(w).ui.icons.close,"data-slot":"fileTrailingButton",class:M.value.fileTrailingButton({class:i.ui?.fileTrailingButton}),onClick:We(ae=>T(Z),["stop","prevent"])}),null,16,["aria-label","trailing-icon","class","onClick"])):q("",!0)])])],2))),128))])],2),G(P.$slots,"files-bottom",{files:k.value,open:e(d),removeFile:T})],64)):q("",!0)]),_:3}),n(e(Le),{as:l.as,"data-slot":"root",class:V(M.value.root({class:[i.ui?.root,i.class]}))},{default:r(()=>[G(P.$slots,"default",{open:e(d),removeFile:T,ui:M.value},()=>[(c(),C(qt(W.value==="button"?"button":"div"),{ref_key:"dropzoneRef",ref:h,type:W.value==="button"?"button":void 0,role:W.value==="button"?void 0:"button","data-dragging":e(S),"data-slot":"base",class:V(M.value.base({class:i.ui?.base})),tabindex:l.interactive&&!e(ee)?0:-1,onClick:X[0]||(X[0]=z=>l.interactive&&!e(ee)&&e(d)()),onKeydown:X[1]||(X[1]=Ne(We(()=>{},["prevent"]),["space"])),onKeyup:X[2]||(X[2]=Ne(z=>l.interactive&&!e(ee)&&e(d)(),["enter","space"]))},{default:r(()=>[ne.value==="inside"?(c(),C(e(H),{key:0})):q("",!0),ne.value!=="inside"||(l.multiple?!k.value?.length:!k.value)?(c(),O("div",{key:1,"data-slot":"wrapper",class:V(M.value.wrapper({class:i.ui?.wrapper}))},[G(P.$slots,"leading",{ui:M.value},()=>[W.value==="button"?(c(),C(be,{key:0,name:l.icon||e(w).ui.icons.upload,"data-slot":"icon",class:V(M.value.icon({class:i.ui?.icon}))},null,8,["name","class"])):(c(),C(He,{key:1,icon:l.icon||e(w).ui.icons.upload,size:i.size,"data-slot":"avatar",class:V(M.value.avatar({class:i.ui?.avatar}))},null,8,["icon","size","class"]))]),W.value!=="button"?(c(),O(ge,{key:0},[l.label||f.label?(c(),O("div",{key:0,"data-slot":"label",class:V(M.value.label({class:i.ui?.label}))},[G(P.$slots,"label",{},()=>[te(x(l.label),1)])],2)):q("",!0),l.description||f.description?(c(),O("div",{key:1,"data-slot":"description",class:V(M.value.description({class:i.ui?.description}))},[G(P.$slots,"description",{},()=>[te(x(l.description),1)])],2)):q("",!0),f.actions?(c(),O("div",{key:2,"data-slot":"actions",class:V(M.value.actions({class:i.ui?.actions}))},[G(P.$slots,"actions",{files:k.value,open:e(d),removeFile:T})],2)):q("",!0)],64)):q("",!0)],2)):q("",!0)]),_:3},40,["type","role","data-dragging","class","tabindex"])),ne.value==="outside"?(c(),C(e(H),{key:0})):q("",!0)]),n(e(Sa),de({id:e(B),ref_key:"inputRef",ref:u,as:"input",type:"file",feature:"fully-hidden",name:e(b),accept:l.accept,multiple:l.multiple,required:l.required,disabled:e(ee)},{...P.$attrs,...e($)}),null,16,["id","name","accept","multiple","required","disabled"])]),_:3},8,["as","class"])],64))}}),At={__name:"UDropdownMenuContent",props:{items:{type:null,required:!1},portal:{type:[Boolean,String],required:!1,skipCheck:!0},sub:{type:Boolean,required:!1},labelKey:{type:null,required:!0},descriptionKey:{type:null,required:!0},checkedIcon:{type:null,required:!1},loadingIcon:{type:null,required:!1},externalIcon:{type:[Boolean,String],required:!1,skipCheck:!0},class:{type:null,required:!1},ui:{type:null,required:!0},uiOverride:{type:null,required:!1},loop:{type:Boolean,required:!1},side:{type:null,required:!1},sideOffset:{type:Number,required:!1},sideFlip:{type:Boolean,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(l,{emit:t}){const p=l,i=t,A=Qe(),{dir:f}=$t(),k=Ye(),w=Ta(De(()=>p.portal)),J=nt(qa(p,"sub","items","portal","labelKey","descriptionKey","checkedIcon","loadingIcon","externalIcon","class","ui","uiOverride"),i),N=()=>Ct(A,["default"]),[H,S]=St(),d=D(()=>f.value==="rtl"?k.ui.icons.chevronLeft:k.ui.icons.chevronRight),u=D(()=>p.items?.length?Fa(p.items)?p.items:[p.items]:[]);return(h,_)=>(c(),O(ge,null,[n(e(H),null,{default:r(({item:o,active:B,index:b})=>[G(h.$slots,o.slot||"item",{item:o,index:b,ui:l.ui},()=>[G(h.$slots,o.slot?`${o.slot}-leading`:"item-leading",{item:o,active:B,index:b,ui:l.ui},()=>[o.loading?(c(),C(be,{key:0,name:l.loadingIcon||e(k).ui.icons.loading,"data-slot":"itemLeadingIcon",class:V(l.ui.itemLeadingIcon({class:[l.uiOverride?.itemLeadingIcon,o.ui?.itemLeadingIcon],color:o?.color,loading:!0}))},null,8,["name","class"])):o.icon?(c(),C(be,{key:1,name:o.icon,"data-slot":"itemLeadingIcon",class:V(l.ui.itemLeadingIcon({class:[l.uiOverride?.itemLeadingIcon,o.ui?.itemLeadingIcon],color:o?.color,active:B}))},null,8,["name","class"])):o.avatar?(c(),C(He,de({key:2,size:o.ui?.itemLeadingAvatarSize||l.uiOverride?.itemLeadingAvatarSize||l.ui.itemLeadingAvatarSize()},o.avatar,{"data-slot":"itemLeadingAvatar",class:l.ui.itemLeadingAvatar({class:[l.uiOverride?.itemLeadingAvatar,o.ui?.itemLeadingAvatar],active:B})}),null,16,["size","class"])):q("",!0)]),e(ze)(o,p.labelKey)||A[o.slot?`${o.slot}-label`:"item-label"]||e(ze)(o,p.descriptionKey)||A[o.slot?`${o.slot}-description`:"item-description"]?(c(),O("span",{key:0,"data-slot":"itemWrapper",class:V(l.ui.itemWrapper({class:[l.uiOverride?.itemWrapper,o.ui?.itemWrapper]}))},[g("span",{"data-slot":"itemLabel",class:V(l.ui.itemLabel({class:[l.uiOverride?.itemLabel,o.ui?.itemLabel],active:B}))},[G(h.$slots,o.slot?`${o.slot}-label`:"item-label",{item:o,active:B,index:b},()=>[te(x(e(ze)(o,p.labelKey)),1)]),o.target==="_blank"&&l.externalIcon!==!1?(c(),C(be,{key:0,name:typeof l.externalIcon=="string"?l.externalIcon:e(k).ui.icons.external,"data-slot":"itemLabelExternalIcon",class:V(l.ui.itemLabelExternalIcon({class:[l.uiOverride?.itemLabelExternalIcon,o.ui?.itemLabelExternalIcon],color:o?.color,active:B}))},null,8,["name","class"])):q("",!0)],2),e(ze)(o,p.descriptionKey)?(c(),O("span",{key:0,"data-slot":"itemDescription",class:V(l.ui.itemDescription({class:[l.uiOverride?.itemDescription,o.ui?.itemDescription]}))},[G(h.$slots,o.slot?`${o.slot}-description`:"item-description",{item:o,active:B,index:b},()=>[te(x(e(ze)(o,p.descriptionKey)),1)])],2)):q("",!0)],2)):q("",!0),g("span",{"data-slot":"itemTrailing",class:V(l.ui.itemTrailing({class:[l.uiOverride?.itemTrailing,o.ui?.itemTrailing]}))},[G(h.$slots,o.slot?`${o.slot}-trailing`:"item-trailing",{item:o,active:B,index:b,ui:l.ui},()=>[o.children?.length?(c(),C(be,{key:0,name:d.value,"data-slot":"itemTrailingIcon",class:V(l.ui.itemTrailingIcon({class:[l.uiOverride?.itemTrailingIcon,o.ui?.itemTrailingIcon],color:o?.color,active:B}))},null,8,["name","class"])):o.kbds?.length?(c(),O("span",{key:1,"data-slot":"itemTrailingKbds",class:V(l.ui.itemTrailingKbds({class:[l.uiOverride?.itemTrailingKbds,o.ui?.itemTrailingKbds]}))},[(c(!0),O(ge,null,xe(o.kbds,(ee,$)=>(c(),C(ts,de({key:$,size:o.ui?.itemTrailingKbdsSize||l.uiOverride?.itemTrailingKbdsSize||l.ui.itemTrailingKbdsSize()},{ref_for:!0},typeof ee=="string"?{value:ee}:ee),null,16,["size"]))),128))],2)):q("",!0)]),n(e(me).ItemIndicator,{"as-child":""},{default:r(()=>[n(be,{name:l.checkedIcon||e(k).ui.icons.check,"data-slot":"itemTrailingIcon",class:V(l.ui.itemTrailingIcon({class:[l.uiOverride?.itemTrailingIcon,o.ui?.itemTrailingIcon],color:o?.color}))},null,8,["name","class"])]),_:2},1024)],2)])]),_:3}),n(e(me).Portal,lt(ot(e(w))),{default:r(()=>[(c(),C(qt(l.sub?e(me).SubContent:e(me).Content),de({"data-slot":"content",class:l.ui.content({class:[l.uiOverride?.content,p.class]})},e(J)),{default:r(()=>[G(h.$slots,"content-top",{sub:l.sub??!1}),g("div",{role:"presentation","data-slot":"viewport",class:V(l.ui.viewport({class:l.uiOverride?.viewport}))},[(c(!0),O(ge,null,xe(u.value,(o,B)=>(c(),C(e(me).Group,{key:`group-${B}`,"data-slot":"group",class:V(l.ui.group({class:l.uiOverride?.group}))},{default:r(()=>[(c(!0),O(ge,null,xe(o,(b,ee)=>(c(),O(ge,{key:`group-${B}-${ee}`},[b.type==="label"?(c(),C(e(me).Label,{key:0,"data-slot":"label",class:V(l.ui.label({class:[l.uiOverride?.label,b.ui?.label,b.class]}))},{default:r(()=>[n(e(S),{item:b,index:ee},null,8,["item","index"])]),_:2},1032,["class"])):b.type==="separator"?(c(),C(e(me).Separator,{key:1,"data-slot":"separator",class:V(l.ui.separator({class:[l.uiOverride?.separator,b.ui?.separator,b.class]}))},null,8,["class"])):b?.children?.length?(c(),C(e(me).Sub,{key:2,open:b.open,"default-open":b.defaultOpen},{default:r(()=>[n(e(me).SubTrigger,{as:"button",type:"button",disabled:b.disabled,"text-value":e(ze)(b,p.labelKey),"data-slot":"item",class:V(l.ui.item({class:[l.uiOverride?.item,b.ui?.item,b.class],color:b?.color}))},{default:r(()=>[n(e(S),{item:b,index:ee},null,8,["item","index"])]),_:2},1032,["disabled","text-value","class"]),n(At,de({sub:"",class:b.ui?.content,ui:l.ui,"ui-override":l.uiOverride,portal:l.portal,items:b.children,align:"start","align-offset":-4,"side-offset":3,"label-key":l.labelKey,"description-key":l.descriptionKey,"checked-icon":l.checkedIcon,"loading-icon":l.loadingIcon,"external-icon":l.externalIcon},{ref_for:!0},b.content),Ft({_:2},[xe(N(),($,W)=>({name:W,fn:r(se=>[G(h.$slots,W,de({ref_for:!0},se))])}))]),1040,["class","ui","ui-override","portal","items","label-key","description-key","checked-icon","loading-icon","external-icon"])]),_:2},1032,["open","default-open"])):b.type==="checkbox"?(c(),C(e(me).CheckboxItem,{key:3,"model-value":b.checked,disabled:b.disabled,"text-value":e(ze)(b,p.labelKey),"data-slot":"item",class:V(l.ui.item({class:[l.uiOverride?.item,b.ui?.item,b.class],color:b?.color})),"onUpdate:modelValue":b.onUpdateChecked,onSelect:b.onSelect},{default:r(()=>[n(e(S),{item:b,index:ee},null,8,["item","index"])]),_:2},1032,["model-value","disabled","text-value","class","onUpdate:modelValue","onSelect"])):(c(),C(e(me).Item,{key:4,"as-child":"",disabled:b.disabled,"text-value":e(ze)(b,p.labelKey),onSelect:b.onSelect},{default:r(()=>[n(Ca,de({ref_for:!0},e(Ma)(b),{custom:""}),{default:r(({active:$,...W})=>[n(La,de({ref_for:!0},W,{"data-slot":"item",class:l.ui.item({class:[l.uiOverride?.item,b.ui?.item,b.class],color:b?.color,active:$})}),{default:r(()=>[n(e(S),{item:b,active:$,index:ee},null,8,["item","active","index"])]),_:2},1040,["class"])]),_:2},1040)]),_:2},1032,["disabled","text-value","onSelect"]))],64))),128))]),_:2},1032,["class"]))),128))],2),G(h.$slots,"default"),G(h.$slots,"content-bottom",{sub:l.sub??!1})]),_:3},16,["class"]))]),_:3},16)],64))}},wl={slots:{content:"min-w-32 bg-default shadow-lg rounded-md ring ring-default overflow-hidden data-[state=open]:animate-[scale-in_100ms_ease-out] data-[state=closed]:animate-[scale-out_100ms_ease-in] origin-(--reka-dropdown-menu-content-transform-origin) flex flex-col",viewport:"relative divide-y divide-default scroll-py-1 overflow-y-auto flex-1",arrow:"fill-default",group:"p-1 isolate",label:"w-full flex items-center font-semibold text-highlighted",separator:"-mx-1 my-1 h-px bg-border",item:"group relative w-full flex items-start select-none outline-none before:absolute before:z-[-1] before:inset-px before:rounded-md data-disabled:cursor-not-allowed data-disabled:opacity-75",itemLeadingIcon:"shrink-0",itemLeadingAvatar:"shrink-0",itemLeadingAvatarSize:"",itemTrailing:"ms-auto inline-flex gap-1.5 items-center",itemTrailingIcon:"shrink-0",itemTrailingKbds:"hidden lg:inline-flex items-center shrink-0",itemTrailingKbdsSize:"",itemWrapper:"flex-1 flex flex-col text-start min-w-0",itemLabel:"truncate",itemDescription:"truncate text-muted",itemLabelExternalIcon:"inline-block size-3 align-top text-dimmed"},variants:{color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},active:{true:{item:"text-highlighted before:bg-elevated",itemLeadingIcon:"text-default"},false:{item:["text-default data-highlighted:text-highlighted data-[state=open]:text-highlighted data-highlighted:before:bg-elevated/50 data-[state=open]:before:bg-elevated/50","transition-colors before:transition-colors"],itemLeadingIcon:["text-dimmed group-data-highlighted:text-default group-data-[state=open]:text-default","transition-colors"]}},loading:{true:{itemLeadingIcon:"animate-spin"}},size:{xs:{label:"p-1 text-xs gap-1",item:"p-1 text-xs gap-1",itemLeadingIcon:"size-4",itemLeadingAvatarSize:"3xs",itemTrailingIcon:"size-4",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"sm"},sm:{label:"p-1.5 text-xs gap-1.5",item:"p-1.5 text-xs gap-1.5",itemLeadingIcon:"size-4",itemLeadingAvatarSize:"3xs",itemTrailingIcon:"size-4",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"sm"},md:{label:"p-1.5 text-sm gap-1.5",item:"p-1.5 text-sm gap-1.5",itemLeadingIcon:"size-5",itemLeadingAvatarSize:"2xs",itemTrailingIcon:"size-5",itemTrailingKbds:"gap-0.5",itemTrailingKbdsSize:"md"},lg:{label:"p-2 text-sm gap-2",item:"p-2 text-sm gap-2",itemLeadingIcon:"size-5",itemLeadingAvatarSize:"2xs",itemTrailingIcon:"size-5",itemTrailingKbds:"gap-1",itemTrailingKbdsSize:"md"},xl:{label:"p-2 text-base gap-2",item:"p-2 text-base gap-2",itemLeadingIcon:"size-6",itemLeadingAvatarSize:"xs",itemTrailingIcon:"size-6",itemTrailingKbds:"gap-1",itemTrailingKbdsSize:"lg"}}},compoundVariants:[{color:"primary",active:!1,class:{item:"text-primary data-highlighted:text-primary data-highlighted:before:bg-primary/10 data-[state=open]:before:bg-primary/10",itemLeadingIcon:"text-primary/75 group-data-highlighted:text-primary group-data-[state=open]:text-primary"}},{color:"secondary",active:!1,class:{item:"text-secondary data-highlighted:text-secondary data-highlighted:before:bg-secondary/10 data-[state=open]:before:bg-secondary/10",itemLeadingIcon:"text-secondary/75 group-data-highlighted:text-secondary group-data-[state=open]:text-secondary"}},{color:"success",active:!1,class:{item:"text-success data-highlighted:text-success data-highlighted:before:bg-success/10 data-[state=open]:before:bg-success/10",itemLeadingIcon:"text-success/75 group-data-highlighted:text-success group-data-[state=open]:text-success"}},{color:"info",active:!1,class:{item:"text-info data-highlighted:text-info data-highlighted:before:bg-info/10 data-[state=open]:before:bg-info/10",itemLeadingIcon:"text-info/75 group-data-highlighted:text-info group-data-[state=open]:text-info"}},{color:"warning",active:!1,class:{item:"text-warning data-highlighted:text-warning data-highlighted:before:bg-warning/10 data-[state=open]:before:bg-warning/10",itemLeadingIcon:"text-warning/75 group-data-highlighted:text-warning group-data-[state=open]:text-warning"}},{color:"error",active:!1,class:{item:"text-error data-highlighted:text-error data-highlighted:before:bg-error/10 data-[state=open]:before:bg-error/10",itemLeadingIcon:"text-error/75 group-data-highlighted:text-error group-data-[state=open]:text-error"}},{color:"primary",active:!0,class:{item:"text-primary before:bg-primary/10",itemLeadingIcon:"text-primary"}},{color:"secondary",active:!0,class:{item:"text-secondary before:bg-secondary/10",itemLeadingIcon:"text-secondary"}},{color:"success",active:!0,class:{item:"text-success before:bg-success/10",itemLeadingIcon:"text-success"}},{color:"info",active:!0,class:{item:"text-info before:bg-info/10",itemLeadingIcon:"text-info"}},{color:"warning",active:!0,class:{item:"text-warning before:bg-warning/10",itemLeadingIcon:"text-warning"}},{color:"error",active:!0,class:{item:"text-error before:bg-error/10",itemLeadingIcon:"text-error"}}],defaultVariants:{size:"md"}},kl={__name:"UDropdownMenu",props:{size:{type:null,required:!1},items:{type:null,required:!1},checkedIcon:{type:null,required:!1},loadingIcon:{type:null,required:!1},externalIcon:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},content:{type:Object,required:!1},arrow:{type:[Boolean,Object],required:!1},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},labelKey:{type:null,required:!1,default:"label"},descriptionKey:{type:null,required:!1,default:"description"},disabled:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},defaultOpen:{type:Boolean,required:!1},open:{type:Boolean,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(l,{emit:t}){const p=l,i=t,A=Qe(),f=Ye(),k=nt(Mt(p,"defaultOpen","open","modal"),i),w=De(()=>Pa(p.content,{side:"bottom",sideOffset:8,collisionPadding:8})),J=De(()=>p.arrow),N=()=>Ct(A,["default"]),H=D(()=>Me({extend:Me(wl),...f.ui?.dropdownMenu||{}})({size:p.size}));return(S,d)=>(c(),C(e(ns),lt(ot(e(k))),{default:r(({open:u})=>[A.default?(c(),C(e(is),{key:0,"as-child":"",class:V(p.class),disabled:l.disabled},{default:r(()=>[G(S.$slots,"default",{open:u})]),_:2},1032,["class","disabled"])):q("",!0),n(At,de({class:H.value.content({class:[!A.default&&p.class,p.ui?.content]}),ui:H.value,"ui-override":p.ui},w.value,{items:l.items,portal:l.portal,"label-key":l.labelKey,"description-key":l.descriptionKey,"checked-icon":l.checkedIcon,"loading-icon":l.loadingIcon,"external-icon":l.externalIcon}),Ft({default:r(()=>[l.arrow?(c(),C(e(rs),de({key:0},J.value,{"data-slot":"arrow",class:H.value.arrow({class:p.ui?.arrow})}),null,16,["class"])):q("",!0)]),_:2},[xe(N(),(h,_)=>({name:_,fn:r(o=>[G(S.$slots,_,lt(ot(o)))])}))]),1040,["class","ui","ui-override","items","portal","label-key","description-key","checked-icon","loading-icon","external-icon"])]),_:3},16))}},Il={slots:{root:["relative inline-flex items-center","flex-wrap"],base:["rounded-md","transition-colors"],leading:"absolute inset-y-0 start-0 flex items-center",leadingIcon:"shrink-0 text-dimmed",leadingAvatar:"shrink-0",leadingAvatarSize:"",trailing:"absolute inset-y-0 end-0 flex items-center",trailingIcon:"shrink-0 text-dimmed",item:'px-1.5 py-0.5 rounded-sm font-medium inline-flex items-center gap-0.5 ring ring-inset ring-accented bg-elevated text-default data-disabled:cursor-not-allowed data-disabled:opacity-75 wrap-anywhere data-[state="active"]:bg-accented',itemText:"",itemDelete:["inline-flex items-center rounded-xs text-dimmed hover:text-default hover:bg-accented/75 disabled:pointer-events-none","transition-colors"],itemDeleteIcon:"shrink-0",input:"flex-1 border-0 bg-transparent placeholder:text-dimmed focus:outline-none disabled:cursor-not-allowed disabled:opacity-75"},variants:{fieldGroup:{horizontal:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},size:{xs:{base:"px-2 py-1 text-xs gap-1",leading:"ps-2",trailing:"pe-2",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4",item:"text-[10px]/3",itemDeleteIcon:"size-3"},sm:{base:"px-2.5 py-1.5 text-xs gap-1.5",leading:"ps-2.5",trailing:"pe-2.5",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4",item:"text-[10px]/3",itemDeleteIcon:"size-3"},md:{base:"px-2.5 py-1.5 text-sm gap-1.5",leading:"ps-2.5",trailing:"pe-2.5",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5",item:"text-xs",itemDeleteIcon:"size-3.5"},lg:{base:"px-3 py-2 text-sm gap-2",leading:"ps-3",trailing:"pe-3",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5",item:"text-xs",itemDeleteIcon:"size-3.5"},xl:{base:"px-3 py-2 text-base gap-2",leading:"ps-3",trailing:"pe-3",leadingIcon:"size-6",leadingAvatarSize:"xs",trailingIcon:"size-6",item:"text-sm",itemDeleteIcon:"size-4"}},variant:{outline:"text-highlighted bg-default ring ring-inset ring-accented",soft:"text-highlighted bg-elevated/50 hover:bg-elevated has-focus:bg-elevated disabled:bg-elevated/50",subtle:"text-highlighted bg-elevated ring ring-inset ring-accented",ghost:"text-highlighted bg-transparent hover:bg-elevated has-focus:bg-elevated disabled:bg-transparent dark:disabled:bg-transparent",none:"text-highlighted bg-transparent"},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},leading:{true:""},trailing:{true:""},loading:{true:""},highlight:{true:""},type:{file:"file:me-1.5 file:font-medium file:text-muted file:outline-none"}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-primary"},{color:"secondary",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-secondary"},{color:"success",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-success"},{color:"info",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-info"},{color:"warning",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-warning"},{color:"error",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-error"},{color:"primary",highlight:!0,class:"ring ring-inset ring-primary"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-secondary"},{color:"success",highlight:!0,class:"ring ring-inset ring-success"},{color:"info",highlight:!0,class:"ring ring-inset ring-info"},{color:"warning",highlight:!0,class:"ring ring-inset ring-warning"},{color:"error",highlight:!0,class:"ring ring-inset ring-error"},{color:"neutral",variant:["outline","subtle"],class:"has-focus-visible:ring-2 has-focus-visible:ring-inset has-focus-visible:ring-inverted"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-inverted"},{leading:!0,size:"xs",class:"ps-7"},{leading:!0,size:"sm",class:"ps-8"},{leading:!0,size:"md",class:"ps-9"},{leading:!0,size:"lg",class:"ps-10"},{leading:!0,size:"xl",class:"ps-11"},{trailing:!0,size:"xs",class:"pe-7"},{trailing:!0,size:"sm",class:"pe-8"},{trailing:!0,size:"md",class:"pe-9"},{trailing:!0,size:"lg",class:"pe-10"},{trailing:!0,size:"xl",class:"pe-11"},{loading:!0,leading:!0,class:{leadingIcon:"animate-spin"}},{loading:!0,leading:!1,trailing:!0,class:{trailingIcon:"animate-spin"}}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},zl=Object.assign({inheritAttrs:!1},{__name:"UInputTags",props:{as:{type:null,required:!1},placeholder:{type:String,required:!1},maxLength:{type:Number,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},autofocus:{type:Boolean,required:!1},autofocusDelay:{type:Number,required:!1,default:0},deleteIcon:{type:null,required:!1},highlight:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},modelValue:{type:[Array,null],required:!1},defaultValue:{type:Array,required:!1},addOnPaste:{type:Boolean,required:!1},addOnTab:{type:Boolean,required:!1},addOnBlur:{type:Boolean,required:!1},duplicate:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},delimiter:{type:null,required:!1},max:{type:Number,required:!1},id:{type:String,required:!1},convertValue:{type:Function,required:!1},displayValue:{type:Function,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},leading:{type:Boolean,required:!1},leadingIcon:{type:null,required:!1},trailing:{type:Boolean,required:!1},trailingIcon:{type:null,required:!1},loading:{type:Boolean,required:!1},loadingIcon:{type:null,required:!1}},emits:["change","blur","focus","update:modelValue","invalid","addTag","removeTag"],setup(l,{expose:t,emit:p}){const i=l,A=p,f=Qe(),k=Ye(),w=nt(Mt(i,"as","addOnPaste","addOnTab","addOnBlur","duplicate","delimiter","max","convertValue","displayValue","required"),A),{emitFormBlur:J,emitFormFocus:N,emitFormChange:H,emitFormInput:S,size:d,color:u,id:h,name:_,highlight:o,disabled:B,ariaAttrs:b}=Tt(i),{orientation:ee,size:$}=Ra(i),{isLeading:W,isTrailing:se,leadingIconName:ne,trailingIconName:M}=Aa(i),R=D(()=>$.value||d.value),F=D(()=>Me({extend:Me(Il),...k.ui?.inputTags||{}})({color:u.value,variant:i.variant,size:R?.value,loading:i.loading,highlight:o.value,leading:W.value||!!i.avatar||!!f.leading,trailing:se.value||!!f.trailing,fieldGroup:ee.value})),L=Lt("inputRef");function T(){i.autofocus&&L.value?.$el?.focus()}it(()=>{setTimeout(()=>{T()},i.autofocusDelay)});function P(Z){if(Da(i.modelValue)===Z)return;const ae=new Event("change",{target:{value:Z}});A("change",ae),H(),S()}function X(Z){A("blur",Z),J()}function z(Z){A("focus",Z),N()}return t({inputRef:De(()=>L.value?.$el)}),(Z,ae)=>(c(),C(e(_s),de({id:e(h),"model-value":l.modelValue,"default-value":l.defaultValue,"data-slot":"root",class:F.value.root({class:[F.value.base({class:i.ui?.base}),i.ui?.root,i.class]})},e(w),{name:e(_),disabled:e(B),"onUpdate:modelValue":P}),{default:r(({modelValue:K})=>[(c(!0),O(ge,null,xe(K,(ue,ke)=>(c(),C(e(Fs),{key:ke,value:ue,"data-slot":"item",class:V(F.value.item({class:[i.ui?.item]}))},{default:r(()=>[n(e(Ps),{"data-slot":"itemText",class:V(F.value.itemText({class:[i.ui?.itemText]}))},{default:r(()=>[f["item-text"]?G(Z.$slots,"item-text",{key:0,item:ue,index:ke,ui:F.value}):q("",!0)]),_:2},1032,["class"]),n(e(Ms),{"data-slot":"itemDelete",class:V(F.value.itemDelete({class:[i.ui?.itemDelete]})),disabled:e(B)},{default:r(()=>[G(Z.$slots,"item-delete",{item:ue,index:ke,ui:F.value},()=>[n(be,{name:l.deleteIcon||e(k).ui.icons.close,"data-slot":"itemDeleteIcon",class:V(F.value.itemDeleteIcon({class:[i.ui?.itemDeleteIcon]}))},null,8,["name","class"])])]),_:2},1032,["class","disabled"])]),_:2},1032,["value","class"]))),128)),n(e(Ss),de({ref_key:"inputRef",ref:L},{...Z.$attrs,...e(b)},{placeholder:l.placeholder,"max-length":l.maxLength,"data-slot":"input",class:F.value.input({class:i.ui?.input}),onBlur:X,onFocus:z}),null,16,["placeholder","max-length","class"]),G(Z.$slots,"default",{ui:F.value}),e(W)||l.avatar||f.leading?(c(),O("span",{key:0,"data-slot":"leading",class:V(F.value.leading({class:i.ui?.leading}))},[G(Z.$slots,"leading",{ui:F.value},()=>[e(W)&&e(ne)?(c(),C(be,{key:0,name:e(ne),"data-slot":"leadingIcon",class:V(F.value.leadingIcon({class:i.ui?.leadingIcon}))},null,8,["name","class"])):l.avatar?(c(),C(He,de({key:1,size:i.ui?.leadingAvatarSize||F.value.leadingAvatarSize()},l.avatar,{"data-slot":"leadingAvatar",class:F.value.leadingAvatar({class:i.ui?.leadingAvatar})}),null,16,["size","class"])):q("",!0)])],2)):q("",!0),e(se)||f.trailing?(c(),O("span",{key:1,"data-slot":"trailing",class:V(F.value.trailing({class:i.ui?.trailing}))},[G(Z.$slots,"trailing",{ui:F.value},()=>[e(M)?(c(),C(be,{key:0,name:e(M),"data-slot":"trailingIcon",class:V(F.value.trailingIcon({class:i.ui?.trailingIcon}))},null,8,["name","class"])):q("",!0)])],2)):q("",!0)]),_:3},16,["id","model-value","default-value","class","name","disabled"]))}}),_l={key:0,class:"absolute inset-0 pointer-events-none flex items-center justify-center text-sm text-neutral-600 dark:text-neutral-400"},$l=we({__name:"LocationPicker",props:{modelValue:{default:null},zoom:{default:4},class:{default:void 0}},emits:["update:modelValue","pick"],setup(l,{emit:t}){const p=l,i=t,A=j(null),f=j(null),{locale:k}=Pt();let w=null;const J=d=>{d?(f.value=[d.longitude,d.latitude],A.value&&A.value.flyTo?.({center:f.value,zoom:Math.max(p.zoom??4,4),essential:!0})):f.value=null};$e(()=>p.modelValue,d=>{J(d??null)},{immediate:!0});const N=(d,u,h=!0)=>{f.value=[u,d],i("update:modelValue",{latitude:d,longitude:u}),h&&i("pick",{latitude:d,longitude:u})},H=d=>{const u=d?.lngLat||d?.latlng||(Array.isArray(d)?{lng:d[0],lat:d[1]}:null);if(!u)return;const h=typeof u.lat=="number"?u.lat:u.latitude??u[1],_=typeof u.lng=="number"?u.lng:u.longitude??u[0];typeof h!="number"||typeof _!="number"||N(h,_)},S=d=>{if(A.value=d,f.value){const h=d;h.setCenter?.(f.value),h.setZoom?.(Math.max(p.zoom??4,4))}const u=d;typeof u.on=="function"&&(w=h=>H(h),u.on("click",w))};return Ua(()=>{if(A.value&&w){const d=A.value;typeof d.off=="function"&&d.off("click",w)}}),(d,u)=>{const h=xs,_=Ba;return c(),O("div",{class:V(["relative w-full h-64 rounded-xl overflow-hidden",d.$props.class])},[n(_,{class:"w-full h-full","map-id":"photo-location-picker",center:f.value??void 0,zoom:f.value?Math.max(d.$props.zoom??4,4):d.$props.zoom??2,interactive:!0,language:e(k),onLoad:S},{default:r(()=>[f.value?(c(),C(h,{key:0,lnglat:f.value},{marker:r(()=>[...u[0]||(u[0]=[g("div",{class:"relative"},[g("div",{class:"absolute inset-0 animate-ping rounded-full bg-primary/40"}),g("div",{class:"relative size-4 rounded-full bg-primary border-2 border-white shadow"})],-1)])]),_:1},8,["lnglat"])):q("",!0)]),_:1},8,["center","zoom","language"]),f.value?q("",!0):(c(),O("div",_l,[G(d.$slots,"empty")]))],2)}}}),Sl=Object.assign($l,{__name:"MapLocationPicker"});function Tl(l={}){const{timeout:t=0,withCredentials:p=!1,headers:i={},speedSampleSize:A=5,maxRetries:f=3,retryDelay:k=1e3}=l,w=j({status:"idle",progress:{loaded:0,total:0,percentage:0}});let J=null;const N=[],H=R=>{const F=Date.now();if(N.push({timestamp:F,loaded:R}),N.length>A&&N.shift(),N.length<2)return{speed:0};const L=N[0],T=N[N.length-1];if(!L||!T)return{speed:0};const P=(T.timestamp-L.timestamp)/1e3,X=T.loaded-L.loaded,z=P>0?X/P:0,ae=w.value.progress.total-R,K=z>0?ae/z:void 0;return{speed:z,timeRemaining:K}},S=R=>{w.value={...w.value,...R}},d=(R,F)=>{const L=F>0?Math.round(R/F*100):0,{speed:T,timeRemaining:P}=H(R);S({progress:{loaded:R,total:F,percentage:L,speed:T,timeRemaining:P}})},u=()=>{N.length=0,S({status:"idle",progress:{loaded:0,total:0,percentage:0},error:void 0,startTime:void 0,endTime:void 0})},h=async(R,F,L={},T=1)=>(T===1&&u(),new Promise((P,X)=>{J=new XMLHttpRequest;const z=J;t>0&&(z.timeout=t),z.withCredentials=p;const Z=Date.now();S({status:"uploading",startTime:Z}),L.onStatusChange?.("uploading"),z.upload.addEventListener("progress",ae=>{ae.lengthComputable&&(d(ae.loaded,ae.total),L.onProgress?.(w.value.progress))}),z.addEventListener("load",()=>{const ae=Date.now();S({status:"success",endTime:ae}),L.onStatusChange?.("success"),L.onSuccess?.(z),P(z)}),z.addEventListener("error",()=>{const ae=Date.now();let K="";z.status===0?K="网络连接失败":z.status>=400&&z.status<500?K=`客户端错误 (${z.status})`:z.status>=500?K=`服务器错误 (${z.status})`:K=`网络错误 (状态码: ${z.status})`,T<f&&(z.status===0||z.status>=500||z.status===429)?(S({status:"error",error:`${K} (尝试 ${T}/${f})`,endTime:ae}),L.onRetry?.(T,f),setTimeout(()=>{h(R,F,L,T+1).then(P).catch(X)},k*T)):(S({status:"error",error:K,endTime:ae}),L.onStatusChange?.("error"),L.onError?.(K,z),X(new Error(K)))}),z.addEventListener("timeout",()=>{const ae=Date.now(),K=`上传超时 (${t}ms)`;T<f?(S({status:"error",error:`${K} (尝试 ${T}/${f})`,endTime:ae}),L.onRetry?.(T,f),setTimeout(()=>{h(R,F,L,T+1).then(P).catch(X)},k*T)):(S({status:"error",error:K,endTime:ae}),L.onStatusChange?.("error"),L.onError?.(K,z),X(new Error(K)))}),z.addEventListener("abort",()=>{const ae=Date.now();S({status:"aborted",endTime:ae}),L.onStatusChange?.("aborted"),L.onAbort?.(),X(new Error("上传已中止"))}),z.addEventListener("readystatechange",()=>{if(z.readyState===XMLHttpRequest.DONE){if(z.status>=200&&z.status<300)return;if(z.status>=400){const ae=Date.now();let K="";switch(z.status){case 400:K="请求格式错误";break;case 401:K="未授权访问";break;case 403:K="访问被拒绝";break;case 404:K="上传接口不存在";break;case 409:K="文件冲突";break;case 413:K="文件过大";break;case 415:K="不支持的文件类型";break;case 429:K="上传频率过高";break;case 500:K="服务器内部错误";break;case 502:case 503:case 504:K="服务器暂时不可用";break;default:K=`HTTP 错误: ${z.status}`}try{const ue=z.responseText;if(ue)try{const ke=JSON.parse(ue);ke.data?.message&&(K=ke.data.title||K)}catch{K+=` - ${ue}`}}catch{}S({status:"error",error:K,endTime:ae}),L.onStatusChange?.("error"),L.onError?.(K,z)}}}),z.open("PUT",F),z.setRequestHeader("Content-Type",R.type||"application/octet-stream"),Object.entries(i).forEach(([ae,K])=>{z.setRequestHeader(ae,K)}),z.send(R)})),_=()=>{J&&w.value.status==="uploading"&&J.abort()},o=R=>{if(R===0)return"0 B";const F=1024,L=["B","KB","MB","GB"],T=Math.floor(Math.log(R)/Math.log(F));return parseFloat((R/Math.pow(F,T)).toFixed(2))+" "+L[T]},B=R=>{if(!isFinite(R)||R<0)return"计算中...";const F=Math.floor(R/3600),L=Math.floor(R%3600/60),T=Math.floor(R%60);return F>0?`${F}:${L.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`:L>0?`${L}:${T.toString().padStart(2,"0")}`:`${T}秒`},b=D(()=>w.value.status==="uploading"),ee=D(()=>w.value.status==="idle"),$=D(()=>w.value.status==="success"),W=D(()=>w.value.status==="error"),se=D(()=>w.value.status==="aborted"),ne=D(()=>b.value&&J!==null),M=D(()=>{const{loaded:R,total:F,percentage:L,speed:T,timeRemaining:P}=w.value.progress;return{percentage:L,loadedText:o(R),totalText:o(F),speedText:T?`${o(T)}/s`:"",timeRemainingText:P?B(P):"",progressText:`${o(R)} / ${o(F)} (${L}%)`}});try{rt(()=>{_(),J=null})}catch{}return{uploadStatus:Va(w),isUploading:b,isIdle:ee,isSuccess:$,isError:W,isAborted:se,canAbort:ne,formattedProgress:M,uploadFile:h,abortUpload:_,resetStatus:u,formatBytes:o,formatTime:B}}const ql={class:"flex flex-col gap-3"},Fl={class:"relative overflow-hidden rounded-3xl border border-neutral-200/80 bg-linear-to-br from-white via-white to-neutral-50 shadow-sm transition dark:border-neutral-800/70 dark:from-neutral-900 dark:via-neutral-900/80 dark:to-neutral-900"},Cl={class:"relative flex flex-col gap-6 p-5 sm:p-8"},Ml={class:"flex flex-col gap-5 sm:flex-row sm:items-center sm:justify-between"},Ll={class:"space-y-4"},Pl={class:"flex items-center gap-3"},Rl={class:"flex size-12 items-center justify-center rounded-2xl bg-primary-500/10 text-primary-600 dark:bg-primary-500/15 dark:text-primary-300"},Al={class:"text-lg font-semibold text-neutral-800 dark:text-neutral-100"},Dl={class:"flex flex-wrap items-center gap-1 text-xs font-medium text-neutral-500 dark:text-neutral-400"},Ul={class:"flex gap-2 items-center"},Bl={class:"flex w-full flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Vl={class:"flex flex-col gap-1 text-sm text-neutral-500 dark:text-neutral-400"},Ol={class:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row"},Kl={class:"flex flex-row sm:items-center justify-between gap-3 sm:gap-0 p-3 sm:p-4 bg-neutral-50 dark:bg-neutral-900/50 border border-neutral-200 dark:border-neutral-700 rounded-lg"},El={class:"flex items-center gap-2"},jl={class:"font-medium text-neutral-700 dark:text-neutral-300 hidden sm:inline"},Nl={class:"flex items-center gap-1 sm:gap-2"},Hl={class:"hidden sm:inline"},Wl={class:"sm:hidden"},Gl={class:"hidden sm:inline"},Ql={class:"sm:hidden"},Yl={class:"flex items-center gap-2"},Xl={class:"hidden sm:inline"},Zl={class:"hidden sm:inline"},Jl={class:"border border-neutral-300 dark:border-neutral-800 rounded overflow-hidden"},eo={class:"flex justify-end"},to={class:"px-4 py-4 border-t border-neutral-200 dark:border-neutral-700"},ao={class:"text-sm text-neutral-600 dark:text-neutral-400 flex items-center gap-2"},so={class:"leading-6"},lo={key:0,class:"flex items-center gap-1 sm:gap-2"},oo={class:"p-6 space-y-6"},io={class:"space-y-1"},ro={class:"text-lg font-semibold text-neutral-800 dark:text-neutral-100"},no={class:"text-sm text-neutral-500 dark:text-neutral-400"},uo={key:0,class:"text-xs text-neutral-500 dark:text-neutral-500"},co={class:"space-y-2"},po={class:"text-xs text-neutral-500 dark:text-neutral-400"},go={class:"flex items-center justify-between space-y-2"},fo={class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},mo={class:"flex items-center gap-3"},ho={key:0,class:"text-sm text-neutral-600 dark:text-neutral-400"},vo={key:1,class:"text-sm text-neutral-500 dark:text-neutral-500"},bo={class:"space-y-3"},yo={class:"flex items-center justify-between"},xo={class:"text-sm font-medium text-neutral-700 dark:text-neutral-200"},wo={class:"px-3 py-2 rounded-full bg-white/80 text-neutral-600 dark:bg-neutral-900/80 dark:text-neutral-200 shadow"},ko={class:"text-xs text-neutral-500 dark:text-neutral-400 flex items-center gap-2"},Io={key:0},zo={key:1},_o={class:"flex items-center justify-end gap-2 pt-4 border-t border-neutral-200 dark:border-neutral-800"},$o={class:"p-6 space-y-4"},So={class:"flex items-start gap-3"},To={class:"space-y-2"},qo={class:"text-lg font-semibold"},Fo={class:"text-sm text-neutral-600 dark:text-neutral-400"},Co={class:"text-sm text-error-500 dark:text-error-400"},Mo={class:"flex justify-end gap-2"},Lo={class:"flex items-center justify-center w-full",style:{"max-height":"calc(100vh - 12rem)"}},Po={class:"w-full max-w-2xl rounded-lg overflow-hidden"},je=256,mi=we({__name:"photos",setup(l){const{t}=Pt(),p=bt,i={thumbnailUrl:t("dashboard.photos.table.columns.thumbnail.title"),id:t("dashboard.photos.table.columns.id"),title:t("dashboard.photos.table.columns.title"),tags:t("dashboard.photos.table.columns.tags"),rating:t("dashboard.photos.table.columns.rating"),isLivePhoto:t("dashboard.photos.table.columns.isLivePhoto"),location:t("dashboard.photos.table.columns.location"),dateTaken:t("dashboard.photos.table.columns.dateTaken"),lastModified:t("dashboard.photos.table.columns.lastModified"),fileSize:t("dashboard.photos.table.columns.fileSize"),colorSpace:t("dashboard.photos.table.columns.colorSpace"),reactions:t("dashboard.photos.table.columns.reactions"),actions:t("dashboard.photos.table.columns.actions")};Oa({title:t("title.photos")});const A=Na(),{status:f,refresh:k}=Ka(),{filteredPhotos:w,selectedCounts:J,hasActiveFilters:N}=ks(),H=D(()=>Object.values(J.value).reduce((a,s)=>a+s,0)),S=j({}),d=(a,s)=>{if(s)S.value={...S.value,[a]:!0};else{const{[a]:m,...y}=S.value;S.value=y}},u=j({}),h=j(!1),_=async a=>{if(a.length!==0){h.value=!0;try{const s=await $fetch("/api/photos/reactions",{query:{ids:a}});u.value=s}catch(s){console.error("获取表态数据失败:",s)}finally{h.value=!1}}},o=j(new Map),B=j(null),b=j(!1),ee=j(!1),$=_t({title:"",description:"",tags:[],rating:null}),W=j({title:"",description:"",tags:[],location:null,rating:null}),se=j(null),ne=j(!1),M=a=>{const s=new Set,m=[];for(const y of a){const E=y.trim();if(!E)continue;const v=E.toLowerCase();s.has(v)||(s.add(v),m.push(E))}return m},R=(a,s)=>a.length!==s.length?!1:a.every((m,y)=>m===s[y]),F=D({get:()=>$.tags,set:a=>{const s=Array.isArray(a)?M(a):[];R($.tags,s)||($.tags=s)}}),L=D(()=>$.title.trim()),T=D(()=>$.description.trim()),P=D(()=>{const a=$.tags,s=W.value.tags;return!R(a,s)}),X=D(()=>L.value!==W.value.title),z=D(()=>T.value!==W.value.description),Z=D(()=>{if(!ne.value)return!1;const a=se.value,s=W.value.location;return!a&&!s?!1:!a||!s?!0:Math.abs(a.latitude-s.latitude)>1e-6||Math.abs(a.longitude-s.longitude)>1e-6}),ae=D(()=>$.rating!==W.value.rating),K=D(()=>X.value||z.value||P.value||Z.value||ae.value),ue=D(()=>se.value?{latitude:se.value.latitude.toFixed(6),longitude:se.value.longitude.toFixed(6)}:null),ke=async(a,s)=>{const m=a.name,y=s||`${Date.now()}-${m}`,E=Tl({timeout:600*1e3});let v=o.value.get(y);v?(v.status="preparing",v.canAbort=!1,v.abortUpload=()=>E.abortUpload(),o.value=new Map(o.value)):(v={file:a,fileName:m,fileId:y,status:"preparing",canAbort:!1,abortUpload:()=>E.abortUpload()},o.value.set(y,v));try{v.status="preparing";const I=await $fetch("/api/photos",{method:"POST",body:{fileName:a.name,contentType:a.type}});if(v.signedUrlResponse=I,I.skipped){v.status="skipped",v.progress=100,v.canAbort=!1,o.value=new Map(o.value);return}v.status="uploading",v.canAbort=!0,v.progress=0,o.value=new Map(o.value),await E.uploadFile(a,I.signedUrl,{onProgress:Y=>{v.progress=Y.percentage,v.uploadProgress={loaded:Y.loaded,total:Y.total,percentage:Y.percentage,speed:Y.speed,timeRemaining:Y.timeRemaining,speedText:Y.speed?`${at(Y.speed)}/s`:"",timeRemainingText:Y.timeRemaining?A.duration(Y.timeRemaining,"seconds").humanize():""},o.value=new Map(o.value)},onStatusChange:Y=>{v.canAbort=Y==="uploading",o.value=new Map(o.value)},onSuccess:async Y=>{v.status="processing",v.progress=100,v.canAbort=!1,v.stage=null,o.value=new Map(o.value);try{const fe=a.type==="video/quicktime"||a.type==="video/mp4"||a.name.toLowerCase().endsWith(".mov"),le=await $fetch("/api/queue/add-task",{method:"POST",body:{payload:{type:fe?"live-photo-video":"photo",storageKey:I.fileKey},priority:fe?0:1,maxAttempts:3}});le.success?(v.taskId=le.taskId,v.status="processing",o.value=new Map(o.value),Ot(le.taskId,y)):(v.status="error",v.error=t("dashboard.photos.messages.taskSubmitFailed"),o.value=new Map(o.value))}catch(fe){v.status="error",v.error=`${t("dashboard.photos.messages.taskSubmitFailed")}: ${fe.message}`,v.canAbort=!1,o.value=new Map(o.value)}},onError:Y=>{v.status="error",v.error=Y,v.canAbort=!1,o.value=new Map(o.value)}})}catch(I){v.status="error",v.canAbort=!1,I.statusCode===409&&I.data?.duplicate?(v.status="blocked",v.error=I.data.title||t("upload.duplicate.block.title")):v.error=I.message||t("dashboard.photos.messages.uploadFailed"),o.value=new Map(o.value),I.response?.status===401?v.error=t("dashboard.photos.errors.uploadUnauthorized"):I.message?.includes("CORS")?v.error=t("dashboard.photos.errors.uploadCorsError"):I.message?.includes("NetworkError")||I.name==="TypeError"?v.error=t("dashboard.photos.errors.uploadNetworkError"):I.message?.includes("上传到存储失败")&&(v.error=t("dashboard.photos.messages.uploadFailed")),o.value=new Map(o.value)}},Q=Ea(),pe=j([]),Te=j(!1),Be=D(()=>pe.value.length>0),ut=D(()=>pe.value.reduce((a,s)=>a+(s?.size||0),0)),Dt=D(()=>ut.value>0?at(ut.value):"0 B"),Ut=D(()=>pe.value.length?t("dashboard.photos.slideover.footer.prepared",{count:pe.value.length,size:Dt.value}):t("dashboard.photos.slideover.footer.noSelection")),ct=()=>{pe.value=[]};$e(Te,a=>{a||ct()});const Bt=()=>{Te.value=!0};$e(b,a=>{a||(B.value=null,$.title="",$.description="",$.tags=[],$.rating=null,W.value={title:"",description:"",tags:[],location:null,rating:null},se.value=null,ne.value=!1)});const Pe=j({}),Ie=Lt("table"),Xe=j({thumbnailUrl:!0,id:!0,actions:!0,title:!0,tags:!0,rating:!0,isLivePhoto:!0,location:!0,dateTaken:!0,lastModified:!0,fileSize:!0,colorSpace:!0,reactions:!0}),pt=D(()=>Ie.value?.tableApi?.getFilteredSelectedRowModel().rows.length||0),Vt=D(()=>Ie.value?.tableApi?.getFilteredRowModel().rows.length||0),qe=D(()=>{if(!w.value)return{total:0,livePhotos:0,staticPhotos:0};const a=w.value.length,s=w.value.filter(y=>y.isLivePhoto).length,m=a-s;return{total:a,livePhotos:s,staticPhotos:m}}),Ve=j("all"),Oe=D(()=>{if(!w.value)return[];switch(Ve.value){case"livephoto":return w.value.filter(a=>a.isLivePhoto);case"static":return w.value.filter(a=>!a.isLivePhoto);default:return w.value}});$e(()=>Oe.value,async a=>{if(a&&a.length>0){const s=a.map(m=>m.id);await _(s)}},{immediate:!0});const ce=j(new Map),Ot=(a,s)=>{const m=Qa(async()=>{try{const y=await $fetch(`/api/queue/stats/${a}`),E=o.value.get(s);if(!E){clearInterval(m),ce.value.delete(a);return}E.stage=y.status==="in-stages"?y.statusStage:null,o.value=new Map(o.value),y.status==="completed"?(E.status="completed",E.stage=null,o.value=new Map(o.value),clearInterval(m),ce.value.delete(a),await k()):y.status==="failed"&&(E.status="error",E.error=`${t("dashboard.photos.messages.error")}: ${y.errorMessage||t("dashboard.photos.table.cells.unknown")}`,E.stage=null,o.value=new Map(o.value),clearInterval(m),ce.value.delete(a))}catch(y){console.error("检查任务状态失败:",y),clearInterval(m),ce.value.delete(a);const E=o.value.get(s);E&&(E.status="error",E.error=t("dashboard.photos.messages.taskStatusCheckFailed"),o.value=new Map(o.value))}},1e3);ce.value.set(a,m)},Kt=a=>{const s=o.value.get(a);if(s?.taskId){const m=ce.value.get(s.taskId);m&&(clearInterval(m),ce.value.delete(s.taskId))}o.value.delete(a),o.value=new Map(o.value)},Et=()=>{const a=[];for(const[s,m]of o.value)if((m.status==="completed"||m.status==="error")&&(a.push(s),m.taskId)){const y=ce.value.get(m.taskId);y&&(clearInterval(y),ce.value.delete(m.taskId))}a.forEach(s=>{o.value.delete(s)}),o.value=new Map(o.value),a.length>0&&Q.add({title:t("dashboard.photos.uploadQueue.taskCleared"),description:t("dashboard.photos.uploadQueue.tasksCleared",{count:a.length}),color:"info"})},jt=()=>{Et()},Nt=()=>{const a=[];for(const[s,m]of o.value)if(a.push(s),m.status==="uploading"&&m.abortUpload&&m.abortUpload(),m.taskId){const y=ce.value.get(m.taskId);y&&(clearInterval(y),ce.value.delete(m.taskId))}o.value.clear(),o.value=new Map(o.value),a.length>0&&Q.add({title:t("dashboard.photos.uploadQueue.allTasksCleared"),description:t("dashboard.photos.uploadQueue.tasksCleared",{count:a.length}),color:"info"})},Ht=[{id:"select",header:({table:a})=>oe(ht,{modelValue:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),"onUpdate:modelValue":s=>a.toggleAllPageRowsSelected(!!s),"aria-label":"Select all"}),cell:({row:a})=>oe(ht,{modelValue:a.getIsSelected(),"onUpdate:modelValue":s=>a.toggleSelected(!!s),"aria-label":"Select row"}),enableHiding:!1},{id:"thumbnailUrl",accessorKey:"thumbnailUrl",header:t("dashboard.photos.table.columns.thumbnail.title"),cell:({row:a})=>{const s=a.original.thumbnailUrl;return oe(ja,{src:s||a.original.originalUrl||"",alt:a.original.title||"Photo Thumbnail",key:a.original.id,thumbhash:a.original.thumbnailHash||"",class:"size-16 min-w-[100px] object-cover rounded-md shadow",onClick:()=>gt(a.original),style:{cursor:s?"pointer":"default"}})},enableHiding:!1},{id:"id",accessorKey:"id",header:t("dashboard.photos.table.columns.id"),enableHiding:!1},{accessorKey:"title",header:t("dashboard.photos.table.columns.title")},{accessorKey:"tags",header:t("dashboard.photos.table.columns.tags"),cell:({row:a})=>{const s=a.original.tags;return oe("div",{class:"flex items-center gap-1"},[s&&s.length?s.map(m=>oe(ye,{size:"sm",variant:"soft",color:"neutral"},()=>m)):oe("span",{class:"text-neutral-400 text-xs"},t("dashboard.photos.table.cells.noTags"))])}},{accessorKey:"rating",header:t("dashboard.photos.table.columns.rating"),cell:({row:a})=>{const s=a.original.exif?.Rating;return oe("div",{class:"flex items-center"},[s!=null?oe(bt,{modelValue:s,readonly:!0,size:"xs"}):oe("span",{class:"text-neutral-400 text-xs"},t("dashboard.photos.table.cells.noRating"))])}},{accessorKey:"isLivePhoto",header:t("dashboard.photos.table.columns.isLivePhoto"),cell:({row:a})=>{const s=a.original.isLivePhoto;return oe("div",{class:"flex items-center gap-2"},[s?oe("div",{class:"flex items-center gap-1"},[oe(Ce,{name:"tabler:live-photo",class:"size-4 text-yellow-600 dark:text-yellow-400"}),oe("span",{class:"text-yellow-600 dark:text-yellow-400 text-xs font-medium"},t("ui.livePhoto"))]):oe("span",{class:"text-neutral-400 text-xs"},t("dashboard.photos.table.cells.staticPhoto"))])},sortingFn:(a,s)=>{const m=a.original.isLivePhoto?1:0;return(s.original.isLivePhoto?1:0)-m}},{accessorKey:"location",header:t("dashboard.photos.table.columns.location"),cell:({row:a})=>{const{exif:s,city:m,country:y}=a.original;if(!s?.GPSLongitude&&!s?.GPSLatitude)return oe("span",{class:"text-neutral-400 text-xs"},t("dashboard.photos.table.cells.noGps"));const E=[m,y].filter(Boolean).join(", ");return oe("span",{class:E?"text-xs":"text-neutral-400 text-xs"},E||t("dashboard.photos.table.cells.unknown"))}},{accessorKey:"dateTaken",header:t("dashboard.photos.table.columns.dateTaken"),cell:a=>{const s=a.getValue();return oe("span",{class:"font-mono text-xs"},s?A(s).format("YYYY-MM-DD HH:mm:ss"):t("dashboard.photos.table.cells.unknown"))}},{accessorKey:"lastModified",header:t("dashboard.photos.table.columns.lastModified"),cell:a=>{const s=a.getValue();return oe("span",{class:"font-mono text-xs"},s?A(s).format("YYYY-MM-DD HH:mm:ss"):t("dashboard.photos.table.cells.unknown"))}},{accessorKey:"fileSize",header:t("dashboard.photos.table.columns.fileSize"),cell:a=>at(a.getValue())},{id:"colorSpace",accessorFn:a=>a.exif?.ColorSpace,header:t("dashboard.photos.table.columns.colorSpace")},{accessorKey:"reactions",header:t("dashboard.photos.table.columns.reactions"),cell:({row:a})=>{const s=a.original.id,m=u.value[s]||{},y=Object.values(m).reduce((I,Y)=>I+Y,0);if(y===0)return oe("span",{class:"text-neutral-400 text-xs"},t("dashboard.photos.table.cells.noReactions"));const E={like:"fluent-emoji-flat:thumbs-up",love:"fluent-emoji-flat:red-heart",amazing:"fluent-emoji-flat:smiling-face-with-heart-eyes",funny:"fluent-emoji-flat:face-with-tears-of-joy",wow:"fluent-emoji-flat:face-with-open-mouth",sad:"fluent-emoji-flat:crying-face",fire:"fluent-emoji-flat:fire",sparkle:"fluent-emoji-flat:sparkles"},v=Object.entries(m).filter(([I,Y])=>Y>0).sort((I,Y)=>Y[1]-I[1]).slice(0,3);return oe("div",{class:"flex items-center gap-2"},[...v.map(([I,Y])=>oe("div",{class:"flex items-center gap-0.5"},[oe(Ce,{name:E[I]||"fluent-emoji-flat:face-with-tears-of-joy",class:"size-4",mode:"svg"}),oe("span",{class:"text-xs font-medium text-neutral-700 dark:text-neutral-300"},Y)])),y>v.length?oe("span",{class:"text-xs text-neutral-400"},`+${y-v.reduce((I,[Y,fe])=>I+fe,0)}`):null].filter(Boolean))}},{id:"actions",accessorKey:"actions",header:t("dashboard.photos.table.columns.actions"),enableHiding:!1}],Wt=a=>{const m=["image/jpeg","image/png","image/heic","image/heif","video/quicktime"].includes(a.type),y=[".heic",".heif"].some(I=>a.name.toLowerCase().endsWith(I)),E=a.name.toLowerCase().endsWith(".mov");if(!m&&!y&&!E)return{valid:!1,error:t("dashboard.photos.errors.unsupportedFormat",{type:a.type})};const v=je*1024*1024;return a.size>v?{valid:!1,error:t("dashboard.photos.errors.fileTooLarge",{size:(a.size/1024/1024).toFixed(2),maxSize:je})}:{valid:!0}},Gt=async()=>{const a=pe.value;if(a.length===0)return;const s=[],m=[],y=new Map;for(const le of a){const re=Wt(le);if(!re.valid)s.push(`${le.name}: ${re.error}`);else{m.push(le);const he=`${Date.now()}-${Math.random().toString(36).substr(2,9)}-${le.name}`;y.set(le,he)}}if(m.length===0){Q.add({title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.errors.allFilesValidationFailed"),color:"error"}),pe.value=[];return}for(const le of m){const re=y.get(le),he={file:le,fileName:le.name,fileId:re,status:"waiting",canAbort:!1};o.value.set(re,he)}o.value=new Map(o.value);const E=3,v=[...m],I=new Set,Y=async le=>{const re=y.get(le);try{ke(le,re)}catch(he){s.push(`${le.name}: ${he.message||"上传失败"}`),console.error("上传错误:",he)}};await(async()=>{for(;v.length>0||I.size>0;){for(;I.size<E&&v.length>0;){const le=v.shift(),re=Y(le);I.add(re),re.finally(()=>{I.delete(re)})}I.size>0&&await Promise.race(I)}})(),s.length>0&&console.error("批量上传错误详情:",s),pe.value=[],Te.value=!1},Qt=a=>{const s=a.title?.trim()??"",m=a.description?.trim()??"",y=M(a.tags??[]),E=typeof a.latitude=="number"&&typeof a.longitude=="number";B.value=a,$.title=s,$.description=m,$.tags=[...y],$.rating=typeof a.exif?.Rating=="number"?a.exif.Rating:null;const v=E?{latitude:a.latitude,longitude:a.longitude}:null;W.value={title:s,description:m,tags:[...y],location:v?{...v}:null,rating:typeof a.exif?.Rating=="number"?a.exif.Rating:null},se.value=v?{...v}:null,ne.value=!1,b.value=!0},Yt=()=>{ne.value=!0},Xt=()=>{se.value=null,ne.value=!0},Zt=async()=>{if(!(!B.value||!K.value)){ee.value=!0;try{const a={};if(X.value&&(a.title=L.value),z.value&&(a.description=T.value),P.value&&(a.tags=[...$.tags]),Z.value&&(a.location=se.value?{latitude:se.value.latitude,longitude:se.value.longitude}:null),ae.value&&(a.rating=$.rating),Object.keys(a).length===0){b.value=!1;return}await $fetch(`/api/photos/${B.value.id}`,{method:"PUT",body:a}),Q.add({title:t("dashboard.photos.messages.metadataUpdateSuccess"),description:"",color:"success"}),await k(),b.value=!1}catch(a){console.error("更新照片信息失败:",a);const s=a?.data?.statusMessage||a?.statusMessage||a?.message||t("dashboard.photos.messages.metadataUpdateFailed");Q.add({title:t("dashboard.photos.messages.metadataUpdateFailed"),description:s,color:"error"})}finally{ee.value=!1}}},Jt=async a=>{a.preventDefault(),K.value&&await Zt()},ea=async a=>{if(a?.id){d(a.id,!0);try{const s=await $fetch("/api/queue/add-task",{method:"POST",body:{payload:{type:"photo-reverse-geocoding",photoId:a.id,latitude:typeof a.latitude=="number"?a.latitude:void 0,longitude:typeof a.longitude=="number"?a.longitude:void 0},priority:1,maxAttempts:3}});s.success?Q.add({title:t("dashboard.photos.messages.reverseGeocodeQueued"),description:typeof s.taskId=="number"?t("dashboard.photos.messages.reprocessTaskId",{taskId:s.taskId}):"",color:"success"}):Q.add({title:t("dashboard.photos.messages.reverseGeocodeFailed"),description:s?.message||t("dashboard.photos.messages.reverseGeocodeFailed"),color:"error"})}catch(s){console.error("Failed to enqueue reverse geocoding task:",s);const m=s?.data?.statusMessage||s?.statusMessage||s?.message||t("dashboard.photos.messages.reverseGeocodeFailed");Q.add({title:t("dashboard.photos.messages.reverseGeocodeFailed"),description:m,color:"error"})}finally{d(a.id,!1)}}},ta=async a=>{try{if(!a||!a.storageKey){Q.add({title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.messages.noStorageKey"),color:"error"});return}const s=Q.add({title:t("dashboard.photos.messages.reprocessSuccess"),description:"",color:"info"}),m=await $fetch("/api/queue/add-task",{method:"POST",body:{payload:{type:"photo",storageKey:a.storageKey},priority:0,maxAttempts:3}});m.success?Q.update(s.id,{title:t("dashboard.photos.messages.reprocessSuccess"),description:t("dashboard.photos.messages.reprocessTaskId",{taskId:m.taskId}),color:"success"}):Q.update(s.id,{title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.messages.taskSubmitFailed"),color:"error"})}catch(s){console.error("处理照片失败:",s),Q.add({title:t("dashboard.photos.messages.reprocessFailed"),description:s.message||t("dashboard.photos.messages.error"),color:"error"})}},aa=a=>{const s=!!S.value[a.id];return[[{label:t("dashboard.photos.actions.editMetadata"),icon:"tabler:pencil",onSelect(){Qt(a)}},{label:t("dashboard.photos.actions.reprocess"),icon:"tabler:refresh",onSelect(){ta(a)}},{label:t("dashboard.photos.actions.refreshLocation"),icon:s?"tabler:loader-2":"tabler:map-pin",disabled:s,onSelect(){ea(a)}},{label:t("dashboard.photos.actions.previewPhoto"),icon:"tabler:photo",onSelect(){gt(a)}}],[{color:"error",label:t("dashboard.photos.actions.delete"),icon:"tabler:trash",onSelect:()=>la(a)}]]},Re=j(!1),Fe=j(null),gt=a=>{a&&(Fe.value=a,Re.value=!0)},sa=a=>{typeof window<"u"&&window.open(a,"_blank")},Se=j(!1),Ke=j("single"),Ae=j([]),Ee=j(!1),ft=(a,s)=>{Ke.value=a,Ae.value=s,Se.value=!0},la=a=>{ft("single",[a])},oa=()=>{const s=Ie.value?.tableApi?.getFilteredSelectedRowModel()?.rows.map(m=>m.original)||[];if(s.length===0){Q.add({title:t("dashboard.photos.selection.selected",{count:0,total:0}),description:t("dashboard.photos.messages.batchSelectRequired"),color:"warning"});return}ft("batch",s)},ia=async()=>{if(Ae.value.length===0){Se.value=!1;return}const a=Ke.value,s=[...Ae.value];let m=null;Ee.value=!0;try{if(a==="batch")m=Q.add({title:t("dashboard.photos.delete.batch.title"),description:t("dashboard.photos.messages.deleteSuccess"),color:"info"}),await Promise.all(s.map(y=>$fetch(`/api/photos/${y.id}`,{method:"DELETE"}))),Q.update(m.id,{title:t("dashboard.photos.messages.batchDeleteSuccess",{count:s.length}),description:"",color:"success"}),Pe.value={};else{const y=s[0];if(!y)throw new Error(t("dashboard.photos.messages.error"));await $fetch(`/api/photos/${y.id}`,{method:"DELETE"}),Q.add({title:t("dashboard.photos.messages.deleteSuccess"),description:"",color:"success"})}await k(),Se.value=!1,Ae.value=[]}catch(y){console.error("删除照片失败:",y);const E=y?.message||t("dashboard.photos.messages.error");a==="batch"&&m?Q.update(m.id,{title:t("dashboard.photos.messages.batchDeleteFailed"),description:E,color:"error"}):Q.add({title:t("dashboard.photos.messages.deleteFailed"),description:E,color:"error"})}Ee.value=!1},ra=async()=>{const s=Ie.value?.tableApi?.getFilteredSelectedRowModel()?.rows.map(y=>y.original)||[];if(s.length===0){Q.add({title:t("dashboard.photos.messages.batchSelectRequired"),description:"",color:"warning"});return}const m=s.filter(y=>y.storageKey);if(m.length!==s.length){Q.add({title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.messages.batchNoStorageKey",{count:s.length-m.length}),color:"error"});return}try{const y=Q.add({title:t("dashboard.photos.messages.batchSelectRequired"),description:"",color:"info"});(await $fetch("/api/queue/add-tasks",{method:"POST",body:{tasks:m.map(v=>({payload:{type:"photo",storageKey:v.storageKey},priority:0,maxAttempts:3}))}})).success?Q.update(y.id,{title:t("dashboard.photos.messages.reprocessSuccess"),description:t("dashboard.queue.title",{count:m.length}),color:"success"}):Q.update(y.id,{title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.messages.batchReprocessFailed"),color:"error"}),Pe.value={}}catch(y){console.error("批量处理失败:",y),Q.add({title:t("dashboard.photos.messages.batchReprocessFailed"),description:y.message||t("dashboard.photos.messages.error"),color:"error"})}},na=async()=>{const s=Ie.value?.tableApi?.getFilteredSelectedRowModel()?.rows.map(I=>I.original)||[];if(s.length===0){Q.add({title:t("dashboard.photos.messages.batchSelectRequired"),description:"",color:"warning"});return}const m=s.filter(I=>I.originalUrl);if(m.length===0){Q.add({title:t("dashboard.photos.messages.error"),description:t("dashboard.photos.messages.batchNoUrl"),color:"error"});return}m.length!==s.length&&Q.add({title:t("dashboard.photos.messages.warning"),description:t("dashboard.photos.messages.batchPartialUrl",{count:m.length,total:s.length}),color:"warning"});const y=Q.add({title:t("dashboard.photos.messages.downloadStarted"),description:t("dashboard.photos.messages.downloadingCount",{count:m.length}),color:"info"});let E=0,v=0;try{for(const I of m)try{const Y=await fetch(I.originalUrl);if(!Y.ok){v++;continue}const fe=await Y.blob(),le=window.URL.createObjectURL(fe),re=document.createElement("a");re.href=le;const he=I.originalUrl.split(".").pop()||"jpg";re.download=`${I.title||`photo-${I.id}`}.${he}`,document.body.appendChild(re),re.click(),document.body.removeChild(re),window.URL.revokeObjectURL(le),E++,await new Promise(Ze=>setTimeout(Ze,200))}catch(Y){console.error(`Failed to download photo ${I.id}:`,Y),v++}E===m.length?Q.update(y.id,{title:t("dashboard.photos.messages.batchDownloadSuccess"),description:t("dashboard.photos.messages.downloadedCount",{count:E}),color:"success"}):v===m.length?Q.update(y.id,{title:t("dashboard.photos.messages.batchDownloadFailed"),description:t("dashboard.photos.messages.downloadFailedCount",{count:v}),color:"error"}):Q.update(y.id,{title:t("dashboard.photos.messages.batchDownloadPartial"),description:t("dashboard.photos.messages.downloadPartialCount",{success:E,failed:v}),color:"warning"})}catch(I){console.error("批量下载出错:",I),Q.update(y.id,{title:t("dashboard.photos.messages.error"),description:I.message||t("dashboard.photos.messages.error"),color:"error"})}};return $e(Re,a=>{a||(Fe.value=null)}),rt(()=>{ce.value.forEach(a=>{clearInterval(a)}),ce.value.clear()}),(a,s)=>{const m=Xa,y=hl,E=Wa,v=Ha("i18n-t"),I=Ge,Y=xl,fe=Ja,le=be,re=Ga,he=as,Ze=ss,da=ls,ua=ds,ca=us,mt=kl,pa=cs,ga=ps,Je=fs,fa=ms,ma=zl,ha=Sl,va=gs,et=es,ba=ws,ya=Ya;return c(),C(ya,null,{header:r(()=>[n(m,{title:e(t)("dashboard.photos.toolbar.title")},null,8,["title"])]),body:r(()=>[g("div",ql,[n(y,{"uploading-files":e(o),onRemoveFile:Kt,onClearCompleted:jt,onClearAll:Nt,onGoToQueue:s[0]||(s[0]=U=>a.$router.push("/dashboard/queue"))},null,8,["uploading-files"]),g("div",Fl,[s[22]||(s[22]=g("div",{class:"pointer-events-none absolute -left-32 -top-24 h-72 w-[18rem] rounded-full bg-primary-400/20 blur-3xl dark:bg-primary-500/20"},null,-1)),g("div",Cl,[g("div",Ml,[g("div",Ll,[g("div",Pl,[g("span",Rl,[n(e(Ce),{name:"tabler:cloud-upload",class:"size-6"})]),g("div",null,[g("h2",Al,x(e(t)("dashboard.photos.title")),1),n(v,{keypath:"dashboard.photos.subtitle",tag:"p",class:"mt-1 text-sm text-neutral-500 dark:text-neutral-400"},{default:r(()=>[n(E,{to:"/dashboard/albums",class:"text-primary font-medium"},{default:r(()=>[te(x(e(t)("title.albums")),1)]),_:1})]),_:1})])]),g("div",Dl,[n(e(ye),{variant:"soft",color:"primary",size:"sm"},{default:r(()=>[...s[19]||(s[19]=[te(" JPEG / PNG ",-1)])]),_:1}),n(e(ye),{variant:"soft",color:"primary",size:"sm"},{default:r(()=>[...s[20]||(s[20]=[te(" HEIC ",-1)])]),_:1}),n(e(ye),{variant:"soft",color:"primary",size:"sm"},{default:r(()=>[te(x(e(t)("ui.livePhoto")),1)]),_:1}),n(e(ye),{variant:"soft",color:"primary",size:"sm"},{default:r(()=>[...s[21]||(s[21]=[te(" Motion Photo ",-1)])]),_:1}),n(e(ye),{variant:"outline",color:"neutral",size:"sm"},{default:r(()=>[te(x(e(t)("dashboard.photos.maxFileSize",{size:je})),1)]),_:1})])]),g("div",Ul,[n(I,{variant:"soft",size:"lg",class:"w-full sm:w-auto",icon:"tabler:list-check",onClick:s[1]||(s[1]=U=>a.$router.push("/dashboard/queue"))},{default:r(()=>[te(x(e(t)("dashboard.photos.buttons.queue")),1)]),_:1}),n(I,{size:"lg",class:"w-full sm:w-auto",icon:"tabler:cloud-upload",onClick:Bt},{default:r(()=>[te(x(e(t)("dashboard.photos.buttons.upload")),1)]),_:1})])])])]),n(fe,{open:e(Te),"onUpdate:open":s[3]||(s[3]=U=>ve(Te)?Te.value=U:null),title:e(t)("dashboard.photos.slideover.title"),description:e(t)("dashboard.photos.slideover.description"),ui:{content:"sm:max-w-xl",body:"p-2",header:"px-6 py-5 border-b border-neutral-200 dark:border-neutral-800",footer:"px-6 py-5 border-t border-neutral-200 dark:border-neutral-800"}},{body:r(()=>[n(Y,{modelValue:e(pe),"onUpdate:modelValue":s[2]||(s[2]=U=>ve(pe)?pe.value=U:null),label:e(t)("dashboard.photos.uploader.label"),description:e(t)("dashboard.photos.uploader.description",{maxSize:je}),icon:"tabler:cloud-upload",layout:"list",size:"xl",accept:"image/jpeg,image/png,image/heic,image/heif,video/quicktime,.mov",multiple:"",highlight:"",dropzone:"","file-delete":{variant:"soft",color:"neutral"},ui:{root:"w-full",base:"group relative flex flex-col items-center justify-center gap-3 rounded-3xl border-2 border-dashed border-neutral-200/80 bg-white/90 px-6 py-12 text-center shadow-sm transition-all duration-300 hover:border-primary-400/80 hover:bg-primary-500/5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500/60 dark:border-neutral-700/70 dark:bg-neutral-900/80",wrapper:"flex flex-col items-center gap-2",label:"text-base font-semibold text-neutral-800 dark:text-neutral-100",description:"text-sm text-neutral-500 dark:text-neutral-400",files:"mt-2 flex w-full flex-col gap-2 overflow-y-auto",file:"flex items-center justify-between gap-3 rounded-2xl border border-neutral-200/80 bg-white/80 px-4 py-3 text-left shadow-sm shadow-black/5 backdrop-blur-sm dark:border-neutral-800/80 dark:bg-neutral-900/70",fileLeadingAvatar:"ring-1 ring-white/80 dark:ring-neutral-800",fileWrapper:"min-w-0 flex-1",fileName:"text-sm font-medium text-neutral-700 dark:text-neutral-100 truncate",fileSize:"text-xs text-neutral-500 dark:text-neutral-400",fileTrailingButton:"text-neutral-400 hover:text-error-500"}},null,8,["modelValue","label","description"])]),footer:r(()=>[g("div",Bl,[g("div",Vl,[g("span",null,x(e(Be)?e(Ut):e(t)("dashboard.photos.slideover.footer.noSelection")),1)]),g("div",Ol,[n(I,{variant:"soft",color:"neutral",class:"w-full sm:w-auto",disabled:!e(Be),onClick:ct},{default:r(()=>[te(x(e(t)("dashboard.photos.slideover.buttons.clear")),1)]),_:1},8,["disabled"]),n(I,{color:"primary",size:"lg",class:"w-full sm:w-auto",icon:"tabler:upload",disabled:!e(Be),onClick:Gt},{default:r(()=>[te(x(e(Be)?e(t)("dashboard.photos.slideover.buttons.upload",{count:e(pe).length}):e(t)("dashboard.photos.buttons.upload")),1)]),_:1},8,["disabled"])])])]),_:1},8,["open","title","description"]),g("div",Kl,[g("div",El,[n(le,{name:"tabler:photo",class:"text-neutral-500"}),g("span",jl,x(e(t)("dashboard.photos.toolbar.title")),1),g("div",Nl,[e(qe).staticPhotos>0?(c(),C(e(ye),{key:0,variant:"soft",color:"neutral",size:"sm"},{default:r(()=>[g("span",Hl,x(e(qe).staticPhotos)+" "+x(e(t)("dashboard.photos.stats.photos")),1),g("span",Wl,x(e(qe).staticPhotos)+"P",1)]),_:1})):q("",!0),e(qe).livePhotos>0?(c(),C(e(ye),{key:1,variant:"soft",color:"warning",size:"sm"},{default:r(()=>[g("span",Gl,x(e(qe).livePhotos)+" "+x(e(t)("dashboard.photos.stats.livePhotos")),1),g("span",Ql,x(e(qe).livePhotos)+"LP",1)]),_:1})):q("",!0)])]),g("div",Yl,[n(ua,null,{content:r(()=>[n(da,{variant:"glassmorphism"},{default:r(()=>[n(Ze)]),_:1})]),default:r(()=>[n(he,{text:e(t)("ui.action.filter.tooltip")},{default:r(()=>[n(re,{inset:"",size:"sm",color:"info",show:e(H)>0},{default:r(()=>[n(I,{variant:"soft",color:e(N)?"info":"neutral",class:"bg-transparent rounded-full cursor-pointer relative",icon:"tabler:filter",size:"sm"},null,8,["color"])]),_:1},8,["show"])]),_:1},8,["text"])]),_:1}),n(ca,{modelValue:e(Ve),"onUpdate:modelValue":s[4]||(s[4]=U=>ve(Ve)?Ve.value=U:null),class:"w-full sm:w-48",items:[{label:e(t)("dashboard.photos.photoFilter.all"),value:"all",icon:"tabler:photo-scan"},{label:e(t)("dashboard.photos.photoFilter.livephoto"),value:"livephoto",icon:"tabler:live-photo"},{label:e(t)("dashboard.photos.photoFilter.static"),value:"static",icon:"tabler:photo"}],"value-key":"value","label-key":"label",size:"sm"},null,8,["modelValue","items"]),n(I,{variant:"soft",color:"info",size:"sm",icon:"tabler:refresh",loading:e(h),onClick:s[5]||(s[5]=async()=>{await e(k)(),e(Oe).length>0&&await _(e(Oe).map(U=>U.id))})},{default:r(()=>[g("span",Xl,x(e(t)("dashboard.photos.toolbar.refresh")),1)]),_:1},8,["loading"]),n(mt,{items:e(Ie)?.tableApi?.getAllColumns().filter(U=>U.getCanHide()).map(U=>({label:i[U.id]||U.id,type:"checkbox",checked:U.getIsVisible(),disabled:!U.getCanHide()||U.id==="thumbnailUrl"||U.id==="id"||U.id==="actions",onUpdateChecked(tt){e(Ie)?.tableApi?.getColumn(U.id)?.toggleVisibility(!!tt)},onSelect(tt){tt.preventDefault()}})),content:{align:"end"}},{default:r(()=>[n(I,{label:"",color:"neutral",variant:"outline",size:"sm",icon:"tabler:columns-3",title:e(t)("dashboard.photos.table.columnVisibility.description")},{default:r(()=>[g("span",Zl,x(e(t)("dashboard.photos.table.columnVisibility.button")),1)]),_:1},8,["title"])]),_:1},8,["items"])])]),g("div",Jl,[n(pa,{ref_key:"table",ref:Ie,"row-selection":e(Pe),"onUpdate:rowSelection":s[6]||(s[6]=U=>ve(Pe)?Pe.value=U:null),"column-visibility":e(Xe),"onUpdate:columnVisibility":s[7]||(s[7]=U=>ve(Xe)?Xe.value=U:null),"column-pinning":{right:["actions"]},data:e(Oe),columns:Ht,loading:e(f)==="pending",sticky:"",class:"h-[calc(100vh-27rem)] sm:h-[calc(100vh-24.5rem)]",ui:{separator:"bg-neutral-200 dark:bg-neutral-700"}},{"actions-cell":r(({row:U})=>[g("div",eo,[n(mt,{size:"sm",content:{align:"end"},items:aa(U.original)},{default:r(()=>[n(I,{variant:"outline",color:"neutral",size:"sm",icon:"tabler:dots-vertical"})]),_:1},8,["items"])])]),_:1},8,["row-selection","column-visibility","data","loading"]),g("div",to,[g("div",ao,[g("div",so,x(e(t)("dashboard.photos.selection.selected",{count:e(pt),total:e(Vt)})),1),e(pt)>0?(c(),O("div",lo,[n(I,{variant:"soft",color:"info",size:"xs",icon:"tabler:refresh",class:"flex-1 sm:flex-none",onClick:ra},{default:r(()=>[g("span",null,x(e(t)("dashboard.photos.selection.batchReprocess")),1)]),_:1}),n(I,{variant:"soft",color:"primary",size:"xs",icon:"tabler:download",class:"flex-1 sm:flex-none",onClick:na},{default:r(()=>[g("span",null,x(e(t)("dashboard.photos.selection.batchDownload")),1)]),_:1}),n(I,{color:"error",variant:"soft",size:"xs",icon:"tabler:trash",class:"flex-1 sm:flex-none",onClick:oa},{default:r(()=>[g("span",null,x(e(t)("dashboard.photos.selection.batchDelete")),1)]),_:1})])):q("",!0)])])]),n(et,{open:e(b),"onUpdate:open":s[14]||(s[14]=U=>ve(b)?b.value=U:null)},{content:r(()=>[g("div",oo,[g("div",io,[g("h2",ro,x(e(t)("dashboard.photos.editModal.title")),1),g("p",no,x(e(t)("dashboard.photos.editModal.description")),1),e(B)?(c(),O("p",uo,x(e(B).title||e(B).id),1)):q("",!0)]),n(va,{state:e($),class:"space-y-5",onSubmit:Jt},{default:r(()=>[n(Je,{label:e(t)("dashboard.photos.editModal.fields.title"),name:"title"},{default:r(()=>[n(ga,{modelValue:e($).title,"onUpdate:modelValue":s[8]||(s[8]=U=>e($).title=U),class:"w-full"},null,8,["modelValue"])]),_:1},8,["label"]),n(Je,{label:e(t)("dashboard.photos.editModal.fields.description"),name:"description"},{default:r(()=>[n(fa,{modelValue:e($).description,"onUpdate:modelValue":s[9]||(s[9]=U=>e($).description=U),rows:3,class:"w-full"},null,8,["modelValue"])]),_:1},8,["label"]),g("div",co,[n(Je,{label:e(t)("dashboard.photos.editModal.fields.tags"),name:"tags"},{default:r(()=>[n(ma,{modelValue:e(F),"onUpdate:modelValue":s[10]||(s[10]=U=>ve(F)?F.value=U:null),class:"w-full"},null,8,["modelValue"])]),_:1},8,["label"]),g("p",po,x(e(t)("dashboard.photos.editModal.fields.tagsHint")),1)]),g("div",go,[g("label",fo,x(e(t)("dashboard.photos.editModal.fields.rating")),1),g("div",mo,[e($).rating?(c(),O("span",ho,x(e($).rating)+" / 5 ",1)):(c(),O("span",vo,x(e(t)("dashboard.photos.editModal.fields.noRating")),1)),n(e(p),{"model-value":e($).rating||0,"allow-half":!1,size:"lg","onUpdate:modelValue":s[11]||(s[11]=U=>e($).rating=U||null)},null,8,["model-value"])])]),g("div",bo,[g("div",yo,[g("label",xo,x(e(t)("dashboard.photos.editModal.fields.location")),1),e(se)?(c(),C(I,{key:0,variant:"ghost",color:"neutral",size:"xs",icon:"tabler:map-off",onClick:We(Xt,["prevent"])},{default:r(()=>[te(x(e(t)("dashboard.photos.editModal.fields.clearLocation")),1)]),_:1})):q("",!0)]),n(ha,{modelValue:e(se),"onUpdate:modelValue":s[12]||(s[12]=U=>ve(se)?se.value=U:null),class:"border border-neutral-200 dark:border-neutral-800",onPick:Yt},{empty:r(()=>[g("span",wo,x(e(t)("dashboard.photos.editModal.fields.locationHint")),1)]),_:1},8,["modelValue"]),g("div",ko,[g("span",null,x(e(t)("dashboard.photos.editModal.fields.coordinates"))+":",1),e(ue)?(c(),O("span",Io,x(e(ue).latitude)+", "+x(e(ue).longitude),1)):(c(),O("span",zo,x(e(t)("dashboard.photos.editModal.fields.noLocation")),1))])]),g("div",_o,[n(I,{variant:"ghost",color:"neutral",onClick:s[13]||(s[13]=We(U=>b.value=!1,["prevent"]))},{default:r(()=>[te(x(e(t)("dashboard.photos.editModal.actions.cancel")),1)]),_:1}),n(I,{type:"submit",loading:e(ee),disabled:!e(K)||e(ee),icon:"tabler:device-floppy"},{default:r(()=>[te(x(e(t)("dashboard.photos.editModal.actions.save")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["state"])])]),_:1},8,["open"]),n(et,{open:e(Se),"onUpdate:open":s[16]||(s[16]=U=>ve(Se)?Se.value=U:null)},{content:r(()=>[g("div",$o,[g("div",So,[n(e(Ce),{name:"tabler:trash",class:"mt-1 size-6 shrink-0 text-error-500"}),g("div",To,[g("h3",qo,x(e(Ke)==="single"?e(t)("dashboard.photos.delete.single.title"):e(t)("dashboard.photos.delete.batch.title")),1),g("p",Fo,x(e(Ke)==="single"?e(t)("dashboard.photos.delete.single.message"):e(t)("dashboard.photos.delete.batch.message",{count:e(Ae).length})),1),g("p",Co,x(e(t)("dashboard.photos.delete.warning")),1)])]),g("div",Mo,[n(I,{variant:"ghost",color:"neutral",disabled:e(Ee),onClick:s[15]||(s[15]=U=>Se.value=!1)},{default:r(()=>[te(x(e(t)("dashboard.photos.delete.buttons.cancel")),1)]),_:1},8,["disabled"]),n(I,{color:"error",icon:"tabler:trash",loading:e(Ee),onClick:ia},{default:r(()=>[te(x(e(t)("dashboard.photos.delete.buttons.confirm")),1)]),_:1},8,["loading"])])])]),_:1},8,["open"]),n(et,{open:e(Re),"onUpdate:open":s[18]||(s[18]=U=>ve(Re)?Re.value=U:null),title:"Photo Preview",description:e(Fe)?.description||""},{body:r(()=>[g("div",Lo,[g("div",Po,[e(Fe)?(c(),C(ba,{key:0,photo:e(Fe),index:0,onVisibilityChange:()=>{},onOpenViewer:s[17]||(s[17]=U=>sa(`/${e(Fe).id}`))},null,8,["photo"])):q("",!0)])])]),_:1},8,["open","description"])])]),_:1})}}});export{mi as default};
