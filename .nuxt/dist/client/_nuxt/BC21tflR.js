import{bk as j,bl as k,j as b,ap as m,y as g,r as v,i as $,av as _,z as C,bm as S,bn as M,p as q,bo as B,aU as P,v as z,bp as F,c as N,o as p,a as x,N as f,F as U,C as V,ar as E,M as h,O as T,w as y,bq as W}from"./Do4Ulm4h.js";function A(t,n){function r(l){return l?.value?.map?(l.value.map&&l.value.loaded?n(l.value.map):k(()=>l.value?.loaded,()=>{l.value?.loaded&&n(l.value.map)}),!0):!1}const o=j(t);r(o)||k(o,()=>{o.value?.map&&r(o)})}function c(t){return b(()=>m("mapbox_marker_instances",()=>({})).value[t]??null)}function G(t,n){const r=c(t);r.value?n(r.value):g(()=>r.value,()=>{r.value&&n(r.value)})}function L(t,n,r,o,s=""){if(c(t).value)return console.warn(`Mapbox marker with ID '${t}' was initialized multiple times. This can cause unexpected behaviour.`),c(t);const l=v(),i=$("MapID");function d(){const e=_(n)?n.value:n;if(r)return S(r,()=>{if(r.value){r.value.hidden=!1;const a=m("mapbox_marker_instances",()=>({}));a.value[t]=new M.Marker({element:r.value,...e}),l.value=a.value[t],A(i||s,u=>{l.value&&l?.value?.setLngLat(e.lnglat).addTo(u)})}},{immediate:!0}),l;{const a=m("mapbox_marker_instances",()=>({}));a.value[t]=new M.Marker(e);const u=a.value[t];return A(i||s,R=>{u.setLngLat(e.lnglat).addTo(R)}),u}}return _(n)&&(g(n,(e,a)=>{const u=c(t);e.draggable!==a?.draggable&&e.draggable!==void 0&&u.value?.setDraggable(e.draggable),e.offset!==a?.offset&&e.offset!==void 0&&u.value?.setOffset(e.offset),e.pitchAlignment!==a?.pitchAlignment&&e.pitchAlignment!==void 0&&u.value?.setPitchAlignment(e.pitchAlignment),e.rotationAlignment!==a?.rotationAlignment&&e.rotationAlignment!==void 0&&u.value?.setRotationAlignment(e.rotationAlignment),e.rotation!==a?.rotation&&e.rotation!==void 0&&u.value?.setRotation(e.rotation),u.value?.getLngLat()!==n.value.lnglat&&u.value?.setLngLat(n.value.lnglat)},{deep:!0}),G(t,e=>{e.on("drag",()=>{const a=e.getLngLat();Array.isArray(n.value.lnglat)?n.value.lnglat=a.toArray():n.value.lnglat=a})})),C(()=>{const e=c(t);if(e.value){e.value.remove();const a=m("mapbox_marker_instances",()=>({}));delete a.value[t]}}),d()}const I={__name:"MapboxDefaultMarker",props:{markerId:{type:String,required:!0},options:{type:Object,required:!1,default:()=>({})},lnglat:{type:[Object,Array],required:!0}},emits:["dragstart","drag","dragend","update:lnglat"],setup(t,{emit:n}){const r=t,o=n,s=B(r,"lnglat",o),l=v();q("MarkerRef",l);const i=v({...r.options,lnglat:s.value});g(()=>i.value.lnglat,()=>{s.value=i.value.lnglat}),g(r,()=>{i.value={...r.options,lnglat:s.value}});const d=v(null),e=P();return z(()=>{e.marker?F(L(r.markerId,i,d),l):l.value=L(r.markerId,i);const a=l.value;s&&a?.setLngLat(s.value),a?.on("dragstart",()=>{o("dragstart",a)}),a?.on("drag",()=>{o("drag",a)}),a?.on("dragend",()=>{o("dragend",a)})}),(a,u)=>(p(),N(U,null,[u[0]||(u[0]=x("div",null,null,-1)),x("div",{ref_key:"customHTMLRef",ref:d,hidden:""},[f(a.$slots,"marker")],512),f(a.$slots,"default")],64))}},J=V({__name:"ProviderMarker",props:{markerId:{default:void 0},lnglat:{default:void 0}},setup(t){const n=b(()=>{const o=E("map");return typeof o=="object"&&o?o:{}}),r=b(()=>n.value.provider||"maplibre");return(o,s)=>{const l=I,i=W;return T(r)==="mapbox"?(p(),h(l,{key:0,"marker-id":t.markerId,lnglat:t.lnglat},{marker:y(()=>[f(o.$slots,"marker")]),_:3},8,["marker-id","lnglat"])):(p(),h(i,{key:1,coordinates:t.lnglat},{marker:y(()=>[f(o.$slots,"marker")]),_:3},8,["coordinates"]))}}}),Q=Object.assign(J,{__name:"MapProviderMarker"});export{Q as _};
