import{ac as y,j as c,r as T,bh as h}from"./Do4Ulm4h.js";const i=T({currentSort:"dateTaken-desc",availableSorts:[{key:"dateTaken-desc",labelI18n:"ui.action.sort.options.dateTakenDesc",icon:"tabler:sort-descending",value:n=>n.dateTaken?new Date(n.dateTaken).getTime():0,order:"desc"},{key:"dateTaken-asc",labelI18n:"ui.action.sort.options.dateTakenAsc",icon:"tabler:sort-ascending",value:n=>n.dateTaken?new Date(n.dateTaken).getTime():0,order:"asc"},{key:"fileSize-asc",labelI18n:"ui.action.sort.options.fileSizeAsc",icon:"tabler:sort-ascending-small-big",value:n=>n.fileSize||0,order:"asc"},{key:"fileSize-desc",labelI18n:"ui.action.sort.options.fileSizeDesc",icon:"tabler:sort-descending-small-big",value:n=>n.fileSize||0,order:"desc"},{key:"title-asc",labelI18n:"ui.action.sort.options.titleAsc",icon:"tabler:sort-ascending-letters",value:n=>(n.title||n.id).toLowerCase(),order:"asc"},{key:"title-desc",labelI18n:"ui.action.sort.options.titleDesc",icon:"tabler:sort-descending-letters",value:n=>(n.title||n.id).toLowerCase(),order:"desc"}]});function I(){const{photos:n}=y(),f=c(()=>i.value.availableSorts.find(r=>r.key===i.value.currentSort)||i.value.availableSorts[0]),a=c(()=>{const r=f.value;return r?[...n.value].sort((s,t)=>{const l=r.value(s),u=r.value(t);if(l==null&&u==null)return 0;if(l==null)return 1;if(u==null)return-1;if(typeof l=="number"&&typeof u=="number")return r.order==="asc"?l-u:u-l;if(typeof l=="string"&&typeof u=="string"){const M=l.localeCompare(u);return r.order==="asc"?M:-M}const L=String(l),A=String(u),x=L.localeCompare(A);return r.order==="asc"?x:-x}):n.value}),o=r=>{i.value.availableSorts.some(e=>e.key===r)&&(i.value.currentSort=r)},d=()=>{const r=i.value.currentSort;o(r==="dateTaken-desc"?"dateTaken-asc":"dateTaken-desc")},g=c(()=>i.value.availableSorts),v=c(()=>f.value?.labelI18n||"拍摄时间（新到旧）"),m=c(()=>f.value?.icon||"tabler:sort-descending"),b=c(()=>i.value.currentSort.startsWith("dateTaken")),S=c(()=>i.value.currentSort==="dateTaken-desc"),k=()=>{i.value.currentSort="shuffle",i.value.availableSorts.findIndex(e=>e.key==="shuffle")===-1&&i.value.availableSorts.push({key:"shuffle",labelI18n:"ui.action.sort.options.shuffle",icon:"tabler:dice-3",value:()=>Math.random(),order:"asc"})};return{sortedPhotos:a,currentSortOption:h(f),currentSortLabel:v,currentSortIcon:m,availableSorts:g,isDateSort:b,isDateSortDesc:S,setSortOption:o,toggleDateSortOrder:d,shufflePhotos:k}}const w=T({tags:[],cameras:[],lenses:[],cities:[],ratings:0,search:""});function C(){const{photos:n}=y(),{sortedPhotos:f}=I(),a=w,o=c(()=>{const e={tags:new Map,cameras:new Map,lenses:new Map,cities:new Map,ratings:new Map};return n.value.forEach(s=>{if(s.tags&&Array.isArray(s.tags)&&s.tags.forEach(t=>{e.tags.set(t,(e.tags.get(t)||0)+1)}),s.exif?.Make&&s.exif?.Model){const t=`${s.exif.Make} ${s.exif.Model}`;e.cameras.set(t,(e.cameras.get(t)||0)+1)}if(s.exif?.LensMake&&s.exif?.LensModel){const t=`${s.exif.LensMake} ${s.exif.LensModel}`;e.lenses.set(t,(e.lenses.get(t)||0)+1)}else if(s.exif?.LensModel){const t=s.exif.LensModel;e.lenses.set(t,(e.lenses.get(t)||0)+1)}if(s.city&&e.cities.set(s.city,(e.cities.get(s.city)||0)+1),s.exif?.Rating&&s.exif.Rating>0){const t=s.exif.Rating;e.ratings.set(t,(e.ratings.get(t)||0)+1)}}),e}),d=c(()=>({tags:Array.from(o.value.tags.entries()).sort((e,s)=>s[1]-e[1]).map(([e,s])=>({label:e,count:s})),cameras:Array.from(o.value.cameras.entries()).sort((e,s)=>e[0].localeCompare(s[0])).map(([e,s])=>({label:e,count:s})),lenses:Array.from(o.value.lenses.entries()).sort((e,s)=>e[0].localeCompare(s[0])).map(([e,s])=>({label:e,count:s})),cities:Array.from(o.value.cities.entries()).sort((e,s)=>s[1]-e[1]).map(([e,s])=>({label:e,count:s})),ratings:Array.from(o.value.ratings.entries()).sort((e,s)=>s[0]-e[0]).map(([e,s])=>({label:e,count:s}))})),g=c(()=>({tags:a.value.tags.length,cameras:a.value.cameras.length,lenses:a.value.lenses.length,cities:a.value.cities.length,ratings:a.value.ratings>0?1:0,search:a.value.search.length>0?1:0})),v=c(()=>f.value.filter(e=>{if(a.value.search){const s=a.value.search.toLowerCase();if(![e.tags?.join(" ")||"",e.exif?.Make||"",e.exif?.Model||"",e.exif?.LensMake||"",e.exif?.LensModel||"",e.city||"",e.country||"",e.title||"",e.description||"",e.storageKey||"",e.locationName||""].join(" ").toLowerCase().includes(s))return!1}if(a.value.tags.length>0){const s=e.tags||[];if(!a.value.tags.some(l=>s.includes(l)))return!1}if(a.value.cameras.length>0){const s=e.exif?.Make&&e.exif?.Model?`${e.exif.Make} ${e.exif.Model}`:null;if(!s||!a.value.cameras.includes(s))return!1}if(a.value.lenses.length>0){const s=e.exif?.LensMake&&e.exif?.LensModel?`${e.exif.LensMake} ${e.exif.LensModel}`:e.exif?.LensModel||null;if(!s||!a.value.lenses.includes(s))return!1}return!(a.value.cities.length>0&&(!e.city||!a.value.cities.includes(e.city))||a.value.ratings>0&&(e.exif?.Rating||0)<a.value.ratings)})),m=(e,s)=>{const t=a.value[e],l=t.indexOf(s);l===-1?t.push(s):t.splice(l,1)},b=()=>{a.value={tags:[],cameras:[],lenses:[],cities:[],ratings:0,search:""}},S=e=>{e==="ratings"||e==="search"?a.value[e]=e==="ratings"?0:"":a.value[e]=[]},k=(e,s)=>a.value[e].includes(s),r=c(()=>a.value.tags.length>0||a.value.cameras.length>0||a.value.lenses.length>0||a.value.cities.length>0||a.value.ratings>0||a.value.search.length>0);return{activeFilters:a,availableFilters:d,selectedCounts:g,filteredPhotos:v,hasActiveFilters:r,toggleFilter:m,clearAllFilters:b,clearFilterType:S,isFilterSelected:k}}export{I as a,C as u};
