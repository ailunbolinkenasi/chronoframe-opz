import{C as ge,aJ as Ee,M as Y,o as q,w as R,N as S,H as we,O as b,aM as se,aS as qe,aU as ie,j as I,aY as M,i as L,bN as le,r as N,bv as oe,bO as ue,y as Se,p as x,bP as xe,a as te,a2 as y,c as $,R as V,b as Ie,d as z,t as P,bQ as Fe,v as ae,A as je,bf as W,z as Be,bR as Ne,K as U,bS as ke,bT as Oe,Y as $e,a_ as ze,bU as re,bV as ne}from"./Cpc0UKJE.js";var Pe=ge({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(r){const a=r;return Ee(),(l,n)=>(q(),Y(b(se),we(a,{onMousedown:n[0]||(n[0]=i=>{!i.defaultPrevented&&i.detail>1&&i.preventDefault()})}),{default:R(()=>[S(l.$slots,"default")]),_:3},16))}}),Ae=Pe;const Ce={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between gap-1",label:"block font-medium text-default",container:"relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}},orientation:{vertical:{container:"mt-1"},horizontal:{root:"flex justify-between place-items-baseline gap-2"}}},defaultVariants:{size:"md",orientation:"vertical"}},Ke=["id"],De=["id"],Ve=["id"],We=["id"],Ge={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1,default:void 0},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},orientation:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(r){const a=r,l=qe(),n=ie(),i=I(()=>M({extend:M(Ce),...n.ui?.formField||{}})({size:a.size,required:a.required,orientation:a.orientation})),g=L(le,null),c=I(()=>a.error||g?.value?.find(f=>f.name===a.name||a.errorPattern&&f.name?.match(a.errorPattern))?.message),u=N(oe()),h=u.value,E=L(ue,void 0);return Se(u,()=>{E&&a.name&&(E.value[a.name]={id:u.value,pattern:a.errorPattern})},{immediate:!0}),x(Fe,u),x(xe,I(()=>({error:c.value,name:a.name,size:a.size,eagerValidation:a.eagerValidation,validateOnInputDelay:a.validateOnInputDelay,errorPattern:a.errorPattern,hint:a.hint,description:a.description,help:a.help,ariaId:h}))),(f,j)=>(q(),Y(b(se),{as:r.as,"data-orientation":r.orientation,"data-slot":"root",class:y(i.value.root({class:[a.ui?.root,a.class]}))},{default:R(()=>[te("div",{"data-slot":"wrapper",class:y(i.value.wrapper({class:a.ui?.wrapper}))},[r.label||l.label?(q(),$("div",{key:0,"data-slot":"labelWrapper",class:y(i.value.labelWrapper({class:a.ui?.labelWrapper}))},[Ie(b(Ae),{for:u.value,"data-slot":"label",class:y(i.value.label({class:a.ui?.label}))},{default:R(()=>[S(f.$slots,"label",{label:r.label},()=>[z(P(r.label),1)])]),_:3},8,["for","class"]),r.hint||l.hint?(q(),$("span",{key:0,id:`${b(h)}-hint`,"data-slot":"hint",class:y(i.value.hint({class:a.ui?.hint}))},[S(f.$slots,"hint",{hint:r.hint},()=>[z(P(r.hint),1)])],10,Ke)):V("",!0)],2)):V("",!0),r.description||l.description?(q(),$("p",{key:1,id:`${b(h)}-description`,"data-slot":"description",class:y(i.value.description({class:a.ui?.description}))},[S(f.$slots,"description",{description:r.description},()=>[z(P(r.description),1)])],10,De)):V("",!0)],2),te("div",{class:y([(r.label||!!l.label||r.description||!!l.description)&&i.value.container({class:a.ui?.container})])},[S(f.$slots,"default",{error:c.value}),a.error!==!1&&(typeof c.value=="string"&&c.value||l.error)?(q(),$("div",{key:0,id:`${b(h)}-error`,"data-slot":"error",class:y(i.value.error({class:a.ui?.error}))},[S(f.$slots,"error",{error:c.value},()=>[z(P(c.value),1)])],10,Ve)):r.help||l.help?(q(),$("div",{key:1,id:`${b(h)}-help`,"data-slot":"help",class:y(i.value.help({class:a.ui?.help}))},[S(f.$slots,"help",{help:r.help},()=>[z(P(r.help),1)])],10,We)):V("",!0)],2)]),_:3},8,["as","data-orientation","class"]))}};function Re(r){return"schema"in r&&typeof r.coercer=="function"&&typeof r.validator=="function"&&typeof r.refiner=="function"}function Me(r){return"~standard"in r}async function Le(r,a){const l=await a["~standard"].validate(r);return l.issues?{errors:l.issues?.map(n=>({name:n.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:n.message}))||[],result:null}:{errors:null,result:l.value}}async function Te(r,a){const[l,n]=a.validate(r);return l?{errors:l.failures().map(g=>({message:g.message,name:g.path.join(".")})),result:null}:{errors:null,result:n}}function Ue(r,a){if(Me(a))return Le(r,a);if(Re(a))return Te(r,a);throw new Error("Form validation failed: Unsupported form schema")}function Ye(r,a){return a?a.split(".").reduce((n,i)=>n?.[i],r):r}function He(r,a,l){if(!a)return Object.assign(r,l);if(!r)return r;const n=a.split(".");let i=r;for(let c=0;c<n.length-1;c++){const u=n[c];(i[u]===void 0||i[u]===null)&&(c+1<n.length&&!Number.isNaN(Number(n[c+1]))?i[u]=[]:i[u]={}),i=i[u]}const g=n[n.length-1];return i[g]=l,r}class A extends Error{formId;errors;constructor(a,l){super("Form validation exception"),this.formId=a,this.errors=l,Object.setPrototypeOf(this,A.prototype)}}const Je={base:""},Xe={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:null,required:!1},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},name:{type:null,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},nested:{type:Boolean,required:!1},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(r,{expose:a,emit:l}){const n=r,i=l,g=ie(),c=I(()=>M({extend:M(Je),...g.ui?.form||{}})),u=n.id??oe(),h=Ne(`form-${u}`),E=n.nested===!0&&L(ne,void 0),f=n.nested===!0?L(re,void 0):void 0,j=I(()=>f?.value?n.name?Ye(f.value,n.name):f.value:n.state);x(ne,h),x(re,j);const k=N(new Map);ae(async()=>{E&&(await je(),E.emit({type:"attach",validate:O,formId:u,name:n.name,api:ee}))}),Be(()=>{h.reset(),E&&E.emit({type:"detach",formId:u})}),ae(async()=>{h.on(async e=>{e.type==="attach"?k.value.set(e.formId,{validate:e.validate,name:e.name,api:e.api}):e.type==="detach"?k.value.delete(e.formId):n.validateOn?.includes(e.type)&&!F.value&&(e.type!=="input"?await O({name:e.name,silent:!0,nested:!1}):(e.eager||T.has(e.name))&&await O({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&T.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&H.add(e.name),(e.type==="change"||e.type==="input")&&K.add(e.name)})});const d=N([]);x(le,d);const C=N({});x(ue,C);const K=U(new Set),H=U(new Set),T=U(new Set);function J(e){return e.map(t=>({...t,id:t?.name?C.value[t.name]?.id:void 0}))}const D=N(null);async function de(){let e=n.validate?await n.validate(j.value)??[]:[];if(n.schema){const{errors:t,result:s}=await Ue(j.value,n.schema);t?e=e.concat(t):D.value=s}return J(e)}async function O(e={silent:!1,nested:!1,transform:!1}){const t=e.name&&!Array.isArray(e.name)?[e.name]:e.name;let s=[],o=[];if(!t&&e.nested){const w=Array.from(k.value.values()).map(v=>ce(v,e)),p=await Promise.all(w);o=p.filter(v=>v.error).flatMap(v=>v.error.errors.map(be=>fe(be,v.name))),s=p.filter(v=>v.output!==void 0)}const B=[...await de(),...o];if(t?d.value=ye(B,t):d.value=B,d.value?.length){if(e.silent)return!1;throw new A(u,d.value)}return e.transform?(s.forEach(w=>{w.name?He(D.value,w.name,w.output):Object.assign(D.value,w.output)}),D.value??j.value):j.value}const F=N(!1);x(ke,W(F));async function Q(e){F.value=n.loadingAuto&&!0;const t=e;try{t.data=await O({nested:!0,transform:n.transform}),await n.onSubmit?.(t),K.clear()}catch(s){if(!(s instanceof A))throw s;const o={...t,errors:s.errors};i("error",o)}finally{F.value=!1}}const G=I(()=>n.disabled||F.value);x(Oe,I(()=>({disabled:G.value,validateOnInputDelay:n.validateOnInputDelay})));async function ce(e,t){try{const s=await e.validate({...t,silent:!1});return{name:e.name,output:s}}catch(s){if(!(s instanceof A))throw s;return{name:e.name,error:s}}}function fe(e,t){return!t||!e.name?e:{...e,name:t+"."+e.name}}function me(e,t){const s=t+".",o=e?.name?.startsWith(s)?e.name.substring(s.length):e.name;return{...e,name:o}}function pe(e,t){return t?e.filter(s=>s?.name?.startsWith(t+".")).map(s=>me(s,t)):e}function X(e){return e.api.getErrors().map(t=>e.name?{...t,name:e.name+"."+t.name}:t)}function Z(e,t){return!e||!t?!0:e instanceof RegExp?e.test(t):t===e||typeof e=="string"&&e.startsWith(t+".")}function ve(e,t){if(!e||e instanceof RegExp)return e;if(t!==e)return typeof e=="string"&&e.startsWith(t+".")?e.substring(t.length+1):e}function ye(e,t){const s=new Set(t),o=t.map(p=>C.value?.[p]?.pattern).filter(Boolean),m=p=>p.name?s.has(p.name)?!0:o.some(v=>v.test(p.name)):!1,B=d.value.filter(p=>!m(p)),w=e.filter(m);return[...B,...w]}function he(e,t){return e.filter(s=>t instanceof RegExp?!(s.name&&t.test(s.name)):!s.name||s.name!==t)}function _(e){return!e.name||!!C.value[e.name]}const ee={validate:O,errors:d,setErrors(e,t){const s=J(e.filter(_)),o=[];for(const m of k.value.values())if(Z(t,m.name)){const B=pe(e,m.name);m.api.setErrors(B,ve(t,m.name||"")),o.push(...X(m))}if(t){const m=he(d.value,t);d.value=[...m,...s,...o]}else d.value=[...s,...o]},async submit(){await Q(new Event("submit"))},getErrors(e){return e?d.value.filter(t=>e instanceof RegExp?t.name&&e.test(t.name):t.name===e):d.value},clear(e){const t=e?d.value.filter(o=>_(o)&&(e instanceof RegExp?!(o.name&&e.test(o.name)):o.name!==e)):[],s=[];for(const o of k.value.values())Z(e,o.name)&&o.api.clear(),s.push(...X(o));d.value=[...t,...s]},disabled:G,loading:F,dirty:I(()=>!!K.size),dirtyFields:W(K),blurredFields:W(T),touchedFields:W(H)};return a(ee),(e,t)=>(q(),Y(ze(b(E)?"div":"form"),{id:b(u),class:y(c.value({class:n.class})),onSubmit:$e(Q,["prevent"])},{default:R(()=>[S(e.$slots,"default",{errors:d.value,loading:F.value})]),_:3},40,["id","class"]))}};export{Ae as L,Xe as _,Ge as a};
