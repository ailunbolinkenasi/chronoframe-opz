import{C as G,aa as Q,ab as Z,j as c,ay as q,aD as J,as as K,r as X,v as tt,z as et,aE as at,u as st,c as p,M as $,R as b,O as a,b as o,a as e,t as r,F as ot,w as h,a1 as nt,ai as lt,a4 as rt,aA as it,a7 as ct,aF as ut,o as i,av as dt,a0 as M,a6 as mt,d as pt,an as ht}from"./Cpc0UKJE.js";import{_ as _t}from"./-p0RoiZc.js";import{_ as xt}from"./CkRCXFjB.js";import"./Ber5b4Yw.js";import"./Ct_BEpIm.js";import"./C7QMAU0h.js";import"./B7XY3PeF.js";const ft={class:"relative w-full"},bt={key:0,class:"flex flex-col items-center justify-center min-h-[50vh] gap-4"},vt={class:"text-sm text-neutral-600 dark:text-neutral-400"},gt={key:0,class:"absolute inset-0 h-2/3 sm:h-[500px] overflow-hidden -z-10"},kt={class:"relative container mx-auto px-4 sm:px-6 lg:px-8 pt-4 z-10"},yt={class:"relative container mx-auto px-4 sm:px-6 lg:px-8 py-8 z-10"},wt={class:"text-3xl sm:text-4xl font-bold text-neutral-900 dark:text-white tracking-tight"},$t={class:"flex flex-col gap-4"},Mt={class:"text-base text-neutral-600 dark:text-neutral-300 leading-relaxed max-w-2xl"},Tt={class:"flex flex-wrap items-center gap-4 text-sm"},It={class:"flex items-center gap-1"},Yt={class:"text-neutral-700 dark:text-neutral-200"},zt={class:"text-neutral-900 dark:text-white"},At={class:"text-neutral-500 dark:text-neutral-400 ml-1"},Ct={key:0,class:"flex items-center gap-1"},Dt={class:"text-neutral-700 dark:text-neutral-200"},jt=["title"],Bt={class:"text-neutral-700 dark:text-neutral-200"},Et={class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},Rt={key:0,class:"flex flex-col items-center justify-center gap-6 px-4"},St={class:"flex flex-col items-center gap-4"},Vt={class:"text-center"},Nt={class:"text-xl font-normal text-neutral-800 dark:text-neutral-200 mb-2"},Ft={key:2,class:"flex flex-col items-center justify-center min-h-[50vh] gap-6"},Pt={class:"flex flex-col items-center gap-4"},Lt={class:"text-center"},Ot={class:"text-2xl font-semibold text-neutral-800 dark:text-neutral-200 mb-2"},Ut={class:"text-base text-neutral-600 dark:text-neutral-400 max-w-md"},Wt=4,ee=G({__name:"[albumId]",async setup(Ht){let f,T;const E=Q(),I=Z(),R=ct(),v=c(()=>{const t=E.params.albumId;return parseInt(t,10)}),{data:S,error:V,pending:N}=([f,T]=q(()=>it(()=>`/api/albums/${v.value}`,{watch:[v]},"$uo2msZufrb")),f=await f,T(),f);if(V.value)throw J({statusCode:404,statusMessage:"Album not found"});const n=c(()=>S.value),g=c(()=>{if(!n.value)return null;const t=n.value.photos||[],s=t.length,d=t.filter(l=>l.dateTaken).length,x=t.filter(l=>l.exif).length,u=t.map(l=>l?.dateTaken).filter(l=>!!l).map(l=>R(l)).sort((l,w)=>l.isBefore(w)?-1:1),m=u.length>0?{start:u[0],end:u[u.length-1]}:null;return{total:s,withDates:d,withExif:x,dateRange:m}}),Y=c(()=>{const t=g.value?.dateRange;return!t||!t.start||!t.end?null:t.start.isSame(t.end,"day")?t.start.format("ll"):t.start.isSame(t.end,"month")?t.start.format("MMM YYYY"):t.start.isSame(t.end,"year")?`${t.start.format("MMM")} - ${t.end.format("MMM YYYY")}`:`${t.start.format("ll")} - ${t.end.format("ll")}`}),z=c(()=>n.value?.photos?.map((t,s)=>({id:t.id,photo:t,originalIndex:s}))??[]),k=K("(max-width: 768px)"),F=c(()=>(k.value,280)),P=c(()=>k.value?2:8),L=c(()=>(k.value,2)),O=t=>{const s=n.value?.photos;if(s&&s[t]){const{openViewer:d}=ht(),x=`/albums/${v.value}`;d(0,x),I.push(`/${s[t].id}`)}},y=c(()=>{const t=n.value;if(!t?.photos)return null;if(t.coverPhotoId){const s=t.photos.find(d=>d.id===t.coverPhotoId);if(s)return s}return t.photos[0]||null}),U=()=>{window.scrollTo({top:0,behavior:"smooth"})},A=X(!1),C=()=>{const t=window.pageYOffset||document.documentElement.scrollTop;A.value=t>500},D=()=>{I.push("/albums")};return tt(()=>{window.addEventListener("scroll",C,{passive:!0})}),et(()=>{window.removeEventListener("scroll",C)}),at(()=>{st({title:n.value?n.value.title:"Album Not Found"})}),(t,s)=>{const d=dt,x=nt,u=lt,m=mt,l=rt,w=_t,W=ut("MasonryWall"),H=xt;return i(),p("div",ft,[a(N)?(i(),p("div",bt,[o(d,{name:"tabler:loader",class:"animate-spin size-8 text-primary-600"}),e("p",vt,r(t.$t("ui.loading")),1)])):a(n)?(i(),p(ot,{key:1},[a(y)?(i(),p("div",gt,[o(x,{src:a(y).thumbnailUrl||"",thumbhash:a(y).thumbnailHash,alt:a(n).title,class:"w-full h-full object-cover opacity-40 dark:opacity-20 scale-110 saturate-150"},null,8,["src","thumbhash","alt"]),s[1]||(s[1]=e("div",{class:"absolute -inset-1 bg-gradient-to-b from-transparent via-white/50 to-white dark:via-neutral-900/50 dark:to-neutral-900 backdrop-blur-xl sm:backdrop-blur-2xl"},null,-1))])):b("",!0),e("div",kt,[o(u,{variant:"ghost",color:"neutral",icon:"tabler:arrow-left",size:"sm",onClick:D})]),e("div",yt,[o(l,null,{default:h(()=>[o(a(M).div,{class:"flex flex-col gap-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4}},{default:h(()=>[e("div",null,[e("h1",wt,r(a(n).title),1)]),e("div",$t,[e("p",Mt,r(a(n).description||t.$t("album.noDescription")),1),e("div",Tt,[e("div",It,[o(m,{name:"tabler:photo",class:"size-4 -mt-0.5 text-neutral-400 dark:text-neutral-500"}),e("span",Yt,[e("span",zt,r(a(g)?.total||0),1),e("span",At,r(t.$t("album.metadata.photos")),1)])]),a(Y)?(i(),p("div",Ct,[o(m,{name:"tabler:calendar",class:"size-4 -mt-0.5 text-neutral-400 dark:text-neutral-500"}),e("span",Dt,r(a(Y)),1)])):b("",!0),e("div",{class:"flex items-center gap-1",title:`Created: ${t.$dayjs(a(n).createdAt).format("YYYY-MM-DD HH:mm:ss")}`},[o(m,{name:"tabler:clock-plus",class:"size-4 -mt-0.5 text-neutral-400 dark:text-neutral-500"}),e("span",Bt,r(t.$t("album.metadata.created"))+" "+r(t.$dayjs(a(n).createdAt).fromNow()),1)],8,jt)])])]),_:1})]),_:1})]),e("div",Et,[o(a(M).div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2,duration:.4}},{default:h(()=>[a(g)?.total===0?(i(),p("div",Rt,[e("div",St,[o(m,{name:"tabler:library-photo",class:"size-20 text-neutral-300 dark:text-neutral-600"}),e("div",Vt,[e("p",Nt,r(t.$t("album.emptyAlbumTitle")),1)])])])):(i(),$(W,{key:1,items:a(z),"column-width":a(F),gap:Wt,"min-columns":a(L),"max-columns":a(P),"ssr-columns":2,"key-mapper":(_,j,Gt,B)=>a(z)[B]?.originalIndex??B},{default:h(({item:_})=>[_.photo&&typeof _.originalIndex=="number"?(i(),$(w,{key:_.photo.id,photo:_.photo,index:_.originalIndex,"has-animated":!1,"first-screen-items":50,onOpenViewer:s[0]||(s[0]=j=>O(j))},null,8,["photo","index"])):b("",!0)]),_:1},8,["items","column-width","min-columns","max-columns","key-mapper"]))]),_:1})])],64)):(i(),p("div",Ft,[e("div",Pt,[o(m,{name:"tabler:alert-circle",class:"size-20 text-red-400"}),e("div",Lt,[e("p",Ot,r(t.$t("album.failedToLoadTitle")),1),e("p",Ut,r(t.$t("album.failedToLoadDescription")),1)])]),o(u,{onClick:D},{default:h(()=>[pt(r(t.$t("album.backToAlbums")),1)]),_:1})])),a(A)?(i(),$(a(M).div,{key:3,class:"fixed bottom-6 right-6 z-50",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2}},{default:h(()=>[o(H,{text:t.$t("ui.action.backtotop.tooltip")||"回到顶部"},{default:h(()=>[o(u,{variant:"soft",color:"neutral",class:"cursor-pointer bg-white/80 dark:bg-neutral-900/80 backdrop-blur-sm flex justify-center items-center rounded-full shadow-lg hover:bg-white dark:hover:bg-neutral-800 transition-all duration-300 border border-neutral-200/50 dark:border-neutral-700/50",icon:"tabler:arrow-up",size:"lg","aria-label":t.$t("ui.action.backtotop.ariaLabel")||"回到顶部",onClick:U},null,8,["aria-label"])]),_:1},8,["text"])]),_:1})):b("",!0)])}}});export{ee as default};
