const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./h5q7TK7w.js","./C7QMAU0h.js","./DqB7mOpj.js","./globe.DMGnCX0D.css","./CWquY0w7.js","./DnnPpv4o.js","./CXUgo2PS.js","./DZlQVDzI.js","./oIv4vp1I.js","./signin.pzOQo0bF.css","./D6vh96ne.js","./d9a9iJTn.js","./tOpLFj0c.js","./CkRCXFjB.js","./Ct_BEpIm.js","./B7XY3PeF.js","./index.B82zvgKF.css","./DlfXkKGz.js","./CPTTSFvb.js","./BjUXi3JB.js","./nRRCFP1b.js","./CxsYCXXx.js","./wnGbbVmH.js","./yl6JOf5H.js","./TORaEdSH.js","./BdRmTPAZ.js","./DWqTcxU8.js","./logs.CBfnDrfY.css","./BNU43CeG.js","./BRvw2RRB.js","./DCjp7yB0.js","./CNcvAVgZ.js","./ChlxyZLr.js","./CkD7dK57.js","./DVdp-WJ5.js","./DO3xSySP.js","./Bk1GAyqG.js","./DY-ki2PF.js","./CzWYPtMs.js","./BJ-5YYua.js","./index.CUy8DpGa.css","./CEoFNtWn.js","./B3yMmeEz.js","./queue.zRh0jZio.css","./BUnQTuG_.js","./JqEAUhj6.js","./-p0RoiZc.js","./Ber5b4Yw.js","./Bflrq9Dq.js","./BdLvxhSi.js","./oeIOuWWp.js","./CUD0rgH9.js","./DAh1Cfes.js","./D3oo-TiF.js","./P0jURR1P.js","./CwQgfHAY.js","./DWoFncj_.js","./BHMWGS90.js","./uqxPgdyf.js","./DUJhRkkJ.js","./photos.Crm_RP7c.css","./9BuRqA7D.js","./CYsNApKr.js","./BdrDmh0N.js","./Bomo6AKB.js","./--MkVbCh.js","./Chyyx_Sw.js","./DxYeMTBz.js","./BMao8UwI.js","./fhyz3SjZ.js","./CdOLjBaA.js","./masonry.DlwkMSp5.css","./D3HY_UOx.js","./error-404.CmChmTQO.css","./WLSwQphl.js","./error-500.CCJUzeKo.css"])))=>i.map(i=>d[i]);
(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))l(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function s(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(p){if(p.ep)return;p.ep=!0;const _=s(p);fetch(p.href,_)}})();function qP(e){const i=Object.create(null);for(const s of e.split(","))i[s]=1;return s=>s in i}const ha={},Fx=[],Pg=()=>{},UF=()=>!1,Zw=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),HP=e=>e.startsWith("onUpdate:"),jc=Object.assign,WP=(e,i)=>{const s=e.indexOf(i);s>-1&&e.splice(s,1)},RU=Object.prototype.hasOwnProperty,Ma=(e,i)=>RU.call(e,i),xs=Array.isArray,Bx=e=>Xw(e)==="[object Map]",$F=e=>Xw(e)==="[object Set]",zU=e=>Xw(e)==="[object RegExp]",Bs=e=>typeof e=="function",Cl=e=>typeof e=="string",Q_=e=>typeof e=="symbol",sl=e=>e!==null&&typeof e=="object",ZP=e=>(sl(e)||Bs(e))&&Bs(e.then)&&Bs(e.catch),GF=Object.prototype.toString,Xw=e=>GF.call(e),OU=e=>Xw(e).slice(8,-1),XP=e=>Xw(e)==="[object Object]",LE=e=>Cl(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Nx=qP(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),RE=e=>{const i=Object.create(null);return(s=>i[s]||(i[s]=e(s)))},FU=/-\w/g,cd=RE(e=>e.replace(FU,i=>i.slice(1).toUpperCase())),BU=/\B([A-Z])/g,ey=RE(e=>e.replace(BU,"-$1").toLowerCase()),zE=RE(e=>e.charAt(0).toUpperCase()+e.slice(1)),sw=RE(e=>e?`on${zE(e)}`:""),sd=(e,i)=>!Object.is(e,i),ow=(e,...i)=>{for(let s=0;s<e.length;s++)e[s](...i)},qF=(e,i,s,l=!1)=>{Object.defineProperty(e,i,{configurable:!0,enumerable:!1,writable:l,value:s})},NU=e=>{const i=parseFloat(e);return isNaN(i)?e:i},HF=e=>{const i=Cl(e)?Number(e):NaN;return isNaN(i)?e:i};let wL;const OE=()=>wL||(wL=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Su(e){if(xs(e)){const i={};for(let s=0;s<e.length;s++){const l=e[s],p=Cl(l)?$U(l):Su(l);if(p)for(const _ in p)i[_]=p[_]}return i}else if(Cl(e)||sl(e))return e}const VU=/;(?![^(]*\))/g,jU=/:([^]+)/,UU=/\/\*[^]*?\*\//g;function $U(e){const i={};return e.replace(UU,"").split(VU).forEach(s=>{if(s){const l=s.split(jU);l.length>1&&(i[l[0].trim()]=l[1].trim())}}),i}function _s(e){let i="";if(Cl(e))i=e;else if(xs(e))for(let s=0;s<e.length;s++){const l=_s(e[s]);l&&(i+=l+" ")}else if(sl(e))for(const s in e)e[s]&&(i+=s+" ");return i.trim()}function Ap(e){if(!e)return null;let{class:i,style:s}=e;return i&&!Cl(i)&&(e.class=_s(i)),s&&(e.style=Su(s)),e}const GU="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",qU=qP(GU);function WF(e){return!!e||e===""}const ZF=e=>!!(e&&e.__v_isRef===!0),Lr=e=>Cl(e)?e:e==null?"":xs(e)||sl(e)&&(e.toString===GF||!Bs(e.toString))?ZF(e)?Lr(e.value):JSON.stringify(e,XF,2):String(e),XF=(e,i)=>ZF(i)?XF(e,i.value):Bx(i)?{[`Map(${i.size})`]:[...i.entries()].reduce((s,[l,p],_)=>(s[cC(l,_)+" =>"]=p,s),{})}:$F(i)?{[`Set(${i.size})`]:[...i.values()].map(s=>cC(s))}:Q_(i)?cC(i):sl(i)&&!xs(i)&&!XP(i)?String(i):i,cC=(e,i="")=>{var s;return Q_(e)?`Symbol(${(s=e.description)!=null?s:i})`:e};let Ih;class YF{constructor(i=!1){this.detached=i,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ih,!i&&Ih&&(this.index=(Ih.scopes||(Ih.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let i,s;if(this.scopes)for(i=0,s=this.scopes.length;i<s;i++)this.scopes[i].pause();for(i=0,s=this.effects.length;i<s;i++)this.effects[i].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let i,s;if(this.scopes)for(i=0,s=this.scopes.length;i<s;i++)this.scopes[i].resume();for(i=0,s=this.effects.length;i<s;i++)this.effects[i].resume()}}run(i){if(this._active){const s=Ih;try{return Ih=this,i()}finally{Ih=s}}}on(){++this._on===1&&(this.prevScope=Ih,Ih=this)}off(){this._on>0&&--this._on===0&&(Ih=this.prevScope,this.prevScope=void 0)}stop(i){if(this._active){this._active=!1;let s,l;for(s=0,l=this.effects.length;s<l;s++)this.effects[s].stop();for(this.effects.length=0,s=0,l=this.cleanups.length;s<l;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,l=this.scopes.length;s<l;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!i){const p=this.parent.scopes.pop();p&&p!==this&&(this.parent.scopes[this.index]=p,p.index=this.index)}this.parent=void 0}}}function s0(e){return new YF(e)}function Rp(){return Ih}function H_(e,i=!1){Ih&&Ih.cleanups.push(e)}let fl;const uC=new WeakSet;class KF{constructor(i){this.fn=i,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ih&&Ih.active&&Ih.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,uC.has(this)&&(uC.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||QF(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,TL(this),e5(this);const i=fl,s=wm;fl=this,wm=!0;try{return this.fn()}finally{t5(this),fl=i,wm=s,this.flags&=-3}}stop(){if(this.flags&1){for(let i=this.deps;i;i=i.nextDep)JP(i);this.deps=this.depsTail=void 0,TL(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?uC.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){_A(this)&&this.run()}get dirty(){return _A(this)}}let JF=0,aw,lw;function QF(e,i=!1){if(e.flags|=8,i){e.next=lw,lw=e;return}e.next=aw,aw=e}function YP(){JF++}function KP(){if(--JF>0)return;if(lw){let i=lw;for(lw=void 0;i;){const s=i.next;i.next=void 0,i.flags&=-9,i=s}}let e;for(;aw;){let i=aw;for(aw=void 0;i;){const s=i.next;if(i.next=void 0,i.flags&=-9,i.flags&1)try{i.trigger()}catch(l){e||(e=l)}i=s}}if(e)throw e}function e5(e){for(let i=e.deps;i;i=i.nextDep)i.version=-1,i.prevActiveLink=i.dep.activeLink,i.dep.activeLink=i}function t5(e){let i,s=e.depsTail,l=s;for(;l;){const p=l.prevDep;l.version===-1?(l===s&&(s=p),JP(l),HU(l)):i=l,l.dep.activeLink=l.prevActiveLink,l.prevActiveLink=void 0,l=p}e.deps=i,e.depsTail=s}function _A(e){for(let i=e.deps;i;i=i.nextDep)if(i.dep.version!==i.version||i.dep.computed&&(i5(i.dep.computed)||i.dep.version!==i.version))return!0;return!!e._dirty}function i5(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Ew)||(e.globalVersion=Ew,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!_A(e))))return;e.flags|=2;const i=e.dep,s=fl,l=wm;fl=e,wm=!0;try{e5(e);const p=e.fn(e._value);(i.version===0||sd(p,e._value))&&(e.flags|=128,e._value=p,i.version++)}catch(p){throw i.version++,p}finally{fl=s,wm=l,t5(e),e.flags&=-3}}function JP(e,i=!1){const{dep:s,prevSub:l,nextSub:p}=e;if(l&&(l.nextSub=p,e.prevSub=void 0),p&&(p.prevSub=l,e.nextSub=void 0),s.subs===e&&(s.subs=l,!l&&s.computed)){s.computed.flags&=-5;for(let _=s.computed.deps;_;_=_.nextDep)JP(_,!0)}!i&&!--s.sc&&s.map&&s.map.delete(s.key)}function HU(e){const{prevDep:i,nextDep:s}=e;i&&(i.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=i,e.nextDep=void 0)}let wm=!0;const n5=[];function W_(){n5.push(wm),wm=!1}function Z_(){const e=n5.pop();wm=e===void 0?!0:e}function TL(e){const{cleanup:i}=e;if(e.cleanup=void 0,i){const s=fl;fl=void 0;try{i()}finally{fl=s}}}let Ew=0;class WU{constructor(i,s){this.sub=i,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class FE{constructor(i){this.computed=i,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(i){if(!fl||!wm||fl===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==fl)s=this.activeLink=new WU(fl,this),fl.deps?(s.prevDep=fl.depsTail,fl.depsTail.nextDep=s,fl.depsTail=s):fl.deps=fl.depsTail=s,r5(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const l=s.nextDep;l.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=l),s.prevDep=fl.depsTail,s.nextDep=void 0,fl.depsTail.nextDep=s,fl.depsTail=s,fl.deps===s&&(fl.deps=l)}return s}trigger(i){this.version++,Ew++,this.notify(i)}notify(i){YP();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{KP()}}}function r5(e){if(e.dep.sc++,e.sub.flags&4){const i=e.dep.computed;if(i&&!e.dep.subs){i.flags|=20;for(let l=i.deps;l;l=l.nextDep)r5(l)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const XS=new WeakMap,ov=Symbol(""),yA=Symbol(""),Iw=Symbol("");function Ch(e,i,s){if(wm&&fl){let l=XS.get(e);l||XS.set(e,l=new Map);let p=l.get(s);p||(l.set(s,p=new FE),p.map=l,p.key=s),p.track()}}function N_(e,i,s,l,p,_){const b=XS.get(e);if(!b){Ew++;return}const t=P=>{P&&P.trigger()};if(YP(),i==="clear")b.forEach(t);else{const P=xs(e),O=P&&LE(s);if(P&&s==="length"){const F=Number(l);b.forEach(($,W)=>{(W==="length"||W===Iw||!Q_(W)&&W>=F)&&t($)})}else switch((s!==void 0||b.has(void 0))&&t(b.get(s)),O&&t(b.get(Iw)),i){case"add":P?O&&t(b.get("length")):(t(b.get(ov)),Bx(e)&&t(b.get(yA)));break;case"delete":P||(t(b.get(ov)),Bx(e)&&t(b.get(yA)));break;case"set":Bx(e)&&t(b.get(ov));break}}KP()}function ZU(e,i){const s=XS.get(e);return s&&s.get(i)}function Sx(e){const i=zo(e);return i===e?i:(Ch(i,"iterate",Iw),Nf(e)?i:i.map(Im))}function BE(e){return Ch(e=zo(e),"iterate",Iw),e}function Xy(e,i){return Rg(e)?Tm(e)?Zx(Im(i)):Zx(i):Im(i)}const XU={__proto__:null,[Symbol.iterator](){return hC(this,Symbol.iterator,e=>Xy(this,e))},concat(...e){return Sx(this).concat(...e.map(i=>xs(i)?Sx(i):i))},entries(){return hC(this,"entries",e=>(e[1]=Xy(this,e[1]),e))},every(e,i){return C_(this,"every",e,i,void 0,arguments)},filter(e,i){return C_(this,"filter",e,i,s=>s.map(l=>Xy(this,l)),arguments)},find(e,i){return C_(this,"find",e,i,s=>Xy(this,s),arguments)},findIndex(e,i){return C_(this,"findIndex",e,i,void 0,arguments)},findLast(e,i){return C_(this,"findLast",e,i,s=>Xy(this,s),arguments)},findLastIndex(e,i){return C_(this,"findLastIndex",e,i,void 0,arguments)},forEach(e,i){return C_(this,"forEach",e,i,void 0,arguments)},includes(...e){return dC(this,"includes",e)},indexOf(...e){return dC(this,"indexOf",e)},join(e){return Sx(this).join(e)},lastIndexOf(...e){return dC(this,"lastIndexOf",e)},map(e,i){return C_(this,"map",e,i,void 0,arguments)},pop(){return N1(this,"pop")},push(...e){return N1(this,"push",e)},reduce(e,...i){return SL(this,"reduce",e,i)},reduceRight(e,...i){return SL(this,"reduceRight",e,i)},shift(){return N1(this,"shift")},some(e,i){return C_(this,"some",e,i,void 0,arguments)},splice(...e){return N1(this,"splice",e)},toReversed(){return Sx(this).toReversed()},toSorted(e){return Sx(this).toSorted(e)},toSpliced(...e){return Sx(this).toSpliced(...e)},unshift(...e){return N1(this,"unshift",e)},values(){return hC(this,"values",e=>Xy(this,e))}};function hC(e,i,s){const l=BE(e),p=l[i]();return l!==e&&!Nf(e)&&(p._next=p.next,p.next=()=>{const _=p._next();return _.done||(_.value=s(_.value)),_}),p}const YU=Array.prototype;function C_(e,i,s,l,p,_){const b=BE(e),t=b!==e&&!Nf(e),P=b[i];if(P!==YU[i]){const $=P.apply(e,_);return t?Im($):$}let O=s;b!==e&&(t?O=function($,W){return s.call(this,Xy(e,$),W,e)}:s.length>2&&(O=function($,W){return s.call(this,$,W,e)}));const F=P.call(b,O,l);return t&&p?p(F):F}function SL(e,i,s,l){const p=BE(e);let _=s;return p!==e&&(Nf(e)?s.length>3&&(_=function(b,t,P){return s.call(this,b,t,P,e)}):_=function(b,t,P){return s.call(this,b,Xy(e,t),P,e)}),p[i](_,...l)}function dC(e,i,s){const l=zo(e);Ch(l,"iterate",Iw);const p=l[i](...s);return(p===-1||p===!1)&&jE(s[0])?(s[0]=zo(s[0]),l[i](...s)):p}function N1(e,i,s=[]){W_(),YP();const l=zo(e)[i].apply(e,s);return KP(),Z_(),l}const KU=qP("__proto__,__v_isRef,__isVue"),s5=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Q_));function JU(e){Q_(e)||(e=String(e));const i=zo(this);return Ch(i,"has",e),i.hasOwnProperty(e)}class o5{constructor(i=!1,s=!1){this._isReadonly=i,this._isShallow=s}get(i,s,l){if(s==="__v_skip")return i.__v_skip;const p=this._isReadonly,_=this._isShallow;if(s==="__v_isReactive")return!p;if(s==="__v_isReadonly")return p;if(s==="__v_isShallow")return _;if(s==="__v_raw")return l===(p?_?d5:h5:_?u5:c5).get(i)||Object.getPrototypeOf(i)===Object.getPrototypeOf(l)?i:void 0;const b=xs(i);if(!p){let P;if(b&&(P=XU[s]))return P;if(s==="hasOwnProperty")return JU}const t=Reflect.get(i,s,Wo(i)?i:l);if((Q_(s)?s5.has(s):KU(s))||(p||Ch(i,"get",s),_))return t;if(Wo(t)){const P=b&&LE(s)?t:t.value;return p&&sl(P)?Pp(P):P}return sl(t)?p?Pp(t):Ol(t):t}}class a5 extends o5{constructor(i=!1){super(!1,i)}set(i,s,l,p){let _=i[s];const b=xs(i)&&LE(s);if(!this._isShallow){const O=Rg(_);if(!Nf(l)&&!Rg(l)&&(_=zo(_),l=zo(l)),!b&&Wo(_)&&!Wo(l))return O||(_.value=l),!0}const t=b?Number(s)<i.length:Ma(i,s),P=Reflect.set(i,s,l,Wo(i)?i:p);return i===zo(p)&&(t?sd(l,_)&&N_(i,"set",s,l):N_(i,"add",s,l)),P}deleteProperty(i,s){const l=Ma(i,s);i[s];const p=Reflect.deleteProperty(i,s);return p&&l&&N_(i,"delete",s,void 0),p}has(i,s){const l=Reflect.has(i,s);return(!Q_(s)||!s5.has(s))&&Ch(i,"has",s),l}ownKeys(i){return Ch(i,"iterate",xs(i)?"length":ov),Reflect.ownKeys(i)}}class l5 extends o5{constructor(i=!1){super(!0,i)}set(i,s){return!0}deleteProperty(i,s){return!0}}const QU=new a5,e$=new l5,t$=new a5(!0),i$=new l5(!0),vA=e=>e,LT=e=>Reflect.getPrototypeOf(e);function n$(e,i,s){return function(...l){const p=this.__v_raw,_=zo(p),b=Bx(_),t=e==="entries"||e===Symbol.iterator&&b,P=e==="keys"&&b,O=p[e](...l),F=s?vA:i?Zx:Im;return!i&&Ch(_,"iterate",P?yA:ov),{next(){const{value:$,done:W}=O.next();return W?{value:$,done:W}:{value:t?[F($[0]),F($[1])]:F($),done:W}},[Symbol.iterator](){return this}}}}function RT(e){return function(...i){return e==="delete"?!1:e==="clear"?void 0:this}}function r$(e,i){const s={get(p){const _=this.__v_raw,b=zo(_),t=zo(p);e||(sd(p,t)&&Ch(b,"get",p),Ch(b,"get",t));const{has:P}=LT(b),O=i?vA:e?Zx:Im;if(P.call(b,p))return O(_.get(p));if(P.call(b,t))return O(_.get(t));_!==b&&_.get(p)},get size(){const p=this.__v_raw;return!e&&Ch(zo(p),"iterate",ov),p.size},has(p){const _=this.__v_raw,b=zo(_),t=zo(p);return e||(sd(p,t)&&Ch(b,"has",p),Ch(b,"has",t)),p===t?_.has(p):_.has(p)||_.has(t)},forEach(p,_){const b=this,t=b.__v_raw,P=zo(t),O=i?vA:e?Zx:Im;return!e&&Ch(P,"iterate",ov),t.forEach((F,$)=>p.call(_,O(F),O($),b))}};return jc(s,e?{add:RT("add"),set:RT("set"),delete:RT("delete"),clear:RT("clear")}:{add(p){!i&&!Nf(p)&&!Rg(p)&&(p=zo(p));const _=zo(this);return LT(_).has.call(_,p)||(_.add(p),N_(_,"add",p,p)),this},set(p,_){!i&&!Nf(_)&&!Rg(_)&&(_=zo(_));const b=zo(this),{has:t,get:P}=LT(b);let O=t.call(b,p);O||(p=zo(p),O=t.call(b,p));const F=P.call(b,p);return b.set(p,_),O?sd(_,F)&&N_(b,"set",p,_):N_(b,"add",p,_),this},delete(p){const _=zo(this),{has:b,get:t}=LT(_);let P=b.call(_,p);P||(p=zo(p),P=b.call(_,p)),t&&t.call(_,p);const O=_.delete(p);return P&&N_(_,"delete",p,void 0),O},clear(){const p=zo(this),_=p.size!==0,b=p.clear();return _&&N_(p,"clear",void 0,void 0),b}}),["keys","values","entries",Symbol.iterator].forEach(p=>{s[p]=n$(p,e,i)}),s}function NE(e,i){const s=r$(e,i);return(l,p,_)=>p==="__v_isReactive"?!e:p==="__v_isReadonly"?e:p==="__v_raw"?l:Reflect.get(Ma(s,p)&&p in l?s:l,p,_)}const s$={get:NE(!1,!1)},o$={get:NE(!1,!0)},a$={get:NE(!0,!1)},l$={get:NE(!0,!0)},c5=new WeakMap,u5=new WeakMap,h5=new WeakMap,d5=new WeakMap;function c$(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function u$(e){return e.__v_skip||!Object.isExtensible(e)?0:c$(OU(e))}function Ol(e){return Rg(e)?e:VE(e,!1,QU,s$,c5)}function Ip(e){return VE(e,!1,t$,o$,u5)}function Pp(e){return VE(e,!0,e$,a$,h5)}function Jge(e){return VE(e,!0,i$,l$,d5)}function VE(e,i,s,l,p){if(!sl(e)||e.__v_raw&&!(i&&e.__v_isReactive))return e;const _=u$(e);if(_===0)return e;const b=p.get(e);if(b)return b;const t=new Proxy(e,_===2?l:s);return p.set(e,t),t}function Tm(e){return Rg(e)?Tm(e.__v_raw):!!(e&&e.__v_isReactive)}function Rg(e){return!!(e&&e.__v_isReadonly)}function Nf(e){return!!(e&&e.__v_isShallow)}function jE(e){return e?!!e.__v_raw:!1}function zo(e){const i=e&&e.__v_raw;return i?zo(i):e}function uv(e){return!Ma(e,"__v_skip")&&Object.isExtensible(e)&&qF(e,"__v_skip",!0),e}const Im=e=>sl(e)?Ol(e):e,Zx=e=>sl(e)?Pp(e):e;function Wo(e){return e?e.__v_isRef===!0:!1}function an(e){return f5(e,!1)}function so(e){return f5(e,!0)}function f5(e,i){return Wo(e)?e:new h$(e,i)}class h${constructor(i,s){this.dep=new FE,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?i:zo(i),this._value=s?i:Im(i),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(i){const s=this._rawValue,l=this.__v_isShallow||Nf(i)||Rg(i);i=l?i:zo(i),sd(i,s)&&(this._rawValue=i,this._value=l?i:Im(i),this.dep.trigger())}}function L_(e){e.dep&&e.dep.trigger()}function ut(e){return Wo(e)?e.value:e}function Rr(e){return Bs(e)?e():ut(e)}const d$={get:(e,i,s)=>i==="__v_raw"?e:ut(Reflect.get(e,i,s)),set:(e,i,s,l)=>{const p=e[i];return Wo(p)&&!Wo(s)?(p.value=s,!0):Reflect.set(e,i,s,l)}};function p5(e){return Tm(e)?e:new Proxy(e,d$)}class f${constructor(i){this.__v_isRef=!0,this._value=void 0;const s=this.dep=new FE,{get:l,set:p}=i(s.track.bind(s),s.trigger.bind(s));this._get=l,this._set=p}get value(){return this._value=this._get()}set value(i){this._set(i)}}function cb(e){return new f$(e)}function Mp(e){const i=xs(e)?new Array(e.length):{};for(const s in e)i[s]=m5(e,s);return i}class p${constructor(i,s,l){this._object=i,this._key=s,this._defaultValue=l,this.__v_isRef=!0,this._value=void 0,this._raw=zo(i);let p=!0,_=i;if(!xs(i)||!LE(String(s)))do p=!jE(_)||Nf(_);while(p&&(_=_.__v_raw));this._shallow=p}get value(){let i=this._object[this._key];return this._shallow&&(i=ut(i)),this._value=i===void 0?this._defaultValue:i}set value(i){if(this._shallow&&Wo(this._raw[this._key])){const s=this._object[this._key];if(Wo(s)){s.value=i;return}}this._object[this._key]=i}get dep(){return ZU(this._raw,this._key)}}class m${constructor(i){this._getter=i,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function Nc(e,i,s){return Wo(e)?e:Bs(e)?new m$(e):sl(e)&&arguments.length>1?m5(e,i,s):an(e)}function m5(e,i,s){return new p$(e,i,s)}class g${constructor(i,s,l){this.fn=i,this.setter=s,this._value=void 0,this.dep=new FE(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ew-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=l}notify(){if(this.flags|=16,!(this.flags&8)&&fl!==this)return QF(this,!0),!0}get value(){const i=this.dep.track();return i5(this),i&&(i.version=this.dep.version),this._value}set value(i){this.setter&&this.setter(i)}}function _$(e,i,s=!1){let l,p;return Bs(e)?l=e:(l=e.get,p=e.set),new g$(l,p,s)}const zT={},YS=new WeakMap;let Q0;function y$(e,i=!1,s=Q0){if(s){let l=YS.get(s);l||YS.set(s,l=[]),l.push(e)}}function v$(e,i,s=ha){const{immediate:l,deep:p,once:_,scheduler:b,augmentJob:t,call:P}=s,O=Ee=>p?Ee:Nf(Ee)||p===!1||p===0?V_(Ee,1):V_(Ee);let F,$,W,Y,ae=!1,se=!1;if(Wo(e)?($=()=>e.value,ae=Nf(e)):Tm(e)?($=()=>O(e),ae=!0):xs(e)?(se=!0,ae=e.some(Ee=>Tm(Ee)||Nf(Ee)),$=()=>e.map(Ee=>{if(Wo(Ee))return Ee.value;if(Tm(Ee))return O(Ee);if(Bs(Ee))return P?P(Ee,2):Ee()})):Bs(e)?i?$=P?()=>P(e,2):e:$=()=>{if(W){W_();try{W()}finally{Z_()}}const Ee=Q0;Q0=F;try{return P?P(e,3,[Y]):e(Y)}finally{Q0=Ee}}:$=Pg,i&&p){const Ee=$,Pe=p===!0?1/0:p;$=()=>V_(Ee(),Pe)}const ie=Rp(),pe=()=>{F.stop(),ie&&ie.active&&WP(ie.effects,F)};if(_&&i){const Ee=i;i=(...Pe)=>{Ee(...Pe),pe()}}let ye=se?new Array(e.length).fill(zT):zT;const de=Ee=>{if(!(!(F.flags&1)||!F.dirty&&!Ee))if(i){const Pe=F.run();if(p||ae||(se?Pe.some((Ze,We)=>sd(Ze,ye[We])):sd(Pe,ye))){W&&W();const Ze=Q0;Q0=F;try{const We=[Pe,ye===zT?void 0:se&&ye[0]===zT?[]:ye,Y];ye=Pe,P?P(i,3,We):i(...We)}finally{Q0=Ze}}}else F.run()};return t&&t(de),F=new KF($),F.scheduler=b?()=>b(de,!1):de,Y=Ee=>y$(Ee,!1,F),W=F.onStop=()=>{const Ee=YS.get(F);if(Ee){if(P)P(Ee,4);else for(const Pe of Ee)Pe();YS.delete(F)}},i?l?de(!0):ye=F.run():b?b(de.bind(null,!0),!0):F.run(),pe.pause=F.pause.bind(F),pe.resume=F.resume.bind(F),pe.stop=pe,pe}function V_(e,i=1/0,s){if(i<=0||!sl(e)||e.__v_skip||(s=s||new Map,(s.get(e)||0)>=i))return e;if(s.set(e,i),i--,Wo(e))V_(e.value,i,s);else if(xs(e))for(let l=0;l<e.length;l++)V_(e[l],i,s);else if($F(e)||Bx(e))e.forEach(l=>{V_(l,i,s)});else if(XP(e)){for(const l in e)V_(e[l],i,s);for(const l of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,l)&&V_(e[l],i,s)}return e}function Yw(e,i,s,l){try{return l?e(...l):e()}catch(p){ub(p,i,s)}}function Cm(e,i,s,l){if(Bs(e)){const p=Yw(e,i,s,l);return p&&ZP(p)&&p.catch(_=>{ub(_,i,s)}),p}if(xs(e)){const p=[];for(let _=0;_<e.length;_++)p.push(Cm(e[_],i,s,l));return p}}function ub(e,i,s,l=!0){const p=i?i.vnode:null,{errorHandler:_,throwUnhandledErrorInProduction:b}=i&&i.appContext.config||ha;if(i){let t=i.parent;const P=i.proxy,O=`https://vuejs.org/error-reference/#runtime-${s}`;for(;t;){const F=t.ec;if(F){for(let $=0;$<F.length;$++)if(F[$](e,P,O)===!1)return}t=t.parent}if(_){W_(),Yw(_,null,10,[e,P,O]),Z_();return}}x$(e,s,p,l,b)}function x$(e,i,s,l=!0,p=!1){if(p)throw e;console.error(e)}const od=[];let Sg=-1;const Vx=[];let Yy=null,Ax=0;const g5=Promise.resolve();let KS=null;function Da(e){const i=KS||g5;return e?i.then(this?e.bind(this):e):i}function b$(e){let i=Sg+1,s=od.length;for(;i<s;){const l=i+s>>>1,p=od[l],_=Cw(p);_<e||_===e&&p.flags&2?i=l+1:s=l}return i}function QP(e){if(!(e.flags&1)){const i=Cw(e),s=od[od.length-1];!s||!(e.flags&2)&&i>=Cw(s)?od.push(e):od.splice(b$(i),0,e),e.flags|=1,_5()}}function _5(){KS||(KS=g5.then(y5))}function JS(e){xs(e)?Vx.push(...e):Yy&&e.id===-1?Yy.splice(Ax+1,0,e):e.flags&1||(Vx.push(e),e.flags|=1),_5()}function EL(e,i,s=Sg+1){for(;s<od.length;s++){const l=od[s];if(l&&l.flags&2){if(e&&l.id!==e.uid)continue;od.splice(s,1),s--,l.flags&4&&(l.flags&=-2),l(),l.flags&4||(l.flags&=-2)}}}function QS(e){if(Vx.length){const i=[...new Set(Vx)].sort((s,l)=>Cw(s)-Cw(l));if(Vx.length=0,Yy){Yy.push(...i);return}for(Yy=i,Ax=0;Ax<Yy.length;Ax++){const s=Yy[Ax];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}Yy=null,Ax=0}}const Cw=e=>e.id==null?e.flags&2?-1:1/0:e.id;function y5(e){try{for(Sg=0;Sg<od.length;Sg++){const i=od[Sg];i&&!(i.flags&8)&&(i.flags&4&&(i.flags&=-2),Yw(i,i.i,i.i?15:14),i.flags&4||(i.flags&=-2))}}finally{for(;Sg<od.length;Sg++){const i=od[Sg];i&&(i.flags&=-2)}Sg=-1,od.length=0,QS(),KS=null,(od.length||Vx.length)&&y5()}}let Wu=null,v5=null;function eE(e){const i=Wu;return Wu=e,v5=e&&e.type.__scopeId||null,i}function Jn(e,i=Wu,s){if(!i||e._n)return e;const l=(...p)=>{l._d&&sE(-1);const _=eE(i);let b;try{b=e(...p)}finally{eE(_),l._d&&sE(1)}return b};return l._n=!0,l._c=!0,l._d=!0,l}function x5(e,i){if(Wu===null)return e;const s=WE(Wu),l=e.dirs||(e.dirs=[]);for(let p=0;p<i.length;p++){let[_,b,t,P=ha]=i[p];_&&(Bs(_)&&(_={mounted:_,updated:_}),_.deep&&V_(b),l.push({dir:_,instance:s,value:b,oldValue:void 0,arg:t,modifiers:P}))}return e}function Eg(e,i,s,l){const p=e.dirs,_=i&&i.dirs;for(let b=0;b<p.length;b++){const t=p[b];_&&(t.oldValue=_[b].value);let P=t.dir[l];P&&(W_(),Cm(P,s,8,[e.el,t,e,i]),Z_())}}function Ka(e,i){if(Hu){let s=Hu.provides;const l=Hu.parent&&Hu.parent.provides;l===s&&(s=Hu.provides=Object.create(l)),s[e]=i}}function Fo(e,i,s=!1){const l=ba();if(l||av){let p=av?av._context.provides:l?l.parent==null||l.ce?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides:void 0;if(p&&e in p)return p[e];if(arguments.length>1)return s&&Bs(i)?i.call(l&&l.proxy):i}}function vv(){return!!(ba()||av)}const w$=Symbol.for("v-scx"),T$=()=>Fo(w$);function Ph(e,i){return Kw(e,null,i)}function Qge(e,i){return Kw(e,null,{flush:"post"})}function S$(e,i){return Kw(e,null,{flush:"sync"})}function Qn(e,i,s){return Kw(e,i,s)}function Kw(e,i,s=ha){const{immediate:l,deep:p,flush:_,once:b}=s,t=jc({},s),P=i&&l||!i&&_!=="post";let O;if(Xx){if(_==="sync"){const Y=T$();O=Y.__watcherHandles||(Y.__watcherHandles=[])}else if(!P){const Y=()=>{};return Y.stop=Pg,Y.resume=Pg,Y.pause=Pg,Y}}const F=Hu;t.call=(Y,ae,se)=>Cm(Y,F,ae,se);let $=!1;_==="post"?t.scheduler=Y=>{Oc(Y,F&&F.suspense)}:_!=="sync"&&($=!0,t.scheduler=(Y,ae)=>{ae?Y():QP(Y)}),t.augmentJob=Y=>{i&&(Y.flags|=4),$&&(Y.flags|=2,F&&(Y.id=F.uid,Y.i=F))};const W=v$(e,i,t);return Xx&&(O?O.push(W):P&&W()),W}function E$(e,i,s){const l=this.proxy,p=Cl(e)?e.includes(".")?b5(l,e):()=>l[e]:e.bind(l,l);let _;Bs(i)?_=i:(_=i.handler,s=i);const b=fv(this),t=Kw(p,_.bind(l),s);return b(),t}function b5(e,i){const s=i.split(".");return()=>{let l=e;for(let p=0;p<s.length&&l;p++)l=l[s[p]];return l}}const w5=Symbol("_vte"),T5=e=>e.__isTeleport,cw=e=>e&&(e.disabled||e.disabled===""),IL=e=>e&&(e.defer||e.defer===""),CL=e=>typeof SVGElement<"u"&&e instanceof SVGElement,AL=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,xA=(e,i)=>{const s=e&&e.to;return Cl(s)?i?i(s):null:s},S5={name:"Teleport",__isTeleport:!0,process(e,i,s,l,p,_,b,t,P,O){const{mc:F,pc:$,pbc:W,o:{insert:Y,querySelector:ae,createText:se,createComment:ie}}=O,pe=cw(i.props);let{shapeFlag:ye,children:de,dynamicChildren:Ee}=i;if(e==null){const Pe=i.el=se(""),Ze=i.anchor=se("");Y(Pe,s,l),Y(Ze,s,l);const We=(Ye,ct)=>{ye&16&&F(de,Ye,ct,p,_,b,t,P)},je=()=>{const Ye=i.target=xA(i.props,ae),ct=E5(Ye,i,se,Y);Ye&&(b!=="svg"&&CL(Ye)?b="svg":b!=="mathml"&&AL(Ye)&&(b="mathml"),p&&p.isCE&&(p.ce._teleportTargets||(p.ce._teleportTargets=new Set)).add(Ye),pe||(We(Ye,ct),xS(i,!1)))};pe&&(We(s,Ze),xS(i,!0)),IL(i.props)?(i.el.__isMounted=!1,Oc(()=>{je(),delete i.el.__isMounted},_)):je()}else{if(IL(i.props)&&e.el.__isMounted===!1){Oc(()=>{S5.process(e,i,s,l,p,_,b,t,P,O)},_);return}i.el=e.el,i.targetStart=e.targetStart;const Pe=i.anchor=e.anchor,Ze=i.target=e.target,We=i.targetAnchor=e.targetAnchor,je=cw(e.props),Ye=je?s:Ze,ct=je?Pe:We;if(b==="svg"||CL(Ze)?b="svg":(b==="mathml"||AL(Ze))&&(b="mathml"),Ee?(W(e.dynamicChildren,Ee,Ye,p,_,b,t),cM(e,i,!0)):P||$(e,i,Ye,ct,p,_,b,t,!1),pe)je?i.props&&e.props&&i.props.to!==e.props.to&&(i.props.to=e.props.to):OT(i,s,Pe,O,1);else if((i.props&&i.props.to)!==(e.props&&e.props.to)){const Lt=i.target=xA(i.props,ae);Lt&&OT(i,Lt,null,O,0)}else je&&OT(i,Ze,We,O,1);xS(i,pe)}},remove(e,i,s,{um:l,o:{remove:p}},_){const{shapeFlag:b,children:t,anchor:P,targetStart:O,targetAnchor:F,target:$,props:W}=e;if($&&(p(O),p(F)),_&&p(P),b&16){const Y=_||!cw(W);for(let ae=0;ae<t.length;ae++){const se=t[ae];l(se,i,s,Y,!!se.dynamicChildren)}}},move:OT,hydrate:I$};function OT(e,i,s,{o:{insert:l},m:p},_=2){_===0&&l(e.targetAnchor,i,s);const{el:b,anchor:t,shapeFlag:P,children:O,props:F}=e,$=_===2;if($&&l(b,i,s),(!$||cw(F))&&P&16)for(let W=0;W<O.length;W++)p(O[W],i,s,2);$&&l(t,i,s)}function I$(e,i,s,l,p,_,{o:{nextSibling:b,parentNode:t,querySelector:P,insert:O,createText:F}},$){function W(se,ie,pe,ye){ie.anchor=$(b(se),ie,t(se),s,l,p,_),ie.targetStart=pe,ie.targetAnchor=ye}const Y=i.target=xA(i.props,P),ae=cw(i.props);if(Y){const se=Y._lpa||Y.firstChild;if(i.shapeFlag&16)if(ae)W(e,i,se,se&&b(se));else{i.anchor=b(e);let ie=se;for(;ie;){if(ie&&ie.nodeType===8){if(ie.data==="teleport start anchor")i.targetStart=ie;else if(ie.data==="teleport anchor"){i.targetAnchor=ie,Y._lpa=i.targetAnchor&&b(i.targetAnchor);break}}ie=b(ie)}i.targetAnchor||E5(Y,i,F,O),$(se&&b(se),i,Y,s,l,p,_)}xS(i,ae)}else ae&&i.shapeFlag&16&&W(e,i,e,b(e));return i.anchor&&b(i.anchor)}const UE=S5;function xS(e,i){const s=e.ctx;if(s&&s.ut){let l,p;for(i?(l=e.el,p=e.anchor):(l=e.targetStart,p=e.targetAnchor);l&&l!==p;)l.nodeType===1&&l.setAttribute("data-v-owner",s.uid),l=l.nextSibling;s.ut()}}function E5(e,i,s,l){const p=i.targetStart=s(""),_=i.targetAnchor=s("");return p[w5]=_,e&&(l(p,e),l(_,e)),_}const O_=Symbol("_leaveCb"),FT=Symbol("_enterCb");function I5(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return La(()=>{e.isMounted=!0}),Vf(()=>{e.isUnmounting=!0}),e}const Tp=[Function,Array],C5={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Tp,onEnter:Tp,onAfterEnter:Tp,onEnterCancelled:Tp,onBeforeLeave:Tp,onLeave:Tp,onAfterLeave:Tp,onLeaveCancelled:Tp,onBeforeAppear:Tp,onAppear:Tp,onAfterAppear:Tp,onAppearCancelled:Tp},A5=e=>{const i=e.subTree;return i.component?A5(i.component):i},C$={name:"BaseTransition",props:C5,setup(e,{slots:i}){const s=ba(),l=I5();return()=>{const p=i.default&&eM(i.default(),!0);if(!p||!p.length)return;const _=P5(p),b=zo(e),{mode:t}=b;if(l.isLeaving)return fC(_);const P=PL(_);if(!P)return fC(_);let O=Aw(P,b,l,s,$=>O=$);P.type!==uc&&n0(P,O);let F=s.subTree&&PL(s.subTree);if(F&&F.type!==uc&&!vm(F,P)&&A5(s).type!==uc){let $=Aw(F,b,l,s);if(n0(F,$),t==="out-in"&&P.type!==uc)return l.isLeaving=!0,$.afterLeave=()=>{l.isLeaving=!1,s.job.flags&8||s.update(),delete $.afterLeave,F=void 0},fC(_);t==="in-out"&&P.type!==uc?$.delayLeave=(W,Y,ae)=>{const se=M5(l,F);se[String(F.key)]=F,W[O_]=()=>{Y(),W[O_]=void 0,delete O.delayedLeave,F=void 0},O.delayedLeave=()=>{ae(),delete O.delayedLeave,F=void 0}}:F=void 0}else F&&(F=void 0);return _}}};function P5(e){let i=e[0];if(e.length>1){for(const s of e)if(s.type!==uc){i=s;break}}return i}const A$=C$;function M5(e,i){const{leavingVNodes:s}=e;let l=s.get(i.type);return l||(l=Object.create(null),s.set(i.type,l)),l}function Aw(e,i,s,l,p){const{appear:_,mode:b,persisted:t=!1,onBeforeEnter:P,onEnter:O,onAfterEnter:F,onEnterCancelled:$,onBeforeLeave:W,onLeave:Y,onAfterLeave:ae,onLeaveCancelled:se,onBeforeAppear:ie,onAppear:pe,onAfterAppear:ye,onAppearCancelled:de}=i,Ee=String(e.key),Pe=M5(s,e),Ze=(Ye,ct)=>{Ye&&Cm(Ye,l,9,ct)},We=(Ye,ct)=>{const Lt=ct[1];Ze(Ye,ct),xs(Ye)?Ye.every(Ht=>Ht.length<=1)&&Lt():Ye.length<=1&&Lt()},je={mode:b,persisted:t,beforeEnter(Ye){let ct=P;if(!s.isMounted)if(_)ct=ie||P;else return;Ye[O_]&&Ye[O_](!0);const Lt=Pe[Ee];Lt&&vm(e,Lt)&&Lt.el[O_]&&Lt.el[O_](),Ze(ct,[Ye])},enter(Ye){let ct=O,Lt=F,Ht=$;if(!s.isMounted)if(_)ct=pe||O,Lt=ye||F,Ht=de||$;else return;let ci=!1;const Wt=Ye[FT]=$t=>{ci||(ci=!0,$t?Ze(Ht,[Ye]):Ze(Lt,[Ye]),je.delayedLeave&&je.delayedLeave(),Ye[FT]=void 0)};ct?We(ct,[Ye,Wt]):Wt()},leave(Ye,ct){const Lt=String(e.key);if(Ye[FT]&&Ye[FT](!0),s.isUnmounting)return ct();Ze(W,[Ye]);let Ht=!1;const ci=Ye[O_]=Wt=>{Ht||(Ht=!0,ct(),Wt?Ze(se,[Ye]):Ze(ae,[Ye]),Ye[O_]=void 0,Pe[Lt]===e&&delete Pe[Lt])};Pe[Lt]=e,Y?We(Y,[Ye,ci]):ci()},clone(Ye){const ct=Aw(Ye,i,s,l,p);return p&&p(ct),ct}};return je}function fC(e){if(Jw(e))return e=kp(e),e.children=null,e}function PL(e){if(!Jw(e))return T5(e.type)&&e.children?P5(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:i,children:s}=e;if(s){if(i&16)return s[0];if(i&32&&Bs(s.default))return s.default()}}function n0(e,i){e.shapeFlag&6&&e.component?(e.transition=i,n0(e.component.subTree,i)):e.shapeFlag&128?(e.ssContent.transition=i.clone(e.ssContent),e.ssFallback.transition=i.clone(e.ssFallback)):e.transition=i}function eM(e,i=!1,s){let l=[],p=0;for(let _=0;_<e.length;_++){let b=e[_];const t=s==null?b.key:String(s)+String(b.key!=null?b.key:_);b.type===qs?(b.patchFlag&128&&p++,l=l.concat(eM(b.children,i,t))):(i||b.type!==uc)&&l.push(t!=null?kp(b,{key:t}):b)}if(p>1)for(let _=0;_<l.length;_++)l[_].patchFlag=-2;return l}function kr(e,i){return Bs(e)?jc({name:e.name},i,{setup:e}):e}function P$(){const e=ba();return e?(e.appContext.config.idPrefix||"v")+"-"+e.ids[0]+e.ids[1]++:""}function tM(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function iM(e){const i=ba(),s=so(null);if(i){const p=i.refs===ha?i.refs={}:i.refs;Object.defineProperty(p,e,{enumerable:!0,get:()=>s.value,set:_=>s.value=_})}return s}const tE=new WeakMap;function jx(e,i,s,l,p=!1){if(xs(e)){e.forEach((ae,se)=>jx(ae,i&&(xs(i)?i[se]:i),s,l,p));return}if($_(l)&&!p){l.shapeFlag&512&&l.type.__asyncResolved&&l.component.subTree.component&&jx(e,i,s,l.component.subTree);return}const _=l.shapeFlag&4?WE(l.component):l.el,b=p?null:_,{i:t,r:P}=e,O=i&&i.r,F=t.refs===ha?t.refs={}:t.refs,$=t.setupState,W=zo($),Y=$===ha?UF:ae=>Ma(W,ae);if(O!=null&&O!==P){if(ML(i),Cl(O))F[O]=null,Y(O)&&($[O]=null);else if(Wo(O)){O.value=null;const ae=i;ae.k&&(F[ae.k]=null)}}if(Bs(P))Yw(P,t,12,[b,F]);else{const ae=Cl(P),se=Wo(P);if(ae||se){const ie=()=>{if(e.f){const pe=ae?Y(P)?$[P]:F[P]:P.value;if(p)xs(pe)&&WP(pe,_);else if(xs(pe))pe.includes(_)||pe.push(_);else if(ae)F[P]=[_],Y(P)&&($[P]=F[P]);else{const ye=[_];P.value=ye,e.k&&(F[e.k]=ye)}}else ae?(F[P]=b,Y(P)&&($[P]=b)):se&&(P.value=b,e.k&&(F[e.k]=b))};if(b){const pe=()=>{ie(),tE.delete(e)};pe.id=-1,tE.set(e,pe),Oc(pe,s)}else ML(e),ie()}}}function ML(e){const i=tE.get(e);i&&(i.flags|=8,tE.delete(e))}let kL=!1;const Ex=()=>{kL||(console.error("Hydration completed but contains mismatches."),kL=!0)},M$=e=>e.namespaceURI.includes("svg")&&e.tagName!=="foreignObject",k$=e=>e.namespaceURI.includes("MathML"),BT=e=>{if(e.nodeType===1){if(M$(e))return"svg";if(k$(e))return"mathml"}},Dx=e=>e.nodeType===8;function D$(e){const{mt:i,p:s,o:{patchProp:l,createText:p,nextSibling:_,parentNode:b,remove:t,insert:P,createComment:O}}=e,F=(de,Ee)=>{if(!Ee.hasChildNodes()){s(null,de,Ee),QS(),Ee._vnode=de;return}$(Ee.firstChild,de,null,null,null),QS(),Ee._vnode=de},$=(de,Ee,Pe,Ze,We,je=!1)=>{je=je||!!Ee.dynamicChildren;const Ye=Dx(de)&&de.data==="[",ct=()=>se(de,Ee,Pe,Ze,We,Ye),{type:Lt,ref:Ht,shapeFlag:ci,patchFlag:Wt}=Ee;let $t=de.nodeType;Ee.el=de,Wt===-2&&(je=!1,Ee.dynamicChildren=null);let Dt=null;switch(Lt){case t0:$t!==3?Ee.children===""?(P(Ee.el=p(""),b(de),de),Dt=de):Dt=ct():(de.data!==Ee.children&&(Ex(),de.data=Ee.children),Dt=_(de));break;case uc:ye(de)?(Dt=_(de),pe(Ee.el=de.content.firstChild,de,Pe)):$t!==8||Ye?Dt=ct():Dt=_(de);break;case bS:if(Ye&&(de=_(de),$t=de.nodeType),$t===1||$t===3){Dt=de;const Ft=!Ee.children.length;for(let vt=0;vt<Ee.staticCount;vt++)Ft&&(Ee.children+=Dt.nodeType===1?Dt.outerHTML:Dt.data),vt===Ee.staticCount-1&&(Ee.anchor=Dt),Dt=_(Dt);return Ye?_(Dt):Dt}else ct();break;case qs:Ye?Dt=ae(de,Ee,Pe,Ze,We,je):Dt=ct();break;default:if(ci&1)($t!==1||Ee.type.toLowerCase()!==de.tagName.toLowerCase())&&!ye(de)?Dt=ct():Dt=W(de,Ee,Pe,Ze,We,je);else if(ci&6){Ee.slotScopeIds=We;const Ft=b(de);if(Ye?Dt=ie(de):Dx(de)&&de.data==="teleport start"?Dt=ie(de,de.data,"teleport end"):Dt=_(de),i(Ee,Ft,null,Pe,Ze,BT(Ft),je),$_(Ee)&&!Ee.type.__asyncResolved){let vt;Ye?(vt=tr(qs),vt.anchor=Dt?Dt.previousSibling:Ft.lastChild):vt=de.nodeType===3?Gd(""):tr("div"),vt.el=de,Ee.component.subTree=vt}}else ci&64?$t!==8?Dt=ct():Dt=Ee.type.hydrate(de,Ee,Pe,Ze,We,je,e,Y):ci&128&&(Dt=Ee.type.hydrate(de,Ee,Pe,Ze,BT(b(de)),We,je,e,$))}return Ht!=null&&jx(Ht,null,Ze,Ee),Dt},W=(de,Ee,Pe,Ze,We,je)=>{je=je||!!Ee.dynamicChildren;const{type:Ye,props:ct,patchFlag:Lt,shapeFlag:Ht,dirs:ci,transition:Wt}=Ee,$t=Ye==="input"||Ye==="option";if($t||Lt!==-1){ci&&Eg(Ee,null,Pe,"created");let Dt=!1;if(ye(de)){Dt=Q5(null,Wt)&&Pe&&Pe.vnode.props&&Pe.vnode.props.appear;const vt=de.content.firstChild;if(Dt){const wi=vt.getAttribute("class");wi&&(vt.$cls=wi),Wt.beforeEnter(vt)}pe(vt,de,Pe),Ee.el=de=vt}if(Ht&16&&!(ct&&(ct.innerHTML||ct.textContent))){let vt=Y(de.firstChild,Ee,de,Pe,Ze,We,je);for(;vt;){NT(de,1)||Ex();const wi=vt;vt=vt.nextSibling,t(wi)}}else if(Ht&8){let vt=Ee.children;vt[0]===`
`&&(de.tagName==="PRE"||de.tagName==="TEXTAREA")&&(vt=vt.slice(1));const{textContent:wi}=de;wi!==vt&&wi!==vt.replace(/\r\n|\r/g,`
`)&&(NT(de,0)||Ex(),de.textContent=Ee.children)}if(ct){if($t||!je||Lt&48){const vt=de.tagName.includes("-");for(const wi in ct)($t&&(wi.endsWith("value")||wi==="indeterminate")||Zw(wi)&&!Nx(wi)||wi[0]==="."||vt)&&l(de,wi,null,ct[wi],void 0,Pe)}else if(ct.onClick)l(de,"onClick",null,ct.onClick,void 0,Pe);else if(Lt&4&&Tm(ct.style))for(const vt in ct.style)ct.style[vt]}let Ft;(Ft=ct&&ct.onVnodeBeforeMount)&&Vd(Ft,Pe,Ee),ci&&Eg(Ee,null,Pe,"beforeMount"),((Ft=ct&&ct.onVnodeMounted)||ci||Dt)&&nB(()=>{Ft&&Vd(Ft,Pe,Ee),Dt&&Wt.enter(de),ci&&Eg(Ee,null,Pe,"mounted")},Ze)}return de.nextSibling},Y=(de,Ee,Pe,Ze,We,je,Ye)=>{Ye=Ye||!!Ee.dynamicChildren;const ct=Ee.children,Lt=ct.length;for(let Ht=0;Ht<Lt;Ht++){const ci=Ye?ct[Ht]:ct[Ht]=Bf(ct[Ht]),Wt=ci.type===t0;de?(Wt&&!Ye&&Ht+1<Lt&&Bf(ct[Ht+1]).type===t0&&(P(p(de.data.slice(ci.children.length)),Pe,_(de)),de.data=ci.children),de=$(de,ci,Ze,We,je,Ye)):Wt&&!ci.children?P(ci.el=p(""),Pe):(NT(Pe,1)||Ex(),s(null,ci,Pe,null,Ze,We,BT(Pe),je))}return de},ae=(de,Ee,Pe,Ze,We,je)=>{const{slotScopeIds:Ye}=Ee;Ye&&(We=We?We.concat(Ye):Ye);const ct=b(de),Lt=Y(_(de),Ee,ct,Pe,Ze,We,je);return Lt&&Dx(Lt)&&Lt.data==="]"?_(Ee.anchor=Lt):(Ex(),P(Ee.anchor=O("]"),ct,Lt),Lt)},se=(de,Ee,Pe,Ze,We,je)=>{if(NT(de.parentElement,1)||Ex(),Ee.el=null,je){const Lt=ie(de);for(;;){const Ht=_(de);if(Ht&&Ht!==Lt)t(Ht);else break}}const Ye=_(de),ct=b(de);return t(de),s(null,Ee,ct,Ye,Pe,Ze,BT(ct),We),Pe&&(Pe.vnode.el=Ee.el,HE(Pe,Ee.el)),Ye},ie=(de,Ee="[",Pe="]")=>{let Ze=0;for(;de;)if(de=_(de),de&&Dx(de)&&(de.data===Ee&&Ze++,de.data===Pe)){if(Ze===0)return _(de);Ze--}return de},pe=(de,Ee,Pe)=>{const Ze=Ee.parentNode;Ze&&Ze.replaceChild(de,Ee);let We=Pe;for(;We;)We.vnode.el===Ee&&(We.vnode.el=We.subTree.el=de),We=We.parent},ye=de=>de.nodeType===1&&de.tagName==="TEMPLATE";return[F,$]}const DL="data-allow-mismatch",L$={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function NT(e,i){if(i===0||i===1)for(;e&&!e.hasAttribute(DL);)e=e.parentElement;const s=e&&e.getAttribute(DL);if(s==null)return!1;if(s==="")return!0;{const l=s.split(",");return i===0&&l.includes("children")?!0:l.includes(L$[i])}}OE().requestIdleCallback;OE().cancelIdleCallback;function R$(e,i){if(Dx(e)&&e.data==="["){let s=1,l=e.nextSibling;for(;l;){if(l.nodeType===1){if(i(l)===!1)break}else if(Dx(l))if(l.data==="]"){if(--s===0)break}else l.data==="["&&s++;l=l.nextSibling}}else i(e)}const $_=e=>!!e.type.__asyncLoader;function Ux(e){Bs(e)&&(e={loader:e});const{loader:i,loadingComponent:s,errorComponent:l,delay:p=200,hydrate:_,timeout:b,suspensible:t=!0,onError:P}=e;let O=null,F,$=0;const W=()=>($++,O=null,Y()),Y=()=>{let ae;return O||(ae=O=i().catch(se=>{if(se=se instanceof Error?se:new Error(String(se)),P)return new Promise((ie,pe)=>{P(se,()=>ie(W()),()=>pe(se),$+1)});throw se}).then(se=>ae!==O&&O?O:(se&&(se.__esModule||se[Symbol.toStringTag]==="Module")&&(se=se.default),F=se,se)))};return kr({name:"AsyncComponentWrapper",__asyncLoader:Y,__asyncHydrate(ae,se,ie){let pe=!1;(se.bu||(se.bu=[])).push(()=>pe=!0);const ye=()=>{pe||ie()},de=_?()=>{const Ee=_(ye,Pe=>R$(ae,Pe));Ee&&(se.bum||(se.bum=[])).push(Ee)}:ye;F?de():Y().then(()=>!se.isUnmounted&&de())},get __asyncResolved(){return F},setup(){const ae=Hu;if(tM(ae),F)return()=>VT(F,ae);const se=de=>{O=null,ub(de,ae,13,!l)};if(t&&ae.suspense||Xx)return Y().then(de=>()=>VT(de,ae)).catch(de=>(se(de),()=>l?tr(l,{error:de}):null));const ie=an(!1),pe=an(),ye=an(!!p);return p&&setTimeout(()=>{ye.value=!1},p),b!=null&&setTimeout(()=>{if(!ie.value&&!pe.value){const de=new Error(`Async component timed out after ${b}ms.`);se(de),pe.value=de}},b),Y().then(()=>{ie.value=!0,ae.parent&&Jw(ae.parent.vnode)&&ae.parent.update()}).catch(de=>{se(de),pe.value=de}),()=>{if(ie.value&&F)return VT(F,ae);if(pe.value&&l)return tr(l,{error:pe.value});if(s&&!ye.value)return VT(s,ae)}}})}function VT(e,i){const{ref:s,props:l,children:p,ce:_}=i.vnode,b=tr(e,l,p);return b.ref=s,b.ce=_,delete i.vnode.ce,b}const Jw=e=>e.type.__isKeepAlive,z$={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:i}){const s=ba(),l=s.ctx;if(!l.renderer)return()=>{const ye=i.default&&i.default();return ye&&ye.length===1?ye[0]:ye};const p=new Map,_=new Set;let b=null;const t=s.suspense,{renderer:{p:P,m:O,um:F,o:{createElement:$}}}=l,W=$("div");l.activate=(ye,de,Ee,Pe,Ze)=>{const We=ye.component;O(ye,de,Ee,0,t),P(We.vnode,ye,de,Ee,We,t,Pe,ye.slotScopeIds,Ze),Oc(()=>{We.isDeactivated=!1,We.a&&ow(We.a);const je=ye.props&&ye.props.onVnodeMounted;je&&Vd(je,We.parent,ye)},t)},l.deactivate=ye=>{const de=ye.component;nE(de.m),nE(de.a),O(ye,W,null,1,t),Oc(()=>{de.da&&ow(de.da);const Ee=ye.props&&ye.props.onVnodeUnmounted;Ee&&Vd(Ee,de.parent,ye),de.isDeactivated=!0},t)};function Y(ye){pC(ye),F(ye,s,t,!0)}function ae(ye){p.forEach((de,Ee)=>{const Pe=PA($_(de)?de.type.__asyncResolved||{}:de.type);Pe&&!ye(Pe)&&se(Ee)})}function se(ye){const de=p.get(ye);de&&(!b||!vm(de,b))?Y(de):b&&pC(b),p.delete(ye),_.delete(ye)}Qn(()=>[e.include,e.exclude],([ye,de])=>{ye&&ae(Ee=>J1(ye,Ee)),de&&ae(Ee=>!J1(de,Ee))},{flush:"post",deep:!0});let ie=null;const pe=()=>{ie!=null&&(rE(s.subTree.type)?Oc(()=>{p.set(ie,jT(s.subTree))},s.subTree.suspense):p.set(ie,jT(s.subTree)))};return La(pe),xv(pe),Vf(()=>{p.forEach(ye=>{const{subTree:de,suspense:Ee}=s,Pe=jT(de);if(ye.type===Pe.type&&ye.key===Pe.key){pC(Pe);const Ze=Pe.component.da;Ze&&Oc(Ze,Ee);return}Y(ye)})}),()=>{if(ie=null,!i.default)return b=null;const ye=i.default(),de=ye[0];if(ye.length>1)return b=null,ye;if(!dv(de)||!(de.shapeFlag&4)&&!(de.shapeFlag&128))return b=null,de;let Ee=jT(de);if(Ee.type===uc)return b=null,Ee;const Pe=Ee.type,Ze=PA($_(Ee)?Ee.type.__asyncResolved||{}:Pe),{include:We,exclude:je,max:Ye}=e;if(We&&(!Ze||!J1(We,Ze))||je&&Ze&&J1(je,Ze))return Ee.shapeFlag&=-257,b=Ee,de;const ct=Ee.key==null?Pe:Ee.key,Lt=p.get(ct);return Ee.el&&(Ee=kp(Ee),de.shapeFlag&128&&(de.ssContent=Ee)),ie=ct,Lt?(Ee.el=Lt.el,Ee.component=Lt.component,Ee.transition&&n0(Ee,Ee.transition),Ee.shapeFlag|=512,_.delete(ct),_.add(ct)):(_.add(ct),Ye&&_.size>parseInt(Ye,10)&&se(_.values().next().value)),Ee.shapeFlag|=256,b=Ee,rE(de.type)?de:Ee}}},O$=z$;function J1(e,i){return xs(e)?e.some(s=>J1(s,i)):Cl(e)?e.split(",").includes(i):zU(e)?(e.lastIndex=0,e.test(i)):!1}function nM(e,i){k5(e,"a",i)}function rM(e,i){k5(e,"da",i)}function k5(e,i,s=Hu){const l=e.__wdc||(e.__wdc=()=>{let p=s;for(;p;){if(p.isDeactivated)return;p=p.parent}return e()});if($E(i,l,s),s){let p=s.parent;for(;p&&p.parent;)Jw(p.parent.vnode)&&F$(l,i,s,p),p=p.parent}}function F$(e,i,s,l){const p=$E(i,e,l,!0);ru(()=>{WP(l[i],p)},s)}function pC(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function jT(e){return e.shapeFlag&128?e.ssContent:e}function $E(e,i,s=Hu,l=!1){if(s){const p=s[e]||(s[e]=[]),_=i.__weh||(i.__weh=(...b)=>{W_();const t=fv(s),P=Cm(i,s,e,b);return t(),Z_(),P});return l?p.unshift(_):p.push(_),_}}const ty=e=>(i,s=Hu)=>{(!Xx||e==="sp")&&$E(e,(...l)=>i(...l),s)},sM=ty("bm"),La=ty("m"),oM=ty("bu"),xv=ty("u"),Vf=ty("bum"),ru=ty("um"),B$=ty("sp"),N$=ty("rtg"),V$=ty("rtc");function D5(e,i=Hu){$E("ec",e,i)}const L5="components";function LL(e,i){return z5(L5,e,!0,i)||e}const R5=Symbol.for("v-ndc");function Cg(e){return Cl(e)?z5(L5,e,!1)||e:e||R5}function z5(e,i,s=!0,l=!1){const p=Wu||Hu;if(p){const _=p.type;{const t=PA(_,!1);if(t&&(t===i||t===cd(i)||t===zE(cd(i))))return _}const b=RL(p[e]||_[e],i)||RL(p.appContext[e],i);return!b&&l?_:b}}function RL(e,i){return e&&(e[i]||e[cd(i)]||e[zE(cd(i))])}function Eu(e,i,s,l){let p;const _=s,b=xs(e);if(b||Cl(e)){const t=b&&Tm(e);let P=!1,O=!1;t&&(P=!Nf(e),O=Rg(e),e=BE(e)),p=new Array(e.length);for(let F=0,$=e.length;F<$;F++)p[F]=i(P?O?Zx(Im(e[F])):Im(e[F]):e[F],F,void 0,_)}else if(typeof e=="number"){p=new Array(e);for(let t=0;t<e;t++)p[t]=i(t+1,t,void 0,_)}else if(sl(e))if(e[Symbol.iterator])p=Array.from(e,(t,P)=>i(t,P,void 0,_));else{const t=Object.keys(e);p=new Array(t.length);for(let P=0,O=t.length;P<O;P++){const F=t[P];p[P]=i(e[F],F,P,_)}}else p=[];return p}function e_e(e,i){for(let s=0;s<i.length;s++){const l=i[s];if(xs(l))for(let p=0;p<l.length;p++)e[l[p].name]=l[p].fn;else l&&(e[l.name]=l.key?(...p)=>{const _=l.fn(...p);return _&&(_.key=l.key),_}:l.fn)}return e}function Rs(e,i,s={},l,p){if(Wu.ce||Wu.parent&&$_(Wu.parent)&&Wu.parent.ce){const O=Object.keys(s).length>0;return i!=="default"&&(s.name=i),li(),En(qs,null,[tr("slot",s,l&&l())],O?-2:64)}let _=e[i];_&&_._c&&(_._d=!1),li();const b=_&&O5(_(s)),t=s.key||b&&b.key,P=En(qs,{key:(t&&!Q_(t)?t:`_${i}`)+(!b&&l?"_fb":"")},b||(l?l():[]),b&&e._===1?64:-2);return!p&&P.scopeId&&(P.slotScopeIds=[P.scopeId+"-s"]),_&&_._c&&(_._d=!0),P}function O5(e){return e.some(i=>dv(i)?!(i.type===uc||i.type===qs&&!O5(i.children)):!0)?e:null}function t_e(e,i){const s={};for(const l in e)s[sw(l)]=e[l];return s}const bA=e=>e?aB(e)?WE(e):bA(e.parent):null,uw=jc(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>bA(e.parent),$root:e=>bA(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>V5(e),$forceUpdate:e=>e.f||(e.f=()=>{QP(e.update)}),$nextTick:e=>e.n||(e.n=Da.bind(e.proxy)),$watch:e=>E$.bind(e)}),mC=(e,i)=>e!==ha&&!e.__isScriptSetup&&Ma(e,i),j$={get({_:e},i){if(i==="__v_skip")return!0;const{ctx:s,setupState:l,data:p,props:_,accessCache:b,type:t,appContext:P}=e;if(i[0]!=="$"){const W=b[i];if(W!==void 0)switch(W){case 1:return l[i];case 2:return p[i];case 4:return s[i];case 3:return _[i]}else{if(mC(l,i))return b[i]=1,l[i];if(p!==ha&&Ma(p,i))return b[i]=2,p[i];if(Ma(_,i))return b[i]=3,_[i];if(s!==ha&&Ma(s,i))return b[i]=4,s[i];wA&&(b[i]=0)}}const O=uw[i];let F,$;if(O)return i==="$attrs"&&Ch(e.attrs,"get",""),O(e);if((F=t.__cssModules)&&(F=F[i]))return F;if(s!==ha&&Ma(s,i))return b[i]=4,s[i];if($=P.config.globalProperties,Ma($,i))return $[i]},set({_:e},i,s){const{data:l,setupState:p,ctx:_}=e;return mC(p,i)?(p[i]=s,!0):l!==ha&&Ma(l,i)?(l[i]=s,!0):Ma(e.props,i)||i[0]==="$"&&i.slice(1)in e?!1:(_[i]=s,!0)},has({_:{data:e,setupState:i,accessCache:s,ctx:l,appContext:p,props:_,type:b}},t){let P;return!!(s[t]||e!==ha&&t[0]!=="$"&&Ma(e,t)||mC(i,t)||Ma(_,t)||Ma(l,t)||Ma(uw,t)||Ma(p.config.globalProperties,t)||(P=b.__cssModules)&&P[t])},defineProperty(e,i,s){return s.get!=null?e._.accessCache[i]=0:Ma(s,"value")&&this.set(e,i,s.value,null),Reflect.defineProperty(e,i,s)}};function GE(){return B5().slots}function F5(){return B5().attrs}function B5(e){const i=ba();return i.setupContext||(i.setupContext=cB(i))}function Pw(e){return xs(e)?e.reduce((i,s)=>(i[s]=null,i),{}):e}function i_e(e,i){const s=Pw(e);for(const l in i){if(l.startsWith("__skip"))continue;let p=s[l];p?xs(p)||Bs(p)?p=s[l]={type:p,default:i[l]}:p.default=i[l]:p===null&&(p=s[l]={default:i[l]}),p&&i[`__skip_${l}`]&&(p.skipFactory=!0)}return s}function U$(e,i){return!e||!i?e||i:xs(e)&&xs(i)?e.concat(i):jc({},Pw(e),Pw(i))}function $$(e){const i=ba();let s=e();return CA(),ZP(s)&&(s=s.catch(l=>{throw fv(i),l})),[s,()=>fv(i)]}let wA=!0;function G$(e){const i=V5(e),s=e.proxy,l=e.ctx;wA=!1,i.beforeCreate&&zL(i.beforeCreate,e,"bc");const{data:p,computed:_,methods:b,watch:t,provide:P,inject:O,created:F,beforeMount:$,mounted:W,beforeUpdate:Y,updated:ae,activated:se,deactivated:ie,beforeDestroy:pe,beforeUnmount:ye,destroyed:de,unmounted:Ee,render:Pe,renderTracked:Ze,renderTriggered:We,errorCaptured:je,serverPrefetch:Ye,expose:ct,inheritAttrs:Lt,components:Ht,directives:ci,filters:Wt}=i;if(O&&q$(O,l,null),b)for(const Ft in b){const vt=b[Ft];Bs(vt)&&(l[Ft]=vt.bind(s))}if(p){const Ft=p.call(s,s);sl(Ft)&&(e.data=Ol(Ft))}if(wA=!0,_)for(const Ft in _){const vt=_[Ft],wi=Bs(vt)?vt.bind(s,s):Bs(vt.get)?vt.get.bind(s,s):Pg,Qi=!Bs(vt)&&Bs(vt.set)?vt.set.bind(s):Pg,wn=Ei({get:wi,set:Qi});Object.defineProperty(l,Ft,{enumerable:!0,configurable:!0,get:()=>wn.value,set:qn=>wn.value=qn})}if(t)for(const Ft in t)N5(t[Ft],l,s,Ft);if(P){const Ft=Bs(P)?P.call(s):P;Reflect.ownKeys(Ft).forEach(vt=>{Ka(vt,Ft[vt])})}F&&zL(F,e,"c");function Dt(Ft,vt){xs(vt)?vt.forEach(wi=>Ft(wi.bind(s))):vt&&Ft(vt.bind(s))}if(Dt(sM,$),Dt(La,W),Dt(oM,Y),Dt(xv,ae),Dt(nM,se),Dt(rM,ie),Dt(D5,je),Dt(V$,Ze),Dt(N$,We),Dt(Vf,ye),Dt(ru,Ee),Dt(B$,Ye),xs(ct))if(ct.length){const Ft=e.exposed||(e.exposed={});ct.forEach(vt=>{Object.defineProperty(Ft,vt,{get:()=>s[vt],set:wi=>s[vt]=wi,enumerable:!0})})}else e.exposed||(e.exposed={});Pe&&e.render===Pg&&(e.render=Pe),Lt!=null&&(e.inheritAttrs=Lt),Ht&&(e.components=Ht),ci&&(e.directives=ci),Ye&&tM(e)}function q$(e,i,s=Pg){xs(e)&&(e=TA(e));for(const l in e){const p=e[l];let _;sl(p)?"default"in p?_=Fo(p.from||l,p.default,!0):_=Fo(p.from||l):_=Fo(p),Wo(_)?Object.defineProperty(i,l,{enumerable:!0,configurable:!0,get:()=>_.value,set:b=>_.value=b}):i[l]=_}}function zL(e,i,s){Cm(xs(e)?e.map(l=>l.bind(i.proxy)):e.bind(i.proxy),i,s)}function N5(e,i,s,l){let p=l.includes(".")?b5(s,l):()=>s[l];if(Cl(e)){const _=i[e];Bs(_)&&Qn(p,_)}else if(Bs(e))Qn(p,e.bind(s));else if(sl(e))if(xs(e))e.forEach(_=>N5(_,i,s,l));else{const _=Bs(e.handler)?e.handler.bind(s):i[e.handler];Bs(_)&&Qn(p,_,e)}}function V5(e){const i=e.type,{mixins:s,extends:l}=i,{mixins:p,optionsCache:_,config:{optionMergeStrategies:b}}=e.appContext,t=_.get(i);let P;return t?P=t:!p.length&&!s&&!l?P=i:(P={},p.length&&p.forEach(O=>iE(P,O,b,!0)),iE(P,i,b)),sl(i)&&_.set(i,P),P}function iE(e,i,s,l=!1){const{mixins:p,extends:_}=i;_&&iE(e,_,s,!0),p&&p.forEach(b=>iE(e,b,s,!0));for(const b in i)if(!(l&&b==="expose")){const t=H$[b]||s&&s[b];e[b]=t?t(e[b],i[b]):i[b]}return e}const H$={data:OL,props:FL,emits:FL,methods:Q1,computed:Q1,beforeCreate:nd,created:nd,beforeMount:nd,mounted:nd,beforeUpdate:nd,updated:nd,beforeDestroy:nd,beforeUnmount:nd,destroyed:nd,unmounted:nd,activated:nd,deactivated:nd,errorCaptured:nd,serverPrefetch:nd,components:Q1,directives:Q1,watch:Z$,provide:OL,inject:W$};function OL(e,i){return i?e?function(){return jc(Bs(e)?e.call(this,this):e,Bs(i)?i.call(this,this):i)}:i:e}function W$(e,i){return Q1(TA(e),TA(i))}function TA(e){if(xs(e)){const i={};for(let s=0;s<e.length;s++)i[e[s]]=e[s];return i}return e}function nd(e,i){return e?[...new Set([].concat(e,i))]:i}function Q1(e,i){return e?jc(Object.create(null),e,i):i}function FL(e,i){return e?xs(e)&&xs(i)?[...new Set([...e,...i])]:jc(Object.create(null),Pw(e),Pw(i??{})):i}function Z$(e,i){if(!e)return i;if(!i)return e;const s=jc(Object.create(null),e);for(const l in i)s[l]=nd(e[l],i[l]);return s}function j5(){return{app:null,config:{isNativeTag:UF,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let X$=0;function Y$(e,i){return function(l,p=null){Bs(l)||(l=jc({},l)),p!=null&&!sl(p)&&(p=null);const _=j5(),b=new WeakSet,t=[];let P=!1;const O=_.app={_uid:X$++,_component:l,_props:p,_container:null,_context:_,_instance:null,version:A7,get config(){return _.config},set config(F){},use(F,...$){return b.has(F)||(F&&Bs(F.install)?(b.add(F),F.install(O,...$)):Bs(F)&&(b.add(F),F(O,...$))),O},mixin(F){return _.mixins.includes(F)||_.mixins.push(F),O},component(F,$){return $?(_.components[F]=$,O):_.components[F]},directive(F,$){return $?(_.directives[F]=$,O):_.directives[F]},mount(F,$,W){if(!P){const Y=O._ceVNode||tr(l,p);return Y.appContext=_,W===!0?W="svg":W===!1&&(W=void 0),$&&i?i(Y,F):e(Y,F,W),P=!0,O._container=F,F.__vue_app__=O,WE(Y.component)}},onUnmount(F){t.push(F)},unmount(){P&&(Cm(t,O._instance,16),e(null,O._container),delete O._container.__vue_app__)},provide(F,$){return _.provides[F]=$,O},runWithContext(F){const $=av;av=O;try{return F()}finally{av=$}}};return O}}let av=null;function K$(e,i,s=ha){const l=ba(),p=cd(i),_=ey(i),b=U5(e,p),t=cb((P,O)=>{let F,$=ha,W;return S$(()=>{const Y=e[p];sd(F,Y)&&(F=Y,O())}),{get(){return P(),s.get?s.get(F):F},set(Y){const ae=s.set?s.set(Y):Y;if(!sd(ae,F)&&!($!==ha&&sd(Y,$)))return;const se=l.vnode.props;se&&(i in se||p in se||_ in se)&&(`onUpdate:${i}`in se||`onUpdate:${p}`in se||`onUpdate:${_}`in se)||(F=Y,O()),l.emit(`update:${i}`,ae),sd(Y,ae)&&sd(Y,$)&&!sd(ae,W)&&O(),$=Y,W=ae}}});return t[Symbol.iterator]=()=>{let P=0;return{next(){return P<2?{value:P++?b||ha:t,done:!1}:{done:!0}}}},t}const U5=(e,i)=>i==="modelValue"||i==="model-value"?e.modelModifiers:e[`${i}Modifiers`]||e[`${cd(i)}Modifiers`]||e[`${ey(i)}Modifiers`];function J$(e,i,...s){if(e.isUnmounted)return;const l=e.vnode.props||ha;let p=s;const _=i.startsWith("update:"),b=_&&U5(l,i.slice(7));b&&(b.trim&&(p=s.map(F=>Cl(F)?F.trim():F)),b.number&&(p=s.map(NU)));let t,P=l[t=sw(i)]||l[t=sw(cd(i))];!P&&_&&(P=l[t=sw(ey(i))]),P&&Cm(P,e,6,p);const O=l[t+"Once"];if(O){if(!e.emitted)e.emitted={};else if(e.emitted[t])return;e.emitted[t]=!0,Cm(O,e,6,p)}}const Q$=new WeakMap;function $5(e,i,s=!1){const l=s?Q$:i.emitsCache,p=l.get(e);if(p!==void 0)return p;const _=e.emits;let b={},t=!1;if(!Bs(e)){const P=O=>{const F=$5(O,i,!0);F&&(t=!0,jc(b,F))};!s&&i.mixins.length&&i.mixins.forEach(P),e.extends&&P(e.extends),e.mixins&&e.mixins.forEach(P)}return!_&&!t?(sl(e)&&l.set(e,null),null):(xs(_)?_.forEach(P=>b[P]=null):jc(b,_),sl(e)&&l.set(e,b),b)}function qE(e,i){return!e||!Zw(i)?!1:(i=i.slice(2).replace(/Once$/,""),Ma(e,i[0].toLowerCase()+i.slice(1))||Ma(e,ey(i))||Ma(e,i))}function gC(e){const{type:i,vnode:s,proxy:l,withProxy:p,propsOptions:[_],slots:b,attrs:t,emit:P,render:O,renderCache:F,props:$,data:W,setupState:Y,ctx:ae,inheritAttrs:se}=e,ie=eE(e);let pe,ye;try{if(s.shapeFlag&4){const Ee=p||l,Pe=Ee;pe=Bf(O.call(Pe,Ee,F,$,Y,W,ae)),ye=t}else{const Ee=i;pe=Bf(Ee.length>1?Ee($,{attrs:t,slots:b,emit:P}):Ee($,null)),ye=i.props?t:t7(t)}}catch(Ee){hw.length=0,ub(Ee,e,1),pe=tr(uc)}let de=pe;if(ye&&se!==!1){const Ee=Object.keys(ye),{shapeFlag:Pe}=de;Ee.length&&Pe&7&&(_&&Ee.some(HP)&&(ye=i7(ye,_)),de=kp(de,ye,!1,!0))}return s.dirs&&(de=kp(de,null,!1,!0),de.dirs=de.dirs?de.dirs.concat(s.dirs):s.dirs),s.transition&&n0(de,s.transition),pe=de,eE(ie),pe}function e7(e,i=!0){let s;for(let l=0;l<e.length;l++){const p=e[l];if(dv(p)){if(p.type!==uc||p.children==="v-if"){if(s)return;s=p}}else return}return s}const t7=e=>{let i;for(const s in e)(s==="class"||s==="style"||Zw(s))&&((i||(i={}))[s]=e[s]);return i},i7=(e,i)=>{const s={};for(const l in e)(!HP(l)||!(l.slice(9)in i))&&(s[l]=e[l]);return s};function n7(e,i,s){const{props:l,children:p,component:_}=e,{props:b,children:t,patchFlag:P}=i,O=_.emitsOptions;if(i.dirs||i.transition)return!0;if(s&&P>=0){if(P&1024)return!0;if(P&16)return l?BL(l,b,O):!!b;if(P&8){const F=i.dynamicProps;for(let $=0;$<F.length;$++){const W=F[$];if(b[W]!==l[W]&&!qE(O,W))return!0}}}else return(p||t)&&(!t||!t.$stable)?!0:l===b?!1:l?b?BL(l,b,O):!0:!!b;return!1}function BL(e,i,s){const l=Object.keys(i);if(l.length!==Object.keys(e).length)return!0;for(let p=0;p<l.length;p++){const _=l[p];if(i[_]!==e[_]&&!qE(s,_))return!0}return!1}function HE({vnode:e,parent:i},s){for(;i;){const l=i.subTree;if(l.suspense&&l.suspense.activeBranch===e&&(l.el=e.el),l===e)(e=i.vnode).el=s,i=i.parent;else break}}const G5={},q5=()=>Object.create(G5),H5=e=>Object.getPrototypeOf(e)===G5;function r7(e,i,s,l=!1){const p={},_=q5();e.propsDefaults=Object.create(null),W5(e,i,p,_);for(const b in e.propsOptions[0])b in p||(p[b]=void 0);s?e.props=l?p:Ip(p):e.type.props?e.props=p:e.props=_,e.attrs=_}function s7(e,i,s,l){const{props:p,attrs:_,vnode:{patchFlag:b}}=e,t=zo(p),[P]=e.propsOptions;let O=!1;if((l||b>0)&&!(b&16)){if(b&8){const F=e.vnode.dynamicProps;for(let $=0;$<F.length;$++){let W=F[$];if(qE(e.emitsOptions,W))continue;const Y=i[W];if(P)if(Ma(_,W))Y!==_[W]&&(_[W]=Y,O=!0);else{const ae=cd(W);p[ae]=SA(P,t,ae,Y,e,!1)}else Y!==_[W]&&(_[W]=Y,O=!0)}}}else{W5(e,i,p,_)&&(O=!0);let F;for(const $ in t)(!i||!Ma(i,$)&&((F=ey($))===$||!Ma(i,F)))&&(P?s&&(s[$]!==void 0||s[F]!==void 0)&&(p[$]=SA(P,t,$,void 0,e,!0)):delete p[$]);if(_!==t)for(const $ in _)(!i||!Ma(i,$))&&(delete _[$],O=!0)}O&&N_(e.attrs,"set","")}function W5(e,i,s,l){const[p,_]=e.propsOptions;let b=!1,t;if(i)for(let P in i){if(Nx(P))continue;const O=i[P];let F;p&&Ma(p,F=cd(P))?!_||!_.includes(F)?s[F]=O:(t||(t={}))[F]=O:qE(e.emitsOptions,P)||(!(P in l)||O!==l[P])&&(l[P]=O,b=!0)}if(_){const P=zo(s),O=t||ha;for(let F=0;F<_.length;F++){const $=_[F];s[$]=SA(p,P,$,O[$],e,!Ma(O,$))}}return b}function SA(e,i,s,l,p,_){const b=e[s];if(b!=null){const t=Ma(b,"default");if(t&&l===void 0){const P=b.default;if(b.type!==Function&&!b.skipFactory&&Bs(P)){const{propsDefaults:O}=p;if(s in O)l=O[s];else{const F=fv(p);l=O[s]=P.call(null,i),F()}}else l=P;p.ce&&p.ce._setProp(s,l)}b[0]&&(_&&!t?l=!1:b[1]&&(l===""||l===ey(s))&&(l=!0))}return l}const o7=new WeakMap;function Z5(e,i,s=!1){const l=s?o7:i.propsCache,p=l.get(e);if(p)return p;const _=e.props,b={},t=[];let P=!1;if(!Bs(e)){const F=$=>{P=!0;const[W,Y]=Z5($,i,!0);jc(b,W),Y&&t.push(...Y)};!s&&i.mixins.length&&i.mixins.forEach(F),e.extends&&F(e.extends),e.mixins&&e.mixins.forEach(F)}if(!_&&!P)return sl(e)&&l.set(e,Fx),Fx;if(xs(_))for(let F=0;F<_.length;F++){const $=cd(_[F]);NL($)&&(b[$]=ha)}else if(_)for(const F in _){const $=cd(F);if(NL($)){const W=_[F],Y=b[$]=xs(W)||Bs(W)?{type:W}:jc({},W),ae=Y.type;let se=!1,ie=!0;if(xs(ae))for(let pe=0;pe<ae.length;++pe){const ye=ae[pe],de=Bs(ye)&&ye.name;if(de==="Boolean"){se=!0;break}else de==="String"&&(ie=!1)}else se=Bs(ae)&&ae.name==="Boolean";Y[0]=se,Y[1]=ie,(se||Ma(Y,"default"))&&t.push($)}}const O=[b,t];return sl(e)&&l.set(e,O),O}function NL(e){return e[0]!=="$"&&!Nx(e)}const aM=e=>e==="_"||e==="_ctx"||e==="$stable",lM=e=>xs(e)?e.map(Bf):[Bf(e)],a7=(e,i,s)=>{if(i._n)return i;const l=Jn((...p)=>lM(i(...p)),s);return l._c=!1,l},X5=(e,i,s)=>{const l=e._ctx;for(const p in e){if(aM(p))continue;const _=e[p];if(Bs(_))i[p]=a7(p,_,l);else if(_!=null){const b=lM(_);i[p]=()=>b}}},Y5=(e,i)=>{const s=lM(i);e.slots.default=()=>s},K5=(e,i,s)=>{for(const l in i)(s||!aM(l))&&(e[l]=i[l])},l7=(e,i,s)=>{const l=e.slots=q5();if(e.vnode.shapeFlag&32){const p=i._;p?(K5(l,i,s),s&&qF(l,"_",p,!0)):X5(i,l)}else i&&Y5(e,i)},c7=(e,i,s)=>{const{vnode:l,slots:p}=e;let _=!0,b=ha;if(l.shapeFlag&32){const t=i._;t?s&&t===1?_=!1:K5(p,i,s):(_=!i.$stable,X5(i,p)),b=i}else i&&(Y5(e,i),b={default:1});if(_)for(const t in p)!aM(t)&&b[t]==null&&delete p[t]},Oc=nB;function u7(e){return J5(e)}function h7(e){return J5(e,D$)}function J5(e,i){const s=OE();s.__VUE__=!0;const{insert:l,remove:p,patchProp:_,createElement:b,createText:t,createComment:P,setText:O,setElementText:F,parentNode:$,nextSibling:W,setScopeId:Y=Pg,insertStaticContent:ae}=e,se=(St,Gt,Ai,hn=null,Ui=null,pt=null,Ot=void 0,vi=null,qi=!!Gt.dynamicChildren)=>{if(St===Gt)return;St&&!vm(St,Gt)&&(hn=ti(St),qn(St,Ui,pt,!0),St=null),Gt.patchFlag===-2&&(qi=!1,Gt.dynamicChildren=null);const{type:on,ref:Hi,shapeFlag:Bt}=Gt;switch(on){case t0:ie(St,Gt,Ai,hn);break;case uc:pe(St,Gt,Ai,hn);break;case bS:St==null&&ye(Gt,Ai,hn,Ot);break;case qs:Ht(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi);break;default:Bt&1?Pe(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi):Bt&6?ci(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi):(Bt&64||Bt&128)&&on.process(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi,gn)}Hi!=null&&Ui?jx(Hi,St&&St.ref,pt,Gt||St,!Gt):Hi==null&&St&&St.ref!=null&&jx(St.ref,null,pt,St,!0)},ie=(St,Gt,Ai,hn)=>{if(St==null)l(Gt.el=t(Gt.children),Ai,hn);else{const Ui=Gt.el=St.el;Gt.children!==St.children&&O(Ui,Gt.children)}},pe=(St,Gt,Ai,hn)=>{St==null?l(Gt.el=P(Gt.children||""),Ai,hn):Gt.el=St.el},ye=(St,Gt,Ai,hn)=>{[St.el,St.anchor]=ae(St.children,Gt,Ai,hn,St.el,St.anchor)},de=({el:St,anchor:Gt},Ai,hn)=>{let Ui;for(;St&&St!==Gt;)Ui=W(St),l(St,Ai,hn),St=Ui;l(Gt,Ai,hn)},Ee=({el:St,anchor:Gt})=>{let Ai;for(;St&&St!==Gt;)Ai=W(St),p(St),St=Ai;p(Gt)},Pe=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi)=>{if(Gt.type==="svg"?Ot="svg":Gt.type==="math"&&(Ot="mathml"),St==null)Ze(Gt,Ai,hn,Ui,pt,Ot,vi,qi);else{const on=St.el&&St.el._isVueCE?St.el:null;try{on&&on._beginPatch(),Ye(St,Gt,Ui,pt,Ot,vi,qi)}finally{on&&on._endPatch()}}},Ze=(St,Gt,Ai,hn,Ui,pt,Ot,vi)=>{let qi,on;const{props:Hi,shapeFlag:Bt,transition:Ii,dirs:qt}=St;if(qi=St.el=b(St.type,pt,Hi&&Hi.is,Hi),Bt&8?F(qi,St.children):Bt&16&&je(St.children,qi,null,hn,Ui,_C(St,pt),Ot,vi),qt&&Eg(St,null,hn,"created"),We(qi,St,St.scopeId,Ot,hn),Hi){for(const Ge in Hi)Ge!=="value"&&!Nx(Ge)&&_(qi,Ge,null,Hi[Ge],pt,hn);"value"in Hi&&_(qi,"value",null,Hi.value,pt),(on=Hi.onVnodeBeforeMount)&&Vd(on,hn,St)}qt&&Eg(St,null,hn,"beforeMount");const Ne=Q5(Ui,Ii);Ne&&Ii.beforeEnter(qi),l(qi,Gt,Ai),((on=Hi&&Hi.onVnodeMounted)||Ne||qt)&&Oc(()=>{on&&Vd(on,hn,St),Ne&&Ii.enter(qi),qt&&Eg(St,null,hn,"mounted")},Ui)},We=(St,Gt,Ai,hn,Ui)=>{if(Ai&&Y(St,Ai),hn)for(let pt=0;pt<hn.length;pt++)Y(St,hn[pt]);if(Ui){let pt=Ui.subTree;if(Gt===pt||rE(pt.type)&&(pt.ssContent===Gt||pt.ssFallback===Gt)){const Ot=Ui.vnode;We(St,Ot,Ot.scopeId,Ot.slotScopeIds,Ui.parent)}}},je=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi=0)=>{for(let on=qi;on<St.length;on++){const Hi=St[on]=vi?Ky(St[on]):Bf(St[on]);se(null,Hi,Gt,Ai,hn,Ui,pt,Ot,vi)}},Ye=(St,Gt,Ai,hn,Ui,pt,Ot)=>{const vi=Gt.el=St.el;let{patchFlag:qi,dynamicChildren:on,dirs:Hi}=Gt;qi|=St.patchFlag&16;const Bt=St.props||ha,Ii=Gt.props||ha;let qt;if(Ai&&Z0(Ai,!1),(qt=Ii.onVnodeBeforeUpdate)&&Vd(qt,Ai,Gt,St),Hi&&Eg(Gt,St,Ai,"beforeUpdate"),Ai&&Z0(Ai,!0),(Bt.innerHTML&&Ii.innerHTML==null||Bt.textContent&&Ii.textContent==null)&&F(vi,""),on?ct(St.dynamicChildren,on,vi,Ai,hn,_C(Gt,Ui),pt):Ot||vt(St,Gt,vi,null,Ai,hn,_C(Gt,Ui),pt,!1),qi>0){if(qi&16)Lt(vi,Bt,Ii,Ai,Ui);else if(qi&2&&Bt.class!==Ii.class&&_(vi,"class",null,Ii.class,Ui),qi&4&&_(vi,"style",Bt.style,Ii.style,Ui),qi&8){const Ne=Gt.dynamicProps;for(let Ge=0;Ge<Ne.length;Ge++){const Ke=Ne[Ge],At=Bt[Ke],jt=Ii[Ke];(jt!==At||Ke==="value")&&_(vi,Ke,At,jt,Ui,Ai)}}qi&1&&St.children!==Gt.children&&F(vi,Gt.children)}else!Ot&&on==null&&Lt(vi,Bt,Ii,Ai,Ui);((qt=Ii.onVnodeUpdated)||Hi)&&Oc(()=>{qt&&Vd(qt,Ai,Gt,St),Hi&&Eg(Gt,St,Ai,"updated")},hn)},ct=(St,Gt,Ai,hn,Ui,pt,Ot)=>{for(let vi=0;vi<Gt.length;vi++){const qi=St[vi],on=Gt[vi],Hi=qi.el&&(qi.type===qs||!vm(qi,on)||qi.shapeFlag&198)?$(qi.el):Ai;se(qi,on,Hi,null,hn,Ui,pt,Ot,!0)}},Lt=(St,Gt,Ai,hn,Ui)=>{if(Gt!==Ai){if(Gt!==ha)for(const pt in Gt)!Nx(pt)&&!(pt in Ai)&&_(St,pt,Gt[pt],null,Ui,hn);for(const pt in Ai){if(Nx(pt))continue;const Ot=Ai[pt],vi=Gt[pt];Ot!==vi&&pt!=="value"&&_(St,pt,vi,Ot,Ui,hn)}"value"in Ai&&_(St,"value",Gt.value,Ai.value,Ui)}},Ht=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi)=>{const on=Gt.el=St?St.el:t(""),Hi=Gt.anchor=St?St.anchor:t("");let{patchFlag:Bt,dynamicChildren:Ii,slotScopeIds:qt}=Gt;qt&&(vi=vi?vi.concat(qt):qt),St==null?(l(on,Ai,hn),l(Hi,Ai,hn),je(Gt.children||[],Ai,Hi,Ui,pt,Ot,vi,qi)):Bt>0&&Bt&64&&Ii&&St.dynamicChildren&&St.dynamicChildren.length===Ii.length?(ct(St.dynamicChildren,Ii,Ai,Ui,pt,Ot,vi),(Gt.key!=null||Ui&&Gt===Ui.subTree)&&cM(St,Gt,!0)):vt(St,Gt,Ai,Hi,Ui,pt,Ot,vi,qi)},ci=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi)=>{Gt.slotScopeIds=vi,St==null?Gt.shapeFlag&512?Ui.ctx.activate(Gt,Ai,hn,Ot,qi):Wt(Gt,Ai,hn,Ui,pt,Ot,qi):$t(St,Gt,qi)},Wt=(St,Gt,Ai,hn,Ui,pt,Ot)=>{const vi=St.component=w7(St,hn,Ui);if(Jw(St)&&(vi.ctx.renderer=gn),T7(vi,!1,Ot),vi.asyncDep){if(Ui&&Ui.registerDep(vi,Dt,Ot),!St.el){const qi=vi.subTree=tr(uc);pe(null,qi,Gt,Ai),St.placeholder=qi.el}}else Dt(vi,St,Gt,Ai,Ui,pt,Ot)},$t=(St,Gt,Ai)=>{const hn=Gt.component=St.component;if(n7(St,Gt,Ai))if(hn.asyncDep&&!hn.asyncResolved){Ft(hn,Gt,Ai);return}else hn.next=Gt,hn.update();else Gt.el=St.el,hn.vnode=Gt},Dt=(St,Gt,Ai,hn,Ui,pt,Ot)=>{const vi=()=>{if(St.isMounted){let{next:Bt,bu:Ii,u:qt,parent:Ne,vnode:Ge}=St;{const gi=eB(St);if(gi){Bt&&(Bt.el=Ge.el,Ft(St,Bt,Ot)),gi.asyncDep.then(()=>{St.isUnmounted||vi()});return}}let Ke=Bt,At;Z0(St,!1),Bt?(Bt.el=Ge.el,Ft(St,Bt,Ot)):Bt=Ge,Ii&&ow(Ii),(At=Bt.props&&Bt.props.onVnodeBeforeUpdate)&&Vd(At,Ne,Bt,Ge),Z0(St,!0);const jt=gC(St),bi=St.subTree;St.subTree=jt,se(bi,jt,$(bi.el),ti(bi),St,Ui,pt),Bt.el=jt.el,Ke===null&&HE(St,jt.el),qt&&Oc(qt,Ui),(At=Bt.props&&Bt.props.onVnodeUpdated)&&Oc(()=>Vd(At,Ne,Bt,Ge),Ui)}else{let Bt;const{el:Ii,props:qt}=Gt,{bm:Ne,m:Ge,parent:Ke,root:At,type:jt}=St,bi=$_(Gt);if(Z0(St,!1),Ne&&ow(Ne),!bi&&(Bt=qt&&qt.onVnodeBeforeMount)&&Vd(Bt,Ke,Gt),Z0(St,!0),Ii&&Ur){const gi=()=>{St.subTree=gC(St),Ur(Ii,St.subTree,St,Ui,null)};bi&&jt.__asyncHydrate?jt.__asyncHydrate(Ii,St,gi):gi()}else{At.ce&&At.ce._def.shadowRoot!==!1&&At.ce._injectChildStyle(jt);const gi=St.subTree=gC(St);se(null,gi,Ai,hn,St,Ui,pt),Gt.el=gi.el}if(Ge&&Oc(Ge,Ui),!bi&&(Bt=qt&&qt.onVnodeMounted)){const gi=Gt;Oc(()=>Vd(Bt,Ke,gi),Ui)}(Gt.shapeFlag&256||Ke&&$_(Ke.vnode)&&Ke.vnode.shapeFlag&256)&&St.a&&Oc(St.a,Ui),St.isMounted=!0,Gt=Ai=hn=null}};St.scope.on();const qi=St.effect=new KF(vi);St.scope.off();const on=St.update=qi.run.bind(qi),Hi=St.job=qi.runIfDirty.bind(qi);Hi.i=St,Hi.id=St.uid,qi.scheduler=()=>QP(Hi),Z0(St,!0),on()},Ft=(St,Gt,Ai)=>{Gt.component=St;const hn=St.vnode.props;St.vnode=Gt,St.next=null,s7(St,Gt.props,hn,Ai),c7(St,Gt.children,Ai),W_(),EL(St),Z_()},vt=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi=!1)=>{const on=St&&St.children,Hi=St?St.shapeFlag:0,Bt=Gt.children,{patchFlag:Ii,shapeFlag:qt}=Gt;if(Ii>0){if(Ii&128){Qi(on,Bt,Ai,hn,Ui,pt,Ot,vi,qi);return}else if(Ii&256){wi(on,Bt,Ai,hn,Ui,pt,Ot,vi,qi);return}}qt&8?(Hi&16&&Hr(on,Ui,pt),Bt!==on&&F(Ai,Bt)):Hi&16?qt&16?Qi(on,Bt,Ai,hn,Ui,pt,Ot,vi,qi):Hr(on,Ui,pt,!0):(Hi&8&&F(Ai,""),qt&16&&je(Bt,Ai,hn,Ui,pt,Ot,vi,qi))},wi=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi)=>{St=St||Fx,Gt=Gt||Fx;const on=St.length,Hi=Gt.length,Bt=Math.min(on,Hi);let Ii;for(Ii=0;Ii<Bt;Ii++){const qt=Gt[Ii]=qi?Ky(Gt[Ii]):Bf(Gt[Ii]);se(St[Ii],qt,Ai,null,Ui,pt,Ot,vi,qi)}on>Hi?Hr(St,Ui,pt,!0,!1,Bt):je(Gt,Ai,hn,Ui,pt,Ot,vi,qi,Bt)},Qi=(St,Gt,Ai,hn,Ui,pt,Ot,vi,qi)=>{let on=0;const Hi=Gt.length;let Bt=St.length-1,Ii=Hi-1;for(;on<=Bt&&on<=Ii;){const qt=St[on],Ne=Gt[on]=qi?Ky(Gt[on]):Bf(Gt[on]);if(vm(qt,Ne))se(qt,Ne,Ai,null,Ui,pt,Ot,vi,qi);else break;on++}for(;on<=Bt&&on<=Ii;){const qt=St[Bt],Ne=Gt[Ii]=qi?Ky(Gt[Ii]):Bf(Gt[Ii]);if(vm(qt,Ne))se(qt,Ne,Ai,null,Ui,pt,Ot,vi,qi);else break;Bt--,Ii--}if(on>Bt){if(on<=Ii){const qt=Ii+1,Ne=qt<Hi?Gt[qt].el:hn;for(;on<=Ii;)se(null,Gt[on]=qi?Ky(Gt[on]):Bf(Gt[on]),Ai,Ne,Ui,pt,Ot,vi,qi),on++}}else if(on>Ii)for(;on<=Bt;)qn(St[on],Ui,pt,!0),on++;else{const qt=on,Ne=on,Ge=new Map;for(on=Ne;on<=Ii;on++){const un=Gt[on]=qi?Ky(Gt[on]):Bf(Gt[on]);un.key!=null&&Ge.set(un.key,on)}let Ke,At=0;const jt=Ii-Ne+1;let bi=!1,gi=0;const ii=new Array(jt);for(on=0;on<jt;on++)ii[on]=0;for(on=qt;on<=Bt;on++){const un=St[on];if(At>=jt){qn(un,Ui,pt,!0);continue}let nn;if(un.key!=null)nn=Ge.get(un.key);else for(Ke=Ne;Ke<=Ii;Ke++)if(ii[Ke-Ne]===0&&vm(un,Gt[Ke])){nn=Ke;break}nn===void 0?qn(un,Ui,pt,!0):(ii[nn-Ne]=on+1,nn>=gi?gi=nn:bi=!0,se(un,Gt[nn],Ai,null,Ui,pt,Ot,vi,qi),At++)}const Ci=bi?d7(ii):Fx;for(Ke=Ci.length-1,on=jt-1;on>=0;on--){const un=Ne+on,nn=Gt[un],Zn=Gt[un+1],fr=un+1<Hi?Zn.el||tB(Zn):hn;ii[on]===0?se(null,nn,Ai,fr,Ui,pt,Ot,vi,qi):bi&&(Ke<0||on!==Ci[Ke]?wn(nn,Ai,fr,2):Ke--)}}},wn=(St,Gt,Ai,hn,Ui=null)=>{const{el:pt,type:Ot,transition:vi,children:qi,shapeFlag:on}=St;if(on&6){wn(St.component.subTree,Gt,Ai,hn);return}if(on&128){St.suspense.move(Gt,Ai,hn);return}if(on&64){Ot.move(St,Gt,Ai,gn);return}if(Ot===qs){l(pt,Gt,Ai);for(let Bt=0;Bt<qi.length;Bt++)wn(qi[Bt],Gt,Ai,hn);l(St.anchor,Gt,Ai);return}if(Ot===bS){de(St,Gt,Ai);return}if(hn!==2&&on&1&&vi)if(hn===0)vi.beforeEnter(pt),l(pt,Gt,Ai),Oc(()=>vi.enter(pt),Ui);else{const{leave:Bt,delayLeave:Ii,afterLeave:qt}=vi,Ne=()=>{St.ctx.isUnmounted?p(pt):l(pt,Gt,Ai)},Ge=()=>{pt._isLeaving&&pt[O_](!0),Bt(pt,()=>{Ne(),qt&&qt()})};Ii?Ii(pt,Ne,Ge):Ge()}else l(pt,Gt,Ai)},qn=(St,Gt,Ai,hn=!1,Ui=!1)=>{const{type:pt,props:Ot,ref:vi,children:qi,dynamicChildren:on,shapeFlag:Hi,patchFlag:Bt,dirs:Ii,cacheIndex:qt}=St;if(Bt===-2&&(Ui=!1),vi!=null&&(W_(),jx(vi,null,Ai,St,!0),Z_()),qt!=null&&(Gt.renderCache[qt]=void 0),Hi&256){Gt.ctx.deactivate(St);return}const Ne=Hi&1&&Ii,Ge=!$_(St);let Ke;if(Ge&&(Ke=Ot&&Ot.onVnodeBeforeUnmount)&&Vd(Ke,Gt,St),Hi&6)Sr(St.component,Ai,hn);else{if(Hi&128){St.suspense.unmount(Ai,hn);return}Ne&&Eg(St,null,Gt,"beforeUnmount"),Hi&64?St.type.remove(St,Gt,Ai,gn,hn):on&&!on.hasOnce&&(pt!==qs||Bt>0&&Bt&64)?Hr(on,Gt,Ai,!1,!0):(pt===qs&&Bt&384||!Ui&&Hi&16)&&Hr(qi,Gt,Ai),hn&&Fn(St)}(Ge&&(Ke=Ot&&Ot.onVnodeUnmounted)||Ne)&&Oc(()=>{Ke&&Vd(Ke,Gt,St),Ne&&Eg(St,null,Gt,"unmounted")},Ai)},Fn=St=>{const{type:Gt,el:Ai,anchor:hn,transition:Ui}=St;if(Gt===qs){mr(Ai,hn);return}if(Gt===bS){Ee(St);return}const pt=()=>{p(Ai),Ui&&!Ui.persisted&&Ui.afterLeave&&Ui.afterLeave()};if(St.shapeFlag&1&&Ui&&!Ui.persisted){const{leave:Ot,delayLeave:vi}=Ui,qi=()=>Ot(Ai,pt);vi?vi(St.el,pt,qi):qi()}else pt()},mr=(St,Gt)=>{let Ai;for(;St!==Gt;)Ai=W(St),p(St),St=Ai;p(Gt)},Sr=(St,Gt,Ai)=>{const{bum:hn,scope:Ui,job:pt,subTree:Ot,um:vi,m:qi,a:on}=St;nE(qi),nE(on),hn&&ow(hn),Ui.stop(),pt&&(pt.flags|=8,qn(Ot,St,Gt,Ai)),vi&&Oc(vi,Gt),Oc(()=>{St.isUnmounted=!0},Gt)},Hr=(St,Gt,Ai,hn=!1,Ui=!1,pt=0)=>{for(let Ot=pt;Ot<St.length;Ot++)qn(St[Ot],Gt,Ai,hn,Ui)},ti=St=>{if(St.shapeFlag&6)return ti(St.component.subTree);if(St.shapeFlag&128)return St.suspense.next();const Gt=W(St.anchor||St.el),Ai=Gt&&Gt[w5];return Ai?W(Ai):Gt};let sn=!1;const Gi=(St,Gt,Ai)=>{let hn;St==null?Gt._vnode&&(qn(Gt._vnode,null,null,!0),hn=Gt._vnode.component):se(Gt._vnode||null,St,Gt,null,null,null,Ai),Gt._vnode=St,sn||(sn=!0,EL(hn),QS(),sn=!1)},gn={p:se,um:qn,m:wn,r:Fn,mt:Wt,mc:je,pc:vt,pbc:ct,n:ti,o:e};let nr,Ur;return i&&([nr,Ur]=i(gn)),{render:Gi,hydrate:nr,createApp:Y$(Gi,nr)}}function _C({type:e,props:i},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&i&&i.encoding&&i.encoding.includes("html")?void 0:s}function Z0({effect:e,job:i},s){s?(e.flags|=32,i.flags|=4):(e.flags&=-33,i.flags&=-5)}function Q5(e,i){return(!e||e&&!e.pendingBranch)&&i&&!i.persisted}function cM(e,i,s=!1){const l=e.children,p=i.children;if(xs(l)&&xs(p))for(let _=0;_<l.length;_++){const b=l[_];let t=p[_];t.shapeFlag&1&&!t.dynamicChildren&&((t.patchFlag<=0||t.patchFlag===32)&&(t=p[_]=Ky(p[_]),t.el=b.el),!s&&t.patchFlag!==-2&&cM(b,t)),t.type===t0&&(t.patchFlag!==-1?t.el=b.el:t.__elIndex=_+(e.type===qs?1:0)),t.type===uc&&!t.el&&(t.el=b.el)}}function d7(e){const i=e.slice(),s=[0];let l,p,_,b,t;const P=e.length;for(l=0;l<P;l++){const O=e[l];if(O!==0){if(p=s[s.length-1],e[p]<O){i[l]=p,s.push(l);continue}for(_=0,b=s.length-1;_<b;)t=_+b>>1,e[s[t]]<O?_=t+1:b=t;O<e[s[_]]&&(_>0&&(i[l]=s[_-1]),s[_]=l)}}for(_=s.length,b=s[_-1];_-- >0;)s[_]=b,b=i[b];return s}function eB(e){const i=e.subTree.component;if(i)return i.asyncDep&&!i.asyncResolved?i:eB(i)}function nE(e){if(e)for(let i=0;i<e.length;i++)e[i].flags|=8}function tB(e){if(e.placeholder)return e.placeholder;const i=e.component;return i?tB(i.subTree):null}const rE=e=>e.__isSuspense;let EA=0;const f7={name:"Suspense",__isSuspense:!0,process(e,i,s,l,p,_,b,t,P,O){if(e==null)p7(i,s,l,p,_,b,t,P,O);else{if(_&&_.deps>0&&!e.suspense.isInFallback){i.suspense=e.suspense,i.suspense.vnode=i,i.el=e.el;return}m7(e,i,s,l,p,b,t,P,O)}},hydrate:g7,normalize:_7},uM=f7;function Mw(e,i){const s=e.props&&e.props[i];Bs(s)&&s()}function p7(e,i,s,l,p,_,b,t,P){const{p:O,o:{createElement:F}}=P,$=F("div"),W=e.suspense=iB(e,p,l,i,$,s,_,b,t,P);O(null,W.pendingBranch=e.ssContent,$,null,l,W,_,b),W.deps>0?(Mw(e,"onPending"),Mw(e,"onFallback"),O(null,e.ssFallback,i,s,l,null,_,b),$x(W,e.ssFallback)):W.resolve(!1,!0)}function m7(e,i,s,l,p,_,b,t,{p:P,um:O,o:{createElement:F}}){const $=i.suspense=e.suspense;$.vnode=i,i.el=e.el;const W=i.ssContent,Y=i.ssFallback,{activeBranch:ae,pendingBranch:se,isInFallback:ie,isHydrating:pe}=$;if(se)$.pendingBranch=W,vm(se,W)?(P(se,W,$.hiddenContainer,null,p,$,_,b,t),$.deps<=0?$.resolve():ie&&(pe||(P(ae,Y,s,l,p,null,_,b,t),$x($,Y)))):($.pendingId=EA++,pe?($.isHydrating=!1,$.activeBranch=se):O(se,p,$),$.deps=0,$.effects.length=0,$.hiddenContainer=F("div"),ie?(P(null,W,$.hiddenContainer,null,p,$,_,b,t),$.deps<=0?$.resolve():(P(ae,Y,s,l,p,null,_,b,t),$x($,Y))):ae&&vm(ae,W)?(P(ae,W,s,l,p,$,_,b,t),$.resolve(!0)):(P(null,W,$.hiddenContainer,null,p,$,_,b,t),$.deps<=0&&$.resolve()));else if(ae&&vm(ae,W))P(ae,W,s,l,p,$,_,b,t),$x($,W);else if(Mw(i,"onPending"),$.pendingBranch=W,W.shapeFlag&512?$.pendingId=W.component.suspenseId:$.pendingId=EA++,P(null,W,$.hiddenContainer,null,p,$,_,b,t),$.deps<=0)$.resolve();else{const{timeout:ye,pendingId:de}=$;ye>0?setTimeout(()=>{$.pendingId===de&&$.fallback(Y)},ye):ye===0&&$.fallback(Y)}}function iB(e,i,s,l,p,_,b,t,P,O,F=!1){const{p:$,m:W,um:Y,n:ae,o:{parentNode:se,remove:ie}}=O;let pe;const ye=y7(e);ye&&i&&i.pendingBranch&&(pe=i.pendingId,i.deps++);const de=e.props?HF(e.props.timeout):void 0,Ee=_,Pe={vnode:e,parent:i,parentComponent:s,namespace:b,container:l,hiddenContainer:p,deps:0,pendingId:EA++,timeout:typeof de=="number"?de:-1,activeBranch:null,pendingBranch:null,isInFallback:!F,isHydrating:F,isUnmounted:!1,effects:[],resolve(Ze=!1,We=!1){const{vnode:je,activeBranch:Ye,pendingBranch:ct,pendingId:Lt,effects:Ht,parentComponent:ci,container:Wt,isInFallback:$t}=Pe;let Dt=!1;Pe.isHydrating?Pe.isHydrating=!1:Ze||(Dt=Ye&&ct.transition&&ct.transition.mode==="out-in",Dt&&(Ye.transition.afterLeave=()=>{Lt===Pe.pendingId&&(W(ct,Wt,_===Ee?ae(Ye):_,0),JS(Ht),$t&&je.ssFallback&&(je.ssFallback.el=null))}),Ye&&(se(Ye.el)===Wt&&(_=ae(Ye)),Y(Ye,ci,Pe,!0),!Dt&&$t&&je.ssFallback&&Oc(()=>je.ssFallback.el=null,Pe)),Dt||W(ct,Wt,_,0)),$x(Pe,ct),Pe.pendingBranch=null,Pe.isInFallback=!1;let Ft=Pe.parent,vt=!1;for(;Ft;){if(Ft.pendingBranch){Ft.effects.push(...Ht),vt=!0;break}Ft=Ft.parent}!vt&&!Dt&&JS(Ht),Pe.effects=[],ye&&i&&i.pendingBranch&&pe===i.pendingId&&(i.deps--,i.deps===0&&!We&&i.resolve()),Mw(je,"onResolve")},fallback(Ze){if(!Pe.pendingBranch)return;const{vnode:We,activeBranch:je,parentComponent:Ye,container:ct,namespace:Lt}=Pe;Mw(We,"onFallback");const Ht=ae(je),ci=()=>{Pe.isInFallback&&($(null,Ze,ct,Ht,Ye,null,Lt,t,P),$x(Pe,Ze))},Wt=Ze.transition&&Ze.transition.mode==="out-in";Wt&&(je.transition.afterLeave=ci),Pe.isInFallback=!0,Y(je,Ye,null,!0),Wt||ci()},move(Ze,We,je){Pe.activeBranch&&W(Pe.activeBranch,Ze,We,je),Pe.container=Ze},next(){return Pe.activeBranch&&ae(Pe.activeBranch)},registerDep(Ze,We,je){const Ye=!!Pe.pendingBranch;Ye&&Pe.deps++;const ct=Ze.vnode.el;Ze.asyncDep.catch(Lt=>{ub(Lt,Ze,0)}).then(Lt=>{if(Ze.isUnmounted||Pe.isUnmounted||Pe.pendingId!==Ze.suspenseId)return;Ze.asyncResolved=!0;const{vnode:Ht}=Ze;AA(Ze,Lt),ct&&(Ht.el=ct);const ci=!ct&&Ze.subTree.el;We(Ze,Ht,se(ct||Ze.subTree.el),ct?null:ae(Ze.subTree),Pe,b,je),ci&&(Ht.placeholder=null,ie(ci)),HE(Ze,Ht.el),Ye&&--Pe.deps===0&&Pe.resolve()})},unmount(Ze,We){Pe.isUnmounted=!0,Pe.activeBranch&&Y(Pe.activeBranch,s,Ze,We),Pe.pendingBranch&&Y(Pe.pendingBranch,s,Ze,We)}};return Pe}function g7(e,i,s,l,p,_,b,t,P){const O=i.suspense=iB(i,l,s,e.parentNode,document.createElement("div"),null,p,_,b,t,!0),F=P(e,O.pendingBranch=i.ssContent,s,O,_,b);return O.deps===0&&O.resolve(!1,!0),F}function _7(e){const{shapeFlag:i,children:s}=e,l=i&32;e.ssContent=VL(l?s.default:s),e.ssFallback=l?VL(s.fallback):tr(uc)}function VL(e){let i;if(Bs(e)){const s=hv&&e._c;s&&(e._d=!1,li()),e=e(),s&&(e._d=!0,i=Ah,rB())}return xs(e)&&(e=e7(e)),e=Bf(e),i&&!e.dynamicChildren&&(e.dynamicChildren=i.filter(s=>s!==e)),e}function nB(e,i){i&&i.pendingBranch?xs(e)?i.effects.push(...e):i.effects.push(e):JS(e)}function $x(e,i){e.activeBranch=i;const{vnode:s,parentComponent:l}=e;let p=i.el;for(;!p&&i.component;)i=i.component.subTree,p=i.el;s.el=p,l&&l.subTree===s&&(l.vnode.el=p,HE(l,p))}function y7(e){const i=e.props&&e.props.suspensible;return i!=null&&i!==!1}const qs=Symbol.for("v-fgt"),t0=Symbol.for("v-txt"),uc=Symbol.for("v-cmt"),bS=Symbol.for("v-stc"),hw=[];let Ah=null;function li(e=!1){hw.push(Ah=e?null:[])}function rB(){hw.pop(),Ah=hw[hw.length-1]||null}let hv=1;function sE(e,i=!1){hv+=e,e<0&&Ah&&i&&(Ah.hasOnce=!0)}function sB(e){return e.dynamicChildren=hv>0?Ah||Fx:null,rB(),hv>0&&Ah&&Ah.push(e),e}function ir(e,i,s,l,p,_){return sB(Bn(e,i,s,l,p,_,!0))}function En(e,i,s,l,p){return sB(tr(e,i,s,l,p,!0))}function dv(e){return e?e.__v_isVNode===!0:!1}function vm(e,i){return e.type===i.type&&e.key===i.key}const oB=({key:e})=>e??null,wS=({ref:e,ref_key:i,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?Cl(e)||Wo(e)||Bs(e)?{i:Wu,r:e,k:i,f:!!s}:e:null);function Bn(e,i=null,s=null,l=0,p=null,_=e===qs?0:1,b=!1,t=!1){const P={__v_isVNode:!0,__v_skip:!0,type:e,props:i,key:i&&oB(i),ref:i&&wS(i),scopeId:v5,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:_,patchFlag:l,dynamicProps:p,dynamicChildren:null,appContext:null,ctx:Wu};return t?(hM(P,s),_&128&&e.normalize(P)):s&&(P.shapeFlag|=Cl(s)?8:16),hv>0&&!b&&Ah&&(P.patchFlag>0||_&6)&&P.patchFlag!==32&&Ah.push(P),P}const tr=v7;function v7(e,i=null,s=null,l=0,p=null,_=!1){if((!e||e===R5)&&(e=uc),dv(e)){const t=kp(e,i,!0);return s&&hM(t,s),hv>0&&!_&&Ah&&(t.shapeFlag&6?Ah[Ah.indexOf(e)]=t:Ah.push(t)),t.patchFlag=-2,t}if(I7(e)&&(e=e.__vccOpts),i){i=o0(i);let{class:t,style:P}=i;t&&!Cl(t)&&(i.class=_s(t)),sl(P)&&(jE(P)&&!xs(P)&&(P=jc({},P)),i.style=Su(P))}const b=Cl(e)?1:rE(e)?128:T5(e)?64:sl(e)?4:Bs(e)?2:0;return Bn(e,i,s,l,p,b,_,!0)}function o0(e){return e?jE(e)||H5(e)?jc({},e):e:null}function kp(e,i,s=!1,l=!1){const{props:p,ref:_,patchFlag:b,children:t,transition:P}=e,O=i?Oo(p||{},i):p,F={__v_isVNode:!0,__v_skip:!0,type:e.type,props:O,key:O&&oB(O),ref:i&&i.ref?s&&_?xs(_)?_.concat(wS(i)):[_,wS(i)]:wS(i):_,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:t,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:i&&e.type!==qs?b===-1?16:b|16:b,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:P,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&kp(e.ssContent),ssFallback:e.ssFallback&&kp(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return P&&l&&n0(F,P.clone(F)),F}function Gd(e=" ",i=0){return tr(t0,null,e,i)}function gr(e="",i=!1){return i?(li(),En(uc,null,e)):tr(uc,null,e)}function Bf(e){return e==null||typeof e=="boolean"?tr(uc):xs(e)?tr(qs,null,e.slice()):dv(e)?Ky(e):tr(t0,null,String(e))}function Ky(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:kp(e)}function hM(e,i){let s=0;const{shapeFlag:l}=e;if(i==null)i=null;else if(xs(i))s=16;else if(typeof i=="object")if(l&65){const p=i.default;p&&(p._c&&(p._d=!1),hM(e,p()),p._c&&(p._d=!0));return}else{s=32;const p=i._;!p&&!H5(i)?i._ctx=Wu:p===3&&Wu&&(Wu.slots._===1?i._=1:(i._=2,e.patchFlag|=1024))}else Bs(i)?(i={default:i,_ctx:Wu},s=32):(i=String(i),l&64?(s=16,i=[Gd(i)]):s=8);e.children=i,e.shapeFlag|=s}function Oo(...e){const i={};for(let s=0;s<e.length;s++){const l=e[s];for(const p in l)if(p==="class")i.class!==l.class&&(i.class=_s([i.class,l.class]));else if(p==="style")i.style=Su([i.style,l.style]);else if(Zw(p)){const _=i[p],b=l[p];b&&_!==b&&!(xs(_)&&_.includes(b))&&(i[p]=_?[].concat(_,b):b)}else p!==""&&(i[p]=l[p])}return i}function Vd(e,i,s,l=null){Cm(e,i,7,[s,l])}const x7=j5();let b7=0;function w7(e,i,s){const l=e.type,p=(i?i.appContext:e.appContext)||x7,_={uid:b7++,vnode:e,type:l,parent:i,appContext:p,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new YF(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:i?i.provides:Object.create(p.provides),ids:i?i.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Z5(l,p),emitsOptions:$5(l,p),emit:null,emitted:null,propsDefaults:ha,inheritAttrs:l.inheritAttrs,ctx:ha,data:ha,props:ha,attrs:ha,slots:ha,refs:ha,setupState:ha,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return _.ctx={_},_.root=i?i.root:_,_.emit=J$.bind(null,_),e.ce&&e.ce(_),_}let Hu=null;const ba=()=>Hu||Wu;let oE,IA;{const e=OE(),i=(s,l)=>{let p;return(p=e[s])||(p=e[s]=[]),p.push(l),_=>{p.length>1?p.forEach(b=>b(_)):p[0](_)}};oE=i("__VUE_INSTANCE_SETTERS__",s=>Hu=s),IA=i("__VUE_SSR_SETTERS__",s=>Xx=s)}const fv=e=>{const i=Hu;return oE(e),e.scope.on(),()=>{e.scope.off(),oE(i)}},CA=()=>{Hu&&Hu.scope.off(),oE(null)};function aB(e){return e.vnode.shapeFlag&4}let Xx=!1;function T7(e,i=!1,s=!1){i&&IA(i);const{props:l,children:p}=e.vnode,_=aB(e);r7(e,l,_,i),l7(e,p,s||i);const b=_?S7(e,i):void 0;return i&&IA(!1),b}function S7(e,i){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,j$);const{setup:l}=s;if(l){W_();const p=e.setupContext=l.length>1?cB(e):null,_=fv(e),b=Yw(l,e,0,[e.props,p]),t=ZP(b);if(Z_(),_(),(t||e.sp)&&!$_(e)&&tM(e),t){if(b.then(CA,CA),i)return b.then(P=>{AA(e,P)}).catch(P=>{ub(P,e,0)});e.asyncDep=b}else AA(e,b)}else lB(e)}function AA(e,i,s){Bs(i)?e.type.__ssrInlineRender?e.ssrRender=i:e.render=i:sl(i)&&(e.setupState=p5(i)),lB(e)}function lB(e,i,s){const l=e.type;e.render||(e.render=l.render||Pg);{const p=fv(e);W_();try{G$(e)}finally{Z_(),p()}}}const E7={get(e,i){return Ch(e,"get",""),e[i]}};function cB(e){const i=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,E7),slots:e.slots,emit:e.emit,expose:i}}function WE(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(p5(uv(e.exposed)),{get(i,s){if(s in i)return i[s];if(s in uw)return uw[s](e)},has(i,s){return s in i||s in uw}})):e.proxy}function PA(e,i=!0){return Bs(e)?e.displayName||e.name:e.name||i&&e.__name}function I7(e){return Bs(e)&&"__vccOpts"in e}const Ei=(e,i)=>_$(e,i,Xx);function Ns(e,i,s){try{sE(-1);const l=arguments.length;return l===2?sl(i)&&!xs(i)?dv(i)?tr(e,null,[i]):tr(e,i):tr(e,null,i):(l>3?s=Array.prototype.slice.call(arguments,2):l===3&&dv(s)&&(s=[s]),tr(e,i,s))}finally{sE(1)}}function n_e(e,i,s,l){const p=s[l];if(p&&C7(p,e))return p;const _=i();return _.memo=e.slice(),_.cacheIndex=l,s[l]=_}function C7(e,i){const s=e.memo;if(s.length!=i.length)return!1;for(let l=0;l<s.length;l++)if(sd(s[l],i[l]))return!1;return hv>0&&Ah&&Ah.push(e),!0}const A7="3.5.26";let MA;const jL=typeof window<"u"&&window.trustedTypes;if(jL)try{MA=jL.createPolicy("vue",{createHTML:e=>e})}catch{}const uB=MA?e=>MA.createHTML(e):e=>e,P7="http://www.w3.org/2000/svg",M7="http://www.w3.org/1998/Math/MathML",z_=typeof document<"u"?document:null,UL=z_&&z_.createElement("template"),k7={insert:(e,i,s)=>{i.insertBefore(e,s||null)},remove:e=>{const i=e.parentNode;i&&i.removeChild(e)},createElement:(e,i,s,l)=>{const p=i==="svg"?z_.createElementNS(P7,e):i==="mathml"?z_.createElementNS(M7,e):s?z_.createElement(e,{is:s}):z_.createElement(e);return e==="select"&&l&&l.multiple!=null&&p.setAttribute("multiple",l.multiple),p},createText:e=>z_.createTextNode(e),createComment:e=>z_.createComment(e),setText:(e,i)=>{e.nodeValue=i},setElementText:(e,i)=>{e.textContent=i},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>z_.querySelector(e),setScopeId(e,i){e.setAttribute(i,"")},insertStaticContent(e,i,s,l,p,_){const b=s?s.previousSibling:i.lastChild;if(p&&(p===_||p.nextSibling))for(;i.insertBefore(p.cloneNode(!0),s),!(p===_||!(p=p.nextSibling)););else{UL.innerHTML=uB(l==="svg"?`<svg>${e}</svg>`:l==="mathml"?`<math>${e}</math>`:e);const t=UL.content;if(l==="svg"||l==="mathml"){const P=t.firstChild;for(;P.firstChild;)t.appendChild(P.firstChild);t.removeChild(P)}i.insertBefore(t,s)}return[b?b.nextSibling:i.firstChild,s?s.previousSibling:i.lastChild]}},$y="transition",V1="animation",Yx=Symbol("_vtc"),hB={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},dB=jc({},C5,hB),D7=e=>(e.displayName="Transition",e.props=dB,e),dw=D7((e,{slots:i})=>Ns(A$,fB(e),i)),X0=(e,i=[])=>{xs(e)?e.forEach(s=>s(...i)):e&&e(...i)},$L=e=>e?xs(e)?e.some(i=>i.length>1):e.length>1:!1;function fB(e){const i={};for(const Ht in e)Ht in hB||(i[Ht]=e[Ht]);if(e.css===!1)return i;const{name:s="v",type:l,duration:p,enterFromClass:_=`${s}-enter-from`,enterActiveClass:b=`${s}-enter-active`,enterToClass:t=`${s}-enter-to`,appearFromClass:P=_,appearActiveClass:O=b,appearToClass:F=t,leaveFromClass:$=`${s}-leave-from`,leaveActiveClass:W=`${s}-leave-active`,leaveToClass:Y=`${s}-leave-to`}=e,ae=L7(p),se=ae&&ae[0],ie=ae&&ae[1],{onBeforeEnter:pe,onEnter:ye,onEnterCancelled:de,onLeave:Ee,onLeaveCancelled:Pe,onBeforeAppear:Ze=pe,onAppear:We=ye,onAppearCancelled:je=de}=i,Ye=(Ht,ci,Wt,$t)=>{Ht._enterCancelled=$t,Hy(Ht,ci?F:t),Hy(Ht,ci?O:b),Wt&&Wt()},ct=(Ht,ci)=>{Ht._isLeaving=!1,Hy(Ht,$),Hy(Ht,Y),Hy(Ht,W),ci&&ci()},Lt=Ht=>(ci,Wt)=>{const $t=Ht?We:ye,Dt=()=>Ye(ci,Ht,Wt);X0($t,[ci,Dt]),GL(()=>{Hy(ci,Ht?P:_),Tg(ci,Ht?F:t),$L($t)||qL(ci,l,se,Dt)})};return jc(i,{onBeforeEnter(Ht){X0(pe,[Ht]),Tg(Ht,_),Tg(Ht,b)},onBeforeAppear(Ht){X0(Ze,[Ht]),Tg(Ht,P),Tg(Ht,O)},onEnter:Lt(!1),onAppear:Lt(!0),onLeave(Ht,ci){Ht._isLeaving=!0;const Wt=()=>ct(Ht,ci);Tg(Ht,$),Ht._enterCancelled?(Tg(Ht,W),kA(Ht)):(kA(Ht),Tg(Ht,W)),GL(()=>{Ht._isLeaving&&(Hy(Ht,$),Tg(Ht,Y),$L(Ee)||qL(Ht,l,ie,Wt))}),X0(Ee,[Ht,Wt])},onEnterCancelled(Ht){Ye(Ht,!1,void 0,!0),X0(de,[Ht])},onAppearCancelled(Ht){Ye(Ht,!0,void 0,!0),X0(je,[Ht])},onLeaveCancelled(Ht){ct(Ht),X0(Pe,[Ht])}})}function L7(e){if(e==null)return null;if(sl(e))return[yC(e.enter),yC(e.leave)];{const i=yC(e);return[i,i]}}function yC(e){return HF(e)}function Tg(e,i){i.split(/\s+/).forEach(s=>s&&e.classList.add(s)),(e[Yx]||(e[Yx]=new Set)).add(i)}function Hy(e,i){i.split(/\s+/).forEach(l=>l&&e.classList.remove(l));const s=e[Yx];s&&(s.delete(i),s.size||(e[Yx]=void 0))}function GL(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let R7=0;function qL(e,i,s,l){const p=e._endId=++R7,_=()=>{p===e._endId&&l()};if(s!=null)return setTimeout(_,s);const{type:b,timeout:t,propCount:P}=pB(e,i);if(!b)return l();const O=b+"end";let F=0;const $=()=>{e.removeEventListener(O,W),_()},W=Y=>{Y.target===e&&++F>=P&&$()};setTimeout(()=>{F<P&&$()},t+1),e.addEventListener(O,W)}function pB(e,i){const s=window.getComputedStyle(e),l=ae=>(s[ae]||"").split(", "),p=l(`${$y}Delay`),_=l(`${$y}Duration`),b=HL(p,_),t=l(`${V1}Delay`),P=l(`${V1}Duration`),O=HL(t,P);let F=null,$=0,W=0;i===$y?b>0&&(F=$y,$=b,W=_.length):i===V1?O>0&&(F=V1,$=O,W=P.length):($=Math.max(b,O),F=$>0?b>O?$y:V1:null,W=F?F===$y?_.length:P.length:0);const Y=F===$y&&/\b(?:transform|all)(?:,|$)/.test(l(`${$y}Property`).toString());return{type:F,timeout:$,propCount:W,hasTransform:Y}}function HL(e,i){for(;e.length<i.length;)e=e.concat(e);return Math.max(...i.map((s,l)=>WL(s)+WL(e[l])))}function WL(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function kA(e){return(e?e.ownerDocument:document).body.offsetHeight}function z7(e,i,s){const l=e[Yx];l&&(i=(i?[i,...l]:[...l]).join(" ")),i==null?e.removeAttribute("class"):s?e.setAttribute("class",i):e.className=i}const aE=Symbol("_vod"),mB=Symbol("_vsh"),gB={name:"show",beforeMount(e,{value:i},{transition:s}){e[aE]=e.style.display==="none"?"":e.style.display,s&&i?s.beforeEnter(e):j1(e,i)},mounted(e,{value:i},{transition:s}){s&&i&&s.enter(e)},updated(e,{value:i,oldValue:s},{transition:l}){!i!=!s&&(l?i?(l.beforeEnter(e),j1(e,!0),l.enter(e)):l.leave(e,()=>{j1(e,!1)}):j1(e,i))},beforeUnmount(e,{value:i}){j1(e,i)}};function j1(e,i){e.style.display=i?e[aE]:"none",e[mB]=!i}const O7=Symbol(""),F7=/(?:^|;)\s*display\s*:/;function B7(e,i,s){const l=e.style,p=Cl(s);let _=!1;if(s&&!p){if(i)if(Cl(i))for(const b of i.split(";")){const t=b.slice(0,b.indexOf(":")).trim();s[t]==null&&TS(l,t,"")}else for(const b in i)s[b]==null&&TS(l,b,"");for(const b in s)b==="display"&&(_=!0),TS(l,b,s[b])}else if(p){if(i!==s){const b=l[O7];b&&(s+=";"+b),l.cssText=s,_=F7.test(s)}}else i&&e.removeAttribute("style");aE in e&&(e[aE]=_?l.display:"",e[mB]&&(l.display="none"))}const ZL=/\s*!important$/;function TS(e,i,s){if(xs(s))s.forEach(l=>TS(e,i,l));else if(s==null&&(s=""),i.startsWith("--"))e.setProperty(i,s);else{const l=N7(e,i);ZL.test(s)?e.setProperty(ey(l),s.replace(ZL,""),"important"):e[l]=s}}const XL=["Webkit","Moz","ms"],vC={};function N7(e,i){const s=vC[i];if(s)return s;let l=cd(i);if(l!=="filter"&&l in e)return vC[i]=l;l=zE(l);for(let p=0;p<XL.length;p++){const _=XL[p]+l;if(_ in e)return vC[i]=_}return i}const YL="http://www.w3.org/1999/xlink";function KL(e,i,s,l,p,_=qU(i)){l&&i.startsWith("xlink:")?s==null?e.removeAttributeNS(YL,i.slice(6,i.length)):e.setAttributeNS(YL,i,s):s==null||_&&!WF(s)?e.removeAttribute(i):e.setAttribute(i,_?"":Q_(s)?String(s):s)}function JL(e,i,s,l,p){if(i==="innerHTML"||i==="textContent"){s!=null&&(e[i]=i==="innerHTML"?uB(s):s);return}const _=e.tagName;if(i==="value"&&_!=="PROGRESS"&&!_.includes("-")){const t=_==="OPTION"?e.getAttribute("value")||"":e.value,P=s==null?e.type==="checkbox"?"on":"":String(s);(t!==P||!("_value"in e))&&(e.value=P),s==null&&e.removeAttribute(i),e._value=s;return}let b=!1;if(s===""||s==null){const t=typeof e[i];t==="boolean"?s=WF(s):s==null&&t==="string"?(s="",b=!0):t==="number"&&(s=0,b=!0)}try{e[i]=s}catch{}b&&e.removeAttribute(p||i)}function V7(e,i,s,l){e.addEventListener(i,s,l)}function j7(e,i,s,l){e.removeEventListener(i,s,l)}const QL=Symbol("_vei");function U7(e,i,s,l,p=null){const _=e[QL]||(e[QL]={}),b=_[i];if(l&&b)b.value=l;else{const[t,P]=$7(i);if(l){const O=_[i]=H7(l,p);V7(e,t,O,P)}else b&&(j7(e,t,b,P),_[i]=void 0)}}const eR=/(?:Once|Passive|Capture)$/;function $7(e){let i;if(eR.test(e)){i={};let l;for(;l=e.match(eR);)e=e.slice(0,e.length-l[0].length),i[l[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):ey(e.slice(2)),i]}let xC=0;const G7=Promise.resolve(),q7=()=>xC||(G7.then(()=>xC=0),xC=Date.now());function H7(e,i){const s=l=>{if(!l._vts)l._vts=Date.now();else if(l._vts<=s.attached)return;Cm(W7(l,s.value),i,5,[l])};return s.value=e,s.attached=q7(),s}function W7(e,i){if(xs(i)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},i.map(l=>p=>!p._stopped&&l&&l(p))}else return i}const tR=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Z7=(e,i,s,l,p,_)=>{const b=p==="svg";i==="class"?z7(e,l,b):i==="style"?B7(e,s,l):Zw(i)?HP(i)||U7(e,i,s,l,_):(i[0]==="."?(i=i.slice(1),!0):i[0]==="^"?(i=i.slice(1),!1):X7(e,i,l,b))?(JL(e,i,l),!e.tagName.includes("-")&&(i==="value"||i==="checked"||i==="selected")&&KL(e,i,l,b,_,i!=="value")):e._isVueCE&&(/[A-Z]/.test(i)||!Cl(l))?JL(e,cd(i),l,_,i):(i==="true-value"?e._trueValue=l:i==="false-value"&&(e._falseValue=l),KL(e,i,l,b))};function X7(e,i,s,l){if(l)return!!(i==="innerHTML"||i==="textContent"||i in e&&tR(i)&&Bs(s));if(i==="spellcheck"||i==="draggable"||i==="translate"||i==="autocorrect"||i==="sandbox"&&e.tagName==="IFRAME"||i==="form"||i==="list"&&e.tagName==="INPUT"||i==="type"&&e.tagName==="TEXTAREA")return!1;if(i==="width"||i==="height"){const p=e.tagName;if(p==="IMG"||p==="VIDEO"||p==="CANVAS"||p==="SOURCE")return!1}return tR(i)&&Cl(s)?!1:i in e}const _B=new WeakMap,yB=new WeakMap,lE=Symbol("_moveCb"),iR=Symbol("_enterCb"),Y7=e=>(delete e.props.mode,e),K7=Y7({name:"TransitionGroup",props:jc({},dB,{tag:String,moveClass:String}),setup(e,{slots:i}){const s=ba(),l=I5();let p,_;return xv(()=>{if(!p.length)return;const b=e.moveClass||`${e.name||"v"}-move`;if(!i9(p[0].el,s.vnode.el,b)){p=[];return}p.forEach(Q7),p.forEach(e9);const t=p.filter(t9);kA(s.vnode.el),t.forEach(P=>{const O=P.el,F=O.style;Tg(O,b),F.transform=F.webkitTransform=F.transitionDuration="";const $=O[lE]=W=>{W&&W.target!==O||(!W||W.propertyName.endsWith("transform"))&&(O.removeEventListener("transitionend",$),O[lE]=null,Hy(O,b))};O.addEventListener("transitionend",$)}),p=[]}),()=>{const b=zo(e),t=fB(b);let P=b.tag||qs;if(p=[],_)for(let O=0;O<_.length;O++){const F=_[O];F.el&&F.el instanceof Element&&(p.push(F),n0(F,Aw(F,t,l,s)),_B.set(F,{left:F.el.offsetLeft,top:F.el.offsetTop}))}_=i.default?eM(i.default()):[];for(let O=0;O<_.length;O++){const F=_[O];F.key!=null&&n0(F,Aw(F,t,l,s))}return tr(P,null,_)}}}),J7=K7;function Q7(e){const i=e.el;i[lE]&&i[lE](),i[iR]&&i[iR]()}function e9(e){yB.set(e,{left:e.el.offsetLeft,top:e.el.offsetTop})}function t9(e){const i=_B.get(e),s=yB.get(e),l=i.left-s.left,p=i.top-s.top;if(l||p){const _=e.el.style;return _.transform=_.webkitTransform=`translate(${l}px,${p}px)`,_.transitionDuration="0s",e}}function i9(e,i,s){const l=e.cloneNode(),p=e[Yx];p&&p.forEach(t=>{t.split(/\s+/).forEach(P=>P&&l.classList.remove(P))}),s.split(/\s+/).forEach(t=>t&&l.classList.add(t)),l.style.display="none";const _=i.nodeType===1?i:i.parentNode;_.appendChild(l);const{hasTransform:b}=pB(l);return _.removeChild(l),b}const n9=["ctrl","shift","alt","meta"],r9={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,i)=>n9.some(s=>e[`${s}Key`]&&!i.includes(s))},Sm=(e,i)=>{const s=e._withMods||(e._withMods={}),l=i.join(".");return s[l]||(s[l]=((p,..._)=>{for(let b=0;b<i.length;b++){const t=r9[i[b]];if(t&&t(p,i))return}return e(p,..._)}))},s9={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},r_e=(e,i)=>{const s=e._withKeys||(e._withKeys={}),l=i.join(".");return s[l]||(s[l]=(p=>{if(!("key"in p))return;const _=ey(p.key);if(i.some(b=>b===_||s9[b]===_))return e(p)}))},vB=jc({patchProp:Z7},k7);let fw,nR=!1;function o9(){return fw||(fw=u7(vB))}function a9(){return fw=nR?fw:h7(vB),nR=!0,fw}const l9=((...e)=>{const i=o9().createApp(...e),{mount:s}=i;return i.mount=l=>{const p=bB(l);if(!p)return;const _=i._component;!Bs(_)&&!_.render&&!_.template&&(_.template=p.innerHTML),p.nodeType===1&&(p.textContent="");const b=s(p,!1,xB(p));return p instanceof Element&&(p.removeAttribute("v-cloak"),p.setAttribute("data-v-app","")),b},i}),c9=((...e)=>{const i=a9().createApp(...e),{mount:s}=i;return i.mount=l=>{const p=bB(l);if(p)return s(p,!0,xB(p))},i});function xB(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function bB(e){return Cl(e)?document.querySelector(e):e}const u9=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,h9=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,d9=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function f9(e,i){if(e==="__proto__"||e==="constructor"&&i&&typeof i=="object"&&"prototype"in i){p9(e);return}return i}function p9(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function kw(e,i={}){if(typeof e!="string")return e;if(e[0]==='"'&&e[e.length-1]==='"'&&e.indexOf("\\")===-1)return e.slice(1,-1);const s=e.trim();if(s.length<=9)switch(s.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!d9.test(e)){if(i.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(u9.test(e)||h9.test(e)){if(i.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,f9)}return JSON.parse(e)}catch(l){if(i.strict)throw l;return e}}const wB=/#/g,TB=/&/g,SB=/\//g,m9=/=/g,g9=/\?/g,ZE=/\+/g,_9=/%5e/gi,y9=/%60/gi,v9=/%7c/gi,x9=/%20/gi,b9=/%252f/gi;function EB(e){return encodeURI(""+e).replace(v9,"|")}function DA(e){return EB(typeof e=="string"?e:JSON.stringify(e)).replace(ZE,"%2B").replace(x9,"+").replace(wB,"%23").replace(TB,"%26").replace(y9,"`").replace(_9,"^").replace(SB,"%2F")}function bC(e){return DA(e).replace(m9,"%3D")}function IB(e){return EB(e).replace(wB,"%23").replace(g9,"%3F").replace(b9,"%2F").replace(TB,"%26").replace(ZE,"%2B")}function rR(e){return IB(e).replace(SB,"%2F")}function cE(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function w9(e){return cE(e.replace(ZE," "))}function T9(e){return cE(e.replace(ZE," "))}function XE(e=""){const i=Object.create(null);e[0]==="?"&&(e=e.slice(1));for(const s of e.split("&")){const l=s.match(/([^=]+)=?(.*)/)||[];if(l.length<2)continue;const p=w9(l[1]);if(p==="__proto__"||p==="constructor")continue;const _=T9(l[2]||"");i[p]===void 0?i[p]=_:Array.isArray(i[p])?i[p].push(_):i[p]=[i[p],_]}return i}function S9(e,i){return(typeof i=="number"||typeof i=="boolean")&&(i=String(i)),i?Array.isArray(i)?i.map(s=>`${bC(e)}=${DA(s)}`).join("&"):`${bC(e)}=${DA(i)}`:bC(e)}function E9(e){return Object.keys(e).filter(i=>e[i]!==void 0).map(i=>S9(i,e[i])).filter(Boolean).join("&")}const I9=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,CB=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,C9=/^([/\\]\s*){2,}[^/\\]/,A9=/^[\s\0]*(blob|data|javascript|vbscript):$/i,P9=/\/$|\/\?|\/#/,M9=/^\.?\//;function ud(e,i={}){return typeof i=="boolean"&&(i={acceptRelative:i}),i.strict?I9.test(e):CB.test(e)||(i.acceptRelative?C9.test(e):!1)}function k9(e){return!!e&&A9.test(e)}function LA(e="",i){return i?P9.test(e):e.endsWith("/")}function Kx(e="",i){if(!i)return(LA(e)?e.slice(0,-1):e)||"/";if(!LA(e,!0))return e||"/";let s=e,l="";const p=e.indexOf("#");p!==-1&&(s=e.slice(0,p),l=e.slice(p));const[_,...b]=s.split("?");return((_.endsWith("/")?_.slice(0,-1):_)||"/")+(b.length>0?`?${b.join("?")}`:"")+l}function AB(e="",i){if(!i)return e.endsWith("/")?e:e+"/";if(LA(e,!0))return e||"/";let s=e,l="";const p=e.indexOf("#");if(p!==-1&&(s=e.slice(0,p),l=e.slice(p),!s))return l;const[_,...b]=s.split("?");return _+"/"+(b.length>0?`?${b.join("?")}`:"")+l}function D9(e=""){return e.startsWith("/")}function L9(e=""){return D9(e)?e:"/"+e}function R9(e,i){if(PB(i)||ud(e))return e;const s=Kx(i);return e.startsWith(s)?e:Am(s,e)}function sR(e,i){if(PB(i))return e;const s=Kx(i);if(!e.startsWith(s))return e;const l=e.slice(s.length);return l[0]==="/"?l:"/"+l}function pv(e,i){const s=Jx(e),l={...XE(s.search),...i};return s.search=E9(l),N9(s)}function PB(e){return!e||e==="/"}function z9(e){return e&&e!=="/"}function Am(e,...i){let s=e||"";for(const l of i.filter(p=>z9(p)))if(s){const p=l.replace(M9,"");s=AB(s)+p}else s=l;return s}function MB(...e){const i=/\/(?!\/)/,s=e.filter(Boolean),l=[];let p=0;for(const b of s)if(!(!b||b==="/")){for(const[t,P]of b.split(i).entries())if(!(!P||P===".")){if(P===".."){if(l.length===1&&ud(l[0]))continue;l.pop(),p--;continue}if(t===1&&l[l.length-1]?.endsWith(":/")){l[l.length-1]+="/"+P;continue}l.push(P),p++}}let _=l.join("/");return p>=0?s[0]?.startsWith("/")&&!_.startsWith("/")?_="/"+_:s[0]?.startsWith("./")&&!_.startsWith("./")&&(_="./"+_):_="../".repeat(-1*p)+_,s[s.length-1]?.endsWith("/")&&!_.endsWith("/")&&(_+="/"),_}function O9(e){return F9(e,"https://")}function F9(e,i){let s=e.match(CB);return s||(s=e.match(/^\/{2,}/)),s?i+e.slice(s[0].length):i+e}function B9(e,i){return cE(Kx(e))===cE(Kx(i))}const kB=Symbol.for("ufo:protocolRelative");function Jx(e="",i){const s=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(s){const[,$,W=""]=s;return{protocol:$.toLowerCase(),pathname:W,href:$+W,auth:"",host:"",search:"",hash:""}}if(!ud(e,{acceptRelative:!0}))return i?Jx(i+e):RA(e);const[,l="",p,_=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,b="",t=""]=_.match(/([^#/?]*)(.*)?/)||[];l==="file:"&&(t=t.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:P,search:O,hash:F}=RA(t);return{protocol:l.toLowerCase(),auth:p?p.slice(0,Math.max(0,p.length-1)):"",host:b,pathname:P,search:O,hash:F,[kB]:!l}}function RA(e=""){const[i="",s="",l=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:i,search:s,hash:l}}function N9(e){const i=e.pathname||"",s=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",l=e.hash||"",p=e.auth?e.auth+"@":"",_=e.host||"";return(e.protocol||e[kB]?(e.protocol||"")+"//":"")+p+_+i+s+l}class V9 extends Error{constructor(i,s){super(i,s),this.name="FetchError",s?.cause&&!this.cause&&(this.cause=s.cause)}}function j9(e){const i=e.error?.message||e.error?.toString()||"",s=e.request?.method||e.options?.method||"GET",l=e.request?.url||String(e.request)||"/",p=`[${s}] ${JSON.stringify(l)}`,_=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",b=`${p}: ${_}${i?` ${i}`:""}`,t=new V9(b,e.error?{cause:e.error}:void 0);for(const P of["request","options","response"])Object.defineProperty(t,P,{get(){return e[P]}});for(const[P,O]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(t,P,{get(){return e.response&&e.response[O]}});return t}const U9=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function oR(e="GET"){return U9.has(e.toUpperCase())}function $9(e){if(e===void 0)return!1;const i=typeof e;return i==="string"||i==="number"||i==="boolean"||i===null?!0:i!=="object"?!1:Array.isArray(e)?!0:e.buffer||e instanceof FormData||e instanceof URLSearchParams?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const G9=new Set(["image/svg","application/xml","application/xhtml","application/html"]),q9=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function H9(e=""){if(!e)return"json";const i=e.split(";").shift()||"";return q9.test(i)?"json":i==="text/event-stream"?"stream":G9.has(i)||i.startsWith("text/")?"text":"blob"}function W9(e,i,s,l){const p=Z9(i?.headers??e?.headers,s?.headers,l);let _;return(s?.query||s?.params||i?.params||i?.query)&&(_={...s?.params,...s?.query,...i?.params,...i?.query}),{...s,...i,query:_,params:_,headers:p}}function Z9(e,i,s){if(!i)return new s(e);const l=new s(i);if(e)for(const[p,_]of Symbol.iterator in e||Array.isArray(e)?e:new s(e))l.set(p,_);return l}async function UT(e,i){if(i)if(Array.isArray(i))for(const s of i)await s(e);else await i(e)}const X9=new Set([408,409,425,429,500,502,503,504]),Y9=new Set([101,204,205,304]);function DB(e={}){const{fetch:i=globalThis.fetch,Headers:s=globalThis.Headers,AbortController:l=globalThis.AbortController}=e;async function p(t){const P=t.error&&t.error.name==="AbortError"&&!t.options.timeout||!1;if(t.options.retry!==!1&&!P){let F;typeof t.options.retry=="number"?F=t.options.retry:F=oR(t.options.method)?0:1;const $=t.response&&t.response.status||500;if(F>0&&(Array.isArray(t.options.retryStatusCodes)?t.options.retryStatusCodes.includes($):X9.has($))){const W=typeof t.options.retryDelay=="function"?t.options.retryDelay(t):t.options.retryDelay||0;return W>0&&await new Promise(Y=>setTimeout(Y,W)),_(t.request,{...t.options,retry:F-1})}}const O=j9(t);throw Error.captureStackTrace&&Error.captureStackTrace(O,_),O}const _=async function(P,O={}){const F={request:P,options:W9(P,O,e.defaults,s),response:void 0,error:void 0};if(F.options.method&&(F.options.method=F.options.method.toUpperCase()),F.options.onRequest&&(await UT(F,F.options.onRequest),F.options.headers instanceof s||(F.options.headers=new s(F.options.headers||{}))),typeof F.request=="string"&&(F.options.baseURL&&(F.request=R9(F.request,F.options.baseURL)),F.options.query&&(F.request=pv(F.request,F.options.query),delete F.options.query),"query"in F.options&&delete F.options.query,"params"in F.options&&delete F.options.params),F.options.body&&oR(F.options.method))if($9(F.options.body)){const Y=F.options.headers.get("content-type");typeof F.options.body!="string"&&(F.options.body=Y==="application/x-www-form-urlencoded"?new URLSearchParams(F.options.body).toString():JSON.stringify(F.options.body)),Y||F.options.headers.set("content-type","application/json"),F.options.headers.has("accept")||F.options.headers.set("accept","application/json")}else("pipeTo"in F.options.body&&typeof F.options.body.pipeTo=="function"||typeof F.options.body.pipe=="function")&&("duplex"in F.options||(F.options.duplex="half"));let $;if(!F.options.signal&&F.options.timeout){const Y=new l;$=setTimeout(()=>{const ae=new Error("[TimeoutError]: The operation was aborted due to timeout");ae.name="TimeoutError",ae.code=23,Y.abort(ae)},F.options.timeout),F.options.signal=Y.signal}try{F.response=await i(F.request,F.options)}catch(Y){return F.error=Y,F.options.onRequestError&&await UT(F,F.options.onRequestError),await p(F)}finally{$&&clearTimeout($)}if((F.response.body||F.response._bodyInit)&&!Y9.has(F.response.status)&&F.options.method!=="HEAD"){const Y=(F.options.parseResponse?"json":F.options.responseType)||H9(F.response.headers.get("content-type")||"");switch(Y){case"json":{const ae=await F.response.text(),se=F.options.parseResponse||kw;F.response._data=se(ae);break}case"stream":{F.response._data=F.response.body||F.response._bodyInit;break}default:F.response._data=await F.response[Y]()}}return F.options.onResponse&&await UT(F,F.options.onResponse),!F.options.ignoreResponseError&&F.response.status>=400&&F.response.status<600?(F.options.onResponseError&&await UT(F,F.options.onResponseError),await p(F)):F.response},b=async function(P,O){return(await _(P,O))._data};return b.raw=_,b.native=(...t)=>i(...t),b.create=(t={},P={})=>DB({...e,...P,defaults:{...e.defaults,...P.defaults,...t}}),b}const uE=(function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")})(),K9=uE.fetch?(...e)=>uE.fetch(...e):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),J9=uE.Headers,Q9=uE.AbortController,eG=DB({fetch:K9,Headers:J9,AbortController:Q9}),tG=eG,iG=()=>window?.__NUXT__?.config||window?.useNuxtApp?.().payload?.config,dM=()=>iG().app,nG=()=>dM().baseURL,rG=()=>dM().buildAssetsDir,fM=(...e)=>MB(LB(),rG(),...e),LB=(...e)=>{const i=dM(),s=i.cdnURL||i.baseURL;return e.length?MB(s,...e):s};globalThis.__buildAssetsURL=fM,globalThis.__publicAssetsURL=LB;globalThis.$fetch||(globalThis.$fetch=tG.create({baseURL:nG()}));"global"in globalThis||(globalThis.global=globalThis);function zA(e,i={},s){for(const l in e){const p=e[l],_=s?`${s}:${l}`:l;typeof p=="object"&&p!==null?zA(p,i,_):typeof p=="function"&&(i[_]=p)}return i}const sG={run:e=>e()},oG=()=>sG,RB=typeof console.createTask<"u"?console.createTask:oG;function aG(e,i){const s=i.shift(),l=RB(s);return e.reduce((p,_)=>p.then(()=>l.run(()=>_(...i))),Promise.resolve())}function lG(e,i){const s=i.shift(),l=RB(s);return Promise.all(e.map(p=>l.run(()=>p(...i))))}function wC(e,i){for(const s of[...e])s(i)}class cG{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(i,s,l={}){if(!i||typeof s!="function")return()=>{};const p=i;let _;for(;this._deprecatedHooks[i];)_=this._deprecatedHooks[i],i=_.to;if(_&&!l.allowDeprecated){let b=_.message;b||(b=`${p} hook has been deprecated`+(_.to?`, please use ${_.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(b)||(console.warn(b),this._deprecatedMessages.add(b))}if(!s.name)try{Object.defineProperty(s,"name",{get:()=>"_"+i.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[i]=this._hooks[i]||[],this._hooks[i].push(s),()=>{s&&(this.removeHook(i,s),s=void 0)}}hookOnce(i,s){let l,p=(..._)=>(typeof l=="function"&&l(),l=void 0,p=void 0,s(..._));return l=this.hook(i,p),l}removeHook(i,s){if(this._hooks[i]){const l=this._hooks[i].indexOf(s);l!==-1&&this._hooks[i].splice(l,1),this._hooks[i].length===0&&delete this._hooks[i]}}deprecateHook(i,s){this._deprecatedHooks[i]=typeof s=="string"?{to:s}:s;const l=this._hooks[i]||[];delete this._hooks[i];for(const p of l)this.hook(i,p)}deprecateHooks(i){Object.assign(this._deprecatedHooks,i);for(const s in i)this.deprecateHook(s,i[s])}addHooks(i){const s=zA(i),l=Object.keys(s).map(p=>this.hook(p,s[p]));return()=>{for(const p of l.splice(0,l.length))p()}}removeHooks(i){const s=zA(i);for(const l in s)this.removeHook(l,s[l])}removeAllHooks(){for(const i in this._hooks)delete this._hooks[i]}callHook(i,...s){return s.unshift(i),this.callHookWith(aG,i,...s)}callHookParallel(i,...s){return s.unshift(i),this.callHookWith(lG,i,...s)}callHookWith(i,s,...l){const p=this._before||this._after?{name:s,args:l,context:{}}:void 0;this._before&&wC(this._before,p);const _=i(s in this._hooks?[...this._hooks[s]]:[],l);return _ instanceof Promise?_.finally(()=>{this._after&&p&&wC(this._after,p)}):(this._after&&p&&wC(this._after,p),_)}beforeEach(i){return this._before=this._before||[],this._before.push(i),()=>{if(this._before!==void 0){const s=this._before.indexOf(i);s!==-1&&this._before.splice(s,1)}}}afterEach(i){return this._after=this._after||[],this._after.push(i),()=>{if(this._after!==void 0){const s=this._after.indexOf(i);s!==-1&&this._after.splice(s,1)}}}}function zB(){return new cG}function uG(e={}){let i,s=!1;const l=b=>{if(i&&i!==b)throw new Error("Context conflict")};let p;if(e.asyncContext){const b=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;b?p=new b:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const _=()=>{if(p){const b=p.getStore();if(b!==void 0)return b}return i};return{use:()=>{const b=_();if(b===void 0)throw new Error("Context is not available");return b},tryUse:()=>_(),set:(b,t)=>{t||l(b),i=b,s=!0},unset:()=>{i=void 0,s=!1},call:(b,t)=>{l(b),i=b;try{return p?p.run(b,t):t()}finally{s||(i=void 0)}},async callAsync(b,t){i=b;const P=()=>{i=b},O=()=>i===b?P:void 0;OA.add(O);try{const F=p?p.run(b,t):t();return s||(i=void 0),await F}finally{OA.delete(O)}}}}function hG(e={}){const i={};return{get(s,l={}){return i[s]||(i[s]=uG({...e,...l})),i[s]}}}const hE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},aR="__unctx__",dG=hE[aR]||(hE[aR]=hG()),fG=(e,i={})=>dG.get(e,i),lR="__unctx_async_handlers__",OA=hE[lR]||(hE[lR]=new Set);function Mg(e){const i=[];for(const p of OA){const _=p();_&&i.push(_)}const s=()=>{for(const p of i)p()};let l=e();return l&&typeof l=="object"&&"catch"in l&&(l=l.catch(p=>{throw s(),p})),[l,s]}const pG=!1,cR=!1,mG=!0,uR={id:"__nuxt-loader"},gG={componentName:"NuxtLink",prefetch:!0,prefetchOn:{visibility:!0}},_G={deep:!1},yG={},vG="#__nuxt",OB="nuxt-app",hR=36e5,xG="vite:preloadError";function FB(e=OB){return fG(e,{asyncContext:!1})}const bG="__nuxt_plugin";function wG(e){let i=0;const s={_id:e.id||OB||"nuxt-app",_scope:s0(),provide:void 0,versions:{get nuxt(){return"4.2.2"},get vue(){return s.vueApp.version}},payload:Ip({...e.ssrContext?.payload||{},data:Ip({}),state:Ol({}),once:new Set,_errors:Ip({})}),static:{data:{}},runWithContext(p){return s._scope.active&&!Rp()?s._scope.run(()=>dR(s,p)):dR(s,p)},isHydrating:!0,deferHydration(){if(!s.isHydrating)return()=>{};i++;let p=!1;return()=>{if(!p&&(p=!0,i--,i===0))return s.isHydrating=!1,s.callHook("app:suspense:resolve")}},_asyncDataPromises:{},_asyncData:Ip({}),_payloadRevivers:{},...e};{const p=window.__NUXT__;if(p)for(const _ in p)switch(_){case"data":case"state":case"_errors":Object.assign(s.payload[_],p[_]);break;default:s.payload[_]=p[_]}}s.hooks=zB(),s.hook=s.hooks.hook,s.callHook=s.hooks.callHook,s.provide=(p,_)=>{const b="$"+p;$T(s,b,_),$T(s.vueApp.config.globalProperties,b,_)},$T(s.vueApp,"$nuxt",s),$T(s.vueApp.config.globalProperties,"$nuxt",s);{window.addEventListener(xG,_=>{s.callHook("app:chunkError",{error:_.payload}),_.payload.message.includes("Unable to preload CSS")&&_.preventDefault()}),window.useNuxtApp||=Vs;const p=s.hook("app:error",(..._)=>{console.error("[nuxt] error caught during app initialization",..._)});s.hook("app:mounted",p)}const l=s.payload.config;return s.provide("config",l),s}function TG(e,i){i.hooks&&e.hooks.addHooks(i.hooks)}async function SG(e,i){if(typeof i=="function"){const{provide:s}=await e.runWithContext(()=>i(e))||{};if(s&&typeof s=="object")for(const l in s)e.provide(l,s[l])}}async function EG(e,i){const s=new Set,l=[],p=[];let _,b=0;async function t(P){const O=P.dependsOn?.filter(F=>i.some($=>$._name===F)&&!s.has(F))??[];if(O.length>0)l.push([new Set(O),P]);else{const F=SG(e,P).then(async()=>{P._name&&(s.add(P._name),await Promise.all(l.map(async([$,W])=>{$.has(P._name)&&($.delete(P._name),$.size===0&&(b++,await t(W)))})))}).catch($=>{if(!P.parallel&&!e.payload.error)throw $;_||=$});P.parallel?p.push(F):await F}}for(const P of i)TG(e,P);for(const P of i)await t(P);if(await Promise.all(p),b)for(let P=0;P<b;P++)await Promise.all(p);if(_)throw e.payload.error||_}function ol(e){if(typeof e=="function")return e;const i=e._name||e.name;return delete e.name,Object.assign(e.setup||(()=>{}),e,{[bG]:!0,_name:i})}const IG=ol;function dR(e,i,s){const l=()=>i();return FB(e._id).set(e),e.vueApp.runWithContext(l)}function CG(e){let i;return vv()&&(i=ba()?.appContext.app.$nuxt),i||=FB(e).tryUse(),i||null}function Vs(e){const i=CG(e);if(!i)throw new Error("[nuxt] instance unavailable");return i}function jf(e){return Vs().$config}function $T(e,i,s){Object.defineProperty(e,i,{get:()=>s})}function AG(e,i){return{ctx:{table:e},matchAll:s=>NB(s,e)}}function BB(e){const i={};for(const s in e)i[s]=s==="dynamic"?new Map(Object.entries(e[s]).map(([l,p])=>[l,BB(p)])):new Map(Object.entries(e[s]));return i}function PG(e){return AG(BB(e))}function NB(e,i,s){e.endsWith("/")&&(e=e.slice(0,-1)||"/");const l=[];for(const[_,b]of fR(i.wildcard))(e===_||e.startsWith(_+"/"))&&l.push(b);for(const[_,b]of fR(i.dynamic))if(e.startsWith(_+"/")){const t="/"+e.slice(_.length).split("/").splice(2).join("/");l.push(...NB(t,b))}const p=i.static.get(e);return p&&l.push(p),l.filter(Boolean)}function fR(e){return[...e.entries()].sort((i,s)=>i[0].length-s[0].length)}function TC(e){if(e===null||typeof e!="object")return!1;const i=Object.getPrototypeOf(e);return i!==null&&i!==Object.prototype&&Object.getPrototypeOf(i)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function FA(e,i,s=".",l){if(!TC(i))return FA(e,{},s,l);const p=Object.assign({},i);for(const _ in e){if(_==="__proto__"||_==="constructor")continue;const b=e[_];b!=null&&(l&&l(p,_,b,s)||(Array.isArray(b)&&Array.isArray(p[_])?p[_]=[...b,...p[_]]:TC(b)&&TC(p[_])?p[_]=FA(b,p[_],(s?`${s}.`:"")+_.toString(),l):p[_]=b))}return p}function pM(e){return(...i)=>i.reduce((s,l)=>FA(s,l,"",e),{})}const a0=pM(),MG=pM((e,i,s)=>{if(e[i]!==void 0&&typeof s=="function")return e[i]=s(e[i]),!0});function kG(e,i){try{return i in e}catch{return!1}}class pR extends Error{static __h3_error__=!0;statusCode=500;fatal=!1;unhandled=!1;statusMessage;data;cause;constructor(i,s={}){super(i,s),s.cause&&!this.cause&&(this.cause=s.cause)}toJSON(){const i={message:this.message,statusCode:BA(this.statusCode,500)};return this.statusMessage&&(i.statusMessage=VB(this.statusMessage)),this.data!==void 0&&(i.data=this.data),i}}function DG(e){if(typeof e=="string")return new pR(e);if(LG(e))return e;const i=new pR(e.message??e.statusMessage??"",{cause:e.cause||e});if(kG(e,"stack"))try{Object.defineProperty(i,"stack",{get(){return e.stack}})}catch{try{i.stack=e.stack}catch{}}if(e.data&&(i.data=e.data),e.statusCode?i.statusCode=BA(e.statusCode,i.statusCode):e.status&&(i.statusCode=BA(e.status,i.statusCode)),e.statusMessage?i.statusMessage=e.statusMessage:e.statusText&&(i.statusMessage=e.statusText),i.statusMessage){const s=i.statusMessage;VB(i.statusMessage)!==s&&console.warn("[h3] Please prefer using `message` for longer error messages instead of `statusMessage`. In the future, `statusMessage` will be sanitized by default.")}return e.fatal!==void 0&&(i.fatal=e.fatal),e.unhandled!==void 0&&(i.unhandled=e.unhandled),i}function LG(e){return e?.constructor?.__h3_error__===!0}const RG=/[^\u0009\u0020-\u007E]/g;function VB(e=""){return e.replace(RG,"")}function BA(e,i=200){return!e||(typeof e=="string"&&(e=Number.parseInt(e,10)),e<100||e>999)?i:e}const jB=Symbol("layout-meta"),mv=Symbol("route");import.meta.url.replace(/\/app\/.*$/,"/");const nu=()=>Vs()?.$router,Qw=()=>vv()?Fo(mv,Vs()._route):Vs()._route;const zG=()=>{try{if(Vs()._processingMiddleware)return!0}catch{return!1}return!1},UB=(e,i)=>{e||="/";const s=typeof e=="string"?e:"path"in e?NA(e):nu().resolve(e).href;if(i?.open){const{target:P="_blank",windowFeatures:O={}}=i.open,F=[];for(const[$,W]of Object.entries(O))W!==void 0&&F.push(`${$.toLowerCase()}=${W}`);return open(s,P,F.join(", ")),Promise.resolve()}const l=ud(s,{acceptRelative:!0}),p=i?.external||l;if(p){if(!i?.external)throw new Error("Navigating to an external URL is not allowed by default. Use `navigateTo(url, { external: true })`.");const{protocol:P}=new URL(s,window.location.href);if(P&&k9(P))throw new Error(`Cannot navigate to a URL with '${P}' protocol.`)}const _=zG();if(!p&&_){if(i?.replace){if(typeof e=="string"){const{pathname:P,search:O,hash:F}=Jx(e);return{path:P,...O&&{query:XE(O)},...F&&{hash:F},replace:!0}}return{...e,replace:!0}}return e}const b=nu(),t=Vs();return p?(t._scope.stop(),i?.replace?location.replace(s):location.href=s,_?t.isHydrating?new Promise(()=>{}):!1:Promise.resolve()):i?.replace?b.replace(e):b.push(e)};function NA(e){return pv(e.path||"",e.query||{})+(e.hash||"")}const $B="__nuxt_error",e2=()=>Nc(Vs().payload,"error"),ev=e=>{const i=i0(e);try{const s=e2();Vs().hooks.callHook("app:error",i),s.value||=i}catch{throw i}return i},OG=async(e={})=>{const i=Vs(),s=e2();i.callHook("app:error:cleared",e),e.redirect&&await nu().replace(e.redirect),s.value=void 0},GB=e=>!!e&&typeof e=="object"&&$B in e,i0=e=>{const i=DG(e);return Object.defineProperty(i,$B,{value:!0,configurable:!1,writable:!1}),i};let qB;const Qx=e=>qB=e,HB=Symbol();function VA(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var pw;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(pw||(pw={}));function FG(){const e=s0(!0),i=e.run(()=>an({}));let s=[],l=[];const p=uv({install(_){Qx(p),p._a=_,_.provide(HB,p),_.config.globalProperties.$pinia=p,l.forEach(b=>s.push(b)),l=[]},use(_){return this._a?s.push(_):l.push(_),this},_p:s,_a:null,_e:e,_s:new Map,state:i});return p}const WB=()=>{};function mR(e,i,s,l=WB){e.add(i);const p=()=>{e.delete(i)&&l()};return!s&&Rp()&&H_(p),p}function Ix(e,...i){e.forEach(s=>{s(...i)})}const BG=e=>e(),gR=Symbol(),SC=Symbol();function jA(e,i){e instanceof Map&&i instanceof Map?i.forEach((s,l)=>e.set(l,s)):e instanceof Set&&i instanceof Set&&i.forEach(e.add,e);for(const s in i){if(!i.hasOwnProperty(s))continue;const l=i[s],p=e[s];VA(p)&&VA(l)&&e.hasOwnProperty(s)&&!Wo(l)&&!Tm(l)?e[s]=jA(p,l):e[s]=l}return e}const NG=Symbol();function VG(e){return!VA(e)||!Object.prototype.hasOwnProperty.call(e,NG)}const{assign:Wy}=Object;function jG(e){return!!(Wo(e)&&e.effect)}function UG(e,i,s,l){const{state:p,actions:_,getters:b}=i,t=s.state.value[e];let P;function O(){t||(s.state.value[e]=p?p():{});const F=Mp(s.state.value[e]);return Wy(F,_,Object.keys(b||{}).reduce(($,W)=>($[W]=uv(Ei(()=>{Qx(s);const Y=s._s.get(e);return b[W].call(Y,Y)})),$),{}))}return P=ZB(e,O,i,s,l,!0),P}function ZB(e,i,s={},l,p,_){let b;const t=Wy({actions:{}},s),P={deep:!0};let O,F,$=new Set,W=new Set,Y;const ae=l.state.value[e];!_&&!ae&&(l.state.value[e]={}),an({});let se;function ie(je){let Ye;O=F=!1,typeof je=="function"?(je(l.state.value[e]),Ye={type:pw.patchFunction,storeId:e,events:Y}):(jA(l.state.value[e],je),Ye={type:pw.patchObject,payload:je,storeId:e,events:Y});const ct=se=Symbol();Da().then(()=>{se===ct&&(O=!0)}),F=!0,Ix($,Ye,l.state.value[e])}const pe=_?function(){const{state:Ye}=s,ct=Ye?Ye():{};this.$patch(Lt=>{Wy(Lt,ct)})}:WB;function ye(){b.stop(),$.clear(),W.clear(),l._s.delete(e)}const de=(je,Ye="")=>{if(gR in je)return je[SC]=Ye,je;const ct=function(){Qx(l);const Lt=Array.from(arguments),Ht=new Set,ci=new Set;function Wt(Ft){Ht.add(Ft)}function $t(Ft){ci.add(Ft)}Ix(W,{args:Lt,name:ct[SC],store:Pe,after:Wt,onError:$t});let Dt;try{Dt=je.apply(this&&this.$id===e?this:Pe,Lt)}catch(Ft){throw Ix(ci,Ft),Ft}return Dt instanceof Promise?Dt.then(Ft=>(Ix(Ht,Ft),Ft)).catch(Ft=>(Ix(ci,Ft),Promise.reject(Ft))):(Ix(Ht,Dt),Dt)};return ct[gR]=!0,ct[SC]=Ye,ct},Ee={_p:l,$id:e,$onAction:mR.bind(null,W),$patch:ie,$reset:pe,$subscribe(je,Ye={}){const ct=mR($,je,Ye.detached,()=>Lt()),Lt=b.run(()=>Qn(()=>l.state.value[e],Ht=>{(Ye.flush==="sync"?F:O)&&je({storeId:e,type:pw.direct,events:Y},Ht)},Wy({},P,Ye)));return ct},$dispose:ye},Pe=Ol(Ee);l._s.set(e,Pe);const We=(l._a&&l._a.runWithContext||BG)(()=>l._e.run(()=>(b=s0()).run(()=>i({action:de}))));for(const je in We){const Ye=We[je];if(Wo(Ye)&&!jG(Ye)||Tm(Ye))_||(ae&&VG(Ye)&&(Wo(Ye)?Ye.value=ae[je]:jA(Ye,ae[je])),l.state.value[e][je]=Ye);else if(typeof Ye=="function"){const ct=de(Ye,je);We[je]=ct,t.actions[je]=Ye}}return Wy(Pe,We),Wy(zo(Pe),We),Object.defineProperty(Pe,"$state",{get:()=>l.state.value[e],set:je=>{ie(Ye=>{Wy(Ye,je)})}}),l._p.forEach(je=>{Wy(Pe,b.run(()=>je({store:Pe,app:l._a,pinia:l,options:t})))}),ae&&_&&s.hydrate&&s.hydrate(Pe.$state,ae),O=!0,F=!0,Pe}function XB(e,i,s){let l;const p=typeof i=="function";l=p?s:i;function _(b,t){const P=vv();return b=b||(P?Fo(HB,null):null),b&&Qx(b),b=qB,b._s.has(e)||(p?ZB(e,i,l,b):UG(e,l,b)),b._s.get(e)}return _.$id=e,_}function $G(e){const i=zo(e),s={};for(const l in i){const p=i[l];p.effect?s[l]=Ei({get:()=>e[l],set(_){e[l]=_}}):(Wo(p)||Tm(p))&&(s[l]=Nc(e,l))}return s}function GG(e){const i=HG(e),s=new ArrayBuffer(i.length),l=new DataView(s);for(let p=0;p<s.byteLength;p++)l.setUint8(p,i.charCodeAt(p));return s}const qG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function HG(e){e.length%4===0&&(e=e.replace(/==?$/,""));let i="",s=0,l=0;for(let p=0;p<e.length;p++)s<<=6,s|=qG.indexOf(e[p]),l+=6,l===24&&(i+=String.fromCharCode((s&16711680)>>16),i+=String.fromCharCode((s&65280)>>8),i+=String.fromCharCode(s&255),s=l=0);return l===12?(s>>=4,i+=String.fromCharCode(s)):l===18&&(s>>=2,i+=String.fromCharCode((s&65280)>>8),i+=String.fromCharCode(s&255)),i}const WG=-1,ZG=-2,XG=-3,YG=-4,KG=-5,JG=-6;function QG(e,i){return eq(JSON.parse(e),i)}function eq(e,i){if(typeof e=="number")return p(e,!0);if(!Array.isArray(e)||e.length===0)throw new Error("Invalid input");const s=e,l=Array(s.length);function p(_,b=!1){if(_===WG)return;if(_===XG)return NaN;if(_===YG)return 1/0;if(_===KG)return-1/0;if(_===JG)return-0;if(b||typeof _!="number")throw new Error("Invalid input");if(_ in l)return l[_];const t=s[_];if(!t||typeof t!="object")l[_]=t;else if(Array.isArray(t))if(typeof t[0]=="string"){const P=t[0],O=i&&Object.hasOwn(i,P)?i[P]:void 0;if(O){let F=t[1];return typeof F!="number"&&(F=s.push(t[1])-1),l[_]=O(p(F))}switch(P){case"Date":l[_]=new Date(t[1]);break;case"Set":const F=new Set;l[_]=F;for(let Y=1;Y<t.length;Y+=1)F.add(p(t[Y]));break;case"Map":const $=new Map;l[_]=$;for(let Y=1;Y<t.length;Y+=2)$.set(p(t[Y]),p(t[Y+1]));break;case"RegExp":l[_]=new RegExp(t[1],t[2]);break;case"Object":l[_]=Object(t[1]);break;case"BigInt":l[_]=BigInt(t[1]);break;case"null":const W=Object.create(null);l[_]=W;for(let Y=1;Y<t.length;Y+=2)W[t[Y]]=p(t[Y+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const Y=globalThis[P],ae=new Y(p(t[1]));l[_]=t[2]!==void 0?ae.subarray(t[2],t[3]):ae;break}case"ArrayBuffer":{const Y=t[1],ae=GG(Y);l[_]=ae;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const Y=P.slice(9);l[_]=Temporal[Y].from(t[1]);break}case"URL":{const Y=new URL(t[1]);l[_]=Y;break}case"URLSearchParams":{const Y=new URLSearchParams(t[1]);l[_]=Y;break}default:throw new Error(`Unknown type ${P}`)}}else{const P=new Array(t.length);l[_]=P;for(let O=0;O<t.length;O+=1){const F=t[O];F!==ZG&&(P[O]=p(F))}}else{const P={};l[_]=P;for(const O in t){if(O==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const F=t[O];P[O]=p(F)}}return l[_]}return p(0)}const tq=new Set(["link","style","script","noscript"]),iq=new Set(["title","titleTemplate","script","style","noscript"]),_R=new Set(["base","meta","link","style","script","noscript"]),nq=new Set(["title","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),rq=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),sq=new Set(["key","tagPosition","tagPriority","tagDuplicateStrategy","innerHTML","textContent","processTemplateParams"]),oq=new Set(["templateParams","htmlAttrs","bodyAttrs"]),aq=new Set(["theme-color","google-site-verification","og","article","book","profile","twitter","author"]),lq=["name","property","http-equiv"],cq=new Set(["viewport","description","keywords","robots"]);function YB(e){const i=e.split(":");return i.length?aq.has(i[1]):!1}function UA(e){const{props:i,tag:s}=e;if(rq.has(s))return s;if(s==="link"&&i.rel==="canonical")return"canonical";if(i.charset)return"charset";if(e.tag==="meta"){for(const l of lq)if(i[l]!==void 0){const p=i[l],_=p&&typeof p=="string"&&p.includes(":"),b=p&&cq.has(p),P=!(_||b)&&e.key?`:key:${e.key}`:"";return`${s}:${p}${P}`}}if(e.key)return`${s}:key:${e.key}`;if(i.id)return`${s}:id:${i.id}`;if(iq.has(s)){const l=e.textContent||e.innerHTML;if(l)return`${s}:content:${l}`}}function yR(e){const i=e._h||e._d;if(i)return i;const s=e.textContent||e.innerHTML;return s||`${e.tag}:${Object.entries(e.props).map(([l,p])=>`${l}:${String(p)}`).join(",")}`}function dE(e,i,s){typeof e==="function"&&(!s||s!=="titleTemplate"&&!(s[0]==="o"&&s[1]==="n"))&&(e=e());const p=i?i(s,e):e;if(Array.isArray(p))return p.map(_=>dE(_,i));if(p?.constructor===Object){const _={};for(const b of Object.keys(p))_[b]=dE(p[b],i,b);return _}return p}function uq(e,i){const s=e==="style"?new Map:new Set;function l(p){if(p==null||p===void 0)return;const _=String(p).trim();if(_)if(e==="style"){const[b,...t]=_.split(":").map(P=>P?P.trim():"");b&&t.length&&s.set(b,t.join(":"))}else _.split(" ").filter(Boolean).forEach(b=>s.add(b))}return typeof i=="string"?e==="style"?i.split(";").forEach(l):l(i):Array.isArray(i)?i.forEach(p=>l(p)):i&&typeof i=="object"&&Object.entries(i).forEach(([p,_])=>{_&&_!=="false"&&(e==="style"?s.set(String(p).trim(),String(_)):l(p))}),s}function KB(e,i){return e.props=e.props||{},i?e.tag==="templateParams"?(e.props=i,e):(Object.entries(i).forEach(([s,l])=>{if(l===null){e.props[s]=null;return}if(s==="class"||s==="style"){e.props[s]=uq(s,l);return}if(sq.has(s)){if(["textContent","innerHTML"].includes(s)&&typeof l=="object"){let t=i.type;if(i.type||(t="application/json"),!t?.endsWith("json")&&t!=="speculationrules")return;i.type=t,e.props.type=t,e[s]=JSON.stringify(l)}else e[s]=l;return}const p=String(l),_=s.startsWith("data-"),b=e.tag==="meta"&&s==="content";p==="true"||p===""?e.props[s]=_||b?p:!0:!l&&_&&p==="false"?e.props[s]="false":l!==void 0&&(e.props[s]=l)}),e):e}function hq(e,i){const s=typeof i=="object"&&typeof i!="function"?i:{[e==="script"||e==="noscript"||e==="style"?"innerHTML":"textContent"]:i},l=KB({tag:e,props:{}},s);return l.key&&tq.has(l.tag)&&(l.props["data-hid"]=l._h=l.key),l.tag==="script"&&typeof l.innerHTML=="object"&&(l.innerHTML=JSON.stringify(l.innerHTML),l.props.type=l.props.type||"application/json"),Array.isArray(l.props.content)?l.props.content.map(p=>({...l,props:{...l.props,content:p}})):l}function dq(e,i){if(!e)return[];typeof e=="function"&&(e=e());const s=(p,_)=>{for(let b=0;b<i.length;b++)_=i[b](p,_);return _};e=s(void 0,e);const l=[];return e=dE(e,s),Object.entries(e||{}).forEach(([p,_])=>{if(_!==void 0)for(const b of Array.isArray(_)?_:[_])l.push(hq(p,b))}),l.flat()}const vR=(e,i)=>e._w===i._w?e._p-i._p:e._w-i._w,xR={base:-10,title:10},fq={critical:-8,high:-1,low:2},bR={meta:{"content-security-policy":-30,charset:-20,viewport:-15},link:{preconnect:20,stylesheet:60,preload:70,modulepreload:70,prefetch:90,"dns-prefetch":90,prerender:90},script:{async:30,defer:80,sync:50},style:{imported:40,sync:60}},pq=/@import/,U1=e=>e===""||e===!0;function mq(e,i){if(typeof i.tagPriority=="number")return i.tagPriority;let s=100;const l=fq[i.tagPriority]||0,p=e.resolvedOptions.disableCapoSorting?{link:{},script:{},style:{}}:bR;if(i.tag in xR)s=xR[i.tag];else if(i.tag==="meta"){const _=i.props["http-equiv"]==="content-security-policy"?"content-security-policy":i.props.charset?"charset":i.props.name==="viewport"?"viewport":null;_&&(s=bR.meta[_])}else if(i.tag==="link"&&i.props.rel)s=p.link[i.props.rel];else if(i.tag==="script"){const _=String(i.props.type);U1(i.props.async)?s=p.script.async:i.props.src&&!U1(i.props.defer)&&!U1(i.props.async)&&_!=="module"&&!_.endsWith("json")||i.innerHTML&&!_.endsWith("json")?s=p.script.sync:(U1(i.props.defer)&&i.props.src&&!U1(i.props.async)||_==="module")&&(s=p.script.defer)}else i.tag==="style"&&(s=i.innerHTML&&pq.test(i.innerHTML)?p.style.imported:p.style.sync);return(s||100)+l}function wR(e,i){const s=typeof i=="function"?i(e):i,l=s.key||String(e.plugins.size+1);e.plugins.get(l)||(e.plugins.set(l,s),e.hooks.addHooks(s.hooks||{}))}function gq(e={}){const i=zB();i.addHooks(e.hooks||{});const s=!e.document,l=new Map,p=new Map,_=new Set,b={_entryCount:1,plugins:p,dirty:!1,resolvedOptions:e,hooks:i,ssr:s,entries:l,headEntries(){return[...l.values()]},use:t=>wR(b,t),push(t,P){const O={...P||{}};delete O.head;const F=O._index??b._entryCount++,$={_i:F,input:t,options:O},W={_poll(Y=!1){b.dirty=!0,!Y&&_.add(F),i.callHook("entries:updated",b)},dispose(){l.delete(F)&&b.invalidate()},patch(Y){(!O.mode||O.mode==="server"&&s||O.mode==="client"&&!s)&&($.input=Y,l.set(F,$),W._poll())}};return W.patch(t),W},async resolveTags(){const t={tagMap:new Map,tags:[],entries:[...b.entries.values()]};for(await i.callHook("entries:resolve",t);_.size;){const W=_.values().next().value;_.delete(W);const Y=l.get(W);if(Y){const ae={tags:dq(Y.input,e.propResolvers||[]).map(se=>Object.assign(se,Y.options)),entry:Y};await i.callHook("entries:normalize",ae),Y._tags=ae.tags.map((se,ie)=>(se._w=mq(b,se),se._p=(Y._i<<10)+ie,se._d=UA(se),se))}}let P=!1;t.entries.flatMap(W=>(W._tags||[]).map(Y=>({...Y,props:{...Y.props}}))).sort(vR).reduce((W,Y)=>{const ae=String(Y._d||Y._p);if(!W.has(ae))return W.set(ae,Y);const se=W.get(ae);if((Y?.tagDuplicateStrategy||(oq.has(Y.tag)?"merge":null)||(Y.key&&Y.key===se.key?"merge":null))==="merge"){const pe={...se.props};Object.entries(Y.props).forEach(([ye,de])=>pe[ye]=ye==="style"?new Map([...se.props.style||new Map,...de]):ye==="class"?new Set([...se.props.class||new Set,...de]):de),W.set(ae,{...Y,props:pe})}else Y._p>>10===se._p>>10&&Y.tag==="meta"&&YB(ae)?(W.set(ae,Object.assign([...Array.isArray(se)?se:[se],Y],Y)),P=!0):(Y._w===se._w?Y._p>se._p:Y?._w<se?._w)&&W.set(ae,Y);return W},t.tagMap);const O=t.tagMap.get("title"),F=t.tagMap.get("titleTemplate");if(b._title=O?.textContent,F){const W=F?.textContent;if(b._titleTemplate=W,W){let Y=typeof W=="function"?W(O?.textContent):W;typeof Y=="string"&&!b.plugins.has("template-params")&&(Y=Y.replace("%s",O?.textContent||"")),O?Y===null?t.tagMap.delete("title"):t.tagMap.set("title",{...O,textContent:Y}):(F.tag="title",F.textContent=Y)}}t.tags=Array.from(t.tagMap.values()),P&&(t.tags=t.tags.flat().sort(vR)),await i.callHook("tags:beforeResolve",t),await i.callHook("tags:resolve",t),await i.callHook("tags:afterResolve",t);const $=[];for(const W of t.tags){const{innerHTML:Y,tag:ae,props:se}=W;if(nq.has(ae)&&!(Object.keys(se).length===0&&!W.innerHTML&&!W.textContent)&&!(ae==="meta"&&!se.content&&!se["http-equiv"]&&!se.charset)){if(ae==="script"&&Y){if(String(se.type).endsWith("json")){const ie=typeof Y=="string"?Y:JSON.stringify(Y);W.innerHTML=ie.replace(/</g,"\\u003C")}else typeof Y=="string"&&(W.innerHTML=Y.replace(new RegExp(`</${ae}`,"g"),`<\\/${ae}`));W._d=UA(W)}$.push(W)}}return $},invalidate(){for(const t of l.values())_.add(t._i);b.dirty=!0,i.callHook("entries:updated",b)}};return(e?.plugins||[]).forEach(t=>wR(b,t)),b.hooks.callHook("init",b),e.init?.forEach(t=>t&&b.push(t)),b}const _q=(e,i)=>Wo(i)?Rr(i):i,mM="usehead";function yq(e){return{install(s){s.config.globalProperties.$unhead=e,s.config.globalProperties.$head=e,s.provide(mM,e)}}.install}function vq(){if(vv()){const e=Fo(mM);if(!e)throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.");return e}throw new Error("useHead() was called without provide context, ensure you call it through the setup() function.")}function xq(e,i={}){const s=i.head||vq();return s.ssr?s.push(e||{},i):bq(s,e,i)}function bq(e,i,s={}){const l=an(!1);let p;return Ph(()=>{const b=l.value?{}:dE(i,_q);p?p.patch(b):p=e.push(b,s)}),ba()&&(Vf(()=>{p.dispose()}),rM(()=>{l.value=!0}),nM(()=>{l.value=!1})),p}function wq(e){const i=e||Vs();return i.ssrContext?.head||i.runWithContext(()=>{if(vv()){const s=Fo(mM);if(!s)throw new Error("[nuxt] [unhead] Missing Unhead instance.");return s}})}function hb(e,i={}){const s=i.head||wq(i.nuxt);return xq(e,{head:s,...i})}let SS,ES;function Tq(){return SS=$fetch(fM(`builds/meta/${jf().app.buildId}.json`),{responseType:"json"}),SS.then(e=>{ES=PG(e.matcher)}).catch(e=>{console.error("[nuxt] Error fetching app manifest.",e)}),SS}function YE(){return SS||Tq()}async function gM(e){const i=typeof e=="string"?e:e.path;if(await YE(),!ES)return console.error("[nuxt] Error creating app manifest matcher.",ES),{};try{return a0({},...ES.matchAll(i).reverse())}catch(s){return console.error("[nuxt] Error matching route rules.",s),{}}}async function TR(e,i={}){if(!await QB(e))return null;const l=await Eq(e,i);return await JB(l)||null}const Sq="_payload.json";async function Eq(e,i={}){const s=new URL(e,"http://localhost");if(s.host!=="localhost"||ud(s.pathname,{acceptRelative:!0}))throw new Error("Payload URL must not include hostname: "+e);const l=jf(),p=i.hash||(i.fresh?Date.now():l.app.buildId),_=l.app.cdnURL,b=_&&await QB(e)?_:l.app.baseURL;return Am(b,s.pathname,Sq+(p?`?${p}`:""))}async function JB(e){const i=fetch(e,{cache:"force-cache"}).then(s=>s.text().then(e4));try{return await i}catch(s){console.warn("[nuxt] Cannot load payload ",e,s)}return null}async function QB(e=Qw().path){const i=Vs();return e=e==="/"?e:e.replace(/\/$/,""),(await YE()).prerendered.includes(e)?!0:i.runWithContext(async()=>{const l=await gM({path:e});return!!l.prerender&&!l.redirect})}let Y0=null;async function Iq(){if(Y0)return Y0;const e=document.getElementById("__NUXT_DATA__");if(!e)return{};const i=await e4(e.textContent||""),s=e.dataset.src?await JB(e.dataset.src):void 0;return Y0={...i,...s,...window.__NUXT__},Y0.config?.public&&(Y0.config.public=Ol(Y0.config.public)),Y0}async function e4(e){return await QG(e,Vs()._payloadRevivers)}function t4(e,i){Vs()._payloadRevivers[e]=i}const Cq=IG(()=>{t4("skipHydrate",e=>{})}),i4=[["NuxtError",e=>i0(e)],["EmptyShallowRef",e=>so(e==="_"?void 0:e==="0n"?BigInt(0):kw(e))],["EmptyRef",e=>an(e==="_"?void 0:e==="0n"?BigInt(0):kw(e))],["ShallowRef",e=>so(e)],["ShallowReactive",e=>Ip(e)],["Ref",e=>an(e)],["Reactive",e=>Ol(e)]];i4.push(["Island",({key:e,params:i,result:s})=>{const l=Vs();return l.isHydrating||(l.payload.data[e]||=$fetch(`/__nuxt_island/${e}.json`,{responseType:"json",...i?{params:i}:{}}).then(p=>(l.payload.data[e]=p,p))),{html:"",...s}}]);const Aq=ol({name:"nuxt:revive-payload:client",order:-30,async setup(e){let i,s;for(const[l,p]of i4)t4(l,p);Object.assign(e.payload,([i,s]=Mg(()=>e.runWithContext(Iq)),i=await i,s(),i)),delete window.__NUXT__}});async function _M(e,i={}){const s=i.document||e.resolvedOptions.document;if(!s||!e.dirty)return;const l={shouldRender:!0,tags:[]};if(await e.hooks.callHook("dom:beforeRender",l),!!l.shouldRender)return e._domUpdatePromise||(e._domUpdatePromise=new Promise(async p=>{const _=new Map,b=new Promise(Y=>{e.resolveTags().then(ae=>{Y(ae.map(se=>{const ie=_.get(se._d)||0,pe={tag:se,id:(ie?`${se._d}:${ie}`:se._d)||yR(se),shouldRender:!0};return se._d&&YB(se._d)&&_.set(se._d,ie+1),pe}))})});let t=e._dom;if(!t){t={title:s.title,elMap:new Map().set("htmlAttrs",s.documentElement).set("bodyAttrs",s.body)};for(const Y of["body","head"]){const ae=s[Y]?.children;for(const se of ae){const ie=se.tagName.toLowerCase();if(!_R.has(ie))continue;const pe=KB({tag:ie,props:{}},{innerHTML:se.innerHTML,...se.getAttributeNames().reduce((ye,de)=>(ye[de]=se.getAttribute(de),ye),{})||{}});if(pe.key=se.getAttribute("data-hid")||void 0,pe._d=UA(pe)||yR(pe),t.elMap.has(pe._d)){let ye=1,de=pe._d;for(;t.elMap.has(de);)de=`${pe._d}:${ye++}`;t.elMap.set(de,se)}else t.elMap.set(pe._d,se)}}}t.pendingSideEffects={...t.sideEffects},t.sideEffects={};function P(Y,ae,se){const ie=`${Y}:${ae}`;t.sideEffects[ie]=se,delete t.pendingSideEffects[ie]}function O({id:Y,$el:ae,tag:se}){const ie=se.tag.endsWith("Attrs");t.elMap.set(Y,ae),ie||(se.textContent&&se.textContent!==ae.textContent&&(ae.textContent=se.textContent),se.innerHTML&&se.innerHTML!==ae.innerHTML&&(ae.innerHTML=se.innerHTML),P(Y,"el",()=>{ae?.remove(),t.elMap.delete(Y)}));for(const pe in se.props){if(!Object.prototype.hasOwnProperty.call(se.props,pe))continue;const ye=se.props[pe];if(pe.startsWith("on")&&typeof ye=="function"){const Ee=ae?.dataset;if(Ee&&Ee[`${pe}fired`]){const Pe=pe.slice(0,-5);ye.call(ae,new Event(Pe.substring(2)))}ae.getAttribute(`data-${pe}`)!==""&&((se.tag==="bodyAttrs"?s.defaultView:ae).addEventListener(pe.substring(2),ye.bind(ae)),ae.setAttribute(`data-${pe}`,""));continue}const de=`attr:${pe}`;if(pe==="class"){if(!ye)continue;for(const Ee of ye)ie&&P(Y,`${de}:${Ee}`,()=>ae.classList.remove(Ee)),!ae.classList.contains(Ee)&&ae.classList.add(Ee)}else if(pe==="style"){if(!ye)continue;for(const[Ee,Pe]of ye)P(Y,`${de}:${Ee}`,()=>{ae.style.removeProperty(Ee)}),ae.style.setProperty(Ee,Pe)}else ye!==!1&&ye!==null&&(ae.getAttribute(pe)!==ye&&ae.setAttribute(pe,ye===!0?"":String(ye)),ie&&P(Y,de,()=>ae.removeAttribute(pe)))}}const F=[],$={bodyClose:void 0,bodyOpen:void 0,head:void 0},W=await b;for(const Y of W){const{tag:ae,shouldRender:se,id:ie}=Y;if(se){if(ae.tag==="title"){s.title=ae.textContent,P("title","",()=>s.title=t.title);continue}Y.$el=Y.$el||t.elMap.get(ie),Y.$el?O(Y):_R.has(ae.tag)&&F.push(Y)}}for(const Y of F){const ae=Y.tag.tagPosition||"head";Y.$el=s.createElement(Y.tag.tag),O(Y),$[ae]=$[ae]||s.createDocumentFragment(),$[ae].appendChild(Y.$el)}for(const Y of W)await e.hooks.callHook("dom:renderTag",Y,s,P);$.head&&s.head.appendChild($.head),$.bodyOpen&&s.body.insertBefore($.bodyOpen,s.body.firstChild),$.bodyClose&&s.body.appendChild($.bodyClose);for(const Y in t.pendingSideEffects)t.pendingSideEffects[Y]();e._dom=t,await e.hooks.callHook("dom:rendered",{renders:W}),p()}).finally(()=>{e._domUpdatePromise=void 0,e.dirty=!1})),e._domUpdatePromise}function Pq(e={}){const i=e.domOptions?.render||_M;e.document=e.document||(typeof window<"u"?document:void 0);const s=e.document?.head.querySelector('script[id="unhead:payload"]')?.innerHTML||!1;return gq({...e,plugins:[...e.plugins||[],{key:"client",hooks:{"entries:updated":i}}],init:[s?JSON.parse(s):!1,...e.init||[]]})}function Mq(e,i){let s=0;return()=>{const l=++s;i(()=>{s===l&&e()})}}function kq(e={}){const i=Pq({domOptions:{render:Mq(()=>_M(i),s=>setTimeout(s,0))},...e});return i.install=yq(i),i}const Dq={disableDefaults:!0},Lq=ol({name:"nuxt:head",enforce:"pre",setup(e){const i=kq(Dq);e.vueApp.use(i);{let s=!0;const l=async()=>{s=!1,await _M(i)};i.hooks.hook("dom:beforeRender",p=>{p.shouldRender=!s}),e.hooks.hook("page:start",()=>{s=!0}),e.hooks.hook("page:finish",()=>{e.isHydrating||l()}),e.hooks.hook("app:error",l),e.hooks.hook("app:suspense:resolve",l)}}});const Px=typeof document<"u";function n4(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function Rq(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&n4(e.default)}const Aa=Object.assign;function EC(e,i){const s={};for(const l in i){const p=i[l];s[l]=Pm(p)?p.map(e):e(p)}return s}const mw=()=>{},Pm=Array.isArray;function SR(e,i){const s={};for(const l in e)s[l]=l in i?i[l]:e[l];return s}const r4=/#/g,zq=/&/g,Oq=/\//g,Fq=/=/g,Bq=/\?/g,s4=/\+/g,Nq=/%5B/g,Vq=/%5D/g,o4=/%5E/g,jq=/%60/g,a4=/%7B/g,Uq=/%7C/g,l4=/%7D/g,$q=/%20/g;function yM(e){return e==null?"":encodeURI(""+e).replace(Uq,"|").replace(Nq,"[").replace(Vq,"]")}function Gq(e){return yM(e).replace(a4,"{").replace(l4,"}").replace(o4,"^")}function $A(e){return yM(e).replace(s4,"%2B").replace($q,"+").replace(r4,"%23").replace(zq,"%26").replace(jq,"`").replace(a4,"{").replace(l4,"}").replace(o4,"^")}function qq(e){return $A(e).replace(Fq,"%3D")}function Hq(e){return yM(e).replace(r4,"%23").replace(Bq,"%3F")}function Wq(e){return Hq(e).replace(Oq,"%2F")}function Dw(e){if(e==null)return null;try{return decodeURIComponent(""+e)}catch{}return""+e}const Zq=/\/$/,Xq=e=>e.replace(Zq,"");function IC(e,i,s="/"){let l,p={},_="",b="";const t=i.indexOf("#");let P=i.indexOf("?");return P=t>=0&&P>t?-1:P,P>=0&&(l=i.slice(0,P),_=i.slice(P,t>0?t:i.length),p=e(_.slice(1))),t>=0&&(l=l||i.slice(0,t),b=i.slice(t,i.length)),l=Qq(l??i,s),{fullPath:l+_+b,path:l,query:p,hash:Dw(b)}}function Yq(e,i){const s=i.query?e(i.query):"";return i.path+(s&&"?")+s+(i.hash||"")}function ER(e,i){return!i||!e.toLowerCase().startsWith(i.toLowerCase())?e:e.slice(i.length)||"/"}function Kq(e,i,s){const l=i.matched.length-1,p=s.matched.length-1;return l>-1&&l===p&&eb(i.matched[l],s.matched[p])&&c4(i.params,s.params)&&e(i.query)===e(s.query)&&i.hash===s.hash}function eb(e,i){return(e.aliasOf||e)===(i.aliasOf||i)}function c4(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var s in e)if(!Jq(e[s],i[s]))return!1;return!0}function Jq(e,i){return Pm(e)?IR(e,i):Pm(i)?IR(i,e):e?.valueOf()===i?.valueOf()}function IR(e,i){return Pm(i)?e.length===i.length&&e.every((s,l)=>s===i[l]):e.length===1&&e[0]===i}function Qq(e,i){if(e.startsWith("/"))return e;if(!e)return i;const s=i.split("/"),l=e.split("/"),p=l[l.length-1];(p===".."||p===".")&&l.push("");let _=s.length-1,b,t;for(b=0;b<l.length;b++)if(t=l[b],t!==".")if(t==="..")_>1&&_--;else break;return s.slice(0,_).join("/")+"/"+l.slice(b).join("/")}const Ep={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let GA=(function(e){return e.pop="pop",e.push="push",e})({}),CC=(function(e){return e.back="back",e.forward="forward",e.unknown="",e})({});function eH(e){if(!e)if(Px){const i=document.querySelector("base");e=i&&i.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Xq(e)}const tH=/^[^#]+#/;function iH(e,i){return e.replace(tH,"#")+i}function nH(e,i){const s=document.documentElement.getBoundingClientRect(),l=e.getBoundingClientRect();return{behavior:i.behavior,left:l.left-s.left-(i.left||0),top:l.top-s.top-(i.top||0)}}const KE=()=>({left:window.scrollX,top:window.scrollY});function rH(e){let i;if("el"in e){const s=e.el,l=typeof s=="string"&&s.startsWith("#"),p=typeof s=="string"?l?document.getElementById(s.slice(1)):document.querySelector(s):s;if(!p)return;i=nH(p,e)}else i=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(i):window.scrollTo(i.left!=null?i.left:window.scrollX,i.top!=null?i.top:window.scrollY)}function CR(e,i){return(history.state?history.state.position-i:-1)+e}const qA=new Map;function sH(e,i){qA.set(e,i)}function oH(e){const i=qA.get(e);return qA.delete(e),i}function aH(e){return typeof e=="string"||e&&typeof e=="object"}function u4(e){return typeof e=="string"||typeof e=="symbol"}let ac=(function(e){return e[e.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",e[e.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",e[e.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",e[e.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",e[e.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",e})({});const h4=Symbol("");ac.MATCHER_NOT_FOUND+"",ac.NAVIGATION_GUARD_REDIRECT+"",ac.NAVIGATION_ABORTED+"",ac.NAVIGATION_CANCELLED+"",ac.NAVIGATION_DUPLICATED+"";function tb(e,i){return Aa(new Error,{type:e,[h4]:!0},i)}function A_(e,i){return e instanceof Error&&h4 in e&&(i==null||!!(e.type&i))}const lH=["params","query","hash"];function cH(e){if(typeof e=="string")return e;if(e.path!=null)return e.path;const i={};for(const s of lH)s in e&&(i[s]=e[s]);return JSON.stringify(i,null,2)}function uH(e){const i={};if(e===""||e==="?")return i;const s=(e[0]==="?"?e.slice(1):e).split("&");for(let l=0;l<s.length;++l){const p=s[l].replace(s4," "),_=p.indexOf("="),b=Dw(_<0?p:p.slice(0,_)),t=_<0?null:Dw(p.slice(_+1));if(b in i){let P=i[b];Pm(P)||(P=i[b]=[P]),P.push(t)}else i[b]=t}return i}function AR(e){let i="";for(let s in e){const l=e[s];if(s=qq(s),l==null){l!==void 0&&(i+=(i.length?"&":"")+s);continue}(Pm(l)?l.map(p=>p&&$A(p)):[l&&$A(l)]).forEach(p=>{p!==void 0&&(i+=(i.length?"&":"")+s,p!=null&&(i+="="+p))})}return i}function hH(e){const i={};for(const s in e){const l=e[s];l!==void 0&&(i[s]=Pm(l)?l.map(p=>p==null?null:""+p):l==null?l:""+l)}return i}const d4=Symbol(""),PR=Symbol(""),vM=Symbol(""),xM=Symbol(""),HA=Symbol("");function $1(){let e=[];function i(l){return e.push(l),()=>{const p=e.indexOf(l);p>-1&&e.splice(p,1)}}function s(){e=[]}return{add:i,list:()=>e.slice(),reset:s}}function dH(e,i,s){const l=()=>{e[i].delete(s)};ru(l),rM(l),nM(()=>{e[i].add(s)}),e[i].add(s)}function s_e(e){const i=Fo(d4,{}).value;i&&dH(i,"leaveGuards",e)}function Jy(e,i,s,l,p,_=b=>b()){const b=l&&(l.enterCallbacks[p]=l.enterCallbacks[p]||[]);return()=>new Promise((t,P)=>{const O=W=>{W===!1?P(tb(ac.NAVIGATION_ABORTED,{from:s,to:i})):W instanceof Error?P(W):aH(W)?P(tb(ac.NAVIGATION_GUARD_REDIRECT,{from:i,to:W})):(b&&l.enterCallbacks[p]===b&&typeof W=="function"&&b.push(W),t())},F=_(()=>e.call(l&&l.instances[p],i,s,O));let $=Promise.resolve(F);e.length<3&&($=$.then(O)),$.catch(W=>P(W))})}function AC(e,i,s,l,p=_=>_()){const _=[];for(const b of e)for(const t in b.components){let P=b.components[t];if(!(i!=="beforeRouteEnter"&&!b.instances[t]))if(n4(P)){const O=(P.__vccOpts||P)[i];O&&_.push(Jy(O,s,l,b,t,p))}else{let O=P();_.push(()=>O.then(F=>{if(!F)throw new Error(`Couldn't resolve component "${t}" at "${b.path}"`);const $=Rq(F)?F.default:F;b.mods[t]=F,b.components[t]=$;const W=($.__vccOpts||$)[i];return W&&Jy(W,s,l,b,t,p)()}))}}return _}function fH(e,i){const s=[],l=[],p=[],_=Math.max(i.matched.length,e.matched.length);for(let b=0;b<_;b++){const t=i.matched[b];t&&(e.matched.find(O=>eb(O,t))?l.push(t):s.push(t));const P=e.matched[b];P&&(i.matched.find(O=>eb(O,P))||p.push(P))}return[s,l,p]}let pH=()=>location.protocol+"//"+location.host;function f4(e,i){const{pathname:s,search:l,hash:p}=i,_=e.indexOf("#");if(_>-1){let b=p.includes(e.slice(_))?e.slice(_).length:1,t=p.slice(b);return t[0]!=="/"&&(t="/"+t),ER(t,"")}return ER(s,e)+l+p}function mH(e,i,s,l){let p=[],_=[],b=null;const t=({state:W})=>{const Y=f4(e,location),ae=s.value,se=i.value;let ie=0;if(W){if(s.value=Y,i.value=W,b&&b===ae){b=null;return}ie=se?W.position-se.position:0}else l(Y);p.forEach(pe=>{pe(s.value,ae,{delta:ie,type:GA.pop,direction:ie?ie>0?CC.forward:CC.back:CC.unknown})})};function P(){b=s.value}function O(W){p.push(W);const Y=()=>{const ae=p.indexOf(W);ae>-1&&p.splice(ae,1)};return _.push(Y),Y}function F(){if(document.visibilityState==="hidden"){const{history:W}=window;if(!W.state)return;W.replaceState(Aa({},W.state,{scroll:KE()}),"")}}function $(){for(const W of _)W();_=[],window.removeEventListener("popstate",t),window.removeEventListener("pagehide",F),document.removeEventListener("visibilitychange",F)}return window.addEventListener("popstate",t),window.addEventListener("pagehide",F),document.addEventListener("visibilitychange",F),{pauseListeners:P,listen:O,destroy:$}}function MR(e,i,s,l=!1,p=!1){return{back:e,current:i,forward:s,replaced:l,position:window.history.length,scroll:p?KE():null}}function gH(e){const{history:i,location:s}=window,l={value:f4(e,s)},p={value:i.state};p.value||_(l.value,{back:null,current:l.value,forward:null,position:i.length-1,replaced:!0,scroll:null},!0);function _(P,O,F){const $=e.indexOf("#"),W=$>-1?(s.host&&document.querySelector("base")?e:e.slice($))+P:pH()+e+P;try{i[F?"replaceState":"pushState"](O,"",W),p.value=O}catch(Y){console.error(Y),s[F?"replace":"assign"](W)}}function b(P,O){_(P,Aa({},i.state,MR(p.value.back,P,p.value.forward,!0),O,{position:p.value.position}),!0),l.value=P}function t(P,O){const F=Aa({},p.value,i.state,{forward:P,scroll:KE()});_(F.current,F,!0),_(P,Aa({},MR(l.value,P,null),{position:F.position+1},O),!1),l.value=P}return{location:l,state:p,push:t,replace:b}}function p4(e){e=eH(e);const i=gH(e),s=mH(e,i.state,i.location,i.replace);function l(_,b=!0){b||s.pauseListeners(),history.go(_)}const p=Aa({location:"",base:e,go:l,createHref:iH.bind(null,e)},i,s);return Object.defineProperty(p,"location",{enumerable:!0,get:()=>i.location.value}),Object.defineProperty(p,"state",{enumerable:!0,get:()=>i.state.value}),p}function _H(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),p4(e)}let nv=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.Group=2]="Group",e})({});var iu=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.ParamRegExp=2]="ParamRegExp",e[e.ParamRegExpEnd=3]="ParamRegExpEnd",e[e.EscapeNext=4]="EscapeNext",e})(iu||{});const yH={type:nv.Static,value:""},vH=/[a-zA-Z0-9_]/;function xH(e){if(!e)return[[]];if(e==="/")return[[yH]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function i(Y){throw new Error(`ERR (${s})/"${O}": ${Y}`)}let s=iu.Static,l=s;const p=[];let _;function b(){_&&p.push(_),_=[]}let t=0,P,O="",F="";function $(){O&&(s===iu.Static?_.push({type:nv.Static,value:O}):s===iu.Param||s===iu.ParamRegExp||s===iu.ParamRegExpEnd?(_.length>1&&(P==="*"||P==="+")&&i(`A repeatable param (${O}) must be alone in its segment. eg: '/:ids+.`),_.push({type:nv.Param,value:O,regexp:F,repeatable:P==="*"||P==="+",optional:P==="*"||P==="?"})):i("Invalid state to consume buffer"),O="")}function W(){O+=P}for(;t<e.length;){if(P=e[t++],P==="\\"&&s!==iu.ParamRegExp){l=s,s=iu.EscapeNext;continue}switch(s){case iu.Static:P==="/"?(O&&$(),b()):P===":"?($(),s=iu.Param):W();break;case iu.EscapeNext:W(),s=l;break;case iu.Param:P==="("?s=iu.ParamRegExp:vH.test(P)?W():($(),s=iu.Static,P!=="*"&&P!=="?"&&P!=="+"&&t--);break;case iu.ParamRegExp:P===")"?F[F.length-1]=="\\"?F=F.slice(0,-1)+P:s=iu.ParamRegExpEnd:F+=P;break;case iu.ParamRegExpEnd:$(),s=iu.Static,P!=="*"&&P!=="?"&&P!=="+"&&t--,F="";break;default:i("Unknown state");break}}return s===iu.ParamRegExp&&i(`Unfinished custom RegExp for param "${O}"`),$(),b(),p}const kR="[^/]+?",bH={sensitive:!1,strict:!1,start:!0,end:!0};var rd=(function(e){return e[e._multiplier=10]="_multiplier",e[e.Root=90]="Root",e[e.Segment=40]="Segment",e[e.SubSegment=30]="SubSegment",e[e.Static=40]="Static",e[e.Dynamic=20]="Dynamic",e[e.BonusCustomRegExp=10]="BonusCustomRegExp",e[e.BonusWildcard=-50]="BonusWildcard",e[e.BonusRepeatable=-20]="BonusRepeatable",e[e.BonusOptional=-8]="BonusOptional",e[e.BonusStrict=.7000000000000001]="BonusStrict",e[e.BonusCaseSensitive=.25]="BonusCaseSensitive",e})(rd||{});const wH=/[.+*?^${}()[\]/\\]/g;function TH(e,i){const s=Aa({},bH,i),l=[];let p=s.start?"^":"";const _=[];for(const O of e){const F=O.length?[]:[rd.Root];s.strict&&!O.length&&(p+="/");for(let $=0;$<O.length;$++){const W=O[$];let Y=rd.Segment+(s.sensitive?rd.BonusCaseSensitive:0);if(W.type===nv.Static)$||(p+="/"),p+=W.value.replace(wH,"\\$&"),Y+=rd.Static;else if(W.type===nv.Param){const{value:ae,repeatable:se,optional:ie,regexp:pe}=W;_.push({name:ae,repeatable:se,optional:ie});const ye=pe||kR;if(ye!==kR){Y+=rd.BonusCustomRegExp;try{`${ye}`}catch(Ee){throw new Error(`Invalid custom RegExp for param "${ae}" (${ye}): `+Ee.message)}}let de=se?`((?:${ye})(?:/(?:${ye}))*)`:`(${ye})`;$||(de=ie&&O.length<2?`(?:/${de})`:"/"+de),ie&&(de+="?"),p+=de,Y+=rd.Dynamic,ie&&(Y+=rd.BonusOptional),se&&(Y+=rd.BonusRepeatable),ye===".*"&&(Y+=rd.BonusWildcard)}F.push(Y)}l.push(F)}if(s.strict&&s.end){const O=l.length-1;l[O][l[O].length-1]+=rd.BonusStrict}s.strict||(p+="/?"),s.end?p+="$":s.strict&&!p.endsWith("/")&&(p+="(?:/|$)");const b=new RegExp(p,s.sensitive?"":"i");function t(O){const F=O.match(b),$={};if(!F)return null;for(let W=1;W<F.length;W++){const Y=F[W]||"",ae=_[W-1];$[ae.name]=Y&&ae.repeatable?Y.split("/"):Y}return $}function P(O){let F="",$=!1;for(const W of e){(!$||!F.endsWith("/"))&&(F+="/"),$=!1;for(const Y of W)if(Y.type===nv.Static)F+=Y.value;else if(Y.type===nv.Param){const{value:ae,repeatable:se,optional:ie}=Y,pe=ae in O?O[ae]:"";if(Pm(pe)&&!se)throw new Error(`Provided param "${ae}" is an array but it is not repeatable (* or + modifiers)`);const ye=Pm(pe)?pe.join("/"):pe;if(!ye)if(ie)W.length<2&&(F.endsWith("/")?F=F.slice(0,-1):$=!0);else throw new Error(`Missing required param "${ae}"`);F+=ye}}return F||"/"}return{re:b,score:l,keys:_,parse:t,stringify:P}}function SH(e,i){let s=0;for(;s<e.length&&s<i.length;){const l=i[s]-e[s];if(l)return l;s++}return e.length<i.length?e.length===1&&e[0]===rd.Static+rd.Segment?-1:1:e.length>i.length?i.length===1&&i[0]===rd.Static+rd.Segment?1:-1:0}function m4(e,i){let s=0;const l=e.score,p=i.score;for(;s<l.length&&s<p.length;){const _=SH(l[s],p[s]);if(_)return _;s++}if(Math.abs(p.length-l.length)===1){if(DR(l))return 1;if(DR(p))return-1}return p.length-l.length}function DR(e){const i=e[e.length-1];return e.length>0&&i[i.length-1]<0}const EH={strict:!1,end:!0,sensitive:!1};function IH(e,i,s){const l=TH(xH(e.path),s),p=Aa(l,{record:e,parent:i,children:[],alias:[]});return i&&!p.record.aliasOf==!i.record.aliasOf&&i.children.push(p),p}function CH(e,i){const s=[],l=new Map;i=SR(EH,i);function p($){return l.get($)}function _($,W,Y){const ae=!Y,se=RR($);se.aliasOf=Y&&Y.record;const ie=SR(i,$),pe=[se];if("alias"in $){const Ee=typeof $.alias=="string"?[$.alias]:$.alias;for(const Pe of Ee)pe.push(RR(Aa({},se,{components:Y?Y.record.components:se.components,path:Pe,aliasOf:Y?Y.record:se})))}let ye,de;for(const Ee of pe){const{path:Pe}=Ee;if(W&&Pe[0]!=="/"){const Ze=W.record.path,We=Ze[Ze.length-1]==="/"?"":"/";Ee.path=W.record.path+(Pe&&We+Pe)}if(ye=IH(Ee,W,ie),Y?Y.alias.push(ye):(de=de||ye,de!==ye&&de.alias.push(ye),ae&&$.name&&!zR(ye)&&b($.name)),g4(ye)&&P(ye),se.children){const Ze=se.children;for(let We=0;We<Ze.length;We++)_(Ze[We],ye,Y&&Y.children[We])}Y=Y||ye}return de?()=>{b(de)}:mw}function b($){if(u4($)){const W=l.get($);W&&(l.delete($),s.splice(s.indexOf(W),1),W.children.forEach(b),W.alias.forEach(b))}else{const W=s.indexOf($);W>-1&&(s.splice(W,1),$.record.name&&l.delete($.record.name),$.children.forEach(b),$.alias.forEach(b))}}function t(){return s}function P($){const W=MH($,s);s.splice(W,0,$),$.record.name&&!zR($)&&l.set($.record.name,$)}function O($,W){let Y,ae={},se,ie;if("name"in $&&$.name){if(Y=l.get($.name),!Y)throw tb(ac.MATCHER_NOT_FOUND,{location:$});ie=Y.record.name,ae=Aa(LR(W.params,Y.keys.filter(de=>!de.optional).concat(Y.parent?Y.parent.keys.filter(de=>de.optional):[]).map(de=>de.name)),$.params&&LR($.params,Y.keys.map(de=>de.name))),se=Y.stringify(ae)}else if($.path!=null)se=$.path,Y=s.find(de=>de.re.test(se)),Y&&(ae=Y.parse(se),ie=Y.record.name);else{if(Y=W.name?l.get(W.name):s.find(de=>de.re.test(W.path)),!Y)throw tb(ac.MATCHER_NOT_FOUND,{location:$,currentLocation:W});ie=Y.record.name,ae=Aa({},W.params,$.params),se=Y.stringify(ae)}const pe=[];let ye=Y;for(;ye;)pe.unshift(ye.record),ye=ye.parent;return{name:ie,path:se,params:ae,matched:pe,meta:PH(pe)}}e.forEach($=>_($));function F(){s.length=0,l.clear()}return{addRoute:_,resolve:O,removeRoute:b,clearRoutes:F,getRoutes:t,getRecordMatcher:p}}function LR(e,i){const s={};for(const l of i)l in e&&(s[l]=e[l]);return s}function RR(e){const i={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:AH(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(i,"mods",{value:{}}),i}function AH(e){const i={},s=e.props||!1;if("component"in e)i.default=s;else for(const l in e.components)i[l]=typeof s=="object"?s[l]:s;return i}function zR(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function PH(e){return e.reduce((i,s)=>Aa(i,s.meta),{})}function MH(e,i){let s=0,l=i.length;for(;s!==l;){const _=s+l>>1;m4(e,i[_])<0?l=_:s=_+1}const p=kH(e);return p&&(l=i.lastIndexOf(p,l-1)),l}function kH(e){let i=e;for(;i=i.parent;)if(g4(i)&&m4(e,i)===0)return i}function g4({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function OR(e){const i=Fo(vM),s=Fo(xM),l=Ei(()=>{const P=ut(e.to);return i.resolve(P)}),p=Ei(()=>{const{matched:P}=l.value,{length:O}=P,F=P[O-1],$=s.matched;if(!F||!$.length)return-1;const W=$.findIndex(eb.bind(null,F));if(W>-1)return W;const Y=FR(P[O-2]);return O>1&&FR(F)===Y&&$[$.length-1].path!==Y?$.findIndex(eb.bind(null,P[O-2])):W}),_=Ei(()=>p.value>-1&&OH(s.params,l.value.params)),b=Ei(()=>p.value>-1&&p.value===s.matched.length-1&&c4(s.params,l.value.params));function t(P={}){if(zH(P)){const O=i[ut(e.replace)?"replace":"push"](ut(e.to)).catch(mw);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>O),O}return Promise.resolve()}return{route:l,href:Ei(()=>l.value.href),isActive:_,isExactActive:b,navigate:t}}function DH(e){return e.length===1?e[0]:e}const LH=kr({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:OR,setup(e,{slots:i}){const s=Ol(OR(e)),{options:l}=Fo(vM),p=Ei(()=>({[BR(e.activeClass,l.linkActiveClass,"router-link-active")]:s.isActive,[BR(e.exactActiveClass,l.linkExactActiveClass,"router-link-exact-active")]:s.isExactActive}));return()=>{const _=i.default&&DH(i.default(s));return e.custom?_:Ns("a",{"aria-current":s.isExactActive?e.ariaCurrentValue:null,href:s.href,onClick:s.navigate,class:p.value},_)}}}),RH=LH;function zH(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const i=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(i))return}return e.preventDefault&&e.preventDefault(),!0}}function OH(e,i){for(const s in i){const l=i[s],p=e[s];if(typeof l=="string"){if(l!==p)return!1}else if(!Pm(p)||p.length!==l.length||l.some((_,b)=>_.valueOf()!==p[b].valueOf()))return!1}return!0}function FR(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const BR=(e,i,s)=>e??i??s,FH=kr({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:i,slots:s}){const l=Fo(HA),p=Ei(()=>e.route||l.value),_=Fo(PR,0),b=Ei(()=>{let O=ut(_);const{matched:F}=p.value;let $;for(;($=F[O])&&!$.components;)O++;return O}),t=Ei(()=>p.value.matched[b.value]);Ka(PR,Ei(()=>b.value+1)),Ka(d4,t),Ka(HA,p);const P=an();return Qn(()=>[P.value,t.value,e.name],([O,F,$],[W,Y,ae])=>{F&&(F.instances[$]=O,Y&&Y!==F&&O&&O===W&&(F.leaveGuards.size||(F.leaveGuards=Y.leaveGuards),F.updateGuards.size||(F.updateGuards=Y.updateGuards))),O&&F&&(!Y||!eb(F,Y)||!W)&&(F.enterCallbacks[$]||[]).forEach(se=>se(O))},{flush:"post"}),()=>{const O=p.value,F=e.name,$=t.value,W=$&&$.components[F];if(!W)return NR(s.default,{Component:W,route:O});const Y=$.props[F],ae=Y?Y===!0?O.params:typeof Y=="function"?Y(O):Y:null,ie=Ns(W,Aa({},ae,i,{onVnodeUnmounted:pe=>{pe.component.isUnmounted&&($.instances[F]=null)},ref:P}));return NR(s.default,{Component:ie,route:O})||ie}}});function NR(e,i){if(!e)return null;const s=e(i);return s.length===1?s[0]:s}const _4=FH;function BH(e){const i=CH(e.routes,e),s=e.parseQuery||uH,l=e.stringifyQuery||AR,p=e.history,_=$1(),b=$1(),t=$1(),P=so(Ep);let O=Ep;Px&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const F=EC.bind(null,ti=>""+ti),$=EC.bind(null,Wq),W=EC.bind(null,Dw);function Y(ti,sn){let Gi,gn;return u4(ti)?(Gi=i.getRecordMatcher(ti),gn=sn):gn=ti,i.addRoute(gn,Gi)}function ae(ti){const sn=i.getRecordMatcher(ti);sn&&i.removeRoute(sn)}function se(){return i.getRoutes().map(ti=>ti.record)}function ie(ti){return!!i.getRecordMatcher(ti)}function pe(ti,sn){if(sn=Aa({},sn||P.value),typeof ti=="string"){const Gt=IC(s,ti,sn.path),Ai=i.resolve({path:Gt.path},sn),hn=p.createHref(Gt.fullPath);return Aa(Gt,Ai,{params:W(Ai.params),hash:Dw(Gt.hash),redirectedFrom:void 0,href:hn})}let Gi;if(ti.path!=null)Gi=Aa({},ti,{path:IC(s,ti.path,sn.path).path});else{const Gt=Aa({},ti.params);for(const Ai in Gt)Gt[Ai]==null&&delete Gt[Ai];Gi=Aa({},ti,{params:$(Gt)}),sn.params=$(sn.params)}const gn=i.resolve(Gi,sn),nr=ti.hash||"";gn.params=F(W(gn.params));const Ur=Yq(l,Aa({},ti,{hash:Gq(nr),path:gn.path})),St=p.createHref(Ur);return Aa({fullPath:Ur,hash:nr,query:l===AR?hH(ti.query):ti.query||{}},gn,{redirectedFrom:void 0,href:St})}function ye(ti){return typeof ti=="string"?IC(s,ti,P.value.path):Aa({},ti)}function de(ti,sn){if(O!==ti)return tb(ac.NAVIGATION_CANCELLED,{from:sn,to:ti})}function Ee(ti){return We(ti)}function Pe(ti){return Ee(Aa(ye(ti),{replace:!0}))}function Ze(ti,sn){const Gi=ti.matched[ti.matched.length-1];if(Gi&&Gi.redirect){const{redirect:gn}=Gi;let nr=typeof gn=="function"?gn(ti,sn):gn;return typeof nr=="string"&&(nr=nr.includes("?")||nr.includes("#")?nr=ye(nr):{path:nr},nr.params={}),Aa({query:ti.query,hash:ti.hash,params:nr.path!=null?{}:ti.params},nr)}}function We(ti,sn){const Gi=O=pe(ti),gn=P.value,nr=ti.state,Ur=ti.force,St=ti.replace===!0,Gt=Ze(Gi,gn);if(Gt)return We(Aa(ye(Gt),{state:typeof Gt=="object"?Aa({},nr,Gt.state):nr,force:Ur,replace:St}),sn||Gi);const Ai=Gi;Ai.redirectedFrom=sn;let hn;return!Ur&&Kq(l,gn,Gi)&&(hn=tb(ac.NAVIGATION_DUPLICATED,{to:Ai,from:gn}),wn(gn,gn,!0,!1)),(hn?Promise.resolve(hn):ct(Ai,gn)).catch(Ui=>A_(Ui)?A_(Ui,ac.NAVIGATION_GUARD_REDIRECT)?Ui:Qi(Ui):vt(Ui,Ai,gn)).then(Ui=>{if(Ui){if(A_(Ui,ac.NAVIGATION_GUARD_REDIRECT))return We(Aa({replace:St},ye(Ui.to),{state:typeof Ui.to=="object"?Aa({},nr,Ui.to.state):nr,force:Ur}),sn||Ai)}else Ui=Ht(Ai,gn,!0,St,nr);return Lt(Ai,gn,Ui),Ui})}function je(ti,sn){const Gi=de(ti,sn);return Gi?Promise.reject(Gi):Promise.resolve()}function Ye(ti){const sn=mr.values().next().value;return sn&&typeof sn.runWithContext=="function"?sn.runWithContext(ti):ti()}function ct(ti,sn){let Gi;const[gn,nr,Ur]=fH(ti,sn);Gi=AC(gn.reverse(),"beforeRouteLeave",ti,sn);for(const Gt of gn)Gt.leaveGuards.forEach(Ai=>{Gi.push(Jy(Ai,ti,sn))});const St=je.bind(null,ti,sn);return Gi.push(St),Hr(Gi).then(()=>{Gi=[];for(const Gt of _.list())Gi.push(Jy(Gt,ti,sn));return Gi.push(St),Hr(Gi)}).then(()=>{Gi=AC(nr,"beforeRouteUpdate",ti,sn);for(const Gt of nr)Gt.updateGuards.forEach(Ai=>{Gi.push(Jy(Ai,ti,sn))});return Gi.push(St),Hr(Gi)}).then(()=>{Gi=[];for(const Gt of Ur)if(Gt.beforeEnter)if(Pm(Gt.beforeEnter))for(const Ai of Gt.beforeEnter)Gi.push(Jy(Ai,ti,sn));else Gi.push(Jy(Gt.beforeEnter,ti,sn));return Gi.push(St),Hr(Gi)}).then(()=>(ti.matched.forEach(Gt=>Gt.enterCallbacks={}),Gi=AC(Ur,"beforeRouteEnter",ti,sn,Ye),Gi.push(St),Hr(Gi))).then(()=>{Gi=[];for(const Gt of b.list())Gi.push(Jy(Gt,ti,sn));return Gi.push(St),Hr(Gi)}).catch(Gt=>A_(Gt,ac.NAVIGATION_CANCELLED)?Gt:Promise.reject(Gt))}function Lt(ti,sn,Gi){t.list().forEach(gn=>Ye(()=>gn(ti,sn,Gi)))}function Ht(ti,sn,Gi,gn,nr){const Ur=de(ti,sn);if(Ur)return Ur;const St=sn===Ep,Gt=Px?history.state:{};Gi&&(gn||St?p.replace(ti.fullPath,Aa({scroll:St&&Gt&&Gt.scroll},nr)):p.push(ti.fullPath,nr)),P.value=ti,wn(ti,sn,Gi,St),Qi()}let ci;function Wt(){ci||(ci=p.listen((ti,sn,Gi)=>{if(!Sr.listening)return;const gn=pe(ti),nr=Ze(gn,Sr.currentRoute.value);if(nr){We(Aa(nr,{replace:!0,force:!0}),gn).catch(mw);return}O=gn;const Ur=P.value;Px&&sH(CR(Ur.fullPath,Gi.delta),KE()),ct(gn,Ur).catch(St=>A_(St,ac.NAVIGATION_ABORTED|ac.NAVIGATION_CANCELLED)?St:A_(St,ac.NAVIGATION_GUARD_REDIRECT)?(We(Aa(ye(St.to),{force:!0}),gn).then(Gt=>{A_(Gt,ac.NAVIGATION_ABORTED|ac.NAVIGATION_DUPLICATED)&&!Gi.delta&&Gi.type===GA.pop&&p.go(-1,!1)}).catch(mw),Promise.reject()):(Gi.delta&&p.go(-Gi.delta,!1),vt(St,gn,Ur))).then(St=>{St=St||Ht(gn,Ur,!1),St&&(Gi.delta&&!A_(St,ac.NAVIGATION_CANCELLED)?p.go(-Gi.delta,!1):Gi.type===GA.pop&&A_(St,ac.NAVIGATION_ABORTED|ac.NAVIGATION_DUPLICATED)&&p.go(-1,!1)),Lt(gn,Ur,St)}).catch(mw)}))}let $t=$1(),Dt=$1(),Ft;function vt(ti,sn,Gi){Qi(ti);const gn=Dt.list();return gn.length?gn.forEach(nr=>nr(ti,sn,Gi)):console.error(ti),Promise.reject(ti)}function wi(){return Ft&&P.value!==Ep?Promise.resolve():new Promise((ti,sn)=>{$t.add([ti,sn])})}function Qi(ti){return Ft||(Ft=!ti,Wt(),$t.list().forEach(([sn,Gi])=>ti?Gi(ti):sn()),$t.reset()),ti}function wn(ti,sn,Gi,gn){const{scrollBehavior:nr}=e;if(!Px||!nr)return Promise.resolve();const Ur=!Gi&&oH(CR(ti.fullPath,0))||(gn||!Gi)&&history.state&&history.state.scroll||null;return Da().then(()=>nr(ti,sn,Ur)).then(St=>St&&rH(St)).catch(St=>vt(St,ti,sn))}const qn=ti=>p.go(ti);let Fn;const mr=new Set,Sr={currentRoute:P,listening:!0,addRoute:Y,removeRoute:ae,clearRoutes:i.clearRoutes,hasRoute:ie,getRoutes:se,resolve:pe,options:e,push:Ee,replace:Pe,go:qn,back:()=>qn(-1),forward:()=>qn(1),beforeEach:_.add,beforeResolve:b.add,afterEach:t.add,onError:Dt.add,isReady:wi,install(ti){ti.component("RouterLink",RH),ti.component("RouterView",_4),ti.config.globalProperties.$router=Sr,Object.defineProperty(ti.config.globalProperties,"$route",{enumerable:!0,get:()=>ut(P)}),Px&&!Fn&&P.value===Ep&&(Fn=!0,Ee(p.location).catch(gn=>{}));const sn={};for(const gn in Ep)Object.defineProperty(sn,gn,{get:()=>P.value[gn],enumerable:!0});ti.provide(vM,Sr),ti.provide(xM,Ip(sn)),ti.provide(HA,P);const Gi=ti.unmount;mr.add(ti),ti.unmount=function(){mr.delete(ti),mr.size<1&&(O=Ep,ci&&ci(),ci=null,P.value=Ep,Fn=!1,Ft=!1),Gi()}}};function Hr(ti){return ti.reduce((sn,Gi)=>sn.then(()=>Ye(Gi)),Promise.resolve())}return Sr}function y4(e){return Fo(xM)}const NH=/(:\w+)\([^)]+\)/g,VH=/(:\w+)[?+*]/g,jH=/:\w+/g,UH=(e,i)=>i.path.replace(NH,"$1").replace(VH,"$1").replace(jH,s=>e.params[s.slice(1)]?.toString()||""),WA=(e,i)=>{const s=e.route.matched.find(p=>p.components?.default===e.Component.type),l=i??s?.meta.key??(s&&UH(e.route,s));return typeof l=="function"?l(e.route):l},$H=(e,i)=>({default:()=>e?Ns(O$,e===!0?{}:e,i):i});function bM(e){return Array.isArray(e)?e:[e]}const GH="modulepreload",qH=function(e,i){return new URL(e,i).href},VR={},va=function(i,s,l){let p=Promise.resolve();if(s&&s.length>0){let O=function(F){return Promise.all(F.map($=>Promise.resolve($).then(W=>({status:"fulfilled",value:W}),W=>({status:"rejected",reason:W}))))};const b=document.getElementsByTagName("link"),t=document.querySelector("meta[property=csp-nonce]"),P=t?.nonce||t?.getAttribute("nonce");p=O(s.map(F=>{if(F=qH(F,l),F in VR)return;VR[F]=!0;const $=F.endsWith(".css"),W=$?'[rel="stylesheet"]':"";if(l)for(let ae=b.length-1;ae>=0;ae--){const se=b[ae];if(se.href===F&&(!$||se.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${F}"]${W}`))return;const Y=document.createElement("link");if(Y.rel=$?"stylesheet":GH,$||(Y.as="script"),Y.crossOrigin="",Y.href=F,P&&Y.setAttribute("nonce",P),document.head.appendChild(Y),$)return new Promise((ae,se)=>{Y.addEventListener("load",ae),Y.addEventListener("error",()=>se(new Error(`Unable to preload CSS for ${F}`)))})}))}function _(b){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=b,window.dispatchEvent(t),!t.defaultPrevented)throw b}return p.then(b=>{for(const t of b||[])t.status==="rejected"&&_(t.reason);return i().catch(_)})},HH={layout:"masonry",key:"photo-viewer-route"},WH={layout:"dashboard"},ZH={layout:"onboarding"},XH={layout:"dashboard"},YH={layout:"dashboard"},KH={layout:"onboarding"},JH={layout:"dashboard"},QH={layout:"dashboard"},eW={layout:"onboarding"},tW={layout:"onboarding"},iW={layout:"onboarding"},nW={layout:"onboarding"},rW={layout:"dashboard"},sW={layout:"dashboard"},oW={layout:"dashboard"},PC=[{name:"globe",path:"/globe",component:()=>va(()=>import("./h5q7TK7w.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)},{name:"signin",path:"/signin",component:()=>va(()=>import("./CWquY0w7.js"),__vite__mapDeps([4,5,6,7,8,9]),import.meta.url)},{name:"slug",path:"/:slug(.*)*",meta:HH||{},component:()=>va(()=>import("./D6vh96ne.js"),__vite__mapDeps([10,11]),import.meta.url)},{name:"albums",path:"/albums",component:()=>va(()=>import("./tOpLFj0c.js"),__vite__mapDeps([12,13,14,1,15,16]),import.meta.url)},{name:"dashboard-logs",path:"/dashboard/logs",meta:WH||{},component:()=>va(()=>import("./DlfXkKGz.js"),__vite__mapDeps([17,18,19,6,20,21,22,14,1,23,24,25,26,15,27]),import.meta.url)},{name:"onboarding-map",path:"/onboarding/map",meta:ZH||{},component:()=>va(()=>import("./BNU43CeG.js"),__vite__mapDeps([28,29,30,6,7,31,32,8]),import.meta.url)},{name:"dashboard",path:"/dashboard",meta:XH||{},component:()=>va(()=>import("./CkD7dK57.js"),__vite__mapDeps([33,18,19,34,35,36,23,14,1,21,22,25,37,38,15,39,6,40]),import.meta.url)},{name:"dashboard-queue",path:"/dashboard/queue",meta:YH||{},component:()=>va(()=>import("./CEoFNtWn.js"),__vite__mapDeps([41,18,19,34,36,23,14,1,21,22,25,37,38,15,39,6,42,35,43]),import.meta.url)},{name:"onboarding-site",path:"/onboarding/site",meta:KH||{},component:()=>va(()=>import("./BUnQTuG_.js"),__vite__mapDeps([44,30,6,7,31,32,8]),import.meta.url)},{name:"albums-albumId",path:"/albums/:albumId()",component:()=>va(()=>import("./JqEAUhj6.js"),__vite__mapDeps([45,46,47,13,14,1,15]),import.meta.url)},{name:"dashboard-albums",path:"/dashboard/albums",meta:JH||{},component:()=>va(()=>import("./Bflrq9Dq.js"),__vite__mapDeps([48,18,19,42,39,6,7,49,50,23,15,26,51,52,22,53,37,54,21,38]),import.meta.url)},{name:"dashboard-photos",path:"/dashboard/photos",meta:QH||{},component:()=>va(()=>import("./CwQgfHAY.js"),__vite__mapDeps([55,51,52,22,53,15,37,54,21,38,7,18,19,56,50,23,26,13,14,1,57,6,58,11,35,59,24,25,36,39,42,49,2,47,60]),import.meta.url)},{name:"onboarding-admin",path:"/onboarding/admin",meta:eW||{},component:()=>va(()=>import("./9BuRqA7D.js"),__vite__mapDeps([61,30,6,7,31,32,8]),import.meta.url)},{name:"onboarding",path:"/onboarding",meta:tW||{},component:()=>va(()=>import("./CYsNApKr.js"),__vite__mapDeps([62,32]),import.meta.url)},{name:"onboarding-storage",path:"/onboarding/storage",meta:iW||{},component:()=>va(()=>import("./BdrDmh0N.js"),__vite__mapDeps([63,29,30,6,7,31,51,52,22,53,15,37,54,21,38,32,8]),import.meta.url)},{name:"onboarding-complete",path:"/onboarding/complete",meta:nW||{},component:()=>va(()=>import("./Bomo6AKB.js"),__vite__mapDeps([64,32,31]),import.meta.url)},{name:"dashboard-settings-map",path:"/dashboard/settings/map",meta:rW||{},component:()=>va(()=>import("./--MkVbCh.js"),__vite__mapDeps([65,18,19,66,6,49,36,23,14,1,21,22,25,37,38,15,39,7,54,53,58,35]),import.meta.url)},{name:"dashboard-settings-general",path:"/dashboard/settings/general",meta:sW||{},component:()=>va(()=>import("./DxYeMTBz.js"),__vite__mapDeps([67,18,19,66,6,49,36,23,14,1,21,22,25,37,38,15,39,7,54,53,58,35]),import.meta.url)},{name:"dashboard-settings-storage",path:"/dashboard/settings/storage",meta:oW||{},component:()=>va(()=>import("./BMao8UwI.js"),__vite__mapDeps([68,18,19,36,23,14,1,21,22,25,37,38,15,39,6,7,56,50,26,35,5,51,52,53,54,20,24,42,8]),import.meta.url)}],v4=(e,i)=>({default:()=>e?Ns(dw,e===!0?{}:e,i):i.default?.()}),aW=/(:\w+)\([^)]+\)/g,lW=/(:\w+)[?+*]/g,cW=/:\w+/g;function jR(e){const i=e?.meta.key??e.path.replace(aW,"$1").replace(lW,"$1").replace(cW,s=>e.params[s.slice(1)]?.toString()||"");return typeof i=="function"?i(e):i}function uW(e,i){return e===i||i===Ep?!1:jR(e)!==jR(i)?!0:!e.matched.every((l,p)=>l.components&&l.components.default===i.matched[p]?.components?.default)}const hW={scrollBehavior(e,i,s){const l=Vs(),p=nu().options?.scrollBehaviorType??"auto";if(e.path.replace(/\/$/,"")===i.path.replace(/\/$/,""))return i.hash&&!e.hash?{left:0,top:0}:e.hash?{el:e.hash,top:x4(e.hash),behavior:p}:!1;if((typeof e.meta.scrollToTop=="function"?e.meta.scrollToTop(e,i):e.meta.scrollToTop)===!1)return!1;const b=l._runningTransition?"page:transition:finish":"page:loading:end";return new Promise(t=>{if(i===Ep){t(UR(e,i,s,p));return}l.hooks.hookOnce(b,()=>{requestAnimationFrame(()=>t(UR(e,i,s,p)))})})}};function x4(e){try{const i=document.querySelector(e);if(i)return(Number.parseFloat(getComputedStyle(i).scrollMarginTop)||0)+(Number.parseFloat(getComputedStyle(document.documentElement).scrollPaddingTop)||0)}catch{}return 0}function UR(e,i,s,l){if(s)return s;const p=uW(e,i);return e.hash?{el:e.hash,top:x4(e.hash),behavior:p?l:"instant"}:{left:0,top:0}}const b4={scrollBehavior(e,i,s){return s||(i.path==="/"||e.name==="slug"?!1:{top:0})}},dW={hashMode:!1,scrollBehaviorType:"auto"},ZA=b4.hashMode??!1,Gy={...dW,...hW,...b4},fW=async(e,i)=>{let s,l;if(!e.meta?.validate)return;const p=([s,l]=Mg(()=>Promise.resolve(e.meta.validate(e))),s=await s,l(),s);if(p===!0)return;const _=i0({fatal:!0,statusCode:p&&p.statusCode||404,statusMessage:p&&p.statusMessage||`Page Not Found: ${e.fullPath}`,data:{path:e.fullPath}});return typeof window<"u"&&window.history.pushState({},"",i.fullPath),_},JE=XB("settings",{state:()=>({data:{},isInitialized:!1,isLoading:!1,error:null}),getters:{isReady:e=>e.isInitialized&&!e.isLoading,getError:e=>e.error},actions:{async initSettings(){if(!this.isInitialized){this.isLoading=!0,this.error=null;try{const e=await $fetch("/api/system/settings/all");this.data=e.data,this.isInitialized=!0}catch(e){throw this.error=e,console.error("[Settings] Failed to initialize settings:",e),e}finally{this.isLoading=!1}}},getSetting(e){if(!this.isInitialized)return console.warn("[Settings] Settings not initialized yet. Call await initSettings() first."),null;if(e.includes(":")){const i=e.split(":"),s=i[0],l=i[1];if(s&&l){const p=this.data[s];if(p)return p[l]??null}return null}return this.data[e]??null},async refreshSettings(){this.isLoading=!0,this.error=null;try{const e=await $fetch("/api/system/settings/all");this.data=e.data,this.isInitialized=!0}catch(e){throw this.error=e,console.error("[Settings] Failed to refresh settings:",e),e}finally{this.isLoading=!1}}}});function pW(e){try{return JE().getSetting(e)}catch(i){return console.warn("[Settings] Failed to access settings store:",i),null}}function $R(e){const i=JE();return Ei(()=>i.getSetting(e))}const mW=async(e,i)=>{let s,l;const p=JE();if(!p.isReady)try{[s,l]=Mg(()=>p.initSettings()),await s,l()}catch(t){console.error("Failed to load settings in middleware",t)}const _=p.getSetting("system:firstLaunch"),b=e.path.startsWith("/onboarding");if(_===!0&&!b)return UB("/onboarding")},gW=async e=>{let i,s;const l=([i,s]=Mg(()=>gM({path:e.path})),i=await i,s(),i);if(l.redirect){const p=l.redirect.includes("#")?l.redirect:l.redirect+e.hash;return ud(p,{acceptRelative:!0})?(window.location.href=p,!1):p}},_W=[fW,mW,gW],XA={};function yW(e,i,s){const{pathname:l,search:p,hash:_}=i,b=e.indexOf("#");if(b>-1){const O=_.includes(e.slice(b))?e.slice(b).length:1;let F=_.slice(O);return F[0]!=="/"&&(F="/"+F),sR(F,"")}const t=sR(l,e),P=!s||B9(t,s)?t:s;return P+(P.includes("?")?"":p)+_}const vW=ol({name:"nuxt:router",enforce:"pre",async setup(e){let i,s,l=jf().app.baseURL;ZA&&!l.includes("#")&&(l+="#");const p=Gy.history?.(l)??(ZA?_H(l):p4(l)),_=Gy.routes?([i,s]=Mg(()=>Gy.routes(PC)),i=await i,s(),i??PC):PC;let b;const t=BH({...Gy,scrollBehavior:(ie,pe,ye)=>{if(pe===Ep){b=ye;return}if(Gy.scrollBehavior){if(t.options.scrollBehavior=Gy.scrollBehavior,"scrollRestoration"in window.history){const de=t.beforeEach(()=>{de(),window.history.scrollRestoration="manual"})}return Gy.scrollBehavior(ie,Ep,b||ye)}},history:p,routes:_});"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto"),e.vueApp.use(t);const P=so(t.currentRoute.value);t.afterEach((ie,pe)=>{P.value=pe}),Object.defineProperty(e.vueApp.config.globalProperties,"previousRoute",{get:()=>P.value});const O=yW(l,window.location,e.payload.path),F=so(t.currentRoute.value),$=()=>{F.value=t.currentRoute.value};t.afterEach((ie,pe)=>{ie.matched.at(-1)?.components?.default===pe.matched.at(-1)?.components?.default&&$()});const W={sync:$};for(const ie in F.value)Object.defineProperty(W,ie,{get:()=>F.value[ie],enumerable:!0});e._route=Ip(W),e._middleware||={global:[],named:{}};const Y=e2();t.afterEach(async(ie,pe,ye)=>{delete e._processingMiddleware,!e.isHydrating&&Y.value&&await e.runWithContext(OG),ye&&await e.callHook("page:loading:end")});try{[i,s]=Mg(()=>t.isReady()),await i,s()}catch(ie){[i,s]=Mg(()=>e.runWithContext(()=>ev(ie))),await i,s()}const ae=O!==t.currentRoute.value.fullPath?t.resolve(O):t.currentRoute.value;$();const se=e.payload.state._layout;return t.beforeEach(async(ie,pe)=>{await e.callHook("page:loading:start"),ie.meta=Ol(ie.meta),e.isHydrating&&se&&!Rg(ie.meta.layout)&&(ie.meta.layout=se),e._processingMiddleware=!0;{const ye=new Set([..._W,...e._middleware.global]);for(const de of ie.matched){const Ee=de.meta.middleware;if(Ee)for(const Pe of bM(Ee))ye.add(Pe)}{const de=await e.runWithContext(()=>gM({path:ie.path}));if(de.appMiddleware)for(const Ee in de.appMiddleware)de.appMiddleware[Ee]?ye.add(Ee):ye.delete(Ee)}for(const de of ye){const Ee=typeof de=="string"?e._middleware.named[de]||await XA[de]?.().then(Pe=>Pe.default||Pe):de;if(!Ee)throw new Error(`Unknown route middleware: '${de}'.`);try{const Pe=await e.runWithContext(()=>Ee(ie,pe));if(!e.payload.serverRendered&&e.isHydrating&&(Pe===!1||Pe instanceof Error)){const Ze=Pe||i0({statusCode:404,statusMessage:`Page Not Found: ${O}`});return await e.runWithContext(()=>ev(Ze)),!1}if(Pe===!0)continue;if(Pe===!1)return Pe;if(Pe)return GB(Pe)&&Pe.fatal&&await e.runWithContext(()=>ev(Pe)),Pe}catch(Pe){const Ze=i0(Pe);return Ze.fatal&&await e.runWithContext(()=>ev(Ze)),Ze}}}}),t.onError(async()=>{delete e._processingMiddleware,await e.callHook("page:loading:end")}),t.afterEach(ie=>{if(ie.matched.length===0)return e.runWithContext(()=>ev(i0({statusCode:404,fatal:!1,statusMessage:`Page not found: ${ie.fullPath}`,data:{path:ie.fullPath}})))}),e.hooks.hookOnce("app:created",async()=>{try{"name"in ae&&(ae.name=void 0),await t.replace({...ae,force:!0}),t.options.scrollBehavior=Gy.scrollBehavior}catch(ie){await e.runWithContext(()=>ev(ie))}}),{provide:{router:t}}}});function fE(e){return typeof e=="string"?`'${e}'`:new xW().serialize(e)}const xW=(function(){class e{#e=new Map;compare(s,l){const p=typeof s,_=typeof l;return p==="string"&&_==="string"?s.localeCompare(l):p==="number"&&_==="number"?s-l:String.prototype.localeCompare.call(this.serialize(s,!0),this.serialize(l,!0))}serialize(s,l){if(s===null)return"null";switch(typeof s){case"string":return l?s:`'${s}'`;case"bigint":return`${s}n`;case"object":return this.$object(s);case"function":return this.$function(s)}return String(s)}serializeObject(s){const l=Object.prototype.toString.call(s);if(l!=="[object Object]")return this.serializeBuiltInType(l.length<10?`unknown:${l}`:l.slice(8,-1),s);const p=s.constructor,_=p===Object||p===void 0?"":p.name;if(_!==""&&globalThis[_]===p)return this.serializeBuiltInType(_,s);if(typeof s.toJSON=="function"){const b=s.toJSON();return _+(b!==null&&typeof b=="object"?this.$object(b):`(${this.serialize(b)})`)}return this.serializeObjectEntries(_,Object.entries(s))}serializeBuiltInType(s,l){const p=this["$"+s];if(p)return p.call(this,l);if(typeof l?.entries=="function")return this.serializeObjectEntries(s,l.entries());throw new Error(`Cannot serialize ${s}`)}serializeObjectEntries(s,l){const p=Array.from(l).sort((b,t)=>this.compare(b[0],t[0]));let _=`${s}{`;for(let b=0;b<p.length;b++){const[t,P]=p[b];_+=`${this.serialize(t,!0)}:${this.serialize(P)}`,b<p.length-1&&(_+=",")}return _+"}"}$object(s){let l=this.#e.get(s);return l===void 0&&(this.#e.set(s,`#${this.#e.size}`),l=this.serializeObject(s),this.#e.set(s,l)),l}$function(s){const l=Function.prototype.toString.call(s);return l.slice(-15)==="[native code] }"?`${s.name||""}()[native]`:`${s.name}(${s.length})${l.replace(/\s*\n\s*/g,"")}`}$Array(s){let l="[";for(let p=0;p<s.length;p++)l+=this.serialize(s[p]),p<s.length-1&&(l+=",");return l+"]"}$Date(s){try{return`Date(${s.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(s){return`ArrayBuffer[${new Uint8Array(s).join(",")}]`}$Set(s){return`Set${this.$Array(Array.from(s).sort((l,p)=>this.compare(l,p)))}`}$Map(s){return this.serializeObjectEntries("Map",s.entries())}}for(const i of["Error","RegExp","URL"])e.prototype["$"+i]=function(s){return`${i}(${s})`};for(const i of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])e.prototype["$"+i]=function(s){return`${i}[${s.join(",")}]`};for(const i of["BigInt64Array","BigUint64Array"])e.prototype["$"+i]=function(s){return`${i}[${s.join("n,")}${s.length>0?"n":""}]`};return e})();function QE(e,i){return e===i||fE(e)===fE(i)}const bW=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],wW=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],TW="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",K0=[];let SW=class{_data=new GT;_hash=new GT([...bW]);_nDataBytes=0;_minBufferSize=0;finalize(i){i&&this._append(i);const s=this._nDataBytes*8,l=this._data.sigBytes*8;return this._data.words[l>>>5]|=128<<24-l%32,this._data.words[(l+64>>>9<<4)+14]=Math.floor(s/4294967296),this._data.words[(l+64>>>9<<4)+15]=s,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(i,s){const l=this._hash.words;let p=l[0],_=l[1],b=l[2],t=l[3],P=l[4],O=l[5],F=l[6],$=l[7];for(let W=0;W<64;W++){if(W<16)K0[W]=i[s+W]|0;else{const de=K0[W-15],Ee=(de<<25|de>>>7)^(de<<14|de>>>18)^de>>>3,Pe=K0[W-2],Ze=(Pe<<15|Pe>>>17)^(Pe<<13|Pe>>>19)^Pe>>>10;K0[W]=Ee+K0[W-7]+Ze+K0[W-16]}const Y=P&O^~P&F,ae=p&_^p&b^_&b,se=(p<<30|p>>>2)^(p<<19|p>>>13)^(p<<10|p>>>22),ie=(P<<26|P>>>6)^(P<<21|P>>>11)^(P<<7|P>>>25),pe=$+ie+Y+wW[W]+K0[W],ye=se+ae;$=F,F=O,O=P,P=t+pe|0,t=b,b=_,_=p,p=pe+ye|0}l[0]=l[0]+p|0,l[1]=l[1]+_|0,l[2]=l[2]+b|0,l[3]=l[3]+t|0,l[4]=l[4]+P|0,l[5]=l[5]+O|0,l[6]=l[6]+F|0,l[7]=l[7]+$|0}_append(i){typeof i=="string"&&(i=GT.fromUtf8(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes}_process(i){let s,l=this._data.sigBytes/64;i?l=Math.ceil(l):l=Math.max((l|0)-this._minBufferSize,0);const p=l*16,_=Math.min(p*4,this._data.sigBytes);if(p){for(let b=0;b<p;b+=16)this._doProcessBlock(this._data.words,b);s=this._data.words.splice(0,p),this._data.sigBytes-=_}return new GT(s,_)}},GT=class w4{words;sigBytes;constructor(i,s){i=this.words=i||[],this.sigBytes=s===void 0?i.length*4:s}static fromUtf8(i){const s=unescape(encodeURIComponent(i)),l=s.length,p=[];for(let _=0;_<l;_++)p[_>>>2]|=(s.charCodeAt(_)&255)<<24-_%4*8;return new w4(p,l)}toBase64(){const i=[];for(let s=0;s<this.sigBytes;s+=3){const l=this.words[s>>>2]>>>24-s%4*8&255,p=this.words[s+1>>>2]>>>24-(s+1)%4*8&255,_=this.words[s+2>>>2]>>>24-(s+2)%4*8&255,b=l<<16|p<<8|_;for(let t=0;t<4&&s*8+t*6<this.sigBytes*8;t++)i.push(TW.charAt(b>>>6*(3-t)&63))}return i.join("")}concat(i){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let s=0;s<i.sigBytes;s++){const l=i.words[s>>>2]>>>24-s%4*8&255;this.words[this.sigBytes+s>>>2]|=l<<24-(this.sigBytes+s)%4*8}else for(let s=0;s<i.sigBytes;s+=4)this.words[this.sigBytes+s>>>2]=i.words[s>>>2];this.sigBytes+=i.sigBytes}};function EW(e){return new SW().finalize(e).toBase64()}function Mx(e){return EW(fE(e))}const IW={trailing:!0};function CW(e,i=25,s={}){if(s={...IW,...s},!Number.isFinite(i))throw new TypeError("Expected `wait` to be a finite number");let l,p,_=[],b,t;const P=($,W)=>(b=AW(e,$,W),b.finally(()=>{if(b=null,s.trailing&&t&&!p){const Y=P($,t);return t=null,Y}}),b),O=function(...$){return s.trailing&&(t=$),b||new Promise(W=>{const Y=!p&&s.leading;clearTimeout(p),p=setTimeout(()=>{p=null;const ae=s.leading?l:P(this,$);t=null;for(const se of _)se(ae);_=[]},i),Y?(l=P(this,$),W(l)):_.push(W)})},F=$=>{$&&(clearTimeout($),p=null)};return O.isPending=()=>!!p,O.cancel=()=>{F(p),_=[],t=null},O.flush=()=>{if(F(p),!t||b)return;const $=t;return t=null,P(this,$)},O}async function AW(e,i,s){return await e.apply(i,s)}const T4=Symbol.for("nuxt:client-only"),S4=kr({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(e,{slots:i,attrs:s}){const l=so(!1);La(()=>{l.value=!0});const p=ba();return p&&(p._nuxtClientOnly=!0),Ka(T4,!0),()=>{if(l.value){const P=i.default?.();return P&&P.length===1?[kp(P[0],s)]:P}const _=i.fallback||i.placeholder;if(_)return Ns(_);const b=e.fallback||e.placeholder||"",t=e.fallbackTag||e.placeholderTag||"span";return ir(t,s,b)}}}),YA=globalThis.requestIdleCallback||(e=>{const i=Date.now(),s={didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-i))};return setTimeout(()=>{e(s)},1)}),PW=globalThis.cancelIdleCallback||(e=>{clearTimeout(e)}),eI=e=>{const i=Vs();i.isHydrating?i.hooks.hookOnce("app:suspense:resolve",()=>{YA(()=>e())}):YA(()=>e())};function MW(...e){const i=typeof e[e.length-1]=="string"?e.pop():void 0;kW(e[0],e[1])&&e.unshift(i);let[s,l,p={}]=e,_=!1;const b=Ei(()=>Rr(s));if(typeof b.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof l!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const t=Vs();p.server??=!0,p.default??=LW,p.getCachedData??=I4,p.lazy??=!1,p.immediate??=!0,p.deep??=_G.deep,p.dedupe??="cancel",p._functionName,t._asyncData[b.value];function P(){const ae={cause:"initial",dedupe:p.dedupe};return t._asyncData[b.value]?._init||(ae.cachedData=p.getCachedData(b.value,t,{cause:"initial"}),t._asyncData[b.value]=GR(t,b.value,l,p,ae.cachedData)),()=>t._asyncData[b.value].execute(ae)}const O=P(),F=t._asyncData[b.value];F._deps++;const $=p.server!==!1&&t.payload.serverRendered;{let ae=function(Ee){const Pe=t._asyncData[Ee];Pe?._deps&&(Pe._deps--,Pe._deps===0&&Pe?._off())};const se=ba();if(se&&$&&p.immediate&&!se.sp&&(se.sp=[]),se&&!se._nuxtOnBeforeMountCbs){se._nuxtOnBeforeMountCbs=[];const Ee=se._nuxtOnBeforeMountCbs;sM(()=>{Ee.forEach(Pe=>{Pe()}),Ee.splice(0,Ee.length)}),ru(()=>Ee.splice(0,Ee.length))}const ie=se&&(se._nuxtClientOnly||Fo(T4,!1));$&&t.isHydrating&&(F.error.value||F.data.value!==void 0)?F.status.value=F.error.value?"error":"success":se&&(!ie&&t.payload.serverRendered&&t.isHydrating||p.lazy)&&p.immediate?se._nuxtOnBeforeMountCbs.push(O):p.immediate&&F.status.value!=="success"&&O();const pe=Rp(),ye=Qn(b,(Ee,Pe)=>{if((Ee||Pe)&&Ee!==Pe){_=!0;const Ze=t._asyncData[Pe]?.data.value!==void 0,We=t._asyncDataPromises[Pe]!==void 0,je={cause:"initial",dedupe:p.dedupe};if(!t._asyncData[Ee]?._init){let Ye;Pe&&Ze?Ye=t._asyncData[Pe].data.value:(Ye=p.getCachedData(Ee,t,{cause:"initial"}),je.cachedData=Ye),t._asyncData[Ee]=GR(t,Ee,l,p,Ye)}t._asyncData[Ee]._deps++,Pe&&ae(Pe),(p.immediate||Ze||We)&&t._asyncData[Ee].execute(je),JS(()=>{_=!1})}},{flush:"sync"}),de=p.watch?Qn(p.watch,()=>{_||t._asyncData[b.value]?._execute({cause:"watch",dedupe:p.dedupe})}):()=>{};pe&&H_(()=>{ye(),de(),ae(b.value)})}const W={data:qT(()=>t._asyncData[b.value]?.data),pending:qT(()=>t._asyncData[b.value]?.pending),status:qT(()=>t._asyncData[b.value]?.status),error:qT(()=>t._asyncData[b.value]?.error),refresh:(...ae)=>t._asyncData[b.value]?._init?t._asyncData[b.value].execute(...ae):P()(),execute:(...ae)=>W.refresh(...ae),clear:()=>{const ae=t._asyncData[b.value];if(ae?._abortController)try{ae._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{ae._abortController=void 0}E4(t,b.value)}},Y=Promise.resolve(t._asyncDataPromises[b.value]).then(()=>W);return Object.assign(Y,W),Y}function qT(e){return Ei({get(){return e()?.value},set(i){const s=e();s&&(s.value=i)}})}function kW(e,i){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof i=="function")}function E4(e,i){i in e.payload.data&&(e.payload.data[i]=void 0),i in e.payload._errors&&(e.payload._errors[i]=void 0),e._asyncData[i]&&(e._asyncData[i].data.value=ut(e._asyncData[i]._default()),e._asyncData[i].error.value=void 0,e._asyncData[i].status.value="idle"),i in e._asyncDataPromises&&(e._asyncDataPromises[i]=void 0)}function DW(e,i){const s={};for(const l of i)s[l]=e[l];return s}function GR(e,i,s,l,p){e.payload._errors[i]??=void 0;const _=l.getCachedData!==I4,b=s,t=l.deep?an:so,P=p!==void 0,O=e.hook("app:data:refresh",async $=>{(!$||$.includes(i))&&await F.execute({cause:"refresh:hook"})}),F={data:t(P?p:l.default()),pending:Ei(()=>F.status.value==="pending"),error:Nc(e.payload._errors,i),status:so("idle"),execute:(...$)=>{const[W,Y=void 0]=$,ae=W&&Y===void 0&&typeof W=="object"?W:{};if(e._asyncDataPromises[i]&&(ae.dedupe??l.dedupe)==="defer")return e._asyncDataPromises[i];{const pe="cachedData"in ae?ae.cachedData:l.getCachedData(i,e,{cause:ae.cause??"refresh:manual"});if(pe!==void 0)return e.payload.data[i]=F.data.value=pe,F.error.value=void 0,F.status.value="success",Promise.resolve(pe)}F._abortController&&F._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),F._abortController=new AbortController,F.status.value="pending";const se=new AbortController,ie=new Promise((pe,ye)=>{try{const de=ae.timeout??l.timeout,Ee=RW([F._abortController?.signal,ae?.signal],se.signal,de);if(Ee.aborted){const Pe=Ee.reason;ye(Pe instanceof Error?Pe:new DOMException(String(Pe??"Aborted"),"AbortError"));return}return Ee.addEventListener("abort",()=>{const Pe=Ee.reason;ye(Pe instanceof Error?Pe:new DOMException(String(Pe??"Aborted"),"AbortError"))},{once:!0,signal:se.signal}),Promise.resolve(b(e,{signal:Ee})).then(pe,ye)}catch(de){ye(de)}}).then(async pe=>{let ye=pe;l.transform&&(ye=await l.transform(pe)),l.pick&&(ye=DW(ye,l.pick)),e.payload.data[i]=ye,F.data.value=ye,F.error.value=void 0,F.status.value="success"}).catch(pe=>{if(e._asyncDataPromises[i]&&e._asyncDataPromises[i]!==ie||F._abortController?.signal.aborted)return e._asyncDataPromises[i];if(typeof DOMException<"u"&&pe instanceof DOMException&&pe.name==="AbortError")return F.status.value="idle",e._asyncDataPromises[i];F.error.value=i0(pe),F.data.value=ut(l.default()),F.status.value="error"}).finally(()=>{se.abort(),delete e._asyncDataPromises[i]});return e._asyncDataPromises[i]=ie,e._asyncDataPromises[i]},_execute:CW((...$)=>F.execute(...$),0,{leading:!0}),_default:l.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{O(),e._asyncData[i]?._init&&(e._asyncData[i]._init=!1),_||Da(()=>{e._asyncData[i]?._init||(E4(e,i),F.execute=()=>Promise.resolve())})}};return F}const LW=()=>{},I4=(e,i,s)=>{if(i.isHydrating)return i.payload.data[e];if(s.cause!=="refresh:manual"&&s.cause!=="refresh:hook")return i.static.data[e]};function RW(e,i,s){const l=e.filter(b=>!!b);if(typeof s=="number"&&s>=0){const b=AbortSignal.timeout?.(s);b&&l.push(b)}if(AbortSignal.any)return AbortSignal.any(l);const p=new AbortController;for(const b of l)if(b.aborted){const t=b.reason??new DOMException("Aborted","AbortError");try{p.abort(t)}catch{p.abort()}return p.signal}const _=()=>{const t=l.find(P=>P.aborted)?.reason??new DOMException("Aborted","AbortError");try{p.abort(t)}catch{p.abort()}};for(const b of l)b.addEventListener?.("abort",_,{once:!0,signal:i});return p.signal}const zW="$s";function X_(...e){const i=typeof e[e.length-1]=="string"?e.pop():void 0;typeof e[0]!="string"&&e.unshift(i);const[s,l]=e;if(!s||typeof s!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+s);if(l!==void 0&&typeof l!="function")throw new Error("[nuxt] [useState] init must be a function: "+l);const p=zW+s,_=Vs(),b=Nc(_.payload.state,p);if(b.value===void 0&&l){const t=l();if(Wo(t))return _.payload.state[p]=t,t;b.value=t}return b}function qR(){return globalThis.$fetch}function C4(e,i,s){const[l={},p]=typeof i=="string"?[{},i]:[i,s],_=Ei(()=>Rr(e)),b=Ei(()=>Rr(l.key)||"$f"+Mx([p,typeof _.value=="string"?_.value:"",...OW(l)]));if(!l.baseURL&&typeof _.value=="string"&&_.value[0]==="/"&&_.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:t,lazy:P,default:O,transform:F,pick:$,watch:W,immediate:Y,getCachedData:ae,deep:se,dedupe:ie,timeout:pe,...ye}=l,de=Ol({...yG,...ye,cache:typeof l.cache=="boolean"?void 0:l.cache}),Ee={server:t,lazy:P,default:O,transform:F,pick:$,immediate:Y,getCachedData:ae,deep:se,dedupe:ie,timeout:pe,watch:W===!1?[]:[...W||[],de]};return MW(W===!1?b.value:b,(Ze,{signal:We})=>(l.$fetch||globalThis.$fetch)(_.value,{signal:We,...de}),Ee)}function OW(e){const i=[Rr(e.method)?.toUpperCase()||"GET",Rr(e.baseURL)];for(const s of[e.query||e.params]){const l=Rr(s);if(!l)continue;const p={};for(const[_,b]of Object.entries(l))p[Rr(_)]=Rr(b);i.push(p)}if(e.body){const s=Rr(e.body);if(!s)i.push(Mx(s));else if(s instanceof ArrayBuffer)i.push(Mx(Object.fromEntries([...new Uint8Array(s).entries()].map(([l,p])=>[l,p.toString()]))));else if(s instanceof FormData){const l={};for(const p of s.entries()){const[_,b]=p;l[_]=b instanceof File?b.name:b}i.push(Mx(l))}else if(XP(s))i.push(Mx(Ol(s)));else try{i.push(Mx(s))}catch{console.warn("[useFetch] Failed to hash body",s)}}return i}function A4(e,i){if(typeof e!="string")throw new TypeError("argument str must be a string");const s={},l=i||{},p=l.decode||FW;let _=0;for(;_<e.length;){const b=e.indexOf("=",_);if(b===-1)break;let t=e.indexOf(";",_);if(t===-1)t=e.length;else if(t<b){_=e.lastIndexOf(";",b-1)+1;continue}const P=e.slice(_,b).trim();if(l?.filter&&!l?.filter(P)){_=t+1;continue}if(s[P]===void 0){let O=e.slice(b+1,t).trim();O.codePointAt(0)===34&&(O=O.slice(1,-1)),s[P]=BW(O,p)}_=t+1}return s}function FW(e){return e.includes("%")?decodeURIComponent(e):e}function BW(e,i){try{return i(e)}catch{return e}}const HT=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function HR(e,i,s){const l=s||{},p=l.encode||encodeURIComponent;if(typeof p!="function")throw new TypeError("option encode is invalid");if(!HT.test(e))throw new TypeError("argument name is invalid");const _=p(i);if(_&&!HT.test(_))throw new TypeError("argument val is invalid");let b=e+"="+_;if(l.maxAge!==void 0&&l.maxAge!==null){const t=l.maxAge-0;if(Number.isNaN(t)||!Number.isFinite(t))throw new TypeError("option maxAge is invalid");b+="; Max-Age="+Math.floor(t)}if(l.domain){if(!HT.test(l.domain))throw new TypeError("option domain is invalid");b+="; Domain="+l.domain}if(l.path){if(!HT.test(l.path))throw new TypeError("option path is invalid");b+="; Path="+l.path}if(l.expires){if(!NW(l.expires)||Number.isNaN(l.expires.valueOf()))throw new TypeError("option expires is invalid");b+="; Expires="+l.expires.toUTCString()}if(l.httpOnly&&(b+="; HttpOnly"),l.secure&&(b+="; Secure"),l.priority)switch(typeof l.priority=="string"?l.priority.toLowerCase():l.priority){case"low":{b+="; Priority=Low";break}case"medium":{b+="; Priority=Medium";break}case"high":{b+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(l.sameSite)switch(typeof l.sameSite=="string"?l.sameSite.toLowerCase():l.sameSite){case!0:{b+="; SameSite=Strict";break}case"lax":{b+="; SameSite=Lax";break}case"strict":{b+="; SameSite=Strict";break}case"none":{b+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return l.partitioned&&(b+="; Partitioned"),b}function NW(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function _m(e){if(typeof e!="object")return e;var i,s,l=Object.prototype.toString.call(e);if(l==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){s=new e.constructor;for(i in e)e.hasOwnProperty(i)&&s[i]!==e[i]&&(s[i]=_m(e[i]))}else{s={};for(i in e)i==="__proto__"?Object.defineProperty(s,i,{value:_m(e[i]),configurable:!0,enumerable:!0,writable:!0}):s[i]=_m(e[i])}return s}if(l==="[object Array]"){for(i=e.length,s=Array(i);i--;)s[i]=_m(e[i]);return s}return l==="[object Set]"?(s=new Set,e.forEach(function(p){s.add(_m(p))}),s):l==="[object Map]"?(s=new Map,e.forEach(function(p,_){s.set(_m(_),_m(p))}),s):l==="[object Date]"?new Date(+e):l==="[object RegExp]"?(s=new RegExp(e.source,e.flags),s.lastIndex=e.lastIndex,s):l==="[object DataView]"?new e.constructor(_m(e.buffer)):l==="[object ArrayBuffer]"?e.slice(0):l.slice(-6)==="Array]"?new e.constructor(e):e}const VW={path:"/",watch:!0,decode:e=>kw(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))},WT=globalThis.cookieStore;function jW(e,i){const s={...VW,...i};s.filter??=O=>O===e;const l=WR(s)||{};let p;s.maxAge!==void 0?p=s.maxAge*1e3:s.expires&&(p=s.expires.getTime()-Date.now());const _=p!==void 0&&p<=0,b=_||l[e]===void 0||l[e]===null,t=_m(_?void 0:l[e]??s.default?.()),P=p&&!_?GW(t,p,s.watch&&s.watch!=="shallow"):an(t);{let O=null;try{!WT&&typeof BroadcastChannel<"u"&&(O=new BroadcastChannel(`nuxt:cookies:${e}`))}catch{}const F=(ae=!1)=>{!ae&&(s.readonly||QE(P.value,l[e]))||($W(e,P.value,s),l[e]=_m(P.value),O?.postMessage({value:s.encode(P.value)}))},$=ae=>{const se=ae.refresh?WR(s)?.[e]:s.decode(ae.value);W=!0,P.value=se,l[e]=_m(se),Da(()=>{W=!1})};let W=!1;const Y=!!Rp();if(Y&&H_(()=>{W=!0,F(),O?.close()}),WT){const ae=se=>{const ie=se.changed.find(ye=>ye.name===e),pe=se.deleted.find(ye=>ye.name===e);ie&&$({value:ie.value}),pe&&$({value:null})};WT.addEventListener("change",ae),Y&&H_(()=>WT.removeEventListener("change",ae))}else O&&(O.onmessage=({data:ae})=>$(ae));s.watch&&Qn(P,()=>{W||F()},{deep:s.watch!=="shallow"}),b&&F(b)}return P}function WR(e={}){return A4(document.cookie,e)}function UW(e,i,s={}){return i==null?HR(e,i,{...s,maxAge:-1}):HR(e,i,s)}function $W(e,i,s={}){document.cookie=UW(e,i,s)}const ZR=2147483647;function GW(e,i,s){let l,p,_=0;const b=s?an(e):{value:e};return Rp()&&H_(()=>{p?.(),clearTimeout(l)}),cb((t,P)=>{s&&(p=Qn(b,P));function O(){_=0,clearTimeout(l);const F=i-_,$=F<ZR?F:ZR;l=setTimeout(()=>{if(_+=$,_<i)return O();b.value=void 0,P()},$)}return{get(){return t(),b.value},set(F){O(),b.value=F,P()}}})}function qW(e){if(e?.__asyncLoader&&!e.__asyncResolved)return e.__asyncLoader()}async function P4(e,i=nu()){const{path:s,matched:l}=i.resolve(e);if(!l.length||(i._routePreloaded||=new Set,i._routePreloaded.has(s)))return;const p=i._preloadPromises||=[];if(p.length>4)return Promise.all(p).then(()=>P4(e,i));i._routePreloaded.add(s);for(const _ of l){const b=_.components?.default;if(typeof b!="function")continue;const t=Promise.resolve(b()).catch(()=>{}).finally(()=>p.splice(p.indexOf(t)));p.push(t)}await Promise.all(p)}function HW(e={}){const i=e.path||window.location.pathname;let s={};try{s=kw(sessionStorage.getItem("nuxt:reload")||"{}")}catch{}if(e.force||s?.path!==i||s?.expires<Date.now()){try{sessionStorage.setItem("nuxt:reload",JSON.stringify({path:i,expires:Date.now()+(e.ttl??1e4)}))}catch{}if(e.persistState)try{sessionStorage.setItem("nuxt:reload:state",JSON.stringify({state:Vs().payload.state}))}catch{}window.location.pathname!==i?window.location.href=i:window.location.reload()}}function M4(e){return new URL(globalThis.location.href)}const WW=(...e)=>e.find(i=>i!==void 0);function ZW(e){const i=e.componentName||"NuxtLink";function s(_){return!ZA&&typeof _=="string"&&_.startsWith("#")}function l(_,b,t){const P=t??e.trailingSlash;if(!_||P!=="append"&&P!=="remove")return _;if(typeof _=="string")return ZT(_,P);const O="path"in _&&_.path!==void 0?_.path:b(_).path;return{..._,name:void 0,path:ZT(O,P)}}function p(_){const b=nu(),t=jf(),P=Ei(()=>!!_.target&&_.target!=="_self"),O=Ei(()=>{const ie=_.to||_.href||"";return typeof ie=="string"&&ud(ie,{acceptRelative:!0})}),F=LL("RouterLink"),$=F&&typeof F!="string"?F.useLink:void 0,W=Ei(()=>{if(_.external)return!0;const ie=_.to||_.href||"";return typeof ie=="object"?!1:ie===""||O.value}),Y=Ei(()=>{const ie=_.to||_.href||"";return W.value?ie:l(ie,b.resolve,_.trailingSlash)}),ae=W.value?void 0:$?.({..._,to:Y}),se=Ei(()=>{const ie=_.trailingSlash??e.trailingSlash;if(!Y.value||O.value||s(Y.value))return Y.value;if(W.value){const pe=typeof Y.value=="object"&&"path"in Y.value?NA(Y.value):Y.value,ye=typeof pe=="object"?b.resolve(pe).href:pe;return ZT(ye,ie)}return typeof Y.value=="object"?b.resolve(Y.value)?.href??null:ZT(Am(t.app.baseURL,Y.value),ie)});return{to:Y,hasTarget:P,isAbsoluteUrl:O,isExternal:W,href:se,isActive:ae?.isActive??Ei(()=>Y.value===b.currentRoute.value.path),isExactActive:ae?.isExactActive??Ei(()=>Y.value===b.currentRoute.value.path),route:ae?.route??Ei(()=>b.resolve(Y.value)),async navigate(ie){await UB(se.value,{replace:_.replace,external:W.value||P.value})}}}return kr({name:i,props:{to:{type:[String,Object],default:void 0,required:!1},href:{type:[String,Object],default:void 0,required:!1},target:{type:String,default:void 0,required:!1},rel:{type:String,default:void 0,required:!1},noRel:{type:Boolean,default:void 0,required:!1},prefetch:{type:Boolean,default:void 0,required:!1},prefetchOn:{type:[String,Object],default:void 0,required:!1},noPrefetch:{type:Boolean,default:void 0,required:!1},activeClass:{type:String,default:void 0,required:!1},exactActiveClass:{type:String,default:void 0,required:!1},prefetchedClass:{type:String,default:void 0,required:!1},replace:{type:Boolean,default:void 0,required:!1},ariaCurrentValue:{type:String,default:void 0,required:!1},external:{type:Boolean,default:void 0,required:!1},custom:{type:Boolean,default:void 0,required:!1},trailingSlash:{type:String,default:void 0,required:!1}},useLink:p,setup(_,{slots:b}){const t=nu(),{to:P,href:O,navigate:F,isExternal:$,hasTarget:W,isAbsoluteUrl:Y}=p(_),ae=so(!1),se=an(null),ie=de=>{se.value=_.custom?de?.$el?.nextElementSibling:de?.$el};function pe(de){return!ae.value&&(typeof _.prefetchOn=="string"?_.prefetchOn===de:_.prefetchOn?.[de]??e.prefetchOn?.[de])&&(_.prefetch??e.prefetch)!==!1&&_.noPrefetch!==!0&&_.target!=="_blank"&&!JW()}async function ye(de=Vs()){if(ae.value)return;ae.value=!0;const Ee=typeof P.value=="string"?P.value:$.value?NA(P.value):t.resolve(P.value).fullPath,Pe=$.value?new URL(Ee,window.location.href).href:Ee;await Promise.all([de.hooks.callHook("link:prefetch",Pe).catch(()=>{}),!$.value&&!W.value&&P4(P.value,t).catch(()=>{})])}if(pe("visibility")){const de=Vs();let Ee,Pe=null;La(()=>{const Ze=YW();eI(()=>{Ee=YA(()=>{se?.value?.tagName&&(Pe=Ze.observe(se.value,async()=>{Pe?.(),Pe=null,await ye(de)}))})})}),Vf(()=>{Ee&&PW(Ee),Pe?.(),Pe=null})}return()=>{if(!$.value&&!W.value&&!s(P.value)){const Pe={ref:ie,to:P.value,activeClass:_.activeClass||e.activeClass,exactActiveClass:_.exactActiveClass||e.exactActiveClass,replace:_.replace,ariaCurrentValue:_.ariaCurrentValue,custom:_.custom};return _.custom||(pe("interaction")&&(Pe.onPointerenter=ye.bind(null,void 0),Pe.onFocus=ye.bind(null,void 0)),ae.value&&(Pe.class=_.prefetchedClass||e.prefetchedClass),Pe.rel=_.rel||void 0),Ns(LL("RouterLink"),Pe,b.default)}const de=_.target||null,Ee=WW(_.noRel?"":_.rel,e.externalRelAttribute,Y.value||W.value?"noopener noreferrer":"")||null;return _.custom?b.default?b.default({href:O.value,navigate:F,prefetch:ye,get route(){if(!O.value)return;const Pe=new URL(O.value,window.location.href);return{path:Pe.pathname,fullPath:Pe.pathname,get query(){return XE(Pe.search)},hash:Pe.hash,params:{},name:void 0,matched:[],redirectedFrom:void 0,meta:{},href:O.value}},rel:Ee,target:de,isExternal:$.value||W.value,isActive:!1,isExactActive:!1}):null:Ns("a",{ref:se,href:O.value||null,rel:Ee,target:de,onClick:Pe=>{if(!($.value||W.value))return Pe.preventDefault(),_.replace?t.replace(O.value):t.push(O.value)}},b.default?.())}}})}const XW=ZW(gG);function ZT(e,i){const s=i==="append"?AB:Kx;return ud(e)&&!e.startsWith("http")?e:s(e,!0)}function YW(){const e=Vs();if(e._observer)return e._observer;let i=null;const s=new Map,l=(_,b)=>(i||=new IntersectionObserver(t=>{for(const P of t){const O=s.get(P.target);(P.isIntersecting||P.intersectionRatio>0)&&O&&O()}}),s.set(_,b),i.observe(_),()=>{s.delete(_),i?.unobserve(_),s.size===0&&(i?.disconnect(),i=null)});return e._observer={observe:l}}const KW=/2g/;function JW(){const e=navigator.connection;return!!(e&&(e.saveData||KW.test(e.effectiveType)))}const QW={ui:{colors:{primary:"pink",secondary:"purple",neutral:"neutral",info:"sky",success:"emerald",warning:"amber",danger:"rose"},button:{slots:{base:"cursor-pointer"}},popover:{slots:{content:"bg-white/70 dark:bg-neutral-900/50 backdrop-blur-3xl ring-0 shadow-lg border border-neutral-300/50 dark:border-neutral-500/50 rounded-lg"}},card:{slots:{header:"font-semibold"},variants:{variant:{glassmorphism:{root:"shadow-lg divide-y-0 divide-neutral-300/50 dark:divide-neutral-500/50",header:"p-2 sm:p-2 pb-0!",body:"p-2 sm:p-2",footer:"p-2 sm:p-2"}}}},formField:{slots:{label:"mb-1",help:"mt-0.5"}}}},eZ={nuxt:{},ui:{colors:{primary:"green",secondary:"blue",success:"green",info:"blue",warning:"yellow",error:"red",neutral:"slate"},icons:{arrowDown:"i-lucide-arrow-down",arrowLeft:"i-lucide-arrow-left",arrowRight:"i-lucide-arrow-right",arrowUp:"i-lucide-arrow-up",caution:"i-lucide-circle-alert",check:"i-lucide-check",chevronDoubleLeft:"i-lucide-chevrons-left",chevronDoubleRight:"i-lucide-chevrons-right",chevronDown:"i-lucide-chevron-down",chevronLeft:"i-lucide-chevron-left",chevronRight:"i-lucide-chevron-right",chevronUp:"i-lucide-chevron-up",close:"i-lucide-x",copy:"i-lucide-copy",copyCheck:"i-lucide-copy-check",dark:"i-lucide-moon",drag:"i-lucide-grip-vertical",ellipsis:"i-lucide-ellipsis",error:"i-lucide-circle-x",external:"i-lucide-arrow-up-right",eye:"i-lucide-eye",eyeOff:"i-lucide-eye-off",file:"i-lucide-file",folder:"i-lucide-folder",folderOpen:"i-lucide-folder-open",hash:"i-lucide-hash",info:"i-lucide-info",light:"i-lucide-sun",loading:"i-lucide-loader-circle",menu:"i-lucide-menu",minus:"i-lucide-minus",panelClose:"i-lucide-panel-left-close",panelOpen:"i-lucide-panel-left-open",plus:"i-lucide-plus",reload:"i-lucide-rotate-ccw",search:"i-lucide-search",stop:"i-lucide-square",success:"i-lucide-circle-check",system:"i-lucide-monitor",tip:"i-lucide-lightbulb",upload:"i-lucide-upload",warning:"i-lucide-triangle-alert"},tv:{twMergeConfig:{}}},icon:{provider:"server",class:"",aliases:{},iconifyApiEndpoint:"https://api.iconify.design",localApiEndpoint:"/api/_nuxt_icon",fallbackToApi:!0,cssSelectorPrefix:"i-",cssWherePseudo:!0,cssLayer:"components",mode:"css",attrs:{"aria-hidden":!0},collections:["academicons","akar-icons","ant-design","arcticons","basil","bi","bitcoin-icons","bpmn","brandico","bx","bxl","bxs","bytesize","carbon","catppuccin","cbi","charm","ci","cib","cif","cil","circle-flags","circum","clarity","codicon","covid","cryptocurrency","cryptocurrency-color","dashicons","devicon","devicon-plain","ei","el","emojione","emojione-monotone","emojione-v1","entypo","entypo-social","eos-icons","ep","et","eva","f7","fa","fa-brands","fa-regular","fa-solid","fa6-brands","fa6-regular","fa6-solid","fad","fe","feather","file-icons","flag","flagpack","flat-color-icons","flat-ui","flowbite","fluent","fluent-emoji","fluent-emoji-flat","fluent-emoji-high-contrast","fluent-mdl2","fontelico","fontisto","formkit","foundation","fxemoji","gala","game-icons","geo","gg","gis","gravity-ui","gridicons","grommet-icons","guidance","healthicons","heroicons","heroicons-outline","heroicons-solid","hugeicons","humbleicons","ic","icomoon-free","icon-park","icon-park-outline","icon-park-solid","icon-park-twotone","iconamoon","iconoir","icons8","il","ion","iwwa","jam","la","lets-icons","line-md","logos","ls","lucide","lucide-lab","mage","majesticons","maki","map","marketeq","material-symbols","material-symbols-light","mdi","mdi-light","medical-icon","memory","meteocons","mi","mingcute","mono-icons","mynaui","nimbus","nonicons","noto","noto-v1","octicon","oi","ooui","openmoji","oui","pajamas","pepicons","pepicons-pencil","pepicons-pop","pepicons-print","ph","pixelarticons","prime","ps","quill","radix-icons","raphael","ri","rivet-icons","si-glyph","simple-icons","simple-line-icons","skill-icons","solar","streamline","streamline-emojis","subway","svg-spinners","system-uicons","tabler","tdesign","teenyicons","token","token-branded","topcoat","twemoji","typcn","uil","uim","uis","uit","uiw","unjs","vaadin","vs","vscode-icons","websymbol","weui","whh","wi","wpf","zmdi","zondicons"],fetchTimeout:1500},_MAPBOX_CONFIG:{accessToken:""}},k4=MG(QW,eZ);function hd(){const e=Vs();return e._appConfig||=Ol(k4),e._appConfig}function tZ(e){typeof e.indexable<"u"&&(e.indexable=String(e.indexable)!=="false"),typeof e.trailingSlash<"u"&&!e.trailingSlash&&(e.trailingSlash=String(e.trailingSlash)!=="false"),e.url&&!ud(String(e.url),{acceptRelative:!0,strict:!1})&&(e.url=O9(String(e.url)));const i=Object.keys(e).sort((l,p)=>l.localeCompare(p)),s={};for(const l of i)s[l]=e[l];return s}function iZ(e){const s=[];function l(_){if(!_||typeof _!="object"||Object.keys(_).length===0)return()=>{};_._context;const b={};for(const P in _){const O=_[P];typeof O<"u"&&O!==""&&(b[P]=O)}let t;return Object.keys(b).filter(P=>!P.startsWith("_")).length>0&&(t=s.push(b)),()=>{typeof t<"u"&&s.splice(t-1,1)}}function p(_){const b={};_?.debug&&(b._context={}),b._priority={};for(const t in s.sort((P,O)=>(P._priority||0)-(O._priority||0)))for(const P in s[t]){const O=P,F=_?.resolveRefs?Rr(s[t][P]):s[t][P];!P.startsWith("_")&&typeof F<"u"&&F!==""&&(b[P]=F,typeof s[t]._priority<"u"&&s[t]._priority!==-1&&(b._priority[O]=s[t]._priority),_?.debug&&(b._context[O]=s[t]._context?.[O]||s[t]._context||"anonymous"))}return _?.skipNormalize?b:tZ(b)}return{stack:s,push:l,get:p}}const nZ=ol({name:"nuxt-site-config:init",enforce:"pre",async setup(e){const i=iZ(),s=X_("site-config");{const l=s.value||window.__NUXT_SITE_CONFIG__||{};for(const p in l)p[0]!=="_"&&i.push({[p]:l[p],_priority:l._priority?.[p]||-1})}return{provide:{nuxtSiteConfig:i}}}}),rZ=ol({name:"nuxt:payload",setup(e){const i=new Set;nu().beforeResolve(async(s,l)=>{if(s.path===l.path)return;const p=await TR(s.path);if(p){for(const _ of i)delete e.static.data[_];for(const _ in p.data)_ in e.static.data||i.add(_),e.static.data[_]=p.data[_]}}),eI(()=>{e.hooks.hook("link:prefetch",async s=>{const{hostname:l}=new URL(s,window.location.href);l===window.location.hostname&&await TR(s).catch(()=>{console.warn("[nuxt] Error preloading payload for",s)})}),navigator.connection?.effectiveType!=="slow-2g"&&setTimeout(YE,1e3)})}}),sZ=ol(()=>{const e=nu();eI(()=>{e.beforeResolve(async()=>{await new Promise(i=>{setTimeout(i,100),requestAnimationFrame(()=>{setTimeout(i,0)})})})})}),oZ=ol(e=>{let i;async function s(){let l;try{l=await YE()}catch(p){const _=p;if(!("status"in _&&(_.status===404||_.status===403)))throw _}i&&clearTimeout(i),i=setTimeout(s,hR);try{const p=await $fetch(fM("builds/latest.json")+`?${Date.now()}`);p.id!==l?.id&&(e.hooks.callHook("app:manifest:update",p),i&&clearTimeout(i))}catch{}}eI(()=>{i=setTimeout(s,hR)})}),aZ=ol({name:"nuxt:chunk-reload",setup(e){const i=nu(),s=jf(),l=new Set;i.beforeEach(()=>{l.clear()}),e.hook("app:chunkError",({error:_})=>{l.add(_)});function p(_){const b=Am(s.app.baseURL,_.fullPath);HW({path:b,persistState:!0})}e.hook("app:manifest:update",()=>{i.beforeResolve(p)}),i.onError((_,b)=>{l.has(_)&&p(b)})}}),lZ=ol({name:"pinia",setup(e){const i=FG();return e.vueApp.use(i),Qx(i),e.payload&&e.payload.pinia&&(i.state.value=e.payload.pinia),{provide:{pinia:i}}},hooks:{"app:rendered"(){const e=Vs();e.payload.pinia=zo(e.$pinia).state.value,Qx(void 0)}}}),cZ=Ux(()=>va(()=>Promise.resolve().then(()=>Tte),void 0,import.meta.url).then(e=>e.default||e.default||e)),uZ=[["Icon",cZ]],hZ=ol({name:"nuxt:global-components",setup(e){for(const[i,s]of uZ)e.vueApp.component(i,s),e.vueApp.component("Lazy"+i,s)}}),Qy={dashboard:Ux(()=>va(()=>import("./fhyz3SjZ.js"),__vite__mapDeps([69,19,21,52,59,14,1,26,23,24,25,54,37,15,13,50]),import.meta.url).then(e=>e.default||e)),masonry:Ux(()=>va(()=>import("./CdOLjBaA.js"),__vite__mapDeps([70,13,14,1,15,57,6,58,21,54,37,53,11,35,59,26,23,24,25,46,47,71]),import.meta.url).then(e=>e.default||e)),onboarding:Ux(()=>va(()=>import("./GOWfq_GG.js"),[],import.meta.url).then(e=>e.default||e))},dZ=ol({name:"nuxt:prefetch",setup(e){const i=nu();e.hooks.hook("app:mounted",()=>{i.beforeEach(async s=>{const l=s?.meta?.layout;l&&typeof Qy[l]=="function"&&await Qy[l]()})}),e.hooks.hook("link:prefetch",s=>{if(ud(s))return;const l=i.resolve(s);if(!l)return;const p=l.meta.layout;let _=bM(l.meta.middleware);_=_.filter(b=>typeof b=="string");for(const b of _)typeof XA[b]=="function"&&XA[b]();typeof p=="string"&&p in Qy&&qW(Qy[p])})}});function IS(...e){window.dataLayer?.push(arguments)}function D4({tags:e}){window.dataLayer=window.dataLayer||[];for(const i of e)for(const s of i.initCommands??[])IS(...s);IS("js",new Date);for(const i of e)IS("config",i.id,i.config??{})}function L4(e){const i=zo(e),s=i.tags.filter(Boolean).map(l=>typeof l=="string"?{id:l}:l);if(i.id){const{id:l,config:p,initCommands:_}=i;s.unshift({id:l,config:p,initCommands:_})}return s}const fZ=ol({parallel:!0,setup(){const e=jf().public.gtag,i=L4(e);if(!i.length||(D4({tags:i}),e.initMode==="manual"))return;const s=e.loadingStrategy==="async"?"async":"defer";hb({link:[{rel:"preload",as:"script",href:pv(e.url,{id:i[0]?.id})}],script:[{src:pv(e.url,{id:i[0]?.id}),[s]:!0,"data-gtag":""}]})}}),pZ=["i18n:plugin","i18n:plugin:ssg-detect","i18n:plugin:route-locale-detect"],mZ=ol({name:"nuxt-site-config:i18n",dependsOn:pZ,setup(e){const i=e.$i18n;if(!i)return;const s=Vs().$nuxtSiteConfig,l=Rr(i.baseUrl);if(l){const _=s.get({resolveRefs:!0}),b=_.url;if(b&&!b.includes("localhost")){const t=Jx(l,"https://"),P=Jx(b,"https://");t.host!==P.host&&_.env==="production"&&console.error(`[Nuxt Site Config] Your I18n baseUrl \`${t.host}\` doesn't match your site url ${P.host}. This will cause production SEO issues. Either provide a matching baseUrl or remove the site url config.`)}}let p;Qn(i.locale,()=>{p&&p();const _=Ei(()=>{const b=Rr(i.locales).find(t=>t.code===i.defaultLocale);return b?.language||b?.iso||i.defaultLocale});p=s.push({_priority:-1,_context:"@nuxtjs/i18n",url:Ei(()=>Rr(i.baseUrl)||void 0),defaultLocale:_,currentLocale:Ei(()=>{const b=Rr(i.localeProperties);return b.language?b.language:_.value}),description:Ei(()=>i.te("nuxtSiteConfig.description")?i.t("nuxtSiteConfig.description"):void 0),name:Ei(()=>i.te("nuxtSiteConfig.name")?i.t("nuxtSiteConfig.name"):void 0)})},{immediate:!0})}});function gZ(e,i){typeof console<"u"&&(console.warn("[intlify] "+e),i&&console.warn(i.stack))}const pE=typeof window<"u",l0=(e,i=!1)=>i?Symbol.for(e):Symbol(e),_Z=(e,i,s)=>yZ({l:e,k:i,s}),yZ=e=>JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),Bc=e=>typeof e=="number"&&isFinite(e),vZ=e=>iI(e)==="[object Date]",mE=e=>iI(e)==="[object RegExp]",tI=e=>Qo(e)&&Object.keys(e).length===0,xc=Object.assign,xZ=Object.create,ka=(e=null)=>xZ(e);function XR(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;").replace(/=/g,"&#x3D;")}function YR(e){return e.replace(/&(?![a-zA-Z0-9#]{2,6};)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function bZ(e){return e=e.replace(/(\w+)\s*=\s*"([^"]*)"/g,(l,p,_)=>`${p}="${YR(_)}"`),e=e.replace(/(\w+)\s*=\s*'([^']*)'/g,(l,p,_)=>`${p}='${YR(_)}'`),/\s*on\w+\s*=\s*["']?[^"'>]+["']?/gi.test(e)&&(e=e.replace(/(\s+)(on)(\w+\s*=)/gi,"$1&#111;n$3")),[/(\s+(?:href|src|action|formaction)\s*=\s*["']?)\s*javascript:/gi,/(style\s*=\s*["'][^"']*url\s*\(\s*)javascript:/gi].forEach(l=>{e=e.replace(l,"$1javascript&#58;")}),e}const wZ=Object.prototype.hasOwnProperty;function xm(e,i){return wZ.call(e,i)}const cc=Array.isArray,pl=e=>typeof e=="function",Fr=e=>typeof e=="string",ql=e=>typeof e=="boolean",xa=e=>e!==null&&typeof e=="object",TZ=e=>xa(e)&&pl(e.then)&&pl(e.catch),R4=Object.prototype.toString,iI=e=>R4.call(e),Qo=e=>iI(e)==="[object Object]",SZ=e=>e==null?"":cc(e)||Qo(e)&&e.toString===R4?JSON.stringify(e,null,2):String(e);function wM(e,i=""){return e.reduce((s,l,p)=>p===0?s+l:s+i+l,"")}const XT=e=>!xa(e)||cc(e);function Gx(e,i){if(XT(e)||XT(i))throw new Error("Invalid value");const s=[{src:e,des:i}];for(;s.length;){const{src:l,des:p}=s.pop();Object.keys(l).forEach(_=>{_!=="__proto__"&&(xa(l[_])&&!xa(p[_])&&(p[_]=Array.isArray(l[_])?[]:ka()),XT(p[_])||XT(l[_])?p[_]=l[_]:s.push({src:l[_],des:p[_]}))})}}function EZ(e,i=e.getCurrentLanguage(),s=e.getCurrentDirection()){const l={htmlAttrs:{},link:[],meta:[]};if(e.dir&&(l.htmlAttrs.dir=s),e.lang&&i&&(l.htmlAttrs.lang=i),e.seo){const p=CZ(e);l.link=l.link.concat(p,PZ(e)),l.meta=l.meta.concat(MZ(e),kZ(e),DZ(e,e.locales.map(_=>_.language||_.code)))}return l}function IZ(e){const i=new Map;for(const s of e){if(!s.language){console.warn("Locale `language` ISO code is required to generate alternate link");continue}const[l,p]=s.language.split("-");l&&p&&(s.isCatchallLocale||!i.has(l))&&i.set(l,s),i.set(s.language,s)}return i}function CZ(e){if(!e.hreflangLinks)return[];const i=[],s=IZ(e.locales);for(const[l,p]of s.entries()){const _=AZ(l,p,e);_&&(i.push(_),e.defaultLocale&&e.defaultLocale===p.code&&i[0].hreflang!=="x-default"&&i.unshift({[e.key]:"i18n-xd",rel:"alternate",href:_.href,hreflang:"x-default"}))}return i}function AZ(e,i,s,l=s.strictCanonicals?s.getRouteWithoutQuery():void 0){const p=s.getLocalizedRoute(i.code,l);if(!p)return;const _=pv(ud(p)?p:Am(s.baseUrl,p),s.strictCanonicals?O4(s):{});return{[s.key]:`i18n-alt-${e}`,rel:"alternate",href:_,hreflang:e}}function z4(e,i=e.getCurrentRoute()){const s=e.getLocaleRoute(Object.assign({},i,{path:void 0,name:e.getRouteBaseName(i)}));return s?pv(Am(e.baseUrl,s.path),O4(e)):""}function PZ(e,i=z4(e)){return i?[{[e.key]:"i18n-can",rel:"canonical",href:i}]:[]}function O4(e,i=e.getCurrentRoute()){const l=e.getLocaleRoute(Object.assign({},i,{path:void 0,name:e.getRouteBaseName(i)}))?.query??{},p={};for(const _ of e.canonicalQueries.filter(b=>b in l)){p[_]??=[];for(const b of LZ(l[_]))p[_].push(b||"")}return p}function MZ(e,i=z4(e)){return i?[{[e.key]:"i18n-og-url",property:"og:url",content:i}]:[]}function kZ(e,i=e.getCurrentLanguage()){return i?[{[e.key]:"i18n-og",property:"og:locale",content:F4(i)}]:[]}function DZ(e,i,s=e.getCurrentLanguage()){return i.filter(p=>p&&p!==s).map(p=>({[e.key]:`i18n-og-alt-${p}`,property:"og:locale:alternate",content:F4(p)}))}function F4(e=""){return e.replace(/-/g,"_")}function LZ(e){return Array.isArray(e)?e:[e]}function B4(e,i,s=e.getLocale()){if(Fr(i)&&ud(i,{acceptRelative:!0}))return i;try{return V4(e,i,s).fullPath}catch{return""}}function N4(e,i,s=e.getLocale()){try{return V4(e,i,s)}catch{return}}function RZ(e){if(!Fr(e))return xc({},e);if(e[0]==="/"){const{pathname:i,search:s,hash:l}=RA(e);return{path:i,query:XE(s),hash:l}}return{name:e}}function V4(e,i,s){const l=RZ(i),p=e.router.resolve(e.resolveLocalizedRouteObject(l,s));return p.name?p:e.router.resolve(i)}function j4(e,i,s=e.router.currentRoute.value){const l=e.getRouteBaseName(s);if(!l)return"";const p={name:l,params:xc({},s.params,e.getLocalizedDynamicParams(i)),fullPath:s.fullPath,query:s.query,hash:s.hash,path:s.path,meta:s.meta},_=B4(e,p,i);return e.afterSwitchLocalePath(_,i)}function zZ(e,i,s=e.getLocale(),l=e.getLocales(),p=e.getBaseUrl()){const _=l.find(t=>t.code===s)||{},b=typeof i.seo=="object"&&i.seo?.canonicalQueries||[];return p||console.warn("I18n `baseUrl` is required to generate valid SEO tag links."),{...i,key:"id",locales:l,baseUrl:p,canonicalQueries:b,hreflangLinks:e.routingOptions.hreflangLinks,defaultLocale:e.routingOptions.defaultLocale,strictCanonicals:e.routingOptions.strictCanonicals,getRouteBaseName:e.getRouteBaseName,getCurrentRoute:()=>e.router.currentRoute.value,getCurrentLanguage:()=>_.language,getCurrentDirection:()=>_.dir||"ltr",getLocaleRoute:t=>N4(e,t),getLocalizedRoute:(t,P)=>j4(e,t,P),getRouteWithoutQuery:()=>{try{return xc({},e.router.resolve({query:{}}),{meta:e.router.currentRoute.value.meta})}catch{return}}}}function OZ(e,{dir:i=!0,lang:s=!0,seo:l=!0}){return EZ(zZ(e,{dir:i,lang:s,seo:l}))}function FZ(e=0){return i=>{const p=(typeof i=="string"?i:i.pathname).split("?")[0].split("/");return p[0]===""&&p.shift(),p.length>e&&p[e]||""}}const U4="___";function $4(e){return typeof e=="string"?e:e!=null?e.toString():""}function MC(e){return $4(typeof e=="object"?e?.name:e).split(U4)[0]}const BZ=FZ(0),G4=e=>BZ(e),NZ=e=>e.split(U4).at(1)??"";function VZ(e){return String(typeof e!="object"?e:e?.name||e?.path||"")}function jZ(e){const i=VZ(e);return i[0]==="/"?G4(i):NZ(i)}function UZ(e){return i=>$4(i)}function $Z(e){return i=>i}const Lw=["zh-Hans","zh-Hant-TW","zh-Hant-HK","en","ja"],gE={"zh-Hans":[{key:"locale_zh_45Hans_46json_64a8294e",load:()=>va(()=>import("./CPPfWVL_.js"),[],import.meta.url),cache:!0}],"zh-Hant-TW":[{key:"locale_zh_45Hant_45TW_46json_0939d749",load:()=>va(()=>import("./BwDbl1Gw.js"),[],import.meta.url),cache:!0}],"zh-Hant-HK":[{key:"locale_zh_45Hant_45HK_46json_aa8eae12",load:()=>va(()=>import("./CijV29BG.js"),[],import.meta.url),cache:!0}],en:[{key:"locale_en_46json_838264ce",load:()=>va(()=>import("./B3HTTfzI.js"),[],import.meta.url),cache:!0}],ja:[{key:"locale_ja_46json_7a7620f8",load:()=>va(()=>import("./CMVuyCNH.js"),[],import.meta.url),cache:!0}]},GZ=[()=>va(()=>import("./BeeNI1Ez.js"),[],import.meta.url)],t2=[{code:"zh-Hans",name:"",language:"zh"},{code:"zh-Hant-TW",name:"()",language:"zh-TW"},{code:"zh-Hant-HK",name:"()",language:"zh-HK"},{code:"en",name:"English",language:"en"},{code:"ja",name:"",language:"ja"}],q4=new Map,qZ=pM((e,i,s)=>{if(i==="messages"||i==="datetimeFormats"||i==="numberFormats")return e[i]??=ka(null),Gx(s,e[i]),!0});async function HZ(e){const i=Vs();let s={messages:ka(null)};for(const l of e){const p=await l().then(b=>b.default),_=pl(p)?await i.runWithContext(()=>p()):p;s=qZ(ka(null),_,s)}return s.fallbackLocale??=!1,s}const WZ=e=>iI(e)==="[object Module]",ZZ=e=>WZ(e)||!1;async function XZ(e,i){const s=Vs();try{const l=await s.runWithContext(i.load).then(p=>ZZ(p)?p.default:p);return pl(l)?await s.runWithContext(()=>l(e)):l}catch(l){throw new Error(`Failed loading locale (${e}): `+l.message)}}async function YZ(e,i=[]){const s=Vs(),l={};for(const p of i){const _=KZ(p),b=_||await s.runWithContext(async()=>await XZ(e,p));!_&&p.cache!==!1&&q4.set(p.key,{ttl:Date.now()+86400*1e3,value:b}),Gx(b,l)}return l}function KZ(e){if(e.cache===!1)return;const i=q4.get(e.key);if(i!=null)return i.ttl>Date.now()?i.value:void 0}function TM(e){return e!=null&&"global"in e&&"mode"in e?e.global:e}function YT(e){const i=TM(e);return"__composer"in i?i.__composer:i}function nI(e){return e?e.$config.public.i18n:jf().public.i18n}function rI(e){const i=nI(e).detectBrowserLanguage,s=i||{};return{...s,enabled:!!i,cookieKey:s.cookieKey||"i18n_redirected"}}function JZ(e){if(e)return{path:"/"+(Fr(e)?e:e.path).replace(/^\//,""),code:!Fr(e)&&e.statusCode||302}}function QZ(e){return Array.isArray(e)?e:[e]}function eX(e,i,s){const l=(_="")=>_.replace(/https?:\/\//,""),p=e.filter(_=>l(_.domain)===i||QZ(_.domains).includes(i));return p.length<=1?p[0]?.code:p.find(_=>_.code===s)?.code||p.find(_=>_.defaultForDomains?.includes(i)??_.domainDefault)?.code}function tX(e,i,s){const l=t2.find(_=>_.code===s),p=e?.[s]?.domain||l?.domain||l?.domains?.find(_=>_===i.host);if(p)return ud(p,{strict:!0})?p:i.protocol+"//"+p}function iX(e){const i={};for(const s of Lw){const l=nX(e,[s]),p=rX(s,l);i[s]={fallbacks:l,cacheable:p}}return i}function nX(e,i){if(e===!1)return[];if(cc(e))return e;let s=[];if(Fr(e))return i.every(p=>p!==e)&&s.push(e),s;const l=[...i,"default"];for(const p of l)p in e&&(s=[...s,...e[p].filter(Boolean)]);return s}function KR(e){return gE[e]!=null&&gE[e].every(i=>i.cache!==!1)}function rX(e,i){return KR(e)&&i.every(s=>KR(s))}function sX(e){return t2.find(i=>!!i.defaultForDomains?.includes(e))?.code}const qx=e=>Lw.includes(e||""),JR=e=>qx(e)?e:void 0,H4=()=>X_("i18n:cached-locale-configs",()=>{}),W4=()=>X_("i18n:resolved-locale",()=>"");function oX({cookieCrossOrigin:e,cookieDomain:i,cookieSecure:s,cookieKey:l}){const p=new Date;return jW(l,{path:"/",readonly:!1,expires:new Date(p.setDate(p.getDate()+365)),sameSite:e?"none":"lax",domain:i||void 0,secure:e||s})}function aX(e,i,s){const l=TM(i),p=nI(e),_=rI(e),b=H4(),t=oX(_),P=se=>b.value[se],O=se=>tX(p.domainLocales,M4(),se),F=bX(e,p.baseUrl),$=W4(),W=async se=>{const ie=P(se)?.fallbacks??[];ie.includes(se)||ie.push(se);for(const pe of ie){const ye=await e.runWithContext(()=>YZ(pe,gE[pe]));l.mergeLocaleMessage(pe,ye)}},Y=async se=>{if(!(se in gE))return;const ie=P(se)?.cacheable?{}:{"Cache-Control":"no-cache"},pe=await $fetch(`/_i18n/kF8Cos2X/${se}/messages.json`,{headers:ie});for(const ye of Object.keys(pe))l.mergeLocaleMessage(ye,pe[ye])},ae={vueI18n:i,initial:!0,preloaded:!1,config:p,rootRedirect:JZ(p.rootRedirect),redirectStatusCode:p.redirectStatusCode??302,dynamicResourcesSSG:!1,getDefaultLocale:()=>s,getLocale:()=>ut(l.locale),setLocale:async se=>{const ie=ae.getLocale();se===ie||!qx(se)||(Wo(l.locale)?l.locale.value=se:l.locale=se,await e.callHook("i18n:localeSwitched",{newLocale:se,oldLocale:ie}),$.value=se)},setLocaleSuspend:async se=>{qx(se)&&(ae.vueI18n.__pendingLocale=se,ae.vueI18n.__pendingLocalePromise=new Promise(ie=>{ae.vueI18n.__resolvePendingLocalePromise=async()=>{ae.setCookieLocale(se),await ae.setLocale(se),ae.vueI18n.__pendingLocale=void 0,ie()}}),(e.isHydrating||!ae.config.skipSettingLocaleOnNavigate)&&await ae.vueI18n.__resolvePendingLocalePromise?.())},getLocales:()=>ut(l.locales).map(se=>Fr(se)?{code:se}:se),setCookieLocale:se=>{_.useCookie&&qx(se)&&(t.value=se)},getBaseUrl:se=>Am(se&&O(se)||F(),e.$config.app.baseURL),loadMessages:async se=>{try{return ae.dynamicResourcesSSG?await W(se):await Y(se)}catch(ie){console.warn(`Failed to load messages for locale "${se}"`,ie)}},composableCtx:void 0};return ae.composableCtx=_X(ae,e),ae}function SM(e){if(e._nuxtI18n==null)throw new Error("Nuxt I18n context has not been set up yet.");return e._nuxtI18n}function lX(e,i){const s=[];for(const[l,p]of i.entries()){const _=e.find(b=>b.language?.toLowerCase()===p.toLowerCase());if(_){s.push({code:_.code,score:1-l/i.length});break}}for(const[l,p]of i.entries()){const _=p.split("-")[0].toLowerCase(),b=e.find(t=>t.language?.split("-")[0].toLowerCase()===_);if(b){s.push({code:b.code,score:.999-l/i.length});break}}return s}function cX(e,i){return e.score===i.score?i.code.length-e.code.length:i.score-e.score}function uX(e,i){return lX(e.map(l=>({code:l.code,language:l.language||l.code})),i).sort(cX).at(0)?.code??""}const hX=(e,i)=>{const s=document.cookie;return A4(s)[i]},dX=(e,i)=>jZ(i),fX=e=>uX(t2,navigator.languages),pX=(e,i,s)=>{const l=new URL(window.location.href).host,p=t2.map(_=>({..._,domain:s[_.code]?.domain??_.domain}));return eX(p,l,G4(i))},EM=(e,i,s)=>{const l=nI(s);return{cookie:()=>hX(e,i.cookieKey),header:()=>{},navigator:()=>fX(),host:p=>pX(e,p,l.domainLocales),route:p=>dX(e,p)}},mX=e=>!!e.path&&!e.name;function sI(e){const i=e?._nuxtI18n?.composableCtx;if(!i)throw new Error("i18n context is not initialized. Ensure the i18n plugin is installed and the composable is used within a Vue component or setup function.");return i}const gX=Kx;function _X(e,i=Vs()){const s=nu();EM(void 0,rI(i),i);const l=e.getDefaultLocale(),p=UZ();function _(O,F){O.name||=MC(s.currentRoute.value);const $=p(O.name,F);return s.hasRoute($)&&(O.name=$),O}const b=$Z();function t(O,F){const $=b(O,F),W=MC($);return W?($.name=p(W,F),$):($.path=gX($.path,!0),$)}const P={router:s,head:hb({}),metaState:{htmlAttrs:{},meta:[],link:[]},seoSettings:{dir:!1,lang:!1,seo:!1},localePathPayload:yX(),routingOptions:{defaultLocale:l,strictCanonicals:e.config.experimental.alternateLinkCanonicalQueries??!0,hreflangLinks:!1},getLocale:e.getLocale,getLocales:e.getLocales,getBaseUrl:e.getBaseUrl,getRouteBaseName:MC,getRouteLocalizedParams:()=>s.currentRoute.value.meta.nuxtI18nInternal??{},getLocalizedDynamicParams:O=>P.getRouteLocalizedParams()?.[O],afterSwitchLocalePath:(O,F)=>(P.getRouteLocalizedParams(),O),resolveLocalizedRouteObject:(O,F)=>mX(O)?t(O,F):_(O,F)};return P}function yX(e=Vs()){const i=document.querySelector(`[data-nuxt-i18n-slp="${e._id}"]`)?.textContent;return JSON.parse(i||"{}")}async function Z4(e,i){const s=SM(e),l=s.getLocale();if(i===l&&!s.initial)return i;const p={oldLocale:l,newLocale:i,initialSetup:s.initial,context:e};let _=await e.callHook("i18n:beforeLocaleSwitch",p);return _!=null,_??=p.newLocale,qx(_)&&(i=_),await s.loadMessages(i),await s.setLocaleSuspend(i),i}function vX(e,i,s){return!1}function xX(e,i){const s=rI(e),l=EM(void 0,s,e),p=SM(e),_=Fr(i)?i:i.path;function*b(){p.initial&&s.enabled&&!vX(s,_,l.route(_))&&(yield l.cookie(),yield l.header(),yield l.navigator(),yield s.fallbackLocale)}for(const t of b())if(t&&qx(t))return t;return p.getLocale()||p.getDefaultLocale()||""}function bX(e,i,s,l){return pl(i)?()=>i(e):()=>i??""}function wX(e,i,s){return{line:e,column:i,offset:s}}function KA(e,i,s){return{start:e,end:i}}const Pa={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14},TX=17;function oI(e,i,s={}){const{domain:l,messages:p,args:_}=s,b=e,t=new SyntaxError(String(b));return t.code=e,i&&(t.location=i),t.domain=l,t}function SX(e){throw e}const yg=" ",EX="\r",Eh=`
`,IX="\u2028",CX="\u2029";function AX(e){const i=e;let s=0,l=1,p=1,_=0;const b=We=>i[We]===EX&&i[We+1]===Eh,t=We=>i[We]===Eh,P=We=>i[We]===CX,O=We=>i[We]===IX,F=We=>b(We)||t(We)||P(We)||O(We),$=()=>s,W=()=>l,Y=()=>p,ae=()=>_,se=We=>b(We)||P(We)||O(We)?Eh:i[We],ie=()=>se(s),pe=()=>se(s+_);function ye(){return _=0,F(s)&&(l++,p=0),b(s)&&s++,s++,p++,i[s]}function de(){return b(s+_)&&_++,_++,i[s+_]}function Ee(){s=0,l=1,p=1,_=0}function Pe(We=0){_=We}function Ze(){const We=s+_;for(;We!==s;)ye();_=0}return{index:$,line:W,column:Y,peekOffset:ae,charAt:se,currentChar:ie,currentPeek:pe,next:ye,peek:de,reset:Ee,resetPeek:Pe,skipToPeek:Ze}}const P_=void 0,PX=".",QR="'",MX="tokenizer";function kX(e,i={}){const s=i.location!==!1,l=AX(e),p=()=>l.index(),_=()=>wX(l.line(),l.column(),l.index()),b=_(),t=p(),P={currentType:13,offset:t,startLoc:b,endLoc:b,lastType:13,lastOffset:t,lastStartLoc:b,lastEndLoc:b,braceNest:0,inLinked:!1,text:""},O=()=>P,{onError:F}=i;function $(pt,Ot,vi,...qi){const on=O();if(Ot.column+=vi,Ot.offset+=vi,F){const Hi=s?KA(on.startLoc,Ot):null,Bt=oI(pt,Hi,{domain:MX,args:qi});F(Bt)}}function W(pt,Ot,vi){pt.endLoc=_(),pt.currentType=Ot;const qi={type:Ot};return s&&(qi.loc=KA(pt.startLoc,pt.endLoc)),vi!=null&&(qi.value=vi),qi}const Y=pt=>W(pt,13);function ae(pt,Ot){return pt.currentChar()===Ot?(pt.next(),Ot):($(Pa.EXPECTED_TOKEN,_(),0,Ot),"")}function se(pt){let Ot="";for(;pt.currentPeek()===yg||pt.currentPeek()===Eh;)Ot+=pt.currentPeek(),pt.peek();return Ot}function ie(pt){const Ot=se(pt);return pt.skipToPeek(),Ot}function pe(pt){if(pt===P_)return!1;const Ot=pt.charCodeAt(0);return Ot>=97&&Ot<=122||Ot>=65&&Ot<=90||Ot===95}function ye(pt){if(pt===P_)return!1;const Ot=pt.charCodeAt(0);return Ot>=48&&Ot<=57}function de(pt,Ot){const{currentType:vi}=Ot;if(vi!==2)return!1;se(pt);const qi=pe(pt.currentPeek());return pt.resetPeek(),qi}function Ee(pt,Ot){const{currentType:vi}=Ot;if(vi!==2)return!1;se(pt);const qi=pt.currentPeek()==="-"?pt.peek():pt.currentPeek(),on=ye(qi);return pt.resetPeek(),on}function Pe(pt,Ot){const{currentType:vi}=Ot;if(vi!==2)return!1;se(pt);const qi=pt.currentPeek()===QR;return pt.resetPeek(),qi}function Ze(pt,Ot){const{currentType:vi}=Ot;if(vi!==7)return!1;se(pt);const qi=pt.currentPeek()===".";return pt.resetPeek(),qi}function We(pt,Ot){const{currentType:vi}=Ot;if(vi!==8)return!1;se(pt);const qi=pe(pt.currentPeek());return pt.resetPeek(),qi}function je(pt,Ot){const{currentType:vi}=Ot;if(!(vi===7||vi===11))return!1;se(pt);const qi=pt.currentPeek()===":";return pt.resetPeek(),qi}function Ye(pt,Ot){const{currentType:vi}=Ot;if(vi!==9)return!1;const qi=()=>{const Hi=pt.currentPeek();return Hi==="{"?pe(pt.peek()):Hi==="@"||Hi==="|"||Hi===":"||Hi==="."||Hi===yg||!Hi?!1:Hi===Eh?(pt.peek(),qi()):Lt(pt,!1)},on=qi();return pt.resetPeek(),on}function ct(pt){se(pt);const Ot=pt.currentPeek()==="|";return pt.resetPeek(),Ot}function Lt(pt,Ot=!0){const vi=(on=!1,Hi="")=>{const Bt=pt.currentPeek();return Bt==="{"||Bt==="@"||!Bt?on:Bt==="|"?!(Hi===yg||Hi===Eh):Bt===yg?(pt.peek(),vi(!0,yg)):Bt===Eh?(pt.peek(),vi(!0,Eh)):!0},qi=vi();return Ot&&pt.resetPeek(),qi}function Ht(pt,Ot){const vi=pt.currentChar();return vi===P_?P_:Ot(vi)?(pt.next(),vi):null}function ci(pt){const Ot=pt.charCodeAt(0);return Ot>=97&&Ot<=122||Ot>=65&&Ot<=90||Ot>=48&&Ot<=57||Ot===95||Ot===36}function Wt(pt){return Ht(pt,ci)}function $t(pt){const Ot=pt.charCodeAt(0);return Ot>=97&&Ot<=122||Ot>=65&&Ot<=90||Ot>=48&&Ot<=57||Ot===95||Ot===36||Ot===45}function Dt(pt){return Ht(pt,$t)}function Ft(pt){const Ot=pt.charCodeAt(0);return Ot>=48&&Ot<=57}function vt(pt){return Ht(pt,Ft)}function wi(pt){const Ot=pt.charCodeAt(0);return Ot>=48&&Ot<=57||Ot>=65&&Ot<=70||Ot>=97&&Ot<=102}function Qi(pt){return Ht(pt,wi)}function wn(pt){let Ot="",vi="";for(;Ot=vt(pt);)vi+=Ot;return vi}function qn(pt){let Ot="";for(;;){const vi=pt.currentChar();if(vi==="{"||vi==="}"||vi==="@"||vi==="|"||!vi)break;if(vi===yg||vi===Eh)if(Lt(pt))Ot+=vi,pt.next();else{if(ct(pt))break;Ot+=vi,pt.next()}else Ot+=vi,pt.next()}return Ot}function Fn(pt){ie(pt);let Ot="",vi="";for(;Ot=Dt(pt);)vi+=Ot;const qi=pt.currentChar();if(qi&&qi!=="}"&&qi!==P_&&qi!==yg&&qi!==Eh&&qi!==""){const on=gn(pt);return $(Pa.INVALID_TOKEN_IN_PLACEHOLDER,_(),0,vi+on),vi+on}return pt.currentChar()===P_&&$(Pa.UNTERMINATED_CLOSING_BRACE,_(),0),vi}function mr(pt){ie(pt);let Ot="";return pt.currentChar()==="-"?(pt.next(),Ot+=`-${wn(pt)}`):Ot+=wn(pt),pt.currentChar()===P_&&$(Pa.UNTERMINATED_CLOSING_BRACE,_(),0),Ot}function Sr(pt){return pt!==QR&&pt!==Eh}function Hr(pt){ie(pt),ae(pt,"'");let Ot="",vi="";for(;Ot=Ht(pt,Sr);)Ot==="\\"?vi+=ti(pt):vi+=Ot;const qi=pt.currentChar();return qi===Eh||qi===P_?($(Pa.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,_(),0),qi===Eh&&(pt.next(),ae(pt,"'")),vi):(ae(pt,"'"),vi)}function ti(pt){const Ot=pt.currentChar();switch(Ot){case"\\":case"'":return pt.next(),`\\${Ot}`;case"u":return sn(pt,Ot,4);case"U":return sn(pt,Ot,6);default:return $(Pa.UNKNOWN_ESCAPE_SEQUENCE,_(),0,Ot),""}}function sn(pt,Ot,vi){ae(pt,Ot);let qi="";for(let on=0;on<vi;on++){const Hi=Qi(pt);if(!Hi){$(Pa.INVALID_UNICODE_ESCAPE_SEQUENCE,_(),0,`\\${Ot}${qi}${pt.currentChar()}`);break}qi+=Hi}return`\\${Ot}${qi}`}function Gi(pt){return pt!=="{"&&pt!=="}"&&pt!==yg&&pt!==Eh}function gn(pt){ie(pt);let Ot="",vi="";for(;Ot=Ht(pt,Gi);)vi+=Ot;return vi}function nr(pt){let Ot="",vi="";for(;Ot=Wt(pt);)vi+=Ot;return vi}function Ur(pt){const Ot=vi=>{const qi=pt.currentChar();return qi==="{"||qi==="@"||qi==="|"||qi==="("||qi===")"||!qi||qi===yg?vi:(vi+=qi,pt.next(),Ot(vi))};return Ot("")}function St(pt){ie(pt);const Ot=ae(pt,"|");return ie(pt),Ot}function Gt(pt,Ot){let vi=null;switch(pt.currentChar()){case"{":return Ot.braceNest>=1&&$(Pa.NOT_ALLOW_NEST_PLACEHOLDER,_(),0),pt.next(),vi=W(Ot,2,"{"),ie(pt),Ot.braceNest++,vi;case"}":return Ot.braceNest>0&&Ot.currentType===2&&$(Pa.EMPTY_PLACEHOLDER,_(),0),pt.next(),vi=W(Ot,3,"}"),Ot.braceNest--,Ot.braceNest>0&&ie(pt),Ot.inLinked&&Ot.braceNest===0&&(Ot.inLinked=!1),vi;case"@":return Ot.braceNest>0&&$(Pa.UNTERMINATED_CLOSING_BRACE,_(),0),vi=Ai(pt,Ot)||Y(Ot),Ot.braceNest=0,vi;default:{let on=!0,Hi=!0,Bt=!0;if(ct(pt))return Ot.braceNest>0&&$(Pa.UNTERMINATED_CLOSING_BRACE,_(),0),vi=W(Ot,1,St(pt)),Ot.braceNest=0,Ot.inLinked=!1,vi;if(Ot.braceNest>0&&(Ot.currentType===4||Ot.currentType===5||Ot.currentType===6))return $(Pa.UNTERMINATED_CLOSING_BRACE,_(),0),Ot.braceNest=0,hn(pt,Ot);if(on=de(pt,Ot))return vi=W(Ot,4,Fn(pt)),ie(pt),vi;if(Hi=Ee(pt,Ot))return vi=W(Ot,5,mr(pt)),ie(pt),vi;if(Bt=Pe(pt,Ot))return vi=W(Ot,6,Hr(pt)),ie(pt),vi;if(!on&&!Hi&&!Bt)return vi=W(Ot,12,gn(pt)),$(Pa.INVALID_TOKEN_IN_PLACEHOLDER,_(),0,vi.value),ie(pt),vi;break}}return vi}function Ai(pt,Ot){const{currentType:vi}=Ot;let qi=null;const on=pt.currentChar();switch((vi===7||vi===8||vi===11||vi===9)&&(on===Eh||on===yg)&&$(Pa.INVALID_LINKED_FORMAT,_(),0),on){case"@":return pt.next(),qi=W(Ot,7,"@"),Ot.inLinked=!0,qi;case".":return ie(pt),pt.next(),W(Ot,8,".");case":":return ie(pt),pt.next(),W(Ot,9,":");default:return ct(pt)?(qi=W(Ot,1,St(pt)),Ot.braceNest=0,Ot.inLinked=!1,qi):Ze(pt,Ot)||je(pt,Ot)?(ie(pt),Ai(pt,Ot)):We(pt,Ot)?(ie(pt),W(Ot,11,nr(pt))):Ye(pt,Ot)?(ie(pt),on==="{"?Gt(pt,Ot)||qi:W(Ot,10,Ur(pt))):(vi===7&&$(Pa.INVALID_LINKED_FORMAT,_(),0),Ot.braceNest=0,Ot.inLinked=!1,hn(pt,Ot))}}function hn(pt,Ot){let vi={type:13};if(Ot.braceNest>0)return Gt(pt,Ot)||Y(Ot);if(Ot.inLinked)return Ai(pt,Ot)||Y(Ot);switch(pt.currentChar()){case"{":return Gt(pt,Ot)||Y(Ot);case"}":return $(Pa.UNBALANCED_CLOSING_BRACE,_(),0),pt.next(),W(Ot,3,"}");case"@":return Ai(pt,Ot)||Y(Ot);default:{if(ct(pt))return vi=W(Ot,1,St(pt)),Ot.braceNest=0,Ot.inLinked=!1,vi;if(Lt(pt))return W(Ot,0,qn(pt));break}}return vi}function Ui(){const{currentType:pt,offset:Ot,startLoc:vi,endLoc:qi}=P;return P.lastType=pt,P.lastOffset=Ot,P.lastStartLoc=vi,P.lastEndLoc=qi,P.offset=p(),P.startLoc=_(),l.currentChar()===P_?W(P,13):hn(l,P)}return{nextToken:Ui,currentOffset:p,currentPosition:_,context:O}}const DX="parser",LX=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function RX(e,i,s){switch(e){case"\\\\":return"\\";case"\\'":return"'";default:{const l=parseInt(i||s,16);return l<=55295||l>=57344?String.fromCodePoint(l):""}}}function zX(e={}){const i=e.location!==!1,{onError:s}=e;function l(pe,ye,de,Ee,...Pe){const Ze=pe.currentPosition();if(Ze.offset+=Ee,Ze.column+=Ee,s){const We=i?KA(de,Ze):null,je=oI(ye,We,{domain:DX,args:Pe});s(je)}}function p(pe,ye,de){const Ee={type:pe};return i&&(Ee.start=ye,Ee.end=ye,Ee.loc={start:de,end:de}),Ee}function _(pe,ye,de,Ee){i&&(pe.end=ye,pe.loc&&(pe.loc.end=de))}function b(pe,ye){const de=pe.context(),Ee=p(3,de.offset,de.startLoc);return Ee.value=ye,_(Ee,pe.currentOffset(),pe.currentPosition()),Ee}function t(pe,ye){const de=pe.context(),{lastOffset:Ee,lastStartLoc:Pe}=de,Ze=p(5,Ee,Pe);return Ze.index=parseInt(ye,10),pe.nextToken(),_(Ze,pe.currentOffset(),pe.currentPosition()),Ze}function P(pe,ye){const de=pe.context(),{lastOffset:Ee,lastStartLoc:Pe}=de,Ze=p(4,Ee,Pe);return Ze.key=ye,pe.nextToken(),_(Ze,pe.currentOffset(),pe.currentPosition()),Ze}function O(pe,ye){const de=pe.context(),{lastOffset:Ee,lastStartLoc:Pe}=de,Ze=p(9,Ee,Pe);return Ze.value=ye.replace(LX,RX),pe.nextToken(),_(Ze,pe.currentOffset(),pe.currentPosition()),Ze}function F(pe){const ye=pe.nextToken(),de=pe.context(),{lastOffset:Ee,lastStartLoc:Pe}=de,Ze=p(8,Ee,Pe);return ye.type!==11?(l(pe,Pa.UNEXPECTED_EMPTY_LINKED_MODIFIER,de.lastStartLoc,0),Ze.value="",_(Ze,Ee,Pe),{nextConsumeToken:ye,node:Ze}):(ye.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,de.lastStartLoc,0,vg(ye)),Ze.value=ye.value||"",_(Ze,pe.currentOffset(),pe.currentPosition()),{node:Ze})}function $(pe,ye){const de=pe.context(),Ee=p(7,de.offset,de.startLoc);return Ee.value=ye,_(Ee,pe.currentOffset(),pe.currentPosition()),Ee}function W(pe){const ye=pe.context(),de=p(6,ye.offset,ye.startLoc);let Ee=pe.nextToken();if(Ee.type===8){const Pe=F(pe);de.modifier=Pe.node,Ee=Pe.nextConsumeToken||pe.nextToken()}switch(Ee.type!==9&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ee)),Ee=pe.nextToken(),Ee.type===2&&(Ee=pe.nextToken()),Ee.type){case 10:Ee.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ee)),de.key=$(pe,Ee.value||"");break;case 4:Ee.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ee)),de.key=P(pe,Ee.value||"");break;case 5:Ee.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ee)),de.key=t(pe,Ee.value||"");break;case 6:Ee.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ee)),de.key=O(pe,Ee.value||"");break;default:{l(pe,Pa.UNEXPECTED_EMPTY_LINKED_KEY,ye.lastStartLoc,0);const Pe=pe.context(),Ze=p(7,Pe.offset,Pe.startLoc);return Ze.value="",_(Ze,Pe.offset,Pe.startLoc),de.key=Ze,_(de,Pe.offset,Pe.startLoc),{nextConsumeToken:Ee,node:de}}}return _(de,pe.currentOffset(),pe.currentPosition()),{node:de}}function Y(pe){const ye=pe.context(),de=ye.currentType===1?pe.currentOffset():ye.offset,Ee=ye.currentType===1?ye.endLoc:ye.startLoc,Pe=p(2,de,Ee);Pe.items=[];let Ze=null;do{const Ye=Ze||pe.nextToken();switch(Ze=null,Ye.type){case 0:Ye.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ye)),Pe.items.push(b(pe,Ye.value||""));break;case 5:Ye.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ye)),Pe.items.push(t(pe,Ye.value||""));break;case 4:Ye.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ye)),Pe.items.push(P(pe,Ye.value||""));break;case 6:Ye.value==null&&l(pe,Pa.UNEXPECTED_LEXICAL_ANALYSIS,ye.lastStartLoc,0,vg(Ye)),Pe.items.push(O(pe,Ye.value||""));break;case 7:{const ct=W(pe);Pe.items.push(ct.node),Ze=ct.nextConsumeToken||null;break}}}while(ye.currentType!==13&&ye.currentType!==1);const We=ye.currentType===1?ye.lastOffset:pe.currentOffset(),je=ye.currentType===1?ye.lastEndLoc:pe.currentPosition();return _(Pe,We,je),Pe}function ae(pe,ye,de,Ee){const Pe=pe.context();let Ze=Ee.items.length===0;const We=p(1,ye,de);We.cases=[],We.cases.push(Ee);do{const je=Y(pe);Ze||(Ze=je.items.length===0),We.cases.push(je)}while(Pe.currentType!==13);return Ze&&l(pe,Pa.MUST_HAVE_MESSAGES_IN_PLURAL,de,0),_(We,pe.currentOffset(),pe.currentPosition()),We}function se(pe){const ye=pe.context(),{offset:de,startLoc:Ee}=ye,Pe=Y(pe);return ye.currentType===13?Pe:ae(pe,de,Ee,Pe)}function ie(pe){const ye=kX(pe,xc({},e)),de=ye.context(),Ee=p(0,de.offset,de.startLoc);return i&&Ee.loc&&(Ee.loc.source=pe),Ee.body=se(ye),e.onCacheKey&&(Ee.cacheKey=e.onCacheKey(pe)),de.currentType!==13&&l(ye,Pa.UNEXPECTED_LEXICAL_ANALYSIS,de.lastStartLoc,0,pe[de.offset]||""),_(Ee,ye.currentOffset(),ye.currentPosition()),Ee}return{parse:ie}}function vg(e){if(e.type===13)return"EOF";const i=(e.value||"").replace(/\r?\n/gu,"\\n");return i.length>10?i.slice(0,9)+"":i}function OX(e,i={}){const s={ast:e,helpers:new Set};return{context:()=>s,helper:_=>(s.helpers.add(_),_)}}function e3(e,i){for(let s=0;s<e.length;s++)IM(e[s],i)}function IM(e,i){switch(e.type){case 1:e3(e.cases,i),i.helper("plural");break;case 2:e3(e.items,i);break;case 6:{IM(e.key,i),i.helper("linked"),i.helper("type");break}case 5:i.helper("interpolate"),i.helper("list");break;case 4:i.helper("interpolate"),i.helper("named");break}}function FX(e,i={}){const s=OX(e);s.helper("normalize"),e.body&&IM(e.body,s);const l=s.context();e.helpers=Array.from(l.helpers)}function BX(e){const i=e.body;return i.type===2?t3(i):i.cases.forEach(s=>t3(s)),e}function t3(e){if(e.items.length===1){const i=e.items[0];(i.type===3||i.type===9)&&(e.static=i.value,delete i.value)}else{const i=[];for(let s=0;s<e.items.length;s++){const l=e.items[s];if(!(l.type===3||l.type===9)||l.value==null)break;i.push(l.value)}if(i.length===e.items.length){e.static=wM(i);for(let s=0;s<e.items.length;s++){const l=e.items[s];(l.type===3||l.type===9)&&delete l.value}}}}function kx(e){switch(e.t=e.type,e.type){case 0:{const i=e;kx(i.body),i.b=i.body,delete i.body;break}case 1:{const i=e,s=i.cases;for(let l=0;l<s.length;l++)kx(s[l]);i.c=s,delete i.cases;break}case 2:{const i=e,s=i.items;for(let l=0;l<s.length;l++)kx(s[l]);i.i=s,delete i.items,i.static&&(i.s=i.static,delete i.static);break}case 3:case 9:case 8:case 7:{const i=e;i.value&&(i.v=i.value,delete i.value);break}case 6:{const i=e;kx(i.key),i.k=i.key,delete i.key,i.modifier&&(kx(i.modifier),i.m=i.modifier,delete i.modifier);break}case 5:{const i=e;i.i=i.index,delete i.index;break}case 4:{const i=e;i.k=i.key,delete i.key;break}}delete e.type}function NX(e,i){const{filename:s,breakLineCode:l,needIndent:p}=i,_=i.location!==!1,b={filename:s,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:l,needIndent:p,indentLevel:0};_&&e.loc&&(b.source=e.loc.source);const t=()=>b;function P(se,ie){b.code+=se}function O(se,ie=!0){const pe=ie?l:"";P(p?pe+"  ".repeat(se):pe)}function F(se=!0){const ie=++b.indentLevel;se&&O(ie)}function $(se=!0){const ie=--b.indentLevel;se&&O(ie)}function W(){O(b.indentLevel)}return{context:t,push:P,indent:F,deindent:$,newline:W,helper:se=>`_${se}`,needIndent:()=>b.needIndent}}function VX(e,i){const{helper:s}=e;e.push(`${s("linked")}(`),ib(e,i.key),i.modifier?(e.push(", "),ib(e,i.modifier),e.push(", _type")):e.push(", undefined, _type"),e.push(")")}function jX(e,i){const{helper:s,needIndent:l}=e;e.push(`${s("normalize")}([`),e.indent(l());const p=i.items.length;for(let _=0;_<p&&(ib(e,i.items[_]),_!==p-1);_++)e.push(", ");e.deindent(l()),e.push("])")}function UX(e,i){const{helper:s,needIndent:l}=e;if(i.cases.length>1){e.push(`${s("plural")}([`),e.indent(l());const p=i.cases.length;for(let _=0;_<p&&(ib(e,i.cases[_]),_!==p-1);_++)e.push(", ");e.deindent(l()),e.push("])")}}function $X(e,i){i.body?ib(e,i.body):e.push("null")}function ib(e,i){const{helper:s}=e;switch(i.type){case 0:$X(e,i);break;case 1:UX(e,i);break;case 2:jX(e,i);break;case 6:VX(e,i);break;case 8:e.push(JSON.stringify(i.value),i);break;case 7:e.push(JSON.stringify(i.value),i);break;case 5:e.push(`${s("interpolate")}(${s("list")}(${i.index}))`,i);break;case 4:e.push(`${s("interpolate")}(${s("named")}(${JSON.stringify(i.key)}))`,i);break;case 9:e.push(JSON.stringify(i.value),i);break;case 3:e.push(JSON.stringify(i.value),i);break}}const GX=(e,i={})=>{const s=Fr(i.mode)?i.mode:"normal",l=Fr(i.filename)?i.filename:"message.intl";i.sourceMap;const p=i.breakLineCode!=null?i.breakLineCode:s==="arrow"?";":`
`,_=i.needIndent?i.needIndent:s!=="arrow",b=e.helpers||[],t=NX(e,{filename:l,breakLineCode:p,needIndent:_});t.push(s==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),t.indent(_),b.length>0&&(t.push(`const { ${wM(b.map(F=>`${F}: _${F}`),", ")} } = ctx`),t.newline()),t.push("return "),ib(t,e),t.deindent(_),t.push("}"),delete e.helpers;const{code:P,map:O}=t.context();return{ast:e,code:P,map:O?O.toJSON():void 0}};function qX(e,i={}){const s=xc({},i),l=!!s.jit,p=!!s.minify,_=s.optimize==null?!0:s.optimize,t=zX(s).parse(e);return l?(_&&BX(t),p&&kx(t),{ast:t,code:""}):(FX(t,s),GX(t,s))}function kg(e){return xa(e)&&CM(e)===0&&(xm(e,"b")||xm(e,"body"))}const X4=["b","body"];function HX(e){return c0(e,X4)}const Y4=["c","cases"];function WX(e){return c0(e,Y4,[])}const K4=["s","static"];function ZX(e){return c0(e,K4)}const J4=["i","items"];function XX(e){return c0(e,J4,[])}const Q4=["t","type"];function CM(e){return c0(e,Q4)}const e6=["v","value"];function KT(e,i){const s=c0(e,e6);if(s!=null)return s;throw Rw(i)}const t6=["m","modifier"];function YX(e){return c0(e,t6)}const i6=["k","key"];function KX(e){const i=c0(e,i6);if(i)return i;throw Rw(6)}function c0(e,i,s){for(let l=0;l<i.length;l++){const p=i[l];if(xm(e,p)&&e[p]!=null)return e[p]}return s}const n6=[...X4,...Y4,...K4,...J4,...i6,...t6,...e6,...Q4];function Rw(e){return new Error(`unhandled node type: ${e}`)}function kC(e){return s=>JX(s,e)}function JX(e,i){const s=HX(i);if(s==null)throw Rw(0);if(CM(s)===1){const _=WX(s);return e.plural(_.reduce((b,t)=>[...b,i3(e,t)],[]))}else return i3(e,s)}function i3(e,i){const s=ZX(i);if(s!=null)return e.type==="text"?s:e.normalize([s]);{const l=XX(i).reduce((p,_)=>[...p,JA(e,_)],[]);return e.normalize(l)}}function JA(e,i){const s=CM(i);switch(s){case 3:return KT(i,s);case 9:return KT(i,s);case 4:{const l=i;if(xm(l,"k")&&l.k)return e.interpolate(e.named(l.k));if(xm(l,"key")&&l.key)return e.interpolate(e.named(l.key));throw Rw(s)}case 5:{const l=i;if(xm(l,"i")&&Bc(l.i))return e.interpolate(e.list(l.i));if(xm(l,"index")&&Bc(l.index))return e.interpolate(e.list(l.index));throw Rw(s)}case 6:{const l=i,p=YX(l),_=KX(l);return e.linked(JA(e,_),p?JA(e,p):void 0,e.type)}case 7:return KT(i,s);case 8:return KT(i,s);default:throw new Error(`unhandled node on format message part: ${s}`)}}const QX=e=>e;let JT=ka();function eY(e,i={}){let s=!1;const l=i.onError||SX;return i.onError=p=>{s=!0,l(p)},{...qX(e,i),detectError:s}}function tY(e,i){if(Fr(e)){ql(i.warnHtmlMessage)&&i.warnHtmlMessage;const l=(i.onCacheKey||QX)(e),p=JT[l];if(p)return p;const{ast:_,detectError:b}=eY(e,{...i,location:!1,jit:!0}),t=kC(_);return b?t:JT[l]=t}else{const s=e.cacheKey;if(s){const l=JT[s];return l||(JT[s]=kC(e))}else return kC(e)}}const j_={INVALID_ARGUMENT:TX,INVALID_DATE_ARGUMENT:18,INVALID_ISO_DATE_ARGUMENT:19,NOT_SUPPORT_LOCALE_PROMISE_VALUE:21,NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:22,NOT_SUPPORT_LOCALE_TYPE:23},iY=24;function U_(e){return oI(e,null,void 0)}function AM(e,i){return i.locale!=null?n3(i.locale):n3(e.locale)}let DC;function n3(e){if(Fr(e))return e;if(pl(e)){if(e.resolvedOnce&&DC!=null)return DC;if(e.constructor.name==="Function"){const i=e();if(TZ(i))throw U_(j_.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return DC=i}else throw U_(j_.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw U_(j_.NOT_SUPPORT_LOCALE_TYPE)}function nY(e,i,s){return[...new Set([s,...cc(i)?i:xa(i)?Object.keys(i):Fr(i)?[i]:[s]])]}function r6(e,i,s){const l=Fr(s)?s:_E,p=e;p.__localeChainCache||(p.__localeChainCache=new Map);let _=p.__localeChainCache.get(l);if(!_){_=[];let b=[s];for(;cc(b);)b=r3(_,b,i);const t=cc(i)||!Qo(i)?i:i.default?i.default:null;b=Fr(t)?[t]:t,cc(b)&&r3(_,b,!1),p.__localeChainCache.set(l,_)}return _}function r3(e,i,s){let l=!0;for(let p=0;p<i.length&&ql(l);p++){const _=i[p];Fr(_)&&(l=rY(e,i[p],s))}return l}function rY(e,i,s){let l;const p=i.split("-");do{const _=p.join("-");l=sY(e,_,s),p.splice(-1,1)}while(p.length&&l===!0);return l}function sY(e,i,s){let l=!1;if(!e.includes(i)&&(l=!0,i)){l=i[i.length-1]!=="!";const p=i.replace(/!/g,"");e.push(p),(cc(s)||Qo(s))&&s[p]&&(l=s[p])}return l}const u0=[];u0[0]={w:[0],i:[3,0],"[":[4],o:[7]};u0[1]={w:[1],".":[2],"[":[4],o:[7]};u0[2]={w:[2],i:[3,0],0:[3,0]};u0[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]};u0[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]};u0[5]={"'":[4,0],o:8,l:[5,0]};u0[6]={'"':[4,0],o:8,l:[6,0]};const oY=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function aY(e){return oY.test(e)}function lY(e){const i=e.charCodeAt(0),s=e.charCodeAt(e.length-1);return i===s&&(i===34||i===39)?e.slice(1,-1):e}function cY(e){if(e==null)return"o";switch(e.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return e;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function uY(e){const i=e.trim();return e.charAt(0)==="0"&&isNaN(parseInt(e))?!1:aY(i)?lY(i):"*"+i}function hY(e){const i=[];let s=-1,l=0,p=0,_,b,t,P,O,F,$;const W=[];W[0]=()=>{b===void 0?b=t:b+=t},W[1]=()=>{b!==void 0&&(i.push(b),b=void 0)},W[2]=()=>{W[0](),p++},W[3]=()=>{if(p>0)p--,l=4,W[0]();else{if(p=0,b===void 0||(b=uY(b),b===!1))return!1;W[1]()}};function Y(){const ae=e[s+1];if(l===5&&ae==="'"||l===6&&ae==='"')return s++,t="\\"+ae,W[0](),!0}for(;l!==null;)if(s++,_=e[s],!(_==="\\"&&Y())){if(P=cY(_),$=u0[l],O=$[P]||$.l||8,O===8||(l=O[0],O[1]!==void 0&&(F=W[O[1]],F&&(t=_,F()===!1))))return;if(l===7)return i}}const s3=new Map;function dY(e,i){return xa(e)?e[i]:null}function fY(e,i){if(!xa(e))return null;let s=s3.get(i);if(s||(s=hY(i),s&&s3.set(i,s)),!s)return null;const l=s.length;let p=e,_=0;for(;_<l;){const b=s[_];if(n6.includes(b)&&kg(p))return null;const t=p[b];if(t===void 0||pl(p))return null;p=t,_++}return p}const pY="11.2.7",aI=-1,_E="en-US",o3="",a3=e=>`${e.charAt(0).toLocaleUpperCase()}${e.substr(1)}`;function mY(){return{upper:(e,i)=>i==="text"&&Fr(e)?e.toUpperCase():i==="vnode"&&xa(e)&&"__v_isVNode"in e?e.children.toUpperCase():e,lower:(e,i)=>i==="text"&&Fr(e)?e.toLowerCase():i==="vnode"&&xa(e)&&"__v_isVNode"in e?e.children.toLowerCase():e,capitalize:(e,i)=>i==="text"&&Fr(e)?a3(e):i==="vnode"&&xa(e)&&"__v_isVNode"in e?a3(e.children):e}}let s6;function gY(e){s6=e}let o6;function _Y(e){o6=e}let a6;function yY(e){a6=e}let l6=null;const l3=e=>{l6=e},vY=()=>l6;let c3=0;function xY(e={}){const i=pl(e.onWarn)?e.onWarn:gZ,s=Fr(e.version)?e.version:pY,l=Fr(e.locale)||pl(e.locale)?e.locale:_E,p=pl(l)?_E:l,_=cc(e.fallbackLocale)||Qo(e.fallbackLocale)||Fr(e.fallbackLocale)||e.fallbackLocale===!1?e.fallbackLocale:p,b=Qo(e.messages)?e.messages:LC(p),t=Qo(e.datetimeFormats)?e.datetimeFormats:LC(p),P=Qo(e.numberFormats)?e.numberFormats:LC(p),O=xc(ka(),e.modifiers,mY()),F=e.pluralRules||ka(),$=pl(e.missing)?e.missing:null,W=ql(e.missingWarn)||mE(e.missingWarn)?e.missingWarn:!0,Y=ql(e.fallbackWarn)||mE(e.fallbackWarn)?e.fallbackWarn:!0,ae=!!e.fallbackFormat,se=!!e.unresolving,ie=pl(e.postTranslation)?e.postTranslation:null,pe=Qo(e.processor)?e.processor:null,ye=ql(e.warnHtmlMessage)?e.warnHtmlMessage:!0,de=!!e.escapeParameter,Ee=pl(e.messageCompiler)?e.messageCompiler:s6,Pe=pl(e.messageResolver)?e.messageResolver:o6||dY,Ze=pl(e.localeFallbacker)?e.localeFallbacker:a6||nY,We=xa(e.fallbackContext)?e.fallbackContext:void 0,je=e,Ye=xa(je.__datetimeFormatters)?je.__datetimeFormatters:new Map,ct=xa(je.__numberFormatters)?je.__numberFormatters:new Map,Lt=xa(je.__meta)?je.__meta:{};c3++;const Ht={version:s,cid:c3,locale:l,fallbackLocale:_,messages:b,modifiers:O,pluralRules:F,missing:$,missingWarn:W,fallbackWarn:Y,fallbackFormat:ae,unresolving:se,postTranslation:ie,processor:pe,warnHtmlMessage:ye,escapeParameter:de,messageCompiler:Ee,messageResolver:Pe,localeFallbacker:Ze,fallbackContext:We,onWarn:i,__meta:Lt};return Ht.datetimeFormats=t,Ht.numberFormats=P,Ht.__datetimeFormatters=Ye,Ht.__numberFormatters=ct,Ht}const LC=e=>({[e]:ka()});function PM(e,i,s,l,p){const{missing:_,onWarn:b}=e;if(_!==null){const t=_(e,s,i,p);return Fr(t)?t:i}else return i}function G1(e,i,s){const l=e;l.__localeChainCache=new Map,e.localeFallbacker(e,s,i)}function bY(e,i){return e===i?!1:e.split("-")[0]===i.split("-")[0]}function wY(e,i){const s=i.indexOf(e);if(s===-1)return!1;for(let l=s+1;l<i.length;l++)if(bY(e,i[l]))return!0;return!1}function u3(e,...i){const{datetimeFormats:s,unresolving:l,fallbackLocale:p,onWarn:_,localeFallbacker:b}=e,{__datetimeFormatters:t}=e,[P,O,F,$]=QA(...i),W=ql(F.missingWarn)?F.missingWarn:e.missingWarn;ql(F.fallbackWarn)?F.fallbackWarn:e.fallbackWarn;const Y=!!F.part,ae=AM(e,F),se=b(e,p,ae);if(!Fr(P)||P==="")return new Intl.DateTimeFormat(ae,$).format(O);let ie={},pe,ye=null;const de="datetime format";for(let Ze=0;Ze<se.length&&(pe=se[Ze],ie=s[pe]||{},ye=ie[P],!Qo(ye));Ze++)PM(e,P,pe,W,de);if(!Qo(ye)||!Fr(pe))return l?aI:P;let Ee=`${pe}__${P}`;tI($)||(Ee=`${Ee}__${JSON.stringify($)}`);let Pe=t.get(Ee);return Pe||(Pe=new Intl.DateTimeFormat(pe,xc({},ye,$)),t.set(Ee,Pe)),Y?Pe.formatToParts(O):Pe.format(O)}const c6=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function QA(...e){const[i,s,l,p]=e,_=ka();let b=ka(),t;if(Fr(i)){const P=i.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!P)throw U_(j_.INVALID_ISO_DATE_ARGUMENT);const O=P[3]?P[3].trim().startsWith("T")?`${P[1].trim()}${P[3].trim()}`:`${P[1].trim()}T${P[3].trim()}`:P[1].trim();t=new Date(O);try{t.toISOString()}catch{throw U_(j_.INVALID_ISO_DATE_ARGUMENT)}}else if(vZ(i)){if(isNaN(i.getTime()))throw U_(j_.INVALID_DATE_ARGUMENT);t=i}else if(Bc(i))t=i;else throw U_(j_.INVALID_ARGUMENT);return Fr(s)?_.key=s:Qo(s)&&Object.keys(s).forEach(P=>{c6.includes(P)?b[P]=s[P]:_[P]=s[P]}),Fr(l)?_.locale=l:Qo(l)&&(b=l),Qo(p)&&(b=p),[_.key||"",t,_,b]}function h3(e,i,s){const l=e;for(const p in s){const _=`${i}__${p}`;l.__datetimeFormatters.has(_)&&l.__datetimeFormatters.delete(_)}}function d3(e,...i){const{numberFormats:s,unresolving:l,fallbackLocale:p,onWarn:_,localeFallbacker:b}=e,{__numberFormatters:t}=e,[P,O,F,$]=eP(...i),W=ql(F.missingWarn)?F.missingWarn:e.missingWarn;ql(F.fallbackWarn)?F.fallbackWarn:e.fallbackWarn;const Y=!!F.part,ae=AM(e,F),se=b(e,p,ae);if(!Fr(P)||P==="")return new Intl.NumberFormat(ae,$).format(O);let ie={},pe,ye=null;const de="number format";for(let Ze=0;Ze<se.length&&(pe=se[Ze],ie=s[pe]||{},ye=ie[P],!Qo(ye));Ze++)PM(e,P,pe,W,de);if(!Qo(ye)||!Fr(pe))return l?aI:P;let Ee=`${pe}__${P}`;tI($)||(Ee=`${Ee}__${JSON.stringify($)}`);let Pe=t.get(Ee);return Pe||(Pe=new Intl.NumberFormat(pe,xc({},ye,$)),t.set(Ee,Pe)),Y?Pe.formatToParts(O):Pe.format(O)}const u6=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function eP(...e){const[i,s,l,p]=e,_=ka();let b=ka();if(!Bc(i))throw U_(j_.INVALID_ARGUMENT);const t=i;return Fr(s)?_.key=s:Qo(s)&&Object.keys(s).forEach(P=>{u6.includes(P)?b[P]=s[P]:_[P]=s[P]}),Fr(l)?_.locale=l:Qo(l)&&(b=l),Qo(p)&&(b=p),[_.key||"",t,_,b]}function f3(e,i,s){const l=e;for(const p in s){const _=`${i}__${p}`;l.__numberFormatters.has(_)&&l.__numberFormatters.delete(_)}}const TY=e=>e,SY=e=>"",EY="text",IY=e=>e.length===0?"":wM(e),CY=SZ;function p3(e,i){return e=Math.abs(e),i===2?e?e>1?1:0:1:e?Math.min(e,2):0}function AY(e){const i=Bc(e.pluralIndex)?e.pluralIndex:-1;return e.named&&(Bc(e.named.count)||Bc(e.named.n))?Bc(e.named.count)?e.named.count:Bc(e.named.n)?e.named.n:i:i}function PY(e,i){i.count||(i.count=e),i.n||(i.n=e)}function MY(e={}){const i=e.locale,s=AY(e),l=xa(e.pluralRules)&&Fr(i)&&pl(e.pluralRules[i])?e.pluralRules[i]:p3,p=xa(e.pluralRules)&&Fr(i)&&pl(e.pluralRules[i])?p3:void 0,_=pe=>pe[l(s,pe.length,p)],b=e.list||[],t=pe=>b[pe],P=e.named||ka();Bc(e.pluralIndex)&&PY(s,P);const O=pe=>P[pe];function F(pe,ye){const de=pl(e.messages)?e.messages(pe,!!ye):xa(e.messages)?e.messages[pe]:!1;return de||(e.parent?e.parent.message(pe):SY)}const $=pe=>e.modifiers?e.modifiers[pe]:TY,W=Qo(e.processor)&&pl(e.processor.normalize)?e.processor.normalize:IY,Y=Qo(e.processor)&&pl(e.processor.interpolate)?e.processor.interpolate:CY,ae=Qo(e.processor)&&Fr(e.processor.type)?e.processor.type:EY,ie={list:t,named:O,plural:_,linked:(pe,...ye)=>{const[de,Ee]=ye;let Pe="text",Ze="";ye.length===1?xa(de)?(Ze=de.modifier||Ze,Pe=de.type||Pe):Fr(de)&&(Ze=de||Ze):ye.length===2&&(Fr(de)&&(Ze=de||Ze),Fr(Ee)&&(Pe=Ee||Pe));const We=F(pe,!0)(ie),je=Pe==="vnode"&&cc(We)&&Ze?We[0]:We;return Ze?$(Ze)(je,Pe):je},message:F,type:ae,interpolate:Y,normalize:W,values:xc(ka(),b,P)};return ie}const m3=()=>"",G_=e=>pl(e);function g3(e,...i){const{fallbackFormat:s,postTranslation:l,unresolving:p,messageCompiler:_,fallbackLocale:b,messages:t}=e,[P,O]=tP(...i),F=ql(O.missingWarn)?O.missingWarn:e.missingWarn,$=ql(O.fallbackWarn)?O.fallbackWarn:e.fallbackWarn,W=ql(O.escapeParameter)?O.escapeParameter:e.escapeParameter,Y=!!O.resolvedMessage,ae=Fr(O.default)||ql(O.default)?ql(O.default)?_?P:()=>P:O.default:s?_?P:()=>P:null,se=s||ae!=null&&(Fr(ae)||pl(ae)),ie=AM(e,O);W&&kY(O);let[pe,ye,de]=Y?[P,ie,t[ie]||ka()]:h6(e,P,ie,b,$,F),Ee=pe,Pe=P;if(!Y&&!(Fr(Ee)||kg(Ee)||G_(Ee))&&se&&(Ee=ae,Pe=Ee),!Y&&(!(Fr(Ee)||kg(Ee)||G_(Ee))||!Fr(ye)))return p?aI:P;let Ze=!1;const We=()=>{Ze=!0},je=G_(Ee)?Ee:d6(e,P,ye,Ee,Pe,We);if(Ze)return Ee;const Ye=RY(e,ye,de,O),ct=MY(Ye),Lt=DY(e,je,ct);let Ht=l?l(Lt,P):Lt;return W&&Fr(Ht)&&(Ht=bZ(Ht)),Ht}function kY(e){cc(e.list)?e.list=e.list.map(i=>Fr(i)?XR(i):i):xa(e.named)&&Object.keys(e.named).forEach(i=>{Fr(e.named[i])&&(e.named[i]=XR(e.named[i]))})}function h6(e,i,s,l,p,_){const{messages:b,onWarn:t,messageResolver:P,localeFallbacker:O}=e,F=O(e,l,s);let $=ka(),W,Y=null;const ae="translate";for(let se=0;se<F.length&&(W=F[se],$=b[W]||ka(),(Y=P($,i))===null&&(Y=$[i]),!(Fr(Y)||kg(Y)||G_(Y)));se++)if(!wY(W,F)){const ie=PM(e,i,W,_,ae);ie!==i&&(Y=ie)}return[Y,W,$]}function d6(e,i,s,l,p,_){const{messageCompiler:b,warnHtmlMessage:t}=e;if(G_(l)){const O=l;return O.locale=O.locale||s,O.key=O.key||i,O}if(b==null){const O=(()=>l);return O.locale=s,O.key=i,O}const P=b(l,LY(e,s,p,l,t,_));return P.locale=s,P.key=i,P.source=l,P}function DY(e,i,s){return i(s)}function tP(...e){const[i,s,l]=e,p=ka();if(!Fr(i)&&!Bc(i)&&!G_(i)&&!kg(i))throw U_(j_.INVALID_ARGUMENT);const _=Bc(i)?String(i):(G_(i),i);return Bc(s)?p.plural=s:Fr(s)?p.default=s:Qo(s)&&!tI(s)?p.named=s:cc(s)&&(p.list=s),Bc(l)?p.plural=l:Fr(l)?p.default=l:Qo(l)&&xc(p,l),[_,p]}function LY(e,i,s,l,p,_){return{locale:i,key:s,warnHtmlMessage:p,onError:b=>{throw _&&_(b),b},onCacheKey:b=>_Z(i,s,b)}}function RY(e,i,s,l){const{modifiers:p,pluralRules:_,messageResolver:b,fallbackLocale:t,fallbackWarn:P,missingWarn:O,fallbackContext:F}=e,W={locale:i,modifiers:p,pluralRules:_,messages:(Y,ae)=>{let se=b(s,Y);if(se==null&&(F||ae)){const[,,ie]=h6(F||e,Y,i,t,P,O);se=b(ie,Y)}if(Fr(se)||kg(se)){let ie=!1;const ye=d6(e,Y,i,se,Y,()=>{ie=!0});return ie?m3:ye}else return G_(se)?se:m3}};return e.processor&&(W.processor=e.processor),l.list&&(W.list=l.list),l.named&&(W.named=l.named),Bc(l.plural)&&(W.pluralIndex=l.plural),W}const zY="11.2.7",Dp={UNEXPECTED_RETURN_TYPE:iY,INVALID_ARGUMENT:25,MUST_BE_CALL_SETUP_TOP:26,NOT_INSTALLED:27,REQUIRED_VALUE:28,INVALID_VALUE:29,NOT_INSTALLED_WITH_PROVIDE:31,UNEXPECTED_ERROR:32};function Mm(e,...i){return oI(e,null,void 0)}const iP=l0("__translateVNode"),nP=l0("__datetimeParts"),rP=l0("__numberParts"),OY=l0("__setPluralRules"),FY=l0("__injectWithOption"),sP=l0("__dispose");function zw(e){if(!xa(e)||kg(e))return e;for(const i in e)if(xm(e,i))if(!i.includes("."))xa(e[i])&&zw(e[i]);else{const s=i.split("."),l=s.length-1;let p=e,_=!1;for(let b=0;b<l;b++){if(s[b]==="__proto__")throw new Error(`unsafe key: ${s[b]}`);if(s[b]in p||(p[s[b]]=ka()),!xa(p[s[b]])){_=!0;break}p=p[s[b]]}if(_||(kg(p)?n6.includes(s[l])||delete e[i]:(p[s[l]]=e[i],delete e[i])),!kg(p)){const b=p[s[l]];xa(b)&&zw(b)}}return e}function f6(e,i){const{messages:s,__i18n:l,messageResolver:p,flatJson:_}=i,b=Qo(s)?s:cc(l)?ka():{[e]:ka()};if(cc(l)&&l.forEach(t=>{if("locale"in t&&"resource"in t){const{locale:P,resource:O}=t;P?(b[P]=b[P]||ka(),Gx(O,b[P])):Gx(O,b)}else Fr(t)&&Gx(JSON.parse(t),b)}),p==null&&_)for(const t in b)xm(b,t)&&zw(b[t]);return b}function BY(e){return e.type}function NY(e,i,s){let l=xa(i.messages)?i.messages:ka();"__i18nGlobal"in s&&(l=f6(e.locale.value,{messages:l,__i18n:s.__i18nGlobal}));const p=Object.keys(l);p.length&&p.forEach(_=>{e.mergeLocaleMessage(_,l[_])});{if(xa(i.datetimeFormats)){const _=Object.keys(i.datetimeFormats);_.length&&_.forEach(b=>{e.mergeDateTimeFormat(b,i.datetimeFormats[b])})}if(xa(i.numberFormats)){const _=Object.keys(i.numberFormats);_.length&&_.forEach(b=>{e.mergeNumberFormat(b,i.numberFormats[b])})}}}function _3(e){return tr(t0,null,e,0)}function p6(){return ba()}const y3=()=>[],VY=()=>!1;let v3=0;function x3(e){return((i,s,l,p)=>e(s,l,p6()||void 0,p))}function m6(e={}){const{__root:i,__injectWithOption:s}=e,l=i===void 0,p=e.flatJson,_=pE?an:so;let b=ql(e.inheritLocale)?e.inheritLocale:!0;const t=_(i&&b?i.locale.value:Fr(e.locale)?e.locale:_E),P=_(i&&b?i.fallbackLocale.value:Fr(e.fallbackLocale)||cc(e.fallbackLocale)||Qo(e.fallbackLocale)||e.fallbackLocale===!1?e.fallbackLocale:t.value),O=_(f6(t.value,e)),F=_(Qo(e.datetimeFormats)?e.datetimeFormats:{[t.value]:{}}),$=_(Qo(e.numberFormats)?e.numberFormats:{[t.value]:{}});let W=i?i.missingWarn:ql(e.missingWarn)||mE(e.missingWarn)?e.missingWarn:!0,Y=i?i.fallbackWarn:ql(e.fallbackWarn)||mE(e.fallbackWarn)?e.fallbackWarn:!0,ae=i?i.fallbackRoot:ql(e.fallbackRoot)?e.fallbackRoot:!0,se=!!e.fallbackFormat,ie=pl(e.missing)?e.missing:null,pe=pl(e.missing)?x3(e.missing):null,ye=pl(e.postTranslation)?e.postTranslation:null,de=i?i.warnHtmlMessage:ql(e.warnHtmlMessage)?e.warnHtmlMessage:!0,Ee=!!e.escapeParameter;const Pe=i?i.modifiers:Qo(e.modifiers)?e.modifiers:{};let Ze=e.pluralRules||i&&i.pluralRules,We;We=(()=>{l&&l3(null);const Bt={version:zY,locale:t.value,fallbackLocale:P.value,messages:O.value,modifiers:Pe,pluralRules:Ze,missing:pe===null?void 0:pe,missingWarn:W,fallbackWarn:Y,fallbackFormat:se,unresolving:!0,postTranslation:ye===null?void 0:ye,warnHtmlMessage:de,escapeParameter:Ee,messageResolver:e.messageResolver,messageCompiler:e.messageCompiler,__meta:{framework:"vue"}};Bt.datetimeFormats=F.value,Bt.numberFormats=$.value,Bt.__datetimeFormatters=Qo(We)?We.__datetimeFormatters:void 0,Bt.__numberFormatters=Qo(We)?We.__numberFormatters:void 0;const Ii=xY(Bt);return l&&l3(Ii),Ii})(),G1(We,t.value,P.value);function Ye(){return[t.value,P.value,O.value,F.value,$.value]}const ct=Ei({get:()=>t.value,set:Bt=>{We.locale=Bt,t.value=Bt}}),Lt=Ei({get:()=>P.value,set:Bt=>{We.fallbackLocale=Bt,P.value=Bt,G1(We,t.value,Bt)}}),Ht=Ei(()=>O.value),ci=Ei(()=>F.value),Wt=Ei(()=>$.value);function $t(){return pl(ye)?ye:null}function Dt(Bt){ye=Bt,We.postTranslation=Bt}function Ft(){return ie}function vt(Bt){Bt!==null&&(pe=x3(Bt)),ie=Bt,We.missing=pe}const wi=(Bt,Ii,qt,Ne,Ge,Ke)=>{Ye();let At;try{l||(We.fallbackContext=i?vY():void 0),At=Bt(We)}finally{l||(We.fallbackContext=void 0)}if(qt!=="translate exists"&&Bc(At)&&At===aI||qt==="translate exists"&&!At){const[jt,bi]=Ii();return i&&ae?Ne(i):Ge(jt)}else{if(Ke(At))return At;throw Mm(Dp.UNEXPECTED_RETURN_TYPE)}};function Qi(...Bt){return wi(Ii=>Reflect.apply(g3,null,[Ii,...Bt]),()=>tP(...Bt),"translate",Ii=>Reflect.apply(Ii.t,Ii,[...Bt]),Ii=>Ii,Ii=>Fr(Ii))}function wn(...Bt){const[Ii,qt,Ne]=Bt;if(Ne&&!xa(Ne))throw Mm(Dp.INVALID_ARGUMENT);return Qi(Ii,qt,xc({resolvedMessage:!0},Ne||{}))}function qn(...Bt){return wi(Ii=>Reflect.apply(u3,null,[Ii,...Bt]),()=>QA(...Bt),"datetime format",Ii=>Reflect.apply(Ii.d,Ii,[...Bt]),()=>o3,Ii=>Fr(Ii)||cc(Ii))}function Fn(...Bt){return wi(Ii=>Reflect.apply(d3,null,[Ii,...Bt]),()=>eP(...Bt),"number format",Ii=>Reflect.apply(Ii.n,Ii,[...Bt]),()=>o3,Ii=>Fr(Ii)||cc(Ii))}function mr(Bt){return Bt.map(Ii=>Fr(Ii)||Bc(Ii)||ql(Ii)?_3(String(Ii)):Ii)}const Hr={normalize:mr,interpolate:Bt=>Bt,type:"vnode"};function ti(...Bt){return wi(Ii=>{let qt;const Ne=Ii;try{Ne.processor=Hr,qt=Reflect.apply(g3,null,[Ne,...Bt])}finally{Ne.processor=null}return qt},()=>tP(...Bt),"translate",Ii=>Ii[iP](...Bt),Ii=>[_3(Ii)],Ii=>cc(Ii))}function sn(...Bt){return wi(Ii=>Reflect.apply(d3,null,[Ii,...Bt]),()=>eP(...Bt),"number format",Ii=>Ii[rP](...Bt),y3,Ii=>Fr(Ii)||cc(Ii))}function Gi(...Bt){return wi(Ii=>Reflect.apply(u3,null,[Ii,...Bt]),()=>QA(...Bt),"datetime format",Ii=>Ii[nP](...Bt),y3,Ii=>Fr(Ii)||cc(Ii))}function gn(Bt){Ze=Bt,We.pluralRules=Ze}function nr(Bt,Ii){return wi(()=>{if(!Bt)return!1;const qt=Fr(Ii)?Ii:t.value,Ne=Gt(qt),Ge=We.messageResolver(Ne,Bt);return kg(Ge)||G_(Ge)||Fr(Ge)},()=>[Bt],"translate exists",qt=>Reflect.apply(qt.te,qt,[Bt,Ii]),VY,qt=>ql(qt))}function Ur(Bt){let Ii=null;const qt=r6(We,P.value,t.value);for(let Ne=0;Ne<qt.length;Ne++){const Ge=O.value[qt[Ne]]||{},Ke=We.messageResolver(Ge,Bt);if(Ke!=null){Ii=Ke;break}}return Ii}function St(Bt){const Ii=Ur(Bt);return Ii??(i?i.tm(Bt)||{}:{})}function Gt(Bt){return O.value[Bt]||{}}function Ai(Bt,Ii){if(p){const qt={[Bt]:Ii};for(const Ne in qt)xm(qt,Ne)&&zw(qt[Ne]);Ii=qt[Bt]}O.value[Bt]=Ii,We.messages=O.value}function hn(Bt,Ii){O.value[Bt]=O.value[Bt]||{};const qt={[Bt]:Ii};if(p)for(const Ne in qt)xm(qt,Ne)&&zw(qt[Ne]);Ii=qt[Bt],Gx(Ii,O.value[Bt]),We.messages=O.value}function Ui(Bt){return F.value[Bt]||{}}function pt(Bt,Ii){F.value[Bt]=Ii,We.datetimeFormats=F.value,h3(We,Bt,Ii)}function Ot(Bt,Ii){F.value[Bt]=xc(F.value[Bt]||{},Ii),We.datetimeFormats=F.value,h3(We,Bt,Ii)}function vi(Bt){return $.value[Bt]||{}}function qi(Bt,Ii){$.value[Bt]=Ii,We.numberFormats=$.value,f3(We,Bt,Ii)}function on(Bt,Ii){$.value[Bt]=xc($.value[Bt]||{},Ii),We.numberFormats=$.value,f3(We,Bt,Ii)}v3++,i&&pE&&(Qn(i.locale,Bt=>{b&&(t.value=Bt,We.locale=Bt,G1(We,t.value,P.value))}),Qn(i.fallbackLocale,Bt=>{b&&(P.value=Bt,We.fallbackLocale=Bt,G1(We,t.value,P.value))}));const Hi={id:v3,locale:ct,fallbackLocale:Lt,get inheritLocale(){return b},set inheritLocale(Bt){b=Bt,Bt&&i&&(t.value=i.locale.value,P.value=i.fallbackLocale.value,G1(We,t.value,P.value))},get availableLocales(){return Object.keys(O.value).sort()},messages:Ht,get modifiers(){return Pe},get pluralRules(){return Ze||{}},get isGlobal(){return l},get missingWarn(){return W},set missingWarn(Bt){W=Bt,We.missingWarn=W},get fallbackWarn(){return Y},set fallbackWarn(Bt){Y=Bt,We.fallbackWarn=Y},get fallbackRoot(){return ae},set fallbackRoot(Bt){ae=Bt},get fallbackFormat(){return se},set fallbackFormat(Bt){se=Bt,We.fallbackFormat=se},get warnHtmlMessage(){return de},set warnHtmlMessage(Bt){de=Bt,We.warnHtmlMessage=Bt},get escapeParameter(){return Ee},set escapeParameter(Bt){Ee=Bt,We.escapeParameter=Bt},t:Qi,getLocaleMessage:Gt,setLocaleMessage:Ai,mergeLocaleMessage:hn,getPostTranslationHandler:$t,setPostTranslationHandler:Dt,getMissingHandler:Ft,setMissingHandler:vt,[OY]:gn};return Hi.datetimeFormats=ci,Hi.numberFormats=Wt,Hi.rt=wn,Hi.te=nr,Hi.tm=St,Hi.d=qn,Hi.n=Fn,Hi.getDateTimeFormat=Ui,Hi.setDateTimeFormat=pt,Hi.mergeDateTimeFormat=Ot,Hi.getNumberFormat=vi,Hi.setNumberFormat=qi,Hi.mergeNumberFormat=on,Hi[FY]=s,Hi[iP]=ti,Hi[nP]=Gi,Hi[rP]=sn,Hi}const MM={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:e=>e==="parent"||e==="global",default:"parent"},i18n:{type:Object}};function jY({slots:e},i){return i.length===1&&i[0]==="default"?(e.default?e.default():[]).reduce((l,p)=>[...l,...p.type===qs?p.children:[p]],[]):i.reduce((s,l)=>{const p=e[l];return p&&(s[l]=p()),s},ka())}function g6(){return qs}const UY=kr({name:"i18n-t",props:xc({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:e=>Bc(e)||!isNaN(e)}},MM),setup(e,i){const{slots:s,attrs:l}=i,p=e.i18n||h0({useScope:e.scope,__useComponent:!0});return()=>{const _=Object.keys(s).filter($=>$[0]!=="_"),b=ka();e.locale&&(b.locale=e.locale),e.plural!==void 0&&(b.plural=Fr(e.plural)?+e.plural:e.plural);const t=jY(i,_),P=p[iP](e.keypath,t,b),O=xc(ka(),l),F=Fr(e.tag)||xa(e.tag)?e.tag:g6();return Ns(F,O,P)}}}),b3=UY;function $Y(e){return cc(e)&&!Fr(e[0])}function _6(e,i,s,l){const{slots:p,attrs:_}=i;return()=>{const b={part:!0};let t=ka();e.locale&&(b.locale=e.locale),Fr(e.format)?b.key=e.format:xa(e.format)&&(Fr(e.format.key)&&(b.key=e.format.key),t=Object.keys(e.format).reduce((W,Y)=>s.includes(Y)?xc(ka(),W,{[Y]:e.format[Y]}):W,ka()));const P=l(e.value,b,t);let O=[b.key];cc(P)?O=P.map((W,Y)=>{const ae=p[W.type],se=ae?ae({[W.type]:W.value,index:Y,parts:P}):[W.value];return $Y(se)&&(se[0].key=`${W.type}-${Y}`),se}):Fr(P)&&(O=[P]);const F=xc(ka(),_),$=Fr(e.tag)||xa(e.tag)?e.tag:g6();return Ns($,F,O)}}const GY=kr({name:"i18n-n",props:xc({value:{type:Number,required:!0},format:{type:[String,Object]}},MM),setup(e,i){const s=e.i18n||h0({useScope:e.scope,__useComponent:!0});return _6(e,i,u6,(...l)=>s[rP](...l))}}),w3=GY;function qY(e,i){const s=e;if(e.mode==="composition")return s.__getInstance(i)||e.global;{const l=s.__getInstance(i);return l!=null?l.__composer:e.global.__composer}}function HY(e){const i=b=>{const{instance:t,value:P}=b;if(!t||!t.$)throw Mm(Dp.UNEXPECTED_ERROR);const O=qY(e,t.$),F=T3(P);return[Reflect.apply(O.t,O,[...S3(F)]),O]};return{created:(b,t)=>{const[P,O]=i(t);pE&&e.global===O&&(b.__i18nWatcher=Qn(O.locale,()=>{t.instance&&t.instance.$forceUpdate()})),b.__composer=O,b.textContent=P},unmounted:b=>{pE&&b.__i18nWatcher&&(b.__i18nWatcher(),b.__i18nWatcher=void 0,delete b.__i18nWatcher),b.__composer&&(b.__composer=void 0,delete b.__composer)},beforeUpdate:(b,{value:t})=>{if(b.__composer){const P=b.__composer,O=T3(t);b.textContent=Reflect.apply(P.t,P,[...S3(O)])}},getSSRProps:b=>{const[t]=i(b);return{textContent:t}}}}function T3(e){if(Fr(e))return{path:e};if(Qo(e)){if(!("path"in e))throw Mm(Dp.REQUIRED_VALUE,"path");return e}else throw Mm(Dp.INVALID_VALUE)}function S3(e){const{path:i,locale:s,args:l,choice:p,plural:_}=e,b={},t=l||{};return Fr(s)&&(b.locale=s),Bc(p)&&(b.plural=p),Bc(_)&&(b.plural=_),[i,t,b]}function WY(e,i,...s){const l=Qo(s[0])?s[0]:{};(!ql(l.globalInstall)||l.globalInstall)&&([b3.name,"I18nT"].forEach(_=>e.component(_,b3)),[w3.name,"I18nN"].forEach(_=>e.component(_,w3)),[I3.name,"I18nD"].forEach(_=>e.component(_,I3))),e.directive("t",HY(i))}const ZY=l0("global-vue-i18n");function XY(e={}){const i=ql(e.globalInjection)?e.globalInjection:!0,s=new Map,[l,p]=YY(e),_=l0("");function b(F){return s.get(F)||null}function t(F,$){s.set(F,$)}function P(F){s.delete(F)}const O={get mode(){return"composition"},async install(F,...$){if(F.__VUE_I18N_SYMBOL__=_,F.provide(F.__VUE_I18N_SYMBOL__,O),Qo($[0])){const ae=$[0];O.__composerExtend=ae.__composerExtend,O.__vueI18nExtend=ae.__vueI18nExtend}let W=null;i&&(W=rK(F,O.global)),WY(F,O,...$);const Y=F.unmount;F.unmount=()=>{W&&W(),O.dispose(),Y()}},get global(){return p},dispose(){l.stop()},__instances:s,__getInstance:b,__setInstance:t,__deleteInstance:P};return O}function h0(e={}){const i=p6();if(i==null)throw Mm(Dp.MUST_BE_CALL_SETUP_TOP);if(!i.isCE&&i.appContext.app!=null&&!i.appContext.app.__VUE_I18N_SYMBOL__)throw Mm(Dp.NOT_INSTALLED);const s=KY(i),l=QY(s),p=BY(i),_=JY(e,p);if(_==="global")return NY(l,e,p),l;if(_==="parent"){let P=eK(s,i,e.__useComponent);return P==null&&(P=l),P}const b=s;let t=b.__getInstance(i);if(t==null){const P=xc({},e);"__i18n"in p&&(P.__i18n=p.__i18n),l&&(P.__root=l),t=m6(P),b.__composerExtend&&(t[sP]=b.__composerExtend(t)),iK(b,i,t),b.__setInstance(i,t)}return t}function YY(e,i){const s=s0(),l=s.run(()=>m6(e));if(l==null)throw Mm(Dp.UNEXPECTED_ERROR);return[s,l]}function KY(e){const i=Fo(e.isCE?ZY:e.appContext.app.__VUE_I18N_SYMBOL__);if(!i)throw Mm(e.isCE?Dp.NOT_INSTALLED_WITH_PROVIDE:Dp.UNEXPECTED_ERROR);return i}function JY(e,i){return tI(e)?"__i18n"in i?"local":"global":e.useScope?e.useScope:"local"}function QY(e){return e.mode==="composition"?e.global:e.global.__composer}function eK(e,i,s=!1){let l=null;const p=i.root;let _=tK(i,s);for(;_!=null;){const b=e;if(e.mode==="composition"&&(l=b.__getInstance(_)),l!=null||p===_)break;_=_.parent}return l}function tK(e,i=!1){return e==null?null:i&&e.vnode.ctx||e.parent}function iK(e,i,s){La(()=>{},i),ru(()=>{const l=s;e.__deleteInstance(i);const p=l[sP];p&&(p(),delete l[sP])},i)}const nK=["locale","fallbackLocale","availableLocales"],E3=["t","rt","d","n","tm","te"];function rK(e,i){const s=Object.create(null);return nK.forEach(p=>{const _=Object.getOwnPropertyDescriptor(i,p);if(!_)throw Mm(Dp.UNEXPECTED_ERROR);const b=Wo(_.value)?{get(){return _.value.value},set(t){_.value.value=t}}:{get(){return _.get&&_.get()}};Object.defineProperty(s,p,b)}),e.config.globalProperties.$i18n=s,E3.forEach(p=>{const _=Object.getOwnPropertyDescriptor(i,p);if(!_||!_.value)throw Mm(Dp.UNEXPECTED_ERROR);Object.defineProperty(e.config.globalProperties,`$${p}`,_)}),()=>{delete e.config.globalProperties.$i18n,E3.forEach(p=>{delete e.config.globalProperties[`$${p}`]})}}const sK=kr({name:"i18n-d",props:xc({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},MM),setup(e,i){const s=e.i18n||h0({useScope:e.scope,__useComponent:!0});return _6(e,i,c6,(...l)=>s[nP](...l))}}),I3=sK;gY(tY);_Y(fY);yY(r6);function C3(e=Vs()){const i=sI(e);return s=>{if(s!=null)return i.getRouteBaseName(s)||void 0}}function oK(e=Vs()){const i=sI(e);return(s,l)=>B4(i,s,l)}function aK(e=Vs()){const i=sI(e);return(s,l)=>N4(i,s,l)}function y6(e=Vs()){const i=sI(e);return s=>j4(i,s)}const A3="nuxt-i18n-slp",lK=new RegExp([`<!--${A3}-\\[(\\w+)\\]-->`,".+?",`<!--/${A3}-->`].join(""),"g"),cK=ol({name:"i18n:plugin:switch-locale-path-ssr",dependsOn:["i18n:plugin"],setup(e){const i=Vs(e._id),s=y6(i);i.hook("app:rendered",l=>{l.renderResult?.html!=null&&(l.renderResult.html=l.renderResult.html.replaceAll(lK,(p,_)=>{const b=encodeURI(s(_??""));return p.replace(/href="([^"]+)"/,`href="${b||"#"}" `)}))})}}),uK=ol({name:"i18n:plugin:route-locale-detect",dependsOn:["i18n:plugin"],async setup(e){let i,s;const l=Vs(e._id),p=SM(l),_=W4();[i,s]=Mg(()=>l.runWithContext(()=>Z4(l,p.initial&&_.value||xX(l,l.$router.currentRoute.value)))),await i,s()}}),hK=ol({name:"i18n:plugin:preload",dependsOn:["i18n:plugin"],async setup(e){}});function dK(e,{extendComposer:i,extendComposerInstance:s}){const l=s0(),p=e.install.bind(e);e.install=(_,...b)=>{const t=xc({},b[0]);t.__composerExtend=O=>(s(O,YT(e)),()=>{}),e.mode==="legacy"&&(t.__vueI18nExtend=O=>(s(O,YT(O)),()=>{})),Reflect.apply(p,e,[_,t]);const P=YT(e);if(l.run(()=>{i(P),e.mode==="legacy"&&"__composer"in e.global&&s(e.global,YT(e.global))}),e.mode==="composition"&&_.config.globalProperties.$i18n!=null&&s(_.config.globalProperties.$i18n,P),_.unmount){const O=_.unmount.bind(_);_.unmount=()=>{l.stop(),O()}}}}const fK=async e=>{const i=await HZ(GZ);i.locale=e||i.locale||"en-US",i.defaultLocale=e,i.fallbackLocale??=!1,i.messages??={};for(const s of Lw)i.messages[s]??={};return i},pK=ol({name:"i18n:plugin",parallel:!1,async setup(e){let i,s;Object.defineProperty(e.versions,"nuxtI18n",{get:()=>"10.1.0"});const l=Vs(e._id),p=nI(l),_=l.ssrContext?.event?.context?.nuxtI18n?.vueI18nOptions,b=sX(M4().host)||p.defaultLocale||"",t=_||([i,s]=Mg(()=>fK(b)),i=await i,s(),i),P=H4();P.value??=iX(t.fallbackLocale),Lw.map(W=>`/_i18n/kF8Cos2X/${W}/messages.json`);const O=XY(t),F=EM(void 0,rI(l),l),$=aX(l,O,t.defaultLocale);l._nuxtI18n=$,dK(O,{extendComposer(W){W.locales=Ei(()=>p.locales),W.localeCodes=Ei(()=>Lw);const Y=an($.getBaseUrl());W.baseUrl=Ei(()=>Y.value),Qn(W.locale,()=>Y.value=$.getBaseUrl()),W.strategy="no_prefix",W.localeProperties=Ei(()=>t2.find(ae=>ae.code===W.locale.value)||{code:W.locale.value}),W.setLocale=async ae=>{await Z4(l,ae),await l.runWithContext(()=>(l.$router.currentRoute.value,void 0))},W.loadLocaleMessages=$.loadMessages,W.differentDomains=!1,W.defaultLocale=t.defaultLocale,W.getBrowserLocale=()=>JR(F.navigator()),W.getLocaleCookie=()=>JR(F.cookie()),W.setLocaleCookie=$.setCookieLocale,W.finalizePendingLocaleChange=async()=>{O.__pendingLocale&&await O.__resolvePendingLocalePromise?.()},W.waitForPendingLocaleChange=async()=>{await O?.__pendingLocalePromise}},extendComposerInstance(W,Y){const ae=[["locales",()=>Y.locales],["localeCodes",()=>Y.localeCodes],["baseUrl",()=>Y.baseUrl],["strategy",()=>"no_prefix"],["localeProperties",()=>Y.localeProperties],["setLocale",()=>async se=>Reflect.apply(Y.setLocale,Y,[se])],["loadLocaleMessages",()=>async se=>Reflect.apply(Y.loadLocaleMessages,Y,[se])],["differentDomains",()=>!1],["defaultLocale",()=>Y.defaultLocale],["getBrowserLocale",()=>()=>Reflect.apply(Y.getBrowserLocale,Y,[])],["getLocaleCookie",()=>()=>Reflect.apply(Y.getLocaleCookie,Y,[])],["setLocaleCookie",()=>se=>Reflect.apply(Y.setLocaleCookie,Y,[se])],["finalizePendingLocaleChange",()=>()=>Reflect.apply(Y.finalizePendingLocaleChange,Y,[])],["waitForPendingLocaleChange",()=>()=>Reflect.apply(Y.waitForPendingLocaleChange,Y,[])]];for(const[se,ie]of ae)Object.defineProperty(W,se,{get:ie})}}),l.vueApp.use(O),Object.defineProperty(l,"$i18n",{get:()=>TM(O)}),l.provide("localeHead",W=>OZ(l._nuxtI18n.composableCtx,W)),l.provide("localePath",oK(l)),l.provide("localeRoute",aK(l)),l.provide("routeBaseName",C3(l)),l.provide("getRouteBaseName",C3(l)),l.provide("switchLocalePath",y6(l))}});function Uf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var CS={exports:{}},mK=CS.exports,P3;function lI(){return P3||(P3=1,(function(e,i){(function(s,l){e.exports=l()})(mK,(function(){var s=1e3,l=6e4,p=36e5,_="millisecond",b="second",t="minute",P="hour",O="day",F="week",$="month",W="quarter",Y="year",ae="date",se="Invalid Date",ie=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,pe=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ye={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(Wt){var $t=["th","st","nd","rd"],Dt=Wt%100;return"["+Wt+($t[(Dt-20)%10]||$t[Dt]||$t[0])+"]"}},de=function(Wt,$t,Dt){var Ft=String(Wt);return!Ft||Ft.length>=$t?Wt:""+Array($t+1-Ft.length).join(Dt)+Wt},Ee={s:de,z:function(Wt){var $t=-Wt.utcOffset(),Dt=Math.abs($t),Ft=Math.floor(Dt/60),vt=Dt%60;return($t<=0?"+":"-")+de(Ft,2,"0")+":"+de(vt,2,"0")},m:function Wt($t,Dt){if($t.date()<Dt.date())return-Wt(Dt,$t);var Ft=12*(Dt.year()-$t.year())+(Dt.month()-$t.month()),vt=$t.clone().add(Ft,$),wi=Dt-vt<0,Qi=$t.clone().add(Ft+(wi?-1:1),$);return+(-(Ft+(Dt-vt)/(wi?vt-Qi:Qi-vt))||0)},a:function(Wt){return Wt<0?Math.ceil(Wt)||0:Math.floor(Wt)},p:function(Wt){return{M:$,y:Y,w:F,d:O,D:ae,h:P,m:t,s:b,ms:_,Q:W}[Wt]||String(Wt||"").toLowerCase().replace(/s$/,"")},u:function(Wt){return Wt===void 0}},Pe="en",Ze={};Ze[Pe]=ye;var We="$isDayjsObject",je=function(Wt){return Wt instanceof Ht||!(!Wt||!Wt[We])},Ye=function Wt($t,Dt,Ft){var vt;if(!$t)return Pe;if(typeof $t=="string"){var wi=$t.toLowerCase();Ze[wi]&&(vt=wi),Dt&&(Ze[wi]=Dt,vt=wi);var Qi=$t.split("-");if(!vt&&Qi.length>1)return Wt(Qi[0])}else{var wn=$t.name;Ze[wn]=$t,vt=wn}return!Ft&&vt&&(Pe=vt),vt||!Ft&&Pe},ct=function(Wt,$t){if(je(Wt))return Wt.clone();var Dt=typeof $t=="object"?$t:{};return Dt.date=Wt,Dt.args=arguments,new Ht(Dt)},Lt=Ee;Lt.l=Ye,Lt.i=je,Lt.w=function(Wt,$t){return ct(Wt,{locale:$t.$L,utc:$t.$u,x:$t.$x,$offset:$t.$offset})};var Ht=(function(){function Wt(Dt){this.$L=Ye(Dt.locale,null,!0),this.parse(Dt),this.$x=this.$x||Dt.x||{},this[We]=!0}var $t=Wt.prototype;return $t.parse=function(Dt){this.$d=(function(Ft){var vt=Ft.date,wi=Ft.utc;if(vt===null)return new Date(NaN);if(Lt.u(vt))return new Date;if(vt instanceof Date)return new Date(vt);if(typeof vt=="string"&&!/Z$/i.test(vt)){var Qi=vt.match(ie);if(Qi){var wn=Qi[2]-1||0,qn=(Qi[7]||"0").substring(0,3);return wi?new Date(Date.UTC(Qi[1],wn,Qi[3]||1,Qi[4]||0,Qi[5]||0,Qi[6]||0,qn)):new Date(Qi[1],wn,Qi[3]||1,Qi[4]||0,Qi[5]||0,Qi[6]||0,qn)}}return new Date(vt)})(Dt),this.init()},$t.init=function(){var Dt=this.$d;this.$y=Dt.getFullYear(),this.$M=Dt.getMonth(),this.$D=Dt.getDate(),this.$W=Dt.getDay(),this.$H=Dt.getHours(),this.$m=Dt.getMinutes(),this.$s=Dt.getSeconds(),this.$ms=Dt.getMilliseconds()},$t.$utils=function(){return Lt},$t.isValid=function(){return this.$d.toString()!==se},$t.isSame=function(Dt,Ft){var vt=ct(Dt);return this.startOf(Ft)<=vt&&vt<=this.endOf(Ft)},$t.isAfter=function(Dt,Ft){return ct(Dt)<this.startOf(Ft)},$t.isBefore=function(Dt,Ft){return this.endOf(Ft)<ct(Dt)},$t.$g=function(Dt,Ft,vt){return Lt.u(Dt)?this[Ft]:this.set(vt,Dt)},$t.unix=function(){return Math.floor(this.valueOf()/1e3)},$t.valueOf=function(){return this.$d.getTime()},$t.startOf=function(Dt,Ft){var vt=this,wi=!!Lt.u(Ft)||Ft,Qi=Lt.p(Dt),wn=function(Gi,gn){var nr=Lt.w(vt.$u?Date.UTC(vt.$y,gn,Gi):new Date(vt.$y,gn,Gi),vt);return wi?nr:nr.endOf(O)},qn=function(Gi,gn){return Lt.w(vt.toDate()[Gi].apply(vt.toDate("s"),(wi?[0,0,0,0]:[23,59,59,999]).slice(gn)),vt)},Fn=this.$W,mr=this.$M,Sr=this.$D,Hr="set"+(this.$u?"UTC":"");switch(Qi){case Y:return wi?wn(1,0):wn(31,11);case $:return wi?wn(1,mr):wn(0,mr+1);case F:var ti=this.$locale().weekStart||0,sn=(Fn<ti?Fn+7:Fn)-ti;return wn(wi?Sr-sn:Sr+(6-sn),mr);case O:case ae:return qn(Hr+"Hours",0);case P:return qn(Hr+"Minutes",1);case t:return qn(Hr+"Seconds",2);case b:return qn(Hr+"Milliseconds",3);default:return this.clone()}},$t.endOf=function(Dt){return this.startOf(Dt,!1)},$t.$set=function(Dt,Ft){var vt,wi=Lt.p(Dt),Qi="set"+(this.$u?"UTC":""),wn=(vt={},vt[O]=Qi+"Date",vt[ae]=Qi+"Date",vt[$]=Qi+"Month",vt[Y]=Qi+"FullYear",vt[P]=Qi+"Hours",vt[t]=Qi+"Minutes",vt[b]=Qi+"Seconds",vt[_]=Qi+"Milliseconds",vt)[wi],qn=wi===O?this.$D+(Ft-this.$W):Ft;if(wi===$||wi===Y){var Fn=this.clone().set(ae,1);Fn.$d[wn](qn),Fn.init(),this.$d=Fn.set(ae,Math.min(this.$D,Fn.daysInMonth())).$d}else wn&&this.$d[wn](qn);return this.init(),this},$t.set=function(Dt,Ft){return this.clone().$set(Dt,Ft)},$t.get=function(Dt){return this[Lt.p(Dt)]()},$t.add=function(Dt,Ft){var vt,wi=this;Dt=Number(Dt);var Qi=Lt.p(Ft),wn=function(mr){var Sr=ct(wi);return Lt.w(Sr.date(Sr.date()+Math.round(mr*Dt)),wi)};if(Qi===$)return this.set($,this.$M+Dt);if(Qi===Y)return this.set(Y,this.$y+Dt);if(Qi===O)return wn(1);if(Qi===F)return wn(7);var qn=(vt={},vt[t]=l,vt[P]=p,vt[b]=s,vt)[Qi]||1,Fn=this.$d.getTime()+Dt*qn;return Lt.w(Fn,this)},$t.subtract=function(Dt,Ft){return this.add(-1*Dt,Ft)},$t.format=function(Dt){var Ft=this,vt=this.$locale();if(!this.isValid())return vt.invalidDate||se;var wi=Dt||"YYYY-MM-DDTHH:mm:ssZ",Qi=Lt.z(this),wn=this.$H,qn=this.$m,Fn=this.$M,mr=vt.weekdays,Sr=vt.months,Hr=vt.meridiem,ti=function(gn,nr,Ur,St){return gn&&(gn[nr]||gn(Ft,wi))||Ur[nr].slice(0,St)},sn=function(gn){return Lt.s(wn%12||12,gn,"0")},Gi=Hr||function(gn,nr,Ur){var St=gn<12?"AM":"PM";return Ur?St.toLowerCase():St};return wi.replace(pe,(function(gn,nr){return nr||(function(Ur){switch(Ur){case"YY":return String(Ft.$y).slice(-2);case"YYYY":return Lt.s(Ft.$y,4,"0");case"M":return Fn+1;case"MM":return Lt.s(Fn+1,2,"0");case"MMM":return ti(vt.monthsShort,Fn,Sr,3);case"MMMM":return ti(Sr,Fn);case"D":return Ft.$D;case"DD":return Lt.s(Ft.$D,2,"0");case"d":return String(Ft.$W);case"dd":return ti(vt.weekdaysMin,Ft.$W,mr,2);case"ddd":return ti(vt.weekdaysShort,Ft.$W,mr,3);case"dddd":return mr[Ft.$W];case"H":return String(wn);case"HH":return Lt.s(wn,2,"0");case"h":return sn(1);case"hh":return sn(2);case"a":return Gi(wn,qn,!0);case"A":return Gi(wn,qn,!1);case"m":return String(qn);case"mm":return Lt.s(qn,2,"0");case"s":return String(Ft.$s);case"ss":return Lt.s(Ft.$s,2,"0");case"SSS":return Lt.s(Ft.$ms,3,"0");case"Z":return Qi}return null})(gn)||Qi.replace(":","")}))},$t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$t.diff=function(Dt,Ft,vt){var wi,Qi=this,wn=Lt.p(Ft),qn=ct(Dt),Fn=(qn.utcOffset()-this.utcOffset())*l,mr=this-qn,Sr=function(){return Lt.m(Qi,qn)};switch(wn){case Y:wi=Sr()/12;break;case $:wi=Sr();break;case W:wi=Sr()/3;break;case F:wi=(mr-Fn)/6048e5;break;case O:wi=(mr-Fn)/864e5;break;case P:wi=mr/p;break;case t:wi=mr/l;break;case b:wi=mr/s;break;default:wi=mr}return vt?wi:Lt.a(wi)},$t.daysInMonth=function(){return this.endOf($).$D},$t.$locale=function(){return Ze[this.$L]},$t.locale=function(Dt,Ft){if(!Dt)return this.$L;var vt=this.clone(),wi=Ye(Dt,Ft,!0);return wi&&(vt.$L=wi),vt},$t.clone=function(){return Lt.w(this.$d,this)},$t.toDate=function(){return new Date(this.valueOf())},$t.toJSON=function(){return this.isValid()?this.toISOString():null},$t.toISOString=function(){return this.$d.toISOString()},$t.toString=function(){return this.$d.toUTCString()},Wt})(),ci=Ht.prototype;return ct.prototype=ci,[["$ms",_],["$s",b],["$m",t],["$H",P],["$W",O],["$M",$],["$y",Y],["$D",ae]].forEach((function(Wt){ci[Wt[1]]=function($t){return this.$g($t,Wt[0],Wt[1])}})),ct.extend=function(Wt,$t){return Wt.$i||(Wt($t,Ht,ct),Wt.$i=!0),ct},ct.locale=Ye,ct.isDayjs=je,ct.unix=function(Wt){return ct(1e3*Wt)},ct.en=Ze[Pe],ct.Ls=Ze,ct.p={},ct}))})(CS)),CS.exports}var gK=lI();const zg=Uf(gK);var AS={exports:{}},_K=AS.exports,M3;function yK(){return M3||(M3=1,(function(e,i){(function(s,l){e.exports=l()})(_K,(function(){return function(s,l,p){p.updateLocale=function(_,b){var t=p.Ls[_];if(t)return(b?Object.keys(b):[]).forEach((function(P){t[P]=b[P]})),t}}}))})(AS)),AS.exports}var vK=yK();const xK=Uf(vK);var PS={exports:{}},bK=PS.exports,k3;function wK(){return k3||(k3=1,(function(e,i){(function(s,l){e.exports=l(lI())})(bK,(function(s){function l(b){return b&&typeof b=="object"&&"default"in b?b:{default:b}}var p=l(s),_={name:"zh-cn",weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),ordinal:function(b,t){return t==="W"?b+"":b+""},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDAhmm",LLLL:"YYYYMDddddAhmm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},relativeTime:{future:"%s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},meridiem:function(b,t){var P=100*b+t;return P<600?"":P<900?"":P<1100?"":P<1300?"":P<1800?"":""}};return p.default.locale(_,null,!0),_}))})(PS)),PS.exports}var TK=wK();const SK=Uf(TK);var MS={exports:{}},EK=MS.exports,D3;function IK(){return D3||(D3=1,(function(e,i){(function(s,l){e.exports=l(lI())})(EK,(function(s){function l(b){return b&&typeof b=="object"&&"default"in b?b:{default:b}}var p=l(s),_={name:"zh-hk",months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),ordinal:function(b,t){return t==="W"?b+"":b+""},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiem:function(b,t){var P=100*b+t;return P<600?"":P<900?"":P<1100?"":P<1300?"":P<1800?"":""}};return p.default.locale(_,null,!0),_}))})(MS)),MS.exports}var CK=IK();const AK=Uf(CK);var kS={exports:{}},PK=kS.exports,L3;function MK(){return L3||(L3=1,(function(e,i){(function(s,l){e.exports=l()})(PK,(function(){return{name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(s){var l=["th","st","nd","rd"],p=s%100;return"["+s+(l[(p-20)%10]||l[p]||l[0])+"]"}}}))})(kS)),kS.exports}MK();var DS={exports:{}},kK=DS.exports,R3;function DK(){return R3||(R3=1,(function(e,i){(function(s,l){e.exports=l()})(kK,(function(){return function(s,l,p){s=s||{};var _=l.prototype,b={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function t(O,F,$,W){return _.fromToBase(O,F,$,W)}p.en.relativeTime=b,_.fromToBase=function(O,F,$,W,Y){for(var ae,se,ie,pe=$.$locale().relativeTime||b,ye=s.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],de=ye.length,Ee=0;Ee<de;Ee+=1){var Pe=ye[Ee];Pe.d&&(ae=W?p(O).diff($,Pe.d,!0):$.diff(O,Pe.d,!0));var Ze=(s.rounding||Math.round)(Math.abs(ae));if(ie=ae>0,Ze<=Pe.r||!Pe.r){Ze<=1&&Ee>0&&(Pe=ye[Ee-1]);var We=pe[Pe.l];Y&&(Ze=Y(""+Ze)),se=typeof We=="string"?We.replace("%d",Ze):We(Ze,F,Pe.l,ie);break}}if(F)return se;var je=ie?pe.future:pe.past;return typeof je=="function"?je(se):je.replace("%s",se)},_.to=function(O,F){return t(O,F,this,!0)},_.from=function(O,F){return t(O,F,this)};var P=function(O){return O.$u?p.utc():p()};_.toNow=function(O){return this.to(P(this),O)},_.fromNow=function(O){return this.from(P(this),O)}}}))})(DS)),DS.exports}var LK=DK();const RK=Uf(LK);var LS={exports:{}},zK=LS.exports,z3;function OK(){return z3||(z3=1,(function(e,i){(function(s,l){e.exports=l()})(zK,(function(){var s="minute",l=/[+-]\d\d(?::?\d\d)?/g,p=/([+-]|\d\d)/g;return function(_,b,t){var P=b.prototype;t.utc=function(se){var ie={date:se,utc:!0,args:arguments};return new b(ie)},P.utc=function(se){var ie=t(this.toDate(),{locale:this.$L,utc:!0});return se?ie.add(this.utcOffset(),s):ie},P.local=function(){return t(this.toDate(),{locale:this.$L,utc:!1})};var O=P.parse;P.parse=function(se){se.utc&&(this.$u=!0),this.$utils().u(se.$offset)||(this.$offset=se.$offset),O.call(this,se)};var F=P.init;P.init=function(){if(this.$u){var se=this.$d;this.$y=se.getUTCFullYear(),this.$M=se.getUTCMonth(),this.$D=se.getUTCDate(),this.$W=se.getUTCDay(),this.$H=se.getUTCHours(),this.$m=se.getUTCMinutes(),this.$s=se.getUTCSeconds(),this.$ms=se.getUTCMilliseconds()}else F.call(this)};var $=P.utcOffset;P.utcOffset=function(se,ie){var pe=this.$utils().u;if(pe(se))return this.$u?0:pe(this.$offset)?$.call(this):this.$offset;if(typeof se=="string"&&(se=(function(Pe){Pe===void 0&&(Pe="");var Ze=Pe.match(l);if(!Ze)return null;var We=(""+Ze[0]).match(p)||["-",0,0],je=We[0],Ye=60*+We[1]+ +We[2];return Ye===0?0:je==="+"?Ye:-Ye})(se),se===null))return this;var ye=Math.abs(se)<=16?60*se:se;if(ye===0)return this.utc(ie);var de=this.clone();if(ie)return de.$offset=ye,de.$u=!1,de;var Ee=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(de=this.local().add(ye+Ee,s)).$offset=ye,de.$x.$localOffset=Ee,de};var W=P.format;P.format=function(se){var ie=se||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return W.call(this,ie)},P.valueOf=function(){var se=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*se},P.isUTC=function(){return!!this.$u},P.toISOString=function(){return this.toDate().toISOString()},P.toString=function(){return this.toDate().toUTCString()};var Y=P.toDate;P.toDate=function(se){return se==="s"&&this.$offset?t(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():Y.call(this)};var ae=P.diff;P.diff=function(se,ie,pe){if(se&&this.$u===se.$u)return ae.call(this,se,ie,pe);var ye=this.local(),de=t(se).local();return ae.call(ye,de,ie,pe)}}}))})(LS)),LS.exports}var FK=OK();const BK=Uf(FK);var RS={exports:{}},NK=RS.exports,O3;function VK(){return O3||(O3=1,(function(e,i){(function(s,l){e.exports=l()})(NK,(function(){var s={year:0,month:1,day:2,hour:3,minute:4,second:5},l={};return function(p,_,b){var t,P=function(W,Y,ae){ae===void 0&&(ae={});var se=new Date(W),ie=(function(pe,ye){ye===void 0&&(ye={});var de=ye.timeZoneName||"short",Ee=pe+"|"+de,Pe=l[Ee];return Pe||(Pe=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:pe,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:de}),l[Ee]=Pe),Pe})(Y,ae);return ie.formatToParts(se)},O=function(W,Y){for(var ae=P(W,Y),se=[],ie=0;ie<ae.length;ie+=1){var pe=ae[ie],ye=pe.type,de=pe.value,Ee=s[ye];Ee>=0&&(se[Ee]=parseInt(de,10))}var Pe=se[3],Ze=Pe===24?0:Pe,We=se[0]+"-"+se[1]+"-"+se[2]+" "+Ze+":"+se[4]+":"+se[5]+":000",je=+W;return(b.utc(We).valueOf()-(je-=je%1e3))/6e4},F=_.prototype;F.tz=function(W,Y){W===void 0&&(W=t);var ae,se=this.utcOffset(),ie=this.toDate(),pe=ie.toLocaleString("en-US",{timeZone:W}),ye=Math.round((ie-new Date(pe))/1e3/60),de=15*-Math.round(ie.getTimezoneOffset()/15)-ye;if(!Number(de))ae=this.utcOffset(0,Y);else if(ae=b(pe,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(de,!0),Y){var Ee=ae.utcOffset();ae=ae.add(se-Ee,"minute")}return ae.$x.$timezone=W,ae},F.offsetName=function(W){var Y=this.$x.$timezone||b.tz.guess(),ae=P(this.valueOf(),Y,{timeZoneName:W}).find((function(se){return se.type.toLowerCase()==="timezonename"}));return ae&&ae.value};var $=F.startOf;F.startOf=function(W,Y){if(!this.$x||!this.$x.$timezone)return $.call(this,W,Y);var ae=b(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return $.call(ae,W,Y).tz(this.$x.$timezone,!0)},b.tz=function(W,Y,ae){var se=ae&&Y,ie=ae||Y||t,pe=O(+b(),ie);if(typeof W!="string")return b(W).tz(ie);var ye=(function(Ze,We,je){var Ye=Ze-60*We*1e3,ct=O(Ye,je);if(We===ct)return[Ye,We];var Lt=O(Ye-=60*(ct-We)*1e3,je);return ct===Lt?[Ye,ct]:[Ze-60*Math.min(ct,Lt)*1e3,Math.max(ct,Lt)]})(b.utc(W,se).valueOf(),pe,ie),de=ye[0],Ee=ye[1],Pe=b(de).utcOffset(Ee);return Pe.$x.$timezone=ie,Pe},b.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},b.tz.setDefault=function(W){t=W}}}))})(RS)),RS.exports}var jK=VK();const UK=Uf(jK);var zS={exports:{}},$K=zS.exports,F3;function GK(){return F3||(F3=1,(function(e,i){(function(s,l){e.exports=l()})($K,(function(){var s,l,p=1e3,_=6e4,b=36e5,t=864e5,P=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,O=31536e6,F=2628e6,$=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,W={years:O,months:F,days:t,hours:b,minutes:_,seconds:p,milliseconds:1,weeks:6048e5},Y=function(Ze){return Ze instanceof Ee},ae=function(Ze,We,je){return new Ee(Ze,je,We.$l)},se=function(Ze){return l.p(Ze)+"s"},ie=function(Ze){return Ze<0},pe=function(Ze){return ie(Ze)?Math.ceil(Ze):Math.floor(Ze)},ye=function(Ze){return Math.abs(Ze)},de=function(Ze,We){return Ze?ie(Ze)?{negative:!0,format:""+ye(Ze)+We}:{negative:!1,format:""+Ze+We}:{negative:!1,format:""}},Ee=(function(){function Ze(je,Ye,ct){var Lt=this;if(this.$d={},this.$l=ct,je===void 0&&(this.$ms=0,this.parseFromMilliseconds()),Ye)return ae(je*W[se(Ye)],this);if(typeof je=="number")return this.$ms=je,this.parseFromMilliseconds(),this;if(typeof je=="object")return Object.keys(je).forEach((function(Wt){Lt.$d[se(Wt)]=je[Wt]})),this.calMilliseconds(),this;if(typeof je=="string"){var Ht=je.match($);if(Ht){var ci=Ht.slice(2).map((function(Wt){return Wt!=null?Number(Wt):0}));return this.$d.years=ci[0],this.$d.months=ci[1],this.$d.weeks=ci[2],this.$d.days=ci[3],this.$d.hours=ci[4],this.$d.minutes=ci[5],this.$d.seconds=ci[6],this.calMilliseconds(),this}}return this}var We=Ze.prototype;return We.calMilliseconds=function(){var je=this;this.$ms=Object.keys(this.$d).reduce((function(Ye,ct){return Ye+(je.$d[ct]||0)*W[ct]}),0)},We.parseFromMilliseconds=function(){var je=this.$ms;this.$d.years=pe(je/O),je%=O,this.$d.months=pe(je/F),je%=F,this.$d.days=pe(je/t),je%=t,this.$d.hours=pe(je/b),je%=b,this.$d.minutes=pe(je/_),je%=_,this.$d.seconds=pe(je/p),je%=p,this.$d.milliseconds=je},We.toISOString=function(){var je=de(this.$d.years,"Y"),Ye=de(this.$d.months,"M"),ct=+this.$d.days||0;this.$d.weeks&&(ct+=7*this.$d.weeks);var Lt=de(ct,"D"),Ht=de(this.$d.hours,"H"),ci=de(this.$d.minutes,"M"),Wt=this.$d.seconds||0;this.$d.milliseconds&&(Wt+=this.$d.milliseconds/1e3,Wt=Math.round(1e3*Wt)/1e3);var $t=de(Wt,"S"),Dt=je.negative||Ye.negative||Lt.negative||Ht.negative||ci.negative||$t.negative,Ft=Ht.format||ci.format||$t.format?"T":"",vt=(Dt?"-":"")+"P"+je.format+Ye.format+Lt.format+Ft+Ht.format+ci.format+$t.format;return vt==="P"||vt==="-P"?"P0D":vt},We.toJSON=function(){return this.toISOString()},We.format=function(je){var Ye=je||"YYYY-MM-DDTHH:mm:ss",ct={Y:this.$d.years,YY:l.s(this.$d.years,2,"0"),YYYY:l.s(this.$d.years,4,"0"),M:this.$d.months,MM:l.s(this.$d.months,2,"0"),D:this.$d.days,DD:l.s(this.$d.days,2,"0"),H:this.$d.hours,HH:l.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:l.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:l.s(this.$d.seconds,2,"0"),SSS:l.s(this.$d.milliseconds,3,"0")};return Ye.replace(P,(function(Lt,Ht){return Ht||String(ct[Lt])}))},We.as=function(je){return this.$ms/W[se(je)]},We.get=function(je){var Ye=this.$ms,ct=se(je);return ct==="milliseconds"?Ye%=1e3:Ye=ct==="weeks"?pe(Ye/W[ct]):this.$d[ct],Ye||0},We.add=function(je,Ye,ct){var Lt;return Lt=Ye?je*W[se(Ye)]:Y(je)?je.$ms:ae(je,this).$ms,ae(this.$ms+Lt*(ct?-1:1),this)},We.subtract=function(je,Ye){return this.add(je,Ye,!0)},We.locale=function(je){var Ye=this.clone();return Ye.$l=je,Ye},We.clone=function(){return ae(this.$ms,this)},We.humanize=function(je){return s().add(this.$ms,"ms").locale(this.$l).fromNow(!je)},We.valueOf=function(){return this.asMilliseconds()},We.milliseconds=function(){return this.get("milliseconds")},We.asMilliseconds=function(){return this.as("milliseconds")},We.seconds=function(){return this.get("seconds")},We.asSeconds=function(){return this.as("seconds")},We.minutes=function(){return this.get("minutes")},We.asMinutes=function(){return this.as("minutes")},We.hours=function(){return this.get("hours")},We.asHours=function(){return this.as("hours")},We.days=function(){return this.get("days")},We.asDays=function(){return this.as("days")},We.weeks=function(){return this.get("weeks")},We.asWeeks=function(){return this.as("weeks")},We.months=function(){return this.get("months")},We.asMonths=function(){return this.as("months")},We.years=function(){return this.get("years")},We.asYears=function(){return this.as("years")},Ze})(),Pe=function(Ze,We,je){return Ze.add(We.years()*je,"y").add(We.months()*je,"M").add(We.days()*je,"d").add(We.hours()*je,"h").add(We.minutes()*je,"m").add(We.seconds()*je,"s").add(We.milliseconds()*je,"ms")};return function(Ze,We,je){s=je,l=je().$utils(),je.duration=function(Lt,Ht){var ci=je.locale();return ae(Lt,{$l:ci},Ht)},je.isDuration=Y;var Ye=We.prototype.add,ct=We.prototype.subtract;We.prototype.add=function(Lt,Ht){return Y(Lt)?Pe(this,Lt,1):Ye.bind(this)(Lt,Ht)},We.prototype.subtract=function(Lt,Ht){return Y(Lt)?Pe(this,Lt,-1):ct.bind(this)(Lt,Ht)}}}))})(zS)),zS.exports}var qK=GK();const HK=Uf(qK);var OS={exports:{}},WK=OS.exports,B3;function ZK(){return B3||(B3=1,(function(e,i){(function(s,l){e.exports=l()})(WK,(function(){var s={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(l,p,_){var b=p.prototype,t=b.format;_.en.formats=s,b.format=function(P){P===void 0&&(P="YYYY-MM-DDTHH:mm:ssZ");var O=this.$locale().formats,F=(function($,W){return $.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(Y,ae,se){var ie=se&&se.toUpperCase();return ae||W[se]||s[se]||W[ie].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(pe,ye,de){return ye||de.slice(1)}))}))})(P,O===void 0?{}:O);return t.call(this,F)}}}))})(OS)),OS.exports}var XK=ZK();const YK=Uf(XK);var FS={exports:{}},KK=FS.exports,N3;function JK(){return N3||(N3=1,(function(e,i){(function(s,l){e.exports=l()})(KK,(function(){return function(s,l,p){l.prototype.isBetween=function(_,b,t,P){var O=p(_),F=p(b),$=(P=P||"()")[0]==="(",W=P[1]===")";return($?this.isAfter(O,t):!this.isBefore(O,t))&&(W?this.isBefore(F,t):!this.isAfter(F,t))||($?this.isBefore(O,t):!this.isAfter(O,t))&&(W?this.isAfter(F,t):!this.isBefore(F,t))}}}))})(FS)),FS.exports}var QK=JK();const eJ=Uf(QK);zg.extend(xK);zg.extend(RK);zg.extend(BK);zg.extend(UK);zg.extend(HK);zg.extend(YK);zg.extend(eJ);zg.tz.setDefault("Asia/Shanghai");const tJ=ol(async e=>e.provide("dayjs",zg));function V3(){const e=X_("nuxt-session",()=>null),i=X_("nuxt-auth-ready",()=>!1),s=async()=>{await qR()("/api/_auth/session",{method:"DELETE",onResponse({response:{headers:b}}){}}),e.value=null},l=async()=>{e.value=await qR()("/api/_auth/session",{headers:{accept:"application/json"},retry:!1}).catch(()=>null),i.value||(i.value=!0)},p=b=>{b.key==="temp-nuxt-auth-utils-popup"&&(l(),window.removeEventListener("storage",p))},_=(b,t={})=>{localStorage.setItem("temp-nuxt-auth-utils-popup","true");const P=t.width??960,O=t.height??600,F=(window.top?.outerHeight??0)/2+(window.top?.screenY??0)-O/2,$=(window.top?.outerWidth??0)/2+(window.top?.screenX??0)-P/2;window.open(b,"nuxt-auth-utils-popup",`width=${P}, height=${O}, top=${F}, left=${$}, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no`),window.addEventListener("storage",p)};return{ready:Ei(()=>i.value),loggedIn:Ei(()=>!!e.value?.user),user:Ei(()=>e.value?.user||null),session:e,fetch:l,openInPopup:_,clear:s}}const iJ=ol(async e=>{let i,s;e.payload.serverRendered?(e.payload.prerenderedAt||e.payload.isCached)&&e.hook("app:mounted",async()=>{await V3().fetch()}):([i,s]=Mg(()=>V3().fetch()),await i,s()),localStorage.getItem("temp-nuxt-auth-utils-popup")&&(localStorage.removeItem("temp-nuxt-auth-utils-popup"),e2().value||window.close())}),v6=/^[a-z0-9]+(-[a-z0-9]+)*$/,i2=(e,i,s,l="")=>{const p=e.split(":");if(e.slice(0,1)==="@"){if(p.length<2||p.length>3)return null;l=p.shift().slice(1)}if(p.length>3||!p.length)return null;if(p.length>1){const t=p.pop(),P=p.pop(),O={provider:p.length>0?p[0]:l,prefix:P,name:t};return i&&!BS(O)?null:O}const _=p[0],b=_.split("-");if(b.length>1){const t={provider:l,prefix:b.shift(),name:b.join("-")};return i&&!BS(t)?null:t}if(s&&l===""){const t={provider:l,prefix:"",name:_};return i&&!BS(t,s)?null:t}return null},BS=(e,i)=>e?!!((i&&e.prefix===""||e.prefix)&&e.name):!1,x6=Object.freeze({left:0,top:0,width:16,height:16}),yE=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),db=Object.freeze({...x6,...yE}),oP=Object.freeze({...db,body:"",hidden:!1});function nJ(e,i){const s={};!e.hFlip!=!i.hFlip&&(s.hFlip=!0),!e.vFlip!=!i.vFlip&&(s.vFlip=!0);const l=((e.rotate||0)+(i.rotate||0))%4;return l&&(s.rotate=l),s}function j3(e,i){const s=nJ(e,i);for(const l in oP)l in yE?l in e&&!(l in s)&&(s[l]=yE[l]):l in i?s[l]=i[l]:l in e&&(s[l]=e[l]);return s}function rJ(e,i){const s=e.icons,l=e.aliases||Object.create(null),p=Object.create(null);function _(b){if(s[b])return p[b]=[];if(!(b in p)){p[b]=null;const t=l[b]&&l[b].parent,P=t&&_(t);P&&(p[b]=[t].concat(P))}return p[b]}return Object.keys(s).concat(Object.keys(l)).forEach(_),p}function sJ(e,i,s){const l=e.icons,p=e.aliases||Object.create(null);let _={};function b(t){_=j3(l[t]||p[t],_)}return b(i),s.forEach(b),j3(e,_)}function b6(e,i){const s=[];if(typeof e!="object"||typeof e.icons!="object")return s;e.not_found instanceof Array&&e.not_found.forEach(p=>{i(p,null),s.push(p)});const l=rJ(e);for(const p in l){const _=l[p];_&&(i(p,sJ(e,p,_)),s.push(p))}return s}const oJ={provider:"",aliases:{},not_found:{},...x6};function RC(e,i){for(const s in i)if(s in e&&typeof e[s]!=typeof i[s])return!1;return!0}function w6(e){if(typeof e!="object"||e===null)return null;const i=e;if(typeof i.prefix!="string"||!e.icons||typeof e.icons!="object"||!RC(e,oJ))return null;const s=i.icons;for(const p in s){const _=s[p];if(!p||typeof _.body!="string"||!RC(_,oP))return null}const l=i.aliases||Object.create(null);for(const p in l){const _=l[p],b=_.parent;if(!p||typeof b!="string"||!s[b]&&!l[b]||!RC(_,oP))return null}return i}const U3=Object.create(null);function aJ(e,i){return{provider:e,prefix:i,icons:Object.create(null),missing:new Set}}function gv(e,i){const s=U3[e]||(U3[e]=Object.create(null));return s[i]||(s[i]=aJ(e,i))}function T6(e,i){return w6(i)?b6(i,(s,l)=>{l?e.icons[s]=l:e.missing.add(s)}):[]}function lJ(e,i,s){try{if(typeof s.body=="string")return e.icons[i]={...s},!0}catch{}return!1}let Ow=!1;function S6(e){return typeof e=="boolean"&&(Ow=e),Ow}function kM(e){const i=typeof e=="string"?i2(e,!0,Ow):e;if(i){const s=gv(i.provider,i.prefix),l=i.name;return s.icons[l]||(s.missing.has(l)?null:void 0)}}function Fw(e,i){const s=i2(e,!0,Ow);if(!s)return!1;const l=gv(s.provider,s.prefix);return i?lJ(l,s.name,i):(l.missing.add(s.name),!0)}function cJ(e,i){if(typeof e!="object")return!1;if(typeof i!="string"&&(i=e.provider||""),Ow&&!i&&!e.prefix){let p=!1;return w6(e)&&(e.prefix="",b6(e,(_,b)=>{Fw(_,b)&&(p=!0)})),p}const s=e.prefix;if(!BS({prefix:s,name:"a"}))return!1;const l=gv(i,s);return!!T6(l,e)}function aP(e){const i=kM(e);return i&&{...db,...i}}const E6=Object.freeze({width:null,height:null}),I6=Object.freeze({...E6,...yE}),uJ=/(-?[0-9.]*[0-9]+[0-9.]*)/g,hJ=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function $3(e,i,s){if(i===1)return e;if(s=s||100,typeof e=="number")return Math.ceil(e*i*s)/s;if(typeof e!="string")return e;const l=e.split(uJ);if(l===null||!l.length)return e;const p=[];let _=l.shift(),b=hJ.test(_);for(;;){if(b){const t=parseFloat(_);isNaN(t)?p.push(_):p.push(Math.ceil(t*i*s)/s)}else p.push(_);if(_=l.shift(),_===void 0)return p.join("");b=!b}}function dJ(e,i="defs"){let s="";const l=e.indexOf("<"+i);for(;l>=0;){const p=e.indexOf(">",l),_=e.indexOf("</"+i);if(p===-1||_===-1)break;const b=e.indexOf(">",_);if(b===-1)break;s+=e.slice(p+1,_).trim(),e=e.slice(0,l).trim()+e.slice(b+1)}return{defs:s,content:e}}function fJ(e,i){return e?"<defs>"+e+"</defs>"+i:i}function pJ(e,i,s){const l=dJ(e);return fJ(l.defs,i+l.content+s)}const mJ=e=>e==="unset"||e==="undefined"||e==="none";function gJ(e,i){const s={...db,...e},l={...I6,...i},p={left:s.left,top:s.top,width:s.width,height:s.height};let _=s.body;[s,l].forEach(se=>{const ie=[],pe=se.hFlip,ye=se.vFlip;let de=se.rotate;pe?ye?de+=2:(ie.push("translate("+(p.width+p.left).toString()+" "+(0-p.top).toString()+")"),ie.push("scale(-1 1)"),p.top=p.left=0):ye&&(ie.push("translate("+(0-p.left).toString()+" "+(p.height+p.top).toString()+")"),ie.push("scale(1 -1)"),p.top=p.left=0);let Ee;switch(de<0&&(de-=Math.floor(de/4)*4),de=de%4,de){case 1:Ee=p.height/2+p.top,ie.unshift("rotate(90 "+Ee.toString()+" "+Ee.toString()+")");break;case 2:ie.unshift("rotate(180 "+(p.width/2+p.left).toString()+" "+(p.height/2+p.top).toString()+")");break;case 3:Ee=p.width/2+p.left,ie.unshift("rotate(-90 "+Ee.toString()+" "+Ee.toString()+")");break}de%2===1&&(p.left!==p.top&&(Ee=p.left,p.left=p.top,p.top=Ee),p.width!==p.height&&(Ee=p.width,p.width=p.height,p.height=Ee)),ie.length&&(_=pJ(_,'<g transform="'+ie.join(" ")+'">',"</g>"))});const b=l.width,t=l.height,P=p.width,O=p.height;let F,$;b===null?($=t===null?"1em":t==="auto"?O:t,F=$3($,P/O)):(F=b==="auto"?P:b,$=t===null?$3(F,O/P):t==="auto"?O:t);const W={},Y=(se,ie)=>{mJ(ie)||(W[se]=ie.toString())};Y("width",F),Y("height",$);const ae=[p.left,p.top,P,O];return W.viewBox=ae.join(" "),{attributes:W,viewBox:ae,body:_}}const _J=/\sid="(\S+)"/g,yJ="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let vJ=0;function xJ(e,i=yJ){const s=[];let l;for(;l=_J.exec(e);)s.push(l[1]);if(!s.length)return e;const p="suffix"+(Math.random()*16777216|Date.now()).toString(16);return s.forEach(_=>{const b=typeof i=="function"?i(_):i+(vJ++).toString(),t=_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp('([#;"])('+t+')([")]|\\.[a-z])',"g"),"$1"+b+p+"$3")}),e=e.replace(new RegExp(p,"g"),""),e}const lP=Object.create(null);function C6(e,i){lP[e]=i}function cP(e){return lP[e]||lP[""]}function DM(e){let i;if(typeof e.resources=="string")i=[e.resources];else if(i=e.resources,!(i instanceof Array)||!i.length)return null;return{resources:i,path:e.path||"/",maxURL:e.maxURL||500,rotate:e.rotate||750,timeout:e.timeout||5e3,random:e.random===!0,index:e.index||0,dataAfterTimeout:e.dataAfterTimeout!==!1}}const cI=Object.create(null),q1=["https://api.simplesvg.com","https://api.unisvg.com"],NS=[];for(;q1.length>0;)q1.length===1||Math.random()>.5?NS.push(q1.shift()):NS.push(q1.pop());cI[""]=DM({resources:["https://api.iconify.design"].concat(NS)});function A6(e,i){const s=DM(i);return s===null?!1:(cI[e]=s,!0)}function uI(e){return cI[e]}function bJ(){return Object.keys(cI)}const wJ=()=>{let e;try{if(e=fetch,typeof e=="function")return e}catch{}};let vE=wJ();function TJ(e){vE=e}function SJ(){return vE}function EJ(e,i){const s=uI(e);if(!s)return 0;let l;if(!s.maxURL)l=0;else{let p=0;s.resources.forEach(b=>{p=Math.max(p,b.length)});const _=i+".json?icons=";l=s.maxURL-p-s.path.length-_.length}return l}function IJ(e){return e===404}const CJ=(e,i,s)=>{const l=[],p=EJ(e,i),_="icons";let b={type:_,provider:e,prefix:i,icons:[]},t=0;return s.forEach((P,O)=>{t+=P.length+1,t>=p&&O>0&&(l.push(b),b={type:_,provider:e,prefix:i,icons:[]},t=P.length),b.icons.push(P)}),l.push(b),l};function AJ(e){if(typeof e=="string"){const i=uI(e);if(i)return i.path}return"/"}const PJ=(e,i,s)=>{if(!vE){s("abort",424);return}let l=AJ(i.provider);switch(i.type){case"icons":{const _=i.prefix,t=i.icons.join(","),P=new URLSearchParams({icons:t});l+=_+".json?"+P.toString();break}case"custom":{const _=i.uri;l+=_.slice(0,1)==="/"?_.slice(1):_;break}default:s("abort",400);return}let p=503;vE(e+l).then(_=>{const b=_.status;if(b!==200){setTimeout(()=>{s(IJ(b)?"abort":"next",b)});return}return p=501,_.json()}).then(_=>{if(typeof _!="object"||_===null){setTimeout(()=>{_===404?s("abort",_):s("next",p)});return}setTimeout(()=>{s("success",_)})}).catch(()=>{s("next",p)})},MJ={prepare:CJ,send:PJ};function kJ(e){const i={loaded:[],missing:[],pending:[]},s=Object.create(null);e.sort((p,_)=>p.provider!==_.provider?p.provider.localeCompare(_.provider):p.prefix!==_.prefix?p.prefix.localeCompare(_.prefix):p.name.localeCompare(_.name));let l={provider:"",prefix:"",name:""};return e.forEach(p=>{if(l.name===p.name&&l.prefix===p.prefix&&l.provider===p.provider)return;l=p;const _=p.provider,b=p.prefix,t=p.name,P=s[_]||(s[_]=Object.create(null)),O=P[b]||(P[b]=gv(_,b));let F;t in O.icons?F=i.loaded:b===""||O.missing.has(t)?F=i.missing:F=i.pending;const $={provider:_,prefix:b,name:t};F.push($)}),i}function P6(e,i){e.forEach(s=>{const l=s.loaderCallbacks;l&&(s.loaderCallbacks=l.filter(p=>p.id!==i))})}function DJ(e){e.pendingCallbacksFlag||(e.pendingCallbacksFlag=!0,setTimeout(()=>{e.pendingCallbacksFlag=!1;const i=e.loaderCallbacks?e.loaderCallbacks.slice(0):[];if(!i.length)return;let s=!1;const l=e.provider,p=e.prefix;i.forEach(_=>{const b=_.icons,t=b.pending.length;b.pending=b.pending.filter(P=>{if(P.prefix!==p)return!0;const O=P.name;if(e.icons[O])b.loaded.push({provider:l,prefix:p,name:O});else if(e.missing.has(O))b.missing.push({provider:l,prefix:p,name:O});else return s=!0,!0;return!1}),b.pending.length!==t&&(s||P6([e],_.id),_.callback(b.loaded.slice(0),b.missing.slice(0),b.pending.slice(0),_.abort))})}))}let LJ=0;function RJ(e,i,s){const l=LJ++,p=P6.bind(null,s,l);if(!i.pending.length)return p;const _={id:l,icons:i,callback:e,abort:p};return s.forEach(b=>{(b.loaderCallbacks||(b.loaderCallbacks=[])).push(_)}),p}function zJ(e,i=!0,s=!1){const l=[];return e.forEach(p=>{const _=typeof p=="string"?i2(p,i,s):p;_&&l.push(_)}),l}var OJ={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function FJ(e,i,s,l){const p=e.resources.length,_=e.random?Math.floor(Math.random()*p):e.index;let b;if(e.random){let Ze=e.resources.slice(0);for(b=[];Ze.length>1;){const We=Math.floor(Math.random()*Ze.length);b.push(Ze[We]),Ze=Ze.slice(0,We).concat(Ze.slice(We+1))}b=b.concat(Ze)}else b=e.resources.slice(_).concat(e.resources.slice(0,_));const t=Date.now();let P="pending",O=0,F,$=null,W=[],Y=[];typeof l=="function"&&Y.push(l);function ae(){$&&(clearTimeout($),$=null)}function se(){P==="pending"&&(P="aborted"),ae(),W.forEach(Ze=>{Ze.status==="pending"&&(Ze.status="aborted")}),W=[]}function ie(Ze,We){We&&(Y=[]),typeof Ze=="function"&&Y.push(Ze)}function pe(){return{startTime:t,payload:i,status:P,queriesSent:O,queriesPending:W.length,subscribe:ie,abort:se}}function ye(){P="failed",Y.forEach(Ze=>{Ze(void 0,F)})}function de(){W.forEach(Ze=>{Ze.status==="pending"&&(Ze.status="aborted")}),W=[]}function Ee(Ze,We,je){const Ye=We!=="success";switch(W=W.filter(ct=>ct!==Ze),P){case"pending":break;case"failed":if(Ye||!e.dataAfterTimeout)return;break;default:return}if(We==="abort"){F=je,ye();return}if(Ye){F=je,W.length||(b.length?Pe():ye());return}if(ae(),de(),!e.random){const ct=e.resources.indexOf(Ze.resource);ct!==-1&&ct!==e.index&&(e.index=ct)}P="completed",Y.forEach(ct=>{ct(je)})}function Pe(){if(P!=="pending")return;ae();const Ze=b.shift();if(Ze===void 0){if(W.length){$=setTimeout(()=>{ae(),P==="pending"&&(de(),ye())},e.timeout);return}ye();return}const We={status:"pending",resource:Ze,callback:(je,Ye)=>{Ee(We,je,Ye)}};W.push(We),O++,$=setTimeout(Pe,e.rotate),s(Ze,i,We.callback)}return setTimeout(Pe),pe}function M6(e){const i={...OJ,...e};let s=[];function l(){s=s.filter(t=>t().status==="pending")}function p(t,P,O){const F=FJ(i,t,P,($,W)=>{l(),O&&O($,W)});return s.push(F),F}function _(t){return s.find(P=>t(P))||null}return{query:p,find:_,setIndex:t=>{i.index=t},getIndex:()=>i.index,cleanup:l}}function G3(){}const zC=Object.create(null);function BJ(e){if(!zC[e]){const i=uI(e);if(!i)return;const s=M6(i),l={config:i,redundancy:s};zC[e]=l}return zC[e]}function k6(e,i,s){let l,p;if(typeof e=="string"){const _=cP(e);if(!_)return s(void 0,424),G3;p=_.send;const b=BJ(e);b&&(l=b.redundancy)}else{const _=DM(e);if(_){l=M6(_);const b=e.resources?e.resources[0]:"",t=cP(b);t&&(p=t.send)}}return!l||!p?(s(void 0,424),G3):l.query(i,p,s)().abort}function q3(){}function NJ(e){e.iconsLoaderFlag||(e.iconsLoaderFlag=!0,setTimeout(()=>{e.iconsLoaderFlag=!1,DJ(e)}))}function VJ(e){const i=[],s=[];return e.forEach(l=>{(l.match(v6)?i:s).push(l)}),{valid:i,invalid:s}}function H1(e,i,s){function l(){const p=e.pendingIcons;i.forEach(_=>{p&&p.delete(_),e.icons[_]||e.missing.add(_)})}if(s&&typeof s=="object")try{if(!T6(e,s).length){l();return}}catch(p){console.error(p)}l(),NJ(e)}function H3(e,i){e instanceof Promise?e.then(s=>{i(s)}).catch(()=>{i(null)}):i(e)}function jJ(e,i){e.iconsToLoad?e.iconsToLoad=e.iconsToLoad.concat(i).sort():e.iconsToLoad=i,e.iconsQueueFlag||(e.iconsQueueFlag=!0,setTimeout(()=>{e.iconsQueueFlag=!1;const{provider:s,prefix:l}=e,p=e.iconsToLoad;if(delete e.iconsToLoad,!p||!p.length)return;const _=e.loadIcon;if(e.loadIcons&&(p.length>1||!_)){H3(e.loadIcons(p,l,s),F=>{H1(e,p,F)});return}if(_){p.forEach(F=>{const $=_(F,l,s);H3($,W=>{const Y=W?{prefix:l,icons:{[F]:W}}:null;H1(e,[F],Y)})});return}const{valid:b,invalid:t}=VJ(p);if(t.length&&H1(e,t,null),!b.length)return;const P=l.match(v6)?cP(s):null;if(!P){H1(e,b,null);return}P.prepare(s,l,b).forEach(F=>{k6(s,F,$=>{H1(e,F.icons,$)})})}))}const D6=(e,i)=>{const s=zJ(e,!0,S6()),l=kJ(s);if(!l.pending.length){let P=!0;return i&&setTimeout(()=>{P&&i(l.loaded,l.missing,l.pending,q3)}),()=>{P=!1}}const p=Object.create(null),_=[];let b,t;return l.pending.forEach(P=>{const{provider:O,prefix:F}=P;if(F===t&&O===b)return;b=O,t=F,_.push(gv(O,F));const $=p[O]||(p[O]=Object.create(null));$[F]||($[F]=[])}),l.pending.forEach(P=>{const{provider:O,prefix:F,name:$}=P,W=gv(O,F),Y=W.pendingIcons||(W.pendingIcons=new Set);Y.has($)||(Y.add($),p[O][F].push($))}),_.forEach(P=>{const O=p[P.provider][P.prefix];O.length&&jJ(P,O)}),i?RJ(i,l,_):q3},UJ=e=>new Promise((i,s)=>{const l=typeof e=="string"?i2(e,!0):e;if(!l){s(e);return}D6([l||e],p=>{if(p.length&&l){const _=kM(l);if(_){i({...db,..._});return}}s(e)})});function $J(e,i,s){gv("",i).loadIcons=e}function GJ(e,i){const s={...e};for(const l in i){const p=i[l],_=typeof p;l in E6?(p===null||p&&(_==="string"||_==="number"))&&(s[l]=p):_===typeof s[l]&&(s[l]=l==="rotate"?p%4:p)}return s}const qJ=/[\s,]+/;function HJ(e,i){i.split(qJ).forEach(s=>{switch(s.trim()){case"horizontal":e.hFlip=!0;break;case"vertical":e.vFlip=!0;break}})}function WJ(e,i=0){const s=e.replace(/^-?[0-9.]*/,"");function l(p){for(;p<0;)p+=4;return p%4}if(s===""){const p=parseInt(e);return isNaN(p)?0:l(p)}else if(s!==e){let p=0;switch(s){case"%":p=25;break;case"deg":p=90}if(p){let _=parseFloat(e.slice(0,e.length-s.length));return isNaN(_)?0:(_=_/p,_%1===0?l(_):0)}}return i}function ZJ(e,i){let s=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const l in i)s+=" "+l+'="'+i[l]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+s+">"+e+"</svg>"}function XJ(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function YJ(e){return"data:image/svg+xml,"+XJ(e)}function KJ(e){return'url("'+YJ(e)+'")'}const W3={...I6,inline:!1},JJ={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},QJ={display:"inline-block"},uP={backgroundColor:"currentColor"},L6={backgroundColor:"transparent"},Z3={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},X3={webkitMask:uP,mask:uP,background:L6};for(const e in X3){const i=X3[e];for(const s in Z3)i[e+s]=Z3[s]}const VS={};["horizontal","vertical"].forEach(e=>{const i=e.slice(0,1)+"Flip";VS[e+"-flip"]=i,VS[e.slice(0,1)+"-flip"]=i,VS[e+"Flip"]=i});function Y3(e){return e+(e.match(/^[-0-9.]+$/)?"px":"")}const K3=(e,i)=>{const s=GJ(W3,i),l={...JJ},p=i.mode||"svg",_={},b=i.style,t=typeof b=="object"&&!(b instanceof Array)?b:{};for(let se in i){const ie=i[se];if(ie!==void 0)switch(se){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":s[se]=ie===!0||ie==="true"||ie===1;break;case"flip":typeof ie=="string"&&HJ(s,ie);break;case"color":_.color=ie;break;case"rotate":typeof ie=="string"?s[se]=WJ(ie):typeof ie=="number"&&(s[se]=ie);break;case"ariaHidden":case"aria-hidden":ie!==!0&&ie!=="true"&&delete l["aria-hidden"];break;default:{const pe=VS[se];pe?(ie===!0||ie==="true"||ie===1)&&(s[pe]=!0):W3[se]===void 0&&(l[se]=ie)}}}const P=gJ(e,s),O=P.attributes;if(s.inline&&(_.verticalAlign="-0.125em"),p==="svg"){l.style={..._,...t},Object.assign(l,O);let se=0,ie=i.id;return typeof ie=="string"&&(ie=ie.replace(/-/g,"_")),l.innerHTML=xJ(P.body,ie?()=>ie+"ID"+se++:"iconifyVue"),Ns("svg",l)}const{body:F,width:$,height:W}=e,Y=p==="mask"||(p==="bg"?!1:F.indexOf("currentColor")!==-1),ae=ZJ(F,{...O,width:$+"",height:W+""});return l.style={..._,"--svg":KJ(ae),width:Y3(O.width),height:Y3(O.height),...QJ,...Y?uP:L6,...t},Ns("span",l)};S6(!0);C6("",MJ);if(typeof document<"u"&&typeof window<"u"){const e=window;if(e.IconifyPreload!==void 0){const i=e.IconifyPreload,s="Invalid IconifyPreload syntax.";typeof i=="object"&&i!==null&&(i instanceof Array?i:[i]).forEach(l=>{try{(typeof l!="object"||l===null||l instanceof Array||typeof l.icons!="object"||typeof l.prefix!="string"||!cJ(l))&&console.error(s)}catch{console.error(s)}})}if(e.IconifyProviders!==void 0){const i=e.IconifyProviders;if(typeof i=="object"&&i!==null)for(let s in i){const l="IconifyProviders["+s+"] is invalid.";try{const p=i[s];if(typeof p!="object"||!p||p.resources===void 0)continue;A6(s,p)||console.error(l)}catch{console.error(l)}}}}const eQ={...db,body:""},tQ=kr((e,{emit:i})=>{const s=an(null);function l(){s.value&&(s.value.abort?.(),s.value=null)}const p=an(!!e.ssr),_=an(""),b=so(null);function t(){const O=e.icon;if(typeof O=="object"&&O!==null&&typeof O.body=="string")return _.value="",{data:O};let F;if(typeof O!="string"||(F=i2(O,!1,!0))===null)return null;let $=kM(F);if(!$){const ae=s.value;return(!ae||ae.name!==O)&&($===null?s.value={name:O}:s.value={name:O,abort:D6([F],P)}),null}l(),_.value!==O&&(_.value=O,Da(()=>{i("load",O)}));const W=e.customise;if(W){$=Object.assign({},$);const ae=W($.body,F.name,F.prefix,F.provider);typeof ae=="string"&&($.body=ae)}const Y=["iconify"];return F.prefix!==""&&Y.push("iconify--"+F.prefix),F.provider!==""&&Y.push("iconify--"+F.provider),{data:$,classes:Y}}function P(){const O=t();O?O.data!==b.value?.data&&(b.value=O):b.value=null}return p.value?P():La(()=>{p.value=!0,P()}),Qn(()=>e.icon,P),ru(l),()=>{const O=b.value;if(!O)return K3(eQ,e);let F=e;return O.classes&&(F={...e,class:O.classes.join(" ")}),K3({...db,...O.data},F)}},{props:["icon","mode","ssr","width","height","style","color","inline","rotate","hFlip","horizontalFlip","vFlip","verticalFlip","flip","id","ariaHidden","customise","title"],emits:["load"]}),J3={getAPIConfig:uI,setAPIModule:C6,sendAPIQuery:k6,setFetch:TJ,getFetch:SJ,listAPIProviders:bJ},iQ=ol({name:"@nuxt/icon",setup(){const e=jf(),i=hd().icon;J3.setFetch($fetch.native);const s=[];if(i.provider==="server"){const p=e.app?.baseURL?.replace(/\/$/,"")??"";s.push(p+(i.localApiEndpoint||"/api/_nuxt_icon")),(i.fallbackToApi===!0||i.fallbackToApi==="client-only")&&s.push(i.iconifyApiEndpoint)}else i.provider==="none"?J3.setFetch(()=>Promise.resolve(new Response)):s.push(i.iconifyApiEndpoint);async function l(p,_){try{const b=await $fetch(s[0]+"/"+_+".json",{query:{icons:p.join(",")}});if(!b||b.prefix!==_||!b.icons)throw new Error("Invalid data"+JSON.stringify(b));return b}catch(b){return console.error("Failed to load custom icons",b),null}}A6("",{resources:s});for(const p of i.customCollections||[])p&&$J(l,p)}});var QT={inherit:"inherit",current:"currentcolor",transparent:"transparent",black:"#000",white:"#fff",slate:{50:"oklch(98.4% 0.003 247.858)",100:"oklch(96.8% 0.007 247.896)",200:"oklch(92.9% 0.013 255.508)",300:"oklch(86.9% 0.022 252.894)",400:"oklch(70.4% 0.04 256.788)",500:"oklch(55.4% 0.046 257.417)",600:"oklch(44.6% 0.043 257.281)",700:"oklch(37.2% 0.044 257.287)",800:"oklch(27.9% 0.041 260.031)",900:"oklch(20.8% 0.042 265.755)",950:"oklch(12.9% 0.042 264.695)"},gray:{50:"oklch(98.5% 0.002 247.839)",100:"oklch(96.7% 0.003 264.542)",200:"oklch(92.8% 0.006 264.531)",300:"oklch(87.2% 0.01 258.338)",400:"oklch(70.7% 0.022 261.325)",500:"oklch(55.1% 0.027 264.364)",600:"oklch(44.6% 0.03 256.802)",700:"oklch(37.3% 0.034 259.733)",800:"oklch(27.8% 0.033 256.848)",900:"oklch(21% 0.034 264.665)",950:"oklch(13% 0.028 261.692)"},zinc:{50:"oklch(98.5% 0 0)",100:"oklch(96.7% 0.001 286.375)",200:"oklch(92% 0.004 286.32)",300:"oklch(87.1% 0.006 286.286)",400:"oklch(70.5% 0.015 286.067)",500:"oklch(55.2% 0.016 285.938)",600:"oklch(44.2% 0.017 285.786)",700:"oklch(37% 0.013 285.805)",800:"oklch(27.4% 0.006 286.033)",900:"oklch(21% 0.006 285.885)",950:"oklch(14.1% 0.005 285.823)"},neutral:{50:"oklch(98.5% 0 0)",100:"oklch(97% 0 0)",200:"oklch(92.2% 0 0)",300:"oklch(87% 0 0)",400:"oklch(70.8% 0 0)",500:"oklch(55.6% 0 0)",600:"oklch(43.9% 0 0)",700:"oklch(37.1% 0 0)",800:"oklch(26.9% 0 0)",900:"oklch(20.5% 0 0)",950:"oklch(14.5% 0 0)"},stone:{50:"oklch(98.5% 0.001 106.423)",100:"oklch(97% 0.001 106.424)",200:"oklch(92.3% 0.003 48.717)",300:"oklch(86.9% 0.005 56.366)",400:"oklch(70.9% 0.01 56.259)",500:"oklch(55.3% 0.013 58.071)",600:"oklch(44.4% 0.011 73.639)",700:"oklch(37.4% 0.01 67.558)",800:"oklch(26.8% 0.007 34.298)",900:"oklch(21.6% 0.006 56.043)",950:"oklch(14.7% 0.004 49.25)"},red:{50:"oklch(97.1% 0.013 17.38)",100:"oklch(93.6% 0.032 17.717)",200:"oklch(88.5% 0.062 18.334)",300:"oklch(80.8% 0.114 19.571)",400:"oklch(70.4% 0.191 22.216)",500:"oklch(63.7% 0.237 25.331)",600:"oklch(57.7% 0.245 27.325)",700:"oklch(50.5% 0.213 27.518)",800:"oklch(44.4% 0.177 26.899)",900:"oklch(39.6% 0.141 25.723)",950:"oklch(25.8% 0.092 26.042)"},orange:{50:"oklch(98% 0.016 73.684)",100:"oklch(95.4% 0.038 75.164)",200:"oklch(90.1% 0.076 70.697)",300:"oklch(83.7% 0.128 66.29)",400:"oklch(75% 0.183 55.934)",500:"oklch(70.5% 0.213 47.604)",600:"oklch(64.6% 0.222 41.116)",700:"oklch(55.3% 0.195 38.402)",800:"oklch(47% 0.157 37.304)",900:"oklch(40.8% 0.123 38.172)",950:"oklch(26.6% 0.079 36.259)"},amber:{50:"oklch(98.7% 0.022 95.277)",100:"oklch(96.2% 0.059 95.617)",200:"oklch(92.4% 0.12 95.746)",300:"oklch(87.9% 0.169 91.605)",400:"oklch(82.8% 0.189 84.429)",500:"oklch(76.9% 0.188 70.08)",600:"oklch(66.6% 0.179 58.318)",700:"oklch(55.5% 0.163 48.998)",800:"oklch(47.3% 0.137 46.201)",900:"oklch(41.4% 0.112 45.904)",950:"oklch(27.9% 0.077 45.635)"},yellow:{50:"oklch(98.7% 0.026 102.212)",100:"oklch(97.3% 0.071 103.193)",200:"oklch(94.5% 0.129 101.54)",300:"oklch(90.5% 0.182 98.111)",400:"oklch(85.2% 0.199 91.936)",500:"oklch(79.5% 0.184 86.047)",600:"oklch(68.1% 0.162 75.834)",700:"oklch(55.4% 0.135 66.442)",800:"oklch(47.6% 0.114 61.907)",900:"oklch(42.1% 0.095 57.708)",950:"oklch(28.6% 0.066 53.813)"},lime:{50:"oklch(98.6% 0.031 120.757)",100:"oklch(96.7% 0.067 122.328)",200:"oklch(93.8% 0.127 124.321)",300:"oklch(89.7% 0.196 126.665)",400:"oklch(84.1% 0.238 128.85)",500:"oklch(76.8% 0.233 130.85)",600:"oklch(64.8% 0.2 131.684)",700:"oklch(53.2% 0.157 131.589)",800:"oklch(45.3% 0.124 130.933)",900:"oklch(40.5% 0.101 131.063)",950:"oklch(27.4% 0.072 132.109)"},green:{50:"oklch(98.2% 0.018 155.826)",100:"oklch(96.2% 0.044 156.743)",200:"oklch(92.5% 0.084 155.995)",300:"oklch(87.1% 0.15 154.449)",400:"oklch(79.2% 0.209 151.711)",500:"oklch(72.3% 0.219 149.579)",600:"oklch(62.7% 0.194 149.214)",700:"oklch(52.7% 0.154 150.069)",800:"oklch(44.8% 0.119 151.328)",900:"oklch(39.3% 0.095 152.535)",950:"oklch(26.6% 0.065 152.934)"},emerald:{50:"oklch(97.9% 0.021 166.113)",100:"oklch(95% 0.052 163.051)",200:"oklch(90.5% 0.093 164.15)",300:"oklch(84.5% 0.143 164.978)",400:"oklch(76.5% 0.177 163.223)",500:"oklch(69.6% 0.17 162.48)",600:"oklch(59.6% 0.145 163.225)",700:"oklch(50.8% 0.118 165.612)",800:"oklch(43.2% 0.095 166.913)",900:"oklch(37.8% 0.077 168.94)",950:"oklch(26.2% 0.051 172.552)"},teal:{50:"oklch(98.4% 0.014 180.72)",100:"oklch(95.3% 0.051 180.801)",200:"oklch(91% 0.096 180.426)",300:"oklch(85.5% 0.138 181.071)",400:"oklch(77.7% 0.152 181.912)",500:"oklch(70.4% 0.14 182.503)",600:"oklch(60% 0.118 184.704)",700:"oklch(51.1% 0.096 186.391)",800:"oklch(43.7% 0.078 188.216)",900:"oklch(38.6% 0.063 188.416)",950:"oklch(27.7% 0.046 192.524)"},cyan:{50:"oklch(98.4% 0.019 200.873)",100:"oklch(95.6% 0.045 203.388)",200:"oklch(91.7% 0.08 205.041)",300:"oklch(86.5% 0.127 207.078)",400:"oklch(78.9% 0.154 211.53)",500:"oklch(71.5% 0.143 215.221)",600:"oklch(60.9% 0.126 221.723)",700:"oklch(52% 0.105 223.128)",800:"oklch(45% 0.085 224.283)",900:"oklch(39.8% 0.07 227.392)",950:"oklch(30.2% 0.056 229.695)"},sky:{50:"oklch(97.7% 0.013 236.62)",100:"oklch(95.1% 0.026 236.824)",200:"oklch(90.1% 0.058 230.902)",300:"oklch(82.8% 0.111 230.318)",400:"oklch(74.6% 0.16 232.661)",500:"oklch(68.5% 0.169 237.323)",600:"oklch(58.8% 0.158 241.966)",700:"oklch(50% 0.134 242.749)",800:"oklch(44.3% 0.11 240.79)",900:"oklch(39.1% 0.09 240.876)",950:"oklch(29.3% 0.066 243.157)"},blue:{50:"oklch(97% 0.014 254.604)",100:"oklch(93.2% 0.032 255.585)",200:"oklch(88.2% 0.059 254.128)",300:"oklch(80.9% 0.105 251.813)",400:"oklch(70.7% 0.165 254.624)",500:"oklch(62.3% 0.214 259.815)",600:"oklch(54.6% 0.245 262.881)",700:"oklch(48.8% 0.243 264.376)",800:"oklch(42.4% 0.199 265.638)",900:"oklch(37.9% 0.146 265.522)",950:"oklch(28.2% 0.091 267.935)"},indigo:{50:"oklch(96.2% 0.018 272.314)",100:"oklch(93% 0.034 272.788)",200:"oklch(87% 0.065 274.039)",300:"oklch(78.5% 0.115 274.713)",400:"oklch(67.3% 0.182 276.935)",500:"oklch(58.5% 0.233 277.117)",600:"oklch(51.1% 0.262 276.966)",700:"oklch(45.7% 0.24 277.023)",800:"oklch(39.8% 0.195 277.366)",900:"oklch(35.9% 0.144 278.697)",950:"oklch(25.7% 0.09 281.288)"},violet:{50:"oklch(96.9% 0.016 293.756)",100:"oklch(94.3% 0.029 294.588)",200:"oklch(89.4% 0.057 293.283)",300:"oklch(81.1% 0.111 293.571)",400:"oklch(70.2% 0.183 293.541)",500:"oklch(60.6% 0.25 292.717)",600:"oklch(54.1% 0.281 293.009)",700:"oklch(49.1% 0.27 292.581)",800:"oklch(43.2% 0.232 292.759)",900:"oklch(38% 0.189 293.745)",950:"oklch(28.3% 0.141 291.089)"},purple:{50:"oklch(97.7% 0.014 308.299)",100:"oklch(94.6% 0.033 307.174)",200:"oklch(90.2% 0.063 306.703)",300:"oklch(82.7% 0.119 306.383)",400:"oklch(71.4% 0.203 305.504)",500:"oklch(62.7% 0.265 303.9)",600:"oklch(55.8% 0.288 302.321)",700:"oklch(49.6% 0.265 301.924)",800:"oklch(43.8% 0.218 303.724)",900:"oklch(38.1% 0.176 304.987)",950:"oklch(29.1% 0.149 302.717)"},fuchsia:{50:"oklch(97.7% 0.017 320.058)",100:"oklch(95.2% 0.037 318.852)",200:"oklch(90.3% 0.076 319.62)",300:"oklch(83.3% 0.145 321.434)",400:"oklch(74% 0.238 322.16)",500:"oklch(66.7% 0.295 322.15)",600:"oklch(59.1% 0.293 322.896)",700:"oklch(51.8% 0.253 323.949)",800:"oklch(45.2% 0.211 324.591)",900:"oklch(40.1% 0.17 325.612)",950:"oklch(29.3% 0.136 325.661)"},pink:{50:"oklch(97.1% 0.014 343.198)",100:"oklch(94.8% 0.028 342.258)",200:"oklch(89.9% 0.061 343.231)",300:"oklch(82.3% 0.12 346.018)",400:"oklch(71.8% 0.202 349.761)",500:"oklch(65.6% 0.241 354.308)",600:"oklch(59.2% 0.249 0.584)",700:"oklch(52.5% 0.223 3.958)",800:"oklch(45.9% 0.187 3.815)",900:"oklch(40.8% 0.153 2.432)",950:"oklch(28.4% 0.109 3.907)"},rose:{50:"oklch(96.9% 0.015 12.422)",100:"oklch(94.1% 0.03 12.58)",200:"oklch(89.2% 0.058 10.001)",300:"oklch(81% 0.117 11.638)",400:"oklch(71.2% 0.194 13.428)",500:"oklch(64.5% 0.246 16.439)",600:"oklch(58.6% 0.253 17.585)",700:"oklch(51.4% 0.222 16.935)",800:"oklch(45.5% 0.188 13.697)",900:"oklch(41% 0.159 10.272)",950:"oklch(27.1% 0.105 12.094)"}};const nQ=[50,100,200,300,400,500,600,700,800,900,950];function rQ(e,i){return e in QT&&typeof QT[e]=="object"&&i in QT[e]?QT[e][i]:""}function sQ(e,i,s){const l=s?`${s}-`:"";return`${nQ.map(p=>`--ui-color-${e}-${p}: var(--${l}color-${i==="neutral"?"old-neutral":i}-${p}, ${rQ(i,p)});`).join(`
  `)}`}function Q3(e,i){return`--ui-${e}: var(--ui-color-${e}-${i});`}const oQ=ol(()=>{const e=hd(),i=Vs(),s=Ei(()=>{const{neutral:p,..._}=e.ui.colors,b=e.ui.prefix;return`@layer theme {
  :root, :host {
  ${Object.entries(e.ui.colors).map(([t,P])=>sQ(t,P,b)).join(`
  `)}
  }
  :root, :host, .light {
  ${Object.keys(_).map(t=>Q3(t,500)).join(`
  `)}
  }
  .dark {
  ${Object.keys(_).map(t=>Q3(t,400)).join(`
  `)}
  }
}`}),l={style:[{innerHTML:()=>s.value,tagPriority:-2,id:"nuxt-ui-colors"}]};if(i.isHydrating&&!i.payload.serverRendered){const p=document.createElement("style");p.innerHTML=s.value,p.setAttribute("data-nuxt-ui-colors",""),document.head.appendChild(p),l.script=[{innerHTML:"document.head.removeChild(document.querySelector('[data-nuxt-ui-colors]'))"}]}hb(l)}),aQ="__NUXT_COLOR_MODE__",OC="cframe-color-mode",lQ="localStorage",M_=window[aQ]||{},cQ=ol(e=>{const i=X_("color-mode",()=>Ol({preference:M_.preference,value:M_.value,unknown:!1,forced:!1})).value;nu().afterEach(_=>{const b=_.meta.colorMode;b&&b!=="system"?(i.value=b,i.forced=!0):(b==="system"&&console.warn("You cannot force the colorMode to system at the page level."),i.forced=!1,i.value=i.preference==="system"?M_.getColorScheme():i.preference)});let s;function l(){s||!window.matchMedia||(s=window.matchMedia("(prefers-color-scheme: dark)"),s.addEventListener("change",()=>{!i.forced&&i.preference==="system"&&(i.value=M_.getColorScheme())}))}function p(_,b){switch(_){case"cookie":window.document.cookie=OC+"="+b;break;case"sessionStorage":window.sessionStorage?.setItem(OC,b);break;default:window.localStorage?.setItem(OC,b)}}Qn(()=>i.preference,_=>{i.forced||(_==="system"?(i.value=M_.getColorScheme(),l()):i.value=_,p(lQ,_))},{immediate:!0}),Qn(()=>i.value,(_,b)=>{let t;t=window.document.createElement("style"),t.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),window.document.head.appendChild(t),M_.removeColorScheme(b),M_.addColorScheme(_),window.getComputedStyle(t).opacity,document.head.removeChild(t)}),i.preference==="system"&&l(),e.hook("app:mounted",()=>{i.unknown&&(i.preference=M_.preference,i.value=M_.value,i.unknown=!1)}),e.provide("colorMode",i)}),uQ=ol(e=>{const i=jf();if(i.public.analytics.matomo?.enabled&&i.public.analytics.matomo.url&&i.public.analytics.matomo.siteId){const s=i.public.analytics.matomo.url.replace(/\/$/,""),l=i.public.analytics.matomo.siteId;hb({script:[{innerHTML:`
            var _paq = window._paq = window._paq || [];
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function() {
              var u="${s}/";
              _paq.push(['setTrackerUrl', u+'matomo.php']);
              _paq.push(['setSiteId', '${l}']);
              var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
              g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
            })();
          `.trim(),type:"text/javascript",tagPosition:"head"}]});return}});var Ig=(e=>(e.IDLE="idle",e.IMAGE_LOADING="image-loading",e.TEXTURE_LOADING="texture-loading",e.TILE_LOADING="tile-loading",e.COMPLETE="complete",e.ERROR="error",e))(Ig||{});const wu={minScale:.1,maxScale:10,wheelStep:.1,pinchStep:.5,doubleClickStep:2,doubleClickMode:"toggle",animationTime:200,wheelDisabled:!1,touchPadDisabled:!1,pinchDisabled:!1,doubleClickDisabled:!1,panningDisabled:!1,velocityDisabled:!0,centerOnInit:!0,debug:!1,limitToBounds:!0,smooth:!0,tileEnabled:!0,tileSize:1024,alignmentAnimation:{duration:300,easing:e=>1-Math.pow(1-e,4)},velocityAnimation:{duration:400,easing:e=>1-Math.pow(1-e,3)}},hQ={THROTTLE_MS:16},dQ={easeOutQuart:e=>1-Math.pow(1-e,4)},ez={DOUBLE_CLICK_DELAY:300};function FC(e,i,s){return Math.min(Math.max(e,i),s)}function tz(e,i){const s=i.x-e.x,l=i.y-e.y;return Math.sqrt(s*s+l*l)}function iz(e){const i=e.reduce((s,l)=>({x:s.x+l.x,y:s.y+l.y}),{x:0,y:0});return{x:i.x/e.length,y:i.y/e.length}}function nz(e){return Array.from(e).map(i=>({x:i.clientX,y:i.clientY}))}function fQ(e,i){let s=0;return(...l)=>{const p=Date.now();p-s>=i&&(s=p,e(...l))}}function pQ(e,i,s){return new Float32Array([e,0,0,0,e,0,i,s,1])}function mQ(){try{const e=document.createElement("canvas");return!!(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch{return!1}}function eS(e){try{return e.getParameter(e.MAX_TEXTURE_SIZE)}catch{return 4096}}const gQ=`
  attribute vec2 a_position;
  attribute vec2 a_texCoord;
  
  uniform mat3 u_matrix;
  uniform vec2 u_resolution;
  
  varying vec2 v_texCoord;
  
  void main() {
    // 
    vec2 position = (u_matrix * vec3(a_position, 1)).xy;
    
    //  0  1
    vec2 zeroToOne = position / u_resolution;
    
    //  0->1  0->2
    vec2 zeroToTwo = zeroToOne * 2.0;
    
    //  0->2  -1->+1 ()
    vec2 clipSpace = zeroToTwo - 1.0;
    
    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
    
    // 
    v_texCoord = a_texCoord;
  }
`,_Q=`
  precision mediump float;
  
  uniform sampler2D u_image;
  uniform bool u_debugTiles;
  uniform vec4 u_tileBorderColor;
  uniform vec2 u_tileBorderWidth;
  
  varying vec2 v_texCoord;
  
  void main() {
    vec4 color = texture2D(u_image, v_texCoord);

    if (u_debugTiles) {
      float left = 1.0 - step(u_tileBorderWidth.x, v_texCoord.x);
      float right = 1.0 - step(u_tileBorderWidth.x, 1.0 - v_texCoord.x);
      float top = 1.0 - step(u_tileBorderWidth.y, v_texCoord.y);
      float bottom = 1.0 - step(u_tileBorderWidth.y, 1.0 - v_texCoord.y);
      float border = clamp(max(max(left, right), max(top, bottom)), 0.0, 1.0);
      color = mix(color, u_tileBorderColor, border);
    }

    gl_FragColor = color;
  }
`;function rz(e,i,s){const l=e.createShader(i);return l?(e.shaderSource(l,s),e.compileShader(l),e.getShaderParameter(l,e.COMPILE_STATUS)?l:(console.error("An error occurred compiling the shaders:",e.getShaderInfoLog(l)),e.deleteShader(l),null)):(console.error("Unable to create shader"),null)}function yQ(e,i,s){const l=e.createProgram();return l?(e.attachShader(l,i),e.attachShader(l,s),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS)?l:(console.error("Unable to initialize the shader program:",e.getProgramInfoLog(l)),null)):(console.error("Unable to create shader program"),null)}function vQ(e){const i=rz(e,e.VERTEX_SHADER,gQ),s=rz(e,e.FRAGMENT_SHADER,_Q);if(!i||!s)return null;const l=yQ(e,i,s);return e.deleteShader(i),e.deleteShader(s),l}const xQ=`// @ts-nocheck
/// <reference lib="webworker" />

/**
 * Image decoder worker
 * @param {MessageEvent} event
 * @returns
 */
self.onmessage = async (event) => {
  const { type } = event.data

  if (type === 'load') {
    const { payload } = event.data
    try {
      let src = payload.src
      try {
        const absolute = new URL(src, self.location?.origin || 'http://localhost')
        src = absolute.toString()
      } catch { /* empty */ }
      const response = await fetch(src, { mode: 'cors' })
      if (!response.ok) {
        throw new Error(\`Failed to fetch image: \${response.status}\`)
      }

      const blob = await response.blob()

      const imageBitmap = await createImageBitmap(blob)

      self.postMessage(
        {
          type: 'loaded',
          payload: {
            imageBitmap,
            width: imageBitmap.width,
            height: imageBitmap.height,
          },
        },
        [imageBitmap],
      )
    } catch (error) {
      self.postMessage({
        type: 'load-error',
        payload: error instanceof Error ? error : 'Unknown error',
      })
    }
  }
}
`,tS=2.4,bQ=[.4,.7,.9,.25];class wQ{constructor(i,s={}){this.image=null,this.texture=null,this.program=null,this.tiles=[],this.useTiles=!1,this.worker=null,this.imageLoadingResolve=null,this.imageLoadingReject=null,this.transform={scale:1,translateX:0,translateY:0},this.initialScale=1,this.animation=null,this.animationId=null,this.isDragging=!1,this.lastMousePos=null,this.touchState=null,this.lastClickTime=0,this.lastTouchTime=0,this.lastTouchPosition=null,this.hasMoved=!1,this.positionBuffer=null,this.texCoordBuffer=null,this.positionLocation=-1,this.texCoordLocation=-1,this.matrixLocation=null,this.resolutionLocation=null,this.imageLocation=null,this.tileDebugLocation=null,this.tileBorderColorLocation=null,this.tileBorderWidthLocation=null,this.resizeObserver=null,this.currentQuality="unknown",this.isLoadingTexture=!1,this.currentLoadingState=Ig.IDLE,this.canvas=i,this.config={...wu,...s};const l=i.getContext("webgl",{alpha:!0,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1});if(!l)throw new Error("WebGL not supported");this.gl=l,this.throttledRender=fQ(()=>this.render(),hQ.THROTTLE_MS),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleMouseMove=this.handleMouseMove.bind(this),this.boundHandleMouseLeave=this.handleMouseLeave.bind(this),this.init()}init(){this.setupWebGL(),this.setupWorker(),this.setupEventListeners(),this.setupResizeObserver(),this.resize()}setupWebGL(){const{gl:i}=this;if(this.program=vQ(i),!this.program)throw new Error("Failed to create shader program");i.useProgram(this.program),this.positionLocation=i.getAttribLocation(this.program,"a_position"),this.texCoordLocation=i.getAttribLocation(this.program,"a_texCoord"),this.matrixLocation=i.getUniformLocation(this.program,"u_matrix"),this.resolutionLocation=i.getUniformLocation(this.program,"u_resolution"),this.imageLocation=i.getUniformLocation(this.program,"u_image"),this.tileDebugLocation=i.getUniformLocation(this.program,"u_debugTiles"),this.tileBorderColorLocation=i.getUniformLocation(this.program,"u_tileBorderColor"),this.tileBorderWidthLocation=i.getUniformLocation(this.program,"u_tileBorderWidth"),this.createBuffers(),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.clearColor(0,0,0,0)}setupWorker(){if(typeof Worker>"u"){console.warn("Web Workers not supported, falling back to main thread");return}this.worker=new Worker(URL.createObjectURL(new Blob([xQ])),{name:"image-decoder-worker"}),this.worker.onmessage=i=>{const{type:s,payload:l}=i.data;switch(s){case"loaded":this.handleWorkerImageLoaded(l);break;case"load-error":this.handleWorkerImageLoadError(l);break}},this.worker.onerror=i=>{console.error("Worker error:",i)}}handleWorkerImageLoaded(i){const{imageBitmap:s}=i;try{this.image=s;const l=this.shouldUseTiles(s);let p=!1;l&&(this.emitLoadingStateChange(!0,Ig.TILE_LOADING),p=this.createTiles(s)),p?this.updatePositionBuffer():(this.emitLoadingStateChange(!0,Ig.TEXTURE_LOADING),this.createTexture(s)),this.useTiles=p,this.config.centerOnInit&&this.centerImage(),this.currentQuality="high",this.emitLoadingStateChange(!1,Ig.COMPLETE,this.currentQuality),this.render(),this.imageLoadingResolve&&this.imageLoadingResolve()}catch(l){console.error("Failed to create texture from ImageBitmap:",l),this.emitLoadingStateChange(!1,Ig.ERROR),this.imageLoadingReject&&this.imageLoadingReject(l)}}handleWorkerImageLoadError(i){console.error("Image load error from worker:",i),this.emitLoadingStateChange(!1,Ig.ERROR),this.imageLoadingReject&&this.imageLoadingReject(i)}createBuffers(){const{gl:i}=this;this.positionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),this.texCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.texCoordBuffer);const s=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW)}updatePositionBuffer(){if(!this.image||!this.positionBuffer)return;const{gl:i}=this,{width:s,height:l}=this.image;i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer);const p=new Float32Array([0,0,s,0,0,l,0,l,s,0,s,l]);i.bufferData(i.ARRAY_BUFFER,p,i.STATIC_DRAW)}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mouseleave",this.boundHandleMouseLeave),this.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1}),this.canvas.addEventListener("click",this.handleClick.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.canvas.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.canvas.addEventListener("contextmenu",i=>i.preventDefault())}setupResizeObserver(){this.resizeObserver=new ResizeObserver(()=>{this.resize()}),this.resizeObserver.observe(this.canvas)}emitLoadingStateChange(i,s,l){this.isLoadingTexture=i,s&&(this.currentLoadingState=s),this.onLoadingStateChange?.(i,s,l)}async loadImage(i){return console.log("Post load image:",i),this.emitLoadingStateChange(!0,Ig.IMAGE_LOADING),new Promise((s,l)=>{if(this.imageLoadingResolve=s,this.imageLoadingReject=l,this.worker)try{const p=new URL(i,self.location?.origin||"http://localhost");this.worker.postMessage({type:"load",payload:{src:p.toString()}})}catch{this.worker.postMessage({type:"load",payload:{src:i}})}else l(new Error("No worker available"))})}createTexture(i){const{gl:s}=this;this.cleanupTiles(),this.useTiles=!1,this.texture&&s.deleteTexture(this.texture);const l=eS(s),p=i.width??i.width??i.width,_=i.height??i.height??i.height;let b=i;if(typeof p=="number"&&typeof _=="number"&&(p>l||_>l)){const t=Math.min(l/p,l/_),P=Math.max(1,Math.floor(p*t)),O=Math.max(1,Math.floor(_*t)),F=document.createElement("canvas");F.width=P,F.height=O;const $=F.getContext("2d");$?($.imageSmoothingEnabled=!0,$.imageSmoothingQuality="high",$.drawImage(i,0,0,P,O),b=F):b=i}return this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,b),this.image=b,this.updatePositionBuffer(),this.texture}cleanupTiles(){if(!this.tiles.length)return;const{gl:i}=this;for(const s of this.tiles)s.texture&&i.deleteTexture(s.texture);this.tiles=[]}shouldUseTiles(i){if(!i)return!1;const s=eS(this.gl);return i.width>s||i.height>s?!0:this.config.tileEnabled?i.width>this.config.tileSize||i.height>this.config.tileSize:!1}createTiles(i){const{gl:s}=this;this.texture&&(s.deleteTexture(this.texture),this.texture=null),this.cleanupTiles();const l=eS(s),p=Math.max(1,Math.min(this.config.tileSize,l)),_=i.width??i.width??i.width,b=i.height??i.height??i.height;if(!_||!b)return!1;const t=Math.ceil(_/p),P=Math.ceil(b/p),O=document.createElement("canvas"),F=[],$=()=>{for(const W of F)W.texture&&s.deleteTexture(W.texture)};try{for(let W=0;W<P;W++)for(let Y=0;Y<t;Y++){const ae=Y*p,se=W*p,ie=Math.min(p,_-ae),pe=Math.min(p,b-se);if(ie<=0||pe<=0)continue;O.width=ie,O.height=pe;const ye=O.getContext("2d");if(!ye)return console.warn("Failed to acquire 2D context for tile rendering, falling back to single texture."),$(),this.cleanupTiles(),!1;ye.clearRect(0,0,ie,pe),ye.drawImage(i,ae,se,ie,pe,0,0,ie,pe);const de=s.createTexture();if(!de)return console.warn("Failed to create tile texture, falling back to single texture rendering."),$(),this.cleanupTiles(),!1;s.bindTexture(s.TEXTURE_2D,de),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,O),F.push({x:ae,y:se,width:ie,height:pe,texture:de})}}catch(W){return console.warn("Failed to create tiles, falling back to single texture.",W),$(),this.cleanupTiles(),!1}finally{s.bindTexture(s.TEXTURE_2D,null)}return this.tiles=F,this.useTiles=this.tiles.length>0,this.useTiles}getVisibleTiles(){if(!this.useTiles||!this.tiles.length)return[];const i=this.transform.scale;if(!isFinite(i)||i<=0)return this.tiles;const s=-this.transform.translateX/i,l=-this.transform.translateY/i,p=(this.canvas.width-this.transform.translateX)/i,_=(this.canvas.height-this.transform.translateY)/i;return this.tiles.filter(b=>{const t=b.x+b.width,P=b.y+b.height;return t>=s&&b.x<=p&&P>=l&&b.y<=_})}resize(){const i=this.canvas.getBoundingClientRect(),s=window.devicePixelRatio||1;if(!(i.width<=0||i.height<=0)){if(this.canvas.width=i.width*s,this.canvas.height=i.height*s,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.image){const l=this.transform.translateX,p=this.transform.translateY;this.constrainToBounds(),(l!==this.transform.translateX||p!==this.transform.translateY)&&this.emitTransformChange()}this.image&&(this.texture||this.useTiles)&&this.throttledRender()}}centerImage(){if(!this.image||this.image.width<=0||this.image.height<=0)return;const i=this.canvas.width/this.canvas.height,s=this.image.width/this.image.height;if(this.canvas.width<=0||this.canvas.height<=0)return;let l;s>i?l=this.canvas.width/this.image.width:l=this.canvas.height/this.image.height,this.initialScale=l;const p=this.clampScale(l),_=this.image.width*p,b=this.image.height*p;this.transform={scale:p,translateX:(this.canvas.width-_)/2,translateY:(this.canvas.height-b)/2},this.emitZoomChange(),this.emitTransformChange()}constrainToBounds(){if(!this.config.limitToBounds||!this.image)return;const i=this.image.width*this.transform.scale,s=this.image.height*this.transform.scale;if(i<=this.canvas.width)this.transform.translateX=(this.canvas.width-i)/2;else{const l=this.canvas.width-i;this.transform.translateX=FC(this.transform.translateX,l,0)}if(s<=this.canvas.height)this.transform.translateY=(this.canvas.height-s)/2;else{const l=this.canvas.height-s;this.transform.translateY=FC(this.transform.translateY,l,0)}}getAbsoluteMinScale(){return this.initialScale*this.config.minScale}getAbsoluteMaxScale(){return this.initialScale*this.config.maxScale}clampScale(i){return FC(i,this.getAbsoluteMinScale(),this.getAbsoluteMaxScale())}render(){if(!this.program||!this.texture&&!this.useTiles||this.useTiles&&!this.tiles.length)return;const{gl:i}=this;try{if(i.isContextLost()){console.warn("WebGL context is lost, skipping render");return}this.updateAnimation(),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(this.program),i.uniform2f(this.resolutionLocation,this.canvas.width,this.canvas.height),i.uniform1i(this.imageLocation,0);const s=pQ(this.transform.scale,this.transform.translateX,this.transform.translateY);if(i.uniformMatrix3fv(this.matrixLocation,!1,s),!this.positionBuffer||!this.texCoordBuffer)return;const l=!!this.config.debug&&(!!this.texture||this.useTiles);if(this.tileDebugLocation&&i.uniform1i(this.tileDebugLocation,l?1:0),this.tileBorderColorLocation){const[b,t,P,O]=bQ;i.uniform4f(this.tileBorderColorLocation,b,t,P,O)}!l&&this.tileBorderWidthLocation&&i.uniform2f(this.tileBorderWidthLocation,0,0);const p=this.tileBorderWidthLocation;if(i.bindBuffer(i.ARRAY_BUFFER,this.texCoordBuffer),i.enableVertexAttribArray(this.texCoordLocation),i.vertexAttribPointer(this.texCoordLocation,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.enableVertexAttribArray(this.positionLocation),i.vertexAttribPointer(this.positionLocation,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.useTiles){const b=this.getVisibleTiles();for(const t of b){if(!t.texture)continue;if(l&&p){const O=Math.max(t.width,1),F=Math.max(t.height,1);i.uniform2f(p,tS/O,tS/F)}const P=new Float32Array([t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x,t.y+t.height,t.x+t.width,t.y,t.x+t.width,t.y+t.height]);i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,P,i.DYNAMIC_DRAW),i.bindTexture(i.TEXTURE_2D,t.texture),i.drawArrays(i.TRIANGLES,0,6)}}else{if(l&&p&&this.image){const b=Math.max(this.image.width,1),t=Math.max(this.image.height,1);i.uniform2f(p,tS/b,tS/t)}i.bindTexture(i.TEXTURE_2D,this.texture),i.drawArrays(i.TRIANGLES,0,6)}const _=i.getError();_!==i.NO_ERROR&&console.error("WebGL rendering error:",_)}catch(s){console.error("Error during rendering:",s)}}updateAnimation(){if(!this.animation)return;const i=Date.now()-this.animation.startTime,s=Math.min(i/this.animation.duration,1);if(s>=1){this.transform={...this.animation.targetTransform},this.animation=null,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.emitZoomChange(),this.emitTransformChange();return}const l=this.animation.easing(s),{startTransform:p,targetTransform:_}=this.animation;this.transform={scale:p.scale+(_.scale-p.scale)*l,translateX:p.translateX+(_.translateX-p.translateX)*l,translateY:p.translateY+(_.translateY-p.translateY)*l},this.emitTransformChange(),this.animationId=requestAnimationFrame(()=>this.render())}animateTo(i,s=this.config.animationTime){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.animation={startTime:Date.now(),duration:s,startTransform:{...this.transform},targetTransform:i,easing:dQ.easeOutQuart},this.render()}handleMouseDown(i){this.config.panningDisabled||(this.isDragging=!0,this.lastMousePos={x:i.clientX,y:i.clientY},this.canvas.style.cursor="grabbing",document.addEventListener("mouseup",this.boundHandleMouseUp),document.addEventListener("mousemove",this.boundHandleMouseMove),i.preventDefault())}handleMouseMove(i){if(!this.isDragging||!this.lastMousePos||this.config.panningDisabled)return;const s=window.devicePixelRatio||1,l=(i.clientX-this.lastMousePos.x)*s,p=(i.clientY-this.lastMousePos.y)*s;this.transform.translateX+=l,this.transform.translateY+=p,this.constrainToBounds(),this.lastMousePos={x:i.clientX,y:i.clientY},this.emitTransformChange(),this.throttledRender(),i.preventDefault()}handleMouseUp(){this.isDragging=!1,this.lastMousePos=null,this.canvas.style.cursor="grab",document.removeEventListener("mouseup",this.boundHandleMouseUp),document.removeEventListener("mousemove",this.boundHandleMouseMove)}handleMouseLeave(){this.isDragging&&(this.isDragging=!1,this.lastMousePos=null,this.canvas.style.cursor="grab",document.removeEventListener("mouseup",this.boundHandleMouseUp),document.removeEventListener("mousemove",this.boundHandleMouseMove))}handleWheel(i){if(this.config.wheelDisabled)return;i.preventDefault();const s=this.canvas.getBoundingClientRect(),l=window.devicePixelRatio||1,p=(i.clientX-s.left)*l,_=(i.clientY-s.top)*l,b=i.deltaY<0?1+this.config.wheelStep:1-this.config.wheelStep;this.zoomAtPoint(p,_,b)}handleClick(i){if(this.config.doubleClickDisabled)return;const s=Date.now();if(s-this.lastClickTime<ez.DOUBLE_CLICK_DELAY){const l=this.canvas.getBoundingClientRect(),p=window.devicePixelRatio||1,_=(i.clientX-l.left)*p,b=(i.clientY-l.top)*p;this.config.doubleClickMode==="toggle"?this.transform.scale>this.initialScale*1.1?this.resetView():this.zoomAtPoint(_,b,this.config.doubleClickStep,!0):this.zoomAtPoint(_,b,this.config.doubleClickStep,!0)}this.lastClickTime=s}handleTouchStart(i){i.preventDefault();const s=nz(i.touches);if(s.length===1&&s[0])this.hasMoved=!1,this.config.panningDisabled||(this.isDragging=!0,this.lastMousePos=s[0]);else if(s.length===2&&s[0]&&s[1]&&!this.config.pinchDisabled){const l=tz(s[0],s[1]),p=iz(s);this.touchState={touches:Array.from(i.touches),lastDistance:l,lastCenter:p}}}handleTouchMove(i){i.preventDefault();const s=nz(i.touches);if(s.length===1&&this.isDragging&&this.lastMousePos&&s[0]){const l=window.devicePixelRatio||1,p=(s[0].x-this.lastMousePos.x)*l,_=(s[0].y-this.lastMousePos.y)*l;(Math.abs(p)>5*l||Math.abs(_)>5*l)&&(this.hasMoved=!0),this.transform.translateX+=p,this.transform.translateY+=_,this.constrainToBounds(),this.lastMousePos=s[0],this.emitTransformChange(),this.throttledRender()}else if(s.length===2&&this.touchState&&s[0]&&s[1]){if(this.config.pinchDisabled)return;const l=tz(s[0],s[1]),p=iz(s),_=l/this.touchState.lastDistance,b=this.canvas.getBoundingClientRect(),t=window.devicePixelRatio||1,P=(p.x-b.left)*t,O=(p.y-b.top)*t;this.zoomAtPoint(P,O,_),this.touchState.lastDistance=l,this.touchState.lastCenter=p}}handleTouchEnd(i){const s=Date.now();if(i.touches.length===0&&this.lastMousePos&&!this.hasMoved&&!this.config.doubleClickDisabled){const l=this.lastMousePos;if(this.lastTouchTime>0&&s-this.lastTouchTime<ez.DOUBLE_CLICK_DELAY&&this.lastTouchPosition&&this.isNearPosition(l,this.lastTouchPosition,50)){const p=this.canvas.getBoundingClientRect(),_=window.devicePixelRatio||1,b=(l.x-p.left)*_,t=(l.y-p.top)*_;this.config.doubleClickMode==="toggle"?this.transform.scale>this.initialScale*1.1?this.resetView():this.zoomAtPoint(b,t,this.config.doubleClickStep,!0):this.zoomAtPoint(b,t,this.config.doubleClickStep,!0),this.lastTouchTime=0,this.lastTouchPosition=null}else this.lastTouchTime=s,this.lastTouchPosition=l}else this.lastTouchTime=0,this.lastTouchPosition=null;this.isDragging=!1,this.lastMousePos=null,this.touchState=null,this.hasMoved=!1}isNearPosition(i,s,l){return Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2))<=l}handleContextLost(i){i.preventDefault(),console.warn("WebGL context lost"),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.animation=null,this.isDragging=!1,this.lastMousePos=null,this.touchState=null}handleContextRestored(){console.log("WebGL context restored");try{if(this.setupWebGL(),this.image){let i=this.useTiles;i?this.createTiles(this.image)||(this.createTexture(this.image),i=!1):this.createTexture(this.image),this.useTiles=i&&this.tiles.length>0,this.useTiles&&this.updatePositionBuffer(),this.render()}}catch(i){console.error("Failed to restore WebGL context:",i)}}zoomIn(i=!1){const s=this.canvas.getBoundingClientRect(),l=window.devicePixelRatio||1,p=s.width/2*l,_=s.height/2*l;this.zoomAtPoint(p,_,1+this.config.wheelStep,i)}zoomOut(i=!1){const s=this.canvas.getBoundingClientRect(),l=window.devicePixelRatio||1,p=s.width/2*l,_=s.height/2*l;this.zoomAtPoint(p,_,1-this.config.wheelStep,i)}resetView(){if(!this.image)return;const i=this.calculateCenterTransform();this.animateTo(i)}calculateCenterTransform(){if(!this.image||this.image.width<=0||this.image.height<=0)return{...this.transform};const i=this.canvas.width/this.canvas.height,s=this.image.width/this.image.height;if(this.canvas.width<=0||this.canvas.height<=0)return{...this.transform};let l;s>i?l=this.canvas.width/this.image.width:l=this.canvas.height/this.image.height,this.initialScale=l;const p=this.clampScale(l),_=this.image.width*p,b=this.image.height*p;return{scale:p,translateX:(this.canvas.width-_)/2,translateY:(this.canvas.height-b)/2}}getScale(){return this.transform.scale}getRelativeScale(){return this.transform.scale/this.initialScale}zoomAtPoint(i,s,l,p=!1){if(!isFinite(l)||l<=0||!isFinite(i)||!isFinite(s))return;const _=this.clampScale(this.transform.scale*l);if(_===this.transform.scale||!isFinite(_))return;const b=(i-this.transform.translateX)/this.transform.scale,t=(s-this.transform.translateY)/this.transform.scale,P=i-b*_,O=s-t*_;if(!isFinite(P)||!isFinite(O))return;const F={scale:_,translateX:P,translateY:O},$=this.transform;this.transform=F,this.constrainToBounds();const W={...this.transform};this.transform=$,p?this.animateTo(W):(this.transform=W,this.throttledRender(),this.emitZoomChange(),this.emitTransformChange())}emitZoomChange(){if(this.onZoomChange){const i=this.transform.scale/this.initialScale;this.onZoomChange(this.transform.scale,i)}}emitTransformChange(){this.onTransformChange&&this.onTransformChange({...this.transform})}getDebugInfo(){if(!this.image)return null;const i=this.useTiles?this.getVisibleTiles():[],s="src"in this.image&&typeof this.image.src=="string"?this.image.src:"";return{scale:this.transform.scale,relativeScale:this.transform.scale/this.initialScale,translateX:this.transform.translateX,translateY:this.transform.translateY,canvasWidth:this.canvas.width,canvasHeight:this.canvas.height,imageWidth:this.image.width,imageHeight:this.image.height,devicePixelRatio:window.devicePixelRatio||1,maxTextureSize:eS(this.gl),isLoading:this.isLoadingTexture,loadingState:this.currentLoadingState,currentQuality:this.currentQuality,imageSrc:s,tileEnabled:this.config.tileEnabled,useTiles:this.useTiles,totalTiles:this.tiles.length,visibleTiles:i.length,tileSize:this.config.tileSize}}setCallbacks(i){this.onZoomChange=i.onZoomChange,this.onImageCopied=i.onImageCopied,this.onLoadingStateChange=i.onLoadingStateChange,this.onTransformChange=i.onTransformChange}async copyOriginalImageToClipboard(){if(!this.image)throw new Error("No image loaded");try{const i=document.createElement("canvas"),s=i.getContext("2d");if(!s)throw new Error("Failed to get 2D context");i.width=this.image.width,i.height=this.image.height,s.drawImage(this.image,0,0);const l=await new Promise(p=>{i.toBlob(p,"image/png")});if(!l)throw new Error("Failed to create blob");await navigator.clipboard.write([new ClipboardItem({"image/png":l})]),this.onImageCopied?.()}catch(i){throw console.error("Failed to copy image to clipboard:",i),i}}destroy(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null);const{gl:i}=this;this.texture&&(i.deleteTexture(this.texture),this.texture=null),this.cleanupTiles(),this.useTiles=!1,this.positionBuffer&&(i.deleteBuffer(this.positionBuffer),this.positionBuffer=null),this.texCoordBuffer&&(i.deleteBuffer(this.texCoordBuffer),this.texCoordBuffer=null),this.program&&(i.deleteProgram(this.program),this.program=null),this.canvas.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.removeEventListener("mouseleave",this.boundHandleMouseLeave),this.canvas.removeEventListener("wheel",this.handleWheel.bind(this)),this.canvas.removeEventListener("click",this.handleClick.bind(this)),this.canvas.removeEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.removeEventListener("touchmove",this.handleTouchMove.bind(this)),this.canvas.removeEventListener("touchend",this.handleTouchEnd.bind(this)),this.canvas.removeEventListener("webglcontextlost",this.handleContextLost.bind(this)),this.canvas.removeEventListener("webglcontextrestored",this.handleContextRestored.bind(this)),this.canvas.removeEventListener("contextmenu",s=>s.preventDefault()),document.removeEventListener("mouseup",this.boundHandleMouseUp),document.removeEventListener("mousemove",this.boundHandleMouseMove),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.animation=null,this.isDragging=!1,this.lastMousePos=null,this.touchState=null,this.lastTouchTime=0,this.lastTouchPosition=null,this.hasMoved=!1,this.image=null,this.onZoomChange=void 0,this.onImageCopied=void 0,this.worker&&(this.worker.terminate(),this.worker=null)}}const TQ={class:"webgl-debug-info"},SQ={class:"debug-section"},EQ={class:"debug-section"},IQ={class:"debug-section"},CQ={class:"debug-section"},AQ={class:"debug-section"},PQ={class:"debug-section"},MQ={class:"debug-section"},kQ={key:0,class:"image-src"},DQ=kr({__name:"DebugInfo",props:{debugInfo:{}},setup(e){const i=p=>({idle:"","image-loading":"","texture-loading":"","tile-loading":"",complete:"",error:""})[p]||p,s=p=>({high:"",medium:"",low:"",unknown:""})[p]||p,l=p=>p.length<=30?p:p.slice(0,27)+"...";return(p,_)=>(li(),ir("div",TQ,[Bn("div",SQ,[_[0]||(_[0]=Bn("h4",null,"",-1)),Bn("div",null,": "+Lr(e.debugInfo.scale.toFixed(3)),1),Bn("div",null,": "+Lr(e.debugInfo.relativeScale.toFixed(3)),1)]),Bn("div",EQ,[_[1]||(_[1]=Bn("h4",null,"",-1)),Bn("div",null,"X: "+Lr(e.debugInfo.translateX.toFixed(2)),1),Bn("div",null,"Y: "+Lr(e.debugInfo.translateY.toFixed(2)),1)]),Bn("div",IQ,[_[2]||(_[2]=Bn("h4",null,"Canvas",-1)),Bn("div",null,": "+Lr(e.debugInfo.canvasWidth),1),Bn("div",null,": "+Lr(e.debugInfo.canvasHeight),1),Bn("div",null,": "+Lr(e.debugInfo.devicePixelRatio),1)]),Bn("div",CQ,[_[3]||(_[3]=Bn("h4",null,"",-1)),Bn("div",null,": "+Lr(e.debugInfo.imageWidth),1),Bn("div",null,": "+Lr(e.debugInfo.imageHeight),1)]),Bn("div",AQ,[_[4]||(_[4]=Bn("h4",null,"",-1)),Bn("div",null,": "+Lr(e.debugInfo.tileEnabled?"":""),1),Bn("div",null,": "+Lr(e.debugInfo.useTiles?"":""),1),Bn("div",null,": "+Lr(e.debugInfo.totalTiles),1),Bn("div",null,": "+Lr(e.debugInfo.visibleTiles),1),Bn("div",null,": "+Lr(e.debugInfo.tileSize),1)]),Bn("div",PQ,[_[5]||(_[5]=Bn("h4",null,"WebGL",-1)),Bn("div",null,": "+Lr(e.debugInfo.maxTextureSize),1)]),Bn("div",MQ,[_[6]||(_[6]=Bn("h4",null,"",-1)),Bn("div",null,": "+Lr(e.debugInfo.isLoading?"":""),1),Bn("div",null,": "+Lr(i(e.debugInfo.loadingState)),1),Bn("div",null,": "+Lr(s(e.debugInfo.currentQuality)),1),e.debugInfo.imageSrc?(li(),ir("div",kQ," : "+Lr(l(e.debugInfo.imageSrc)),1)):gr("",!0)])]))}}),R6=(e,i)=>{const s=e.__vccOpts||e;for(const[l,p]of i)s[l]=p;return s},LQ=R6(DQ,[["__scopeId","data-v-07457215"]]),RQ=kr({__name:"WebGLImageViewer",props:{src:{},class:{},width:{},height:{},initialScale:{default:1},minScale:{default:.1},maxScale:{default:10},centerOnInit:{type:Boolean,default:!0},debug:{type:Boolean,default:!1},limitToBounds:{type:Boolean,default:!0},smooth:{type:Boolean,default:!0},wheel:{default:()=>({step:.1})},pinch:{default:()=>({step:.5})},doubleClick:{default:()=>({step:2,mode:"toggle",animationTime:200})},panning:{default:()=>({velocityDisabled:!0})},alignmentAnimation:{default:()=>({duration:300,easing:e=>1-Math.pow(1-e,4)})},velocityAnimation:{default:()=>({duration:400,easing:e=>1-Math.pow(1-e,3)})},tile:{default:()=>({enabled:!0,size:wu.tileSize})}},emits:["zoomChange","imageCopied","loadingStateChange"],setup(e,{expose:i,emit:s}){const l=e,p=s,_=an(),b=an(),t=an(null),P=an(""),O=Ei(()=>({...wu,initialScale:l.initialScale,minScale:l.minScale,maxScale:l.maxScale,centerOnInit:l.centerOnInit,debug:l.debug,limitToBounds:l.limitToBounds,smooth:l.smooth,wheelStep:l.wheel?.step??wu.wheelStep,wheelDisabled:l.wheel?.wheelDisabled??wu.wheelDisabled,touchPadDisabled:l.wheel?.touchPadDisabled??wu.touchPadDisabled,pinchStep:l.pinch?.step??wu.pinchStep,pinchDisabled:l.pinch?.disabled??wu.pinchDisabled,doubleClickStep:l.doubleClick?.step??wu.doubleClickStep,doubleClickMode:l.doubleClick?.mode??wu.doubleClickMode,doubleClickDisabled:l.doubleClick?.disabled??wu.doubleClickDisabled,animationTime:l.doubleClick?.animationTime??wu.animationTime,panningDisabled:l.panning?.disabled??wu.panningDisabled,velocityDisabled:l.panning?.velocityDisabled??wu.velocityDisabled,tileEnabled:l.tile?.enabled??wu.tileEnabled,tileSize:l.tile?.size??wu.tileSize,alignmentAnimation:{...wu.alignmentAnimation,...l.alignmentAnimation},velocityAnimation:{...wu.velocityAnimation,...l.velocityAnimation}})),F=async()=>{if(!_.value)throw new Error("Canvas not available");if(!mQ())throw new Error("WebGL not supported");try{b.value=new wQ(_.value,O.value),b.value.setCallbacks({onZoomChange:(de,Ee)=>{p("zoomChange",de,Ee),O.value.debug&&$()},onImageCopied:()=>{p("imageCopied")},onLoadingStateChange:(de,Ee,Pe)=>{p("loadingStateChange",de,Ee,Pe)},onTransformChange:de=>{O.value.debug&&$()}}),l.src&&(await b.value.loadImage(l.src),O.value.debug&&$())}catch(de){throw console.error("Failed to initialize WebGL engine:",de),P.value=de instanceof Error?de.message:"Unknown error",de}},$=()=>{b.value&&(t.value=b.value.getDebugInfo())},W=de=>{console.error("Canvas error:",de),P.value="Canvas error occurred"},Y=(de=!1)=>{b.value?.zoomIn(de)},ae=(de=!1)=>{b.value?.zoomOut(de)},se=()=>{b.value?.resetView()},ie=()=>b.value?.getScale()??1,pe=()=>b.value?.getRelativeScale()??1,ye=async()=>{if(!b.value)throw new Error("Engine not initialized");return b.value.copyOriginalImageToClipboard()};return La(async()=>{try{await F()}catch(de){console.error("Failed to mount WebGL Image Viewer:",de)}}),ru(()=>{b.value?.destroy()}),Qn(()=>l.src,async de=>{if(de&&b.value)try{await b.value.loadImage(de),O.value.debug&&$()}catch(Ee){console.error("Failed to load new image:",Ee),P.value=Ee instanceof Error?Ee.message:"Failed to load image"}}),Qn(O,de=>{b.value&&(b.value.destroy(),F().catch(console.error))},{deep:!0}),i({zoomIn:Y,zoomOut:ae,resetView:se,getScale:ie,getRelativeScale:pe,copyToClipboard:ye}),(de,Ee)=>(li(),ir("div",{class:_s(["webgl-image-viewer",l.class])},[Bn("canvas",{ref_key:"canvasRef",ref:_,class:"webgl-canvas",onError:W},null,544),O.value.debug&&t.value?(li(),En(LQ,{key:0,"debug-info":t.value},null,8,["debug-info"])):gr("",!0)],2))}}),z6=R6(RQ,[["__scopeId","data-v-c839b956"]]),zQ=ol(e=>{e.vueApp.component("WebGLImageViewer",z6)});function OQ(e,i){let s;return(...l)=>{s!==void 0&&clearTimeout(s),s=setTimeout(()=>e(...l),i)}}function FQ({columns:e,columnWidth:i,emit:s,gap:l,items:p,maxColumns:_,minColumns:b,nextTick:t,onBeforeUnmount:P,onMounted:O,rtl:F,scrollContainer:$,ssrColumns:W,vue:Y,wall:ae,watch:se}){function ie(Ye,ct,Lt,Ht){const ci=pe(Lt);return Ht+ct+ci<=Ye?ie(Ye,ct,Lt+1,Ht+ct+ci):Lt}function pe(Ye){const ct=Array.isArray(i.value)?i.value:[i.value];return ct[Ye%ct.length]}function ye(){const Ye=Ee(de(ie(ae.value.getBoundingClientRect().width,l.value,0,-l.value)));return Ye>0?Ye:1}function de(Ye){const ct=_?.value;return ct&&Ye>ct?ct:Ye}function Ee(Ye){const ct=b?.value;return ct&&Ye<ct?ct:Ye}if(W.value>0){const Ye=sz(W.value);p.value.forEach((ct,Lt)=>Ye[Lt%W.value].push(Lt)),e.value=Ye}let Pe=0;async function Ze(Ye,ct){if(Ye>=p.value.length||(await t(),Pe!==ct))return;const Lt=[...ae.value.children];F.value&&Lt.reverse();const Ht=Lt.reduce((ci,Wt)=>Wt.getBoundingClientRect().height<ci.getBoundingClientRect().height?Wt:ci);e.value[+Ht.dataset.index].push(Ye),await Ze(Ye+1,ct)}async function We(Ye=!1){const ct=ye();if(e.value.length===ct&&!Ye){s(Y===2?"redraw-skip":"redrawSkip");return}e.value=sz(ct);const Lt=$?.value,Ht=Lt?Lt.scrollTop:window.scrollY;await Ze(0,++Pe),Lt?Lt.scrollBy({top:Ht-Lt.scrollTop}):window.scrollTo({top:Ht}),s("redraw")}const je=typeof ResizeObserver>"u"?void 0:new ResizeObserver(OQ(()=>We()));return O(()=>{We(),je?.observe(ae.value)}),P(()=>je?.unobserve(ae.value)),se([p,F],()=>We(!0)),se([i,l,b,_],()=>We()),{getColumnWidthTarget:pe}}function sz(e){return Array.from({length:e}).map(()=>[])}const BQ=["data-index"];var NQ=kr({__name:"masonry-wall",props:{columnWidth:{default:400},items:{},gap:{default:0},rtl:{type:Boolean,default:!1},ssrColumns:{default:0},scrollContainer:{default:null},minColumns:{default:1},maxColumns:{},keyMapper:{}},emits:["redraw","redrawSkip"],setup(e,{emit:i}){const s=e,l=i,p=an([]),_=an(),{getColumnWidthTarget:b}=FQ({columns:p,emit:l,nextTick:Da,onBeforeUnmount:Vf,onMounted:La,vue:3,wall:_,watch:Qn,...Mp(s)});return(t,P)=>(li(),ir("div",{ref_key:"wall",ref:_,class:"masonry-wall",style:Su({display:"flex",gap:`${e.gap}px`})},[(li(!0),ir(qs,null,Eu(p.value,(O,F)=>(li(),ir("div",{key:F,class:"masonry-column","data-index":F,style:Su({display:"flex","flex-basis":`${ut(b)(F)}px`,"flex-direction":"column","flex-grow":1,gap:`${e.gap}px`,height:["-webkit-max-content","-moz-max-content","max-content"],"min-width":0})},[(li(!0),ir(qs,null,Eu(O,($,W)=>(li(),ir("div",{key:e.keyMapper?.(e.items[$],F,W,$)??$,class:"masonry-item"},[Rs(t.$slots,"default",{item:e.items[$],column:F,columnCount:p.value.length,row:W,index:$},()=>[Gd(Lr(e.items[$]),1)])]))),128))],12,BQ))),128))],4))}}),VQ=NQ;const jQ=(()=>{const e=VQ;return e.install=i=>{i.component("MasonryWall",e)},e})();var UQ=jQ;const $Q=ol(e=>{e.vueApp.use(UQ)}),GQ=ol({name:"i18n:plugin:ssg-detect",dependsOn:["i18n:plugin","i18n:plugin:route-locale-detect"],enforce:"post",setup(e){}}),qQ=[Cq,Aq,Lq,vW,nZ,rZ,sZ,oZ,aZ,lZ,hZ,dZ,fZ,mZ,cK,uK,hK,pK,tJ,iJ,iQ,oQ,cQ,uQ,zQ,$Q,GQ];function HQ(e,i){const s=i/e*100;return 2/Math.PI*100*Math.atan(s/50)}function WQ(e={}){const{duration:i=2e3,throttle:s=200,hideDelay:l=500,resetDelay:p=400}=e,_=e.estimatedProgress||HQ,b=Vs(),t=so(0),P=so(!1),O=so(!1);let F=!1,$,W,Y,ae;const se=(We={})=>{de(),O.value=!1,ie(0,We)};function ie(We=0,je={}){if(b.isHydrating)return;if(We>=100)return ye({force:je.force});Ee(),t.value=We<0?0:We;const Ye=je.force?0:s;Ye?W=setTimeout(()=>{P.value=!0,Pe()},Ye):(P.value=!0,Pe())}function pe(){Y=setTimeout(()=>{P.value=!1,ae=setTimeout(()=>{t.value=0},p)},l)}function ye(We={}){t.value=100,F=!0,Ee(),de(),We.error&&(O.value=!0),We.force?(t.value=0,P.value=!1):pe()}function de(){clearTimeout(Y),clearTimeout(ae)}function Ee(){clearTimeout(W),cancelAnimationFrame($)}function Pe(){F=!1;let We;function je(Ye){if(F)return;We??=Ye;const ct=Ye-We;t.value=Math.max(0,Math.min(100,_(i,ct))),$=requestAnimationFrame(je)}$=requestAnimationFrame(je)}let Ze=()=>{};{const We=b.hook("page:loading:start",()=>{se()}),je=b.hook("page:loading:end",()=>{ye()}),Ye=b.hook("vue:error",()=>ye());Ze=()=>{Ye(),We(),je(),Ee()}}return{_cleanup:Ze,progress:Ei(()=>t.value),isLoading:Ei(()=>P.value),error:Ei(()=>O.value),start:se,set:ie,finish:ye,clear:Ee}}function ZQ(e={}){const i=Vs(),s=i._loadingIndicator||=WQ(e);return Rp()&&(i._loadingIndicatorDeps||=0,i._loadingIndicatorDeps++,H_(()=>{i._loadingIndicatorDeps--,i._loadingIndicatorDeps===0&&(s._cleanup(),delete i._loadingIndicator)})),s}const XQ=kr({name:"NuxtLoadingIndicator",props:{throttle:{type:Number,default:200},duration:{type:Number,default:2e3},hideDelay:{type:Number,default:500},resetDelay:{type:Number,default:400},height:{type:Number,default:3},color:{type:[String,Boolean],default:"repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%)"},errorColor:{type:String,default:"repeating-linear-gradient(to right,#f87171 0%,#ef4444 100%)"},estimatedProgress:{type:Function,required:!1}},setup(e,{slots:i,expose:s}){const{progress:l,isLoading:p,error:_,start:b,finish:t,clear:P}=ZQ({duration:e.duration,throttle:e.throttle,hideDelay:e.hideDelay,resetDelay:e.resetDelay,estimatedProgress:e.estimatedProgress});return s({progress:l,isLoading:p,error:_,start:b,finish:t,clear:P}),()=>Ns("div",{class:"nuxt-loading-indicator",style:{position:"fixed",top:0,right:0,left:0,pointerEvents:"none",width:"auto",height:`${e.height}px`,opacity:p.value?1:0,background:_.value?e.errorColor:e.color||void 0,backgroundSize:`${l.value>0?100/l.value*100:0}% auto`,transform:`scaleX(${l.value}%)`,transformOrigin:"left",transition:"transform 0.1s, height 0.4s, opacity 0.4s",zIndex:999999}},i)}}),O6=(e="RouteProvider")=>kr({name:e,props:{route:{type:Object,required:!0},vnode:Object,vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(i){const s=i.renderKey,l=i.route,p={};for(const _ in i.route)Object.defineProperty(p,_,{get:()=>s===i.renderKey?i.route[_]:l[_],enumerable:!0});return Ka(mv,Ip(p)),()=>i.vnode?Ns(i.vnode,{ref:i.vnodeRef}):i.vnode}}),YQ=O6(),oz=new WeakMap,KQ=kr({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(e,{attrs:i,slots:s,expose:l}){const p=Vs(),_=an(),b=Fo(mv,null);let t;l({pageRef:_});const P=Fo(jB,null);let O;const F=p.deferHydration();if(p.isHydrating){const W=p.hooks.hookOnce("app:error",F);nu().beforeEach(W)}e.pageKey&&Qn(()=>e.pageKey,(W,Y)=>{W!==Y&&p.callHook("page:loading:start")});let $=!1;{const W=nu().beforeResolve(()=>{$=!1});Vf(()=>{W()})}return()=>Ns(_4,{name:e.name,route:e.route,...i},{default:W=>{const Y=QQ(b,W.route,W.Component),ae=b&&b.matched.length===W.route.matched.length;if(!W.Component){if(O&&!ae)return O;F();return}if(O&&P&&!P.isCurrent(W.route))return O;if(Y&&b&&(!P||P?.isCurrent(b)))return ae?O:null;const se=WA(W,e.pageKey),ie=eee(b,W.route,W.Component);!p.isHydrating&&t===se&&!ie&&Da(()=>{$=!0,p.callHook("page:loading:end")}),t=se;const pe=!!(e.transition??W.route.meta.pageTransition??cR),ye=pe&&JQ([e.transition,W.route.meta.pageTransition,cR,{onAfterLeave(){delete p._runningTransition,p.callHook("page:transition:finish",W.Component)}}]),de=e.keepalive??W.route.meta.keepalive??mG;return O=v4(pe&&ye,$H(de,Ns(uM,{suspensible:!0,onPending:()=>{pe&&(p._runningTransition=!0),p.callHook("page:start",W.Component)},onResolve:async()=>{await Da();try{p._route.sync?.(),await p.callHook("page:finish",W.Component),delete p._runningTransition,!$&&!ie&&($=!0,await p.callHook("page:loading:end"))}finally{F()}}},{default:()=>{const Ee={key:se||void 0,vnode:s.default?tee(s.default,W):W.Component,route:W.route,renderKey:se||void 0,trackRootNodes:pe,vnodeRef:_};if(!de)return Ns(YQ,Ee);const Pe=W.Component.type,Ze=Pe;let We=oz.get(Ze);return We||(We=O6(Pe.name||Pe.__name),oz.set(Ze,We)),Ns(We,Ee)}}))).default(),O}})}});function JQ(e){const i=[];for(const s of e)s&&i.push({...s,onAfterLeave:s.onAfterLeave?bM(s.onAfterLeave):void 0});return a0(...i)}function QQ(e,i,s){if(!e)return!1;const l=i.matched.findIndex(p=>p.components?.default===s?.type);return!l||l===-1?!1:i.matched.slice(0,l).some((p,_)=>p.components?.default!==e.matched[_]?.components?.default)||s&&WA({route:i,Component:s})!==WA({route:e,Component:s})}function eee(e,i,s){return e?i.matched.findIndex(p=>p.components?.default===s?.type)<i.matched.length-1:!1}function tee(e,i){const s=e(i);return s.length===1?Ns(s[0]):Ns(qs,void 0,s)}const iee=kr({name:"LayoutLoader",inheritAttrs:!1,props:{name:String,layoutProps:Object},setup(e,i){return()=>Ns(Qy[e.name],e.layoutProps,i.slots)}}),nee={name:{type:[String,Boolean,Object],default:null},fallback:{type:[String,Object],default:null}},ree=kr({name:"NuxtLayout",inheritAttrs:!1,props:nee,setup(e,i){const s=Vs(),l=Fo(mv),_=!l||l===Qw()?y4():l,b=Ei(()=>{let F=ut(e.name)??_?.meta.layout??"default";return F&&!(F in Qy)&&e.fallback&&(F=ut(e.fallback)),F}),t=so();i.expose({layoutRef:t});const P=s.deferHydration();if(s.isHydrating){const F=s.hooks.hookOnce("app:error",P);nu().beforeEach(F)}let O;return()=>{const F=b.value&&b.value in Qy,$=_?.meta.layoutTransition??pG,W=O;return O=b.value,v4(F&&$,{default:()=>Ns(uM,{suspensible:!0,onResolve:()=>{Da(P)}},{default:()=>Ns(see,{layoutProps:Oo(i.attrs,{ref:t}),key:b.value||void 0,name:b.value,shouldProvide:!e.name,isRenderingNewLayout:Y=>Y!==W&&Y===b.value,hasTransition:!!$},i.slots)})}).default()}}}),see=kr({name:"NuxtLayoutProvider",inheritAttrs:!1,props:{name:{type:[String,Boolean]},layoutProps:{type:Object},hasTransition:{type:Boolean},shouldProvide:{type:Boolean},isRenderingNewLayout:{type:Function,required:!0}},setup(e,i){const s=e.name;e.shouldProvide&&Ka(jB,{isCurrent:_=>s===(_.meta.layout??"default")});const l=Fo(mv);if(l&&l===Qw()){const _=y4(),b={};for(const t in _){const P=t;Object.defineProperty(b,P,{enumerable:!0,get:()=>e.isRenderingNewLayout(e.name)?_[P]:l[P]})}Ka(mv,Ip(b))}return()=>!s||typeof s=="string"&&!(s in Qy)?i.slots.default?.():Ns(iee,{key:s,layoutProps:e.layoutProps,name:s},i.slots)}}),oee=(e,i)=>{const s=new Array(e.length+i.length);for(let l=0;l<e.length;l++)s[l]=e[l];for(let l=0;l<i.length;l++)s[e.length+l]=i[l];return s},aee=(e,i)=>({classGroupId:e,validator:i}),F6=(e=new Map,i=null,s)=>({nextPart:e,validators:i,classGroupId:s}),xE="-",az=[],lee="arbitrary..",cee=e=>{const i=hee(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:l}=e;return{getClassGroupId:b=>{if(b.startsWith("[")&&b.endsWith("]"))return uee(b);const t=b.split(xE),P=t[0]===""&&t.length>1?1:0;return B6(t,P,i)},getConflictingClassGroupIds:(b,t)=>{if(t){const P=l[b],O=s[b];return P?O?oee(O,P):P:O||az}return s[b]||az}}},B6=(e,i,s)=>{if(e.length-i===0)return s.classGroupId;const p=e[i],_=s.nextPart.get(p);if(_){const O=B6(e,i+1,_);if(O)return O}const b=s.validators;if(b===null)return;const t=i===0?e.join(xE):e.slice(i).join(xE),P=b.length;for(let O=0;O<P;O++){const F=b[O];if(F.validator(t))return F.classGroupId}},uee=e=>e.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const i=e.slice(1,-1),s=i.indexOf(":"),l=i.slice(0,s);return l?lee+l:void 0})(),hee=e=>{const{theme:i,classGroups:s}=e;return dee(s,i)},dee=(e,i)=>{const s=F6();for(const l in e){const p=e[l];LM(p,s,l,i)}return s},LM=(e,i,s,l)=>{const p=e.length;for(let _=0;_<p;_++){const b=e[_];fee(b,i,s,l)}},fee=(e,i,s,l)=>{if(typeof e=="string"){pee(e,i,s);return}if(typeof e=="function"){mee(e,i,s,l);return}gee(e,i,s,l)},pee=(e,i,s)=>{const l=e===""?i:N6(i,e);l.classGroupId=s},mee=(e,i,s,l)=>{if(_ee(e)){LM(e(l),i,s,l);return}i.validators===null&&(i.validators=[]),i.validators.push(aee(s,e))},gee=(e,i,s,l)=>{const p=Object.entries(e),_=p.length;for(let b=0;b<_;b++){const[t,P]=p[b];LM(P,N6(i,t),s,l)}},N6=(e,i)=>{let s=e;const l=i.split(xE),p=l.length;for(let _=0;_<p;_++){const b=l[_];let t=s.nextPart.get(b);t||(t=F6(),s.nextPart.set(b,t)),s=t}return s},_ee=e=>"isThemeGetter"in e&&e.isThemeGetter===!0,yee=e=>{if(e<1)return{get:()=>{},set:()=>{}};let i=0,s=Object.create(null),l=Object.create(null);const p=(_,b)=>{s[_]=b,i++,i>e&&(i=0,l=s,s=Object.create(null))};return{get(_){let b=s[_];if(b!==void 0)return b;if((b=l[_])!==void 0)return p(_,b),b},set(_,b){_ in s?s[_]=b:p(_,b)}}},hP="!",lz=":",vee=[],cz=(e,i,s,l,p)=>({modifiers:e,hasImportantModifier:i,baseClassName:s,maybePostfixModifierPosition:l,isExternal:p}),xee=e=>{const{prefix:i,experimentalParseClassName:s}=e;let l=p=>{const _=[];let b=0,t=0,P=0,O;const F=p.length;for(let se=0;se<F;se++){const ie=p[se];if(b===0&&t===0){if(ie===lz){_.push(p.slice(P,se)),P=se+1;continue}if(ie==="/"){O=se;continue}}ie==="["?b++:ie==="]"?b--:ie==="("?t++:ie===")"&&t--}const $=_.length===0?p:p.slice(P);let W=$,Y=!1;$.endsWith(hP)?(W=$.slice(0,-1),Y=!0):$.startsWith(hP)&&(W=$.slice(1),Y=!0);const ae=O&&O>P?O-P:void 0;return cz(_,Y,W,ae)};if(i){const p=i+lz,_=l;l=b=>b.startsWith(p)?_(b.slice(p.length)):cz(vee,!1,b,void 0,!0)}if(s){const p=l;l=_=>s({className:_,parseClassName:p})}return l},bee=e=>{const i=new Map;return e.orderSensitiveModifiers.forEach((s,l)=>{i.set(s,1e6+l)}),s=>{const l=[];let p=[];for(let _=0;_<s.length;_++){const b=s[_],t=b[0]==="[",P=i.has(b);t||P?(p.length>0&&(p.sort(),l.push(...p),p=[]),l.push(b)):p.push(b)}return p.length>0&&(p.sort(),l.push(...p)),l}},wee=e=>({cache:yee(e.cacheSize),parseClassName:xee(e),sortModifiers:bee(e),...cee(e)}),Tee=/\s+/,See=(e,i)=>{const{parseClassName:s,getClassGroupId:l,getConflictingClassGroupIds:p,sortModifiers:_}=i,b=[],t=e.trim().split(Tee);let P="";for(let O=t.length-1;O>=0;O-=1){const F=t[O],{isExternal:$,modifiers:W,hasImportantModifier:Y,baseClassName:ae,maybePostfixModifierPosition:se}=s(F);if($){P=F+(P.length>0?" "+P:P);continue}let ie=!!se,pe=l(ie?ae.substring(0,se):ae);if(!pe){if(!ie){P=F+(P.length>0?" "+P:P);continue}if(pe=l(ae),!pe){P=F+(P.length>0?" "+P:P);continue}ie=!1}const ye=W.length===0?"":W.length===1?W[0]:_(W).join(":"),de=Y?ye+hP:ye,Ee=de+pe;if(b.indexOf(Ee)>-1)continue;b.push(Ee);const Pe=p(pe,ie);for(let Ze=0;Ze<Pe.length;++Ze){const We=Pe[Ze];b.push(de+We)}P=F+(P.length>0?" "+P:P)}return P},Eee=(...e)=>{let i=0,s,l,p="";for(;i<e.length;)(s=e[i++])&&(l=V6(s))&&(p&&(p+=" "),p+=l);return p},V6=e=>{if(typeof e=="string")return e;let i,s="";for(let l=0;l<e.length;l++)e[l]&&(i=V6(e[l]))&&(s&&(s+=" "),s+=i);return s},dP=(e,...i)=>{let s,l,p,_;const b=P=>{const O=i.reduce((F,$)=>$(F),e());return s=wee(O),l=s.cache.get,p=s.cache.set,_=t,t(P)},t=P=>{const O=l(P);if(O)return O;const F=See(P,s);return p(P,F),F};return _=b,(...P)=>_(Eee(...P))},Iee=[],eu=e=>{const i=s=>s[e]||Iee;return i.isThemeGetter=!0,i},j6=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,U6=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Cee=/^\d+\/\d+$/,Aee=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pee=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Mee=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,kee=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Dee=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Cx=e=>Cee.test(e),wo=e=>!!e&&!Number.isNaN(Number(e)),qy=e=>!!e&&Number.isInteger(Number(e)),BC=e=>e.endsWith("%")&&wo(e.slice(0,-1)),k_=e=>Aee.test(e),Lee=()=>!0,Ree=e=>Pee.test(e)&&!Mee.test(e),$6=()=>!1,zee=e=>kee.test(e),Oee=e=>Dee.test(e),Fee=e=>!Xr(e)&&!Yr(e),Bee=e=>fb(e,H6,$6),Xr=e=>j6.test(e),J0=e=>fb(e,W6,Ree),NC=e=>fb(e,$ee,wo),uz=e=>fb(e,G6,$6),Nee=e=>fb(e,q6,Oee),iS=e=>fb(e,Z6,zee),Yr=e=>U6.test(e),W1=e=>pb(e,W6),Vee=e=>pb(e,Gee),hz=e=>pb(e,G6),jee=e=>pb(e,H6),Uee=e=>pb(e,q6),nS=e=>pb(e,Z6,!0),fb=(e,i,s)=>{const l=j6.exec(e);return l?l[1]?i(l[1]):s(l[2]):!1},pb=(e,i,s=!1)=>{const l=U6.exec(e);return l?l[1]?i(l[1]):s:!1},G6=e=>e==="position"||e==="percentage",q6=e=>e==="image"||e==="url",H6=e=>e==="length"||e==="size"||e==="bg-size",W6=e=>e==="length",$ee=e=>e==="number",Gee=e=>e==="family-name",Z6=e=>e==="shadow",fP=()=>{const e=eu("color"),i=eu("font"),s=eu("text"),l=eu("font-weight"),p=eu("tracking"),_=eu("leading"),b=eu("breakpoint"),t=eu("container"),P=eu("spacing"),O=eu("radius"),F=eu("shadow"),$=eu("inset-shadow"),W=eu("text-shadow"),Y=eu("drop-shadow"),ae=eu("blur"),se=eu("perspective"),ie=eu("aspect"),pe=eu("ease"),ye=eu("animate"),de=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ee=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],Pe=()=>[...Ee(),Yr,Xr],Ze=()=>["auto","hidden","clip","visible","scroll"],We=()=>["auto","contain","none"],je=()=>[Yr,Xr,P],Ye=()=>[Cx,"full","auto",...je()],ct=()=>[qy,"none","subgrid",Yr,Xr],Lt=()=>["auto",{span:["full",qy,Yr,Xr]},qy,Yr,Xr],Ht=()=>[qy,"auto",Yr,Xr],ci=()=>["auto","min","max","fr",Yr,Xr],Wt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],$t=()=>["start","end","center","stretch","center-safe","end-safe"],Dt=()=>["auto",...je()],Ft=()=>[Cx,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...je()],vt=()=>[e,Yr,Xr],wi=()=>[...Ee(),hz,uz,{position:[Yr,Xr]}],Qi=()=>["no-repeat",{repeat:["","x","y","space","round"]}],wn=()=>["auto","cover","contain",jee,Bee,{size:[Yr,Xr]}],qn=()=>[BC,W1,J0],Fn=()=>["","none","full",O,Yr,Xr],mr=()=>["",wo,W1,J0],Sr=()=>["solid","dashed","dotted","double"],Hr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ti=()=>[wo,BC,hz,uz],sn=()=>["","none",ae,Yr,Xr],Gi=()=>["none",wo,Yr,Xr],gn=()=>["none",wo,Yr,Xr],nr=()=>[wo,Yr,Xr],Ur=()=>[Cx,"full",...je()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[k_],breakpoint:[k_],color:[Lee],container:[k_],"drop-shadow":[k_],ease:["in","out","in-out"],font:[Fee],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[k_],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[k_],shadow:[k_],spacing:["px",wo],text:[k_],"text-shadow":[k_],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Cx,Xr,Yr,ie]}],container:["container"],columns:[{columns:[wo,Xr,Yr,t]}],"break-after":[{"break-after":de()}],"break-before":[{"break-before":de()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:Pe()}],overflow:[{overflow:Ze()}],"overflow-x":[{"overflow-x":Ze()}],"overflow-y":[{"overflow-y":Ze()}],overscroll:[{overscroll:We()}],"overscroll-x":[{"overscroll-x":We()}],"overscroll-y":[{"overscroll-y":We()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Ye()}],"inset-x":[{"inset-x":Ye()}],"inset-y":[{"inset-y":Ye()}],start:[{start:Ye()}],end:[{end:Ye()}],top:[{top:Ye()}],right:[{right:Ye()}],bottom:[{bottom:Ye()}],left:[{left:Ye()}],visibility:["visible","invisible","collapse"],z:[{z:[qy,"auto",Yr,Xr]}],basis:[{basis:[Cx,"full","auto",t,...je()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[wo,Cx,"auto","initial","none",Xr]}],grow:[{grow:["",wo,Yr,Xr]}],shrink:[{shrink:["",wo,Yr,Xr]}],order:[{order:[qy,"first","last","none",Yr,Xr]}],"grid-cols":[{"grid-cols":ct()}],"col-start-end":[{col:Lt()}],"col-start":[{"col-start":Ht()}],"col-end":[{"col-end":Ht()}],"grid-rows":[{"grid-rows":ct()}],"row-start-end":[{row:Lt()}],"row-start":[{"row-start":Ht()}],"row-end":[{"row-end":Ht()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ci()}],"auto-rows":[{"auto-rows":ci()}],gap:[{gap:je()}],"gap-x":[{"gap-x":je()}],"gap-y":[{"gap-y":je()}],"justify-content":[{justify:[...Wt(),"normal"]}],"justify-items":[{"justify-items":[...$t(),"normal"]}],"justify-self":[{"justify-self":["auto",...$t()]}],"align-content":[{content:["normal",...Wt()]}],"align-items":[{items:[...$t(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...$t(),{baseline:["","last"]}]}],"place-content":[{"place-content":Wt()}],"place-items":[{"place-items":[...$t(),"baseline"]}],"place-self":[{"place-self":["auto",...$t()]}],p:[{p:je()}],px:[{px:je()}],py:[{py:je()}],ps:[{ps:je()}],pe:[{pe:je()}],pt:[{pt:je()}],pr:[{pr:je()}],pb:[{pb:je()}],pl:[{pl:je()}],m:[{m:Dt()}],mx:[{mx:Dt()}],my:[{my:Dt()}],ms:[{ms:Dt()}],me:[{me:Dt()}],mt:[{mt:Dt()}],mr:[{mr:Dt()}],mb:[{mb:Dt()}],ml:[{ml:Dt()}],"space-x":[{"space-x":je()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":je()}],"space-y-reverse":["space-y-reverse"],size:[{size:Ft()}],w:[{w:[t,"screen",...Ft()]}],"min-w":[{"min-w":[t,"screen","none",...Ft()]}],"max-w":[{"max-w":[t,"screen","none","prose",{screen:[b]},...Ft()]}],h:[{h:["screen","lh",...Ft()]}],"min-h":[{"min-h":["screen","lh","none",...Ft()]}],"max-h":[{"max-h":["screen","lh",...Ft()]}],"font-size":[{text:["base",s,W1,J0]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[l,Yr,NC]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",BC,Xr]}],"font-family":[{font:[Vee,Xr,i]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[p,Yr,Xr]}],"line-clamp":[{"line-clamp":[wo,"none",Yr,NC]}],leading:[{leading:[_,...je()]}],"list-image":[{"list-image":["none",Yr,Xr]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Yr,Xr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:vt()}],"text-color":[{text:vt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Sr(),"wavy"]}],"text-decoration-thickness":[{decoration:[wo,"from-font","auto",Yr,J0]}],"text-decoration-color":[{decoration:vt()}],"underline-offset":[{"underline-offset":[wo,"auto",Yr,Xr]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:je()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Yr,Xr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Yr,Xr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:wi()}],"bg-repeat":[{bg:Qi()}],"bg-size":[{bg:wn()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},qy,Yr,Xr],radial:["",Yr,Xr],conic:[qy,Yr,Xr]},Uee,Nee]}],"bg-color":[{bg:vt()}],"gradient-from-pos":[{from:qn()}],"gradient-via-pos":[{via:qn()}],"gradient-to-pos":[{to:qn()}],"gradient-from":[{from:vt()}],"gradient-via":[{via:vt()}],"gradient-to":[{to:vt()}],rounded:[{rounded:Fn()}],"rounded-s":[{"rounded-s":Fn()}],"rounded-e":[{"rounded-e":Fn()}],"rounded-t":[{"rounded-t":Fn()}],"rounded-r":[{"rounded-r":Fn()}],"rounded-b":[{"rounded-b":Fn()}],"rounded-l":[{"rounded-l":Fn()}],"rounded-ss":[{"rounded-ss":Fn()}],"rounded-se":[{"rounded-se":Fn()}],"rounded-ee":[{"rounded-ee":Fn()}],"rounded-es":[{"rounded-es":Fn()}],"rounded-tl":[{"rounded-tl":Fn()}],"rounded-tr":[{"rounded-tr":Fn()}],"rounded-br":[{"rounded-br":Fn()}],"rounded-bl":[{"rounded-bl":Fn()}],"border-w":[{border:mr()}],"border-w-x":[{"border-x":mr()}],"border-w-y":[{"border-y":mr()}],"border-w-s":[{"border-s":mr()}],"border-w-e":[{"border-e":mr()}],"border-w-t":[{"border-t":mr()}],"border-w-r":[{"border-r":mr()}],"border-w-b":[{"border-b":mr()}],"border-w-l":[{"border-l":mr()}],"divide-x":[{"divide-x":mr()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":mr()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Sr(),"hidden","none"]}],"divide-style":[{divide:[...Sr(),"hidden","none"]}],"border-color":[{border:vt()}],"border-color-x":[{"border-x":vt()}],"border-color-y":[{"border-y":vt()}],"border-color-s":[{"border-s":vt()}],"border-color-e":[{"border-e":vt()}],"border-color-t":[{"border-t":vt()}],"border-color-r":[{"border-r":vt()}],"border-color-b":[{"border-b":vt()}],"border-color-l":[{"border-l":vt()}],"divide-color":[{divide:vt()}],"outline-style":[{outline:[...Sr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[wo,Yr,Xr]}],"outline-w":[{outline:["",wo,W1,J0]}],"outline-color":[{outline:vt()}],shadow:[{shadow:["","none",F,nS,iS]}],"shadow-color":[{shadow:vt()}],"inset-shadow":[{"inset-shadow":["none",$,nS,iS]}],"inset-shadow-color":[{"inset-shadow":vt()}],"ring-w":[{ring:mr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:vt()}],"ring-offset-w":[{"ring-offset":[wo,J0]}],"ring-offset-color":[{"ring-offset":vt()}],"inset-ring-w":[{"inset-ring":mr()}],"inset-ring-color":[{"inset-ring":vt()}],"text-shadow":[{"text-shadow":["none",W,nS,iS]}],"text-shadow-color":[{"text-shadow":vt()}],opacity:[{opacity:[wo,Yr,Xr]}],"mix-blend":[{"mix-blend":[...Hr(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Hr()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[wo]}],"mask-image-linear-from-pos":[{"mask-linear-from":ti()}],"mask-image-linear-to-pos":[{"mask-linear-to":ti()}],"mask-image-linear-from-color":[{"mask-linear-from":vt()}],"mask-image-linear-to-color":[{"mask-linear-to":vt()}],"mask-image-t-from-pos":[{"mask-t-from":ti()}],"mask-image-t-to-pos":[{"mask-t-to":ti()}],"mask-image-t-from-color":[{"mask-t-from":vt()}],"mask-image-t-to-color":[{"mask-t-to":vt()}],"mask-image-r-from-pos":[{"mask-r-from":ti()}],"mask-image-r-to-pos":[{"mask-r-to":ti()}],"mask-image-r-from-color":[{"mask-r-from":vt()}],"mask-image-r-to-color":[{"mask-r-to":vt()}],"mask-image-b-from-pos":[{"mask-b-from":ti()}],"mask-image-b-to-pos":[{"mask-b-to":ti()}],"mask-image-b-from-color":[{"mask-b-from":vt()}],"mask-image-b-to-color":[{"mask-b-to":vt()}],"mask-image-l-from-pos":[{"mask-l-from":ti()}],"mask-image-l-to-pos":[{"mask-l-to":ti()}],"mask-image-l-from-color":[{"mask-l-from":vt()}],"mask-image-l-to-color":[{"mask-l-to":vt()}],"mask-image-x-from-pos":[{"mask-x-from":ti()}],"mask-image-x-to-pos":[{"mask-x-to":ti()}],"mask-image-x-from-color":[{"mask-x-from":vt()}],"mask-image-x-to-color":[{"mask-x-to":vt()}],"mask-image-y-from-pos":[{"mask-y-from":ti()}],"mask-image-y-to-pos":[{"mask-y-to":ti()}],"mask-image-y-from-color":[{"mask-y-from":vt()}],"mask-image-y-to-color":[{"mask-y-to":vt()}],"mask-image-radial":[{"mask-radial":[Yr,Xr]}],"mask-image-radial-from-pos":[{"mask-radial-from":ti()}],"mask-image-radial-to-pos":[{"mask-radial-to":ti()}],"mask-image-radial-from-color":[{"mask-radial-from":vt()}],"mask-image-radial-to-color":[{"mask-radial-to":vt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Ee()}],"mask-image-conic-pos":[{"mask-conic":[wo]}],"mask-image-conic-from-pos":[{"mask-conic-from":ti()}],"mask-image-conic-to-pos":[{"mask-conic-to":ti()}],"mask-image-conic-from-color":[{"mask-conic-from":vt()}],"mask-image-conic-to-color":[{"mask-conic-to":vt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:wi()}],"mask-repeat":[{mask:Qi()}],"mask-size":[{mask:wn()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Yr,Xr]}],filter:[{filter:["","none",Yr,Xr]}],blur:[{blur:sn()}],brightness:[{brightness:[wo,Yr,Xr]}],contrast:[{contrast:[wo,Yr,Xr]}],"drop-shadow":[{"drop-shadow":["","none",Y,nS,iS]}],"drop-shadow-color":[{"drop-shadow":vt()}],grayscale:[{grayscale:["",wo,Yr,Xr]}],"hue-rotate":[{"hue-rotate":[wo,Yr,Xr]}],invert:[{invert:["",wo,Yr,Xr]}],saturate:[{saturate:[wo,Yr,Xr]}],sepia:[{sepia:["",wo,Yr,Xr]}],"backdrop-filter":[{"backdrop-filter":["","none",Yr,Xr]}],"backdrop-blur":[{"backdrop-blur":sn()}],"backdrop-brightness":[{"backdrop-brightness":[wo,Yr,Xr]}],"backdrop-contrast":[{"backdrop-contrast":[wo,Yr,Xr]}],"backdrop-grayscale":[{"backdrop-grayscale":["",wo,Yr,Xr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[wo,Yr,Xr]}],"backdrop-invert":[{"backdrop-invert":["",wo,Yr,Xr]}],"backdrop-opacity":[{"backdrop-opacity":[wo,Yr,Xr]}],"backdrop-saturate":[{"backdrop-saturate":[wo,Yr,Xr]}],"backdrop-sepia":[{"backdrop-sepia":["",wo,Yr,Xr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":je()}],"border-spacing-x":[{"border-spacing-x":je()}],"border-spacing-y":[{"border-spacing-y":je()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Yr,Xr]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[wo,"initial",Yr,Xr]}],ease:[{ease:["linear","initial",pe,Yr,Xr]}],delay:[{delay:[wo,Yr,Xr]}],animate:[{animate:["none",ye,Yr,Xr]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[se,Yr,Xr]}],"perspective-origin":[{"perspective-origin":Pe()}],rotate:[{rotate:Gi()}],"rotate-x":[{"rotate-x":Gi()}],"rotate-y":[{"rotate-y":Gi()}],"rotate-z":[{"rotate-z":Gi()}],scale:[{scale:gn()}],"scale-x":[{"scale-x":gn()}],"scale-y":[{"scale-y":gn()}],"scale-z":[{"scale-z":gn()}],"scale-3d":["scale-3d"],skew:[{skew:nr()}],"skew-x":[{"skew-x":nr()}],"skew-y":[{"skew-y":nr()}],transform:[{transform:[Yr,Xr,"","none","gpu","cpu"]}],"transform-origin":[{origin:Pe()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ur()}],"translate-x":[{"translate-x":Ur()}],"translate-y":[{"translate-y":Ur()}],"translate-z":[{"translate-z":Ur()}],"translate-none":["translate-none"],accent:[{accent:vt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:vt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Yr,Xr]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":je()}],"scroll-mx":[{"scroll-mx":je()}],"scroll-my":[{"scroll-my":je()}],"scroll-ms":[{"scroll-ms":je()}],"scroll-me":[{"scroll-me":je()}],"scroll-mt":[{"scroll-mt":je()}],"scroll-mr":[{"scroll-mr":je()}],"scroll-mb":[{"scroll-mb":je()}],"scroll-ml":[{"scroll-ml":je()}],"scroll-p":[{"scroll-p":je()}],"scroll-px":[{"scroll-px":je()}],"scroll-py":[{"scroll-py":je()}],"scroll-ps":[{"scroll-ps":je()}],"scroll-pe":[{"scroll-pe":je()}],"scroll-pt":[{"scroll-pt":je()}],"scroll-pr":[{"scroll-pr":je()}],"scroll-pb":[{"scroll-pb":je()}],"scroll-pl":[{"scroll-pl":je()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Yr,Xr]}],fill:[{fill:["none",...vt()]}],"stroke-w":[{stroke:[wo,W1,J0,NC]}],stroke:[{stroke:["none",...vt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},qee=(e,{cacheSize:i,prefix:s,experimentalParseClassName:l,extend:p={},override:_={}})=>(ew(e,"cacheSize",i),ew(e,"prefix",s),ew(e,"experimentalParseClassName",l),rS(e.theme,_.theme),rS(e.classGroups,_.classGroups),rS(e.conflictingClassGroups,_.conflictingClassGroups),rS(e.conflictingClassGroupModifiers,_.conflictingClassGroupModifiers),ew(e,"orderSensitiveModifiers",_.orderSensitiveModifiers),sS(e.theme,p.theme),sS(e.classGroups,p.classGroups),sS(e.conflictingClassGroups,p.conflictingClassGroups),sS(e.conflictingClassGroupModifiers,p.conflictingClassGroupModifiers),X6(e,p,"orderSensitiveModifiers"),e),ew=(e,i,s)=>{s!==void 0&&(e[i]=s)},rS=(e,i)=>{if(i)for(const s in i)ew(e,s,i[s])},sS=(e,i)=>{if(i)for(const s in i)X6(e,i,s)},X6=(e,i,s)=>{const l=i[s];l!==void 0&&(e[s]=e[s]?e[s].concat(l):l)},Hee=(e,...i)=>typeof e=="function"?dP(fP,e,...i):dP(()=>qee(fP(),e),...i),q_=dP(fP);function Wee(e){let{PI:i,min:s,max:l,cos:p,round:_}=Math,b=e[0]|e[1]<<8|e[2]<<16,t=e[3]|e[4]<<8,P=(b&63)/63,O=(b>>6&63)/31.5-1,F=(b>>12&63)/31.5-1,$=(b>>18&31)/31,W=b>>23,Y=(t>>3&63)/63,ae=(t>>9&63)/63,se=t>>15,ie=l(3,se?W?5:7:t&7),pe=l(3,se?t&7:W?5:7),ye=W?(e[5]&15)/15:1,de=(e[5]>>4)/15,Ee=W?6:5,Pe=0,Ze=(Ft,vt,wi)=>{let Qi=[];for(let wn=0;wn<vt;wn++)for(let qn=wn?0:1;qn*vt<Ft*(vt-wn);qn++)Qi.push(((e[Ee+(Pe>>1)]>>((Pe++&1)<<2)&15)/7.5-1)*wi);return Qi},We=Ze(ie,pe,$),je=Ze(3,3,Y*1.25),Ye=Ze(3,3,ae*1.25),ct=W&&Ze(5,5,de),Lt=Zee(e),Ht=_(Lt>1?32:32*Lt),ci=_(Lt>1?32/Lt:32),Wt=new Uint8Array(Ht*ci*4),$t=[],Dt=[];for(let Ft=0,vt=0;Ft<ci;Ft++)for(let wi=0;wi<Ht;wi++,vt+=4){let Qi=P,wn=O,qn=F,Fn=ye;for(let ti=0,sn=l(ie,W?5:3);ti<sn;ti++)$t[ti]=p(i/Ht*(wi+.5)*ti);for(let ti=0,sn=l(pe,W?5:3);ti<sn;ti++)Dt[ti]=p(i/ci*(Ft+.5)*ti);for(let ti=0,sn=0;ti<pe;ti++)for(let Gi=ti?0:1,gn=Dt[ti]*2;Gi*pe<ie*(pe-ti);Gi++,sn++)Qi+=We[sn]*$t[Gi]*gn;for(let ti=0,sn=0;ti<3;ti++)for(let Gi=ti?0:1,gn=Dt[ti]*2;Gi<3-ti;Gi++,sn++){let nr=$t[Gi]*gn;wn+=je[sn]*nr,qn+=Ye[sn]*nr}if(W)for(let ti=0,sn=0;ti<5;ti++)for(let Gi=ti?0:1,gn=Dt[ti]*2;Gi<5-ti;Gi++,sn++)Fn+=ct[sn]*$t[Gi]*gn;let mr=Qi-2/3*wn,Sr=(3*Qi-mr+qn)/2,Hr=Sr-qn;Wt[vt]=l(0,255*s(1,Sr)),Wt[vt+1]=l(0,255*s(1,Hr)),Wt[vt+2]=l(0,255*s(1,mr)),Wt[vt+3]=l(0,255*s(1,Fn))}return{w:Ht,h:ci,rgba:Wt}}function Zee(e){let i=e[3],s=e[2]&128,l=e[4]&128,p=l?s?5:7:i&7,_=l?i&7:s?5:7;return p/_}function Xee(e,i,s){let l=e*4+1,p=6+i*(5+l),_=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,i>>8,i&255,8,6,0,0,0,0,0,0,0,p>>>24,p>>16&255,p>>8&255,p&255,73,68,65,84,120,1],b=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],t=1,P=0;for(let O=0,F=0,$=l-1;O<i;O++,$+=l-1)for(_.push(O+1<i?0:1,l&255,l>>8,~l&255,l>>8^255,0),P=(P+t)%65521;F<$;F++){let W=s[F]&255;_.push(W),t=(t+W)%65521,P=(P+t)%65521}_.push(P>>8,P&255,t>>8,t&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[O,F]of[[12,29],[37,41+p]]){let $=-1;for(let W=O;W<F;W++)$^=_[W],$=$>>>4^b[$&15],$=$>>>4^b[$&15];$=~$,_[F++]=$>>>24,_[F++]=$>>16&255,_[F++]=$>>8&255,_[F++]=$&255}return"data:image/png;base64,"+btoa(String.fromCharCode(..._))}function dz(e){let i=Wee(e);return Xee(i.w,i.h,i.rgba)}const Yee=e=>Uint8Array.from(e.match(/.{1,2}/g).map(i=>Number.parseInt(i,16))),Kee=["src"],Jee=kr({__name:"ThumbHash",props:{thumbhash:{},class:{}},setup(e){const i=e,s=Ei(()=>typeof i.thumbhash=="string"?dz(Yee(i.thumbhash)):dz(i.thumbhash));return(l,p)=>(li(),ir("img",{src:ut(s),class:_s(ut(q_)("w-full h-full",i.class))},null,10,Kee))}}),RM=Object.assign(Jee,{__name:"ThumbHash"}),Qee=Object.freeze({left:0,top:0,width:16,height:16}),Y6=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),zM=Object.freeze({...Qee,...Y6});Object.freeze({...zM,body:"",hidden:!1});function ete(e){const[i,s,l,p]=e;if(l!==p){const _=Math.max(l,p);return[i-(_-l)/2,s-(_-p)/2,_,_]}return e}const tte=/(-?[0-9.]*[0-9]+[0-9.]*)/g,ite=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function pP(e,i,s){if(i===1)return e;if(s=s||100,typeof e=="number")return Math.ceil(e*i*s)/s;if(typeof e!="string")return e;const l=e.split(tte);if(l===null||!l.length)return e;const p=[];let _=l.shift(),b=ite.test(_);for(;;){if(b){const t=parseFloat(_);isNaN(t)?p.push(_):p.push(Math.ceil(t*i*s)/s)}else p.push(_);if(_=l.shift(),_===void 0)return p.join("");b=!b}}const nte=Object.freeze({width:null,height:null}),rte=Object.freeze({...nte,...Y6});function ste(e,i="defs"){let s="";const l=e.indexOf("<"+i);for(;l>=0;){const p=e.indexOf(">",l),_=e.indexOf("</"+i);if(p===-1||_===-1)break;const b=e.indexOf(">",_);if(b===-1)break;s+=e.slice(p+1,_).trim(),e=e.slice(0,l).trim()+e.slice(b+1)}return{defs:s,content:e}}function ote(e,i){return e?"<defs>"+e+"</defs>"+i:i}function ate(e,i,s){const l=ste(e);return ote(l.defs,i+l.content+s)}const lte=e=>e==="unset"||e==="undefined"||e==="none";function cte(e,i){const s={...zM,...e},l={...rte,...i},p={left:s.left,top:s.top,width:s.width,height:s.height};let _=s.body;[s,l].forEach(se=>{const ie=[],pe=se.hFlip,ye=se.vFlip;let de=se.rotate;pe?ye?de+=2:(ie.push("translate("+(p.width+p.left).toString()+" "+(0-p.top).toString()+")"),ie.push("scale(-1 1)"),p.top=p.left=0):ye&&(ie.push("translate("+(0-p.left).toString()+" "+(p.height+p.top).toString()+")"),ie.push("scale(1 -1)"),p.top=p.left=0);let Ee;switch(de<0&&(de-=Math.floor(de/4)*4),de=de%4,de){case 1:Ee=p.height/2+p.top,ie.unshift("rotate(90 "+Ee.toString()+" "+Ee.toString()+")");break;case 2:ie.unshift("rotate(180 "+(p.width/2+p.left).toString()+" "+(p.height/2+p.top).toString()+")");break;case 3:Ee=p.width/2+p.left,ie.unshift("rotate(-90 "+Ee.toString()+" "+Ee.toString()+")");break}de%2===1&&(p.left!==p.top&&(Ee=p.left,p.left=p.top,p.top=Ee),p.width!==p.height&&(Ee=p.width,p.width=p.height,p.height=Ee)),ie.length&&(_=ate(_,'<g transform="'+ie.join(" ")+'">',"</g>"))});const b=l.width,t=l.height,P=p.width,O=p.height;let F,$;b===null?($=t===null?"1em":t==="auto"?O:t,F=pP($,P/O)):(F=b==="auto"?P:b,$=t===null?pP(F,O/P):t==="auto"?O:t);const W={},Y=(se,ie)=>{lte(ie)||(W[se]=ie.toString())};Y("width",F),Y("height",$);const ae=[p.left,p.top,P,O];return W.viewBox=ae.join(" "),{attributes:W,viewBox:ae,body:_}}function ute(e){return e.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function hte(e){return"data:image/svg+xml,"+ute(e)}function dte(e){return'url("'+hte(e)+'")'}function fte(e,i){let s=e.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const l in i)s+=" "+l+'="'+i[l]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+s+">"+e+"</svg>"}function pte(e){const i={display:"inline-block",width:"1em",height:"1em"},s=e.varName;switch(e.pseudoSelector&&(i.content="''"),e.mode){case"background":s&&(i["background-image"]="var(--"+s+")"),i["background-repeat"]="no-repeat",i["background-size"]="100% 100%";break;case"mask":i["background-color"]="currentColor",s&&(i["mask-image"]=i["-webkit-mask-image"]="var(--"+s+")"),i["mask-repeat"]=i["-webkit-mask-repeat"]="no-repeat",i["mask-size"]=i["-webkit-mask-size"]="100% 100%";break}return i}function mte(e,i){const s={},l=i.varName,p=cte(e);let _=p.viewBox;_[2]!==_[3]&&(i.forceSquare?_=ete(_):s.width=pP("1em",_[2]/_[3]));const b=dte(fte(p.body.replace(/currentColor/g,i.color||"black"),{viewBox:`${_[0]} ${_[1]} ${_[2]} ${_[3]}`,width:`${_[2]}`,height:`${_[3]}`}));if(l)s["--"+l]=b;else switch(i.mode){case"background":s["background-image"]=b;break;case"mask":s["mask-image"]=s["-webkit-mask-image"]=b;break}return s}const VC={selectorStart:{compressed:"{",compact:" {",expanded:" {"},selectorEnd:{compressed:"}",compact:`; }
`,expanded:`;
}
`},rule:{compressed:"{key}:",compact:" {key}: ",expanded:`
  {key}: `}};function gte(e,i="expanded"){const s=[];for(let l=0;l<e.length;l++){const{selector:p,rules:_}=e[l];let b=(p instanceof Array?p.join(i==="compressed"?",":", "):p)+VC.selectorStart[i],t=!0;for(const P in _)t||(b+=";"),b+=VC.rule[i].replace("{key}",P)+_[P],t=!1;b+=VC.selectorEnd[i],s.push(b)}return s.join(i==="compressed"?"":`
`)}function _te(e,i={}){const s=i.customise?i.customise(e.body):e.body,l=i.mode||(i.color||!s.includes("currentColor")?"background":"mask");let p=i.varName;p===void 0&&l==="mask"&&(p="svg");const _={...i,mode:l,varName:p};l==="background"&&delete _.varName;const b={...i.rules,...pte(_),...mte({...zM,...e,body:s},_)};return gte([{selector:i.iconSelector||".icon",rules:b}],_.format)}let fz=!1;function K6(e){if(fz)return;const i=JSON.parse('[{"prefix":"svg-spinners","icons":{"180-ring-with-bg":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z\\" opacity=\\".25\\"/><path fill=\\"currentColor\\" d=\\"M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z\\"><animateTransform attributeName=\\"transform\\" dur=\\"0.75s\\" repeatCount=\\"indefinite\\" type=\\"rotate\\" values=\\"0 12 12;360 12 12\\"/></path>"}}},{"prefix":"carbon","icons":{"iso-outline":{"width":32,"height":32,"body":"<path fill=\\"currentColor\\" d=\\"M24 21h-3a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2m-3-8v6h3v-6zm-6 8h-5v-2h5v-2h-3a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h5v2h-5v2h3a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2M6 11h2v10H6z\\"/><path fill=\\"currentColor\\" d=\\"M28 6H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2M4 24V8h24v16Z\\"/>"}}},{"prefix":"tabler","icons":{"loader":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 6V3m4.25 4.75L18.4 5.6M18 12h3m-4.75 4.25l2.15 2.15M12 18v3m-4.25-4.75L5.6 18.4M6 12H3m4.75-4.25L5.6 5.6\\"/>"},"alert-triangle":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 9v4m-1.637-9.409L2.257 17.125a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636-2.87L13.637 3.59a1.914 1.914 0 0 0-3.274 0M12 16h.01\\"/>"},"dashboard":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M10 13a2 2 0 1 0 4 0a2 2 0 1 0-4 0m3.45-1.45L15.5 9.5\\"/><path d=\\"M6.4 20a9 9 0 1 1 11.2 0z\\"/></g>"},"photo-cog":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M15 8h.01M12 21H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v6\\"/><path d=\\"m3 16l5-5c.928-.893 2.072-.893 3 0l3 3m0 0l1-1c.48-.461 1.016-.684 1.551-.67m.45 6.67a2 2 0 1 0 4 0a2 2 0 1 0-4 0m2-3.5V17m0 4v1.5m3.031-5.25l-1.299.75m-3.463 2l-1.3.75m0-3.5l1.3.75m3.463 2l1.3.75\\"/></g>"},"album":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z\\"/><path d=\\"M12 4v7l2-2l2 2V4\\"/></g>"},"list-check":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3.5 5.5L5 7l2.5-2.5m-4 7L5 13l2.5-2.5m-4 7L5 19l2.5-2.5M11 6h9m-9 6h9m-9 6h9\\"/>"},"file-text":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M14 3v4a1 1 0 0 0 1 1h4\\"/><path d=\\"M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2M9 9h1m-1 4h6m-6 4h6\\"/></g>"},"settings":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065\\"/><path d=\\"M9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0\\"/></g>"},"settings-2":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M19.875 6.27A2.23 2.23 0 0 1 21 8.218v7.284c0 .809-.443 1.555-1.158 1.948l-6.75 4.27a2.27 2.27 0 0 1-2.184 0l-6.75-4.27A2.23 2.23 0 0 1 3 15.502V8.217c0-.809.443-1.554 1.158-1.947l6.75-3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98z\\"/><path d=\\"M9 12a3 3 0 1 0 6 0a3 3 0 1 0-6 0\\"/></g>"},"database":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M4 6a8 3 0 1 0 16 0A8 3 0 1 0 4 6\\"/><path d=\\"M4 6v6a8 3 0 0 0 16 0V6\\"/><path d=\\"M4 12v6a8 3 0 0 0 16 0v-6\\"/></g>"},"map-pin":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M9 11a3 3 0 1 0 6 0a3 3 0 0 0-6 0\\"/><path d=\\"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0\\"/></g>"},"cpu":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M5 6a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1z\\"/><path d=\\"M9 9h6v6H9zm-6 1h2m-2 4h2m5-11v2m4-2v2m7 5h-2m2 4h-2m-5 7v-2m-4 2v-2\\"/></g>"},"brand-github":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21\\"/>"},"book":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0M3 6v13m9-13v13m9-13v13\\"/>"},"brand-discord":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M8 12a1 1 0 1 0 2 0a1 1 0 0 0-2 0m6 0a1 1 0 1 0 2 0a1 1 0 0 0-2 0\\"/><path d=\\"M15.5 17c0 1 1.5 3 2 3c1.5 0 2.833-1.667 3.5-3c.667-1.667.5-5.833-1.5-11.5c-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.9 11.9 0 0 0-4.053 0L9 4c-1.5.16-3.043.485-4.5 1.5c-2 5.667-2.167 9.833-1.5 11.5c.667 1.333 2 3 3.5 3c.5 0 2-2 2-3\\"/><path d=\\"M7 16.5c3.5 1 6.5 1 10 0\\"/></g>"},"user":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0-8 0M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2\\"/>"},"check":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m5 12l5 5L20 7\\"/>"},"info-circle":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0m9-3h.01\\"/><path d=\\"M11 12h1v4h1\\"/></g>"},"home":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M5 12H3l9-9l9 9h-2M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7\\"/><path d=\\"M9 21v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6\\"/></g>"},"plus":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 5v14m-7-7h14\\"/>"},"minus":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M5 12h14\\"/>"},"scan-position":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 7V6a2 2 0 0 1 2-2h2M4 17v1a2 2 0 0 0 2 2h2m8-16h2a2 2 0 0 1 2 2v1m-4 13h2a2 2 0 0 0 2-2v-1m-8 0l3-8l-8 3l3.5 1.5z\\"/>"},"map-pin-off":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M9.442 9.432a3 3 0 0 0 4.113 4.134M15 11a3 3 0 0 0-3-3\\"/><path d=\\"M17.152 17.162L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 0 1-.476-10.794m2.18-1.82a8.003 8.003 0 0 1 10.91 10.912M3 3l18 18\\"/></g>"},"camera":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M5 7h1a2 2 0 0 0 2-2a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2\\"/><path d=\\"M9 13a3 3 0 1 0 6 0a3 3 0 0 0-6 0\\"/></g>"},"aperture":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m.6 3h10.55M6.551 4.938l3.26 10.034m7.221-10.336l-8.535 6.201m12.062 3.673l-8.535-6.201m.233 12.607l3.261-10.034\\"/>"},"circle-check":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0\\"/><path d=\\"m9 12l2 2l4-4\\"/></g>"},"icons":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 6.5a3.5 3.5 0 1 0 7 0a3.5 3.5 0 1 0-7 0M2.5 21h8l-4-7zM14 3l7 7m-7 0l7-7m-7 11h7v7h-7z\\"/>"},"arrow-up":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 5v14m6-8l-6-6m-6 6l6-6\\"/>"},"external-link":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-6m-7 1l9-9m-5 0h5v5\\"/>"},"calendar-week":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm12-4v4M8 3v4m-4 4h16M7 14h.013m2.997 0h.005m2.995 0h.005m3 0h.005m-3.005 3h.005m-6.01 0h.005m2.995 0h.005\\"/>"},"tags":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 8v4.172a2 2 0 0 0 .586 1.414l5.71 5.71a2.41 2.41 0 0 0 3.408 0l3.592-3.592a2.41 2.41 0 0 0 0-3.408l-5.71-5.71A2 2 0 0 0 9.172 6H5a2 2 0 0 0-2 2\\"/><path d=\\"m18 19l1.592-1.592a4.82 4.82 0 0 0 0-6.816L15 6m-8 4h-.01\\"/></g>"},"star":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m12 17.75l-6.172 3.245l1.179-6.873l-5-4.867l6.9-1l3.086-6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z\\"/>"},"filter-x":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M13.758 19.414L9 21v-8.5L4.52 7.572A2 2 0 0 1 4 6.227V4h16v2.172a2 2 0 0 1-.586 1.414L15 12v1.5m7 8.5l-5-5m0 5l5-5\\"/>"},"search":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 10a7 7 0 1 0 14 0a7 7 0 1 0-14 0m18 11l-6-6\\"/>"},"x":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M18 6L6 18M6 6l12 12\\"/>"},"dice-3":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\\"/><path fill=\\"currentColor\\" d=\\"M8 8.5a.5.5 0 1 0 1 0a.5.5 0 1 0-1 0m7 7a.5.5 0 1 0 1 0a.5.5 0 1 0-1 0M11.5 12a.5.5 0 1 0 1 0a.5.5 0 1 0-1 0\\"/></g>"},"photo":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M15 8h.01M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3z\\"/><path d=\\"m3 16l5-5c.928-.893 2.072-.893 3 0l5 5\\"/><path d=\\"m14 14l1-1c.928-.893 2.072-.893 3 0l3 3\\"/></g>"},"mountain":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 20h18L14.079 5.388a2.3 2.3 0 0 0-4.158 0z\\"/><path d=\\"m7.5 11l2 2.5L12 11l2 3l2.5-2\\"/></g>"},"file":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M14 3v4a1 1 0 0 0 1 1h4\\"/><path d=\\"M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2\\"/></g>"},"dimensions":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 5h11m-2 2l2-2l-2-2M5 3L3 5l2 2m14 3v11m-2-2l2 2l2-2m0-7l-2-2l-2 2M3 12a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\\"/>"},"grid-dots":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 5a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 12a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 19a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0m7 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0\\"/>"},"calendar":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm12-4v4M8 3v4m-4 4h16m-9 4h1m0 0v3\\"/>"},"palette":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21\\"/><path d=\\"M7.5 10.5a1 1 0 1 0 2 0a1 1 0 1 0-2 0m4-3a1 1 0 1 0 2 0a1 1 0 1 0-2 0m4 3a1 1 0 1 0 2 0a1 1 0 1 0-2 0\\"/></g>"},"app-window":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm3 1h.01M9 8h.01\\"/>"},"world":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0m.6-3h16.8M3.6 15h16.8\\"/><path d=\\"M11.5 3a17 17 0 0 0 0 18m1-18a17 17 0 0 1 0 18\\"/></g>"},"building":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 21h18M9 8h1m-1 4h1m-1 4h1m4-8h1m-1 4h1m-1 4h1M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16\\"/>"},"gps":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0\\"/><path d=\\"m12 17l-1-4l-4-1l9-4z\\"/></g>"},"telescope":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m6 21l6-5l6 5m-6-8v8m-8.706-7.322l.166.281c.52.88 1.624 1.265 2.605.91l14.242-5.165a1.023 1.023 0 0 0 .565-1.456l-2.62-4.705a1.087 1.087 0 0 0-1.447-.42l-.056.032l-12.694 7.618c-1.02.613-1.357 1.897-.76 2.905zM14 5l3 5.5\\"/>"},"clock":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0\\"/><path d=\\"M12 7v5l3 3\\"/></g>"},"sun-electricity":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M8 12a4 4 0 0 0 4 4m0-8a4 4 0 0 0-4 4m-5 0h1m8-9v1m0 16v1M5.6 5.6l.7.7m0 11.4l-.7.7M20 7l-3 5h4l-3 5\\"/>"},"focus":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path fill=\\"currentColor\\" d=\\"M11.5 12a.5.5 0 1 0 1 0a.5.5 0 1 0-1 0\\"/><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0\\"/></g>"},"zoom-in-area":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M15 13v4m-2-2h4m-7 0a5 5 0 1 0 10 0a5 5 0 1 0-10 0m12 7l-3-3M6 18H5a2 2 0 0 1-2-2v-1m0-4v-1m0-4V5a2 2 0 0 1 2-2h1m4 0h1m4 0h1a2 2 0 0 1 2 2v1\\"/>"},"exposure":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3.6 20.4L20.4 3.6M6 8h4M8 6v4m6 6h4M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\\"/>"},"exposure-filled":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm0 2H5a1 1 0 0 0-1 1v14c0 .29.123.55.321.732l1.61-1.584a973 973 0 0 0 6.69-6.675L19.715 4.3A1 1 0 0 0 19 4m-1 11h-4a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2M8 5a1 1 0 0 1 1 1v1h1a1 1 0 0 1 .993.883L11 8a1 1 0 0 1-1 1H9v1a1 1 0 0 1-.883.993L8 11a1 1 0 0 1-1-1V9H6a1 1 0 0 1-.993-.883L5 8a1 1 0 0 1 1-1h1V6a1 1 0 0 1 .883-.993z\\"/>"},"focus-auto":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 8V6a2 2 0 0 1 2-2h2M4 16v2a2 2 0 0 0 2 2h2m8-16h2a2 2 0 0 1 2 2v2m-4 12h2a2 2 0 0 0 2-2v-2m-10-1v-4a2 2 0 1 1 4 0v4m-4-2h4\\"/>"},"sun":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7\\"/>"},"photo-sensor":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M17 5h2a2 2 0 0 1 2 2v2m0 6v2a2 2 0 0 1-2 2h-2M7 19H5a2 2 0 0 1-2-2v-2m0-6V7a2 2 0 0 1 2-2h2m0 5a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1z\\"/>"},"live-photo":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M11 12a1 1 0 1 0 2 0a1 1 0 1 0-2 0\\"/><path d=\\"M7 12a5 5 0 1 0 10 0a5 5 0 1 0-10 0m8.9 8.11v.01m3.14-2.51v.01M20.77 14v.01m0-4.01v.01m-1.73-3.62v.01M15.9 3.89v.01M12 3v.01m-3.9.88v.01M4.96 6.39v.01M3.23 10v.01m0 3.99v.01m1.73 3.6v.01m3.14 2.49v.01M12 21v.01\\"/></g>"},"loader-2":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 3a9 9 0 1 0 9 9\\"/>"},"photo-off":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M15 8h.01M7 3h11a3 3 0 0 1 3 3v11m-.856 3.099A3 3 0 0 1 18 21H6a3 3 0 0 1-3-3V6c0-.845.349-1.608.91-2.153\\"/><path d=\\"m3 16l5-5c.928-.893 2.072-.893 3 0l5 5m.33-3.662c.574-.054 1.155.166 1.67.662l3 3M3 3l18 18\\"/></g>"},"download":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 11l5 5l5-5m-5-7v12\\"/>"},"brand-twitter":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M22 4.01c-1 .49-1.98.689-3 .99c-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4c0 0-4.182 7.433 4 11c-1.872 1.247-3.739 2.088-6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58-1.04 6.522-3.723 7.651-7.742a13.8 13.8 0 0 0 .497-3.753c0-.249 1.51-2.772 1.818-4.013z\\"/>"},"brand-telegram":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m15 10l-4 4l6 6l4-16l-18 7l4 2l2 6l3-4\\"/>"},"brand-weibo":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M19 14.127C19 17.2 15.498 20 11 20c-4.126 0-8-2.224-8-5.565c0-1.78.984-3.737 2.7-5.567c2.362-2.51 5.193-3.687 6.551-2.238c.415.44.752 1.39.749 2.062c2-1.615 4.308.387 3.5 2.693c1.26.557 2.5.538 2.5 2.742M15 4h1a5 5 0 0 1 5 5v1\\"/>"},"brand-facebook":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z\\"/>"},"brand-whatsapp":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"m3 21l1.65-3.8a9 9 0 1 1 3.4 2.9z\\"/><path d=\\"M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0za5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1\\"/></g>"},"brand-linkedin":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M8 11v5m0-8v.01M12 16v-5m4 5v-3a2 2 0 1 0-4 0\\"/><path d=\\"M3 7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4z\\"/></g>"},"share-3":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M13 4v4C6.425 9.028 3.98 14.788 3 20c-.037.206 5.384-5.962 10-6v4l8-7z\\"/>"},"share-2":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M8 9H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1m-4 5V3M9 6l3-3l3 3\\"/>"},"copy":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M7 9.667A2.667 2.667 0 0 1 9.667 7h8.666A2.667 2.667 0 0 1 21 9.667v8.666A2.667 2.667 0 0 1 18.333 21H9.667A2.667 2.667 0 0 1 7 18.333z\\"/><path d=\\"M4.012 16.737A2 2 0 0 1 3 15V5c0-1.1.9-2 2-2h10c.75 0 1.158.385 1.5 1\\"/></g>"},"alert-circle":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0m9-4v4m0 4h.01\\"/>"},"volume-off":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M15 8a5 5 0 0 1 1.912 4.934m-1.377 2.602A5 5 0 0 1 15 16m2.7-11a9 9 0 0 1 2.362 11.086m-1.676 2.299A9 9 0 0 1 17.7 19M9.069 5.054L9.5 4.5A.8.8 0 0 1 11 5v2m0 4v8a.8.8 0 0 1-1.5.5L6 15H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h2l1.294-1.664M3 3l18 18\\"/>"},"volume":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M15 8a5 5 0 0 1 0 8m2.7-11a9 9 0 0 1 0 14M6 15H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h2l3.5-4.5A.8.8 0 0 1 11 5v14a.8.8 0 0 1-1.5.5z\\"/>"},"mood-smile":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m6-2h.01M15 10h.01\\"/><path d=\\"M9.5 15a3.5 3.5 0 0 0 5 0\\"/></g>"},"chevron-left":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m15 6l-6 6l6 6\\"/>"},"chevron-right":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m9 6l6 6l-6 6\\"/>"},"device-floppy":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2\\"/><path d=\\"M10 14a2 2 0 1 0 4 0a2 2 0 1 0-4 0m4-10v4H8V4\\"/></g>"},"arrow-left":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M5 12h14M5 12l6 6m-6-6l6-6\\"/>"},"login-2":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M9 8V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2v-2\\"/><path d=\\"M3 12h13l-3-3m0 6l3-3\\"/></g>"},"upload":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 9l5-5l5 5m-5-5v12\\"/>"},"chevron-down":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m6 9l6 6l6-6\\"/>"},"trash":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 7h16m-10 4v6m4-6v6M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-12M9 7V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3\\"/>"},"video":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14zM3 8a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\\"/>"},"arrow-big-right-lines":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 9V5.414a1 1 0 0 1 1.707-.707l6.586 6.586a1 1 0 0 1 0 1.414l-6.586 6.586A1 1 0 0 1 12 18.586V15H9V9zM3 9v6m3-6v6\\"/>"},"cancel":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0m15.364-6.364L5.636 18.364\\"/>"},"edit":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1\\"/><path d=\\"M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3\\"/></g>"},"photo-plus":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M15 8h.01M12.5 21H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v6.5\\"/><path d=\\"m3 16l5-5c.928-.893 2.072-.893 3 0l4 4\\"/><path d=\\"m14 14l1-1c.67-.644 1.45-.824 2.182-.54M16 19h6m-3-3v6\\"/></g>"},"star-filled":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"m8.243 7.34l-6.38.925l-.113.023a1 1 0 0 0-.44 1.684l4.622 4.499l-1.09 6.355l-.013.11a1 1 0 0 0 1.464.944l5.706-3l5.693 3l.1.046a1 1 0 0 0 1.352-1.1l-1.091-6.355l4.624-4.5l.078-.085a1 1 0 0 0-.633-1.62l-6.38-.926l-2.852-5.78a1 1 0 0 0-1.794 0z\\"/>"},"clock-plus":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M20.984 12.535a9 9 0 1 0-8.468 8.45M16 19h6m-3-3v6\\"/><path d=\\"M12 7v5l3 3\\"/></g>"},"library-photo":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M7 5.667A2.667 2.667 0 0 1 9.667 3h8.666A2.667 2.667 0 0 1 21 5.667v8.666A2.667 2.667 0 0 1 18.333 17H9.667A2.667 2.667 0 0 1 7 14.333z\\"/><path d=\\"M4.012 7.26A2 2 0 0 0 3 8.997v10c0 1.1.9 2 2 2h10c.75 0 1.158-.385 1.5-1M17 7h.01\\"/><path d=\\"m7 13l3.644-3.644a1.21 1.21 0 0 1 1.712 0L16 13\\"/><path d=\\"m15 12l1.644-1.644a1.21 1.21 0 0 1 1.712 0L21 13\\"/></g>"},"arrow-right":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M5 12h14m-6 6l6-6m-6-6l6 6\\"/>"},"refresh":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4m-4 4a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4\\"/>"},"inbox":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z\\"/><path d=\\"M4 13h3l3 3h4l3-3h3\\"/></g>"},"arrow-bar-to-down":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 20h16m-8-6V4m0 10l4-4m-4 4l-4-4\\"/>"},"pencil":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 20h4L18.5 9.5a2.828 2.828 0 1 0-4-4L4 16zm9.5-13.5l4 4\\"/>"},"cloud-upload":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M7 18a4.6 4.4 0 0 1 0-9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1\\"/><path d=\\"m9 15l3-3l3 3m-3-3v9\\"/></g>"},"filter":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M4 4h16v2.172a2 2 0 0 1-.586 1.414L15 12v7l-6 2v-8.5L4.52 7.572A2 2 0 0 1 4 6.227z\\"/>"},"photo-scan":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M15 8h.01M6 13l2.644-2.644a1.21 1.21 0 0 1 1.712 0L14 14\\"/><path d=\\"m13 13l1.644-1.644a1.21 1.21 0 0 1 1.712 0L18 13M4 8V6a2 2 0 0 1 2-2h2M4 16v2a2 2 0 0 0 2 2h2m8-16h2a2 2 0 0 1 2 2v2m-4 12h2a2 2 0 0 0 2-2v-2\\"/></g>"},"columns-3":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1zm6-1v18m6-18v18\\"/>"},"dots-vertical":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M11 12a1 1 0 1 0 2 0a1 1 0 1 0-2 0m0 7a1 1 0 1 0 2 0a1 1 0 1 0-2 0m0-14a1 1 0 1 0 2 0a1 1 0 1 0-2 0\\"/>"},"map-off":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M8.32 4.34L9 4l6 3l6-3v13m-2.67 1.335L15 20l-6-3l-6 3V7l2.665-1.333M9 4v1m0 4v8m6-10v4m0 4v5M3 3l18 18\\"/>"},"device-laptop":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 19h18M5 7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1z\\"/>"},"server":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M3 7a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v2a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3m0 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v2a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm4-7v.01M7 16v.01\\"/>"},"map":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"m3 7l6-3l6 3l6-3v13l-6 3l-6-3l-6 3zm6-3v13m6-10v13\\"/>"},"map-pin-2":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 18.5L9 17l-6 3V7l6-3l6 3l6-3v7M9 4v13m6-10v5m6.121 8.121a3 3 0 1 0-4.242 0Q17.506 20.749 19 22q1.577-1.335 2.121-1.879M19 18v.01\\"/>"},"moon":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z\\"/>"},"logout":{"width":24,"height":24,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\"><path d=\\"M14 8V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-2\\"/><path d=\\"M9 12h12l-3-3m0 6l3-3\\"/></g>"},"brand-aws":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M17 18.5a15.2 15.2 0 0 1-7.37 1.44A14.6 14.6 0 0 1 3 17m16.5 4c.907-1.411 1.451-3.323 1.5-5c-1.197-.773-2.577-.935-4-1M3 11V6.5a1.5 1.5 0 0 1 3 0V11M3 9h3m3-4l1.2 6L12 7l1.8 4L15 5m3 5.25c0 .414.336.75.75.75H20a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1h-1a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.25a.75.75 0 0 1 .75.75\\"/>"},"cloud":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M6.657 18C4.085 18 2 15.993 2 13.517s2.085-4.482 4.657-4.482c.393-1.762 1.794-3.2 3.675-3.773c1.88-.572 3.956-.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486s-1.551 3.487-3.465 3.487H6.657\\"/>"},"arrows-exchange":{"width":24,"height":24,"body":"<path fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" stroke-width=\\"2\\" d=\\"M7 10h14l-4-4m0 8H3l4 4\\"/>"}}},{"prefix":"streamline","icons":{"image-accessories-lenses-photos-camera-shutter-picture-photography-pictures-photo-lens":{"width":14,"height":14,"body":"<g fill=\\"none\\" stroke=\\"currentColor\\" stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\"><circle cx=\\"7\\" cy=\\"7\\" r=\\"6.5\\"/><circle cx=\\"7\\" cy=\\"7\\" r=\\"2.5\\"/><path d=\\"M4.5 7V1M7 4.5h6M9.5 7v6M7 9.5H1\\"/></g>","hidden":true}}},{"prefix":"mdi","icons":{"white-balance-auto":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"m10.3 16l-.7-2H6.4l-.7 2H3.8L7 7h2l3.2 9M22 7l-1.2 6.29L19.3 7h-1.6l-1.49 6.29L15 7h-.76C12.77 5.17 10.5 4 8 4a8 8 0 0 0-8 8a8 8 0 0 0 8 8c3.13 0 5.84-1.81 7.15-4.43l.1.43H17l1.5-6.1L20 16h1.75l2.05-9M6.85 12.65h2.3L8 9z\\"/>"},"github":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2\\"/>"}}},{"prefix":"material-symbols","icons":{"shutter-speed":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M9 3V1h6v2zm3 19q-1.875 0-3.512-.712T5.625 19.35T3.7 16.487T3 13t.713-3.488T5.65 6.65t2.863-1.937T12 4q1.575 0 3 .525T17.6 6l1.45-1.45l1.4 1.4l-1.4 1.45q.9 1.175 1.425 2.6T21 13q0 1.85-.7 3.488t-1.925 2.862t-2.863 1.938T12 22m0-2q2.925 0 4.963-2.037T19 13t-2.037-4.962T12 6T7.038 8.038T5 13t2.038 4.963T12 20m0-9h5.65q-.45-1.275-1.4-2.238T14.1 7.375zm-1.725 1L13.1 7.1q-1.275-.25-2.562.075t-2.363 1.2zM6.1 14h4.175L7.45 9.1q-.875.975-1.225 2.263T6.1 14m3.8 4.625L12 15H6.35q.425 1.25 1.388 2.225t2.162 1.4m1 .275q1.425.275 2.725-.112t2.2-1.163L13.725 14zm5.65-2q.9-1.025 1.238-2.287T17.9 12h-4.175z\\"/>"},"flash-on-rounded":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M10.525 20.325q-.225-.075-.375-.262T10 19.6V14H9q-.825 0-1.412-.587T7 12V4q0-.825.588-1.412T9 2h5.85q.8 0 1.288.625T16.425 4L15 9h1.125q.9 0 1.338.8t-.088 1.55l-6 8.675q-.15.225-.387.3t-.463 0\\"/>"},"scene":{"width":24,"height":24,"body":"<path fill=\\"currentColor\\" d=\\"M20 22V7q0-.825-.587-1.412T18 5h-1v1.3q0 .3-.2.5t-.5.2h-5.6q-.35 0-.562-.375T10.1 5.9L12 1.8q.175-.375.513-.588T13.3 1h2.3q.6 0 1 .45T17 2.5V3h1q1.65 0 2.825 1.175T22 7v15zM5 22q-1.275 0-2.137-.862T2 19v-2.5q0-.625.438-1.062T3.5 15t1.063.438T5 16.5V19h10v-2.5q0-.625.438-1.062T16.5 15t1.063.438T18 16.5V19q0 1.275-.862 2.138T15 22zm1-4v-1.5q0-.8-.525-1.525T4 14.05V12q0-.825.587-1.413T6 10h8q.825 0 1.413.588T16 12v2.05q-.95.2-1.475.925T14 16.5V18z\\"/>"}}},{"prefix":"fluent-emoji-flat","icons":{"thumbs-up":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FFC83D\\" d=\\"M12.313 5.531c0-2.9 2.124-3.583 3.312-3.562c2.413 0 3.082 2.009 3.281 3.078c.248 1.33.006 4.509-.106 5.969l-.003.041a2.3 2.3 0 0 1 .515-.057h3.858c1.56 0 2.83 1.27 2.83 2.83c0 .806-.259 1.535-.765 2.05c1.044.461 1.765 1.428 1.765 2.544c0 1.023-.463 1.92-1.364 2.418c.823.511 1.364 1.366 1.364 2.332c0 1.107-.543 2.069-1.598 2.533c.375.386.598.96.598 1.794c0 1.38-.969 2.502-2.83 2.502h-3.858q-.068 0-.134-.003h-3.131C5.609 30.172 5 23.406 5 20.656c0-5.156 2.298-6.689 4.34-8.051c.966-.644 1.875-1.25 2.457-2.183c.488-.783.515-1.5.515-4.89\\"/><path fill=\\"#D67D00\\" d=\\"M19 11c-1.02.031-4 .594-4 2.969c0 1.25.469 1.953 1.031 2.344c-.562.25-1.062 1.178-1.062 2.328c0 1.28 1.062 2.218 1.062 2.218s-1.062 1.032-1.062 2.266c0 .932.408 1.62 1.062 2.088c-.354.2-1.062.893-1.062 2.068c0 1.401 1.308 2.575 3.87 2.68c-1.248-.231-1.855-1.375-1.855-2.46c0-.358.134-.934.467-1.442H23a.5.5 0 0 0 0-1h-5.411c-.405-.53-.605-1.218-.605-1.885c0-.416.157-1.088.546-1.674H23a.5.5 0 0 0 0-1h-5.25c-.513-.55-.766-1.325-.766-2.076c0-.357.116-.905.396-1.424H23a.5.5 0 0 0 0-1h-5.173c-.564-.597-.843-1.484-.843-2.17c0-.81.443-2.6 2.016-2.81z\\"/></g>"},"red-heart":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#F8312F\\" d=\\"M6 6c4.665-2.332 8.5.5 10 2.5c1.5-2 5.335-4.832 10-2.5c6 3 4.5 10.5 0 15c-2.196 2.196-6.063 6.063-8.891 8.214a1.764 1.764 0 0 1-2.186-.041C12.33 27.08 8.165 23.165 6 21C1.5 16.5 0 9 6 6\\"/><path fill=\\"#CA0B4A\\" d=\\"M16 8.5v3.05c1.27-2.685 4.425-6.27 9.658-5.713c-4.51-2.03-8.195.712-9.658 2.663m-4.054-2.963C10.26 4.95 8.225 4.887 6 6C0 9 1.5 16.5 6 21c2.165 2.165 6.33 6.08 8.923 8.173a1.764 1.764 0 0 0 2.186.04q.381-.29.785-.618c-2.854-2.143-6.86-5.519-9.035-7.462c-4.957-4.431-6.61-11.815 0-14.769a9.7 9.7 0 0 1 3.087-.827\\"/><ellipse cx=\\"23.477\\" cy=\\"12.594\\" fill=\\"#F37366\\" rx=\\"2.836\\" ry=\\"4.781\\" transform=\\"rotate(30 23.477 12.594)\\"/></g>"},"smiling-face-with-heart-eyes":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FFB02E\\" d=\\"M15.999 29.998c9.334 0 13.999-6.268 13.999-14c0-7.73-4.665-13.998-14-13.998C6.665 2 2 8.268 2 15.999s4.664 13.999 13.999 13.999\\"/><path fill=\\"#BB1D80\\" d=\\"M16 25c-9 0-9-9-9-9h18s0 9-9 9\\"/><path fill=\\"#fff\\" d=\\"M8 16.5V16h16v.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1\\"/><path fill=\\"#F70A8D\\" d=\\"M3.181 9.75c2.016 2.327 4.698 3.346 6.073 3.74a1.6 1.6 0 0 0 1.57-.412c1.194-1.178 3.6-3.879 4.114-6.963c.718-4.306-4.682-5.62-6.858-2.07C2.99 1.655.296 6.421 3.18 9.75m25.637.002c-2.015 2.326-4.695 3.344-6.07 3.737c-.563.162-1.154 0-1.57-.411c-1.194-1.177-3.598-3.877-4.112-6.96c-.718-4.304 4.68-5.617 6.855-2.069c5.089-2.39 7.78 2.375 4.897 5.703\\"/></g>"},"face-with-tears-of-joy":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FFB02E\\" d=\\"M15.999 29.998c9.334 0 13.999-6.268 13.999-14c0-7.73-4.665-13.998-14-13.998C6.665 2 2 8.268 2 15.999s4.664 13.999 13.999 13.999\\"/><path fill=\\"#402A32\\" d=\\"M8.982 11.19c.048-.246.158-.55.367-.777c.18-.196.498-.413 1.15-.413c.643 0 .97.222 1.158.429c.218.24.323.545.358.742a1 1 0 0 0 1.97-.342a3.54 3.54 0 0 0-.85-1.747C12.563 8.452 11.696 8 10.5 8c-1.184 0-2.047.431-2.624 1.06c-.548.596-.769 1.293-.858 1.75a1 1 0 1 0 1.964.38m11 0c.048-.246.158-.55.367-.777c.18-.196.498-.413 1.151-.413c.642 0 .969.222 1.157.429c.219.24.324.545.358.742a1 1 0 0 0 1.97-.342a3.54 3.54 0 0 0-.85-1.747C23.563 8.452 22.696 8 21.5 8c-1.184 0-2.047.431-2.624 1.06c-.548.596-.769 1.293-.857 1.75a1 1 0 1 0 1.963.38\\"/><path fill=\\"#BB1D80\\" d=\\"M16 25c-9 0-9-9-9-9h18s0 9-9 9\\"/><path fill=\\"#fff\\" d=\\"M8 16.5V16h16v.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1\\"/><path fill=\\"#3F5FFF\\" d=\\"M4.63 20.37L8 17a2.121 2.121 0 1 0-3-3l-3.37 3.37a2.121 2.121 0 1 0 3 3m22.99 0L24.25 17a2.121 2.121 0 0 1 3-3l3.37 3.37a2.121 2.121 0 0 1-3 3\\"/></g>"},"face-with-open-mouth":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FFB02E\\" d=\\"M15.999 29.998c9.334 0 13.999-6.268 13.999-14c0-7.73-4.665-13.998-14-13.998C6.665 2 2 8.268 2 15.999s4.664 13.999 13.999 13.999\\"/><path fill=\\"#fff\\" d=\\"M10.5 16a4.5 4.5 0 1 0 0-9a4.5 4.5 0 0 0 0 9m11 0a4.5 4.5 0 1 0 0-9a4.5 4.5 0 0 0 0 9\\"/><path fill=\\"#402A32\\" d=\\"M12 14a2 2 0 1 0 0-4a2 2 0 0 0 0 4m8 0a2 2 0 1 0 0-4a2 2 0 0 0 0 4\\"/><path fill=\\"#BB1D80\\" d=\\"M12 22a4 4 0 0 1 8 0v2a4 4 0 0 1-8 0z\\"/></g>"},"crying-face":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FFB02E\\" d=\\"M15.999 29.998c9.334 0 13.999-6.268 13.999-14c0-7.73-4.665-13.998-14-13.998C6.665 2 2 8.268 2 15.999s4.664 13.999 13.999 13.999\\"/><path fill=\\"#fff\\" d=\\"M10.42 19.224a4.206 4.206 0 1 0 0-8.411a4.206 4.206 0 0 0 0 8.411m11.148.077a4.244 4.244 0 1 0 0-8.489a4.244 4.244 0 0 0 0 8.49\\"/><path fill=\\"#402A32\\" d=\\"M6.974 10.658c.144-.43.502-1.108 1.095-1.67C8.654 8.433 9.452 8 10.5 8a.5.5 0 0 0 0-1c-1.351 0-2.386.567-3.118 1.262c-.724.688-1.166 1.51-1.355 2.08a.5.5 0 1 0 .948.316m6.732 13.049c.28-.28 1.007-.707 2.293-.707c1.227 0 2.018.433 2.293.707a1 1 0 0 0 1.414-1.414C18.981 21.567 17.639 21 16 21c-1.714 0-2.986.572-3.707 1.293a1 1 0 0 0 1.414 1.414M23.93 8.988c.593.562.952 1.24 1.096 1.67a.5.5 0 1 0 .948-.316c-.19-.57-.631-1.392-1.355-2.08C23.887 7.567 22.852 7 21.5 7a.5.5 0 1 0 0 1c1.049 0 1.847.433 2.432.988M14 15a3 3 0 1 1-6 0a3 3 0 0 1 6 0m10 0a3 3 0 1 1-6 0a3 3 0 0 1 6 0\\"/><path fill=\\"#3F5FFF\\" d=\\"M6 21a2 2 0 1 1 4 0v3a2 2 0 1 1-4 0z\\"/></g>"},"fire":{"width":32,"height":32,"body":"<g fill=\\"none\\"><path fill=\\"#FF6723\\" d=\\"M26 19.34c0 6.1-5.05 11.005-11.15 10.641c-6.269-.374-10.56-6.403-9.752-12.705c.489-3.833 2.286-7.12 4.242-9.67c.34-.445.689 3.136 1.038 2.742c.35-.405 3.594-6.019 4.722-7.991a.694.694 0 0 1 1.028-.213C18.394 3.854 26 10.277 26 19.34\\"/><path fill=\\"#FFB02E\\" d=\\"M23 21.851c0 4.042-3.519 7.291-7.799 7.144c-4.62-.156-7.788-4.384-7.11-8.739C9.07 14.012 15.48 10 15.48 10S23 14.707 23 21.851\\"/></g>"},"sparkles":{"width":32,"height":32,"body":"<path fill=\\"#F9C23C\\" d=\\"M10.52 7.052a1.17 1.17 0 0 1-.639-.636L8.93 4.257c-.178-.343-.69-.343-.858 0l-.952 2.16a1.28 1.28 0 0 1-.638.635l-1.214.524a.462.462 0 0 0 0 .838l1.214.524c.293.121.523.353.638.636l.952 2.169c.178.343.69.343.858 0l.952-2.17c.126-.282.356-.504.638-.635l1.214-.524a.462.462 0 0 0 0-.838zm15.054 6.503a3.73 3.73 0 0 1-1.922-1.977L20.79 4.81a1.432 1.432 0 0 0-2.58 0l-2.863 6.768a3.8 3.8 0 0 1-1.921 1.977l-3.622 1.64c-1.072.53-1.072 2.08 0 2.61l3.622 1.64a3.74 3.74 0 0 1 1.922 1.977l2.862 6.768a1.432 1.432 0 0 0 2.58 0l2.863-6.768a3.8 3.8 0 0 1 1.921-1.977l3.622-1.64c1.072-.53 1.072-2.08 0-2.61zM8.281 20.33c.16.392.454.696.822.872l1.55.725a.646.646 0 0 1 0 1.146l-1.55.725c-.368.176-.661.49-.822.872l-1.228 2.977a.61.61 0 0 1-1.106 0L4.72 24.67a1.66 1.66 0 0 0-.822-.872l-1.55-.725a.646.646 0 0 1 0-1.146l1.55-.725c.368-.176.661-.49.822-.872l1.228-2.977a.61.61 0 0 1 1.106 0z\\"/>"}}}]');for(const s of i)for(const[l,p]of Object.entries(s.icons))e(s.prefix?s.prefix+":"+l:l,p);fz=!0}async function yte(e,i){if(!e)return null;K6(Fw);const s=aP(e);return s||(await UJ(e).catch(()=>(console.warn(`[Icon] failed to load icon \`${e}\``),null)),aP(e))}function J6(e){const i=hd().icon,s=(i.collections||[]).sort((l,p)=>p.length-l.length);return Ei(()=>{const l=e(),p=l.startsWith(i.cssSelectorPrefix)?l.slice(i.cssSelectorPrefix.length):l,_=i.aliases?.[p]||p;if(!_.includes(":")){const b=s.find(t=>_.startsWith(t+"-"));return b?b+":"+_.slice(b.length+1):_}return _})}function Q6(e,i){if(e!==!1)return e===!0||e===null?i:e}let Z1;function vte(e){return e.replace(/([^\w-])/g,"\\$1")}function xte(){if(Z1)return Z1;Z1=new Set;const e=s=>{if(s=s.replace(/^:where\((.*)\)$/,"$1").trim(),s.startsWith("."))return s},i=s=>{if(s?.length)for(const l of s){l?.cssRules&&i(l.cssRules);const p=l?.selectorText;if(typeof p=="string"){const _=e(p);_&&Z1.add(_)}}};if(typeof document<"u")for(const s of document.styleSheets)try{const l=s.cssRules||s.rules;i(l)}catch{}return Z1}const bte=kr({name:"NuxtIconCss",props:{name:{type:String,required:!0},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e){const i=Vs(),s=hd().icon,l=Ei(()=>e.name?s.cssSelectorPrefix+e.name:"");function p(t){if(!t)return;const P=aP(t);if(P)return P;const O=i.payload?.data?.[t];if(O)return Fw(t,O),O}const _=Ei(()=>"."+vte(l.value));function b(t,P=!0){let O=_.value;s.cssWherePseudo&&(O=`:where(${O})`);const F=_te(t,{iconSelector:O,format:"compressed",customise:Q6(e.customize,s.customize)});return s.cssLayer&&P?`@layer ${s.cssLayer} { ${F} }`:F}{const t=xte();async function P(O){if(t.has(_.value)||typeof document>"u")return;const F=document.createElement("style");F.textContent=b(O);const $=document.head.querySelector('style, link[rel="stylesheet"]');$?document.head.insertBefore(F,$):document.head.appendChild(F),t.add(_.value)}Qn(()=>e.name,()=>{if(t.has(_.value))return;const O=p(e.name);O?P(O):yte(e.name).then(F=>{F&&P(F)}).catch(()=>null)},{immediate:!0})}return()=>Ns("span",{class:["iconify",l.value]})}}),wte=kr({name:"NuxtIconSvg",props:{name:{type:String,required:!0},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e,{slots:i}){const s=Vs(),l=hd().icon,p=J6(()=>e.name),_="i-"+p.value;if(p.value){const b=s.payload.data[_];b?Fw(p.value,b):K6(Fw)}return()=>Ns(tQ,{icon:p.value,ssr:!0,customise:Q6(e.customize,l.customize)},i)}}),Wd=kr({name:"NuxtIcon",props:{name:{type:String,required:!0},mode:{type:String,required:!1,default:null},size:{type:[Number,String],required:!1,default:null},customize:{type:[Function,Boolean,null],default:null,required:!1}},setup(e,{slots:i}){const s=Vs(),l=hd().icon,p=J6(()=>e.name),_=Ei(()=>s.vueApp?.component(p.value)||((e.mode||l.mode)==="svg"?wte:bte)),b=Ei(()=>{const t=e.size||l.size;return t?{fontSize:Number.isNaN(+t)?t:t+"px"}:null});return()=>Ns(_.value,{...l.attrs,name:p.value,class:l.class,style:b.value,customize:e.customize},i)}}),Tte=Object.freeze(Object.defineProperty({__proto__:null,default:Wd},Symbol.toStringTag,{value:"Module"})),oS=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Ste(e,i){let s=new Set,l=new Set,p=!1,_=!1;const b=new WeakSet;let t={delta:0,timestamp:0,isProcessing:!1};function P(F){b.has(F)&&(O.schedule(F),e()),F(t)}const O={schedule:(F,$=!1,W=!1)=>{const ae=W&&p?s:l;return $&&b.add(F),ae.has(F)||ae.add(F),F},cancel:F=>{l.delete(F),b.delete(F)},process:F=>{if(t=F,p){_=!0;return}p=!0,[s,l]=[l,s],s.forEach(P),s.clear(),p=!1,_&&(_=!1,O.process(F))}};return O}const Y_={},Ete=40;function eN(e,i){let s=!1,l=!0;const p={delta:0,timestamp:0,isProcessing:!1},_=()=>s=!0,b=oS.reduce((de,Ee)=>(de[Ee]=Ste(_),de),{}),{setup:t,read:P,resolveKeyframes:O,preUpdate:F,update:$,preRender:W,render:Y,postRender:ae}=b,se=()=>{const de=Y_.useManualTiming?p.timestamp:performance.now();s=!1,Y_.useManualTiming||(p.delta=l?1e3/60:Math.max(Math.min(de-p.timestamp,Ete),1)),p.timestamp=de,p.isProcessing=!0,t.process(p),P.process(p),O.process(p),F.process(p),$.process(p),W.process(p),Y.process(p),ae.process(p),p.isProcessing=!1,s&&i&&(l=!1,e(se))},ie=()=>{s=!0,l=!0,p.isProcessing||e(se)};return{schedule:oS.reduce((de,Ee)=>{const Pe=b[Ee];return de[Ee]=(Ze,We=!1,je=!1)=>(s||ie(),Pe.schedule(Ze,We,je)),de},{}),cancel:de=>{for(let Ee=0;Ee<oS.length;Ee++)b[oS[Ee]].cancel(de)},state:p,steps:b}}const qd=e=>e,{schedule:ml,cancel:K_,state:Gu,steps:jC}=eN(typeof requestAnimationFrame<"u"?requestAnimationFrame:qd,!0);let jS;function Ite(){jS=void 0}const jd={now:()=>(jS===void 0&&jd.set(Gu.isProcessing||Y_.useManualTiming?Gu.timestamp:performance.now()),jS),set:e=>{jS=e,queueMicrotask(Ite)}},Em=e=>e*1e3,Dg=e=>e/1e3;function Cte(e,i){const s=jd.now(),l=({timestamp:p})=>{const _=p-s;_>=i&&(K_(l),e(_-i))};return ml.setup(l,!0),()=>K_(l)}const tN=e=>i=>typeof i=="string"&&i.startsWith(e),OM=tN("--"),Ate=tN("var(--"),FM=e=>Ate(e)?Pte.test(e.split("/*")[0].trim()):!1,Pte=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Bw={};function iN(e){for(const i in e)Bw[i]=e[i],OM(i)&&(Bw[i].isCSSVariable=!0)}function n2(e,i){const s=typeof e=="string"&&!i?`${e}Context`:i,l=Symbol(s);return[b=>{const t=Fo(l,b);if(t===void 0)throw new Error(`Injection \`${l.toString()}\` not found. Component must be used within ${Array.isArray(e)?`one of the following components: ${e.join(", ")}`:`\`${e}\``}`);return t},b=>(Ka(l,b),b)]}const[Mte,kte]=n2("Motion"),[Dte]=n2("LayoutGroup");function pz(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}class iy{constructor(i){this.state=i}beforeMount(){}mount(){}unmount(){}update(){}beforeUpdate(){}beforeUnmount(){}}function gw(e,i,s){if(Array.isArray(e))return e.reduce((l,p)=>{const _=gw(p,i,s);return _?{...l,..._}:l},{});if(typeof e=="object")return e;if(e&&i){const l=i[e];return typeof l=="function"?l(s):l}}function Lte(e,i){return typeof e!=typeof i?!0:Array.isArray(e)&&Array.isArray(i)?!Rte(e,i):e!==i}function Rte(e,i){const s=i.length;if(s!==e.length)return!1;for(let l=0;l<s;l++)if(i[l]!==e[l])return!1;return!0}function mz(e){return e?.startsWith("--")}const zte=e=>e;function Ote(e){return typeof e=="number"}const Fte=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","linearGradient","radialGradient","textPath"],Bte=new Set(Fte);function nN(e){return Bte.has(e)}class Nte{constructor(i){this.features=[];const{features:s=[],lazyMotionContext:l}=i.options,p=s.concat(l.features.value);this.features=p.map(b=>new b(i));const _=this.features;Qn(l.features,b=>{b.forEach(t=>{if(!p.includes(t)){p.push(t);const P=new t(i);_.push(P),i.isMounted()&&(P.beforeMount(),P.mount())}})},{flush:"pre"})}mount(){this.features.forEach(i=>i.mount())}beforeMount(){this.features.forEach(i=>{var s;return(s=i.beforeMount)==null?void 0:s.call(i)})}unmount(){this.features.forEach(i=>i.unmount())}update(){this.features.forEach(i=>{var s;return(s=i.update)==null?void 0:s.call(i)})}beforeUpdate(){this.features.forEach(i=>i.beforeUpdate())}beforeUnmount(){this.features.forEach(i=>i.beforeUnmount())}}const nb=new WeakMap;function UC(e){const i=nb.get(e);i&&e.removeEventListener("motioncomplete",i),nb.delete(e)}const[Vte,jte]=n2("AnimatePresenceContext");function Ute(e){const i={initial:e.initial,custom:e.custom};Qn(()=>e.custom,s=>{i.custom=s},{flush:"pre"}),jte(i),La(()=>{i.initial=void 0})}function $te(e){return typeof e=="string"||e===!1||Array.isArray(e)}const _w=new WeakMap;let Gte=0;class qte{constructor(i,s){var l;this.element=null,this.isSafeToRemove=!1,this.isVShow=!1,this.children=new Set,this.activeStates={initial:!0,animate:!0},this.currentProcess=null,this._context=null,this.animateUpdates=qd,this.id=`motion-state-${Gte++}`,this.options=i,this.parent=s,(l=s?.children)==null||l.add(this);const _=(i.initial===void 0&&i.variants?this.context.initial:i.initial)===!1?["initial","animate"]:["initial"];this.initTarget(_),this.featureManager=new Nte(this),this.type=nN(this.options.as)?"svg":"html"}get context(){if(!this._context){const i={get:(s,l)=>{var p;return $te(this.options[l])?this.options[l]:(p=this.parent)==null?void 0:p.context[l]}};this._context=new Proxy({},i)}return this._context}initTarget(i){var s;const l=this.options.custom??((s=this.options.animatePresenceContext)==null?void 0:s.custom);this.baseTarget=i.reduce((p,_)=>({...p,...gw(this.options[_]||this.context[_],this.options.variants,l)}),{}),this.target={}}updateOptions(i){var s;this.options=i,(s=this.visualElement)==null||s.update({...this.options,whileTap:this.options.whilePress},{isPresent:!nb.has(this.element)})}beforeMount(){this.featureManager.beforeMount()}mount(i,s,l=!1){var p,_;this.element=i,this.updateOptions(s),this.options.layoutId&&((p=this.visualElement.projection.getStack())==null?void 0:p.members.length)>0,this.featureManager.mount(),!l&&this.options.animate&&((_=this.startAnimation)==null||_.call(this))}clearAnimation(){var i,s;this.currentProcess&&K_(this.currentProcess),this.currentProcess=null,(s=(i=this.visualElement)==null?void 0:i.variantChildren)==null||s.forEach(l=>{l.state.clearAnimation()})}startAnimation(){this.clearAnimation(),this.currentProcess=ml.render(()=>{this.currentProcess=null,this.animateUpdates()})}beforeUnmount(){this.featureManager.beforeUnmount()}unmount(i=!1){var s;const l=this.options.layoutId&&((s=this.visualElement.projection)==null?void 0:s.getStack().lead)===this.visualElement.projection&&this.visualElement.projection.isProjecting(),p=()=>{var _,b,t;i&&Array.from(this.children).reverse().forEach(this.unmountChild),(b=(_=this.parent)==null?void 0:_.children)==null||b.delete(this),_w.delete(this.element),this.featureManager.unmount(),(t=this.visualElement)==null||t.unmount(),this.clearAnimation()};l?Promise.resolve().then(()=>{p()}):p()}unmountChild(i){i.unmount(!0)}beforeUpdate(){this.featureManager.beforeUpdate()}update(i){this.updateOptions(i),this.featureManager.update(),this.startAnimation()}setActive(i,s,l=!0){var p;!this.element||this.activeStates[i]===s||(this.activeStates[i]=s,(p=this.visualElement.variantChildren)==null||p.forEach(_=>{_.state.setActive(i,s,!1)}),l&&this.animateUpdates({isExit:i==="exit"&&this.activeStates.exit}))}isMounted(){return!!this.element}willUpdate(i){var s;(this.options.layout||this.options.layoutId)&&((s=this.visualElement.projection)==null||s.willUpdate())}}const _v=new WeakMap;function gz(e,i,s){return new CustomEvent(e,{detail:{target:i,isExit:s}})}const _z={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:e=>`${e}deg`},Hte={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:e=>`${e}px`},rotate:_z,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:zte},skew:_z},Wte=["translate","scale","rotate","skew"],Zte=["","X","Y","Z"],BM=new Map,bE=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"];Wte.forEach(e=>{Zte.forEach(i=>{bE.push(e+i),BM.set(e+i,Hte[e])})});const Xte=new Set(bE),Yte=e=>Xte.has(e),yz={x:"translateX",y:"translateY",z:"translateZ"};function Kte([e],[i]){return bE.indexOf(e)-bE.indexOf(i)}function Jte(e,[i,s]){return`${e} ${i}(${s})`}function Qte(e){return e.sort(Kte).reduce(Jte,"").trim()}const vz={translate:[0,0],rotate:0,scale:1,skew:0,x:0,y:0,z:0},r2=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),Zy=r2("deg"),Lg=r2("%"),Ls=r2("px"),eie=r2("vh"),tie=r2("vw"),xz={...Lg,parse:e=>Lg.parse(e)/100,transform:e=>Lg.transform(e*100)},Vc=e=>!!(e&&e.getVelocity),iie={get:(e,i)=>{let s=mz(i)?e.style.getPropertyValue(i):getComputedStyle(e)[i];if(!s&&s!=="0"){const l=BM.get(i);l&&(s=l.initialValue)}return s},set:(e,i,s)=>{mz(i)?e.style.setProperty(i,s):e.style[i]=s}};function nie(e){var i;const s={},l=[];for(let p in e){let _=e[p];_=Vc(_)?_.get():_,Yte(p)&&p in yz&&(p=yz[p]);let b=Array.isArray(_)?_[0]:_;const t=BM.get(p);t?(b=Ote(_)?(i=t.toDefaultUnit)==null?void 0:i.call(t,_):_,l.push([p,b])):s[p]=b}return l.length&&(s.transform=Qte(l)),Object.keys(s).length===0?null:s}const rie={fill:!0,stroke:!0,opacity:!0,"stroke-width":!0,"fill-opacity":!0,"stroke-opacity":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,cx:!0,cy:!0,r:!0,d:!0,x1:!0,y1:!0,x2:!0,y2:!0,points:!0,"path-length":!0,viewBox:!0,width:!0,height:!0,"preserve-aspect-ratio":!0,"clip-path":!0,filter:!0,mask:!0,"stop-color":!0,"stop-opacity":!0,"gradient-transform":!0,"gradient-units":!0,"spread-method":!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,"text-anchor":!0,"dominant-baseline":!0,"font-family":!0,"font-size":!0,"font-weight":!0,"letter-spacing":!0,"vector-effect":!0};function sie(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function oie(e,i,s=1,l=0){e.pathLength=1,delete e["path-length"],e["stroke-dashoffset"]=Ls.transform(-l);const p=Ls.transform(i),_=Ls.transform(s);e["stroke-dasharray"]=`${p} ${_}`}function aie(e){const i={},s={};for(const l in e){const p=sie(l);if(p in rie){const _=e[l];i[p]=Vc(_)?_.get():_}else s[l]=e[l]}return i["path-length"]!==void 0&&oie(i,i["path-length"],i["path-spacing"],i["path-offset"]),{attrs:i,style:s}}function mb(e,i){return Rp()?(H_(e,i),!0):!1}function bz(){const e=new Set,i=_=>{e.delete(_)};return{on:_=>{e.add(_);const b=()=>i(_);return mb(b),{off:b}},off:i,trigger:(..._)=>Promise.all(Array.from(e).map(b=>b(..._))),clear:()=>{e.clear()}}}const $C=new WeakMap,lie=(...e)=>{var i;const s=e[0],l=(i=ba())===null||i===void 0?void 0:i.proxy,p=l??Rp();if(p==null&&!vv())throw new Error("injectLocal must be called in setup");return p&&$C.has(p)&&s in $C.get(p)?$C.get(p)[s]:Fo(...e)},s2=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const mP=e=>typeof e<"u",rN=e=>e!=null,cie=Object.prototype.toString,uie=e=>cie.call(e)==="[object Object]",qu=()=>{},hie=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),die=fie();function fie(){var e,i,s;return s2&&!!(!((e=window)===null||e===void 0||(e=e.navigator)===null||e===void 0)&&e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((i=window)===null||i===void 0||(i=i.navigator)===null||i===void 0?void 0:i.maxTouchPoints)>2&&/iPad|Macintosh/.test((s=window)===null||s===void 0?void 0:s.navigator.userAgent))}function sN(...e){if(e.length!==1)return Nc(...e);const i=e[0];return typeof i=="function"?Pp(cb(()=>({get:i,set:qu}))):an(i)}function NM(e,i){function s(...l){return new Promise((p,_)=>{Promise.resolve(e(()=>i.apply(this,l),{fn:i,thisArg:this,args:l})).then(p).catch(_)})}return s}const oN=e=>e();function pie(e,i={}){let s,l,p=qu;const _=P=>{clearTimeout(P),p(),p=qu};let b;return P=>{const O=Rr(e),F=Rr(i.maxWait);return s&&_(s),O<=0||F!==void 0&&F<=0?(l&&(_(l),l=void 0),Promise.resolve(P())):new Promise(($,W)=>{p=i.rejectOnCancel?W:$,b=P,F&&!l&&(l=setTimeout(()=>{s&&_(s),l=void 0,$(b())},F)),s=setTimeout(()=>{l&&_(l),l=void 0,$(P())},O)})}}function mie(...e){let i=0,s,l=!0,p=qu,_,b,t,P,O;!Wo(e[0])&&typeof e[0]=="object"?{delay:b,trailing:t=!0,leading:P=!0,rejectOnCancel:O=!1}=e[0]:[b,t=!0,P=!0,O=!1]=e;const F=()=>{s&&(clearTimeout(s),s=void 0,p(),p=qu)};return W=>{const Y=Rr(b),ae=Date.now()-i,se=()=>_=W();return F(),Y<=0?(i=Date.now(),se()):(ae>Y?(i=Date.now(),(P||!l)&&se()):t&&(_=new Promise((ie,pe)=>{p=O?pe:ie,s=setTimeout(()=>{i=Date.now(),l=!0,ie(se()),F()},Math.max(0,Y-ae))})),!P&&!s&&(s=setTimeout(()=>l=!0,Y)),l=!1,_)}}function gie(e=oN,i={}){const{initialState:s="active"}=i,l=sN(s==="active");function p(){l.value=!1}function _(){l.value=!0}const b=(...t)=>{l.value&&e(...t)};return{isActive:Pp(l),pause:p,resume:_,eventFilter:b}}function wz(e){return e.endsWith("rem")?Number.parseFloat(e)*16:Number.parseFloat(e)}function yw(e){return Array.isArray(e)?e:[e]}function _ie(e){const i=Object.create(null);return(s=>i[s]||(i[s]=e(s)))}const yie=/-(\w)/g,vie=_ie(e=>e.replace(yie,(i,s)=>s?s.toUpperCase():""));function xie(e){return ba()}function VM(e){if(!s2)return e;let i=0,s,l;const p=()=>{i-=1,l&&i<=0&&(l.stop(),s=void 0,l=void 0)};return((..._)=>(i+=1,l||(l=s0(!0),s=l.run(()=>e(..._))),mb(p),s))}function bie(e,i){if(typeof Symbol<"u"){const s={...e};return Object.defineProperty(s,Symbol.iterator,{enumerable:!1,value(){let l=0;return{next:()=>({value:i[l++],done:l>i.length})}}}),s}else return Object.assign([...i],e)}function wie(e){return Wo(e)?Ol(new Proxy({},{get(i,s,l){return ut(Reflect.get(e.value,s,l))},set(i,s,l){return Wo(e.value[s])&&!Wo(l)?e.value[s].value=l:e.value[s]=l,!0},deleteProperty(i,s){return Reflect.deleteProperty(e.value,s)},has(i,s){return Reflect.has(e.value,s)},ownKeys(){return Object.keys(e.value)},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}}})):Ol(e)}function aN(e){return wie(Ei(e))}function Tie(e,...i){const s=i.flat(),l=s[0];return aN(()=>Object.fromEntries(typeof l=="function"?Object.entries(Mp(e)).filter(([p,_])=>!l(Rr(_),p)):Object.entries(Mp(e)).filter(p=>!s.includes(p[0]))))}function gb(e,...i){const s=i.flat(),l=s[0];return aN(()=>Object.fromEntries(typeof l=="function"?Object.entries(Mp(e)).filter(([p,_])=>l(Rr(_),p)):s.map(p=>[p,sN(e,p)])))}function hI(e,i=200,s={}){return NM(pie(i,s),e)}function Sie(e,i=200,s=!1,l=!0,p=!1){return NM(mie(i,s,l,p),e)}function Eie(e,i,s={}){const{eventFilter:l=oN,...p}=s;return Qn(e,NM(l,i),p)}function Iie(e,i,s={}){const{eventFilter:l,initialState:p="active",..._}=s,{eventFilter:b,pause:t,resume:P,isActive:O}=gie(l,{initialState:p});return{stop:Eie(e,i,{..._,eventFilter:b}),pause:t,resume:P,isActive:O}}const Cie=Iie;function lN(e,i=!0,s){xie()?La(e,s):i?e():Da(e)}function Aie(e,i,s){return Qn(e,i,{...s,immediate:!0})}function a_e(e={}){const{inheritAttrs:i=!0}=e,s=so(),l=kr({setup(_,{slots:b}){return()=>{s.value=b.default}}}),p=kr({inheritAttrs:i,props:e.props,setup(_,{attrs:b,slots:t}){return()=>{var P;if(!s.value)throw new Error("[VueUse] Failed to find the definition of reusable template");const O=(P=s.value)===null||P===void 0?void 0:P.call(s,{...e.props==null?Pie(b):_,$slots:t});return i&&O?.length===1?O[0]:O}}});return bie({define:l,reuse:p},[l,p])}function Pie(e){const i={};for(const s in e)i[vie(s)]=e[s];return i}const ad=s2?window:void 0,Mie=s2?window.document:void 0;function Ud(e){var i;const s=Rr(e);return(i=s?.$el)!==null&&i!==void 0?i:s}function ld(...e){const i=(l,p,_,b)=>(l.addEventListener(p,_,b),()=>l.removeEventListener(p,_,b)),s=Ei(()=>{const l=yw(Rr(e[0])).filter(p=>p!=null);return l.every(p=>typeof p!="string")?l:void 0});return Aie(()=>{var l,p;return[(l=(p=s.value)===null||p===void 0?void 0:p.map(_=>Ud(_)))!==null&&l!==void 0?l:[ad].filter(_=>_!=null),yw(Rr(s.value?e[1]:e[0])),yw(ut(s.value?e[2]:e[1])),Rr(s.value?e[3]:e[2])]},([l,p,_,b],t,P)=>{if(!l?.length||!p?.length||!_?.length)return;const O=uie(b)?{...b}:b,F=l.flatMap($=>p.flatMap(W=>_.map(Y=>i($,W,Y,O))));P(()=>{F.forEach($=>$())})},{flush:"post"})}let Tz=!1;function kie(e,i,s={}){const{window:l=ad,ignore:p=[],capture:_=!0,detectIframe:b=!1,controls:t=!1}=s;if(!l)return t?{stop:qu,cancel:qu,trigger:qu}:qu;if(die&&!Tz){Tz=!0;const ie={passive:!0};Array.from(l.document.body.children).forEach(pe=>pe.addEventListener("click",qu,ie)),l.document.documentElement.addEventListener("click",qu,ie)}let P=!0;const O=ie=>Rr(p).some(pe=>{if(typeof pe=="string")return Array.from(l.document.querySelectorAll(pe)).some(ye=>ye===ie.target||ie.composedPath().includes(ye));{const ye=Ud(pe);return ye&&(ie.target===ye||ie.composedPath().includes(ye))}});function F(ie){const pe=Rr(ie);return pe&&pe.$.subTree.shapeFlag===16}function $(ie,pe){const ye=Rr(ie),de=ye.$.subTree&&ye.$.subTree.children;return de==null||!Array.isArray(de)?!1:de.some(Ee=>Ee.el===pe.target||pe.composedPath().includes(Ee.el))}const W=ie=>{const pe=Ud(e);if(ie.target!=null&&!(!(pe instanceof Element)&&F(e)&&$(e,ie))&&!(!pe||pe===ie.target||ie.composedPath().includes(pe))){if("detail"in ie&&ie.detail===0&&(P=!O(ie)),!P){P=!0;return}i(ie)}};let Y=!1;const ae=[ld(l,"click",ie=>{Y||(Y=!0,setTimeout(()=>{Y=!1},0),W(ie))},{passive:!0,capture:_}),ld(l,"pointerdown",ie=>{const pe=Ud(e);P=!O(ie)&&!!(pe&&!ie.composedPath().includes(pe))},{passive:!0}),b&&ld(l,"blur",ie=>{setTimeout(()=>{var pe;const ye=Ud(e);((pe=l.document.activeElement)===null||pe===void 0?void 0:pe.tagName)==="IFRAME"&&!ye?.contains(l.document.activeElement)&&i(ie)},0)},{passive:!0})].filter(Boolean),se=()=>ae.forEach(ie=>ie());return t?{stop:se,cancel:()=>{P=!1},trigger:ie=>{P=!0,W(ie),P=!1}}:se}function Die(){const e=so(!1),i=ba();return i&&La(()=>{e.value=!0},i),e}function dI(e){const i=Die();return Ei(()=>(i.value,!!e()))}function cN(e,i,s={}){const{window:l=ad,...p}=s;let _;const b=dI(()=>l&&"MutationObserver"in l),t=()=>{_&&(_.disconnect(),_=void 0)},P=Qn(Ei(()=>{const $=yw(Rr(e)).map(Ud).filter(rN);return new Set($)}),$=>{t(),b.value&&$.size&&(_=new MutationObserver(i),$.forEach(W=>_.observe(W,p)))},{immediate:!0,flush:"post"}),O=()=>_?.takeRecords(),F=()=>{P(),t()};return mb(F),{isSupported:b,stop:F,takeRecords:O}}function Lie(e,i,s={}){const{window:l=ad,document:p=l?.document,flush:_="sync"}=s;if(!l||!p)return qu;let b;const t=F=>{b?.(),b=F},P=Ph(()=>{const F=Ud(e);if(F){const{stop:$}=cN(p,W=>{W.map(Y=>[...Y.removedNodes]).flat().some(Y=>Y===F||Y.contains(F))&&i(W)},{window:l,childList:!0,subtree:!0});t($)}},{flush:_}),O=()=>{P(),t()};return mb(O),O}function Rie(e={}){var i;const{window:s=ad,deep:l=!0,triggerOnRemoval:p=!1}=e,_=(i=e.document)!==null&&i!==void 0?i:s?.document,b=()=>{let O=_?.activeElement;if(l)for(var F;O?.shadowRoot;)O=O==null||(F=O.shadowRoot)===null||F===void 0?void 0:F.activeElement;return O},t=so(),P=()=>{t.value=b()};if(s){const O={capture:!0,passive:!0};ld(s,"blur",F=>{F.relatedTarget===null&&P()},O),ld(s,"focus",P,O)}return p&&Lie(t,P,{document:_}),P(),t}const zie=Symbol("vueuse-ssr-width");function Oie(){const e=vv()?lie(zie,null):null;return typeof e=="number"?e:void 0}function jM(e,i={}){const{window:s=ad,ssrWidth:l=Oie()}=i,p=dI(()=>s&&"matchMedia"in s&&typeof s.matchMedia=="function"),_=so(typeof l=="number"),b=so(),t=so(!1),P=O=>{t.value=O.matches};return Ph(()=>{if(_.value){_.value=!p.value,t.value=Rr(e).split(",").some(O=>{const F=O.includes("not all"),$=O.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),W=O.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let Y=!!($||W);return $&&Y&&(Y=l>=wz($[1])),W&&Y&&(Y=l<=wz(W[1])),F?!Y:Y});return}p.value&&(b.value=s.matchMedia(Rr(e)),t.value=b.value.matches)}),ld(b,"change",P,{passive:!0}),Ei(()=>t.value)}function Fie(e){return JSON.parse(JSON.stringify(e))}const aS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lS="__vueuse_ssr_handlers__",Bie=Nie();function Nie(){return lS in aS||(aS[lS]=aS[lS]||{}),aS[lS]}function Vie(e,i){return Bie[e]||i}function jie(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const Uie={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},Sz="vueuse-storage";function $ie(e,i,s,l={}){var p;const{flush:_="pre",deep:b=!0,listenToStorageChanges:t=!0,writeDefaults:P=!0,mergeDefaults:O=!1,shallow:F,window:$=ad,eventFilter:W,onError:Y=Wt=>{console.error(Wt)},initOnMounted:ae}=l,se=(F?so:an)(typeof i=="function"?i():i),ie=Ei(()=>Rr(e));if(!s)try{s=Vie("getDefaultStorage",()=>ad?.localStorage)()}catch(Wt){Y(Wt)}if(!s)return se;const pe=Rr(i),ye=jie(pe),de=(p=l.serializer)!==null&&p!==void 0?p:Uie[ye],{pause:Ee,resume:Pe}=Cie(se,Wt=>ct(Wt),{flush:_,deep:b,eventFilter:W});Qn(ie,()=>Ht(),{flush:_});let Ze=!1;const We=Wt=>{ae&&!Ze||Ht(Wt)},je=Wt=>{ae&&!Ze||ci(Wt)};$&&t&&(s instanceof Storage?ld($,"storage",We,{passive:!0}):ld($,Sz,je)),ae?lN(()=>{Ze=!0,Ht()}):Ht();function Ye(Wt,$t){if($){const Dt={key:ie.value,oldValue:Wt,newValue:$t,storageArea:s};$.dispatchEvent(s instanceof Storage?new StorageEvent("storage",Dt):new CustomEvent(Sz,{detail:Dt}))}}function ct(Wt){try{const $t=s.getItem(ie.value);if(Wt==null)Ye($t,null),s.removeItem(ie.value);else{const Dt=de.write(Wt);$t!==Dt&&(s.setItem(ie.value,Dt),Ye($t,Dt))}}catch($t){Y($t)}}function Lt(Wt){const $t=Wt?Wt.newValue:s.getItem(ie.value);if($t==null)return P&&pe!=null&&s.setItem(ie.value,de.write(pe)),pe;if(!Wt&&O){const Dt=de.read($t);return typeof O=="function"?O(Dt,pe):ye==="object"&&!Array.isArray(Dt)?{...pe,...Dt}:Dt}else return typeof $t!="string"?$t:de.read($t)}function Ht(Wt){if(!(Wt&&Wt.storageArea!==s)){if(Wt&&Wt.key==null){se.value=pe;return}if(!(Wt&&Wt.key!==ie.value)){Ee();try{const $t=de.write(se.value);(Wt===void 0||Wt?.newValue!==$t)&&(se.value=Lt(Wt))}catch($t){Y($t)}finally{Wt?Da(Pe):Pe()}}}}function ci(Wt){Ht(Wt.detail)}return se}function l_e(e,i={}){const s=so(!1),l=so(null);let p=0,_=!0;if(s2){var b,t;const P=typeof i=="function"?{onDrop:i}:i,O=(b=P.multiple)!==null&&b!==void 0?b:!0,F=(t=P.preventDefaultForUnhandled)!==null&&t!==void 0?t:!1,$=ie=>{var pe,ye;const de=Array.from((pe=(ye=ie.dataTransfer)===null||ye===void 0?void 0:ye.files)!==null&&pe!==void 0?pe:[]);return de.length===0?null:O?de:[de[0]]},W=ie=>{const pe=ut(P.dataTypes);return typeof pe=="function"?pe(ie):pe?.length?ie.length===0?!1:ie.every(ye=>pe.some(de=>ye.includes(de))):!0},Y=ie=>{if(P.checkValidity)return P.checkValidity(ie);const pe=W(Array.from(ie??[]).map(de=>de.type)),ye=O||ie.length<=1;return pe&&ye},ae=()=>/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)&&!("chrome"in window),se=(ie,pe)=>{var ye,de;const Ee=(ye=ie.dataTransfer)===null||ye===void 0?void 0:ye.items;if(_=(de=Ee&&Y(Ee))!==null&&de!==void 0?de:!1,F&&ie.preventDefault(),!ae()&&!_){ie.dataTransfer&&(ie.dataTransfer.dropEffect="none");return}ie.preventDefault(),ie.dataTransfer&&(ie.dataTransfer.dropEffect="copy");const Pe=$(ie);switch(pe){case"enter":var Ze;p+=1,s.value=!0,(Ze=P.onEnter)===null||Ze===void 0||Ze.call(P,null,ie);break;case"over":var We;(We=P.onOver)===null||We===void 0||We.call(P,null,ie);break;case"leave":var je;p-=1,p===0&&(s.value=!1),(je=P.onLeave)===null||je===void 0||je.call(P,null,ie);break;case"drop":if(p=0,s.value=!1,_){var Ye;l.value=Pe,(Ye=P.onDrop)===null||Ye===void 0||Ye.call(P,Pe,ie)}break}};ld(e,"dragenter",ie=>se(ie,"enter")),ld(e,"dragover",ie=>se(ie,"over")),ld(e,"dragleave",ie=>se(ie,"leave")),ld(e,"drop",ie=>se(ie,"drop"))}return{files:l,isOverDropZone:s}}function c_e(e,i,s={}){const{window:l=ad,...p}=s;let _;const b=dI(()=>l&&"ResizeObserver"in l),t=()=>{_&&(_.disconnect(),_=void 0)},P=Qn(Ei(()=>{const F=Rr(e);return Array.isArray(F)?F.map($=>Ud($)):[Ud(F)]}),F=>{if(t(),b.value&&l){_=new ResizeObserver(i);for(const $ of F)$&&_.observe($,p)}},{immediate:!0,flush:"post"}),O=()=>{t(),P()};return mb(O),{isSupported:b,stop:O}}function Gie(e,i,s={}){const{root:l,rootMargin:p="0px",threshold:_=0,window:b=ad,immediate:t=!0}=s,P=dI(()=>b&&"IntersectionObserver"in b),O=Ei(()=>yw(Rr(e)).map(Ud).filter(rN));let F=qu;const $=so(t),W=P.value?Qn(()=>[O.value,Ud(l),$.value],([ae,se])=>{if(F(),!$.value||!ae.length)return;const ie=new IntersectionObserver(i,{root:Ud(se),rootMargin:p,threshold:_});ae.forEach(pe=>pe&&ie.observe(pe)),F=()=>{ie.disconnect(),F=qu}},{immediate:t,flush:"post"}):qu,Y=()=>{F(),W(),$.value=!1};return mb(Y),{isSupported:P,isActive:$,pause(){F(),$.value=!1},resume(){$.value=!0},stop:Y}}const X1=new Map;function u_e(e){const i=Rp();function s(t){var P;const O=X1.get(e)||new Set;O.add(t),X1.set(e,O);const F=()=>p(t);return i==null||(P=i.cleanups)===null||P===void 0||P.push(F),F}function l(t){function P(...O){p(P),t(...O)}return s(P)}function p(t){const P=X1.get(e);P&&(P.delete(t),P.size||_())}function _(){X1.delete(e)}function b(t,P){var O;(O=X1.get(e))===null||O===void 0||O.forEach(F=>F(t,P))}return{on:s,once:l,off:p,emit:b,reset:_}}const qie={multiple:!0,accept:"*",reset:!1,directory:!1};function Hie(e){if(!e)return null;if(e instanceof FileList)return e;const i=new DataTransfer;for(const s of e)i.items.add(s);return i.files}function h_e(e={}){const{document:i=Mie}=e,s=an(Hie(e.initialFiles)),{on:l,trigger:p}=bz(),{on:_,trigger:b}=bz(),t=Ei(()=>{var $;const W=($=Ud(e.input))!==null&&$!==void 0?$:i?i.createElement("input"):void 0;return W&&(W.type="file",W.onchange=Y=>{s.value=Y.target.files,p(s.value)},W.oncancel=()=>{b()}),W}),P=()=>{s.value=null,t.value&&t.value.value&&(t.value.value="",p(null))},O=$=>{const W=t.value;W&&(W.multiple=Rr($.multiple),W.accept=Rr($.accept),W.webkitdirectory=Rr($.directory),hie($,"capture")&&(W.capture=Rr($.capture)))},F=$=>{const W=t.value;if(!W)return;const Y={...qie,...e,...$};O(Y),Rr(Y.reset)&&P(),W.click()};return Ph(()=>{O(e)}),{files:Pp(s),open:F,reset:P,onCancel:_,onChange:l}}const Ez=1;function Wie(e,i={}){const{throttle:s=0,idle:l=200,onStop:p=qu,onScroll:_=qu,offset:b={left:0,right:0,top:0,bottom:0},observe:t={mutation:!1},eventListenerOptions:P={capture:!1,passive:!0},behavior:O="auto",window:F=ad,onError:$=Ye=>{console.error(Ye)}}=i,W=typeof t=="boolean"?{mutation:t}:t,Y=so(0),ae=so(0),se=Ei({get(){return Y.value},set(Ye){pe(Ye,void 0)}}),ie=Ei({get(){return ae.value},set(Ye){pe(void 0,Ye)}});function pe(Ye,ct){var Lt,Ht,ci,Wt;if(!F)return;const $t=Rr(e);if(!$t)return;(Lt=$t instanceof Document?F.document.body:$t)===null||Lt===void 0||Lt.scrollTo({top:(Ht=Rr(ct))!==null&&Ht!==void 0?Ht:ie.value,left:(ci=Rr(Ye))!==null&&ci!==void 0?ci:se.value,behavior:Rr(O)});const Dt=($t==null||(Wt=$t.document)===null||Wt===void 0?void 0:Wt.documentElement)||$t?.documentElement||$t;se!=null&&(Y.value=Dt.scrollLeft),ie!=null&&(ae.value=Dt.scrollTop)}const ye=so(!1),de=Ol({left:!0,right:!1,top:!0,bottom:!1}),Ee=Ol({left:!1,right:!1,top:!1,bottom:!1}),Pe=Ye=>{ye.value&&(ye.value=!1,Ee.left=!1,Ee.right=!1,Ee.top=!1,Ee.bottom=!1,p(Ye))},Ze=hI(Pe,s+l),We=Ye=>{var ct;if(!F)return;const Lt=(Ye==null||(ct=Ye.document)===null||ct===void 0?void 0:ct.documentElement)||Ye?.documentElement||Ud(Ye),{display:Ht,flexDirection:ci,direction:Wt}=F.getComputedStyle(Lt),$t=Wt==="rtl"?-1:1,Dt=Lt.scrollLeft;Ee.left=Dt<Y.value,Ee.right=Dt>Y.value;const Ft=Math.abs(Dt*$t)<=(b.left||0),vt=Math.abs(Dt*$t)+Lt.clientWidth>=Lt.scrollWidth-(b.right||0)-Ez;Ht==="flex"&&ci==="row-reverse"?(de.left=vt,de.right=Ft):(de.left=Ft,de.right=vt),Y.value=Dt;let wi=Lt.scrollTop;Ye===F.document&&!wi&&(wi=F.document.body.scrollTop),Ee.top=wi<ae.value,Ee.bottom=wi>ae.value;const Qi=Math.abs(wi)<=(b.top||0),wn=Math.abs(wi)+Lt.clientHeight>=Lt.scrollHeight-(b.bottom||0)-Ez;Ht==="flex"&&ci==="column-reverse"?(de.top=wn,de.bottom=Qi):(de.top=Qi,de.bottom=wn),ae.value=wi},je=Ye=>{var ct;F&&(We((ct=Ye.target.documentElement)!==null&&ct!==void 0?ct:Ye.target),ye.value=!0,Ze(Ye),_(Ye))};return ld(e,"scroll",s?Sie(je,s,!0,!1):je,P),lN(()=>{try{const Ye=Rr(e);if(!Ye)return;We(Ye)}catch(Ye){$(Ye)}}),W?.mutation&&e!=null&&e!==F&&e!==document&&cN(e,()=>{const Ye=Rr(e);Ye&&We(Ye)},{attributes:!0,childList:!0,subtree:!0}),ld(e,"scrollend",Pe,P),{x:se,y:ie,isScrolling:ye,arrivedState:de,directions:Ee,measure(){const Ye=Rr(e);F&&Ye&&We(Ye)}}}function d_e(e,i,s={}){const{window:l=ad}=s;return $ie(e,i,l?.localStorage,s)}function f_e(e,i,s,l={}){var p,_;const{clone:b=!1,passive:t=!1,eventName:P,deep:O=!1,defaultValue:F,shouldEmit:$}=l,W=ba(),Y=s||W?.emit||(W==null||(p=W.$emit)===null||p===void 0?void 0:p.bind(W))||(W==null||(_=W.proxy)===null||_===void 0||(_=_.$emit)===null||_===void 0?void 0:_.bind(W?.proxy));let ae=P;ae=ae||`update:${i.toString()}`;const se=ye=>b?typeof b=="function"?b(ye):Fie(ye):ye,ie=()=>mP(e[i])?se(e[i]):F,pe=ye=>{$?$(ye)&&Y(ae,ye):Y(ae,ye)};if(t){const ye=an(ie());let de=!1;return Qn(()=>e[i],Ee=>{de||(de=!0,ye.value=se(Ee),Da(()=>de=!1))}),Qn(ye,Ee=>{!de&&(Ee!==e[i]||O)&&pe(Ee)},{deep:O}),ye}else return Ei({get(){return ie()},set(ye){pe(ye)}})}function p_e(e={}){const{window:i=ad,...s}=e;return Wie(i,s)}function Zie({top:e,left:i,right:s,bottom:l}){return{x:{min:i,max:s},y:{min:e,max:l}}}function Xie(e,i){if(!i)return e;const s=i({x:e.left,y:e.top}),l=i({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:l.y,right:l.x}}function Yie(e,i){return Zie(Xie(e.getBoundingClientRect(),i))}const Iz={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},gP={};for(const e in Iz)gP[e]={isEnabled:i=>Iz[e].some(s=>!!i[s])};const Cz=()=>({translate:0,scale:1,origin:0,originPoint:0}),Lx=()=>({x:Cz(),y:Cz()}),Az=()=>({min:0,max:0}),yc=()=>({x:Az(),y:Az()}),Kie=typeof window<"u",wE={current:null},uN={current:!1};function Jie(){if(uN.current=!0,!!Kie)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>wE.current=e.matches;e.addEventListener("change",i),i()}else wE.current=!1}function Qie(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function ene(e){return typeof e=="string"||Array.isArray(e)}const tne=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ine=["initial",...tne];function hN(e){return Qie(e.animate)||ine.some(i=>ene(e[i]))}function nne(e){return!!(hN(e)||e.variants)}function UM(e,i){e.indexOf(i)===-1&&e.push(i)}function fI(e,i){const s=e.indexOf(i);s>-1&&e.splice(s,1)}class $M{constructor(){this.subscriptions=[]}add(i){return UM(this.subscriptions,i),()=>fI(this.subscriptions,i)}notify(i,s,l){const p=this.subscriptions.length;if(p)if(p===1)this.subscriptions[0](i,s,l);else for(let _=0;_<p;_++){const b=this.subscriptions[_];b&&b(i,s,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function dN(e,i){return i?e*(1e3/i):0}const Pz=30,rne=e=>!isNaN(parseFloat(e));class sne{constructor(i,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var p;const _=jd.now();if(this.updatedAt!==_&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((p=this.events.change)==null||p.notify(this.current),this.dependents))for(const b of this.dependents)b.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=s.owner}setCurrent(i){this.current=i,this.updatedAt=jd.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=rne(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,s){this.events[i]||(this.events[i]=new $M);const l=this.events[i].add(s);return i==="change"?()=>{l(),ml.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,s){this.passiveEffect=i,this.stopPassiveEffect=s}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,s,l){this.set(s),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-l}jump(i,s=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var i;(i=this.events.change)==null||i.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=jd.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>Pz)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,Pz);return dN(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(i){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=i(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var i,s;(i=this.dependents)==null||i.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function rb(e,i){return new sne(e,i)}function one(e,i,s){for(const l in i){const p=i[l],_=s[l];if(Vc(p))e.addValue(l,p);else if(Vc(_))e.addValue(l,rb(p,{owner:e}));else if(_!==p)if(e.hasValue(l)){const b=e.getValue(l);b.liveStyle===!0?b.jump(p):b.hasAnimated||b.set(p)}else{const b=e.getStaticValue(l);e.addValue(l,rb(b!==void 0?b:p,{owner:e}))}}for(const l in s)i[l]===void 0&&e.removeValue(l);return i}function Mz(e){const i=[{},{}];return e?.values.forEach((s,l)=>{i[0][l]=s.get(),i[1][l]=s.getVelocity()}),i}function fN(e,i,s,l){if(typeof i=="function"){const[p,_]=Mz(l);i=i(s!==void 0?s:e.custom,p,_)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[p,_]=Mz(l);i=i(s!==void 0?s:e.custom,p,_)}return i}function ane(e){for(let i=1;i<e.length;i++)e[i]??(e[i]=e[i-1])}const rv=e=>e*180/Math.PI,_P=e=>{const i=rv(Math.atan2(e[1],e[0]));return yP(i)},lne={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:_P,rotateZ:_P,skewX:e=>rv(Math.atan(e[1])),skewY:e=>rv(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},yP=e=>(e=e%360,e<0&&(e+=360),e),kz=_P,Dz=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Lz=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),cne={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Dz,scaleY:Lz,scale:e=>(Dz(e)+Lz(e))/2,rotateX:e=>yP(rv(Math.atan2(e[6],e[5]))),rotateY:e=>yP(rv(Math.atan2(-e[2],e[0]))),rotateZ:kz,rotate:kz,skewX:e=>rv(Math.atan(e[4])),skewY:e=>rv(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function vP(e){return e.includes("scale")?1:0}function xP(e,i){if(!e||e==="none")return vP(i);const s=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,p;if(s)l=cne,p=s;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=lne,p=t}if(!p)return vP(i);const _=l[i],b=p[1].split(",").map(hne);return typeof _=="function"?_(b):b[_]}const une=(e,i)=>{const{transform:s="none"}=getComputedStyle(e);return xP(s,i)};function hne(e){return parseFloat(e.trim())}const _b=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],yb=new Set(_b),J_=(e,i,s)=>s>i?i:s<e?e:s,vb={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Nw={...vb,transform:e=>J_(0,1,e)},cS={...vb,default:1},Rz=e=>e===vb||e===Ls,dne=new Set(["x","y","z"]),fne=_b.filter(e=>!dne.has(e));function pne(e){const i=[];return fne.forEach(s=>{const l=e.getValue(s);l!==void 0&&(i.push([s,l.get()]),l.set(s.startsWith("scale")?1:0))}),i}const lv={width:({x:e},{paddingLeft:i="0",paddingRight:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),height:({y:e},{paddingTop:i="0",paddingBottom:s="0"})=>e.max-e.min-parseFloat(i)-parseFloat(s),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:(e,{transform:i})=>xP(i,"x"),y:(e,{transform:i})=>xP(i,"y")};lv.translateX=lv.x;lv.translateY=lv.y;const cv=new Set;let bP=!1,wP=!1,TP=!1;function pN(){if(wP){const e=Array.from(cv).filter(l=>l.needsMeasurement),i=new Set(e.map(l=>l.element)),s=new Map;i.forEach(l=>{const p=pne(l);p.length&&(s.set(l,p),l.render())}),e.forEach(l=>l.measureInitialState()),i.forEach(l=>{l.render();const p=s.get(l);p&&p.forEach(([_,b])=>{var t;(t=l.getValue(_))==null||t.set(b)})}),e.forEach(l=>l.measureEndState()),e.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}wP=!1,bP=!1,cv.forEach(e=>e.complete(TP)),cv.clear()}function mN(){cv.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(wP=!0)})}function mne(){TP=!0,mN(),pN(),TP=!1}class GM{constructor(i,s,l,p,_,b=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=s,this.name=l,this.motionValue=p,this.element=_,this.isAsync=b}scheduleResolve(){this.state="scheduled",this.isAsync?(cv.add(this),bP||(bP=!0,ml.read(mN),ml.resolveKeyframes(pN))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:s,element:l,motionValue:p}=this;if(i[0]===null){const _=p?.get(),b=i[i.length-1];if(_!==void 0)i[0]=_;else if(l&&s){const t=l.readValue(s,b);t!=null&&(i[0]=t)}i[0]===void 0&&(i[0]=b),p&&_===void 0&&p.set(i[0])}ane(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),cv.delete(this)}cancel(){this.state==="scheduled"&&(cv.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const gN=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),_N=e=>/^0[^.\s]+$/u.test(e),vw=e=>Math.round(e*1e5)/1e5,qM=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function gne(e){return e==null}const _ne=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,HM=(e,i)=>s=>!!(typeof s=="string"&&_ne.test(s)&&s.startsWith(e)||i&&!gne(s)&&Object.prototype.hasOwnProperty.call(s,i)),yN=(e,i,s)=>l=>{if(typeof l!="string")return l;const[p,_,b,t]=l.match(qM);return{[e]:parseFloat(p),[i]:parseFloat(_),[s]:parseFloat(b),alpha:t!==void 0?parseFloat(t):1}},yne=e=>J_(0,255,e),GC={...vb,transform:e=>Math.round(yne(e))},sv={test:HM("rgb","red"),parse:yN("red","green","blue"),transform:({red:e,green:i,blue:s,alpha:l=1})=>"rgba("+GC.transform(e)+", "+GC.transform(i)+", "+GC.transform(s)+", "+vw(Nw.transform(l))+")"};function vne(e){let i="",s="",l="",p="";return e.length>5?(i=e.substring(1,3),s=e.substring(3,5),l=e.substring(5,7),p=e.substring(7,9)):(i=e.substring(1,2),s=e.substring(2,3),l=e.substring(3,4),p=e.substring(4,5),i+=i,s+=s,l+=l,p+=p),{red:parseInt(i,16),green:parseInt(s,16),blue:parseInt(l,16),alpha:p?parseInt(p,16)/255:1}}const SP={test:HM("#"),parse:vne,transform:sv.transform},Rx={test:HM("hsl","hue"),parse:yN("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:s,alpha:l=1})=>"hsla("+Math.round(e)+", "+Lg.transform(vw(i))+", "+Lg.transform(vw(s))+", "+vw(Nw.transform(l))+")"},Fc={test:e=>sv.test(e)||SP.test(e)||Rx.test(e),parse:e=>sv.test(e)?sv.parse(e):Rx.test(e)?Rx.parse(e):SP.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?sv.transform(e):Rx.transform(e),getAnimatableNone:e=>{const i=Fc.parse(e);return i.alpha=0,Fc.transform(i)}},xne=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function bne(e){var i,s;return isNaN(e)&&typeof e=="string"&&(((i=e.match(qM))==null?void 0:i.length)||0)+(((s=e.match(xne))==null?void 0:s.length)||0)>0}const vN="number",xN="color",wne="var",Tne="var(",zz="${}",Sne=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Vw(e){const i=e.toString(),s=[],l={color:[],number:[],var:[]},p=[];let _=0;const t=i.replace(Sne,P=>(Fc.test(P)?(l.color.push(_),p.push(xN),s.push(Fc.parse(P))):P.startsWith(Tne)?(l.var.push(_),p.push(wne),s.push(P)):(l.number.push(_),p.push(vN),s.push(parseFloat(P))),++_,zz)).split(zz);return{values:s,split:t,indexes:l,types:p}}function bN(e){return Vw(e).values}function wN(e){const{split:i,types:s}=Vw(e),l=i.length;return p=>{let _="";for(let b=0;b<l;b++)if(_+=i[b],p[b]!==void 0){const t=s[b];t===vN?_+=vw(p[b]):t===xN?_+=Fc.transform(p[b]):_+=p[b]}return _}}const Ene=e=>typeof e=="number"?0:Fc.test(e)?Fc.getAnimatableNone(e):e;function Ine(e){const i=bN(e);return wN(e)(i.map(Ene))}const r0={test:bne,parse:bN,createTransformer:wN,getAnimatableNone:Ine},Cne={test:e=>e==="auto",parse:e=>e},TN=e=>i=>i.test(e),SN=[vb,Ls,Lg,Zy,tie,eie,Cne],Oz=e=>SN.find(TN(e)),Ane=[...SN,Fc,r0],Pne=e=>Ane.find(TN(e)),Mne=new Set(["brightness","contrast","saturate","opacity"]);function kne(e){const[i,s]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[l]=s.match(qM)||[];if(!l)return e;const p=s.replace(l,"");let _=Mne.has(i)?1:0;return l!==s&&(_*=100),i+"("+_+p+")"}const Dne=/\b([a-z-]*)\(.*?\)/gu,EP={...r0,getAnimatableNone:e=>{const i=e.match(Dne);return i?i.map(kne).join(" "):e}},Fz={...vb,transform:Math.round},Lne={rotate:Zy,rotateX:Zy,rotateY:Zy,rotateZ:Zy,scale:cS,scaleX:cS,scaleY:cS,scaleZ:cS,skew:Zy,skewX:Zy,skewY:Zy,distance:Ls,translateX:Ls,translateY:Ls,translateZ:Ls,x:Ls,y:Ls,z:Ls,perspective:Ls,transformPerspective:Ls,opacity:Nw,originX:xz,originY:xz,originZ:Ls},WM={borderWidth:Ls,borderTopWidth:Ls,borderRightWidth:Ls,borderBottomWidth:Ls,borderLeftWidth:Ls,borderRadius:Ls,radius:Ls,borderTopLeftRadius:Ls,borderTopRightRadius:Ls,borderBottomRightRadius:Ls,borderBottomLeftRadius:Ls,width:Ls,maxWidth:Ls,height:Ls,maxHeight:Ls,top:Ls,right:Ls,bottom:Ls,left:Ls,padding:Ls,paddingTop:Ls,paddingRight:Ls,paddingBottom:Ls,paddingLeft:Ls,margin:Ls,marginTop:Ls,marginRight:Ls,marginBottom:Ls,marginLeft:Ls,backgroundPositionX:Ls,backgroundPositionY:Ls,...Lne,zIndex:Fz,fillOpacity:Nw,strokeOpacity:Nw,numOctaves:Fz},Rne={...WM,color:Fc,backgroundColor:Fc,outlineColor:Fc,fill:Fc,stroke:Fc,borderColor:Fc,borderTopColor:Fc,borderRightColor:Fc,borderBottomColor:Fc,borderLeftColor:Fc,filter:EP,WebkitFilter:EP},EN=e=>Rne[e];function IN(e,i){let s=EN(e);return s!==EP&&(s=r0),s.getAnimatableNone?s.getAnimatableNone(i):void 0}const{schedule:CN}=eN(queueMicrotask,!0),Bz=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class AN{scrapeMotionValuesFromProps(i,s,l){return{}}constructor({parent:i,props:s,presenceContext:l,reducedMotionConfig:p,blockInitialAnimation:_,visualState:b},t={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=GM,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const W=jd.now();this.renderScheduledAt<W&&(this.renderScheduledAt=W,ml.render(this.render,!1,!0))};const{latestValues:P,renderState:O}=b;this.latestValues=P,this.baseTarget={...P},this.initialValues=s.initial?{...P}:{},this.renderState=O,this.parent=i,this.props=s,this.presenceContext=l,this.depth=i?i.depth+1:0,this.reducedMotionConfig=p,this.options=t,this.blockInitialAnimation=!!_,this.isControllingVariants=hN(s),this.isVariantNode=nne(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:F,...$}=this.scrapeMotionValuesFromProps(s,{},this);for(const W in $){const Y=$[W];P[W]!==void 0&&Vc(Y)&&Y.set(P[W])}}mount(i){var s;this.current=i,_v.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,p)=>this.bindToMotionValue(p,l)),uN.current||Jie(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:wE.current,(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var i;this.projection&&this.projection.unmount(),K_(this.notifyUpdate),K_(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(i=this.parent)==null||i.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const l=this.features[s];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,s){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const l=yb.has(i);l&&this.onBindTransform&&this.onBindTransform();const p=s.on("change",b=>{this.latestValues[i]=b,this.props.onUpdate&&ml.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let _;window.MotionCheckAppearSync&&(_=window.MotionCheckAppearSync(this,i,s)),this.valueSubscriptions.set(i,()=>{p(),_&&_(),s.owner&&s.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in gP){const s=gP[i];if(!s)continue;const{isEnabled:l,Feature:p}=s;if(!this.features[i]&&p&&l(this.props)&&(this.features[i]=new p(this)),this.features[i]){const _=this.features[i];_.isMounted?_.update():(_.mount(),_.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):yc()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,s){this.latestValues[i]=s}update(i,s){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let l=0;l<Bz.length;l++){const p=Bz[l];this.propEventSubscriptions[p]&&(this.propEventSubscriptions[p](),delete this.propEventSubscriptions[p]);const _="on"+p,b=i[_];b&&(this.propEventSubscriptions[p]=this.on(p,b))}this.prevMotionValues=one(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(i),()=>s.variantChildren.delete(i)}addValue(i,s){const l=this.values.get(i);s!==l&&(l&&this.removeValue(i),this.bindToMotionValue(i,s),this.values.set(i,s),this.latestValues[i]=s.get())}removeValue(i){this.values.delete(i);const s=this.valueSubscriptions.get(i);s&&(s(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,s){if(this.props.values&&this.props.values[i])return this.props.values[i];let l=this.values.get(i);return l===void 0&&s!==void 0&&(l=rb(s===null?void 0:s,{owner:this}),this.addValue(i,l)),l}readValue(i,s){let l=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return l!=null&&(typeof l=="string"&&(gN(l)||_N(l))?l=parseFloat(l):!Pne(l)&&r0.test(s)&&(l=IN(i,s)),this.setBaseTarget(i,Vc(l)?l.get():l)),Vc(l)?l.get():l}setBaseTarget(i,s){this.baseTarget[i]=s}getBaseTarget(i){var s;const{initial:l}=this.props;let p;if(typeof l=="string"||typeof l=="object"){const b=fN(this.props,l,(s=this.presenceContext)==null?void 0:s.custom);b&&(p=b[i])}if(l&&p!==void 0)return p;const _=this.getBaseTargetFromProps(this.props,i);return _!==void 0&&!Vc(_)?_:this.initialValues[i]!==void 0&&p===void 0?void 0:this.baseTarget[i]}on(i,s){return this.events[i]||(this.events[i]=new $M),this.events[i].add(s)}notify(i,...s){this.events[i]&&this.events[i].notify(...s)}scheduleRenderMicrotask(){CN.render(this.render)}}const PN=new Set(["width","height","top","left","right","bottom",..._b]);let ZM=()=>{};const zne=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function One(e){const i=zne.exec(e);if(!i)return[,];const[,s,l,p]=i;return[`--${s??l}`,p]}function MN(e,i,s=1){const[l,p]=One(e);if(!l)return;const _=window.getComputedStyle(i).getPropertyValue(l);if(_){const b=_.trim();return gN(b)?parseFloat(b):b}return FM(p)?MN(p,i,s+1):p}function Fne(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||_N(e):!0}const Bne=new Set(["auto","none","0"]);function Nne(e,i,s){let l=0,p;for(;l<e.length&&!p;){const _=e[l];typeof _=="string"&&!Bne.has(_)&&Vw(_).values.length&&(p=e[l]),l++}if(p&&s)for(const _ of i)e[_]=IN(s,p)}class Vne extends GM{constructor(i,s,l,p,_){super(i,s,l,p,_,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:s,name:l}=this;if(!s||!s.current)return;super.readKeyframes();for(let P=0;P<i.length;P++){let O=i[P];if(typeof O=="string"&&(O=O.trim(),FM(O))){const F=MN(O,s.current);F!==void 0&&(i[P]=F),P===i.length-1&&(this.finalKeyframe=O)}}if(this.resolveNoneKeyframes(),!PN.has(l)||i.length!==2)return;const[p,_]=i,b=Oz(p),t=Oz(_);if(b!==t)if(Rz(b)&&Rz(t))for(let P=0;P<i.length;P++){const O=i[P];typeof O=="string"&&(i[P]=parseFloat(O))}else lv[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:s}=this,l=[];for(let p=0;p<i.length;p++)(i[p]===null||Fne(i[p]))&&l.push(p);l.length&&Nne(i,l,s)}measureInitialState(){const{element:i,unresolvedKeyframes:s,name:l}=this;if(!i||!i.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=lv[l](i.measureViewportBox(),window.getComputedStyle(i.current)),s[0]=this.measuredOrigin;const p=s[s.length-1];p!==void 0&&i.getValue(l,p).jump(p,!1)}measureEndState(){var i;const{element:s,name:l,unresolvedKeyframes:p}=this;if(!s||!s.current)return;const _=s.getValue(l);_&&_.jump(this.measuredOrigin,!1);const b=p.length-1,t=p[b];p[b]=lv[l](s.measureViewportBox(),window.getComputedStyle(s.current)),t!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=t),(i=this.removedTransforms)!=null&&i.length&&this.removedTransforms.forEach(([P,O])=>{s.getValue(P).set(O)}),this.resolveNoneKeyframes()}}class kN extends AN{constructor(){super(...arguments),this.KeyframeResolver=Vne}sortInstanceNodePosition(i,s){return i.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(i,s){return i.style?i.style[s]:void 0}removeValueFromRenderState(i,{vars:s,style:l}){delete s[i],delete l[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;Vc(i)&&(this.childSubscription=i.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}const DN=(e,i)=>i&&typeof e=="number"?i.transform(e):e,jne={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Une=_b.length;function $ne(e,i,s){let l="",p=!0;for(let _=0;_<Une;_++){const b=_b[_],t=e[b];if(t===void 0)continue;let P=!0;if(typeof t=="number"?P=t===(b.startsWith("scale")?1:0):P=parseFloat(t)===0,!P||s){const O=DN(t,WM[b]);if(!P){p=!1;const F=jne[b]||b;l+=`${F}(${O}) `}s&&(i[b]=O)}}return l=l.trim(),s?l=s(i,p?"":l):p&&(l="none"),l}function LN(e,i,s){const{style:l,vars:p,transformOrigin:_}=e;let b=!1,t=!1;for(const P in i){const O=i[P];if(yb.has(P)){b=!0;continue}else if(OM(P)){p[P]=O;continue}else{const F=DN(O,WM[P]);P.startsWith("origin")?(t=!0,_[P]=F):l[P]=F}}if(i.transform||(b||s?l.transform=$ne(i,e.transform,s):l.transform&&(l.transform="none")),t){const{originX:P="50%",originY:O="50%",originZ:F=0}=_;l.transformOrigin=`${P} ${O} ${F}`}}function RN(e,{style:i,vars:s},l,p){const _=e.style;let b;for(b in i)_[b]=i[b];p?.applyProjectionStyles(_,l);for(b in s)_.setProperty(b,s[b])}function Gne(e,{layout:i,layoutId:s}){return yb.has(e)||e.startsWith("origin")||(i||s!==void 0)&&(!!Bw[e]||e==="opacity")}function zN(e,i,s){var l;const{style:p}=e,_={};for(const b in p)(Vc(p[b])||i.style&&Vc(i.style[b])||Gne(b,e)||((l=s?.getValue(b))==null?void 0:l.liveStyle)!==void 0)&&(_[b]=p[b]);return _}function qne(e){return window.getComputedStyle(e)}class ON extends kN{constructor(){super(...arguments),this.type="html",this.renderInstance=RN}readValueFromInstance(i,s){var l;if(yb.has(s))return(l=this.projection)!=null&&l.isProjecting?vP(s):une(i,s);{const p=qne(i),_=(OM(s)?p.getPropertyValue(s):p[s])||0;return typeof _=="string"?_.trim():_}}measureInstanceViewportBox(i,{transformPagePoint:s}){return Yie(i,s)}build(i,s,l){LN(i,s,l.transformTemplate)}scrapeMotionValuesFromProps(i,s,l){return zN(i,s,l)}}const XM=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Hne={offset:"stroke-dashoffset",array:"stroke-dasharray"},Wne={offset:"strokeDashoffset",array:"strokeDasharray"};function Zne(e,i,s=1,l=0,p=!0){e.pathLength=1;const _=p?Hne:Wne;e[_.offset]=Ls.transform(-l);const b=Ls.transform(i),t=Ls.transform(s);e[_.array]=`${b} ${t}`}function Xne(e,{attrX:i,attrY:s,attrScale:l,pathLength:p,pathSpacing:_=1,pathOffset:b=0,...t},P,O,F){if(LN(e,t,O),P){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:$,style:W}=e;$.transform&&(W.transform=$.transform,delete $.transform),(W.transform||$.transformOrigin)&&(W.transformOrigin=$.transformOrigin??"50% 50%",delete $.transformOrigin),W.transform&&(W.transformBox=F?.transformBox??"fill-box",delete $.transformBox),i!==void 0&&($.x=i),s!==void 0&&($.y=s),l!==void 0&&($.scale=l),p!==void 0&&Zne($,p,_,b,!1)}const FN=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),Yne=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Kne(e,i,s,l){RN(e,i,void 0,l);for(const p in i.attrs)e.setAttribute(FN.has(p)?p:XM(p),i.attrs[p])}function Jne(e,i,s){const l=zN(e,i,s);for(const p in e)if(Vc(e[p])||Vc(i[p])){const _=_b.indexOf(p)!==-1?"attr"+p.charAt(0).toUpperCase()+p.substring(1):p;l[_]=e[p]}return l}class BN extends kN{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=yc}getBaseTargetFromProps(i,s){return i[s]}readValueFromInstance(i,s){if(yb.has(s)){const l=EN(s);return l&&l.default||0}return s=FN.has(s)?s:XM(s),i.getAttribute(s)}scrapeMotionValuesFromProps(i,s,l){return Jne(i,s,l)}build(i,s,l){Xne(i,s,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(i,s,l,p){Kne(i,s,l,p)}mount(i){this.isSVGTag=Yne(i.tagName),super.mount(i)}}function Qne(e,i){return nN(e)?new BN(i):new ON(i)}function ere(e,i,s,l=0,p=1){const _=Array.from(e),b=_.indexOf(i),t=e.size,P=(t-1)*l,O=typeof s=="function";return b===_.length-1&&(i.parent.enteringChildren=void 0),O?s(b,t):p===1?b*l:P-b*l}function YM(e){return typeof e=="object"&&!Array.isArray(e)}function KM(e,i,s){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let l=document;const p=s?.[e]??l.querySelectorAll(e);return p?Array.from(p):[]}return Array.from(e)}function NN(e,i,s,l){return typeof e=="string"&&YM(i)?KM(e,s,l):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function tre(e,i,s){return e*(i+1)}function Nz(e,i,s,l){return typeof i=="number"?i:i.startsWith("-")||i.startsWith("+")?Math.max(0,e+parseFloat(i)):i==="<"?s:i.startsWith("<")?Math.max(0,s+parseFloat(i.slice(1))):l.get(i)??e}const zl=(e,i,s)=>e+(i-e)*s,ire=(e,i,s)=>{const l=i-e;return((s-e)%l+l)%l+e},VN=e=>Array.isArray(e)&&typeof e[0]!="number";function jN(e,i){return VN(e)?e[ire(0,e.length,i)]:e}function nre(e,i,s){for(let l=0;l<e.length;l++){const p=e[l];p.at>i&&p.at<s&&(fI(e,p),l--)}}function rre(e,i,s,l,p,_){nre(e,p,_);for(let b=0;b<i.length;b++)e.push({value:i[b],at:zl(p,_,l[b]),easing:jN(s,b)})}function sre(e,i){for(let s=0;s<e.length;s++)e[s]=e[s]/(i+1)}function ore(e,i){return e.at===i.at?e.value===null?1:i.value===null?-1:0:e.at-i.at}const sb=(e,i,s)=>{const l=i-e;return l===0?1:(s-e)/l};function UN(e,i){const s=e[e.length-1];for(let l=1;l<=i;l++){const p=sb(0,i,l);e.push(zl(s,1,p))}}function $N(e){const i=[0];return UN(i,e.length-1),i}const TE=2e4;function JM(e){let i=0;const s=50;let l=e.next(i);for(;!l.done&&i<TE;)i+=s,l=e.next(i);return i>=TE?1/0:i}function GN(e,i=100,s){const l=s({...e,keyframes:[0,i]}),p=Math.min(JM(l),TE);return{type:"keyframes",ease:_=>l.next(p*_).value/i,duration:Dg(p)}}function QM(e){return typeof e=="function"&&"applyToOptions"in e}const are="easeInOut";function lre(e,{defaultTransition:i={},...s}={},l,p){const _=i.duration||.3,b=new Map,t=new Map,P={},O=new Map;let F=0,$=0,W=0;for(let Y=0;Y<e.length;Y++){const ae=e[Y];if(typeof ae=="string"){O.set(ae,$);continue}else if(!Array.isArray(ae)){O.set(ae.name,Nz($,ae.at,F,O));continue}let[se,ie,pe={}]=ae;pe.at!==void 0&&($=Nz($,pe.at,F,O));let ye=0;const de=(Ee,Pe,Ze,We=0,je=0)=>{const Ye=cre(Ee),{delay:ct=0,times:Lt=$N(Ye),type:Ht="keyframes",repeat:ci,repeatType:Wt,repeatDelay:$t=0,...Dt}=Pe;let{ease:Ft=i.ease||"easeOut",duration:vt}=Pe;const wi=typeof ct=="function"?ct(We,je):ct,Qi=Ye.length,wn=QM(Ht)?Ht:p?.[Ht||"keyframes"];if(Qi<=2&&wn){let Sr=100;if(Qi===2&&dre(Ye)){const sn=Ye[1]-Ye[0];Sr=Math.abs(sn)}const Hr={...Dt};vt!==void 0&&(Hr.duration=Em(vt));const ti=GN(Hr,Sr,wn);Ft=ti.ease,vt=ti.duration}vt??(vt=_);const qn=$+wi;Lt.length===1&&Lt[0]===0&&(Lt[1]=1);const Fn=Lt.length-Ye.length;if(Fn>0&&UN(Lt,Fn),Ye.length===1&&Ye.unshift(null),ci){vt=tre(vt,ci);const Sr=[...Ye],Hr=[...Lt];Ft=Array.isArray(Ft)?[...Ft]:[Ft];const ti=[...Ft];for(let sn=0;sn<ci;sn++){Ye.push(...Sr);for(let Gi=0;Gi<Sr.length;Gi++)Lt.push(Hr[Gi]+(sn+1)),Ft.push(Gi===0?"linear":jN(ti,Gi-1))}sre(Lt,ci)}const mr=qn+vt;rre(Ze,Ye,Ft,Lt,qn,mr),ye=Math.max(wi+vt,ye),W=Math.max(mr,W)};if(Vc(se)){const Ee=Vz(se,t);de(ie,pe,jz("default",Ee))}else{const Ee=NN(se,ie,l,P),Pe=Ee.length;for(let Ze=0;Ze<Pe;Ze++){ie=ie,pe=pe;const We=Ee[Ze],je=Vz(We,t);for(const Ye in ie)de(ie[Ye],ure(pe,Ye),jz(Ye,je),Ze,Pe)}}F=$,$+=ye}return t.forEach((Y,ae)=>{for(const se in Y){const ie=Y[se];ie.sort(ore);const pe=[],ye=[],de=[];for(let Pe=0;Pe<ie.length;Pe++){const{at:Ze,value:We,easing:je}=ie[Pe];pe.push(We),ye.push(sb(0,W,Ze)),de.push(je||"easeOut")}ye[0]!==0&&(ye.unshift(0),pe.unshift(pe[0]),de.unshift(are)),ye[ye.length-1]!==1&&(ye.push(1),pe.push(null)),b.has(ae)||b.set(ae,{keyframes:{},transition:{}});const Ee=b.get(ae);Ee.keyframes[se]=pe,Ee.transition[se]={...i,duration:W,ease:de,times:ye,...s}}}),b}function Vz(e,i){return!i.has(e)&&i.set(e,{}),i.get(e)}function jz(e,i){return i[e]||(i[e]=[]),i[e]}function cre(e){return Array.isArray(e)?e:[e]}function ure(e,i){return e&&e[i]?{...e,...e[i]}:{...e}}const hre=e=>typeof e=="number",dre=e=>e.every(hre),fre=e=>Array.isArray(e);function pre(e,i,s){const l=e.getProps();return fN(l,i,l.custom,e)}function mre(e,i,s){e.hasValue(i)?e.getValue(i).set(s):e.addValue(i,rb(s))}function gre(e){return fre(e)?e[e.length-1]||0:e}function _re(e,i){const s=pre(e,i);let{transitionEnd:l={},transition:p={},..._}=s||{};_={..._,...l};for(const b in _){const t=gre(_[b]);mre(e,b,t)}}function yre(e){return!!(Vc(e)&&e.add)}function vre(e,i){const s=e.getValue("willChange");if(yre(s))return s.add(i);if(!s&&Y_.WillChange){const l=new Y_.WillChange("auto");e.addValue("willChange",l),l.add(i)}}const xre="framerAppearId",bre="data-"+XM(xre);function qN(e){return e.props[bre]}const wre=e=>e!==null;function Tre(e,{repeat:i,repeatType:s="loop"},l){const p=e.filter(wre),_=i&&s!=="loop"&&i%2===1?0:p.length-1;return p[_]}const Sre={type:"spring",stiffness:500,damping:25,restSpeed:10},Ere=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Ire={type:"keyframes",duration:.8},Cre={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Are=(e,{keyframes:i})=>i.length>2?Ire:yb.has(e)?e.startsWith("scale")?Ere(i[1]):Sre:Cre;function Pre({when:e,delay:i,delayChildren:s,staggerChildren:l,staggerDirection:p,repeat:_,repeatType:b,repeatDelay:t,from:P,elapsed:O,...F}){return!!Object.keys(F).length}function ek(e,i){return e?.[i]??e?.default??e}function IP(e){e.duration=0,e.type}function qC(e,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(i-e)*6*s:s<1/2?i:s<2/3?e+(i-e)*(2/3-s)*6:e}function Mre({hue:e,saturation:i,lightness:s,alpha:l}){e/=360,i/=100,s/=100;let p=0,_=0,b=0;if(!i)p=_=b=s;else{const t=s<.5?s*(1+i):s+i-s*i,P=2*s-t;p=qC(P,t,e+1/3),_=qC(P,t,e),b=qC(P,t,e-1/3)}return{red:Math.round(p*255),green:Math.round(_*255),blue:Math.round(b*255),alpha:l}}function SE(e,i){return s=>s>0?i:e}const HC=(e,i,s)=>{const l=e*e,p=s*(i*i-l)+l;return p<0?0:Math.sqrt(p)},kre=[SP,sv,Rx],Dre=e=>kre.find(i=>i.test(e));function Uz(e){const i=Dre(e);if(!i)return!1;let s=i.parse(e);return i===Rx&&(s=Mre(s)),s}const $z=(e,i)=>{const s=Uz(e),l=Uz(i);if(!s||!l)return SE(e,i);const p={...s};return _=>(p.red=HC(s.red,l.red,_),p.green=HC(s.green,l.green,_),p.blue=HC(s.blue,l.blue,_),p.alpha=zl(s.alpha,l.alpha,_),sv.transform(p))},CP=new Set(["none","hidden"]);function Lre(e,i){return CP.has(e)?s=>s<=0?e:i:s=>s>=1?i:e}const Rre=(e,i)=>s=>i(e(s)),o2=(...e)=>e.reduce(Rre);function zre(e,i){return s=>zl(e,i,s)}function tk(e){return typeof e=="number"?zre:typeof e=="string"?FM(e)?SE:Fc.test(e)?$z:Bre:Array.isArray(e)?HN:typeof e=="object"?Fc.test(e)?$z:Ore:SE}function HN(e,i){const s=[...e],l=s.length,p=e.map((_,b)=>tk(_)(_,i[b]));return _=>{for(let b=0;b<l;b++)s[b]=p[b](_);return s}}function Ore(e,i){const s={...e,...i},l={};for(const p in s)e[p]!==void 0&&i[p]!==void 0&&(l[p]=tk(e[p])(e[p],i[p]));return p=>{for(const _ in l)s[_]=l[_](p);return s}}function Fre(e,i){const s=[],l={color:0,var:0,number:0};for(let p=0;p<i.values.length;p++){const _=i.types[p],b=e.indexes[_][l[_]],t=e.values[b]??0;s[p]=t,l[_]++}return s}const Bre=(e,i)=>{const s=r0.createTransformer(i),l=Vw(e),p=Vw(i);return l.indexes.var.length===p.indexes.var.length&&l.indexes.color.length===p.indexes.color.length&&l.indexes.number.length>=p.indexes.number.length?CP.has(e)&&!p.values.length||CP.has(i)&&!l.values.length?Lre(e,i):o2(HN(Fre(l,p),p.values),s):SE(e,i)};function WN(e,i,s){return typeof e=="number"&&typeof i=="number"&&typeof s=="number"?zl(e,i,s):tk(e)(e,i)}const Nre=e=>{const i=({timestamp:s})=>e(s);return{start:(s=!0)=>ml.update(i,s),stop:()=>K_(i),now:()=>Gu.isProcessing?Gu.timestamp:jd.now()}},ZN=(e,i,s=10)=>{let l="";const p=Math.max(Math.round(i/s),2);for(let _=0;_<p;_++)l+=Math.round(e(_/(p-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},Vre=5;function XN(e,i,s){const l=Math.max(i-Vre,0);return dN(s-e(l),i-l)}const lc={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},WC=.001;function jre({duration:e=lc.duration,bounce:i=lc.bounce,velocity:s=lc.velocity,mass:l=lc.mass}){let p,_,b=1-i;b=J_(lc.minDamping,lc.maxDamping,b),e=J_(lc.minDuration,lc.maxDuration,Dg(e)),b<1?(p=O=>{const F=O*b,$=F*e,W=F-s,Y=AP(O,b),ae=Math.exp(-$);return WC-W/Y*ae},_=O=>{const $=O*b*e,W=$*s+s,Y=Math.pow(b,2)*Math.pow(O,2)*e,ae=Math.exp(-$),se=AP(Math.pow(O,2),b);return(-p(O)+WC>0?-1:1)*((W-Y)*ae)/se}):(p=O=>{const F=Math.exp(-O*e),$=(O-s)*e+1;return-WC+F*$},_=O=>{const F=Math.exp(-O*e),$=(s-O)*(e*e);return F*$});const t=5/e,P=$re(p,_,t);if(e=Em(e),isNaN(P))return{stiffness:lc.stiffness,damping:lc.damping,duration:e};{const O=Math.pow(P,2)*l;return{stiffness:O,damping:b*2*Math.sqrt(l*O),duration:e}}}const Ure=12;function $re(e,i,s){let l=s;for(let p=1;p<Ure;p++)l=l-e(l)/i(l);return l}function AP(e,i){return e*Math.sqrt(1-i*i)}const Gre=["duration","bounce"],qre=["stiffness","damping","mass"];function Gz(e,i){return i.some(s=>e[s]!==void 0)}function Hre(e){let i={velocity:lc.velocity,stiffness:lc.stiffness,damping:lc.damping,mass:lc.mass,isResolvedFromDuration:!1,...e};if(!Gz(e,qre)&&Gz(e,Gre))if(e.visualDuration){const s=e.visualDuration,l=2*Math.PI/(s*1.2),p=l*l,_=2*J_(.05,1,1-(e.bounce||0))*Math.sqrt(p);i={...i,mass:lc.mass,stiffness:p,damping:_}}else{const s=jre(e);i={...i,...s,mass:lc.mass},i.isResolvedFromDuration=!0}return i}function jw(e=lc.visualDuration,i=lc.bounce){const s=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:l,restDelta:p}=s;const _=s.keyframes[0],b=s.keyframes[s.keyframes.length-1],t={done:!1,value:_},{stiffness:P,damping:O,mass:F,duration:$,velocity:W,isResolvedFromDuration:Y}=Hre({...s,velocity:-Dg(s.velocity||0)}),ae=W||0,se=O/(2*Math.sqrt(P*F)),ie=b-_,pe=Dg(Math.sqrt(P/F)),ye=Math.abs(ie)<5;l||(l=ye?lc.restSpeed.granular:lc.restSpeed.default),p||(p=ye?lc.restDelta.granular:lc.restDelta.default);let de;if(se<1){const Pe=AP(pe,se);de=Ze=>{const We=Math.exp(-se*pe*Ze);return b-We*((ae+se*pe*ie)/Pe*Math.sin(Pe*Ze)+ie*Math.cos(Pe*Ze))}}else if(se===1)de=Pe=>b-Math.exp(-pe*Pe)*(ie+(ae+pe*ie)*Pe);else{const Pe=pe*Math.sqrt(se*se-1);de=Ze=>{const We=Math.exp(-se*pe*Ze),je=Math.min(Pe*Ze,300);return b-We*((ae+se*pe*ie)*Math.sinh(je)+Pe*ie*Math.cosh(je))/Pe}}const Ee={calculatedDuration:Y&&$||null,next:Pe=>{const Ze=de(Pe);if(Y)t.done=Pe>=$;else{let We=Pe===0?ae:0;se<1&&(We=Pe===0?Em(ae):XN(de,Pe,Ze));const je=Math.abs(We)<=l,Ye=Math.abs(b-Ze)<=p;t.done=je&&Ye}return t.value=t.done?b:Ze,t},toString:()=>{const Pe=Math.min(JM(Ee),TE),Ze=ZN(We=>Ee.next(Pe*We).value,Pe,30);return Pe+"ms "+Ze},toTransition:()=>{}};return Ee}jw.applyToOptions=e=>{const i=GN(e,100,jw);return e.ease=i.ease,e.duration=Em(i.duration),e.type="keyframes",e};function PP({keyframes:e,velocity:i=0,power:s=.8,timeConstant:l=325,bounceDamping:p=10,bounceStiffness:_=500,modifyTarget:b,min:t,max:P,restDelta:O=.5,restSpeed:F}){const $=e[0],W={done:!1,value:$},Y=je=>t!==void 0&&je<t||P!==void 0&&je>P,ae=je=>t===void 0?P:P===void 0||Math.abs(t-je)<Math.abs(P-je)?t:P;let se=s*i;const ie=$+se,pe=b===void 0?ie:b(ie);pe!==ie&&(se=pe-$);const ye=je=>-se*Math.exp(-je/l),de=je=>pe+ye(je),Ee=je=>{const Ye=ye(je),ct=de(je);W.done=Math.abs(Ye)<=O,W.value=W.done?pe:ct};let Pe,Ze;const We=je=>{Y(W.value)&&(Pe=je,Ze=jw({keyframes:[W.value,ae(W.value)],velocity:XN(de,je,W.value),damping:p,stiffness:_,restDelta:O,restSpeed:F}))};return We(0),{calculatedDuration:null,next:je=>{let Ye=!1;return!Ze&&Pe===void 0&&(Ye=!0,Ee(je),We(je)),Pe!==void 0&&je>=Pe?Ze.next(je-Pe):(!Ye&&Ee(je),W)}}}function Wre(e,i,s){const l=[],p=s||Y_.mix||WN,_=e.length-1;for(let b=0;b<_;b++){let t=p(e[b],e[b+1]);if(i){const P=Array.isArray(i)?i[b]||qd:i;t=o2(P,t)}l.push(t)}return l}function Zre(e,i,{clamp:s=!0,ease:l,mixer:p}={}){const _=e.length;if(ZM(_===i.length),_===1)return()=>i[0];if(_===2&&i[0]===i[1])return()=>i[1];const b=e[0]===e[1];e[0]>e[_-1]&&(e=[...e].reverse(),i=[...i].reverse());const t=Wre(i,l,p),P=t.length,O=F=>{if(b&&F<e[0])return i[0];let $=0;if(P>1)for(;$<e.length-2&&!(F<e[$+1]);$++);const W=sb(e[$],e[$+1],F);return t[$](W)};return s?F=>O(J_(e[0],e[_-1],F)):O}function Xre(e,i){return e.map(s=>s*i)}const YN=(e,i,s)=>(((1-3*s+3*i)*e+(3*s-6*i))*e+3*i)*e,Yre=1e-7,Kre=12;function Jre(e,i,s,l,p){let _,b,t=0;do b=i+(s-i)/2,_=YN(b,l,p)-e,_>0?s=b:i=b;while(Math.abs(_)>Yre&&++t<Kre);return b}function a2(e,i,s,l){if(e===i&&s===l)return qd;const p=_=>Jre(_,0,1,e,s);return _=>_===0||_===1?_:YN(p(_),i,l)}const Qre=a2(.42,0,1,1),ese=a2(0,0,.58,1),KN=a2(.42,0,.58,1),JN=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,QN=e=>i=>1-e(1-i),eV=a2(.33,1.53,.69,.99),ik=QN(eV),tV=JN(ik),iV=e=>(e*=2)<1?.5*ik(e):.5*(2-Math.pow(2,-10*(e-1))),nk=e=>1-Math.sin(Math.acos(e)),nV=QN(nk),rV=JN(nk),sV=e=>Array.isArray(e)&&typeof e[0]=="number",tse={linear:qd,easeIn:Qre,easeInOut:KN,easeOut:ese,circIn:nk,circInOut:rV,circOut:nV,backIn:ik,backInOut:tV,backOut:eV,anticipate:iV},ise=e=>typeof e=="string",qz=e=>{if(sV(e)){ZM(e.length===4);const[i,s,l,p]=e;return a2(i,s,l,p)}else if(ise(e))return tse[e];return e};function nse(e,i){return e.map(()=>i||KN).splice(0,e.length-1)}function xw({duration:e=300,keyframes:i,times:s,ease:l="easeInOut"}){const p=VN(l)?l.map(qz):qz(l),_={done:!1,value:i[0]},b=Xre(s&&s.length===i.length?s:$N(i),e),t=Zre(b,i,{ease:Array.isArray(p)?p:nse(i,p)});return{calculatedDuration:e,next:P=>(_.value=t(P),_.done=P>=e,_)}}const rse=e=>e!==null;function rk(e,{repeat:i,repeatType:s="loop"},l,p=1){const _=e.filter(rse),t=p<0||i&&s!=="loop"&&i%2===1?0:_.length-1;return!t||l===void 0?_[t]:l}const sse={decay:PP,inertia:PP,tween:xw,keyframes:xw,spring:jw};function oV(e){typeof e.type=="string"&&(e.type=sse[e.type])}class sk{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,s){return this.finished.then(i,s)}}const ose=e=>e/100;class ok extends sk{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var s,l;const{motionValue:p}=this.options;p&&p.updatedAt!==jd.now()&&this.tick(jd.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(l=(s=this.options).onStop)==null||l.call(s))},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;oV(i);const{type:s=xw,repeat:l=0,repeatDelay:p=0,repeatType:_,velocity:b=0}=i;let{keyframes:t}=i;const P=s||xw;P!==xw&&typeof t[0]!="number"&&(this.mixKeyframes=o2(ose,WN(t[0],t[1])),t=[0,100]);const O=P({...i,keyframes:t});_==="mirror"&&(this.mirroredGenerator=P({...i,keyframes:[...t].reverse(),velocity:-b})),O.calculatedDuration===null&&(O.calculatedDuration=JM(O));const{calculatedDuration:F}=O;this.calculatedDuration=F,this.resolvedDuration=F+p,this.totalDuration=this.resolvedDuration*(l+1)-p,this.generator=O}updateTime(i){const s=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(i,s=!1){const{generator:l,totalDuration:p,mixKeyframes:_,mirroredGenerator:b,resolvedDuration:t,calculatedDuration:P}=this;if(this.startTime===null)return l.next(0);const{delay:O=0,keyframes:F,repeat:$,repeatType:W,repeatDelay:Y,type:ae,onUpdate:se,finalKeyframe:ie}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-p/this.speed,this.startTime)),s?this.currentTime=i:this.updateTime(i);const pe=this.currentTime-O*(this.playbackSpeed>=0?1:-1),ye=this.playbackSpeed>=0?pe<0:pe>p;this.currentTime=Math.max(pe,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=p);let de=this.currentTime,Ee=l;if($){const je=Math.min(this.currentTime,p)/t;let Ye=Math.floor(je),ct=je%1;!ct&&je>=1&&(ct=1),ct===1&&Ye--,Ye=Math.min(Ye,$+1),Ye%2&&(W==="reverse"?(ct=1-ct,Y&&(ct-=Y/t)):W==="mirror"&&(Ee=b)),de=J_(0,1,ct)*t}const Pe=ye?{done:!1,value:F[0]}:Ee.next(de);_&&(Pe.value=_(Pe.value));let{done:Ze}=Pe;!ye&&P!==null&&(Ze=this.playbackSpeed>=0?this.currentTime>=p:this.currentTime<=0);const We=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ze);return We&&ae!==PP&&(Pe.value=rk(F,this.options,ie,this.speed)),se&&se(Pe.value),We&&this.finish(),Pe}then(i,s){return this.finished.then(i,s)}get duration(){return Dg(this.calculatedDuration)}get time(){return Dg(this.currentTime)}set time(i){var s;i=Em(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(jd.now());const s=this.playbackSpeed!==i;this.playbackSpeed=i,s&&(this.time=Dg(this.currentTime))}play(){var i,s;if(this.isStopped)return;const{driver:l=Nre,startTime:p}=this.options;this.driver||(this.driver=l(b=>this.tick(b))),(s=(i=this.options).onPlay)==null||s.call(i);const _=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=_):this.holdTime!==null?this.startTime=_-this.holdTime:this.startTime||(this.startTime=p??_),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(jd.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var i,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(i=this.options).onComplete)==null||s.call(i)}cancel(){var i,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(i=this.options).onCancel)==null||s.call(i)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),i.observe(this)}}const ase=e=>e.startsWith("--");function lse(e,i,s){ase(i)?e.style.setProperty(i,s):e.style[i]=s}function ak(e){let i;return()=>(i===void 0&&(i=e()),i)}const cse=ak(()=>window.ScrollTimeline!==void 0),use={};function hse(e,i){const s=ak(e);return()=>use[i]??s()}const aV=hse(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),tw=([e,i,s,l])=>`cubic-bezier(${e}, ${i}, ${s}, ${l})`,Hz={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:tw([0,.65,.55,1]),circOut:tw([.55,0,1,.45]),backIn:tw([.31,.01,.66,-.59]),backOut:tw([.33,1.53,.69,.99])};function lV(e,i){if(e)return typeof e=="function"?aV()?ZN(e,i):"ease-out":sV(e)?tw(e):Array.isArray(e)?e.map(s=>lV(s,i)||Hz.easeOut):Hz[e]}function dse(e,i,s,{delay:l=0,duration:p=300,repeat:_=0,repeatType:b="loop",ease:t="easeOut",times:P}={},O=void 0){const F={[i]:s};P&&(F.offset=P);const $=lV(t,p);Array.isArray($)&&(F.easing=$);const W={delay:l,duration:p,easing:Array.isArray($)?"linear":$,fill:"both",iterations:_+1,direction:b==="reverse"?"alternate":"normal"};return O&&(W.pseudoElement=O),e.animate(F,W)}function fse({type:e,...i}){return QM(e)&&aV()?e.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class pse extends sk{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:s,name:l,keyframes:p,pseudoElement:_,allowFlatten:b=!1,finalKeyframe:t,onComplete:P}=i;this.isPseudoElement=!!_,this.allowFlatten=b,this.options=i,ZM(typeof i.type!="string");const O=fse(i);this.animation=dse(s,l,p,O,_),O.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!_){const F=rk(p,this.options,t,this.speed);this.updateMotionValue?this.updateMotionValue(F):lse(s,l,F),this.animation.cancel()}P?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var i,s;(s=(i=this.animation).finish)==null||s.call(i)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var i,s;this.isPseudoElement||(s=(i=this.animation).commitStyles)==null||s.call(i)}get duration(){var i,s;const l=((s=(i=this.animation.effect)==null?void 0:i.getComputedTiming)==null?void 0:s.call(i).duration)||0;return Dg(Number(l))}get time(){return Dg(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=Em(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:s}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,i&&cse()?(this.animation.timeline=i,qd):s(this)}}const cV={anticipate:iV,backInOut:tV,circInOut:rV};function mse(e){return e in cV}function gse(e){typeof e.ease=="string"&&mse(e.ease)&&(e.ease=cV[e.ease])}const Wz=10;class _se extends pse{constructor(i){gse(i),oV(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:s,onUpdate:l,onComplete:p,element:_,...b}=this.options;if(!s)return;if(i!==void 0){s.set(i);return}const t=new ok({...b,autoplay:!1}),P=Em(this.finishedTime??this.time);s.setWithVelocity(t.sample(P-Wz).value,t.sample(P).value,Wz),t.stop()}}const Zz=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(r0.test(e)||e==="0")&&!e.startsWith("url("));function yse(e){const i=e[0];if(e.length===1)return!0;for(let s=0;s<e.length;s++)if(e[s]!==i)return!0}function vse(e,i,s,l){const p=e[0];if(p===null)return!1;if(i==="display"||i==="visibility")return!0;const _=e[e.length-1],b=Zz(p,i),t=Zz(_,i);return!b||!t?!1:yse(e)||(s==="spring"||QM(s))&&l}const xse=new Set(["opacity","clipPath","filter","transform"]),bse=ak(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function wse(e){var i;const{motionValue:s,name:l,repeatDelay:p,repeatType:_,damping:b,type:t}=e;if(!(((i=s?.owner)==null?void 0:i.current)instanceof HTMLElement))return!1;const{onUpdate:O,transformTemplate:F}=s.owner.getProps();return bse()&&l&&xse.has(l)&&(l!=="transform"||!F)&&!O&&!p&&_!=="mirror"&&b!==0&&t!=="inertia"}const Tse=40;class Sse extends sk{constructor({autoplay:i=!0,delay:s=0,type:l="keyframes",repeat:p=0,repeatDelay:_=0,repeatType:b="loop",keyframes:t,name:P,motionValue:O,element:F,...$}){var W;super(),this.stop=()=>{var se,ie;this._animation&&(this._animation.stop(),(se=this.stopTimeline)==null||se.call(this)),(ie=this.keyframeResolver)==null||ie.cancel()},this.createdAt=jd.now();const Y={autoplay:i,delay:s,type:l,repeat:p,repeatDelay:_,repeatType:b,name:P,motionValue:O,element:F,...$},ae=F?.KeyframeResolver||GM;this.keyframeResolver=new ae(t,(se,ie,pe)=>this.onKeyframesResolved(se,ie,Y,!pe),P,O,F),(W=this.keyframeResolver)==null||W.scheduleResolve()}onKeyframesResolved(i,s,l,p){this.keyframeResolver=void 0;const{name:_,type:b,velocity:t,delay:P,isHandoff:O,onUpdate:F}=l;this.resolvedAt=jd.now(),vse(i,_,b,t)||((Y_.instantAnimations||!P)&&F?.(rk(i,l,s)),i[0]=i[i.length-1],IP(l),l.repeat=0);const W={startTime:p?this.resolvedAt?this.resolvedAt-this.createdAt>Tse?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...l,keyframes:i},Y=!O&&wse(W)?new _se({...W,element:W.motionValue.owner.current}):new ok(W);Y.finished.then(()=>this.notifyFinished()).catch(qd),this.pendingTimeline&&(this.stopTimeline=Y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Y}get finished(){return this._animation?this.animation.finished:this._finished}then(i,s){return this.finished.finally(i).then(()=>{})}get animation(){var i;return this._animation||((i=this.keyframeResolver)==null||i.resume(),mne()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var i;this._animation&&this.animation.cancel(),(i=this.keyframeResolver)==null||i.cancel()}}const lk=(e,i,s,l={},p,_)=>b=>{const t=ek(l,e)||{},P=t.delay||l.delay||0;let{elapsed:O=0}=l;O=O-Em(P);const F={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:i.getVelocity(),...t,delay:-O,onUpdate:W=>{i.set(W),t.onUpdate&&t.onUpdate(W)},onComplete:()=>{b(),t.onComplete&&t.onComplete()},name:e,motionValue:i,element:_?void 0:p};Pre(t)||Object.assign(F,Are(e,F)),F.duration&&(F.duration=Em(F.duration)),F.repeatDelay&&(F.repeatDelay=Em(F.repeatDelay)),F.from!==void 0&&(F.keyframes[0]=F.from);let $=!1;if((F.type===!1||F.duration===0&&!F.repeatDelay)&&(IP(F),F.delay===0&&($=!0)),(Y_.instantAnimations||Y_.skipAnimations)&&($=!0,IP(F),F.delay=0),F.allowFlatten=!t.type&&!t.ease,$&&!_&&i.get()!==void 0){const W=Tre(F.keyframes,t);if(W!==void 0){ml.update(()=>{F.onUpdate(W),F.onComplete()});return}}return t.isSync?new ok(F):new Sse(F)};function Ese({protectedKeys:e,needsAnimating:i},s){const l=e.hasOwnProperty(s)&&i[s]!==!0;return i[s]=!1,l}function Ise(e,i,{delay:s=0,transitionOverride:l,type:p}={}){let{transition:_=e.getDefaultTransition(),transitionEnd:b,...t}=i;l&&(_=l);const P=[],O=p&&e.animationState&&e.animationState.getState()[p];for(const F in t){const $=e.getValue(F,e.latestValues[F]??null),W=t[F];if(W===void 0||O&&Ese(O,F))continue;const Y={delay:s,...ek(_||{},F)},ae=$.get();if(ae!==void 0&&!$.isAnimating&&!Array.isArray(W)&&W===ae&&!Y.velocity)continue;let se=!1;if(window.MotionHandoffAnimation){const pe=qN(e);if(pe){const ye=window.MotionHandoffAnimation(pe,F,ml);ye!==null&&(Y.startTime=ye,se=!0)}}vre(e,F),$.start(lk(F,$,W,e.shouldReduceMotion&&PN.has(F)?{type:!1}:Y,e,se));const ie=$.animation;ie&&P.push(ie)}return b&&Promise.all(P).then(()=>{ml.update(()=>{b&&_re(e,b)})}),P}function Cse(e,i){return e in i}class Ase extends AN{constructor(){super(...arguments),this.type="object"}readValueFromInstance(i,s){if(Cse(s,i)){const l=i[s];if(typeof l=="string"||typeof l=="number")return l}}getBaseTargetFromProps(){}removeValueFromRenderState(i,s){delete s.output[i]}measureInstanceViewportBox(){return yc()}build(i,s){Object.assign(i.output,s)}renderInstance(i,{output:s}){Object.assign(i,s)}sortInstanceNodePosition(){return 0}}function uV(e){return typeof e=="object"&&e!==null}function ck(e){return uV(e)&&"ownerSVGElement"in e}function hV(e){return ck(e)&&e.tagName==="svg"}function Pse(e){const i={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=ck(e)&&!hV(e)?new BN(i):new ON(i);s.mount(e),_v.set(e,s)}function Mse(e){const i={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new Ase(i);s.mount(e),_v.set(e,s)}function dV(e,i,s){const l=Vc(e)?e:rb(e);return l.start(lk("",l,i,s)),l.animation}function kse(e,i){return Vc(e)||typeof e=="number"||typeof e=="string"&&!YM(i)}function fV(e,i,s,l){const p=[];if(kse(e,i))p.push(dV(e,YM(i)&&i.default||i,s&&(s.default||s)));else{const _=NN(e,i,l),b=_.length;for(let t=0;t<b;t++){const P=_[t],O=P instanceof Element?Pse:Mse;_v.has(P)||O(P);const F=_v.get(P),$={...s};"delay"in $&&typeof $.delay=="function"&&($.delay=$.delay(t,b)),p.push(...Ise(F,{...i,transition:$},{}))}}return p}function Dse(e,i,s){const l=[];return lre(e,i,s,{spring:jw}).forEach(({keyframes:_,transition:b},t)=>{l.push(...fV(t,_,b))}),l}class Lse{constructor(i){this.stop=()=>this.runAll("stop"),this.animations=i.filter(Boolean)}get finished(){return Promise.all(this.animations.map(i=>i.finished))}getAll(i){return this.animations[0][i]}setAll(i,s){for(let l=0;l<this.animations.length;l++)this.animations[l][i]=s}attachTimeline(i){const s=this.animations.map(l=>l.attachTimeline(i));return()=>{s.forEach((l,p)=>{l&&l(),this.animations[p].stop()})}}get time(){return this.getAll("time")}set time(i){this.setAll("time",i)}get speed(){return this.getAll("speed")}set speed(i){this.setAll("speed",i)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){let i=0;for(let s=0;s<this.animations.length;s++)i=Math.max(i,this.animations[s].duration);return i}runAll(i){this.animations.forEach(s=>s[i]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Rse extends Lse{then(i,s){return this.finished.finally(i).then(()=>{})}}function zse(e){return Array.isArray(e)&&e.some(Array.isArray)}function Ose(e){function i(s,l,p){let _=[];return zse(s)?_=Dse(s,l,e):_=fV(s,l,p,e),new Rse(_)}return i}const Fse=Ose(),Bse=["initial","animate","whileInView","whileHover","whilePress","whileDrag","whileFocus","exit"];class Nse extends iy{constructor(i){var s,l;super(i),this.animateUpdates=({controlActiveState:p,directAnimate:_,directTransition:b,controlDelay:t=0,isExit:P}={})=>{const{reducedMotion:O}=this.state.options.motionConfig;this.state.visualElement.shouldReduceMotion=O==="always"||O==="user"&&!!wE.current;const F=this.state.target;this.state.target={...this.state.baseTarget};let $={};$=this.resolveStateAnimation({controlActiveState:p,directAnimate:_,directTransition:b}),this.state.finalTransition=$;const W=this.createAnimationFactories(F,$,t),{getChildAnimations:Y}=this.setupChildAnimations($,this.state.activeStates);return this.executeAnimations({factories:W,getChildAnimations:Y,transition:$,controlActiveState:p,isExit:P})},this.state.visualElement=Qne(this.state.options.as,{presenceContext:null,parent:(s=this.state.parent)==null?void 0:s.visualElement,props:{...this.state.options,whileTap:this.state.options.whilePress},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{...this.state.baseTarget}},reducedMotionConfig:this.state.options.motionConfig.reducedMotion}),(l=this.state.visualElement.parent)==null||l.addChild(this.state.visualElement),this.state.animateUpdates=this.animateUpdates,this.state.isMounted()&&this.state.startAnimation()}updateAnimationControlsSubscription(){const{animate:i}=this.state.options;pz(i)&&(this.unmountControls=i.subscribe(this.state))}executeAnimations({factories:i,getChildAnimations:s,transition:l,controlActiveState:p,isExit:_=!1}){const b=()=>Promise.all(i.map($=>$()).filter(Boolean)),t={...this.state.target},P=this.state.element,O=$=>{var W,Y;P.dispatchEvent(gz("motionstart",t)),(Y=(W=this.state.options).onAnimationStart)==null||Y.call(W,t),$.then(()=>{var ae,se;P.dispatchEvent(gz("motioncomplete",t,_)),(se=(ae=this.state.options).onAnimationComplete)==null||se.call(ae,t)}).catch(qd)},F=()=>{const $=l?.when?(l.when==="beforeChildren"?b():s()).then(()=>l.when==="beforeChildren"?s():b()):Promise.all([b(),s()]);return O($),$};return p?F:F()}setupChildAnimations(i,s){var l;const p=this.state.visualElement;if(!((l=p.variantChildren)!=null&&l.size)||!s)return{getChildAnimations:()=>Promise.resolve()};const{staggerChildren:_=0,staggerDirection:b=1,delayChildren:t=0}=i||{},P=p.variantChildren.size,O=(P-1)*_,F=typeof t=="function",$=F?Y=>t(Y,P):b===1?(Y=0)=>Y*_:(Y=0)=>O-Y*_,W=Array.from(p.variantChildren).map((Y,ae)=>Y.state.animateUpdates({controlActiveState:s,controlDelay:(F?0:t)+$(ae)}));return{getChildAnimations:()=>Promise.all(W.map(Y=>Y()))}}createAnimationFactories(i,s,l){const p=[];return Object.keys(this.state.target).forEach(_=>{var b;if(!Lte(i[_],this.state.target[_]))return;(b=this.state.baseTarget)[_]??(b[_]=iie.get(this.state.element,_));const t=this.state.target[_]==="none"&&mP(vz[_])?vz[_]:this.state.target[_];p.push(()=>{var P;return Fse(this.state.element,{[_]:t},{...s?.[_]||s,delay:(((P=s?.[_])==null?void 0:P.delay)||s?.delay||0)+l})})}),p}resolveStateAnimation({controlActiveState:i,directAnimate:s,directTransition:l}){let p=this.state.options.transition,_={};const{variants:b,custom:t,transition:P,animatePresenceContext:O}=this.state.options,F=t??O?.custom;return this.state.activeStates={...this.state.activeStates,...i},Bse.forEach($=>{if(!this.state.activeStates[$]||pz(this.state.options[$]))return;const W=this.state.options[$];let Y=mP(W)?gw(W,b,F):void 0;if(this.state.visualElement.isVariantNode){const ae=gw(this.state.context[$],b,F);Y=Object.assign(ae?ae||{}:_,Y)}Y&&($!=="initial"&&(p=Y.transition||this.state.options.transition||{}),_=Object.assign(_,Y))}),s&&(_=gw(s,b,F),p=_.transition||l||P),Object.entries(_).forEach(([$,W])=>{$!=="transition"&&(this.state.target[$]=W)}),p}mount(){var i,s;const{element:l}=this.state;_w.set(l,this.state),_v.get(l)||(this.state.visualElement.mount(l),_v.set(l,this.state.visualElement)),this.state.visualElement.state=this.state,this.updateAnimationControlsSubscription();const p=this.state.visualElement,_=p.parent;if(p.enteringChildren=void 0,(i=this.state.parent)!=null&&i.isMounted()&&!p.isControllingVariants&&((s=_?.enteringChildren)!=null&&s.has(p))){const{delayChildren:b}=this.state.parent.finalTransition||{};this.animateUpdates({controlActiveState:this.state.parent.activeStates,controlDelay:ere(_.enteringChildren,p,b)})()}}update(){const{animate:i}=this.state.options,{animate:s}=this.state.visualElement.prevProps||{};i!==s&&this.updateAnimationControlsSubscription()}unmount(){var i;(i=this.unmountControls)==null||i.call(this)}}function Vse(e){return uV(e)&&"offsetHeight"in e}const jse={y:!1};function Use(){return jse.y}const pV=(e,i)=>i?e===i?!0:pV(e,i.parentElement):!1,$se=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function mV(e,i){const s=KM(e),l=new AbortController,p={passive:!0,...i,signal:l.signal};return[s,p,()=>l.abort()]}const Gse=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function qse(e){return Gse.has(e.tagName)||e.tabIndex!==-1}const US=new WeakSet;function Xz(e){return i=>{i.key==="Enter"&&e(i)}}function ZC(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const Hse=(e,i)=>{const s=e.currentTarget;if(!s)return;const l=Xz(()=>{if(US.has(s))return;ZC(s,"down");const p=Xz(()=>{ZC(s,"up")}),_=()=>ZC(s,"cancel");s.addEventListener("keyup",p,i),s.addEventListener("blur",_,i)});s.addEventListener("keydown",l,i),s.addEventListener("blur",()=>s.removeEventListener("keydown",l),i)};function Yz(e){return $se(e)&&!0}function Wse(e,i,s={}){const[l,p,_]=mV(e,s),b=t=>{const P=t.currentTarget;if(!Yz(t))return;US.add(P);const O=i(P,t),F=(Y,ae)=>{window.removeEventListener("pointerup",$),window.removeEventListener("pointercancel",W),US.has(P)&&US.delete(P),Yz(Y)&&typeof O=="function"&&O(Y,{success:ae})},$=Y=>{F(Y,P===window||P===document||s.useGlobalTarget||pV(P,Y.target))},W=Y=>{F(Y,!1)};window.addEventListener("pointerup",$,p),window.addEventListener("pointercancel",W,p)};return l.forEach(t=>{(s.useGlobalTarget?window:t).addEventListener("pointerdown",b,p),Vse(t)&&(t.addEventListener("focus",O=>Hse(O,p)),!qse(t)&&!t.hasAttribute("tabindex")&&(t.tabIndex=0))}),_}function gV(e){return{point:{x:e.pageX,y:e.pageY}}}function Kz(e,i,s){const l=e.options;l.whilePress&&e.setActive("whilePress",s==="Start");const p=`onPress${s==="End"?"":s}`,_=l[p];_&&ml.postRender(()=>_(i,gV(i)))}class Zse extends iy{isActive(){const{whilePress:i,onPress:s,onPressCancel:l,onPressStart:p}=this.state.options;return!!(i||s||l||p)}constructor(i){super(i)}mount(){this.register()}update(){const{whilePress:i,onPress:s,onPressCancel:l,onPressStart:p}=this.state.options;i||s||l||p||this.register()}register(){const i=this.state.element;!i||!this.isActive()||(this.unmount(),this.unmount=Wse(i,(s,l)=>(Kz(this.state,l,"Start"),(p,{success:_})=>Kz(this.state,p,_?"End":"Cancel")),{useGlobalTarget:this.state.options.globalPressTarget}))}}function Jz(e){return!(e.pointerType==="touch"||Use())}function Xse(e,i,s={}){const[l,p,_]=mV(e,s),b=t=>{if(!Jz(t))return;const{target:P}=t,O=i(P,t);if(typeof O!="function"||!P)return;const F=$=>{Jz($)&&(O($),P.removeEventListener("pointerleave",F))};P.addEventListener("pointerleave",F,p)};return l.forEach(t=>{t.addEventListener("pointerenter",b,p)}),_}function Qz(e,i,s){const l=e.options;l.whileHover&&e.setActive("whileHover",s==="Start");const p=`onHover${s}`,_=l[p];_&&ml.postRender(()=>_(i,gV(i)))}class Yse extends iy{isActive(){const{whileHover:i,onHoverStart:s,onHoverEnd:l}=this.state.options;return!!(i||s||l)}constructor(i){super(i)}mount(){this.register()}update(){const{whileHover:i,onHoverStart:s,onHoverEnd:l}=this.state.visualElement.prevProps;i||s||l||this.register()}register(){const i=this.state.element;!i||!this.isActive()||(this.unmount(),this.unmount=Xse(i,(s,l)=>(Qz(this.state,l,"Start"),p=>{Qz(this.state,p,"End")})))}}const Kse={some:0,all:1};function Jse(e,i,{root:s,margin:l,amount:p="some"}={}){const _=KM(e),b=new WeakMap,t=O=>{O.forEach(F=>{const $=b.get(F.target);if(F.isIntersecting!==!!$)if(F.isIntersecting){const W=i(F.target,F);typeof W=="function"?b.set(F.target,W):P.unobserve(F.target)}else typeof $=="function"&&($(F),b.delete(F.target))})},P=new IntersectionObserver(t,{root:s,rootMargin:l,threshold:typeof p=="number"?p:Kse[p]});return _.forEach(O=>P.observe(O)),()=>P.disconnect()}function eO(e,i,s){const l=e.options;l.whileInView&&e.setActive("whileInView",s==="Enter");const p=`onViewport${s}`,_=l[p];_&&ml.postRender(()=>_(i))}class Qse extends iy{isActive(){const{whileInView:i,onViewportEnter:s,onViewportLeave:l}=this.state.options;return!!(i||s||l)}constructor(i){super(i)}startObserver(){const i=this.state.element;if(!i||!this.isActive())return;this.unmount();const{once:s,...l}=this.state.options.inViewOptions||{};this.unmount=Jse(i,(p,_)=>{if(eO(this.state,_,"Enter"),!s)return b=>{eO(this.state,_,"Leave")}},l)}mount(){this.startObserver()}update(){const{props:i,prevProps:s}=this.state.visualElement;["amount","margin","root"].some(eoe(i,s))&&this.startObserver()}}function eoe({inViewOptions:e={}},{inViewOptions:i={}}={}){return s=>e[s]!==i[s]}function EE(e,i,s,l={passive:!0}){return e.addEventListener(i,s,l),()=>e.removeEventListener(i,s)}class toe extends iy{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.state.element.matches(":focus-visible")}catch{i=!0}i&&(this.state.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&(this.state.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=o2(EE(this.state.element,"focus",()=>this.onFocus()),EE(this.state.element,"blur",()=>this.onBlur()))}}const ioe=(e,i)=>e.depth-i.depth;class noe{constructor(){this.children=[],this.isDirty=!1}add(i){UM(this.children,i),this.isDirty=!0}remove(i){fI(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(ioe),this.isDirty=!1,this.children.forEach(i)}}function XC(e){return Vc(e)?e.get():e}const _V=["TopLeft","TopRight","BottomLeft","BottomRight"],roe=_V.length,tO=e=>typeof e=="string"?parseFloat(e):e,iO=e=>typeof e=="number"||Ls.test(e);function soe(e,i,s,l,p,_){p?(e.opacity=zl(0,s.opacity??1,ooe(l)),e.opacityExit=zl(i.opacity??1,0,aoe(l))):_&&(e.opacity=zl(i.opacity??1,s.opacity??1,l));for(let b=0;b<roe;b++){const t=`border${_V[b]}Radius`;let P=nO(i,t),O=nO(s,t);if(P===void 0&&O===void 0)continue;P||(P=0),O||(O=0),P===0||O===0||iO(P)===iO(O)?(e[t]=Math.max(zl(tO(P),tO(O),l),0),(Lg.test(O)||Lg.test(P))&&(e[t]+="%")):e[t]=O}(i.rotate||s.rotate)&&(e.rotate=zl(i.rotate||0,s.rotate||0,l))}function nO(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const ooe=yV(0,.5,nV),aoe=yV(.5,.95,qd);function yV(e,i,s){return l=>l<e?0:l>i?1:s(sb(e,i,l))}function rO(e,i){e.min=i.min,e.max=i.max}function Sp(e,i){rO(e.x,i.x),rO(e.y,i.y)}function sO(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function YC(e){return e===void 0||e===1}function MP({scale:e,scaleX:i,scaleY:s}){return!YC(e)||!YC(i)||!YC(s)}function tv(e){return MP(e)||vV(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function vV(e){return oO(e.x)||oO(e.y)}function oO(e){return e&&e!=="0%"}function IE(e,i,s){const l=e-s,p=i*l;return s+p}function aO(e,i,s,l,p){return p!==void 0&&(e=IE(e,p,l)),IE(e,s,l)+i}function kP(e,i=0,s=1,l,p){e.min=aO(e.min,i,s,l,p),e.max=aO(e.max,i,s,l,p)}function xV(e,{x:i,y:s}){kP(e.x,i.translate,i.scale,i.originPoint),kP(e.y,s.translate,s.scale,s.originPoint)}const lO=.999999999999,cO=1.0000000000001;function loe(e,i,s,l=!1){const p=s.length;if(!p)return;i.x=i.y=1;let _,b;for(let t=0;t<p;t++){_=s[t],b=_.projectionDelta;const{visualElement:P}=_.options;P&&P.props.style&&P.props.style.display==="contents"||(l&&_.options.layoutScroll&&_.scroll&&_!==_.root&&zx(e,{x:-_.scroll.offset.x,y:-_.scroll.offset.y}),b&&(i.x*=b.x.scale,i.y*=b.y.scale,xV(e,b)),l&&tv(_.latestValues)&&zx(e,_.latestValues))}i.x<cO&&i.x>lO&&(i.x=1),i.y<cO&&i.y>lO&&(i.y=1)}function uS(e,i){e.min=e.min+i,e.max=e.max+i}function uO(e,i,s,l,p=.5){const _=zl(e.min,e.max,p);kP(e,i,s,_,l)}function zx(e,i){uO(e.x,i.x,i.scaleX,i.scale,i.originX),uO(e.y,i.y,i.scaleY,i.scale,i.originY)}const bV=1e-4,coe=1-bV,uoe=1+bV,wV=.01,hoe=0-wV,doe=0+wV;function Cp(e){return e.max-e.min}function foe(e,i,s){return Math.abs(e-i)<=s}function hO(e,i,s,l=.5){e.origin=l,e.originPoint=zl(i.min,i.max,e.origin),e.scale=Cp(s)/Cp(i),e.translate=zl(s.min,s.max,e.origin)-e.originPoint,(e.scale>=coe&&e.scale<=uoe||isNaN(e.scale))&&(e.scale=1),(e.translate>=hoe&&e.translate<=doe||isNaN(e.translate))&&(e.translate=0)}function bw(e,i,s,l){hO(e.x,i.x,s.x,l?l.originX:void 0),hO(e.y,i.y,s.y,l?l.originY:void 0)}function dO(e,i,s){e.min=s.min+i.min,e.max=e.min+Cp(i)}function poe(e,i,s){dO(e.x,i.x,s.x),dO(e.y,i.y,s.y)}function fO(e,i,s){e.min=i.min-s.min,e.max=e.min+Cp(i)}function ww(e,i,s){fO(e.x,i.x,s.x),fO(e.y,i.y,s.y)}function pO(e,i,s,l,p){return e-=i,e=IE(e,1/s,l),p!==void 0&&(e=IE(e,1/p,l)),e}function moe(e,i=0,s=1,l=.5,p,_=e,b=e){if(Lg.test(i)&&(i=parseFloat(i),i=zl(b.min,b.max,i/100)-b.min),typeof i!="number")return;let t=zl(_.min,_.max,l);e===_&&(t-=i),e.min=pO(e.min,i,s,t,p),e.max=pO(e.max,i,s,t,p)}function mO(e,i,[s,l,p],_,b){moe(e,i[s],i[l],i[p],i.scale,_,b)}const goe=["x","scaleX","originX"],_oe=["y","scaleY","originY"];function gO(e,i,s,l){mO(e.x,i,goe,s?s.x:void 0,l?l.x:void 0),mO(e.y,i,_oe,s?s.y:void 0,l?l.y:void 0)}function _O(e){return e.translate===0&&e.scale===1}function TV(e){return _O(e.x)&&_O(e.y)}function yO(e,i){return e.min===i.min&&e.max===i.max}function yoe(e,i){return yO(e.x,i.x)&&yO(e.y,i.y)}function vO(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function SV(e,i){return vO(e.x,i.x)&&vO(e.y,i.y)}function xO(e){return Cp(e.x)/Cp(e.y)}function bO(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class voe{constructor(){this.members=[]}add(i){UM(this.members,i),i.scheduleRender()}remove(i){if(fI(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(i){const s=this.members.findIndex(p=>i===p);if(s===0)return!1;let l;for(let p=s;p>=0;p--){const _=this.members[p];if(_.isPresent!==!1){l=_;break}}return l?(this.promote(l),!0):!1}promote(i,s){const l=this.lead;if(i!==l&&(this.prevLead=l,this.lead=i,i.show(),l)){l.instance&&l.scheduleRender(),i.scheduleRender(),i.resumeFrom=l,s&&(i.resumeFrom.preserveOpacity=!0),l.snapshot&&(i.snapshot=l.snapshot,i.snapshot.latestValues=l.animationValues||l.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:p}=i.options;p===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:s,resumingFrom:l}=i;s.onExitComplete&&s.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function xoe(e,i,s){let l="";const p=e.x.translate/i.x,_=e.y.translate/i.y,b=s?.z||0;if((p||_||b)&&(l=`translate3d(${p}px, ${_}px, ${b}px) `),(i.x!==1||i.y!==1)&&(l+=`scale(${1/i.x}, ${1/i.y}) `),s){const{transformPerspective:O,rotate:F,rotateX:$,rotateY:W,skewX:Y,skewY:ae}=s;O&&(l=`perspective(${O}px) ${l}`),F&&(l+=`rotate(${F}deg) `),$&&(l+=`rotateX(${$}deg) `),W&&(l+=`rotateY(${W}deg) `),Y&&(l+=`skewX(${Y}deg) `),ae&&(l+=`skewY(${ae}deg) `)}const t=e.x.scale*i.x,P=e.y.scale*i.y;return(t!==1||P!==1)&&(l+=`scale(${t}, ${P})`),l||"none"}function wO(e){return[e("x"),e("y")]}const $S={hasAnimatedSinceResize:!0,hasEverUpdated:!1},KC=["","X","Y","Z"],boe=1e3;let woe=0;function JC(e,i,s,l){const{latestValues:p}=i;p[e]&&(s[e]=p[e],i.setStaticValue(e,0),l&&(l[e]=0))}function EV(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const s=qN(i);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:p,layoutId:_}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",ml,!(p||_))}const{parent:l}=e;l&&!l.hasCheckedOptimisedAppear&&EV(l)}function IV({attachResizeListener:e,defaultParent:i,measureScroll:s,checkIsScrollRoot:l,resetTransform:p}){return class{constructor(b={},t=i?.()){this.id=woe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Eoe),this.nodes.forEach(Poe),this.nodes.forEach(Moe),this.nodes.forEach(Ioe)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=b,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let P=0;P<this.path.length;P++)this.path[P].shouldResetTransform=!0;this.root===this&&(this.nodes=new noe)}addEventListener(b,t){return this.eventHandlers.has(b)||this.eventHandlers.set(b,new $M),this.eventHandlers.get(b).add(t)}notifyListeners(b,...t){const P=this.eventHandlers.get(b);P&&P.notify(...t)}hasListeners(b){return this.eventHandlers.has(b)}mount(b){if(this.instance)return;this.isSVG=ck(b)&&!hV(b),this.instance=b;const{layoutId:t,layout:P,visualElement:O}=this.options;if(O&&!O.current&&O.mount(b),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(P||t)&&(this.isLayoutDirty=!0),e){let F,$=0;const W=()=>this.root.updateBlockedByResize=!1;ml.read(()=>{$=window.innerWidth}),e(b,()=>{const Y=window.innerWidth;Y!==$&&($=Y,this.root.updateBlockedByResize=!0,F&&F(),F=Cte(W,250),$S.hasAnimatedSinceResize&&($S.hasAnimatedSinceResize=!1,this.nodes.forEach(EO)))})}t&&this.root.registerSharedNode(t,this),this.options.animate!==!1&&O&&(t||P)&&this.addEventListener("didUpdate",({delta:F,hasLayoutChanged:$,hasRelativeLayoutChanged:W,layout:Y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ae=this.options.transition||O.getDefaultTransition()||zoe,{onLayoutAnimationStart:se,onLayoutAnimationComplete:ie}=O.getProps(),pe=!this.targetLayout||!SV(this.targetLayout,Y),ye=!$&&W;if(this.options.layoutRoot||this.resumeFrom||ye||$&&(pe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const de={...ek(ae,"layout"),onPlay:se,onComplete:ie};(O.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de),this.setAnimationOrigin(F,ye)}else $||EO(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const b=this.getStack();b&&b.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),K_(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(koe),this.animationId++)}getTransformTemplate(){const{visualElement:b}=this.options;return b&&b.getProps().transformTemplate}willUpdate(b=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&EV(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let F=0;F<this.path.length;F++){const $=this.path[F];$.shouldResetTransform=!0,$.updateScroll("snapshot"),$.options.layoutRoot&&$.willUpdate(!1)}const{layoutId:t,layout:P}=this.options;if(t===void 0&&!P)return;const O=this.getTransformTemplate();this.prevTransformTemplateValue=O?O(this.latestValues,""):void 0,this.updateSnapshot(),b&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(TO);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(SO);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Aoe),this.nodes.forEach(Toe),this.nodes.forEach(Soe)):this.nodes.forEach(SO),this.clearAllSnapshots();const t=jd.now();Gu.delta=J_(0,1e3/60,t-Gu.timestamp),Gu.timestamp=t,Gu.isProcessing=!0,jC.update.process(Gu),jC.preRender.process(Gu),jC.render.process(Gu),Gu.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,CN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Coe),this.sharedNodes.forEach(Doe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ml.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ml.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Cp(this.snapshot.measuredBox.x)&&!Cp(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let P=0;P<this.path.length;P++)this.path[P].updateScroll();const b=this.layout;this.layout=this.measure(!1),this.layoutCorrected=yc(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,b?b.layoutBox:void 0)}updateScroll(b="measure"){let t=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===b&&(t=!1),t&&this.instance){const P=l(this.instance);this.scroll={animationId:this.root.animationId,phase:b,isRoot:P,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:P}}}resetTransform(){if(!p)return;const b=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!TV(this.projectionDelta),P=this.getTransformTemplate(),O=P?P(this.latestValues,""):void 0,F=O!==this.prevTransformTemplateValue;b&&this.instance&&(t||tv(this.latestValues)||F)&&(p(this.instance,O),this.shouldResetTransform=!1,this.scheduleRender())}measure(b=!0){const t=this.measurePageBox();let P=this.removeElementScroll(t);return b&&(P=this.removeTransform(P)),Ooe(P),{animationId:this.root.animationId,measuredBox:t,layoutBox:P,latestValues:{},source:this.id}}measurePageBox(){var b;const{visualElement:t}=this.options;if(!t)return yc();const P=t.measureViewportBox();if(!(((b=this.scroll)==null?void 0:b.wasRoot)||this.path.some(Foe))){const{scroll:F}=this.root;F&&(uS(P.x,F.offset.x),uS(P.y,F.offset.y))}return P}removeElementScroll(b){var t;const P=yc();if(Sp(P,b),(t=this.scroll)!=null&&t.wasRoot)return P;for(let O=0;O<this.path.length;O++){const F=this.path[O],{scroll:$,options:W}=F;F!==this.root&&$&&W.layoutScroll&&($.wasRoot&&Sp(P,b),uS(P.x,$.offset.x),uS(P.y,$.offset.y))}return P}applyTransform(b,t=!1){const P=yc();Sp(P,b);for(let O=0;O<this.path.length;O++){const F=this.path[O];!t&&F.options.layoutScroll&&F.scroll&&F!==F.root&&zx(P,{x:-F.scroll.offset.x,y:-F.scroll.offset.y}),tv(F.latestValues)&&zx(P,F.latestValues)}return tv(this.latestValues)&&zx(P,this.latestValues),P}removeTransform(b){const t=yc();Sp(t,b);for(let P=0;P<this.path.length;P++){const O=this.path[P];if(!O.instance||!tv(O.latestValues))continue;MP(O.latestValues)&&O.updateSnapshot();const F=yc(),$=O.measurePageBox();Sp(F,$),gO(t,O.latestValues,O.snapshot?O.snapshot.layoutBox:void 0,F)}return tv(this.latestValues)&&gO(t,this.latestValues),t}setTargetDelta(b){this.targetDelta=b,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(b){this.options={...this.options,...b,crossfade:b.crossfade!==void 0?b.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Gu.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(b=!1){var t;const P=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=P.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=P.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=P.isSharedProjectionDirty);const O=!!this.resumingFrom||this!==P;if(!(b||O&&this.isSharedProjectionDirty||this.isProjectionDirty||(t=this.parent)!=null&&t.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:$,layoutId:W}=this.options;if(!(!this.layout||!($||W))){if(this.resolvedRelativeTargetAt=Gu.timestamp,!this.targetDelta&&!this.relativeTarget){const Y=this.getClosestProjectingParent();Y&&Y.layout&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=yc(),this.relativeTargetOrigin=yc(),ww(this.relativeTargetOrigin,this.layout.layoutBox,Y.layout.layoutBox),Sp(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=yc(),this.targetWithTransforms=yc()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),poe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Sp(this.target,this.layout.layoutBox),xV(this.target,this.targetDelta)):Sp(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Y=this.getClosestProjectingParent();Y&&!!Y.resumingFrom==!!this.resumingFrom&&!Y.options.layoutScroll&&Y.target&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=yc(),this.relativeTargetOrigin=yc(),ww(this.relativeTargetOrigin,this.target,Y.target),Sp(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||MP(this.parent.latestValues)||vV(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var b;const t=this.getLead(),P=!!this.resumingFrom||this!==t;let O=!0;if((this.isProjectionDirty||(b=this.parent)!=null&&b.isProjectionDirty)&&(O=!1),P&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(O=!1),this.resolvedRelativeTargetAt===Gu.timestamp&&(O=!1),O)return;const{layout:F,layoutId:$}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(F||$))return;Sp(this.layoutCorrected,this.layout.layoutBox);const W=this.treeScale.x,Y=this.treeScale.y;loe(this.layoutCorrected,this.treeScale,this.path,P),t.layout&&!t.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(t.target=t.layout.layoutBox,t.targetWithTransforms=yc());const{target:ae}=t;if(!ae){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(sO(this.prevProjectionDelta.x,this.projectionDelta.x),sO(this.prevProjectionDelta.y,this.projectionDelta.y)),bw(this.projectionDelta,this.layoutCorrected,ae,this.latestValues),(this.treeScale.x!==W||this.treeScale.y!==Y||!bO(this.projectionDelta.x,this.prevProjectionDelta.x)||!bO(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",ae))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(b=!0){var t;if((t=this.options.visualElement)==null||t.scheduleRender(),b){const P=this.getStack();P&&P.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Lx(),this.projectionDelta=Lx(),this.projectionDeltaWithTransform=Lx()}setAnimationOrigin(b,t=!1){const P=this.snapshot,O=P?P.latestValues:{},F={...this.latestValues},$=Lx();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const W=yc(),Y=P?P.source:void 0,ae=this.layout?this.layout.source:void 0,se=Y!==ae,ie=this.getStack(),pe=!ie||ie.members.length<=1,ye=!!(se&&!pe&&this.options.crossfade===!0&&!this.path.some(Roe));this.animationProgress=0;let de;this.mixTargetDelta=Ee=>{const Pe=Ee/1e3;IO($.x,b.x,Pe),IO($.y,b.y,Pe),this.setTargetDelta($),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ww(W,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Loe(this.relativeTarget,this.relativeTargetOrigin,W,Pe),de&&yoe(this.relativeTarget,de)&&(this.isProjectionDirty=!1),de||(de=yc()),Sp(de,this.relativeTarget)),se&&(this.animationValues=F,soe(F,O,this.latestValues,Pe,ye,pe)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Pe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(b){var t,P,O;this.notifyListeners("animationStart"),(t=this.currentAnimation)==null||t.stop(),(O=(P=this.resumingFrom)==null?void 0:P.currentAnimation)==null||O.stop(),this.pendingAnimation&&(K_(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ml.update(()=>{$S.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=rb(0)),this.currentAnimation=dV(this.motionValue,[0,1e3],{...b,velocity:0,isSync:!0,onUpdate:F=>{this.mixTargetDelta(F),b.onUpdate&&b.onUpdate(F)},onStop:()=>{},onComplete:()=>{b.onComplete&&b.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const b=this.getStack();b&&b.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(boe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const b=this.getLead();let{targetWithTransforms:t,target:P,layout:O,latestValues:F}=b;if(!(!t||!P||!O)){if(this!==b&&this.layout&&O&&CV(this.options.animationType,this.layout.layoutBox,O.layoutBox)){P=this.target||yc();const $=Cp(this.layout.layoutBox.x);P.x.min=b.target.x.min,P.x.max=P.x.min+$;const W=Cp(this.layout.layoutBox.y);P.y.min=b.target.y.min,P.y.max=P.y.min+W}Sp(t,P),zx(t,F),bw(this.projectionDeltaWithTransform,this.layoutCorrected,t,F)}}registerSharedNode(b,t){this.sharedNodes.has(b)||this.sharedNodes.set(b,new voe),this.sharedNodes.get(b).add(t);const O=t.options.initialPromotionConfig;t.promote({transition:O?O.transition:void 0,preserveFollowOpacity:O&&O.shouldPreserveFollowOpacity?O.shouldPreserveFollowOpacity(t):void 0})}isLead(){const b=this.getStack();return b?b.lead===this:!0}getLead(){var b;const{layoutId:t}=this.options;return t?((b=this.getStack())==null?void 0:b.lead)||this:this}getPrevLead(){var b;const{layoutId:t}=this.options;return t?(b=this.getStack())==null?void 0:b.prevLead:void 0}getStack(){const{layoutId:b}=this.options;if(b)return this.root.sharedNodes.get(b)}promote({needsReset:b,transition:t,preserveFollowOpacity:P}={}){const O=this.getStack();O&&O.promote(this,P),b&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const b=this.getStack();return b?b.relegate(this):!1}resetSkewAndRotation(){const{visualElement:b}=this.options;if(!b)return;let t=!1;const{latestValues:P}=b;if((P.z||P.rotate||P.rotateX||P.rotateY||P.rotateZ||P.skewX||P.skewY)&&(t=!0),!t)return;const O={};P.z&&JC("z",b,O,this.animationValues);for(let F=0;F<KC.length;F++)JC(`rotate${KC[F]}`,b,O,this.animationValues),JC(`skew${KC[F]}`,b,O,this.animationValues);b.render();for(const F in O)b.setStaticValue(F,O[F]),this.animationValues&&(this.animationValues[F]=O[F]);b.scheduleRender()}applyProjectionStyles(b,t){if(!this.instance||this.isSVG)return;if(!this.isVisible){b.visibility="hidden";return}const P=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,b.visibility="",b.opacity="",b.pointerEvents=XC(t?.pointerEvents)||"",b.transform=P?P(this.latestValues,""):"none";return}const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){this.options.layoutId&&(b.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,b.pointerEvents=XC(t?.pointerEvents)||""),this.hasProjected&&!tv(this.latestValues)&&(b.transform=P?P({},""):"none",this.hasProjected=!1);return}b.visibility="";const F=O.animationValues||O.latestValues;this.applyTransformsToTarget();let $=xoe(this.projectionDeltaWithTransform,this.treeScale,F);P&&($=P(F,$)),b.transform=$;const{x:W,y:Y}=this.projectionDelta;b.transformOrigin=`${W.origin*100}% ${Y.origin*100}% 0`,O.animationValues?b.opacity=O===this?F.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:F.opacityExit:b.opacity=O===this?F.opacity!==void 0?F.opacity:"":F.opacityExit!==void 0?F.opacityExit:0;for(const ae in Bw){if(F[ae]===void 0)continue;const{correct:se,applyTo:ie,isCSSVariable:pe}=Bw[ae],ye=$==="none"?F[ae]:se(F[ae],O);if(ie){const de=ie.length;for(let Ee=0;Ee<de;Ee++)b[ie[Ee]]=ye}else pe?this.options.visualElement.renderState.vars[ae]=ye:b[ae]=ye}this.options.layoutId&&(b.pointerEvents=O===this?XC(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(b=>{var t;return(t=b.currentAnimation)==null?void 0:t.stop()}),this.root.nodes.forEach(TO),this.root.sharedNodes.clear()}}}function Toe(e){e.updateLayout()}function Soe(e){var i;const s=((i=e.resumeFrom)==null?void 0:i.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:p}=e.layout,{animationType:_}=e.options,b=s.source!==e.layout.source;_==="size"?wO($=>{const W=b?s.measuredBox[$]:s.layoutBox[$],Y=Cp(W);W.min=l[$].min,W.max=W.min+Y}):CV(_,s.layoutBox,l)&&wO($=>{const W=b?s.measuredBox[$]:s.layoutBox[$],Y=Cp(l[$]);W.max=W.min+Y,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[$].max=e.relativeTarget[$].min+Y)});const t=Lx();bw(t,l,s.layoutBox);const P=Lx();b?bw(P,e.applyTransform(p,!0),s.measuredBox):bw(P,l,s.layoutBox);const O=!TV(t);let F=!1;if(!e.resumeFrom){const $=e.getClosestProjectingParent();if($&&!$.resumeFrom){const{snapshot:W,layout:Y}=$;if(W&&Y){const ae=yc();ww(ae,s.layoutBox,W.layoutBox);const se=yc();ww(se,l,Y.layoutBox),SV(ae,se)||(F=!0),$.options.layoutRoot&&(e.relativeTarget=se,e.relativeTargetOrigin=ae,e.relativeParent=$)}}}e.notifyListeners("didUpdate",{layout:l,snapshot:s,delta:P,layoutDelta:t,hasLayoutChanged:O,hasRelativeLayoutChanged:F})}else if(e.isLead()){const{onExitComplete:l}=e.options;l&&l()}e.options.transition=void 0}function Eoe(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Ioe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Coe(e){e.clearSnapshot()}function TO(e){e.clearMeasurements()}function SO(e){e.isLayoutDirty=!1}function Aoe(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function EO(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Poe(e){e.resolveTargetDelta()}function Moe(e){e.calcProjection()}function koe(e){e.resetSkewAndRotation()}function Doe(e){e.removeLeadSnapshot()}function IO(e,i,s){e.translate=zl(i.translate,0,s),e.scale=zl(i.scale,1,s),e.origin=i.origin,e.originPoint=i.originPoint}function CO(e,i,s,l){e.min=zl(i.min,s.min,l),e.max=zl(i.max,s.max,l)}function Loe(e,i,s,l){CO(e.x,i.x,s.x,l),CO(e.y,i.y,s.y,l)}function Roe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const zoe={duration:.45,ease:[.4,0,.1,1]},AO=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),PO=AO("applewebkit/")&&!AO("chrome/")?Math.round:qd;function MO(e){e.min=PO(e.min),e.max=PO(e.max)}function Ooe(e){MO(e.x),MO(e.y)}function CV(e,i,s){return e==="position"||e==="preserve-aspect"&&!foe(xO(i),xO(s),.2)}function Foe(e){var i;return e!==e.root&&((i=e.scroll)==null?void 0:i.wasRoot)}function Boe(e,i,s,l={passive:!0}){return e.addEventListener(i,s,l),()=>e.removeEventListener(i,s)}const Noe=IV({attachResizeListener:(e,i)=>Boe(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),QC={current:void 0},Voe=IV({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!QC.current){const e=new Noe({});e.mount(window),e.setOptions({layoutScroll:!0}),QC.current=e}return QC.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"});function AV(e){if(e)return e.options.allowProjection!==!1?e.projection:AV(e.parent)}function kO(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const Y1={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(Ls.test(e))e=parseFloat(e);else return e;const s=kO(e,i.target.x),l=kO(e,i.target.y);return`${s}% ${l}%`}},joe={correct:(e,{treeScale:i,projectionDelta:s})=>{const l=e,p=r0.parse(e);if(p.length>5)return l;const _=r0.createTransformer(e),b=typeof p[0]!="number"?1:0,t=s.x.scale*i.x,P=s.y.scale*i.y;p[0+b]/=t,p[1+b]/=P;const O=zl(t,P,.5);return typeof p[2+b]=="number"&&(p[2+b]/=O),typeof p[3+b]=="number"&&(p[3+b]/=O),_(p)}},PV={borderRadius:{...Y1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Y1,borderTopRightRadius:Y1,borderBottomLeftRadius:Y1,borderBottomRightRadius:Y1,boxShadow:joe};function iw(e){return typeof e=="object"&&e!==null&&"nodeType"in e}class Uoe extends iy{constructor(i){super(i),iN(PV)}initProjection(){const i=this.state.options;this.state.visualElement.projection=new Voe(this.state.visualElement.latestValues,i["data-framer-portal-id"]?void 0:AV(this.state.visualElement.parent)),this.state.visualElement.projection.isPresent=!0,this.setOptions()}beforeMount(){this.initProjection()}setOptions(){const i=this.state.options;this.state.visualElement.projection.setOptions({layout:i.layout,layoutId:i.layoutId,alwaysMeasureLayout:!!i.drag||i.dragConstraints&&iw(i.dragConstraints),visualElement:this.state.visualElement,animationType:typeof i.layout=="string"?i.layout:"both",layoutRoot:i.layoutRoot,layoutScroll:i.layoutScroll,crossfade:i.crossfade,onExitComplete:()=>{var s;if(!((s=this.state.visualElement.projection)!=null&&s.isPresent)){const l=nb.get(this.state.element);this.state.isSafeToRemove=!0,l&&l({detail:{isExit:!0}},!0)}}})}update(){this.setOptions()}mount(){var i;(i=this.state.visualElement.projection)==null||i.mount(this.state.element)}}function MV(e){return e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1}function uk(e,i="page"){return{point:{x:e[`${i}X`],y:e[`${i}Y`]}}}function $oe(e){return i=>MV(i)&&e(i,uk(i))}function Tw(e,i,s,l){return EE(e,i,$oe(s),l)}function kV(e){let i=null;return()=>{const s=()=>{i=null};return i===null?(i=e,s):!1}}const DO=kV("dragHorizontal"),LO=kV("dragVertical");function Goe(e){let i=!1;if(e==="y")i=LO();else if(e==="x")i=DO();else{const s=DO(),l=LO();s&&l?i=()=>{s(),l()}:(s&&s(),l&&l())}return i}function DP(e){return e.max-e.min}function qoe(e,{min:i,max:s},l){return i!==void 0&&e<i?e=l?zl(i,e,l.min):Math.max(e,i):s!==void 0&&e>s&&(e=l?zl(s,e,l.max):Math.min(e,s)),e}const LP=.35;function Hoe(e,{top:i,left:s,bottom:l,right:p}){return{x:RO(e.x,s,p),y:RO(e.y,i,l)}}function RO(e,i,s){return{min:i!==void 0?e.min+i:void 0,max:s!==void 0?e.max+s-(e.max-e.min):void 0}}function Woe(e=LP){return e===!1?e=0:e===!0&&(e=LP),{x:zO(e,"left","right"),y:zO(e,"top","bottom")}}function zO(e,i,s){return{min:OO(e,i),max:OO(e,s)}}function OO(e,i){return typeof e=="number"?e:e[i]||0}function Zoe(e,i){const s={};return i.min!==void 0&&(s.min=i.min-e.min),i.max!==void 0&&(s.max=i.max-e.min),s}function Xoe(e,i){return{x:FO(e.x,i.x),y:FO(e.y,i.y)}}function FO(e,i){let s=i.min-e.min,l=i.max-e.max;return i.max-i.min<e.max-e.min&&([s,l]=[l,s]),{min:s,max:l}}function Yoe(e,i){let s=.5;const l=DP(e),p=DP(i);return p>l?s=sb(i.min,i.max-l,e.min):l>p&&(s=sb(e.min,e.max-p,i.min)),J_(0,1,s)}const BO=(e,i)=>Math.abs(e-i);function Koe(e,i){const s=BO(e.x,i.x),l=BO(e.y,i.y);return Math.sqrt(s**2+l**2)}class DV{constructor(i,s,{transformPagePoint:l,contextWindow:p,dragSnapToOrigin:_=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const $=tA(this.lastMoveEventInfo,this.history),W=this.startEvent!==null,Y=Koe($.offset,{x:0,y:0})>=3;if(!W&&!Y)return;const{point:ae}=$,{timestamp:se}=Gu;this.history.push({...ae,timestamp:se});const{onStart:ie,onMove:pe}=this.handlers;W||(ie&&ie(this.lastMoveEvent,$),this.startEvent=this.lastMoveEvent),pe&&pe(this.lastMoveEvent,$)},this.handlePointerMove=($,W)=>{this.lastMoveEvent=$,this.lastMoveEventInfo=eA(W,this.transformPagePoint),ml.update(this.updatePoint,!0)},this.handlePointerUp=($,W)=>{this.end();const{onEnd:Y,onSessionEnd:ae,resumeAnimation:se}=this.handlers;if(this.dragSnapToOrigin&&se&&se(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ie=tA($.type==="pointercancel"?this.lastMoveEventInfo:eA(W,this.transformPagePoint),this.history);this.startEvent&&Y&&Y($,ie),ae&&ae($,ie)},!MV(i))return;this.dragSnapToOrigin=_,this.handlers=s,this.transformPagePoint=l,this.contextWindow=p||window;const b=uk(i),t=eA(b,this.transformPagePoint),{point:P}=t,{timestamp:O}=Gu;this.history=[{...P,timestamp:O}];const{onSessionStart:F}=s;F&&F(i,tA(t,this.history)),this.removeListeners=o2(Tw(this.contextWindow,"pointermove",this.handlePointerMove),Tw(this.contextWindow,"pointerup",this.handlePointerUp),Tw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),K_(this.updatePoint)}}function eA(e,i){return i?{point:i(e.point)}:e}function NO(e,i){return{x:e.x-i.x,y:e.y-i.y}}function tA({point:e},i){return{point:e,delta:NO(e,LV(i)),offset:NO(e,Joe(i)),velocity:Qoe(i,.1)}}function Joe(e){return e[0]}function LV(e){return e[e.length-1]}function Qoe(e,i){if(e.length<2)return{x:0,y:0};let s=e.length-1,l=null;const p=LV(e);for(;s>=0&&(l=e[s],!(p.timestamp-l.timestamp>Em(i)));)s--;if(!l)return{x:0,y:0};const _=Dg(p.timestamp-l.timestamp);if(_===0)return{x:0,y:0};const b={x:(p.x-l.x)/_,y:(p.y-l.y)/_};return b.x===1/0&&(b.x=0),b.y===1/0&&(b.y=0),b}const VO=()=>({min:0,max:0});function eae(){return{x:VO(),y:VO()}}function xg(e){return[e("x"),e("y")]}function tae(e){return!!(Vc(e)&&e.add)}function jO(e,i){const s=e.getValue("willChange");if(tae(s))return s.add(i)}function RV({top:e,left:i,right:s,bottom:l}){return{x:{min:i,max:s},y:{min:e,max:l}}}function iae(e,i){if(!i)return e;const s=i({x:e.left,y:e.top}),l=i({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:l.y,right:l.x}}function nae({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function UO(e,i){e.min=e.min+i,e.max=e.max+i}function rae(e,i){return RV(iae(e.getBoundingClientRect(),i))}function sae(e,i,s){const l=rae(e,s),{scroll:p}=i;return p&&(UO(l.x,p.offset.x),UO(l.y,p.offset.y)),l}function $O(e){return!nb.has(e.current)}function zV({current:e}){return e?e.ownerDocument.defaultView:null}const oae=new WeakMap;class aae{constructor(i){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=eae(),this.visualElement=i}start(i,{snapToCursor:s=!1}={}){if(!$O(this.visualElement))return;const l=O=>{const{dragSnapToOrigin:F}=this.getProps();F?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(uk(O,"page").point)},p=(O,F)=>{const{drag:$,dragPropagation:W,onDragStart:Y}=this.getProps();if($&&!W&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Goe($),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),xg(se=>{let ie=this.getAxisMotionValue(se).get()||0;if(Lg.test(ie)){const{projection:pe}=this.visualElement;if(pe&&pe.layout){const ye=pe.layout.layoutBox[se];ye&&(ie=DP(ye)*(parseFloat(ie)/100))}}this.originPoint[se]=ie}),Y&&ml.postRender(()=>Y(O,F)),jO(this.visualElement,"transform"),this.visualElement.state.setActive("whileDrag",!0)},_=(O,F)=>{const{dragPropagation:$,dragDirectionLock:W,onDirectionLock:Y,onDrag:ae}=this.getProps();if(!$&&!this.openGlobalLock)return;const{offset:se}=F;if(W&&this.currentDirection===null){this.currentDirection=lae(se),this.currentDirection!==null&&Y&&Y(this.currentDirection);return}this.updateAxis("x",F.point,se),this.updateAxis("y",F.point,se),this.visualElement.render(),ae&&ae(O,F)},b=(O,F)=>this.stop(O,F),t=()=>xg(O=>{var F;return this.getAnimationState(O)==="paused"&&((F=this.getAxisMotionValue(O).animation)==null?void 0:F.play())}),{dragSnapToOrigin:P}=this.getProps();this.panSession=new DV(i,{onSessionStart:l,onStart:p,onMove:_,onSessionEnd:b,resumeAnimation:t},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:P,contextWindow:zV(this.visualElement)})}stop(i,s){const l=this.isDragging;if(this.cancel(),!l)return;const{velocity:p}=s;this.startAnimation(p);const{onDragEnd:_}=this.getProps();_&&ml.postRender(()=>_(i,s))}cancel(){this.isDragging=!1;const{projection:i,animationState:s}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),this.visualElement.state.setActive("whileDrag",!1)}updateAxis(i,s,l){const{drag:p}=this.getProps();if(!l||!hS(i,p,this.currentDirection))return;const _=this.getAxisMotionValue(i);let b=this.originPoint[i]+l[i];this.constraints&&this.constraints[i]&&(b=qoe(b,this.constraints[i],this.elastic[i])),_.set(b)}resolveConstraints(){var i;const{dragConstraints:s,dragElastic:l}=this.getProps(),p=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,_=this.constraints;s&&iw(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&p?this.constraints=Hoe(p.layoutBox,s):this.constraints=!1,this.elastic=Woe(l),_!==this.constraints&&p&&this.constraints&&!this.hasMutatedConstraints&&xg(b=>{this.constraints!==!1&&this.getAxisMotionValue(b)&&(this.constraints[b]=Zoe(p.layoutBox[b],this.constraints[b]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:s}=this.getProps();if(!i||!iw(i))return!1;const l=i,{projection:p}=this.visualElement;if(!p||!p.layout)return!1;const _=sae(l,p.root,this.visualElement.getTransformPagePoint());let b=Xoe(p.layout.layoutBox,_);if(s){const t=s(nae(b));this.hasMutatedConstraints=!!t,t&&(b=RV(t))}return b}startAnimation(i){const{drag:s,dragMomentum:l,dragElastic:p,dragTransition:_,dragSnapToOrigin:b,onDragTransitionEnd:t}=this.getProps(),P=this.constraints||{},O=xg(F=>{if(!hS(F,s,this.currentDirection))return;let $=P&&P[F]||{};b&&($={min:0,max:0});const W=p?200:1e6,Y=p?40:1e7,ae={type:"inertia",velocity:l?i[F]:0,bounceStiffness:W,bounceDamping:Y,timeConstant:750,restDelta:1,restSpeed:10,..._,...$};return this.startAxisValueAnimation(F,ae)});return Promise.all(O).then(t)}startAxisValueAnimation(i,s){const l=this.getAxisMotionValue(i);return jO(this.visualElement,i),l.start(lk(i,l,0,s,this.visualElement,!1))}stopAnimation(){$O(this.visualElement)&&xg(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){xg(i=>{var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.pause()})}getAnimationState(i){var s;return(s=this.getAxisMotionValue(i).animation)==null?void 0:s.state}getAxisMotionValue(i){const s=`_drag${i.toUpperCase()}`,l=this.visualElement.getProps();return l[s]||this.visualElement.getValue(i,(l.initial?l.initial[i]:void 0)||0)}snapToCursor(i){xg(s=>{const{drag:l}=this.getProps();if(!hS(s,l,this.currentDirection))return;const{projection:p}=this.visualElement,_=this.getAxisMotionValue(s);if(p&&p.layout){const{min:b,max:t}=p.layout.layoutBox[s];_.set(i[s]-zl(b,t,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:s}=this.getProps(),{projection:l}=this.visualElement;if(!iw(s)||!l||!this.constraints)return;this.stopAnimation();const p={x:0,y:0};xg(b=>{const t=this.getAxisMotionValue(b);if(t&&this.constraints!==!1){const P=t.get();p[b]=Yoe({min:P,max:P},this.constraints[b])}});const{transformTemplate:_}=this.visualElement.getProps();this.visualElement.current.style.transform=_?_({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),xg(b=>{if(!hS(b,i,null))return;const t=this.getAxisMotionValue(b),{min:P,max:O}=this.constraints[b];t.set(zl(P,O,p[b]))})}addListeners(){if(!this.visualElement.current)return;oae.set(this.visualElement,this);const i=this.visualElement.current,s=Tw(i,"pointerdown",P=>{const{drag:O,dragListener:F=!0}=this.getProps();O&&F&&this.start(P)}),l=()=>{const{dragConstraints:P}=this.getProps();iw(P)&&(this.constraints=this.resolveRefConstraints())},{projection:p}=this.visualElement,_=p.addEventListener("measure",l);p&&!p.layout&&(p.root&&p.root.updateScroll(),p.updateLayout()),ml.read(l);const b=EE(window,"resize",()=>this.scalePositionWithinConstraints()),t=p.addEventListener("didUpdate",({delta:P,hasLayoutChanged:O})=>{this.isDragging&&O&&(xg(F=>{const $=this.getAxisMotionValue(F);$&&(this.originPoint[F]+=P[F].translate,$.set($.get()+P[F].translate))}),this.visualElement.render())});return()=>{b(),s(),_(),t&&t()}}getProps(){const i=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:l=!1,dragPropagation:p=!1,dragConstraints:_=!1,dragElastic:b=LP,dragMomentum:t=!0}=i;return{...i,drag:s,dragDirectionLock:l,dragPropagation:p,dragConstraints:_,dragElastic:b,dragMomentum:t}}}function hS(e,i,s){return(i===!0||i===e)&&(s===null||s===e)}function lae(e,i=10){let s=null;return Math.abs(e.y)>i?s="y":Math.abs(e.x)>i&&(s="x"),s}class cae extends iy{constructor(i){super(i),this.removeGroupControls=qd,this.removeListeners=qd,this.controls=new aae(i.visualElement)}mount(){const{dragControls:i}=this.state.options;i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||qd}unmount(){this.removeGroupControls(),this.removeListeners()}}class uae extends iy{constructor(i){super(i),iN(PV)}beforeUpdate(){this.state.willUpdate("beforeUpdate")}update(){this.didUpdate()}didUpdate(){var i,s;(this.state.options.layout||this.state.options.layoutId||this.state.options.drag)&&((s=(i=this.state.visualElement.projection)==null?void 0:i.root)==null||s.didUpdate())}mount(){var i;const s=this.state.options,l=this.state.options.layoutGroup;if(s.layout||s.layoutId){const p=this.state.visualElement.projection;p&&(p.promote(),(i=l?.group)==null||i.add(p)),$S.hasEverUpdated=!0}this.didUpdate()}beforeUnmount(){const i=this.state.visualElement.projection;i&&(this.state.willUpdate("beforeUnmount"),this.state.options.layoutId?(i.isPresent=!1,i.relegate()):this.state.options.layout&&(this.state.isSafeToRemove=!0))}unmount(){const i=this.state.options.layoutGroup,s=this.state.visualElement.projection;s&&(i?.group&&(this.state.options.layout||this.state.options.layoutId)&&i.group.remove(s),this.didUpdate())}}function GO(e){return(i,s)=>{e&&ml.postRender(()=>e(i,s))}}class hae extends iy{constructor(){super(...arguments),this.removePointerDownListener=qd}onPointerDown(i){this.session=new DV(i,this.createPanHandlers(),{transformPagePoint:this.state.visualElement.getTransformPagePoint(),contextWindow:zV(this.state.visualElement)})}createPanHandlers(){return{onSessionStart:GO((i,s)=>{const{onPanSessionStart:l}=this.state.options;l&&l(i,s)}),onStart:GO((i,s)=>{const{onPanStart:l}=this.state.options;l&&l(i,s)}),onMove:(i,s)=>{const{onPan:l}=this.state.options;l&&l(i,s)},onEnd:(i,s)=>{const{onPanEnd:l}=this.state.options;delete this.session,l&&ml.postRender(()=>l(i,s))}}}mount(){this.removePointerDownListener=Tw(this.state.element,"pointerdown",this.onPointerDown.bind(this))}update(){}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const dae=[Nse,Zse,Yse,Qse,toe,Uoe,hae,cae,uae],fae={reducedMotion:"never",transition:void 0,nonce:void 0},[pae]=n2("MotionConfig");function OV(){return pae(Ei(()=>fae))}function mae(e){const i=new WeakMap,s=OV();function l(_){if(e.mode!=="popLayout")return;const b=_.element,t=b.offsetParent,P=t instanceof HTMLElement&&t.offsetWidth||0,O={height:b.offsetHeight||0,width:b.offsetWidth||0,top:b.offsetTop,left:b.offsetLeft,right:0};O.right=P-O.width-O.left;const F=e.anchorX==="left"?`left: ${O.left}`:`right: ${O.right}`;_.element.dataset.motionPopId=_.id;const $=document.createElement("style");s.value.nonce&&($.nonce=s.value.nonce),i.set(_,$),document.head.appendChild($),$.sheet&&$.sheet.insertRule(`
    [data-motion-pop-id="${_.id}"] {
      position: absolute !important;
      width: ${O.width}px !important;
      height: ${O.height}px !important;
      top: ${O.top}px !important;
      ${F}px !important;
      }
      `)}function p(_){const b=i.get(_);b&&(i.delete(_),ml.render(()=>{document.head.removeChild(b)}))}return{addPopStyle:l,removePopStyle:p,styles:i}}function qO(e){return Promise.resolve().then(()=>{e()})}const ym=kr({name:"AnimatePresence",inheritAttrs:!0,__name:"AnimatePresence",props:{mode:{default:"sync"},initial:{type:Boolean,default:!0},as:{},custom:{},onExitComplete:{},anchorX:{default:"left"}},setup(e){const i=e;Ute(i);const{addPopStyle:s,removePopStyle:l,styles:p}=mae(i);function _(F){let $=F;for(;$;){if(_w.get($))return $;$=$.firstElementChild}return null}function b(F){const $=_w.get(F);$&&(l($),$.isVShow=!0,UC(F),qO(()=>{$.setActive("exit",!1)}))}const t=new Map;ru(()=>{t.clear()});function P(F,$){var W;const Y=_(F),ae=_w.get(Y);if(!Y||!ae){$(),t.size===0&&((W=i.onExitComplete)==null||W.call(i));return}t.set(Y,!0),UC(Y),s(ae);function se(ie){var pe,ye;if((pe=ie?.detail)!=null&&pe.isExit){const de=ae.visualElement.projection;if(de?.animationProgress>0&&!ae.isSafeToRemove&&!ae.isVShow)return;UC(Y),t.delete(Y),t.size===0&&((ye=i.onExitComplete)==null||ye.call(i)),p.has(ae)?l(ae):ae.willUpdate("done"),$(),Y.isConnected||ae.unmount(!0)}}qO(()=>{ae.setActive("exit",!0),nb.set(Y,se),Y.addEventListener("motioncomplete",se)})}const O=Ei(()=>i.mode!=="wait"?{tag:i.as}:{mode:i.mode==="wait"?"out-in":void 0});return(F,$)=>(li(),En(Cg(F.mode==="wait"?dw:J7),Oo({css:!1},O.value,{appear:"",onEnter:b,onLeave:P}),{default:Jn(()=>[Rs(F.$slots,"default")]),_:3},16))}});function Uw(e){if(e)return e.nodeType===3||e.nodeType===8?Uw(e.nextSibling):e}const[gae]=n2("LazyMotionContext");function _ae(e){const i=Mte(null),s=Dte({}),l=OV(),p=Vte({}),_=gae({features:an([]),strict:!1}),b=F5();function t(){return s.id&&e.layoutId?`${s.id}-${e.layoutId}`:e.layoutId||void 0}function P(){return{...e,lazyMotionContext:_,layoutId:t(),transition:e.transition??l.value.transition,layoutGroup:s,motionConfig:l.value,inViewOptions:e.inViewOptions??l.value.inViewOptions,animatePresenceContext:p,initial:p.initial===!1?p.initial:e.initial===!0?void 0:e.initial}}function O(){return{...b,...P()}}const F=new qte(O(),i);kte(F);function $(){var Y;const ae=F.type==="svg",se={...b};Object.keys(b).forEach(ye=>{Vc(b[ye])&&(se[ye]=b[ye].get())});let ie={...e.style,...ae?{}:((Y=F.visualElement)==null?void 0:Y.latestValues)||F.baseTarget};if(ae){const{attrs:ye,style:de}=aie({...F.isMounted()?F.target:F.baseTarget,...ie});(de.transform||ye.transformOrigin)&&(de.transformOrigin=ye.transformOrigin??"50% 50%",delete ye.transformOrigin),de.transform&&(de.transformBox=de.transformBox??"fill-box",delete ye.transformBox),Object.assign(se,ye),ie=de}e.drag&&e.dragListener!==!1&&Object.assign(ie,{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`});const pe=nie(ie);return pe&&(se.style=pe),se}const W=ba().proxy;return sM(()=>{F.beforeMount()}),La(()=>{F.mount(Uw(W.$el),O(),vae(W))}),Vf(()=>F.beforeUnmount()),ru(()=>{const Y=Uw(W.$el);Y?.isConnected||F.unmount()}),oM(()=>{F.beforeUpdate()}),xv(()=>{F.update(O())}),{getProps:P,getAttrs:$,layoutGroup:s,state:F}}const yae={ignoreStrict:{type:Boolean},forwardMotionProps:{type:Boolean,default:!1},asChild:{type:Boolean,default:!1},hover:{type:[String,Array,Object]},press:{type:[String,Array,Object]},inView:{type:[String,Array,Object]},focus:{type:[String,Array,Object]},whileDrag:{type:[String,Array,Object]},whileHover:{type:[String,Array,Object],default:({hover:e})=>e},whilePress:{type:[String,Array,Object],default:({press:e})=>e},whileInView:{type:[String,Array,Object],default:({inView:e})=>e},whileFocus:{type:[String,Array,Object],default:({focus:e})=>e},custom:{type:[String,Number,Object,Array]},initial:{type:[String,Array,Object,Boolean],default:void 0},animate:{type:[String,Array,Object],default:void 0},exit:{type:[String,Array,Object]},variants:{type:Object},inherit:{type:Boolean},style:{type:Object},transformTemplate:{type:Function},transition:{type:Object},layoutGroup:{type:Object},motionConfig:{type:Object},onAnimationComplete:{type:Function},onUpdate:{type:Function},layout:{type:[Boolean,String],default:!1},layoutId:{type:String,default:void 0},layoutScroll:{type:Boolean,default:!1},layoutRoot:{type:Boolean,default:!1},"data-framer-portal-id":{type:String},crossfade:{type:Boolean,default:!0},layoutDependency:{type:null},onBeforeLayoutMeasure:{type:Function},onLayoutMeasure:{type:Function},onLayoutAnimationStart:{type:Function},onLayoutAnimationComplete:{type:Function},globalPressTarget:{type:Boolean},onPressStart:{type:Function},onPress:{type:Function},onPressCancel:{type:Function},onHoverStart:{type:Function},onHoverEnd:{type:Function},inViewOptions:{type:Object},onViewportEnter:{type:Function},onViewportLeave:{type:Function},drag:{type:[Boolean,String]},dragSnapToOrigin:{type:Boolean},dragDirectionLock:{type:Boolean},dragPropagation:{type:Boolean},dragConstraints:{type:[Boolean,Object]},dragElastic:{type:[Boolean,Number,Object],default:.5},dragMomentum:{type:Boolean,default:!0},dragTransition:{type:Object},dragListener:{type:Boolean,default:!0},dragControls:{type:Object},onDragStart:{type:Function},onDragEnd:{type:Function},onDrag:{type:Function},onDirectionLock:{type:Function},onDragTransitionEnd:{type:Function},onMeasureDragConstraints:{type:Function},onPanSessionStart:{type:Function},onPanStart:{type:Function},onPan:{type:Function},onPanEnd:{type:Function}};function vae(e){var i;const s=((i=Uw(e.$el))==null?void 0:i.style.display)==="none";return e.$.vnode.transition&&s}const xae=new Map,bae=new Map;function wae(e){if(!Array.isArray(e))return[e];const i=[];for(const s of e)Array.isArray(s)?i.push(...s):i.push(s);return i}const Tae=["area","img","input"];function Sae(e,i,s){var l,p;if(typeof e=="string"&&Tae.includes(e))return Ns(e,i);if(e==="template"){if(!s.default)return null;const _=wae(s.default()),b=_.findIndex(F=>F.type!==uc);if(b===-1)return _;const t=_[b];(l=t.props)==null||delete l.ref;const P=t.props?Oo(i,t.props):i;i.class&&((p=t.props)!=null&&p.class)&&delete t.props.class;const O=kp(t,P);for(const F in P)F.startsWith("on")&&(O.props||(O.props={}),O.props[F]=P[F]);return _.length===1?O:(_[b]=O,_)}return null}function HO(e,i={}){var s;const l=typeof e=="string",p=l?e:e.name||"",_=((s=i.features)==null?void 0:s.length)>0?xae:bae;if(l&&_?.has(e))return _.get(e);const b=kr({inheritAttrs:!1,props:{...yae,features:{type:Object,default:()=>i.features||[]},as:{type:[String,Object],default:e||"div"}},name:p?`motion.${p}`:"Motion",setup(t,{slots:P}){const{getProps:O,getAttrs:F,state:$}=_ae(t);function W(){const Y=$.element;if((!(typeof t.as=="object")||t.asChild)&&Y){const{style:se}=F();if(se)for(const[ie,pe]of Object.entries(se))Y.style[ie]=pe}}return()=>{const Y=O(),ae=F(),se=t.asChild?"template":t.as,ie={...i.forwardMotionProps||t.forwardMotionProps?Y:{},...ae,onVnodeUpdated:W},pe=Sae(se,ie,P);return pe!==null?pe:Ns(se,{...ie},P)}}});return l&&_?.set(e,b),b}function Eae(e=[]){return new Proxy({},{get(i,s){return s==="create"?(l,p)=>HO(l,{...p,features:e}):HO(s,{features:e})}})}const Gl=Eae(dae);Gl.create("div");function Iae(){const e=an(null);return new Proxy(e,{get(s,l){if(typeof l=="string"||typeof l=="symbol")return Reflect.get(s,l)},set(s,l,p){return l==="value"?Reflect.set(s,l,Uw(p?.$el||p)):!0}})}const Cae={key:2,class:"text-[12px] text-white/80 pl-1"},Aae=kr({__name:"LivePhotoIndicator",props:{photo:{},isVideoPlaying:{type:Boolean},processingState:{}},setup(e){return(i,s)=>{const l=Wd;return e.photo.isLivePhoto?(li(),En(ut(Gl).div,{key:0,class:_s(["backdrop-blur-md rounded-full pl-1 pr-1.5 py-1 text-[13px] font-bold flex items-center gap-0.5 leading-0 select-none transition-colors duration-300",`${e.isVideoPlaying?"text-yellow-300 bg-yellow-300/10":"text-white bg-black/30"}`]),animate:{scale:e.isVideoPlaying?1.06:1},transition:{duration:.3,ease:"easeInOut"}},{default:Jn(()=>[e.processingState?.isProcessing?(li(),En(l,{key:0,name:"tabler:loader",class:"size-[17px] animate-spin"})):(li(),En(l,{key:1,name:"tabler:live-photo",class:"size-[17px]"})),Bn("span",null,Lr(i.$t("ui.livePhoto")),1),e.processingState?.isProcessing?(li(),ir("span",Cae,Lr(Math.round(e.processingState.progress||0))+"% ",1)):gr("",!0)]),_:1},8,["class","animate"])):gr("",!0)}}}),Pae=Object.assign(Aae,{__name:"PhotoLivePhotoIndicator"}),Mae=kr({__name:"GlassButton",props:{class:{default:""},size:{default:"md"},rounded:{type:Boolean,default:!1},icon:{default:""}},emits:["click"],setup(e){const i={sm:"h-9 min-w-9 text-sm",md:"h-12 min-w-12 text-base",lg:"h-14 min-w-14 text-lg"},s={sm:"text-lg",md:"text-xl",lg:"text-2xl"};return(l,p)=>{const _=Wd;return li(),En(ut(Gl).button,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},"while-hover":{scale:1.1},"while-press":{scale:.95},transition:{type:"spring",stiffness:300,damping:20},type:"button",class:_s(ut(q_)("px-2 cursor-pointer pointer-events-auto font-medium flex items-center justify-center gap-1.5 bg-white/30 text-neutral-700 backdrop-blur-md border border-neutral-100 shadow-md shadow-neutral-300/20 dark:bg-neutral-700/30 dark:text-white/80 dark:border-white/10 dark:shadow-black/20 overflow-hidden",i[l.$props.size],l.$props.rounded?"rounded-full":"rounded-xl",l.$props.class)),onClick:p[0]||(p[0]=b=>l.$emit("click"))},{default:Jn(()=>[e.icon?(li(),En(_,{key:0,name:e.icon,class:_s(ut(q_)("inline-block shrink-0 -mt-0.5",s[l.$props.size]))},null,8,["name","class"])):gr("",!0),Rs(l.$slots,"default")]),_:3},8,["class"])}}}),kae=Object.assign(Mae,{__name:"GlassButton"});function l2(e,i){const s=typeof e=="string"&&!i?`${e}Context`:i,l=Symbol(s);return[b=>{const t=Fo(l,b);if(t||t===null)return t;throw new Error(`Injection \`${l.toString()}\` not found. Component must be used within ${Array.isArray(e)?`one of the following components: ${e.join(", ")}`:`\`${e}\``}`)},b=>(Ka(l,b),b)]}function ob(){let e=document.activeElement;if(e==null)return null;for(;e!=null&&e.shadowRoot!=null&&e.shadowRoot.activeElement!=null;)e=e.shadowRoot.activeElement;return e}function FV(e,i,s){const l=s.originalEvent.target,p=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:s});i&&l.addEventListener(e,i,{once:!0}),l.dispatchEvent(p)}function BV(e){return e==null}function hk(e){return e?e.flatMap(i=>i.type===qs?hk(i.children):[i]):[]}const[g_e,Dae]=l2("ConfigProvider");var Lae=kr({inheritAttrs:!1,__name:"ConfigProvider",props:{dir:{type:String,required:!1,default:"ltr"},locale:{type:String,required:!1,default:"en"},scrollBody:{type:[Boolean,Object],required:!1,default:!0},nonce:{type:String,required:!1,default:void 0},useId:{type:Function,required:!1,default:void 0}},setup(e){const i=e,{dir:s,locale:l,scrollBody:p,nonce:_}=Mp(i);return Dae({dir:s,locale:l,scrollBody:p,nonce:_,useId:i.useId}),(b,t)=>Rs(b.$slots,"default")}}),Rae=Lae;function __e(e,i){var s;const l=so();return Ph(()=>{l.value=e()},{...i,flush:(s=void 0)!=null?s:"sync"}),Pp(l)}function zae(e,i){let s,l,p;const _=so(!0),b=()=>{_.value=!0,p()};Qn(e,b,{flush:"sync"});const t=typeof i=="function"?i:i.get,P=typeof i=="function"?void 0:i.set,O=cb((F,$)=>(l=F,p=$,{get(){return _.value&&(s=t(s),_.value=!1),l(),s},set(W){P?.(W)}}));return Object.isExtensible(O)&&(O.trigger=b),O}function ny(e){return Rp()?(H_(e),!0):!1}function y_e(){const e=new Set,i=_=>{e.delete(_)};return{on:_=>{e.add(_);const b=()=>i(_);return ny(b),{off:b}},off:i,trigger:(..._)=>Promise.all(Array.from(e).map(b=>b(..._))),clear:()=>{e.clear()}}}function v_e(e){let i=!1,s;const l=s0(!0);return(...p)=>(i||(s=l.run(()=>e(...p)),i=!0),s)}function x_e(e){let i=0,s,l;const p=()=>{i-=1,l&&i<=0&&(l.stop(),s=void 0,l=void 0)};return(..._)=>(i+=1,l||(l=s0(!0),s=l.run(()=>e(..._))),ny(p),s)}function Oae(e){if(!Wo(e))return Ol(e);const i=new Proxy({},{get(s,l,p){return ut(Reflect.get(e.value,l,p))},set(s,l,p){return Wo(e.value[l])&&!Wo(p)?e.value[l].value=p:e.value[l]=p,!0},deleteProperty(s,l){return Reflect.deleteProperty(e.value,l)},has(s,l){return Reflect.has(e.value,l)},ownKeys(){return Object.keys(e.value)},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}}});return Ol(i)}function Fae(e){return Oae(Ei(e))}function b_e(e,...i){const s=i.flat(),l=s[0];return Fae(()=>Object.fromEntries(typeof l=="function"?Object.entries(Mp(e)).filter(([p,_])=>!l(Rr(_),p)):Object.entries(Mp(e)).filter(p=>!s.includes(p[0]))))}const bv=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Bae=e=>typeof e<"u",Nae=e=>e!=null,Vae=Object.prototype.toString,jae=e=>Vae.call(e)==="[object Object]",$w=()=>{},w_e=Uae();function Uae(){var e,i;return bv&&((e=window?.navigator)==null?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((i=window?.navigator)==null?void 0:i.maxTouchPoints)>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function NV(e,i){function s(...l){return new Promise((p,_)=>{Promise.resolve(e(()=>i.apply(this,l),{fn:i,thisArg:this,args:l})).then(p).catch(_)})}return s}const VV=e=>e();function $ae(e,i={}){let s,l,p=$w;const _=P=>{clearTimeout(P),p(),p=$w};let b;return P=>{const O=Rr(e),F=Rr(i.maxWait);return s&&_(s),O<=0||F!==void 0&&F<=0?(l&&(_(l),l=null),Promise.resolve(P())):new Promise(($,W)=>{p=i.rejectOnCancel?W:$,b=P,F&&!l&&(l=setTimeout(()=>{s&&_(s),l=null,$(b())},F)),s=setTimeout(()=>{l&&_(l),l=null,$(P())},O)})}}function Gae(e=VV,i={}){const{initialState:s="active"}=i,l=qae(s==="active");function p(){l.value=!1}function _(){l.value=!0}const b=(...t)=>{l.value&&e(...t)};return{isActive:Pp(l),pause:p,resume:_,eventFilter:b}}function jV(e){return ba()}function GS(e){return Array.isArray(e)?e:[e]}function qae(...e){if(e.length!==1)return Nc(...e);const i=e[0];return typeof i=="function"?Pp(cb(()=>({get:i,set:$w}))):an(i)}function T_e(e,i=1e4){return cb((s,l)=>{let p=Rr(e),_;const b=()=>setTimeout(()=>{p=Rr(e),l()},Rr(i));return ny(()=>{clearTimeout(_)}),{get(){return s(),p},set(t){p=t,l(),clearTimeout(_),_=b()}}})}function S_e(e,i=200,s={}){return NV($ae(i,s),e)}function Hae(e,i,s={}){const{eventFilter:l=VV,...p}=s;return Qn(e,NV(l,i),p)}function WO(e,i,s={}){const{eventFilter:l,initialState:p="active",..._}=s,{eventFilter:b,pause:t,resume:P,isActive:O}=Gae(l,{initialState:p});return{stop:Hae(e,i,{..._,eventFilter:b}),pause:t,resume:P,isActive:O}}function E_e(e,i,...[s]){const{flush:l="sync",deep:p=!1,immediate:_=!0,direction:b="both",transform:t={}}=s||{},P=[],O="ltr"in t&&t.ltr||(W=>W),F="rtl"in t&&t.rtl||(W=>W);return(b==="both"||b==="ltr")&&P.push(WO(e,W=>{P.forEach(Y=>Y.pause()),i.value=O(W),P.forEach(Y=>Y.resume())},{flush:l,deep:p,immediate:_})),(b==="both"||b==="rtl")&&P.push(WO(i,W=>{P.forEach(Y=>Y.pause()),e.value=F(W),P.forEach(Y=>Y.resume())},{flush:l,deep:p,immediate:_})),()=>{P.forEach(W=>W.stop())}}function I_e(e,i){jV()&&Vf(e,i)}function Wae(e,i=!0,s){jV()?La(e,s):i?e():Da(e)}function UV(e,i,s={}){const{immediate:l=!0,immediateCallback:p=!1}=s,_=so(!1);let b=null;function t(){b&&(clearTimeout(b),b=null)}function P(){_.value=!1,t()}function O(...F){p&&e(),t(),_.value=!0,b=setTimeout(()=>{_.value=!1,b=null,e(...F)},Rr(i))}return l&&(_.value=!0,bv&&O()),ny(P),{isPending:Pp(_),start:O,stop:P}}function Zae(e=1e3,i={}){const{controls:s=!1,callback:l}=i,p=UV(l??$w,e,i),_=Ei(()=>!p.isPending.value);return s?{ready:_,...p}:_}function Xae(e,i,s){return Qn(e,i,{...s,immediate:!0})}const ry=bv?window:void 0;function Lp(e){var i;const s=Rr(e);return(i=s?.$el)!=null?i:s}function Gw(...e){const i=[],s=()=>{i.forEach(t=>t()),i.length=0},l=(t,P,O,F)=>(t.addEventListener(P,O,F),()=>t.removeEventListener(P,O,F)),p=Ei(()=>{const t=GS(Rr(e[0])).filter(P=>P!=null);return t.every(P=>typeof P!="string")?t:void 0}),_=Xae(()=>{var t,P;return[(P=(t=p.value)==null?void 0:t.map(O=>Lp(O)))!=null?P:[ry].filter(O=>O!=null),GS(Rr(p.value?e[1]:e[0])),GS(ut(p.value?e[2]:e[1])),Rr(p.value?e[3]:e[2])]},([t,P,O,F])=>{if(s(),!t?.length||!P?.length||!O?.length)return;const $=jae(F)?{...F}:F;i.push(...t.flatMap(W=>P.flatMap(Y=>O.map(ae=>l(W,Y,ae,$)))))},{flush:"post"}),b=()=>{_(),s()};return ny(s),b}function $V(){const e=so(!1),i=ba();return i&&La(()=>{e.value=!0},i),e}function GV(e){const i=$V();return Ei(()=>(i.value,!!e()))}function Yae(e,i,s={}){const{window:l=ry,...p}=s;let _;const b=GV(()=>l&&"MutationObserver"in l),t=()=>{_&&(_.disconnect(),_=void 0)},P=Ei(()=>{const W=Rr(e),Y=GS(W).map(Lp).filter(Nae);return new Set(Y)}),O=Qn(()=>P.value,W=>{t(),b.value&&W.size&&(_=new MutationObserver(i),W.forEach(Y=>_.observe(Y,p)))},{immediate:!0,flush:"post"}),F=()=>_?.takeRecords(),$=()=>{O(),t()};return ny($),{isSupported:b,stop:$,takeRecords:F}}function Kae(e,i,s={}){const{window:l=ry,document:p=l?.document,flush:_="sync"}=s;if(!l||!p)return $w;let b;const t=F=>{b?.(),b=F},P=Ph(()=>{const F=Lp(e);if(F){const{stop:$}=Yae(p,W=>{W.map(ae=>[...ae.removedNodes]).flat().some(ae=>ae===F||ae.contains(F))&&i(W)},{window:l,childList:!0,subtree:!0});t($)}},{flush:_}),O=()=>{P(),t()};return ny(O),O}function Jae(e){return typeof e=="function"?e:typeof e=="string"?i=>i.key===e:Array.isArray(e)?i=>e.includes(i.key):()=>!0}function dk(...e){let i,s,l={};e.length===3?(i=e[0],s=e[1],l=e[2]):e.length===2?typeof e[1]=="object"?(i=!0,s=e[0],l=e[1]):(i=e[0],s=e[1]):(i=!0,s=e[0]);const{target:p=ry,eventName:_="keydown",passive:b=!1,dedupe:t=!1}=l,P=Jae(i);return Gw(p,_,F=>{F.repeat&&Rr(t)||P(F)&&s(F)},b)}function Qae(e={}){var i;const{window:s=ry,deep:l=!0,triggerOnRemoval:p=!1}=e,_=(i=e.document)!=null?i:s?.document,b=()=>{var O;let F=_?.activeElement;if(l)for(;F?.shadowRoot;)F=(O=F?.shadowRoot)==null?void 0:O.activeElement;return F},t=so(),P=()=>{t.value=b()};if(s){const O={capture:!0,passive:!0};Gw(s,"blur",F=>{F.relatedTarget===null&&P()},O),Gw(s,"focus",P,O)}return p&&Kae(t,P,{document:_}),P(),t}function qV(e,i={}){const{immediate:s=!0,fpsLimit:l=void 0,window:p=ry,once:_=!1}=i,b=so(!1),t=Ei(()=>l?1e3/Rr(l):null);let P=0,O=null;function F(Y){if(!b.value||!p)return;P||(P=Y);const ae=Y-P;if(t.value&&ae<t.value){O=p.requestAnimationFrame(F);return}if(P=Y,e({delta:ae,timestamp:Y}),_){b.value=!1,O=null;return}O=p.requestAnimationFrame(F)}function $(){!b.value&&p&&(b.value=!0,P=0,O=p.requestAnimationFrame(F))}function W(){b.value=!1,O!=null&&p&&(p.cancelAnimationFrame(O),O=null)}return s&&$(),ny(W),{isActive:Pp(b),pause:W,resume:$}}function ele(e){return JSON.parse(JSON.stringify(e))}function tle(e){const i=ba(),s=zae(()=>null,()=>i.proxy.$el);return xv(s.trigger),La(s.trigger),s}function C_e(e,i,s={}){const{window:l=ry,...p}=s;let _;const b=GV(()=>l&&"ResizeObserver"in l),t=()=>{_&&(_.disconnect(),_=void 0)},P=Ei(()=>{const $=Rr(e);return Array.isArray($)?$.map(W=>Lp(W)):[Lp($)]}),O=Qn(P,$=>{if(t(),b.value&&l){_=new ResizeObserver(i);for(const W of $)W&&_.observe(W,p)}},{immediate:!0,flush:"post"}),F=()=>{t(),O()};return ny(F),{isSupported:b,stop:F}}const ile="focusin",nle="focusout",rle=":focus-within";function A_e(e,i={}){const{window:s=ry}=i,l=Ei(()=>Lp(e)),p=so(!1),_=Ei(()=>p.value),b=Qae(i);if(!s||!b.value)return{focused:_};const t={passive:!0};return Gw(l,ile,()=>p.value=!0,t),Gw(l,nle,()=>{var P,O,F;return p.value=(F=(O=(P=l.value)==null?void 0:P.matches)==null?void 0:O.call(P,rle))!=null?F:!1},t),{focused:_}}function P_e(e=tle()){const i=so(),s=()=>{const l=Lp(e);l&&(i.value=l.parentElement)};return Wae(s),Qn(()=>Rr(e),s),i}function RP(e,i,s,l={}){var p,_,b;const{clone:t=!1,passive:P=!1,eventName:O,deep:F=!1,defaultValue:$,shouldEmit:W}=l,Y=ba(),ae=s||Y?.emit||((p=Y?.$emit)==null?void 0:p.bind(Y))||((b=(_=Y?.proxy)==null?void 0:_.$emit)==null?void 0:b.bind(Y?.proxy));let se=O;i||(i="modelValue"),se=se||`update:${i.toString()}`;const ie=de=>t?typeof t=="function"?t(de):ele(de):de,pe=()=>Bae(e[i])?ie(e[i]):$,ye=de=>{W?W(de)&&ae(se,de):ae(se,de)};if(P){const de=pe(),Ee=an(de);let Pe=!1;return Qn(()=>e[i],Ze=>{Pe||(Pe=!0,Ee.value=ie(Ze),Da(()=>Pe=!1))}),Qn(Ee,Ze=>{!Pe&&(Ze!==e[i]||F)&&ye(Ze)},{deep:F}),Ee}else return Ei({get(){return pe()},set(de){ye(de)}})}function sle(e){const i=ba(),s=i?.type.emits,l={};return s?.length||console.warn(`No emitted event found. Please check component: ${i?.type.__name}`),s?.forEach(p=>{l[sw(cd(p))]=(..._)=>e(p,..._)}),l}function zp(){const e=ba(),i=an(),s=Ei(()=>["#text","#comment"].includes(i.value?.$el.nodeName)?i.value?.$el.nextElementSibling:Lp(i)),l=Object.assign({},e.exposed),p={};for(const b in e.props)Object.defineProperty(p,b,{enumerable:!0,configurable:!0,get:()=>e.props[b]});if(Object.keys(l).length>0)for(const b in l)Object.defineProperty(p,b,{enumerable:!0,configurable:!0,get:()=>l[b]});Object.defineProperty(p,"$el",{enumerable:!0,configurable:!0,get:()=>e.vnode.el}),e.exposed=p;function _(b){i.value=b,b&&(Object.defineProperty(p,"$el",{enumerable:!0,configurable:!0,get:()=>b instanceof Element?b:b.$el}),e.exposed=p)}return{forwardRef:_,currentRef:i,currentElement:s}}function xb(e){const i=ba(),s=Object.keys(i?.type.props??{}).reduce((p,_)=>{const b=(i?.type.props[_]).default;return b!==void 0&&(p[_]=b),p},{}),l=Nc(e);return Ei(()=>{const p={},_=i?.vnode.props??{};return Object.keys(_).forEach(b=>{p[cd(b)]=_[b]}),Object.keys({...s,...p}).reduce((b,t)=>(l.value[t]!==void 0&&(b[t]=l.value[t]),b),{})})}function HV(e,i){const s=xb(e),l=i?sle(i):{};return Ei(()=>({...s.value,...l}))}function ole(e,i){const s=an(e);function l(_){return i[s.value][_]??s.value}return{state:s,dispatch:_=>{s.value=l(_)}}}function ale(e,i){const s=an({}),l=an("none"),p=an(e),_=e.value?"mounted":"unmounted";let b;const t=i.value?.ownerDocument.defaultView??ry,{state:P,dispatch:O}=ole(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}}),F=ie=>{if(bv){const pe=new CustomEvent(ie,{bubbles:!1,cancelable:!1});i.value?.dispatchEvent(pe)}};Qn(e,async(ie,pe)=>{const ye=pe!==ie;if(await Da(),ye){const de=l.value,Ee=dS(i.value);ie?(O("MOUNT"),F("enter"),Ee==="none"&&F("after-enter")):Ee==="none"||Ee==="undefined"||s.value?.display==="none"?(O("UNMOUNT"),F("leave"),F("after-leave")):pe&&de!==Ee?(O("ANIMATION_OUT"),F("leave")):(O("UNMOUNT"),F("after-leave"))}},{immediate:!0});const $=ie=>{const pe=dS(i.value),ye=pe.includes(CSS.escape(ie.animationName)),de=P.value==="mounted"?"enter":"leave";if(ie.target===i.value&&ye&&(F(`after-${de}`),O("ANIMATION_END"),!p.value)){const Ee=i.value.style.animationFillMode;i.value.style.animationFillMode="forwards",b=t?.setTimeout(()=>{i.value?.style.animationFillMode==="forwards"&&(i.value.style.animationFillMode=Ee)})}ie.target===i.value&&pe==="none"&&O("ANIMATION_END")},W=ie=>{ie.target===i.value&&(l.value=dS(i.value))},Y=Qn(i,(ie,pe)=>{ie?(s.value=getComputedStyle(ie),ie.addEventListener("animationstart",W),ie.addEventListener("animationcancel",$),ie.addEventListener("animationend",$)):(O("ANIMATION_END"),b!==void 0&&t?.clearTimeout(b),pe?.removeEventListener("animationstart",W),pe?.removeEventListener("animationcancel",$),pe?.removeEventListener("animationend",$))},{immediate:!0}),ae=Qn(P,()=>{const ie=dS(i.value);l.value=P.value==="mounted"?ie:"none"});return ru(()=>{Y(),ae()}),{isPresent:Ei(()=>["mounted","unmountSuspended"].includes(P.value))}}function dS(e){return e&&getComputedStyle(e).animationName||"none"}var lle=kr({name:"Presence",props:{present:{type:Boolean,required:!0},forceMount:{type:Boolean}},slots:{},setup(e,{slots:i,expose:s}){const{present:l,forceMount:p}=Mp(e),_=an(),{isPresent:b}=ale(l,_);s({present:b});let t=i.default({present:b.value});t=hk(t||[]);const P=ba();if(t&&t?.length>1){const O=P?.parent?.type.name?`<${P.parent.type.name} />`:"component";throw new Error([`Detected an invalid children for \`${O}\` for  \`Presence\` component.`,"","Note: Presence works similarly to `v-if` directly, but it waits for animation/transition to finished before unmounting. So it expect only one direct child of valid VNode type.","You can apply a few solutions:",["Provide a single child element so that `presence` directive attach correctly.","Ensure the first child is an actual element instead of a raw text node or comment node."].map(F=>`  - ${F}`).join(`
`)].join(`
`))}return()=>p.value||l.value||b.value?Ns(i.default({present:b.value})[0],{ref:O=>{const F=Lp(O);return typeof F?.hasAttribute>"u"||(F?.hasAttribute("data-reka-popper-content-wrapper")?_.value=F.firstElementChild:_.value=F),F}}):null}});const qw=kr({name:"PrimitiveSlot",inheritAttrs:!1,setup(e,{attrs:i,slots:s}){return()=>{if(!s.default)return null;const l=hk(s.default()),p=l.findIndex(P=>P.type!==uc);if(p===-1)return l;const _=l[p];delete _.props?.ref;const b=_.props?Oo(i,_.props):i,t=kp({..._,props:{}},b);return l.length===1?t:(l[p]=t,l)}}}),cle=["area","img","input"],kh=kr({name:"Primitive",inheritAttrs:!1,props:{asChild:{type:Boolean,default:!1},as:{type:[String,Object],default:"div"}},setup(e,{attrs:i,slots:s}){const l=e.asChild?"template":e.as;return typeof l=="string"&&cle.includes(l)?()=>Ns(l,i):l!=="template"?()=>Ns(e.as,i,{default:s.default}):()=>Ns(qw,i,{default:s.default})}});function ZO(){const e=an(),i=Ei(()=>["#text","#comment"].includes(e.value?.$el.nodeName)?e.value?.$el.nextElementSibling:Lp(e));return{primitiveElement:e,currentElement:i}}const ule="dismissableLayer.pointerDownOutside",hle="dismissableLayer.focusOutside";function WV(e,i){const s=i.closest("[data-dismissable-layer]"),l=e.dataset.dismissableLayer===""?e:e.querySelector("[data-dismissable-layer]"),p=Array.from(e.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(s&&(l===s||p.indexOf(l)<p.indexOf(s)))}function dle(e,i,s=!0){const l=i?.value?.ownerDocument??globalThis?.document,p=an(!1),_=an(()=>{});return Ph(b=>{if(!bv||!Rr(s))return;const t=async O=>{const F=O.target;if(!(!i?.value||!F)){if(WV(i.value,F)){p.value=!1;return}if(O.target&&!p.value){let W=function(){FV(ule,e,$)};const $={originalEvent:O};O.pointerType==="touch"?(l.removeEventListener("click",_.value),_.value=W,l.addEventListener("click",_.value,{once:!0})):W()}else l.removeEventListener("click",_.value);p.value=!1}},P=window.setTimeout(()=>{l.addEventListener("pointerdown",t)},0);b(()=>{window.clearTimeout(P),l.removeEventListener("pointerdown",t),l.removeEventListener("click",_.value)})}),{onPointerDownCapture:()=>{Rr(s)&&(p.value=!0)}}}function fle(e,i,s=!0){const l=i?.value?.ownerDocument??globalThis?.document,p=an(!1);return Ph(_=>{if(!bv||!Rr(s))return;const b=async t=>{if(!i?.value)return;await Da(),await Da();const P=t.target;!i.value||!P||WV(i.value,P)||t.target&&!p.value&&FV(hle,e,{originalEvent:t})};l.addEventListener("focusin",b),_(()=>l.removeEventListener("focusin",b))}),{onFocusCapture:()=>{Rr(s)&&(p.value=!0)},onBlurCapture:()=>{Rr(s)&&(p.value=!1)}}}const gm=Ol({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set});var ple=kr({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(e,{emit:i}){const s=e,l=i,{forwardRef:p,currentElement:_}=zp(),b=Ei(()=>_.value?.ownerDocument??globalThis.document),t=Ei(()=>gm.layersRoot),P=Ei(()=>_.value?Array.from(t.value).indexOf(_.value):-1),O=Ei(()=>gm.layersWithOutsidePointerEventsDisabled.size>0),F=Ei(()=>{const ae=Array.from(t.value),[se]=[...gm.layersWithOutsidePointerEventsDisabled].slice(-1),ie=ae.indexOf(se);return P.value>=ie}),$=dle(async ae=>{const se=[...gm.branches].some(ie=>ie?.contains(ae.target));!F.value||se||(l("pointerDownOutside",ae),l("interactOutside",ae),await Da(),ae.defaultPrevented||l("dismiss"))},_),W=fle(ae=>{[...gm.branches].some(ie=>ie?.contains(ae.target))||(l("focusOutside",ae),l("interactOutside",ae),ae.defaultPrevented||l("dismiss"))},_);dk("Escape",ae=>{P.value===t.value.size-1&&(l("escapeKeyDown",ae),ae.defaultPrevented||l("dismiss"))});let Y;return Ph(ae=>{_.value&&(s.disableOutsidePointerEvents&&(gm.layersWithOutsidePointerEventsDisabled.size===0&&(Y=b.value.body.style.pointerEvents,b.value.body.style.pointerEvents="none"),gm.layersWithOutsidePointerEventsDisabled.add(_.value)),t.value.add(_.value),ae(()=>{s.disableOutsidePointerEvents&&gm.layersWithOutsidePointerEventsDisabled.size===1&&(b.value.body.style.pointerEvents=Y)}))}),Ph(ae=>{ae(()=>{_.value&&(t.value.delete(_.value),gm.layersWithOutsidePointerEventsDisabled.delete(_.value))})}),(ae,se)=>(li(),En(ut(kh),{ref:ut(p),"as-child":ae.asChild,as:ae.as,"data-dismissable-layer":"",style:Su({pointerEvents:O.value?F.value?"auto":"none":void 0}),onFocusCapture:ut(W).onFocusCapture,onBlurCapture:ut(W).onBlurCapture,onPointerdownCapture:ut($).onPointerDownCapture},{default:Jn(()=>[Rs(ae.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),M_e=ple,mle=kr({__name:"DismissableLayerBranch",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const i=e,{forwardRef:s,currentElement:l}=zp();return La(()=>{gm.branches.add(l.value)}),ru(()=>{gm.branches.delete(l.value)}),(p,_)=>(li(),En(ut(kh),Oo({ref:ut(s)},i),{default:Jn(()=>[Rs(p.$slots,"default")]),_:3},16))}}),gle=mle;const k_e="focusScope.autoFocusOnMount",D_e="focusScope.autoFocusOnUnmount",L_e={bubbles:!1,cancelable:!0};function iA(e,{select:i=!1}={}){const s=ob();for(const l of e)if(vle(l,{select:i}),ob()!==s)return!0}function R_e(e){const i=ZV(e),s=XO(i,e),l=XO(i.reverse(),e);return[s,l]}function ZV(e){const i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const p=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||p?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)i.push(s.currentNode);return i}function XO(e,i){for(const s of e)if(!_le(s,{upTo:i}))return s}function _le(e,{upTo:i}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(i!==void 0&&e===i)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function yle(e){return e instanceof HTMLInputElement&&"select"in e}function vle(e,{select:i=!1}={}){if(e&&e.focus){const s=ob();e.focus({preventScroll:!0}),e!==s&&yle(e)&&i&&e.select()}}var xle=kr({__name:"Teleport",props:{to:{type:null,required:!1,default:"body"},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(e){const i=$V();return(s,l)=>ut(i)||s.forceMount?(li(),En(UE,{key:0,to:s.to,disabled:s.disabled,defer:s.defer},[Rs(s.$slots,"default")],8,["to","disabled","defer"])):gr("v-if",!0)}}),ble=xle;const YO="data-reka-collection-item";function fk(e={}){const{key:i="",isProvider:s=!1}=e,l=`${i}CollectionProvider`;let p;if(s){const F=an(new Map);p={collectionRef:an(),itemMap:F},Ka(l,p)}else p=Fo(l);const _=(F=!1)=>{const $=p.collectionRef.value;if(!$)return[];const W=Array.from($.querySelectorAll(`[${YO}]`)),ae=Array.from(p.itemMap.value.values()).sort((se,ie)=>W.indexOf(se.ref)-W.indexOf(ie.ref));return F?ae:ae.filter(se=>se.ref.dataset.disabled!=="")},b=kr({name:"CollectionSlot",setup(F,{slots:$}){const{primitiveElement:W,currentElement:Y}=ZO();return Qn(Y,()=>{p.collectionRef.value=Y.value}),()=>Ns(qw,{ref:W},$)}}),t=kr({name:"CollectionItem",inheritAttrs:!1,props:{value:{validator:()=>!0}},setup(F,{slots:$,attrs:W}){const{primitiveElement:Y,currentElement:ae}=ZO();return Ph(se=>{if(ae.value){const ie=uv(ae.value);p.itemMap.value.set(ie,{ref:ae.value,value:F.value}),se(()=>p.itemMap.value.delete(ie))}}),()=>Ns(qw,{...W,[YO]:"",ref:Y},$)}}),P=Ei(()=>Array.from(p.itemMap.value.values())),O=Ei(()=>p.itemMap.value.size);return{getItems:_,reactiveItems:P,itemMapSize:O,CollectionSlot:b,CollectionItem:t}}var wle=kr({__name:"VisuallyHidden",props:{feature:{type:String,required:!1,default:"focusable"},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){return(i,s)=>(li(),En(ut(kh),{as:i.as,"as-child":i.asChild,"aria-hidden":i.feature==="focusable"?"true":void 0,"data-hidden":i.feature==="fully-hidden"?"":void 0,tabindex:i.feature==="fully-hidden"?"-1":void 0,style:{position:"absolute",border:0,width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",whiteSpace:"nowrap",wordWrap:"normal",top:"-1px",left:"-1px"}},{default:Jn(()=>[Rs(i.$slots,"default")]),_:3},8,["as","as-child","aria-hidden","data-hidden","tabindex"]))}}),XV=wle;const Hw=100,[Tle,Sle]=l2("ProgressRoot"),CE=e=>typeof e=="number";function Ele(e,i){return BV(e)||CE(e)&&!Number.isNaN(e)&&e<=i&&e>=0?e:(console.error(`Invalid prop \`value\` of value \`${e}\` supplied to \`ProgressRoot\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Hw} if no \`max\` prop is set)
  - \`null\`  or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`),null)}function Ile(e){return CE(e)&&!Number.isNaN(e)&&e>0?e:(console.error(`Invalid prop \`max\` of value \`${e}\` supplied to \`ProgressRoot\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Hw}\`.`),Hw)}var Cle=kr({__name:"ProgressRoot",props:{modelValue:{type:[Number,null],required:!1},max:{type:Number,required:!1,default:Hw},getValueLabel:{type:Function,required:!1,default:(e,i)=>CE(e)?`${Math.round(e/i*Hw)}%`:void 0},getValueText:{type:Function,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:modelValue","update:max"],setup(e,{emit:i}){const s=e,l=i;zp();const p=RP(s,"modelValue",l,{passive:s.modelValue===void 0}),_=RP(s,"max",l,{passive:s.max===void 0});Qn(()=>p.value,async t=>{const P=Ele(t,s.max);P!==t&&(await Da(),p.value=P)},{immediate:!0}),Qn(()=>s.max,t=>{const P=Ile(s.max);P!==t&&(_.value=P)},{immediate:!0});const b=Ei(()=>BV(p.value)?"indeterminate":p.value===_.value?"complete":"loading");return Sle({modelValue:p,max:_,progressState:b}),(t,P)=>(li(),En(ut(kh),{"as-child":t.asChild,as:t.as,"aria-valuemax":ut(_),"aria-valuemin":0,"aria-valuenow":CE(ut(p))?ut(p):void 0,"aria-valuetext":t.getValueText?.(ut(p),ut(_)),"aria-label":t.getValueLabel(ut(p),ut(_)),role:"progressbar","data-state":b.value,"data-value":ut(p)??void 0,"data-max":ut(_)},{default:Jn(()=>[Rs(t.$slots,"default",{modelValue:ut(p)})]),_:3},8,["as-child","as","aria-valuemax","aria-valuenow","aria-valuetext","aria-label","data-state","data-value","data-max"]))}}),Ale=Cle,Ple=kr({__name:"ProgressIndicator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const i=e,s=Tle();return zp(),(l,p)=>(li(),En(ut(kh),Oo(i,{"data-state":ut(s).progressState.value,"data-value":ut(s).modelValue?.value??void 0,"data-max":ut(s).max.value}),{default:Jn(()=>[Rs(l.$slots,"default")]),_:3},16,["data-state","data-value","data-max"]))}}),Mle=Ple,kle=kr({__name:"ToastAnnounceExclude",props:{altText:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){return(i,s)=>(li(),En(ut(kh),{as:i.as,"as-child":i.asChild,"data-reka-toast-announce-exclude":"","data-reka-toast-announce-alt":i.altText||void 0},{default:Jn(()=>[Rs(i.$slots,"default")]),_:3},8,["as","as-child","data-reka-toast-announce-alt"]))}}),YV=kle;const[pI,Dle]=l2("ToastProvider");var Lle=kr({inheritAttrs:!1,__name:"ToastProvider",props:{label:{type:String,required:!1,default:"Notification"},duration:{type:Number,required:!1,default:5e3},disableSwipe:{type:Boolean,required:!1},swipeDirection:{type:String,required:!1,default:"right"},swipeThreshold:{type:Number,required:!1,default:50}},setup(e){const i=e,{label:s,duration:l,disableSwipe:p,swipeDirection:_,swipeThreshold:b}=Mp(i);fk({isProvider:!0});const t=an(),P=an(0),O=an(!1),F=an(!1);if(i.label&&typeof i.label=="string"&&!i.label.trim()){const $="Invalid prop `label` supplied to `ToastProvider`. Expected non-empty `string`.";throw new Error($)}return Dle({label:s,duration:l,disableSwipe:p,swipeDirection:_,swipeThreshold:b,toastCount:P,viewport:t,onViewportChange($){t.value=$},onToastAdd(){P.value++},onToastRemove(){P.value--},isFocusedToastEscapeKeyDownRef:O,isClosePausedRef:F}),($,W)=>Rs($.$slots,"default")}}),Rle=Lle,zle=kr({__name:"ToastAnnounce",setup(e){const i=pI(),s=Zae(1e3),l=an(!1);return qV(()=>{l.value=!0}),(p,_)=>ut(s)||l.value?(li(),En(ut(XV),{key:0},{default:Jn(()=>[Gd(Lr(ut(i).label.value)+" ",1),Rs(p.$slots,"default")]),_:3})):gr("v-if",!0)}}),Ole=zle;const Fle="toast.swipeStart",Ble="toast.swipeMove",Nle="toast.swipeCancel",Vle="toast.swipeEnd",zP="toast.viewportPause",OP="toast.viewportResume";function fS(e,i,s){const l=s.originalEvent.currentTarget,p=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:s});i&&l.addEventListener(e,i,{once:!0}),l.dispatchEvent(p)}function KO(e,i,s=0){const l=Math.abs(e.x),p=Math.abs(e.y),_=l>p;return i==="left"||i==="right"?_&&l>s:!_&&p>s}function jle(e){return e.nodeType===e.ELEMENT_NODE}function KV(e){const i=[];return Array.from(e.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&i.push(l.textContent),jle(l)){const p=l.ariaHidden||l.hidden||l.style.display==="none",_=l.dataset.rekaToastAnnounceExclude==="";if(!p)if(_){const b=l.dataset.rekaToastAnnounceAlt;b&&i.push(b)}else i.push(...KV(l))}}),i}const[Ule,$le]=l2("ToastRoot");var Gle=kr({inheritAttrs:!1,__name:"ToastRootImpl",props:{type:{type:String,required:!1},open:{type:Boolean,required:!1,default:!1},duration:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["close","escapeKeyDown","pause","resume","swipeStart","swipeMove","swipeCancel","swipeEnd"],setup(e,{emit:i}){const s=e,l=i,{forwardRef:p,currentElement:_}=zp(),{CollectionItem:b}=fk(),t=pI(),P=an(null),O=an(null),F=Ei(()=>typeof s.duration=="number"?s.duration:t.duration.value),$=an(0),W=an(F.value),Y=an(0),ae=an(F.value),se=qV(()=>{const de=new Date().getTime()-$.value;ae.value=Math.max(W.value-de,0)},{fpsLimit:60});function ie(de){de<=0||de===Number.POSITIVE_INFINITY||bv&&(window.clearTimeout(Y.value),$.value=new Date().getTime(),Y.value=window.setTimeout(pe,de))}function pe(de){const Ee=de?.pointerType==="";_.value?.contains(ob())&&Ee&&t.viewport.value?.focus(),Ee&&(t.isClosePausedRef.value=!1),l("close")}const ye=Ei(()=>_.value?KV(_.value):null);if(s.type&&!["foreground","background"].includes(s.type)){const de="Invalid prop `type` supplied to `Toast`. Expected `foreground | background`.";throw new Error(de)}return Ph(de=>{const Ee=t.viewport.value;if(Ee){const Pe=()=>{ie(W.value),se.resume(),l("resume")},Ze=()=>{const We=new Date().getTime()-$.value;W.value=W.value-We,window.clearTimeout(Y.value),se.pause(),l("pause")};return Ee.addEventListener(zP,Ze),Ee.addEventListener(OP,Pe),()=>{Ee.removeEventListener(zP,Ze),Ee.removeEventListener(OP,Pe)}}}),Qn(()=>[s.open,F.value],()=>{W.value=F.value,s.open&&!t.isClosePausedRef.value&&ie(F.value)},{immediate:!0}),dk("Escape",de=>{l("escapeKeyDown",de),de.defaultPrevented||(t.isFocusedToastEscapeKeyDownRef.value=!0,pe())}),La(()=>{t.onToastAdd()}),ru(()=>{t.onToastRemove()}),$le({onClose:pe}),(de,Ee)=>(li(),ir(qs,null,[ye.value?(li(),En(Ole,{key:0,role:"alert","aria-live":de.type==="foreground"?"assertive":"polite","aria-atomic":"true"},{default:Jn(()=>[Gd(Lr(ye.value),1)]),_:1},8,["aria-live"])):gr("v-if",!0),ut(t).viewport.value?(li(),En(UE,{key:1,to:ut(t).viewport.value},[tr(ut(b),null,{default:Jn(()=>[tr(ut(kh),Oo({ref:ut(p),role:"alert","aria-live":"off","aria-atomic":"true",tabindex:"0"},de.$attrs,{as:de.as,"as-child":de.asChild,"data-state":de.open?"open":"closed","data-swipe-direction":ut(t).swipeDirection.value,style:ut(t).disableSwipe.value?void 0:{userSelect:"none",touchAction:"none"},onPointerdown:Ee[0]||(Ee[0]=Sm(Pe=>{ut(t).disableSwipe.value||(P.value={x:Pe.clientX,y:Pe.clientY})},["left"])),onPointermove:Ee[1]||(Ee[1]=Pe=>{if(ut(t).disableSwipe.value||!P.value)return;const Ze=Pe.clientX-P.value.x,We=Pe.clientY-P.value.y,je=!!O.value,Ye=["left","right"].includes(ut(t).swipeDirection.value),ct=["left","up"].includes(ut(t).swipeDirection.value)?Math.min:Math.max,Lt=Ye?ct(0,Ze):0,Ht=Ye?0:ct(0,We),ci=Pe.pointerType==="touch"?10:2,Wt={x:Lt,y:Ht},$t={originalEvent:Pe,delta:Wt};je?(O.value=Wt,ut(fS)(ut(Ble),Dt=>l("swipeMove",Dt),$t)):ut(KO)(Wt,ut(t).swipeDirection.value,ci)?(O.value=Wt,ut(fS)(ut(Fle),Dt=>l("swipeStart",Dt),$t),Pe.target.setPointerCapture(Pe.pointerId)):(Math.abs(Ze)>ci||Math.abs(We)>ci)&&(P.value=null)}),onPointerup:Ee[2]||(Ee[2]=Pe=>{if(ut(t).disableSwipe.value)return;const Ze=O.value,We=Pe.target;if(We.hasPointerCapture(Pe.pointerId)&&We.releasePointerCapture(Pe.pointerId),O.value=null,P.value=null,Ze){const je=Pe.currentTarget,Ye={originalEvent:Pe,delta:Ze};ut(KO)(Ze,ut(t).swipeDirection.value,ut(t).swipeThreshold.value)?ut(fS)(ut(Vle),ct=>l("swipeEnd",ct),Ye):ut(fS)(ut(Nle),ct=>l("swipeCancel",ct),Ye),je?.addEventListener("click",ct=>ct.preventDefault(),{once:!0})}})}),{default:Jn(()=>[Rs(de.$slots,"default",{remaining:ae.value,duration:F.value})]),_:3},16,["as","as-child","data-state","data-swipe-direction","style"])]),_:3})],8,["to"])):gr("v-if",!0)],64))}}),qle=Gle,Hle=kr({__name:"ToastClose",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(e){const i=e,s=Ule(),{forwardRef:l}=zp();return(p,_)=>(li(),En(YV,{"as-child":""},{default:Jn(()=>[tr(ut(kh),Oo(i,{ref:ut(l),type:p.as==="button"?"button":void 0,onClick:ut(s).onClose}),{default:Jn(()=>[Rs(p.$slots,"default")]),_:3},16,["type","onClick"])]),_:3}))}}),JV=Hle,Wle=kr({__name:"ToastAction",props:{altText:{type:String,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){if(!e.altText)throw new Error("Missing prop `altText` expected on `ToastAction`");const{forwardRef:s}=zp();return(l,p)=>l.altText?(li(),En(YV,{key:0,"alt-text":l.altText,"as-child":""},{default:Jn(()=>[tr(JV,{ref:ut(s),as:l.as,"as-child":l.asChild},{default:Jn(()=>[Rs(l.$slots,"default")]),_:3},8,["as","as-child"])]),_:3},8,["alt-text"])):gr("v-if",!0)}}),JO=Wle,Zle=kr({__name:"ToastDescription",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const i=e;return zp(),(s,l)=>(li(),En(ut(kh),Ap(o0(i)),{default:Jn(()=>[Rs(s.$slots,"default")]),_:3},16))}}),Xle=Zle,Yle=kr({__name:"ToastPortal",props:{to:{type:null,required:!1},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(e){const i=e;return(s,l)=>(li(),En(ut(ble),Ap(o0(i)),{default:Jn(()=>[Rs(s.$slots,"default")]),_:3},16))}}),Kle=Yle,Jle=kr({__name:"ToastRoot",props:{defaultOpen:{type:Boolean,required:!1,default:!0},forceMount:{type:Boolean,required:!1},type:{type:String,required:!1,default:"foreground"},open:{type:Boolean,required:!1,default:void 0},duration:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["escapeKeyDown","pause","resume","swipeStart","swipeMove","swipeCancel","swipeEnd","update:open"],setup(e,{emit:i}){const s=e,l=i,{forwardRef:p}=zp(),_=RP(s,"open",l,{defaultValue:s.defaultOpen,passive:s.open===void 0});return(b,t)=>(li(),En(ut(lle),{present:b.forceMount||ut(_)},{default:Jn(()=>[tr(qle,Oo({ref:ut(p),open:ut(_),type:b.type,as:b.as,"as-child":b.asChild,duration:b.duration},b.$attrs,{onClose:t[0]||(t[0]=P=>_.value=!1),onPause:t[1]||(t[1]=P=>l("pause")),onResume:t[2]||(t[2]=P=>l("resume")),onEscapeKeyDown:t[3]||(t[3]=P=>l("escapeKeyDown",P)),onSwipeStart:t[4]||(t[4]=P=>{l("swipeStart",P),P.defaultPrevented||P.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:t[5]||(t[5]=P=>{if(l("swipeMove",P),!P.defaultPrevented){const{x:O,y:F}=P.detail.delta,$=P.currentTarget;$.setAttribute("data-swipe","move"),$.style.setProperty("--reka-toast-swipe-move-x",`${O}px`),$.style.setProperty("--reka-toast-swipe-move-y",`${F}px`)}}),onSwipeCancel:t[6]||(t[6]=P=>{if(l("swipeCancel",P),!P.defaultPrevented){const O=P.currentTarget;O.setAttribute("data-swipe","cancel"),O.style.removeProperty("--reka-toast-swipe-move-x"),O.style.removeProperty("--reka-toast-swipe-move-y"),O.style.removeProperty("--reka-toast-swipe-end-x"),O.style.removeProperty("--reka-toast-swipe-end-y")}}),onSwipeEnd:t[7]||(t[7]=P=>{if(l("swipeEnd",P),!P.defaultPrevented){const{x:O,y:F}=P.detail.delta,$=P.currentTarget;$.setAttribute("data-swipe","end"),$.style.removeProperty("--reka-toast-swipe-move-x"),$.style.removeProperty("--reka-toast-swipe-move-y"),$.style.setProperty("--reka-toast-swipe-end-x",`${O}px`),$.style.setProperty("--reka-toast-swipe-end-y",`${F}px`),_.value=!1}})}),{default:Jn(({remaining:P,duration:O})=>[Rs(b.$slots,"default",{remaining:P,duration:O,open:ut(_)})]),_:3},16,["open","type","as","as-child","duration"])]),_:3},8,["present"]))}}),Qle=Jle,ece=kr({__name:"ToastTitle",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const i=e;return zp(),(s,l)=>(li(),En(ut(kh),Ap(o0(i)),{default:Jn(()=>[Rs(s.$slots,"default")]),_:3},16))}}),tce=ece,ice=kr({__name:"FocusProxy",emits:["focusFromOutsideViewport"],setup(e,{emit:i}){const s=i,l=pI();return(p,_)=>(li(),En(ut(XV),{"aria-hidden":"true",tabindex:"0",style:{position:"fixed"},onFocus:_[0]||(_[0]=b=>{const t=b.relatedTarget;!ut(l).viewport.value?.contains(t)&&s("focusFromOutsideViewport")})},{default:Jn(()=>[Rs(p.$slots,"default")]),_:3}))}}),QO=ice,nce=kr({inheritAttrs:!1,__name:"ToastViewport",props:{hotkey:{type:Array,required:!1,default:()=>["F8"]},label:{type:[String,Function],required:!1,default:"Notifications ({hotkey})"},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ol"}},setup(e){const i=e,{hotkey:s,label:l}=Mp(i),{forwardRef:p,currentElement:_}=zp(),{CollectionSlot:b,getItems:t}=fk(),P=pI(),O=Ei(()=>P.toastCount.value>0),F=an(),$=an(),W=Ei(()=>s.value.join("+").replace(/Key/g,"").replace(/Digit/g,""));dk(s.value,()=>{_.value.focus()}),La(()=>{P.onViewportChange(_.value)}),Ph(ae=>{const se=_.value;if(O.value&&se){const ie=()=>{if(!P.isClosePausedRef.value){const Pe=new CustomEvent(zP);se.dispatchEvent(Pe),P.isClosePausedRef.value=!0}},pe=()=>{if(P.isClosePausedRef.value){const Pe=new CustomEvent(OP);se.dispatchEvent(Pe),P.isClosePausedRef.value=!1}},ye=Pe=>{!se.contains(Pe.relatedTarget)&&pe()},de=()=>{se.contains(ob())||pe()},Ee=Pe=>{const Ze=Pe.altKey||Pe.ctrlKey||Pe.metaKey;if(Pe.key==="Tab"&&!Ze){const je=ob(),Ye=Pe.shiftKey;if(Pe.target===se&&Ye){F.value?.focus();return}const Ht=Y({tabbingDirection:Ye?"backwards":"forwards"}),ci=Ht.findIndex(Wt=>Wt===je);iA(Ht.slice(ci+1))?Pe.preventDefault():Ye?F.value?.focus():$.value?.focus()}};se.addEventListener("focusin",ie),se.addEventListener("focusout",ye),se.addEventListener("pointermove",ie),se.addEventListener("pointerleave",de),se.addEventListener("keydown",Ee),window.addEventListener("blur",ie),window.addEventListener("focus",pe),ae(()=>{se.removeEventListener("focusin",ie),se.removeEventListener("focusout",ye),se.removeEventListener("pointermove",ie),se.removeEventListener("pointerleave",de),se.removeEventListener("keydown",Ee),window.removeEventListener("blur",ie),window.removeEventListener("focus",pe)})}});function Y({tabbingDirection:ae}){const ie=t().map(pe=>pe.ref).map(pe=>{const ye=[pe,...ZV(pe)];return ae==="forwards"?ye:ye.reverse()});return(ae==="forwards"?ie.reverse():ie).flat()}return(ae,se)=>(li(),En(ut(gle),{role:"region","aria-label":typeof ut(l)=="string"?ut(l).replace("{hotkey}",W.value):ut(l)(W.value),tabindex:"-1",style:Su({pointerEvents:O.value?void 0:"none"})},{default:Jn(()=>[O.value?(li(),En(QO,{key:0,ref:ie=>{F.value=ut(Lp)(ie)},onFocusFromOutsideViewport:se[0]||(se[0]=()=>{const ie=Y({tabbingDirection:"forwards"});ut(iA)(ie)})},null,512)):gr("v-if",!0),tr(ut(b),null,{default:Jn(()=>[tr(ut(kh),Oo({ref:ut(p),tabindex:"-1",as:ae.as,"as-child":ae.asChild},ae.$attrs),{default:Jn(()=>[Rs(ae.$slots,"default")]),_:3},16,["as","as-child"])]),_:3}),O.value?(li(),En(QO,{key:1,ref:ie=>{$.value=ut(Lp)(ie)},onFocusFromOutsideViewport:se[1]||(se[1]=()=>{const ie=Y({tabbingDirection:"backwards"});ut(iA)(ie)})},null,512)):gr("v-if",!0)]),_:3},8,["aria-label","style"]))}}),rce=nce;const[z_e,sce]=l2("TooltipProvider");var oce=kr({inheritAttrs:!1,__name:"TooltipProvider",props:{delayDuration:{type:Number,required:!1,default:700},skipDelayDuration:{type:Number,required:!1,default:300},disableHoverableContent:{type:Boolean,required:!1,default:!1},disableClosingTrigger:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},ignoreNonKeyboardFocus:{type:Boolean,required:!1,default:!1}},setup(e){const i=e,{delayDuration:s,skipDelayDuration:l,disableHoverableContent:p,disableClosingTrigger:_,ignoreNonKeyboardFocus:b,disabled:t}=Mp(i);zp();const P=an(!0),O=an(!1),{start:F,stop:$}=UV(()=>{P.value=!0},l,{immediate:!1});return sce({isOpenDelayed:P,delayDuration:s,onOpen(){$(),P.value=!1},onClose(){F()},isPointerInTransitRef:O,disableHoverableContent:p,disableClosingTrigger:_,disabled:t,ignoreNonKeyboardFocus:b}),(W,Y)=>Rs(W.$slots,"default")}}),ace=oce;function QV(e){const i=hd(),s=Ei(()=>Rr(e)),l=Ei(()=>s.value.icon&&s.value.leading||s.value.icon&&!s.value.trailing||s.value.loading&&!s.value.trailing||!!s.value.leadingIcon),p=Ei(()=>s.value.icon&&s.value.trailing||s.value.loading&&s.value.trailing||!!s.value.trailingIcon),_=Ei(()=>s.value.loading?s.value.loadingIcon||i.ui.icons.loading:s.value.leadingIcon||s.value.icon),b=Ei(()=>s.value.loading&&!l.value?s.value.loadingIcon||i.ui.icons.loading:s.value.trailingIcon||s.value.icon);return{isLeading:l,isTrailing:p,leadingIconName:_,trailingIconName:b}}const lce=Symbol("nuxt-ui.field-group");function ej(e){const i=Fo(lce,void 0);return{orientation:Ei(()=>i?.value.orientation),size:Ei(()=>e?.size??i?.value.size)}}const cce=Symbol("nuxt-ui.form-options"),uce=Symbol("nuxt-ui.form-events"),O_e=Symbol("nuxt-ui.form-state"),eF=Symbol("nuxt-ui.form-field"),hce=Symbol("nuxt-ui.input-id"),F_e=Symbol("nuxt-ui.form-inputs"),dce=Symbol("nuxt-ui.form-loading"),B_e=Symbol("nuxt-ui.form-errors");function N_e(e,i){const s=Fo(cce,void 0),l=Fo(uce,void 0),p=Fo(eF,void 0),_=Fo(hce,void 0);Ka(eF,void 0),p&&_&&(i?.bind===!1?_.value=void 0:e?.id&&(_.value=e?.id));function b($,W,Y){l&&p&&W&&l.emit({type:$,name:W,eager:Y})}function t(){b("blur",p?.value.name)}function P(){b("focus",p?.value.name)}function O(){b("change",p?.value.name)}const F=hI(()=>{b("input",p?.value.name,!i?.deferInputValidation||p?.value.eagerValidation)},p?.value.validateOnInputDelay??s?.value.validateOnInputDelay??0);return{id:Ei(()=>e?.id??_?.value),name:Ei(()=>e?.name??p?.value.name),size:Ei(()=>e?.size??p?.value.size),color:Ei(()=>p?.value.error?"error":e?.color),highlight:Ei(()=>p?.value.error?!0:e?.highlight),disabled:Ei(()=>s?.value.disabled||e?.disabled),emitFormBlur:t,emitFormInput:F,emitFormChange:O,emitFormFocus:P,ariaAttrs:Ei(()=>{if(!p?.value)return;const $=["error","hint","description","help"].filter(Y=>p?.value?.[Y]).map(Y=>`${p?.value.ariaId}-${Y}`)||[],W={"aria-invalid":!!p?.value.error};return $.length>0&&(W["aria-describedby"]=$.join(" ")),W})}}function fce(e,i){const s=FP(e),l=FP(i);return tj(s,l)}function tj(e,i){const s=[],l=new Set([...Object.keys(e.props||{}),...Object.keys(i.props||{})]);if(e.props&&i.props)for(const p of l){const _=e.props[p],b=i.props[p];_&&b?s.push(...tj(e.props?.[p],i.props?.[p])):(_||b)&&s.push(new tF((b||_).key,_?"removed":"added",b,_))}return l.size===0&&e.hash!==i.hash&&s.push(new tF((i||e).key,"changed",i,e)),s}function FP(e,i=""){if(e&&typeof e!="object")return new iF(i,e,fE(e));const s={},l=[];for(const p in e)s[p]=FP(e[p],i?`${i}.${p}`:p),l.push(s[p].hash);return new iF(i,e,`{${l.join(":")}}`,s)}class tF{constructor(i,s,l,p){this.key=i,this.type=s,this.newValue=l,this.oldValue=p}toString(){return this.toJSON()}toJSON(){switch(this.type){case"added":return`Added   \`${this.key}\``;case"removed":return`Removed \`${this.key}\``;case"changed":return`Changed \`${this.key}\` from \`${this.oldValue?.toString()||"-"}\` to \`${this.newValue.toString()}\``}}}class iF{constructor(i,s,l,p){this.key=i,this.value=s,this.hash=l,this.props=p}toString(){return this.props?`{${Object.keys(this.props).join(",")}}`:JSON.stringify(this.value)}toJSON(){const i=this.key||".";return this.props?`${i}({${Object.keys(this.props).join(",")}})`:`${i}(${this.value})`}}function ij(e,i){const s={...e};for(const l of i)delete s[l];return s}function Hx(e,i,s){typeof i=="string"&&(i=i.split(".").map(p=>{const _=Number(p);return Number.isNaN(_)?p:_}));let l=e;for(const p of i){if(l==null)return s;l=l[p]}return l!==void 0?l:s}function V_e(e){const i=Number.parseFloat(e);return Number.isNaN(i)?e:i}function pce(e,i,s){return e===void 0||i===void 0?!1:typeof e=="string"?e===i:typeof s=="function"?s(e,i):typeof s=="string"?Hx(e,s)===Hx(i,s):QE(e,i)}function nF(e){if(e==null)return!0;if(typeof e=="boolean"||typeof e=="number")return!1;if(typeof e=="string")return e.trim().length===0;if(Array.isArray(e))return e.length===0;if(e instanceof Map||e instanceof Set)return e.size===0;if(e instanceof Date||e instanceof RegExp||typeof e=="function")return!1;if(typeof e=="object"){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}return!1}function j_e(e,i,s={}){const{valueKey:l,labelKey:p}=s,_=e.find(t=>{const P=typeof t=="object"&&t!==null&&l?Hx(t,l):t;return pce(P,i)});if(nF(i)&&_)return p?Hx(_,p):void 0;if(nF(i))return;const b=_??i;if(b!=null)return typeof b=="object"?p?Hx(b,p):void 0:String(b)}function U_e(e){return Array.isArray(e[0])}function AE(e,i){return!e&&!i?"":[...Array.isArray(e)?e:[e],i].filter(Boolean)}var mce=/\s+/g,gce=e=>typeof e!="string"||!e?e:e.replace(mce," ").trim(),PE=(...e)=>{const i=[],s=l=>{if(!l&&l!==0&&l!==0n)return;if(Array.isArray(l)){for(let _=0,b=l.length;_<b;_++)s(l[_]);return}const p=typeof l;if(p==="string"||p==="number"||p==="bigint"){if(p==="number"&&l!==l)return;i.push(String(l))}else if(p==="object"){const _=Object.keys(l);for(let b=0,t=_.length;b<t;b++){const P=_[b];l[P]&&i.push(P)}}};for(let l=0,p=e.length;l<p;l++){const _=e[l];_!=null&&s(_)}return i.length>0?gce(i.join(" ")):void 0},rF=e=>e===!1?"false":e===!0?"true":e===0?"0":e,Nd=e=>{if(!e||typeof e!="object")return!0;for(const i in e)return!1;return!0},_ce=(e,i)=>{if(e===i)return!0;if(!e||!i)return!1;const s=Object.keys(e),l=Object.keys(i);if(s.length!==l.length)return!1;for(let p=0;p<s.length;p++){const _=s[p];if(!l.includes(_)||e[_]!==i[_])return!1}return!0},yce=(e,i)=>{for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const l=i[s];s in e?e[s]=PE(e[s],l):e[s]=l}return e},nj=(e,i)=>{for(let s=0;s<e.length;s++){const l=e[s];Array.isArray(l)?nj(l,i):l&&i.push(l)}},rj=(...e)=>{const i=[];nj(e,i);const s=[];for(let l=0;l<i.length;l++)i[l]&&s.push(i[l]);return s},BP=(e,i)=>{const s={};for(const l in e){const p=e[l];if(l in i){const _=i[l];Array.isArray(p)||Array.isArray(_)?s[l]=rj(_,p):typeof p=="object"&&typeof _=="object"&&p&&_?s[l]=BP(p,_):s[l]=_+" "+p}else s[l]=p}for(const l in i)l in e||(s[l]=i[l]);return s},vce={twMerge:!0,twMergeConfig:{}};function xce(){let e=null,i={},s=!1;return{get cachedTwMerge(){return e},set cachedTwMerge(l){e=l},get cachedTwMergeConfig(){return i},set cachedTwMergeConfig(l){i=l},get didTwMergeConfigChange(){return s},set didTwMergeConfigChange(l){s=l},reset(){e=null,i={},s=!1}}}var F_=xce(),bce=e=>{const i=(l,p)=>{const{extend:_=null,slots:b={},variants:t={},compoundVariants:P=[],compoundSlots:O=[],defaultVariants:F={}}=l,$={...vce,...p},W=_?.base?PE(_.base,l?.base):l?.base,Y=_?.variants&&!Nd(_.variants)?BP(t,_.variants):t,ae=_?.defaultVariants&&!Nd(_.defaultVariants)?{..._.defaultVariants,...F}:F;!Nd($.twMergeConfig)&&!_ce($.twMergeConfig,F_.cachedTwMergeConfig)&&(F_.didTwMergeConfigChange=!0,F_.cachedTwMergeConfig=$.twMergeConfig);const se=Nd(_?.slots),ie=Nd(b)?{}:{base:PE(l?.base,se&&_?.base),...b},pe=se?ie:yce({..._?.slots},Nd(ie)?{base:l?.base}:ie),ye=Nd(_?.compoundVariants)?P:rj(_?.compoundVariants,P),de=Pe=>{if(Nd(Y)&&Nd(b)&&se)return e(W,Pe?.class,Pe?.className)($);if(ye&&!Array.isArray(ye))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof ye}`);if(O&&!Array.isArray(O))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof O}`);const Ze=(Wt,$t=Y,Dt=null,Ft=null)=>{const vt=$t[Wt];if(!vt||Nd(vt))return null;const wi=Ft?.[Wt]??Pe?.[Wt];if(wi===null)return null;const Qi=rF(wi);if(typeof Qi=="object")return null;const wn=ae?.[Wt],qn=Qi??rF(wn);return vt[qn||"false"]},We=()=>{if(!Y)return null;const Wt=Object.keys(Y),$t=[];for(let Dt=0;Dt<Wt.length;Dt++){const Ft=Ze(Wt[Dt],Y);Ft&&$t.push(Ft)}return $t},je=(Wt,$t)=>{if(!Y||typeof Y!="object")return null;const Dt=[];for(const Ft in Y){const vt=Ze(Ft,Y,Wt,$t),wi=Wt==="base"&&typeof vt=="string"?vt:vt&&vt[Wt];wi&&Dt.push(wi)}return Dt},Ye={};for(const Wt in Pe){const $t=Pe[Wt];$t!==void 0&&(Ye[Wt]=$t)}const ct=(Wt,$t)=>{const Dt=typeof Pe?.[Wt]=="object"?{[Wt]:Pe[Wt]?.initial}:{};return{...ae,...Ye,...Dt,...$t}},Lt=(Wt=[],$t)=>{const Dt=[],Ft=Wt.length;for(let vt=0;vt<Ft;vt++){const{class:wi,className:Qi,...wn}=Wt[vt];let qn=!0;const Fn=ct(null,$t);for(const mr in wn){const Sr=wn[mr],Hr=Fn[mr];if(Array.isArray(Sr)){if(!Sr.includes(Hr)){qn=!1;break}}else{if((Sr==null||Sr===!1)&&(Hr==null||Hr===!1))continue;if(Hr!==Sr){qn=!1;break}}}qn&&(wi&&Dt.push(wi),Qi&&Dt.push(Qi))}return Dt},Ht=Wt=>{const $t=Lt(ye,Wt);if(!Array.isArray($t))return $t;const Dt={},Ft=e;for(let vt=0;vt<$t.length;vt++){const wi=$t[vt];if(typeof wi=="string")Dt.base=Ft(Dt.base,wi)($);else if(typeof wi=="object")for(const Qi in wi)Dt[Qi]=Ft(Dt[Qi],wi[Qi])($)}return Dt},ci=Wt=>{if(O.length<1)return null;const $t={},Dt=ct(null,Wt);for(let Ft=0;Ft<O.length;Ft++){const{slots:vt=[],class:wi,className:Qi,...wn}=O[Ft];if(!Nd(wn)){let qn=!0;for(const Fn in wn){const mr=Dt[Fn],Sr=wn[Fn];if(mr===void 0||(Array.isArray(Sr)?!Sr.includes(mr):Sr!==mr)){qn=!1;break}}if(!qn)continue}for(let qn=0;qn<vt.length;qn++){const Fn=vt[qn];$t[Fn]||($t[Fn]=[]),$t[Fn].push([wi,Qi])}}return $t};if(!Nd(b)||!se){const Wt={};if(typeof pe=="object"&&!Nd(pe)){const $t=e;for(const Dt in pe)Wt[Dt]=Ft=>{const vt=Ht(Ft),wi=ci(Ft);return $t(pe[Dt],je(Dt,Ft),vt?vt[Dt]:void 0,wi?wi[Dt]:void 0,Ft?.class,Ft?.className)($)}}return Wt}return e(W,We(),Lt(ye),Pe?.class,Pe?.className)($)},Ee=()=>{if(!(!Y||typeof Y!="object"))return Object.keys(Y)};return de.variantKeys=Ee(),de.extend=_,de.base=W,de.slots=pe,de.variants=Y,de.defaultVariants=ae,de.compoundSlots=O,de.compoundVariants=ye,de};return{tv:i,createTV:l=>(p,_)=>i(p,_?BP(l,_):l)}},wce=e=>Nd(e)?q_:Hee({...e,extend:{theme:e.theme,classGroups:e.classGroups,conflictingClassGroupModifiers:e.conflictingClassGroupModifiers,conflictingClassGroups:e.conflictingClassGroups,...e.extend}}),Tce=(e,i)=>{const s=PE(e);return!s||!(i?.twMerge??!0)?s:((!F_.cachedTwMerge||F_.didTwMergeConfigChange)&&(F_.didTwMergeConfigChange=!1,F_.cachedTwMerge=wce(F_.cachedTwMergeConfig)),F_.cachedTwMerge(s)||void 0)},Sce=(...e)=>i=>Tce(e,i),{createTV:Ece}=bce(Sce);const Ice=k4,Mh=Ece(Ice.ui?.tv),Cce=["active","activeClass","ariaCurrentValue","as","disabled","download","exact","exactActiveClass","exactHash","exactQuery","external","form","formaction","formenctype","formmethod","formnovalidate","formtarget","href","hreflang","inactiveClass","media","noPrefetch","noRel","onClick","ping","prefetch","prefetchOn","prefetchedClass","referrerpolicy","rel","replace","target","title","to","trailingSlash","type","viewTransition"];function Ace(e){const i=Object.keys(e),s=i.filter(_=>_.startsWith("aria-")),l=i.filter(_=>_.startsWith("data-")),p=[...Cce,...s,...l];return gb(e,...p)}function Pce(e,i){const s=fce(e,i).reduce((_,b)=>(b.type==="added"&&_.add(b.key),_),new Set),l=Object.fromEntries(Object.entries(e).filter(([_])=>!s.has(_))),p=Object.fromEntries(Object.entries(i).filter(([_])=>!s.has(_)));return QE(l,p)}const ab={__name:"UIcon",props:{name:{type:null,required:!0},mode:{type:String,required:!1},size:{type:[String,Number],required:!1},customize:{type:Function,required:!1}},setup(e){const s=xb(gb(e,"name","mode","size","customize"));return(l,p)=>{const _=Wd;return typeof e.name=="string"?(li(),En(_,Ap(Oo({key:0},ut(s))),null,16)):(li(),En(Cg(e.name),{key:1}))}}};async function Mce(e,i){return await kce(i).catch(l=>(console.error("Failed to get image meta for "+i,l+""),{width:0,height:0,ratio:0}))}async function kce(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((i,s)=>{const l=new Image;l.onload=()=>{const p={width:l.width,height:l.height,ratio:l.width/l.height};i(p)},l.onerror=p=>s(p),l.src=e})}function sF(e){return i=>i?e[i]||i:e.missingValue}function Dce({formatter:e,keyMap:i,joinWith:s="/",valueMap:l}={}){e||(e=(_,b)=>`${_}=${b}`),i&&typeof i!="function"&&(i=sF(i));const p=l||{};return Object.keys(p).forEach(_=>{typeof p[_]!="function"&&(p[_]=sF(p[_]))}),(_={})=>Object.entries(_).filter(([t,P])=>typeof P<"u").map(([t,P])=>{const O=p[t];return typeof O=="function"&&(P=O(_[t])),t=typeof i=="function"?i(t):t,e(t,P)}).join(s)}function Ag(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return Number.parseInt(e,10)}function Lce(e=""){if(e===void 0||!e.length)return[];const i=new Set;for(const s of e.split(" ")){const l=Number.parseInt(s.replace("x",""));l&&i.add(l)}return Array.from(i)}function Rce(e){if(e.length===0)throw new Error("`densities` must not be empty, configure to `1` to render regular size only (DPR 1.0)")}function zce(e){const i={};if(typeof e=="string")for(const s of e.split(/[\s,]+/).filter(l=>l)){const l=s.split(":");l.length!==2?i["1px"]=l[0].trim():i[l[0].trim()]=l[1].trim()}else Object.assign(i,e);return i}function Oce(e){const i={options:e},s=(p,_={})=>sj(i,p,_),l=(p,_={},b={})=>s(p,{...b,modifiers:a0(_,b.modifiers||{})}).url;for(const p in e.presets)l[p]=(_,b,t)=>l(_,b,{...e.presets[p],...t});return l.options=e,l.getImage=s,l.getMeta=(p,_)=>Fce(i,p,_),l.getSizes=(p,_)=>Vce(i,p,_),i.$img=l,l}async function Fce(e,i,s){const l=sj(e,i,{...s});return typeof l.getMeta=="function"?await l.getMeta():await Mce(e,l.url)}function sj(e,i,s){if(i&&typeof i!="string")throw new TypeError(`input must be a string (received ${typeof i}: ${JSON.stringify(i)})`);if(!i||i.startsWith("data:"))return{url:i};const{provider:l,defaults:p}=Bce(e,s.provider||e.options.provider),_=Nce(e,s.preset);if(i=ud(i)?i:L9(i),!l.supportsAlias){for(const O in e.options.alias)if(i.startsWith(O)){const F=e.options.alias[O];F&&(i=Am(F,i.slice(O.length)))}}if(l.validateDomains&&ud(i)){const O=Jx(i).host;if(!e.options.domains.find(F=>F===O))return{url:i}}const b=a0(s,_,p);b.modifiers={...b.modifiers};const t=b.modifiers.format;b.modifiers?.width&&(b.modifiers.width=Ag(b.modifiers.width)),b.modifiers?.height&&(b.modifiers.height=Ag(b.modifiers.height));const P=l.getImage(i,b,e);return P.format=P.format||t||"",P}function Bce(e,i){const s=e.options.providers[i];if(!s)throw new Error("Unknown provider: "+i);return s}function Nce(e,i){if(!i)return{};if(!e.options.presets[i])throw new Error("Unknown preset: "+i);return e.options.presets[i]}function Vce(e,i,s){const l=Ag(s.modifiers?.width),p=Ag(s.modifiers?.height),_=zce(s.sizes),b=s.densities?.trim()?Lce(s.densities.trim()):e.options.densities;Rce(b);const t=l&&p?p/l:0,P=[],O=[];if(Object.keys(_).length>=1){for(const ae in _){const se=oF(ae,String(_[ae]),p,t,e);if(se!==void 0){P.push({size:se.size,screenMaxWidth:se.screenMaxWidth,media:`(max-width: ${se.screenMaxWidth}px)`});for(const ie of b)O.push({width:se._cWidth*ie,src:aF(e,i,s,se,ie)})}}jce(P)}else for(const ae of b){const se=Object.keys(_)[0];let ie=se?oF(se,String(_[se]),p,t,e):void 0;ie===void 0&&(ie={size:"",screenMaxWidth:0,_cWidth:s.modifiers?.width,_cHeight:s.modifiers?.height}),O.push({width:ae,src:aF(e,i,s,ie,ae)})}Uce(O);const F=O[O.length-1],$=P.length?P.map(ae=>`${ae.media?ae.media+" ":""}${ae.size}`).join(", "):void 0,W=$?"w":"x",Y=O.map(ae=>`${ae.src} ${ae.width}${W}`).join(", ");return{sizes:$,srcset:Y,src:F?.src}}function oF(e,i,s,l,p){const _=p.options.screens&&p.options.screens[e]||Number.parseInt(e),b=i.endsWith("vw");if(!b&&/^\d+$/.test(i)&&(i=i+"px"),!b&&!i.endsWith("px"))return;let t=Number.parseInt(i);if(!_||!t)return;b&&(t=Math.round(t/100*_));const P=l?Math.round(t*l):s;return{size:i,screenMaxWidth:_,_cWidth:t,_cHeight:P}}function aF(e,i,s,l,p){return e.$img(i,{...s.modifiers,width:l._cWidth?l._cWidth*p:void 0,height:l._cHeight?l._cHeight*p:void 0},s)}function jce(e){e.sort((s,l)=>s.screenMaxWidth-l.screenMaxWidth);let i=null;for(let s=e.length-1;s>=0;s--){const l=e[s];l.media===i&&e.splice(s,1),i=l.media}for(let s=0;s<e.length;s++)e[s].media=e[s+1]?.media||""}function Uce(e){e.sort((s,l)=>s.width-l.width);let i=null;for(let s=e.length-1;s>=0;s--){const l=e[s];l.width===i&&e.splice(s,1),i=l.width}}const oj=Dce({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,i)=>rR(e)+"_"+rR(i)}),$ce=(e,{modifiers:i={},baseURL:s}={},l)=>{i.width&&i.height&&(i.resize=`${i.width}x${i.height}`,delete i.width,delete i.height);const p=oj(i)||"_";return s||(s=Am(l.options.nuxt.baseURL,"/_ipx")),{url:Am(s,p,IB(e))}},Gce=!0,qce=!0,Hce=Object.freeze(Object.defineProperty({__proto__:null,getImage:$ce,operationsGenerator:oj,supportsAlias:qce,validateDomains:Gce},Symbol.toStringTag,{value:"Module"})),Wce={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipx",domains:[],alias:{},densities:[1,2],format:["webp"],providers:{ipx:{provider:Hce,defaults:{}}}},aj=e=>{const i=jf(),s=Vs();return s.$img||s._img||(s._img=Oce({...Wce,event:s.ssrContext?.event,nuxt:{baseURL:i.app.baseURL},runtimeConfig:i}))};function Zce(e){performance?.mark?.("mark_feature_usage",{detail:{feature:e}})}const Xce={src:{type:String,required:!1},format:{type:String,required:!1},quality:{type:[Number,String],required:!1},background:{type:String,required:!1},fit:{type:String,required:!1},modifiers:{type:Object,required:!1},preset:{type:String,required:!1},provider:{type:String,required:!1},sizes:{type:[Object,String],required:!1},densities:{type:String,required:!1},preload:{type:[Boolean,Object],required:!1},width:{type:[String,Number],required:!1},height:{type:[String,Number],required:!1},alt:{type:String,required:!1},referrerpolicy:{type:String,required:!1},usemap:{type:String,required:!1},longdesc:{type:String,required:!1},ismap:{type:Boolean,required:!1},loading:{type:String,required:!1,validator:e=>["lazy","eager"].includes(e)},crossorigin:{type:[Boolean,String],required:!1,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,required:!1,validator:e=>["async","auto","sync"].includes(e)},nonce:{type:[String],required:!1}},Yce=e=>{const i=Ei(()=>({provider:e.provider,preset:e.preset})),s=Ei(()=>({width:Ag(e.width),height:Ag(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding,nonce:e.nonce})),l=aj(),p=Ei(()=>({...e.modifiers,width:Ag(e.width),height:Ag(e.height),format:e.format,quality:e.quality||l.options.quality,background:e.background,fit:e.fit}));return{options:i,attrs:s,modifiers:p}},Kce={...Xce,placeholder:{type:[Boolean,String,Number,Array],required:!1},placeholderClass:{type:String,required:!1},custom:{type:Boolean,required:!1}},Jce=["src"],Qce=kr({__name:"NuxtImg",props:Kce,emits:["load","error"],setup(e,{emit:i}){const s=e,l=F5(),p=i,_=!1,b=aj(),t=Yce(s),P=an(!1),O=an(),F=Ei(()=>b.getSizes(s.src,{...t.options.value,sizes:s.sizes,densities:s.densities,modifiers:{...t.modifiers.value,width:Ag(s.width),height:Ag(s.height)}})),$=Ei(()=>{const pe={...t.attrs.value,"data-nuxt-img":""};return(!s.placeholder||P.value)&&(pe.sizes=F.value.sizes,pe.srcset=F.value.srcset),pe}),W=Ei(()=>{let pe=s.placeholder;if(pe===""&&(pe=!0),!pe||P.value)return!1;if(typeof pe=="string")return pe;const ye=Array.isArray(pe)?pe:typeof pe=="number"?[pe,pe]:[10,10];return b(s.src,{...t.modifiers.value,width:ye[0],height:ye[1],quality:ye[2]||50,blur:ye[3]||3},t.options.value)}),Y=Ei(()=>s.sizes?F.value.src:b(s.src,t.modifiers.value,t.options.value)),ae=Ei(()=>W.value?W.value:Y.value),ie=Vs().isHydrating;return La(()=>{if(W.value||s.custom){const pe=new Image;Y.value&&(pe.src=Y.value),s.sizes&&(pe.sizes=F.value.sizes||"",pe.srcset=F.value.srcset),pe.onload=ye=>{P.value=!0,p("load",ye)},pe.onerror=ye=>{p("error",ye)},Zce("nuxt-image");return}O.value&&(O.value.complete&&ie&&(O.value.getAttribute("data-error")?p("error",new Event("error")):p("load",new Event("load"))),O.value.onload=pe=>{p("load",pe)},O.value.onerror=pe=>{p("error",pe)})}),(pe,ye)=>pe.custom?Rs(pe.$slots,"default",Ap(Oo({key:1},{...ut(_)?{onerror:"this.setAttribute('data-error', 1)"}:{},imgAttrs:{...$.value,...ut(l)},isLoaded:P.value,src:ae.value}))):(li(),ir("img",Oo({key:0,ref_key:"imgEl",ref:O,class:W.value&&!P.value?pe.placeholderClass:void 0},{...ut(_)?{onerror:"this.setAttribute('data-error', 1)"}:{},...$.value,...ut(l)},{src:ae.value}),null,16,Jce))}}),eue=Object.assign(Qce,{__name:"NuxtImg"}),lF=Symbol("nuxt-ui.avatar-group");function lj(e){const i=Fo(lF,void 0),s=Ei(()=>e.size??i?.value.size);return Ka(lF,Ei(()=>({size:s.value}))),{size:s}}const tue={slots:{root:"relative inline-flex items-center justify-center shrink-0",base:"rounded-full ring ring-bg flex items-center justify-center text-inverted font-medium whitespace-nowrap"},variants:{color:{primary:"bg-primary",secondary:"bg-secondary",success:"bg-success",info:"bg-info",warning:"bg-warning",error:"bg-error",neutral:"bg-inverted"},size:{"3xs":"h-[4px] min-w-[4px] text-[4px]","2xs":"h-[5px] min-w-[5px] text-[5px]",xs:"h-[6px] min-w-[6px] text-[6px]",sm:"h-[7px] min-w-[7px] text-[7px]",md:"h-[8px] min-w-[8px] text-[8px]",lg:"h-[9px] min-w-[9px] text-[9px]",xl:"h-[10px] min-w-[10px] text-[10px]","2xl":"h-[11px] min-w-[11px] text-[11px]","3xl":"h-[12px] min-w-[12px] text-[12px]"},position:{"top-right":"top-0 right-0","bottom-right":"bottom-0 right-0","top-left":"top-0 left-0","bottom-left":"bottom-0 left-0"},inset:{false:""},standalone:{false:"absolute"}},compoundVariants:[{position:"top-right",inset:!1,class:"-translate-y-1/2 translate-x-1/2 transform"},{position:"bottom-right",inset:!1,class:"translate-y-1/2 translate-x-1/2 transform"},{position:"top-left",inset:!1,class:"-translate-y-1/2 -translate-x-1/2 transform"},{position:"bottom-left",inset:!1,class:"translate-y-1/2 -translate-x-1/2 transform"}],defaultVariants:{size:"md",color:"primary",position:"top-right"}},iue=Object.assign({inheritAttrs:!1},{__name:"UChip",props:U$({as:{type:null,required:!1},text:{type:[String,Number],required:!1},color:{type:null,required:!1},size:{type:null,required:!1},position:{type:null,required:!1},inset:{type:Boolean,required:!1,default:!1},standalone:{type:Boolean,required:!1,default:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},{show:{type:Boolean,default:!0},showModifiers:{}}),emits:["update:show"],setup(e){const i=e,s=K$(e,"show",{type:Boolean,default:!0}),{size:l}=lj(i),p=hd(),_=Ei(()=>Mh({extend:Mh(tue),...p.ui?.chip||{}})({color:i.color,size:l.value,position:i.position,inset:i.inset,standalone:i.standalone}));return(b,t)=>(li(),En(ut(kh),{as:e.as,"data-slot":"root",class:_s(_.value.root({class:[i.ui?.root,i.class]}))},{default:Jn(()=>[tr(ut(qw),Ap(o0(b.$attrs)),{default:Jn(()=>[Rs(b.$slots,"default")]),_:3},16),s.value?(li(),ir("span",{key:0,"data-slot":"base",class:_s(_.value.base({class:i.ui?.base}))},[Rs(b.$slots,"content",{},()=>[Gd(Lr(e.text),1)])],2)):gr("",!0)]),_:3},8,["as","class"]))}}),nue={slots:{root:"inline-flex items-center justify-center shrink-0 select-none rounded-full align-middle bg-elevated",image:"h-full w-full rounded-[inherit] object-cover",fallback:"font-medium leading-none text-muted truncate",icon:"text-muted shrink-0"},variants:{size:{"3xs":{root:"size-4 text-[8px]"},"2xs":{root:"size-5 text-[10px]"},xs:{root:"size-6 text-xs"},sm:{root:"size-7 text-sm"},md:{root:"size-8 text-base"},lg:{root:"size-9 text-lg"},xl:{root:"size-10 text-xl"},"2xl":{root:"size-11 text-[22px]"},"3xl":{root:"size-12 text-2xl"}}},defaultVariants:{size:"md"}},pk=Object.assign({inheritAttrs:!1},{__name:"UAvatar",props:{as:{type:null,required:!1},src:{type:String,required:!1},alt:{type:String,required:!1},icon:{type:null,required:!1},text:{type:String,required:!1},size:{type:null,required:!1},chip:{type:[Boolean,Object],required:!1},class:{type:null,required:!1},style:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const i=e,s=Ei(()=>typeof i.as=="string"||typeof i.as?.render=="function"?{root:i.as}:a0(i.as,{root:"span"})),l=Ei(()=>i.text||(i.alt||"").split(" ").map(F=>F.charAt(0)).join("").substring(0,2)),p=hd(),{size:_}=lj(i),b=Ei(()=>Mh({extend:Mh(nue),...p.ui?.avatar||{}})({size:_.value})),t=Ei(()=>({"3xs":16,"2xs":20,xs:24,sm:28,md:32,lg:36,xl:40,"2xl":44,"3xl":48})[i.size||"md"]),P=an(!1);Qn(()=>i.src,()=>{P.value&&(P.value=!1)});function O(){P.value=!0}return(F,$)=>(li(),En(Cg(i.chip?iue:ut(kh)),Oo({as:s.value.root},i.chip?typeof i.chip=="object"?{inset:!0,...i.chip}:{inset:!0}:{},{"data-slot":"root",class:b.value.root({class:[i.ui?.root,i.class]}),style:i.style}),{default:Jn(()=>[e.src&&!P.value?(li(),En(Cg(s.value.img||ut(eue)),Oo({key:0,src:e.src,alt:e.alt,width:t.value,height:t.value},F.$attrs,{"data-slot":"image",class:b.value.image({class:i.ui?.image}),onError:O}),null,16,["src","alt","width","height","class"])):(li(),En(ut(qw),Ap(Oo({key:1},F.$attrs)),{default:Jn(()=>[Rs(F.$slots,"default",{},()=>[e.icon?(li(),En(ab,{key:0,name:e.icon,"data-slot":"icon",class:_s(b.value.icon({class:i.ui?.icon}))},null,8,["name","class"])):(li(),ir("span",{key:1,"data-slot":"fallback",class:_s(b.value.fallback({class:i.ui?.fallback}))},Lr(l.value||""),3))])]),_:3},16))]),_:3},16,["as","class","style"]))}}),cj={__name:"ULinkBase",props:{as:{type:String,required:!1,default:"button"},type:{type:String,required:!1,default:"button"},disabled:{type:Boolean,required:!1},onClick:{type:[Function,Array],required:!1},href:{type:String,required:!1},navigate:{type:Function,required:!1},target:{type:[String,Object,null],required:!1},rel:{type:[String,Object,null],required:!1},active:{type:Boolean,required:!1},isExternal:{type:Boolean,required:!1}},setup(e){const i=e;function s(l){if(i.disabled){l.stopPropagation(),l.preventDefault();return}if(i.onClick)for(const p of Array.isArray(i.onClick)?i.onClick:[i.onClick])p(l);i.href&&i.navigate&&!i.isExternal&&i.navigate(l)}return(l,p)=>(li(),En(ut(kh),Oo(e.href?{as:"a",href:e.disabled?void 0:e.href,"aria-disabled":e.disabled?"true":void 0,role:e.disabled?"link":void 0,tabindex:e.disabled?-1:void 0}:e.as==="button"?{as:e.as,type:e.type,disabled:e.disabled}:{as:e.as},{rel:e.rel,target:e.target,onClick:s}),{default:Jn(()=>[Rs(l.$slots,"default")]),_:3},16,["rel","target"]))}},rue={base:"focus-visible:outline-primary",variants:{active:{true:"text-primary",false:"text-muted"},disabled:{true:"cursor-not-allowed opacity-75"}},compoundVariants:[{active:!1,disabled:!1,class:["hover:text-default","transition-colors"]}]},sue=Object.assign({inheritAttrs:!1},{__name:"ULink",props:{as:{type:null,required:!1,default:"button"},type:{type:null,required:!1,default:"button"},disabled:{type:Boolean,required:!1},active:{type:Boolean,required:!1,default:void 0},exact:{type:Boolean,required:!1},exactQuery:{type:[Boolean,String],required:!1},exactHash:{type:Boolean,required:!1},inactiveClass:{type:String,required:!1},custom:{type:Boolean,required:!1},raw:{type:Boolean,required:!1},class:{type:null,required:!1},to:{type:null,required:!1},href:{type:null,required:!1},external:{type:Boolean,required:!1},target:{type:[String,Object,null],required:!1},rel:{type:[String,Object,null],required:!1},noRel:{type:Boolean,required:!1},prefetchedClass:{type:String,required:!1},prefetch:{type:Boolean,required:!1},prefetchOn:{type:[String,Object],required:!1},noPrefetch:{type:Boolean,required:!1},trailingSlash:{type:String,required:!1},activeClass:{type:String,required:!1},exactActiveClass:{type:String,required:!1},ariaCurrentValue:{type:String,required:!1,default:"page"},viewTransition:{type:Boolean,required:!1},replace:{type:Boolean,required:!1}},setup(e){const i=e,s=Qw(),l=hd(),p=xb(Tie(i,"as","type","disabled","active","exact","exactQuery","exactHash","activeClass","inactiveClass","to","href","raw","custom","class")),_=Ei(()=>Mh({extend:Mh(rue),...a0({variants:{active:{true:AE(l.ui?.link?.variants?.active?.true,i.activeClass),false:AE(l.ui?.link?.variants?.active?.false,i.inactiveClass)}}},l.ui?.link||{})})),b=Ei(()=>i.to??i.href);function t({route:O,isActive:F,isExactActive:$}){if(i.active!==void 0)return i.active;if(i.exactQuery==="partial"){if(!Pce(O.query,s.query))return!1}else if(i.exactQuery===!0&&!QE(O.query,s.query))return!1;return i.exactHash&&O.hash!==s.hash?!1:!!(i.exact&&$||!i.exact&&F)}function P({route:O,isActive:F,isExactActive:$}){const W=t({route:O,isActive:F,isExactActive:$});return i.raw?[i.class,W?i.activeClass:i.inactiveClass]:_.value({class:i.class,active:W,disabled:i.disabled})}return(O,F)=>{const $=XW;return li(),En($,Oo(ut(p),{to:b.value,custom:""}),{default:Jn(({href:W,navigate:Y,route:ae,rel:se,target:ie,isExternal:pe,isActive:ye,isExactActive:de})=>[e.custom?Rs(O.$slots,"default",Ap(Oo({key:0},{...O.$attrs,...e.exact&&de?{"aria-current":i.ariaCurrentValue}:{},as:e.as,type:e.type,disabled:e.disabled,href:W,navigate:Y,rel:se,target:ie,isExternal:pe,active:t({route:ae,isActive:ye,isExactActive:de})}))):(li(),En(cj,Oo({key:1},{...O.$attrs,...e.exact&&de?{"aria-current":i.ariaCurrentValue}:{},as:e.as,type:e.type,disabled:e.disabled,href:W,navigate:Y,rel:se,target:ie,isExternal:pe},{class:P({route:ae,isActive:ye,isExactActive:de})}),{default:Jn(()=>[Rs(O.$slots,"default",{active:t({route:ae,isActive:ye,isExactActive:de})})]),_:2},1040,["class"]))]),_:3},16,["to"])}}}),oue={slots:{base:["rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75","transition-colors"],label:"truncate",leadingIcon:"shrink-0",leadingAvatar:"shrink-0",leadingAvatarSize:"",trailingIcon:"shrink-0"},variants:{fieldGroup:{horizontal:"not-only:first:rounded-e-none not-only:last:rounded-s-none not-last:not-first:rounded-none focus-visible:z-[1]",vertical:"not-only:first:rounded-b-none not-only:last:rounded-t-none not-last:not-first:rounded-none focus-visible:z-[1]"},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{solid:"",outline:"",soft:"",subtle:"",ghost:"",link:""},size:{xs:{base:"px-2 py-1 text-xs gap-1",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},sm:{base:"px-2.5 py-1.5 text-xs gap-1.5",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},md:{base:"px-2.5 py-1.5 text-sm gap-1.5",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},lg:{base:"px-3 py-2 text-sm gap-2",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},xl:{base:"px-3 py-2 text-base gap-2",leadingIcon:"size-6",leadingAvatarSize:"xs",trailingIcon:"size-6"}},block:{true:{base:"w-full justify-center",trailingIcon:"ms-auto"}},square:{true:""},leading:{true:""},trailing:{true:""},loading:{true:""},active:{true:{base:""},false:{base:""}}},compoundVariants:[{color:"primary",variant:"solid",class:"text-inverted bg-primary hover:bg-primary/75 active:bg-primary/75 disabled:bg-primary aria-disabled:bg-primary focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"},{color:"secondary",variant:"solid",class:"text-inverted bg-secondary hover:bg-secondary/75 active:bg-secondary/75 disabled:bg-secondary aria-disabled:bg-secondary focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary"},{color:"success",variant:"solid",class:"text-inverted bg-success hover:bg-success/75 active:bg-success/75 disabled:bg-success aria-disabled:bg-success focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-success"},{color:"info",variant:"solid",class:"text-inverted bg-info hover:bg-info/75 active:bg-info/75 disabled:bg-info aria-disabled:bg-info focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-info"},{color:"warning",variant:"solid",class:"text-inverted bg-warning hover:bg-warning/75 active:bg-warning/75 disabled:bg-warning aria-disabled:bg-warning focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-warning"},{color:"error",variant:"solid",class:"text-inverted bg-error hover:bg-error/75 active:bg-error/75 disabled:bg-error aria-disabled:bg-error focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-error"},{color:"primary",variant:"outline",class:"ring ring-inset ring-primary/50 text-primary hover:bg-primary/10 active:bg-primary/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"},{color:"secondary",variant:"outline",class:"ring ring-inset ring-secondary/50 text-secondary hover:bg-secondary/10 active:bg-secondary/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-secondary"},{color:"success",variant:"outline",class:"ring ring-inset ring-success/50 text-success hover:bg-success/10 active:bg-success/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-success"},{color:"info",variant:"outline",class:"ring ring-inset ring-info/50 text-info hover:bg-info/10 active:bg-info/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-info"},{color:"warning",variant:"outline",class:"ring ring-inset ring-warning/50 text-warning hover:bg-warning/10 active:bg-warning/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-warning"},{color:"error",variant:"outline",class:"ring ring-inset ring-error/50 text-error hover:bg-error/10 active:bg-error/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent focus:outline-none focus-visible:ring-2 focus-visible:ring-error"},{color:"primary",variant:"soft",class:"text-primary bg-primary/10 hover:bg-primary/15 active:bg-primary/15 focus:outline-none focus-visible:bg-primary/15 disabled:bg-primary/10 aria-disabled:bg-primary/10"},{color:"secondary",variant:"soft",class:"text-secondary bg-secondary/10 hover:bg-secondary/15 active:bg-secondary/15 focus:outline-none focus-visible:bg-secondary/15 disabled:bg-secondary/10 aria-disabled:bg-secondary/10"},{color:"success",variant:"soft",class:"text-success bg-success/10 hover:bg-success/15 active:bg-success/15 focus:outline-none focus-visible:bg-success/15 disabled:bg-success/10 aria-disabled:bg-success/10"},{color:"info",variant:"soft",class:"text-info bg-info/10 hover:bg-info/15 active:bg-info/15 focus:outline-none focus-visible:bg-info/15 disabled:bg-info/10 aria-disabled:bg-info/10"},{color:"warning",variant:"soft",class:"text-warning bg-warning/10 hover:bg-warning/15 active:bg-warning/15 focus:outline-none focus-visible:bg-warning/15 disabled:bg-warning/10 aria-disabled:bg-warning/10"},{color:"error",variant:"soft",class:"text-error bg-error/10 hover:bg-error/15 active:bg-error/15 focus:outline-none focus-visible:bg-error/15 disabled:bg-error/10 aria-disabled:bg-error/10"},{color:"primary",variant:"subtle",class:"text-primary ring ring-inset ring-primary/25 bg-primary/10 hover:bg-primary/15 active:bg-primary/15 disabled:bg-primary/10 aria-disabled:bg-primary/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"},{color:"secondary",variant:"subtle",class:"text-secondary ring ring-inset ring-secondary/25 bg-secondary/10 hover:bg-secondary/15 active:bg-secondary/15 disabled:bg-secondary/10 aria-disabled:bg-secondary/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-secondary"},{color:"success",variant:"subtle",class:"text-success ring ring-inset ring-success/25 bg-success/10 hover:bg-success/15 active:bg-success/15 disabled:bg-success/10 aria-disabled:bg-success/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-success"},{color:"info",variant:"subtle",class:"text-info ring ring-inset ring-info/25 bg-info/10 hover:bg-info/15 active:bg-info/15 disabled:bg-info/10 aria-disabled:bg-info/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-info"},{color:"warning",variant:"subtle",class:"text-warning ring ring-inset ring-warning/25 bg-warning/10 hover:bg-warning/15 active:bg-warning/15 disabled:bg-warning/10 aria-disabled:bg-warning/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-warning"},{color:"error",variant:"subtle",class:"text-error ring ring-inset ring-error/25 bg-error/10 hover:bg-error/15 active:bg-error/15 disabled:bg-error/10 aria-disabled:bg-error/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-error"},{color:"primary",variant:"ghost",class:"text-primary hover:bg-primary/10 active:bg-primary/10 focus:outline-none focus-visible:bg-primary/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"secondary",variant:"ghost",class:"text-secondary hover:bg-secondary/10 active:bg-secondary/10 focus:outline-none focus-visible:bg-secondary/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"success",variant:"ghost",class:"text-success hover:bg-success/10 active:bg-success/10 focus:outline-none focus-visible:bg-success/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"info",variant:"ghost",class:"text-info hover:bg-info/10 active:bg-info/10 focus:outline-none focus-visible:bg-info/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"warning",variant:"ghost",class:"text-warning hover:bg-warning/10 active:bg-warning/10 focus:outline-none focus-visible:bg-warning/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"error",variant:"ghost",class:"text-error hover:bg-error/10 active:bg-error/10 focus:outline-none focus-visible:bg-error/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"},{color:"primary",variant:"link",class:"text-primary hover:text-primary/75 active:text-primary/75 disabled:text-primary aria-disabled:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary"},{color:"secondary",variant:"link",class:"text-secondary hover:text-secondary/75 active:text-secondary/75 disabled:text-secondary aria-disabled:text-secondary focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary"},{color:"success",variant:"link",class:"text-success hover:text-success/75 active:text-success/75 disabled:text-success aria-disabled:text-success focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success"},{color:"info",variant:"link",class:"text-info hover:text-info/75 active:text-info/75 disabled:text-info aria-disabled:text-info focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info"},{color:"warning",variant:"link",class:"text-warning hover:text-warning/75 active:text-warning/75 disabled:text-warning aria-disabled:text-warning focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning"},{color:"error",variant:"link",class:"text-error hover:text-error/75 active:text-error/75 disabled:text-error aria-disabled:text-error focus:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error"},{color:"neutral",variant:"solid",class:"text-inverted bg-inverted hover:bg-inverted/90 active:bg-inverted/90 disabled:bg-inverted aria-disabled:bg-inverted focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-inverted"},{color:"neutral",variant:"outline",class:"ring ring-inset ring-accented text-default bg-default hover:bg-elevated active:bg-elevated disabled:bg-default aria-disabled:bg-default focus:outline-none focus-visible:ring-2 focus-visible:ring-inverted"},{color:"neutral",variant:"soft",class:"text-default bg-elevated hover:bg-accented/75 active:bg-accented/75 focus:outline-none focus-visible:bg-accented/75 disabled:bg-elevated aria-disabled:bg-elevated"},{color:"neutral",variant:"subtle",class:"ring ring-inset ring-accented text-default bg-elevated hover:bg-accented/75 active:bg-accented/75 disabled:bg-elevated aria-disabled:bg-elevated focus:outline-none focus-visible:ring-2 focus-visible:ring-inverted"},{color:"neutral",variant:"ghost",class:"text-default hover:bg-elevated active:bg-elevated focus:outline-none focus-visible:bg-elevated hover:disabled:bg-transparent dark:hover:disabled:bg-transparent hover:aria-disabled:bg-transparent dark:hover:aria-disabled:bg-transparent"},{color:"neutral",variant:"link",class:"text-muted hover:text-default active:text-default disabled:text-muted aria-disabled:text-muted focus:outline-none focus-visible:ring-inset focus-visible:ring-2 focus-visible:ring-inverted"},{size:"xs",square:!0,class:"p-1"},{size:"sm",square:!0,class:"p-1.5"},{size:"md",square:!0,class:"p-1.5"},{size:"lg",square:!0,class:"p-2"},{size:"xl",square:!0,class:"p-2"},{loading:!0,leading:!0,class:{leadingIcon:"animate-spin"}},{loading:!0,leading:!1,trailing:!0,class:{trailingIcon:"animate-spin"}}],defaultVariants:{color:"primary",variant:"solid",size:"md"}},Sw={__name:"UButton",props:{label:{type:String,required:!1},color:{type:null,required:!1},activeColor:{type:null,required:!1},variant:{type:null,required:!1},activeVariant:{type:null,required:!1},size:{type:null,required:!1},square:{type:Boolean,required:!1},block:{type:Boolean,required:!1},loadingAuto:{type:Boolean,required:!1},onClick:{type:[Function,Array],required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},leading:{type:Boolean,required:!1},leadingIcon:{type:null,required:!1},trailing:{type:Boolean,required:!1},trailingIcon:{type:null,required:!1},loading:{type:Boolean,required:!1},loadingIcon:{type:null,required:!1},as:{type:null,required:!1},type:{type:null,required:!1},disabled:{type:Boolean,required:!1},active:{type:Boolean,required:!1},exact:{type:Boolean,required:!1},exactQuery:{type:[Boolean,String],required:!1},exactHash:{type:Boolean,required:!1},inactiveClass:{type:String,required:!1},to:{type:null,required:!1},href:{type:null,required:!1},external:{type:Boolean,required:!1},target:{type:[String,Object,null],required:!1},rel:{type:[String,Object,null],required:!1},noRel:{type:Boolean,required:!1},prefetchedClass:{type:String,required:!1},prefetch:{type:Boolean,required:!1},prefetchOn:{type:[String,Object],required:!1},noPrefetch:{type:Boolean,required:!1},trailingSlash:{type:String,required:!1},activeClass:{type:String,required:!1},exactActiveClass:{type:String,required:!1},ariaCurrentValue:{type:String,required:!1},viewTransition:{type:Boolean,required:!1},replace:{type:Boolean,required:!1}},setup(e){const i=e,s=GE(),l=hd(),{orientation:p,size:_}=ej(i),b=xb(Ace(i)),t=an(!1),P=Fo(dce,void 0);async function O(ie){t.value=!0;const pe=Array.isArray(i.onClick)?i.onClick:[i.onClick];try{await Promise.all(pe.map(ye=>ye?.(ie)))}finally{t.value=!1}}const F=Ei(()=>i.loading||i.loadingAuto&&(t.value||P?.value&&i.type==="submit")),{isLeading:$,isTrailing:W,leadingIconName:Y,trailingIconName:ae}=QV(Ei(()=>({...i,loading:F.value}))),se=Ei(()=>Mh({extend:Mh(oue),...a0({variants:{active:{true:{base:AE(l.ui?.button?.variants?.active?.true?.base,i.activeClass)},false:{base:AE(l.ui?.button?.variants?.active?.false?.base,i.inactiveClass)}}}},l.ui?.button||{})})({color:i.color,variant:i.variant,size:_.value,loading:F.value,block:i.block,square:i.square||!s.default&&!i.label,leading:$.value,trailing:W.value,fieldGroup:p.value}));return(ie,pe)=>(li(),En(sue,Oo({type:e.type,disabled:e.disabled||F.value},ut(ij)(ut(b),["type","disabled","onClick"]),{custom:""}),{default:Jn(({active:ye,...de})=>[tr(cj,Oo(de,{"data-slot":"base",class:se.value.base({class:[i.ui?.base,i.class],active:ye,...ye&&e.activeVariant?{variant:e.activeVariant}:{},...ye&&e.activeColor?{color:e.activeColor}:{}}),onClick:O}),{default:Jn(()=>[Rs(ie.$slots,"leading",{ui:se.value},()=>[ut($)&&ut(Y)?(li(),En(ab,{key:0,name:ut(Y),"data-slot":"leadingIcon",class:_s(se.value.leadingIcon({class:i.ui?.leadingIcon,active:ye}))},null,8,["name","class"])):e.avatar?(li(),En(pk,Oo({key:1,size:i.ui?.leadingAvatarSize||se.value.leadingAvatarSize()},e.avatar,{"data-slot":"leadingAvatar",class:se.value.leadingAvatar({class:i.ui?.leadingAvatar,active:ye})}),null,16,["size","class"])):gr("",!0)]),Rs(ie.$slots,"default",{ui:se.value},()=>[e.label!==void 0&&e.label!==null?(li(),ir("span",{key:0,"data-slot":"label",class:_s(se.value.label({class:i.ui?.label,active:ye}))},Lr(e.label),3)):gr("",!0)]),Rs(ie.$slots,"trailing",{ui:se.value},()=>[ut(W)&&ut(ae)?(li(),En(ab,{key:0,name:ut(ae),"data-slot":"trailingIcon",class:_s(se.value.trailingIcon({class:i.ui?.trailingIcon,active:ye}))},null,8,["name","class"])):gr("",!0)])]),_:2},1040,["class"])]),_:3},16,["type","disabled"]))}},uj=Symbol("nuxt-ui.toast-max");function mk(){const e=X_("toasts",()=>[]),i=Fo(uj,void 0),s=an(!1),l=[],p=()=>`${Date.now()}-${Math.random().toString(36).slice(2,9)}`;async function _(){if(!(s.value||l.length===0)){for(s.value=!0;l.length>0;){const F=l.shift();await Da(),e.value=[...e.value,F].slice(-(i?.value??5))}s.value=!1}}function b(F){const $={id:p(),open:!0,...F};return l.push($),_(),$}function t(F,$){const W=e.value.findIndex(Y=>Y.id===F);W!==-1&&(e.value[W]={...e.value[W],...$})}function P(F){const $=e.value.findIndex(W=>W.id===F);$!==-1&&(e.value[$]={...e.value[$],open:!1}),setTimeout(()=>{e.value=e.value.filter(W=>W.id!==F)},200)}function O(){e.value=[]}return{toasts:e,add:b,update:t,remove:P,clear:O}}function aue(e){window[`ga-disable-${e}`]=!0}function lue(e){const i=`ga-disable-${e}`;i in window&&delete window[i]}function cue(){const e=jf().public.gtag,i=L4(e);let s;s=IS;const l=t=>{const P=[...i];let O=P.find(F=>F.id===t);return O||(t?(O={id:t},P.unshift(O)):O=P[0]),O||console.error("[nuxt-gtag] Missing Google tag ID"),{tag:O,tags:P}},p=t=>{{const{tag:P,tags:O}=l(t);if(!P)return;window.dataLayer||D4({tags:O}),document.head.querySelector("script[data-gtag]")||hb({script:[{src:pv(e.url,{id:P.id}),"data-gtag":""}]})}};function _(t){{const{tag:P}=l(t);P&&aue(P.id)}}function b(t){{const{tag:P}=l(t);P&&lue(P.id)}}return{gtag:s,initialize:p,disableAnalytics:_,enableAnalytics:b}}const pS={meta:"",ctrl:"",alt:"",win:"",command:"",shift:"",control:"",option:"",enter:"",delete:"",backspace:"",escape:"Esc",tab:"",capslock:"",arrowup:"",arrowright:"",arrowdown:"",arrowleft:"",pageup:"",pagedown:"",home:"",end:""},uue=()=>{const e=Ei(()=>navigator&&navigator.userAgent&&navigator.userAgent.match(/Macintosh;/)),i=Ol({meta:" ",alt:" ",ctrl:" "});La(()=>{i.meta=e.value?pS.command:"Ctrl",i.ctrl=e.value?pS.control:"Ctrl",i.alt=e.value?pS.option:"Alt"});function s(l){if(l)return["meta","alt","ctrl"].includes(l)?i[l]:pS[l]||l}return{macOS:e,getKbdKey:s}},hue=VM(uue),due=/^[^-]+.*-.*[^-]+$/,fue=/^[^_]+.*_.*[^_]+$/,cF=["arrowleft","arrowright","arrowup","arrowright","tab","escape","enter","backspace"];function nA(e){return/^[a-z]$/i.test(e)?`Key${e.toUpperCase()}`:/^\d$/.test(e)?`Digit${e}`:/^f\d+$/i.test(e)?e.toUpperCase():{space:"Space",enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight"}[e.toLowerCase()]||e}function hj(e,i={}){const s=an([]),l=()=>{s.value.splice(0,s.value.length)},p=hI(l,i.chainDelay??800),{macOS:_}=hue(),b=Rie(),t=i.layoutIndependent??!1,P=cF.map(W=>nA(W)),O=W=>{if(!W.key)return;const Y=t?/^Key[A-Z]$/i.test(W.code):/^[a-z]{1}$/i.test(W.key),ae=t?P.includes(W.code):cF.includes(W.key.toLowerCase());let se;if(s.value.push(t?W.code:W.key),s.value.length>=2){se=s.value.slice(-2).join("-");for(const ie of $.value.filter(pe=>pe.chained))if(ie.key===se){ie.enabled&&(W.preventDefault(),ie.handler(W)),l();return}}for(const ie of $.value.filter(pe=>!pe.chained)){if(t){if(W.code!==ie.key)continue}else if(W.key.toLowerCase()!==ie.key)continue;if(W.metaKey===ie.metaKey&&W.ctrlKey===ie.ctrlKey&&!((Y||ae)&&W.shiftKey!==ie.shiftKey)){ie.enabled&&(W.preventDefault(),ie.handler(W)),l();return}}p()},F=Ei(()=>{const W=b.value?.tagName,Y=b.value?.contentEditable;return W==="INPUT"||W==="TEXTAREA"||Y==="true"||Y==="plaintext-only"?b.value?.name||!0:!1}),$=Ei(()=>Object.entries(Rr(e)).map(([W,Y])=>{if(!Y)return null;let ae;W.includes("-")&&W!=="-"&&!W.includes("_")&&!W.match(due)?.length&&console.trace(`[Shortcut] Invalid key: "${W}"`),W.includes("_")&&W!=="_"&&!W.match(fue)?.length&&console.trace(`[Shortcut] Invalid key: "${W}"`);const se=W.includes("-")&&W!=="-"&&!W.includes("_");if(se)t?ae={key:W.split("-").map(ye=>nA(ye)).join("-"),metaKey:!1,ctrlKey:!1,shiftKey:!1,altKey:!1}:ae={key:W.toLowerCase(),metaKey:!1,ctrlKey:!1,shiftKey:!1,altKey:!1};else{const pe=W.toLowerCase().split("_").map(de=>de);let ye=pe.filter(de=>!["meta","command","ctrl","shift","alt","option"].includes(de)).join("_");t&&(ye=nA(ye)),ae={key:ye,metaKey:pe.includes("meta")||pe.includes("command"),ctrlKey:pe.includes("ctrl"),shiftKey:pe.includes("shift"),altKey:pe.includes("alt")||pe.includes("option")}}if(ae.chained=se,!_.value&&ae.metaKey&&!ae.ctrlKey&&(ae.metaKey=!1,ae.ctrlKey=!0),typeof Y=="function"?ae.handler=Y:typeof Y=="object"&&(ae={...ae,handler:Y.handler}),!ae.handler)return console.trace("[Shortcut] Invalid value"),null;let ie=!0;return Y.usingInput?typeof Y.usingInput=="string"&&(ie=F.value===Y.usingInput):ie=!F.value,ae.enabled=ie,ae}).filter(Boolean));return ld("keydown",O)}const pue={class:"flex items-center justify-between border-b border-white/10 p-4"},mue={class:"flex items-center gap-2"},gue={class:"text-lg font-semibold text-neutral-900 dark:text-white"},_ue={key:0,class:"p-4"},yue={key:0,class:"mb-4 flex items-center gap-2"},vue={class:"space-y-4"},xue={class:"rounded-lg border border-neutral-200/50 bg-neutral-50/50 p-3 dark:border-neutral-700/50 dark:bg-neutral-800/50"},bue={class:"mb-1 block text-xs font-medium text-neutral-600 dark:text-neutral-400"},wue={class:"flex items-center gap-2"},Tue=["value"],Sue={class:"rounded-lg border border-neutral-200/50 bg-neutral-50/50 p-3 dark:border-neutral-700/50 dark:bg-neutral-800/50"},Eue={class:"flex items-center justify-between mb-2"},Iue={class:"block text-xs font-medium text-neutral-600 dark:text-neutral-400"},Cue={class:"relative rounded-md bg-neutral-100/50 dark:bg-neutral-700/50 overflow-hidden"},Aue={key:0,class:"flex items-center justify-center bg-neutral-100/50 dark:bg-neutral-700/50 aspect-[2/1]"},Pue={class:"flex flex-col items-center gap-2"},Mue={class:"text-xs text-neutral-500 dark:text-neutral-400"},kue={key:1,class:"flex items-center justify-center bg-neutral-100/50 dark:bg-neutral-700/50 aspect-[2/1]"},Due={class:"flex flex-col items-center gap-2"},Lue={class:"text-xs text-neutral-500 dark:text-neutral-400"},Rue=["src","alt"],zue={class:"grid grid-cols-3 gap-3"},Oue=["onClick"],Fue={class:"text-xs font-medium text-neutral-700 dark:text-neutral-300"},Bue=kr({__name:"ShareModal",props:{isOpen:{type:Boolean},photo:{}},emits:["close"],setup(e,{emit:i}){const{t:s}=h0(),l=e,p=i,_=mk(),{gtag:b}=cue(),t=Ei(()=>typeof window<"u"?`${window.location.origin}/${l.photo.id}`:""),P=Ei(()=>{const Wt=l.photo.title||s("ui.action.share.fallback.photoTitle"),$t=l.photo.description||"";return`${s("ui.action.share.text.prefix")} ${Wt}${$t?" - "+$t:""}`}),O=Ei(()=>`${P.value}
${t.value}`),F=an(!0),$=an(!1),W=an(null),Y=Ei(()=>{if(typeof window<"u"){const Wt=Date.now();return`${window.location.origin}/__og-image__/image/${l.photo.id}/og.png?t=${Wt}`}return""}),ae=()=>{F.value=!0,$.value=!1,W.value&&clearTimeout(W.value),W.value=setTimeout(()=>{F.value&&(F.value=!1,$.value=!0)},1e4)};Qn(()=>l.photo.id,ae),Qn(()=>l.isOpen,Wt=>{Wt&&ae()});const se=()=>{W.value&&(clearTimeout(W.value),W.value=null),F.value=!1,$.value=!1},ie=()=>{W.value&&(clearTimeout(W.value),W.value=null),F.value=!1,$.value=!0};ru(()=>{W.value&&clearTimeout(W.value)});const pe=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"twitter"});const Wt=encodeURIComponent(P.value),$t=encodeURIComponent(t.value);window.open(`https://twitter.com/intent/tweet?text=${Wt}&url=${$t}`,"_blank")},ye=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"telegram"}),window.open(`https://t.me/share/url?url=${encodeURIComponent(t.value)}&text=${encodeURIComponent(P.value)}`,"_blank")},de=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"weibo"});const Wt=encodeURIComponent(P.value),$t=encodeURIComponent(t.value);window.open(`https://service.weibo.com/share/share.php?url=${$t}&title=${Wt}`,"_blank")},Ee=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"facebook"});const Wt=encodeURIComponent(t.value);window.open(`https://www.facebook.com/sharer/sharer.php?u=${Wt}`,"_blank")},Pe=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"whatsapp"});const Wt=encodeURIComponent(`${P.value}
${t.value}`);window.open(`https://wa.me/?text=${Wt}`,"_blank")},Ze=()=>{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"linkedin"});const Wt=encodeURIComponent(t.value),$t=encodeURIComponent(P.value);window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${Wt}&title=${$t}`,"_blank")},We=async()=>{try{await navigator.clipboard.writeText(O.value),_.add({title:s("ui.action.share.success.linkCopied"),color:"success",icon:"tabler:check",duration:3e3})}catch(Wt){_.add({title:s("ui.action.share.error.linkCopyFailed"),description:Wt?.message||"Unknown error",color:"error",icon:"tabler:x",duration:3e3})}},je=async()=>{if(navigator.share)try{b("event","photo_share",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",share_method:"native_share"}),await navigator.share({title:P.value,url:t.value})}catch(Wt){console.error(s("ui.action.share.error.nativeShareFailed"),Wt)}},Ye=async()=>{try{const $t=await(await fetch(Y.value)).blob(),Dt=window.URL.createObjectURL($t),Ft=document.createElement("a");Ft.href=Dt,Ft.download=`${l.photo.title||"photo"}-og.png`,document.body.appendChild(Ft),Ft.click(),document.body.removeChild(Ft),window.URL.revokeObjectURL(Dt),_.add({title:s("ui.action.share.success.ogImageDownloaded"),color:"success",icon:"tabler:download",duration:3e3})}catch(Wt){_.add({title:s("ui.action.share.error.ogImageDownloadFailed"),description:Wt?.message||"Unknown error",color:"error",icon:"tabler:x",duration:3e3})}},ct=async()=>{try{const $t=await(await fetch(l.photo.originalUrl)).blob(),Dt=window.URL.createObjectURL($t),Ft=document.createElement("a");Ft.href=Dt;const vt=l.photo.originalUrl.split(".").pop()||"jpg";Ft.download=`${l.photo.title||"photo"}.${vt}`,document.body.appendChild(Ft),Ft.click(),document.body.removeChild(Ft),window.URL.revokeObjectURL(Dt),b("event","photo_download",{photo_id:l.photo.id,photo_title:l.photo.title||"Untitled",download_type:"original"}),_.add({title:s("ui.action.share.success.originalImageDownloaded"),color:"success",icon:"tabler:download",duration:3e3})}catch(Wt){_.add({title:s("ui.action.share.error.originalImageDownloadFailed"),description:Wt?.message||"Unknown error",color:"error",icon:"tabler:x",duration:3e3})}},Lt=Ei(()=>typeof window<"u"&&navigator.share),Ht=Ei(()=>[{name:s("ui.action.share.platforms.twitter"),icon:"tabler:brand-twitter",color:"text-blue-500",action:pe},{name:s("ui.action.share.platforms.telegram"),icon:"tabler:brand-telegram",color:"text-blue-400",action:ye},{name:s("ui.action.share.platforms.weibo"),icon:"tabler:brand-weibo",color:"text-red-500",action:de},{name:s("ui.action.share.platforms.facebook"),icon:"tabler:brand-facebook",color:"text-blue-600",action:Ee},{name:s("ui.action.share.platforms.whatsapp"),icon:"tabler:brand-whatsapp",color:"text-green-500",action:Pe},{name:s("ui.action.share.platforms.linkedin"),icon:"tabler:brand-linkedin",color:"text-blue-700",action:Ze}]),ci=Wt=>{Wt.target===Wt.currentTarget&&p("close")};return hj({escape:()=>{p("close")}}),(Wt,$t)=>{const Dt=Wd,Ft=Sw;return li(),En(UE,{to:"body"},[tr(ut(ym),null,{default:Jn(()=>[e.isOpen?(li(),En(ut(Gl).div,{key:0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:ci},{default:Jn(()=>[tr(ut(Gl).div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.3,bounce:.1},class:"relative mx-4 w-full max-w-md overflow-hidden rounded-2xl border border-white/10 bg-white/90 shadow-2xl backdrop-blur-2xl dark:bg-neutral-900/90",onClick:$t[1]||($t[1]=Sm(()=>{},["stop"]))},{default:Jn(()=>[Bn("div",pue,[Bn("div",mue,[tr(Dt,{name:"tabler:share-3",class:"size-5 text-neutral-700 dark:text-neutral-300"}),Bn("h3",gue,Lr(ut(s)("ui.action.share.title")),1)]),tr(Ft,{size:"sm",variant:"ghost",color:"neutral",icon:"tabler:x",onClick:$t[0]||($t[0]=vt=>p("close"))})]),e.photo?(li(),ir("div",_ue,[ut(Lt)?(li(),ir("div",yue,[tr(Ft,{block:"",size:"lg",color:"info",variant:"soft",icon:"tabler:share-2",onClick:je},{default:Jn(()=>[Gd(Lr(ut(s)("ui.action.share.actions.nativeShare")),1)]),_:1}),tr(Ft,{block:"",size:"lg",color:"info",variant:"soft",icon:"tabler:download",onClick:ct},{default:Jn(()=>[Gd(Lr(ut(s)("ui.action.share.actions.downloadOriginalImage")),1)]),_:1})])):gr("",!0),Bn("div",vue,[Bn("div",xue,[Bn("label",bue,Lr(ut(s)("ui.action.share.actions.shareUrl")),1),Bn("div",wue,[Bn("input",{value:ut(t),readonly:"",class:"flex-1 truncate bg-transparent text-sm text-neutral-800 dark:text-neutral-200 resize-none"},null,8,Tue),tr(Ft,{size:"xs",variant:"ghost",color:"neutral",icon:"tabler:copy",onClick:We})])]),Bn("div",Sue,[Bn("div",Eue,[Bn("label",Iue,Lr(ut(s)("ui.action.share.ogImage.title")),1),tr(Ft,{size:"xs",variant:"ghost",color:"neutral",icon:"tabler:download",onClick:Ye},{default:Jn(()=>[Gd(Lr(ut(s)("ui.action.share.actions.downloadOgImage")),1)]),_:1})]),Bn("div",Cue,[ut(F)?(li(),ir("div",Aue,[Bn("div",Pue,[tr(Dt,{name:"tabler:loader-2",class:"size-6 text-neutral-500 animate-spin"}),Bn("span",Mue,Lr(ut(s)("ui.action.share.ogImage.loading")),1)])])):ut($)?(li(),ir("div",kue,[Bn("div",Due,[tr(Dt,{name:"tabler:photo-off",class:"size-6 text-neutral-400"}),Bn("span",Lue,Lr(ut(s)("ui.action.share.ogImage.loadError")),1)])])):gr("",!0),x5((li(),ir("img",{key:`og-image-${l.photo.id}-${Date.now()}`,src:ut(Y),alt:ut(s)("ui.action.share.ogImage.alt"),class:"w-full h-auto aspect-[2/1] object-cover rounded",loading:"eager",onLoad:se,onError:ie},null,40,Rue)),[[gB,!ut(F)&&!ut($)]])])]),Bn("div",zue,[(li(!0),ir(qs,null,Eu(ut(Ht),vt=>(li(),ir("button",{key:vt.name,type:"button",class:"cursor-pointer flex flex-col items-center justify-center gap-2 rounded-xl border border-neutral-200/50 bg-white/50 p-4 transition-all hover:scale-105 hover:border-neutral-300/50 hover:bg-white/70 dark:border-neutral-700/50 dark:bg-neutral-800/50 dark:hover:border-neutral-600/50 dark:hover:bg-neutral-700/50",onClick:vt.action},[tr(Dt,{name:vt.icon,class:_s(["size-6",vt.color])},null,8,["name","class"]),Bn("span",Fue,Lr(vt.name),1)],8,Oue))),128))])])])):gr("",!0)]),_:1})]),_:1})):gr("",!0)]),_:1})])}}}),Nue=Object.assign(Bue,{__name:"PhotoShareModal"});function uF(e){return e!==null&&typeof e=="object"&&"constructor"in e&&e.constructor===Object}function gk(e={},i={}){const s=["__proto__","constructor","prototype"];Object.keys(i).filter(l=>s.indexOf(l)<0).forEach(l=>{typeof e[l]>"u"?e[l]=i[l]:uF(i[l])&&uF(e[l])&&Object.keys(i[l]).length>0&&gk(e[l],i[l])})}const dj={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Og(){const e=typeof document<"u"?document:{};return gk(e,dj),e}const Vue={document:dj,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(e){return typeof setTimeout>"u"?(e(),null):setTimeout(e,0)},cancelAnimationFrame(e){typeof setTimeout>"u"||clearTimeout(e)}};function Zu(){const e=typeof window<"u"?window:{};return gk(e,Vue),e}function jue(e=""){return e.trim().split(" ").filter(i=>!!i.trim())}function Uue(e){const i=e;Object.keys(i).forEach(s=>{try{i[s]=null}catch{}try{delete i[s]}catch{}})}function fj(e,i=0){return setTimeout(e,i)}function ME(){return Date.now()}function $ue(e){const i=Zu();let s;return i.getComputedStyle&&(s=i.getComputedStyle(e,null)),!s&&e.currentStyle&&(s=e.currentStyle),s||(s=e.style),s}function Gue(e,i="x"){const s=Zu();let l,p,_;const b=$ue(e);return s.WebKitCSSMatrix?(p=b.transform||b.webkitTransform,p.split(",").length>6&&(p=p.split(", ").map(t=>t.replace(",",".")).join(", ")),_=new s.WebKitCSSMatrix(p==="none"?"":p)):(_=b.MozTransform||b.OTransform||b.MsTransform||b.msTransform||b.transform||b.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),l=_.toString().split(",")),i==="x"&&(s.WebKitCSSMatrix?p=_.m41:l.length===16?p=parseFloat(l[12]):p=parseFloat(l[4])),i==="y"&&(s.WebKitCSSMatrix?p=_.m42:l.length===16?p=parseFloat(l[13]):p=parseFloat(l[5])),p||0}function mS(e){return typeof e=="object"&&e!==null&&e.constructor&&Object.prototype.toString.call(e).slice(8,-1)==="Object"}function que(e){return typeof window<"u"&&typeof window.HTMLElement<"u"?e instanceof HTMLElement:e&&(e.nodeType===1||e.nodeType===11)}function Ff(...e){const i=Object(e[0]),s=["__proto__","constructor","prototype"];for(let l=1;l<e.length;l+=1){const p=e[l];if(p!=null&&!que(p)){const _=Object.keys(Object(p)).filter(b=>s.indexOf(b)<0);for(let b=0,t=_.length;b<t;b+=1){const P=_[b],O=Object.getOwnPropertyDescriptor(p,P);O!==void 0&&O.enumerable&&(mS(i[P])&&mS(p[P])?p[P].__swiper__?i[P]=p[P]:Ff(i[P],p[P]):!mS(i[P])&&mS(p[P])?(i[P]={},p[P].__swiper__?i[P]=p[P]:Ff(i[P],p[P])):i[P]=p[P])}}}return i}function nw(e,i,s){e.style.setProperty(i,s)}function pj({swiper:e,targetPosition:i,side:s}){const l=Zu(),p=-e.translate;let _=null,b;const t=e.params.speed;e.wrapperEl.style.scrollSnapType="none",l.cancelAnimationFrame(e.cssModeFrameID);const P=i>p?"next":"prev",O=($,W)=>P==="next"&&$>=W||P==="prev"&&$<=W,F=()=>{b=new Date().getTime(),_===null&&(_=b);const $=Math.max(Math.min((b-_)/t,1),0),W=.5-Math.cos($*Math.PI)/2;let Y=p+W*(i-p);if(O(Y,i)&&(Y=i),e.wrapperEl.scrollTo({[s]:Y}),O(Y,i)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[s]:Y})}),l.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=l.requestAnimationFrame(F)};F()}function bm(e,i=""){const s=Zu(),l=[...e.children];return s.HTMLSlotElement&&e instanceof HTMLSlotElement&&l.push(...e.assignedElements()),i?l.filter(p=>p.matches(i)):l}function Hue(e,i){const s=[i];for(;s.length>0;){const l=s.shift();if(e===l)return!0;s.push(...l.children,...l.shadowRoot?l.shadowRoot.children:[],...l.assignedElements?l.assignedElements():[])}}function Wue(e,i){const s=Zu();let l=i.contains(e);return!l&&s.HTMLSlotElement&&i instanceof HTMLSlotElement&&(l=[...i.assignedElements()].includes(e),l||(l=Hue(e,i))),l}function kE(e){try{console.warn(e);return}catch{}}function lb(e,i=[]){const s=document.createElement(e);return s.classList.add(...Array.isArray(i)?i:jue(i)),s}function Zue(e){const i=Zu(),s=Og(),l=e.getBoundingClientRect(),p=s.body,_=e.clientTop||p.clientTop||0,b=e.clientLeft||p.clientLeft||0,t=e===i?i.scrollY:e.scrollTop,P=e===i?i.scrollX:e.scrollLeft;return{top:l.top+t-_,left:l.left+P-b}}function Xue(e,i){const s=[];for(;e.previousElementSibling;){const l=e.previousElementSibling;i?l.matches(i)&&s.push(l):s.push(l),e=l}return s}function Yue(e,i){const s=[];for(;e.nextElementSibling;){const l=e.nextElementSibling;i?l.matches(i)&&s.push(l):s.push(l),e=l}return s}function e0(e,i){return Zu().getComputedStyle(e,null).getPropertyValue(i)}function hF(e){let i=e,s;if(i){for(s=0;(i=i.previousSibling)!==null;)i.nodeType===1&&(s+=1);return s}}function NP(e,i){const s=[];let l=e.parentElement;for(;l;)i?l.matches(i)&&s.push(l):s.push(l),l=l.parentElement;return s}function dF(e,i,s){const l=Zu();return e[i==="width"?"offsetWidth":"offsetHeight"]+parseFloat(l.getComputedStyle(e,null).getPropertyValue(i==="width"?"margin-right":"margin-top"))+parseFloat(l.getComputedStyle(e,null).getPropertyValue(i==="width"?"margin-left":"margin-bottom"))}function D_(e){return(Array.isArray(e)?e:[e]).filter(i=>!!i)}function Ww(e,i=""){typeof trustedTypes<"u"?e.innerHTML=trustedTypes.createPolicy("html",{createHTML:s=>s}).createHTML(i):e.innerHTML=i}let rA;function Kue(){const e=Zu(),i=Og();return{smoothScroll:i.documentElement&&i.documentElement.style&&"scrollBehavior"in i.documentElement.style,touch:!!("ontouchstart"in e||e.DocumentTouch&&i instanceof e.DocumentTouch)}}function mj(){return rA||(rA=Kue()),rA}let sA;function Jue({userAgent:e}={}){const i=mj(),s=Zu(),l=s.navigator.platform,p=e||s.navigator.userAgent,_={ios:!1,android:!1},b=s.screen.width,t=s.screen.height,P=p.match(/(Android);?[\s\/]+([\d.]+)?/);let O=p.match(/(iPad)(?!\1).*OS\s([\d_]+)/);const F=p.match(/(iPod)(.*OS\s([\d_]+))?/),$=!O&&p.match(/(iPhone\sOS|iOS)\s([\d_]+)/),W=l==="Win32";let Y=l==="MacIntel";const ae=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!O&&Y&&i.touch&&ae.indexOf(`${b}x${t}`)>=0&&(O=p.match(/(Version)\/([\d.]+)/),O||(O=[0,1,"13_0_0"]),Y=!1),P&&!W&&(_.os="android",_.android=!0),(O||$||F)&&(_.os="ios",_.ios=!0),_}function gj(e={}){return sA||(sA=Jue(e)),sA}let oA;function Que(){const e=Zu(),i=gj();let s=!1;function l(){const t=e.navigator.userAgent.toLowerCase();return t.indexOf("safari")>=0&&t.indexOf("chrome")<0&&t.indexOf("android")<0}if(l()){const t=String(e.navigator.userAgent);if(t.includes("Version/")){const[P,O]=t.split("Version/")[1].split(" ")[0].split(".").map(F=>Number(F));s=P<16||P===16&&O<2}}const p=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent),_=l(),b=_||p&&i.ios;return{isSafari:s||_,needPerspectiveFix:s,need3dFix:b,isWebView:p}}function _j(){return oA||(oA=Que()),oA}function ehe({swiper:e,on:i,emit:s}){const l=Zu();let p=null,_=null;const b=()=>{!e||e.destroyed||!e.initialized||(s("beforeResize"),s("resize"))},t=()=>{!e||e.destroyed||!e.initialized||(p=new ResizeObserver(F=>{_=l.requestAnimationFrame(()=>{const{width:$,height:W}=e;let Y=$,ae=W;F.forEach(({contentBoxSize:se,contentRect:ie,target:pe})=>{pe&&pe!==e.el||(Y=ie?ie.width:(se[0]||se).inlineSize,ae=ie?ie.height:(se[0]||se).blockSize)}),(Y!==$||ae!==W)&&b()})}),p.observe(e.el))},P=()=>{_&&l.cancelAnimationFrame(_),p&&p.unobserve&&e.el&&(p.unobserve(e.el),p=null)},O=()=>{!e||e.destroyed||!e.initialized||s("orientationchange")};i("init",()=>{if(e.params.resizeObserver&&typeof l.ResizeObserver<"u"){t();return}l.addEventListener("resize",b),l.addEventListener("orientationchange",O)}),i("destroy",()=>{P(),l.removeEventListener("resize",b),l.removeEventListener("orientationchange",O)})}function the({swiper:e,extendParams:i,on:s,emit:l}){const p=[],_=Zu(),b=(O,F={})=>{const $=_.MutationObserver||_.WebkitMutationObserver,W=new $(Y=>{if(e.__preventObserver__)return;if(Y.length===1){l("observerUpdate",Y[0]);return}const ae=function(){l("observerUpdate",Y[0])};_.requestAnimationFrame?_.requestAnimationFrame(ae):_.setTimeout(ae,0)});W.observe(O,{attributes:typeof F.attributes>"u"?!0:F.attributes,childList:e.isElement||(typeof F.childList>"u"?!0:F).childList,characterData:typeof F.characterData>"u"?!0:F.characterData}),p.push(W)},t=()=>{if(e.params.observer){if(e.params.observeParents){const O=NP(e.hostEl);for(let F=0;F<O.length;F+=1)b(O[F])}b(e.hostEl,{childList:e.params.observeSlideChildren}),b(e.wrapperEl,{attributes:!1})}},P=()=>{p.forEach(O=>{O.disconnect()}),p.splice(0,p.length)};i({observer:!1,observeParents:!1,observeSlideChildren:!1}),s("init",t),s("destroy",P)}var ihe={on(e,i,s){const l=this;if(!l.eventsListeners||l.destroyed||typeof i!="function")return l;const p=s?"unshift":"push";return e.split(" ").forEach(_=>{l.eventsListeners[_]||(l.eventsListeners[_]=[]),l.eventsListeners[_][p](i)}),l},once(e,i,s){const l=this;if(!l.eventsListeners||l.destroyed||typeof i!="function")return l;function p(..._){l.off(e,p),p.__emitterProxy&&delete p.__emitterProxy,i.apply(l,_)}return p.__emitterProxy=i,l.on(e,p,s)},onAny(e,i){const s=this;if(!s.eventsListeners||s.destroyed||typeof e!="function")return s;const l=i?"unshift":"push";return s.eventsAnyListeners.indexOf(e)<0&&s.eventsAnyListeners[l](e),s},offAny(e){const i=this;if(!i.eventsListeners||i.destroyed||!i.eventsAnyListeners)return i;const s=i.eventsAnyListeners.indexOf(e);return s>=0&&i.eventsAnyListeners.splice(s,1),i},off(e,i){const s=this;return!s.eventsListeners||s.destroyed||!s.eventsListeners||e.split(" ").forEach(l=>{typeof i>"u"?s.eventsListeners[l]=[]:s.eventsListeners[l]&&s.eventsListeners[l].forEach((p,_)=>{(p===i||p.__emitterProxy&&p.__emitterProxy===i)&&s.eventsListeners[l].splice(_,1)})}),s},emit(...e){const i=this;if(!i.eventsListeners||i.destroyed||!i.eventsListeners)return i;let s,l,p;return typeof e[0]=="string"||Array.isArray(e[0])?(s=e[0],l=e.slice(1,e.length),p=i):(s=e[0].events,l=e[0].data,p=e[0].context||i),l.unshift(p),(Array.isArray(s)?s:s.split(" ")).forEach(b=>{i.eventsAnyListeners&&i.eventsAnyListeners.length&&i.eventsAnyListeners.forEach(t=>{t.apply(p,[b,...l])}),i.eventsListeners&&i.eventsListeners[b]&&i.eventsListeners[b].forEach(t=>{t.apply(p,l)})}),i}};function nhe(){const e=this;let i,s;const l=e.el;typeof e.params.width<"u"&&e.params.width!==null?i=e.params.width:i=l.clientWidth,typeof e.params.height<"u"&&e.params.height!==null?s=e.params.height:s=l.clientHeight,!(i===0&&e.isHorizontal()||s===0&&e.isVertical())&&(i=i-parseInt(e0(l,"padding-left")||0,10)-parseInt(e0(l,"padding-right")||0,10),s=s-parseInt(e0(l,"padding-top")||0,10)-parseInt(e0(l,"padding-bottom")||0,10),Number.isNaN(i)&&(i=0),Number.isNaN(s)&&(s=0),Object.assign(e,{width:i,height:s,size:e.isHorizontal()?i:s}))}function rhe(){const e=this;function i(ct,Lt){return parseFloat(ct.getPropertyValue(e.getDirectionLabel(Lt))||0)}const s=e.params,{wrapperEl:l,slidesEl:p,rtlTranslate:_,wrongRTL:b}=e,t=e.virtual&&s.virtual.enabled,P=t?e.virtual.slides.length:e.slides.length,O=bm(p,`.${e.params.slideClass}, swiper-slide`),F=t?e.virtual.slides.length:O.length;let $=[];const W=[],Y=[];let ae=s.slidesOffsetBefore;typeof ae=="function"&&(ae=s.slidesOffsetBefore.call(e));let se=s.slidesOffsetAfter;typeof se=="function"&&(se=s.slidesOffsetAfter.call(e));const ie=e.snapGrid.length,pe=e.slidesGrid.length,ye=e.size-ae-se;let de=s.spaceBetween,Ee=-ae,Pe=0,Ze=0;if(typeof ye>"u")return;typeof de=="string"&&de.indexOf("%")>=0?de=parseFloat(de.replace("%",""))/100*ye:typeof de=="string"&&(de=parseFloat(de)),e.virtualSize=-de-ae-se,O.forEach(ct=>{_?ct.style.marginLeft="":ct.style.marginRight="",ct.style.marginBottom="",ct.style.marginTop=""}),s.centeredSlides&&s.cssMode&&(nw(l,"--swiper-centered-offset-before",""),nw(l,"--swiper-centered-offset-after",""));const We=s.grid&&s.grid.rows>1&&e.grid;We?e.grid.initSlides(O):e.grid&&e.grid.unsetSlides();let je;const Ye=s.slidesPerView==="auto"&&s.breakpoints&&Object.keys(s.breakpoints).filter(ct=>typeof s.breakpoints[ct].slidesPerView<"u").length>0;for(let ct=0;ct<F;ct+=1){je=0;const Lt=O[ct];if(!(Lt&&(We&&e.grid.updateSlide(ct,Lt,O),e0(Lt,"display")==="none"))){if(t&&s.slidesPerView==="auto")s.virtual.slidesPerViewAutoSlideSize&&(je=s.virtual.slidesPerViewAutoSlideSize),je&&Lt&&(s.roundLengths&&(je=Math.floor(je)),Lt.style[e.getDirectionLabel("width")]=`${je}px`);else if(s.slidesPerView==="auto"){Ye&&(Lt.style[e.getDirectionLabel("width")]="");const Ht=getComputedStyle(Lt),ci=Lt.style.transform,Wt=Lt.style.webkitTransform;if(ci&&(Lt.style.transform="none"),Wt&&(Lt.style.webkitTransform="none"),s.roundLengths)je=e.isHorizontal()?dF(Lt,"width"):dF(Lt,"height");else{const $t=i(Ht,"width"),Dt=i(Ht,"padding-left"),Ft=i(Ht,"padding-right"),vt=i(Ht,"margin-left"),wi=i(Ht,"margin-right"),Qi=Ht.getPropertyValue("box-sizing");if(Qi&&Qi==="border-box")je=$t+vt+wi;else{const{clientWidth:wn,offsetWidth:qn}=Lt;je=$t+Dt+Ft+vt+wi+(qn-wn)}}ci&&(Lt.style.transform=ci),Wt&&(Lt.style.webkitTransform=Wt),s.roundLengths&&(je=Math.floor(je))}else je=(ye-(s.slidesPerView-1)*de)/s.slidesPerView,s.roundLengths&&(je=Math.floor(je)),Lt&&(Lt.style[e.getDirectionLabel("width")]=`${je}px`);Lt&&(Lt.swiperSlideSize=je),Y.push(je),s.centeredSlides?(Ee=Ee+je/2+Pe/2+de,Pe===0&&ct!==0&&(Ee=Ee-ye/2-de),ct===0&&(Ee=Ee-ye/2-de),Math.abs(Ee)<1/1e3&&(Ee=0),s.roundLengths&&(Ee=Math.floor(Ee)),Ze%s.slidesPerGroup===0&&$.push(Ee),W.push(Ee)):(s.roundLengths&&(Ee=Math.floor(Ee)),(Ze-Math.min(e.params.slidesPerGroupSkip,Ze))%e.params.slidesPerGroup===0&&$.push(Ee),W.push(Ee),Ee=Ee+je+de),e.virtualSize+=je+de,Pe=je,Ze+=1}}if(e.virtualSize=Math.max(e.virtualSize,ye)+se,_&&b&&(s.effect==="slide"||s.effect==="coverflow")&&(l.style.width=`${e.virtualSize+de}px`),s.setWrapperSize&&(l.style[e.getDirectionLabel("width")]=`${e.virtualSize+de}px`),We&&e.grid.updateWrapperSize(je,$),!s.centeredSlides){const ct=[];for(let Lt=0;Lt<$.length;Lt+=1){let Ht=$[Lt];s.roundLengths&&(Ht=Math.floor(Ht)),$[Lt]<=e.virtualSize-ye&&ct.push(Ht)}$=ct,Math.floor(e.virtualSize-ye)-Math.floor($[$.length-1])>1&&$.push(e.virtualSize-ye)}if(t&&s.loop){const ct=Y[0]+de;if(s.slidesPerGroup>1){const Lt=Math.ceil((e.virtual.slidesBefore+e.virtual.slidesAfter)/s.slidesPerGroup),Ht=ct*s.slidesPerGroup;for(let ci=0;ci<Lt;ci+=1)$.push($[$.length-1]+Ht)}for(let Lt=0;Lt<e.virtual.slidesBefore+e.virtual.slidesAfter;Lt+=1)s.slidesPerGroup===1&&$.push($[$.length-1]+ct),W.push(W[W.length-1]+ct),e.virtualSize+=ct}if($.length===0&&($=[0]),de!==0){const ct=e.isHorizontal()&&_?"marginLeft":e.getDirectionLabel("marginRight");O.filter((Lt,Ht)=>!s.cssMode||s.loop?!0:Ht!==O.length-1).forEach(Lt=>{Lt.style[ct]=`${de}px`})}if(s.centeredSlides&&s.centeredSlidesBounds){let ct=0;Y.forEach(Ht=>{ct+=Ht+(de||0)}),ct-=de;const Lt=ct>ye?ct-ye:0;$=$.map(Ht=>Ht<=0?-ae:Ht>Lt?Lt+se:Ht)}if(s.centerInsufficientSlides){let ct=0;Y.forEach(Ht=>{ct+=Ht+(de||0)}),ct-=de;const Lt=(ae||0)+(se||0);if(ct+Lt<ye){const Ht=(ye-ct-Lt)/2;$.forEach((ci,Wt)=>{$[Wt]=ci-Ht}),W.forEach((ci,Wt)=>{W[Wt]=ci+Ht})}}if(Object.assign(e,{slides:O,snapGrid:$,slidesGrid:W,slidesSizesGrid:Y}),s.centeredSlides&&s.cssMode&&!s.centeredSlidesBounds){nw(l,"--swiper-centered-offset-before",`${-$[0]}px`),nw(l,"--swiper-centered-offset-after",`${e.size/2-Y[Y.length-1]/2}px`);const ct=-e.snapGrid[0],Lt=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map(Ht=>Ht+ct),e.slidesGrid=e.slidesGrid.map(Ht=>Ht+Lt)}if(F!==P&&e.emit("slidesLengthChange"),$.length!==ie&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),W.length!==pe&&e.emit("slidesGridLengthChange"),s.watchSlidesProgress&&e.updateSlidesOffset(),e.emit("slidesUpdated"),!t&&!s.cssMode&&(s.effect==="slide"||s.effect==="fade")){const ct=`${s.containerModifierClass}backface-hidden`,Lt=e.el.classList.contains(ct);F<=s.maxBackfaceHiddenSlides?Lt||e.el.classList.add(ct):Lt&&e.el.classList.remove(ct)}}function she(e){const i=this,s=[],l=i.virtual&&i.params.virtual.enabled;let p=0,_;typeof e=="number"?i.setTransition(e):e===!0&&i.setTransition(i.params.speed);const b=t=>l?i.slides[i.getSlideIndexByData(t)]:i.slides[t];if(i.params.slidesPerView!=="auto"&&i.params.slidesPerView>1)if(i.params.centeredSlides)(i.visibleSlides||[]).forEach(t=>{s.push(t)});else for(_=0;_<Math.ceil(i.params.slidesPerView);_+=1){const t=i.activeIndex+_;if(t>i.slides.length&&!l)break;s.push(b(t))}else s.push(b(i.activeIndex));for(_=0;_<s.length;_+=1)if(typeof s[_]<"u"){const t=s[_].offsetHeight;p=t>p?t:p}(p||p===0)&&(i.wrapperEl.style.height=`${p}px`)}function ohe(){const e=this,i=e.slides,s=e.isElement?e.isHorizontal()?e.wrapperEl.offsetLeft:e.wrapperEl.offsetTop:0;for(let l=0;l<i.length;l+=1)i[l].swiperSlideOffset=(e.isHorizontal()?i[l].offsetLeft:i[l].offsetTop)-s-e.cssOverflowAdjustment()}const fF=(e,i,s)=>{i&&!e.classList.contains(s)?e.classList.add(s):!i&&e.classList.contains(s)&&e.classList.remove(s)};function ahe(e=this&&this.translate||0){const i=this,s=i.params,{slides:l,rtlTranslate:p,snapGrid:_}=i;if(l.length===0)return;typeof l[0].swiperSlideOffset>"u"&&i.updateSlidesOffset();let b=-e;p&&(b=e),i.visibleSlidesIndexes=[],i.visibleSlides=[];let t=s.spaceBetween;typeof t=="string"&&t.indexOf("%")>=0?t=parseFloat(t.replace("%",""))/100*i.size:typeof t=="string"&&(t=parseFloat(t));for(let P=0;P<l.length;P+=1){const O=l[P];let F=O.swiperSlideOffset;s.cssMode&&s.centeredSlides&&(F-=l[0].swiperSlideOffset);const $=(b+(s.centeredSlides?i.minTranslate():0)-F)/(O.swiperSlideSize+t),W=(b-_[0]+(s.centeredSlides?i.minTranslate():0)-F)/(O.swiperSlideSize+t),Y=-(b-F),ae=Y+i.slidesSizesGrid[P],se=Y>=0&&Y<=i.size-i.slidesSizesGrid[P],ie=Y>=0&&Y<i.size-1||ae>1&&ae<=i.size||Y<=0&&ae>=i.size;ie&&(i.visibleSlides.push(O),i.visibleSlidesIndexes.push(P)),fF(O,ie,s.slideVisibleClass),fF(O,se,s.slideFullyVisibleClass),O.progress=p?-$:$,O.originalProgress=p?-W:W}}function lhe(e){const i=this;if(typeof e>"u"){const F=i.rtlTranslate?-1:1;e=i&&i.translate&&i.translate*F||0}const s=i.params,l=i.maxTranslate()-i.minTranslate();let{progress:p,isBeginning:_,isEnd:b,progressLoop:t}=i;const P=_,O=b;if(l===0)p=0,_=!0,b=!0;else{p=(e-i.minTranslate())/l;const F=Math.abs(e-i.minTranslate())<1,$=Math.abs(e-i.maxTranslate())<1;_=F||p<=0,b=$||p>=1,F&&(p=0),$&&(p=1)}if(s.loop){const F=i.getSlideIndexByData(0),$=i.getSlideIndexByData(i.slides.length-1),W=i.slidesGrid[F],Y=i.slidesGrid[$],ae=i.slidesGrid[i.slidesGrid.length-1],se=Math.abs(e);se>=W?t=(se-W)/ae:t=(se+ae-Y)/ae,t>1&&(t-=1)}Object.assign(i,{progress:p,progressLoop:t,isBeginning:_,isEnd:b}),(s.watchSlidesProgress||s.centeredSlides&&s.autoHeight)&&i.updateSlidesProgress(e),_&&!P&&i.emit("reachBeginning toEdge"),b&&!O&&i.emit("reachEnd toEdge"),(P&&!_||O&&!b)&&i.emit("fromEdge"),i.emit("progress",p)}const aA=(e,i,s)=>{i&&!e.classList.contains(s)?e.classList.add(s):!i&&e.classList.contains(s)&&e.classList.remove(s)};function che(){const e=this,{slides:i,params:s,slidesEl:l,activeIndex:p}=e,_=e.virtual&&s.virtual.enabled,b=e.grid&&s.grid&&s.grid.rows>1,t=$=>bm(l,`.${s.slideClass}${$}, swiper-slide${$}`)[0];let P,O,F;if(_)if(s.loop){let $=p-e.virtual.slidesBefore;$<0&&($=e.virtual.slides.length+$),$>=e.virtual.slides.length&&($-=e.virtual.slides.length),P=t(`[data-swiper-slide-index="${$}"]`)}else P=t(`[data-swiper-slide-index="${p}"]`);else b?(P=i.find($=>$.column===p),F=i.find($=>$.column===p+1),O=i.find($=>$.column===p-1)):P=i[p];P&&(b||(F=Yue(P,`.${s.slideClass}, swiper-slide`)[0],s.loop&&!F&&(F=i[0]),O=Xue(P,`.${s.slideClass}, swiper-slide`)[0],s.loop&&!O===0&&(O=i[i.length-1]))),i.forEach($=>{aA($,$===P,s.slideActiveClass),aA($,$===F,s.slideNextClass),aA($,$===O,s.slidePrevClass)}),e.emitSlidesClasses()}const qS=(e,i)=>{if(!e||e.destroyed||!e.params)return;const s=()=>e.isElement?"swiper-slide":`.${e.params.slideClass}`,l=i.closest(s());if(l){let p=l.querySelector(`.${e.params.lazyPreloaderClass}`);!p&&e.isElement&&(l.shadowRoot?p=l.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{l.shadowRoot&&(p=l.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`),p&&p.remove())})),p&&p.remove()}},lA=(e,i)=>{if(!e.slides[i])return;const s=e.slides[i].querySelector('[loading="lazy"]');s&&s.removeAttribute("loading")},VP=e=>{if(!e||e.destroyed||!e.params)return;let i=e.params.lazyPreloadPrevNext;const s=e.slides.length;if(!s||!i||i<0)return;i=Math.min(i,s);const l=e.params.slidesPerView==="auto"?e.slidesPerViewDynamic():Math.ceil(e.params.slidesPerView),p=e.activeIndex;if(e.params.grid&&e.params.grid.rows>1){const b=p,t=[b-i];t.push(...Array.from({length:i}).map((P,O)=>b+l+O)),e.slides.forEach((P,O)=>{t.includes(P.column)&&lA(e,O)});return}const _=p+l-1;if(e.params.rewind||e.params.loop)for(let b=p-i;b<=_+i;b+=1){const t=(b%s+s)%s;(t<p||t>_)&&lA(e,t)}else for(let b=Math.max(p-i,0);b<=Math.min(_+i,s-1);b+=1)b!==p&&(b>_||b<p)&&lA(e,b)};function uhe(e){const{slidesGrid:i,params:s}=e,l=e.rtlTranslate?e.translate:-e.translate;let p;for(let _=0;_<i.length;_+=1)typeof i[_+1]<"u"?l>=i[_]&&l<i[_+1]-(i[_+1]-i[_])/2?p=_:l>=i[_]&&l<i[_+1]&&(p=_+1):l>=i[_]&&(p=_);return s.normalizeSlideIndex&&(p<0||typeof p>"u")&&(p=0),p}function hhe(e){const i=this,s=i.rtlTranslate?i.translate:-i.translate,{snapGrid:l,params:p,activeIndex:_,realIndex:b,snapIndex:t}=i;let P=e,O;const F=Y=>{let ae=Y-i.virtual.slidesBefore;return ae<0&&(ae=i.virtual.slides.length+ae),ae>=i.virtual.slides.length&&(ae-=i.virtual.slides.length),ae};if(typeof P>"u"&&(P=uhe(i)),l.indexOf(s)>=0)O=l.indexOf(s);else{const Y=Math.min(p.slidesPerGroupSkip,P);O=Y+Math.floor((P-Y)/p.slidesPerGroup)}if(O>=l.length&&(O=l.length-1),P===_&&!i.params.loop){O!==t&&(i.snapIndex=O,i.emit("snapIndexChange"));return}if(P===_&&i.params.loop&&i.virtual&&i.params.virtual.enabled){i.realIndex=F(P);return}const $=i.grid&&p.grid&&p.grid.rows>1;let W;if(i.virtual&&p.virtual.enabled&&p.loop)W=F(P);else if($){const Y=i.slides.find(se=>se.column===P);let ae=parseInt(Y.getAttribute("data-swiper-slide-index"),10);Number.isNaN(ae)&&(ae=Math.max(i.slides.indexOf(Y),0)),W=Math.floor(ae/p.grid.rows)}else if(i.slides[P]){const Y=i.slides[P].getAttribute("data-swiper-slide-index");Y?W=parseInt(Y,10):W=P}else W=P;Object.assign(i,{previousSnapIndex:t,snapIndex:O,previousRealIndex:b,realIndex:W,previousIndex:_,activeIndex:P}),i.initialized&&VP(i),i.emit("activeIndexChange"),i.emit("snapIndexChange"),(i.initialized||i.params.runCallbacksOnInit)&&(b!==W&&i.emit("realIndexChange"),i.emit("slideChange"))}function dhe(e,i){const s=this,l=s.params;let p=e.closest(`.${l.slideClass}, swiper-slide`);!p&&s.isElement&&i&&i.length>1&&i.includes(e)&&[...i.slice(i.indexOf(e)+1,i.length)].forEach(t=>{!p&&t.matches&&t.matches(`.${l.slideClass}, swiper-slide`)&&(p=t)});let _=!1,b;if(p){for(let t=0;t<s.slides.length;t+=1)if(s.slides[t]===p){_=!0,b=t;break}}if(p&&_)s.clickedSlide=p,s.virtual&&s.params.virtual.enabled?s.clickedIndex=parseInt(p.getAttribute("data-swiper-slide-index"),10):s.clickedIndex=b;else{s.clickedSlide=void 0,s.clickedIndex=void 0;return}l.slideToClickedSlide&&s.clickedIndex!==void 0&&s.clickedIndex!==s.activeIndex&&s.slideToClickedSlide()}var fhe={updateSize:nhe,updateSlides:rhe,updateAutoHeight:she,updateSlidesOffset:ohe,updateSlidesProgress:ahe,updateProgress:lhe,updateSlidesClasses:che,updateActiveIndex:hhe,updateClickedSlide:dhe};function phe(e=this.isHorizontal()?"x":"y"){const i=this,{params:s,rtlTranslate:l,translate:p,wrapperEl:_}=i;if(s.virtualTranslate)return l?-p:p;if(s.cssMode)return p;let b=Gue(_,e);return b+=i.cssOverflowAdjustment(),l&&(b=-b),b||0}function mhe(e,i){const s=this,{rtlTranslate:l,params:p,wrapperEl:_,progress:b}=s;let t=0,P=0;const O=0;s.isHorizontal()?t=l?-e:e:P=e,p.roundLengths&&(t=Math.floor(t),P=Math.floor(P)),s.previousTranslate=s.translate,s.translate=s.isHorizontal()?t:P,p.cssMode?_[s.isHorizontal()?"scrollLeft":"scrollTop"]=s.isHorizontal()?-t:-P:p.virtualTranslate||(s.isHorizontal()?t-=s.cssOverflowAdjustment():P-=s.cssOverflowAdjustment(),_.style.transform=`translate3d(${t}px, ${P}px, ${O}px)`);let F;const $=s.maxTranslate()-s.minTranslate();$===0?F=0:F=(e-s.minTranslate())/$,F!==b&&s.updateProgress(e),s.emit("setTranslate",s.translate,i)}function ghe(){return-this.snapGrid[0]}function _he(){return-this.snapGrid[this.snapGrid.length-1]}function yhe(e=0,i=this.params.speed,s=!0,l=!0,p){const _=this,{params:b,wrapperEl:t}=_;if(_.animating&&b.preventInteractionOnTransition)return!1;const P=_.minTranslate(),O=_.maxTranslate();let F;if(l&&e>P?F=P:l&&e<O?F=O:F=e,_.updateProgress(F),b.cssMode){const $=_.isHorizontal();if(i===0)t[$?"scrollLeft":"scrollTop"]=-F;else{if(!_.support.smoothScroll)return pj({swiper:_,targetPosition:-F,side:$?"left":"top"}),!0;t.scrollTo({[$?"left":"top"]:-F,behavior:"smooth"})}return!0}return i===0?(_.setTransition(0),_.setTranslate(F),s&&(_.emit("beforeTransitionStart",i,p),_.emit("transitionEnd"))):(_.setTransition(i),_.setTranslate(F),s&&(_.emit("beforeTransitionStart",i,p),_.emit("transitionStart")),_.animating||(_.animating=!0,_.onTranslateToWrapperTransitionEnd||(_.onTranslateToWrapperTransitionEnd=function(W){!_||_.destroyed||W.target===this&&(_.wrapperEl.removeEventListener("transitionend",_.onTranslateToWrapperTransitionEnd),_.onTranslateToWrapperTransitionEnd=null,delete _.onTranslateToWrapperTransitionEnd,_.animating=!1,s&&_.emit("transitionEnd"))}),_.wrapperEl.addEventListener("transitionend",_.onTranslateToWrapperTransitionEnd))),!0}var vhe={getTranslate:phe,setTranslate:mhe,minTranslate:ghe,maxTranslate:_he,translateTo:yhe};function xhe(e,i){const s=this;s.params.cssMode||(s.wrapperEl.style.transitionDuration=`${e}ms`,s.wrapperEl.style.transitionDelay=e===0?"0ms":""),s.emit("setTransition",e,i)}function yj({swiper:e,runCallbacks:i,direction:s,step:l}){const{activeIndex:p,previousIndex:_}=e;let b=s;b||(p>_?b="next":p<_?b="prev":b="reset"),e.emit(`transition${l}`),i&&b==="reset"?e.emit(`slideResetTransition${l}`):i&&p!==_&&(e.emit(`slideChangeTransition${l}`),b==="next"?e.emit(`slideNextTransition${l}`):e.emit(`slidePrevTransition${l}`))}function bhe(e=!0,i){const s=this,{params:l}=s;l.cssMode||(l.autoHeight&&s.updateAutoHeight(),yj({swiper:s,runCallbacks:e,direction:i,step:"Start"}))}function whe(e=!0,i){const s=this,{params:l}=s;s.animating=!1,!l.cssMode&&(s.setTransition(0),yj({swiper:s,runCallbacks:e,direction:i,step:"End"}))}var The={setTransition:xhe,transitionStart:bhe,transitionEnd:whe};function She(e=0,i,s=!0,l,p){typeof e=="string"&&(e=parseInt(e,10));const _=this;let b=e;b<0&&(b=0);const{params:t,snapGrid:P,slidesGrid:O,previousIndex:F,activeIndex:$,rtlTranslate:W,wrapperEl:Y,enabled:ae}=_;if(!ae&&!l&&!p||_.destroyed||_.animating&&t.preventInteractionOnTransition)return!1;typeof i>"u"&&(i=_.params.speed);const se=Math.min(_.params.slidesPerGroupSkip,b);let ie=se+Math.floor((b-se)/_.params.slidesPerGroup);ie>=P.length&&(ie=P.length-1);const pe=-P[ie];if(t.normalizeSlideIndex)for(let We=0;We<O.length;We+=1){const je=-Math.floor(pe*100),Ye=Math.floor(O[We]*100),ct=Math.floor(O[We+1]*100);typeof O[We+1]<"u"?je>=Ye&&je<ct-(ct-Ye)/2?b=We:je>=Ye&&je<ct&&(b=We+1):je>=Ye&&(b=We)}if(_.initialized&&b!==$&&(!_.allowSlideNext&&(W?pe>_.translate&&pe>_.minTranslate():pe<_.translate&&pe<_.minTranslate())||!_.allowSlidePrev&&pe>_.translate&&pe>_.maxTranslate()&&($||0)!==b))return!1;b!==(F||0)&&s&&_.emit("beforeSlideChangeStart"),_.updateProgress(pe);let ye;b>$?ye="next":b<$?ye="prev":ye="reset";const de=_.virtual&&_.params.virtual.enabled;if(!(de&&p)&&(W&&-pe===_.translate||!W&&pe===_.translate))return _.updateActiveIndex(b),t.autoHeight&&_.updateAutoHeight(),_.updateSlidesClasses(),t.effect!=="slide"&&_.setTranslate(pe),ye!=="reset"&&(_.transitionStart(s,ye),_.transitionEnd(s,ye)),!1;if(t.cssMode){const We=_.isHorizontal(),je=W?pe:-pe;if(i===0)de&&(_.wrapperEl.style.scrollSnapType="none",_._immediateVirtual=!0),de&&!_._cssModeVirtualInitialSet&&_.params.initialSlide>0?(_._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{Y[We?"scrollLeft":"scrollTop"]=je})):Y[We?"scrollLeft":"scrollTop"]=je,de&&requestAnimationFrame(()=>{_.wrapperEl.style.scrollSnapType="",_._immediateVirtual=!1});else{if(!_.support.smoothScroll)return pj({swiper:_,targetPosition:je,side:We?"left":"top"}),!0;Y.scrollTo({[We?"left":"top"]:je,behavior:"smooth"})}return!0}const Ze=_j().isSafari;return de&&!p&&Ze&&_.isElement&&_.virtual.update(!1,!1,b),_.setTransition(i),_.setTranslate(pe),_.updateActiveIndex(b),_.updateSlidesClasses(),_.emit("beforeTransitionStart",i,l),_.transitionStart(s,ye),i===0?_.transitionEnd(s,ye):_.animating||(_.animating=!0,_.onSlideToWrapperTransitionEnd||(_.onSlideToWrapperTransitionEnd=function(je){!_||_.destroyed||je.target===this&&(_.wrapperEl.removeEventListener("transitionend",_.onSlideToWrapperTransitionEnd),_.onSlideToWrapperTransitionEnd=null,delete _.onSlideToWrapperTransitionEnd,_.transitionEnd(s,ye))}),_.wrapperEl.addEventListener("transitionend",_.onSlideToWrapperTransitionEnd)),!0}function Ehe(e=0,i,s=!0,l){typeof e=="string"&&(e=parseInt(e,10));const p=this;if(p.destroyed)return;typeof i>"u"&&(i=p.params.speed);const _=p.grid&&p.params.grid&&p.params.grid.rows>1;let b=e;if(p.params.loop)if(p.virtual&&p.params.virtual.enabled)b=b+p.virtual.slidesBefore;else{let t;if(_){const se=b*p.params.grid.rows;t=p.slides.find(ie=>ie.getAttribute("data-swiper-slide-index")*1===se).column}else t=p.getSlideIndexByData(b);const P=_?Math.ceil(p.slides.length/p.params.grid.rows):p.slides.length,{centeredSlides:O,slidesOffsetBefore:F,slidesOffsetAfter:$}=p.params,W=O||!!F||!!$;let Y=p.params.slidesPerView;Y==="auto"?Y=p.slidesPerViewDynamic():(Y=Math.ceil(parseFloat(p.params.slidesPerView,10)),W&&Y%2===0&&(Y=Y+1));let ae=P-t<Y;if(W&&(ae=ae||t<Math.ceil(Y/2)),l&&W&&p.params.slidesPerView!=="auto"&&!_&&(ae=!1),ae){const se=W?t<p.activeIndex?"prev":"next":t-p.activeIndex-1<p.params.slidesPerView?"next":"prev";p.loopFix({direction:se,slideTo:!0,activeSlideIndex:se==="next"?t+1:t-P+1,slideRealIndex:se==="next"?p.realIndex:void 0})}if(_){const se=b*p.params.grid.rows;b=p.slides.find(ie=>ie.getAttribute("data-swiper-slide-index")*1===se).column}else b=p.getSlideIndexByData(b)}return requestAnimationFrame(()=>{p.slideTo(b,i,s,l)}),p}function Ihe(e,i=!0,s){const l=this,{enabled:p,params:_,animating:b}=l;if(!p||l.destroyed)return l;typeof e>"u"&&(e=l.params.speed);let t=_.slidesPerGroup;_.slidesPerView==="auto"&&_.slidesPerGroup===1&&_.slidesPerGroupAuto&&(t=Math.max(l.slidesPerViewDynamic("current",!0),1));const P=l.activeIndex<_.slidesPerGroupSkip?1:t,O=l.virtual&&_.virtual.enabled;if(_.loop){if(b&&!O&&_.loopPreventsSliding)return!1;if(l.loopFix({direction:"next"}),l._clientLeft=l.wrapperEl.clientLeft,l.activeIndex===l.slides.length-1&&_.cssMode)return requestAnimationFrame(()=>{l.slideTo(l.activeIndex+P,e,i,s)}),!0}return _.rewind&&l.isEnd?l.slideTo(0,e,i,s):l.slideTo(l.activeIndex+P,e,i,s)}function Che(e,i=!0,s){const l=this,{params:p,snapGrid:_,slidesGrid:b,rtlTranslate:t,enabled:P,animating:O}=l;if(!P||l.destroyed)return l;typeof e>"u"&&(e=l.params.speed);const F=l.virtual&&p.virtual.enabled;if(p.loop){if(O&&!F&&p.loopPreventsSliding)return!1;l.loopFix({direction:"prev"}),l._clientLeft=l.wrapperEl.clientLeft}const $=t?l.translate:-l.translate;function W(ye){return ye<0?-Math.floor(Math.abs(ye)):Math.floor(ye)}const Y=W($),ae=_.map(ye=>W(ye)),se=p.freeMode&&p.freeMode.enabled;let ie=_[ae.indexOf(Y)-1];if(typeof ie>"u"&&(p.cssMode||se)){let ye;_.forEach((de,Ee)=>{Y>=de&&(ye=Ee)}),typeof ye<"u"&&(ie=se?_[ye]:_[ye>0?ye-1:ye])}let pe=0;if(typeof ie<"u"&&(pe=b.indexOf(ie),pe<0&&(pe=l.activeIndex-1),p.slidesPerView==="auto"&&p.slidesPerGroup===1&&p.slidesPerGroupAuto&&(pe=pe-l.slidesPerViewDynamic("previous",!0)+1,pe=Math.max(pe,0))),p.rewind&&l.isBeginning){const ye=l.params.virtual&&l.params.virtual.enabled&&l.virtual?l.virtual.slides.length-1:l.slides.length-1;return l.slideTo(ye,e,i,s)}else if(p.loop&&l.activeIndex===0&&p.cssMode)return requestAnimationFrame(()=>{l.slideTo(pe,e,i,s)}),!0;return l.slideTo(pe,e,i,s)}function Ahe(e,i=!0,s){const l=this;if(!l.destroyed)return typeof e>"u"&&(e=l.params.speed),l.slideTo(l.activeIndex,e,i,s)}function Phe(e,i=!0,s,l=.5){const p=this;if(p.destroyed)return;typeof e>"u"&&(e=p.params.speed);let _=p.activeIndex;const b=Math.min(p.params.slidesPerGroupSkip,_),t=b+Math.floor((_-b)/p.params.slidesPerGroup),P=p.rtlTranslate?p.translate:-p.translate;if(P>=p.snapGrid[t]){const O=p.snapGrid[t],F=p.snapGrid[t+1];P-O>(F-O)*l&&(_+=p.params.slidesPerGroup)}else{const O=p.snapGrid[t-1],F=p.snapGrid[t];P-O<=(F-O)*l&&(_-=p.params.slidesPerGroup)}return _=Math.max(_,0),_=Math.min(_,p.slidesGrid.length-1),p.slideTo(_,e,i,s)}function Mhe(){const e=this;if(e.destroyed)return;const{params:i,slidesEl:s}=e,l=i.slidesPerView==="auto"?e.slidesPerViewDynamic():i.slidesPerView;let p=e.getSlideIndexWhenGrid(e.clickedIndex),_;const b=e.isElement?"swiper-slide":`.${i.slideClass}`,t=e.grid&&e.params.grid&&e.params.grid.rows>1;if(i.loop){if(e.animating)return;_=parseInt(e.clickedSlide.getAttribute("data-swiper-slide-index"),10),i.centeredSlides?e.slideToLoop(_):p>(t?(e.slides.length-l)/2-(e.params.grid.rows-1):e.slides.length-l)?(e.loopFix(),p=e.getSlideIndex(bm(s,`${b}[data-swiper-slide-index="${_}"]`)[0]),fj(()=>{e.slideTo(p)})):e.slideTo(p)}else e.slideTo(p)}var khe={slideTo:She,slideToLoop:Ehe,slideNext:Ihe,slidePrev:Che,slideReset:Ahe,slideToClosest:Phe,slideToClickedSlide:Mhe};function Dhe(e,i){const s=this,{params:l,slidesEl:p}=s;if(!l.loop||s.virtual&&s.params.virtual.enabled)return;const _=()=>{bm(p,`.${l.slideClass}, swiper-slide`).forEach((ae,se)=>{ae.setAttribute("data-swiper-slide-index",se)})},b=()=>{const Y=bm(p,`.${l.slideBlankClass}`);Y.forEach(ae=>{ae.remove()}),Y.length>0&&(s.recalcSlides(),s.updateSlides())},t=s.grid&&l.grid&&l.grid.rows>1;l.loopAddBlankSlides&&(l.slidesPerGroup>1||t)&&b();const P=l.slidesPerGroup*(t?l.grid.rows:1),O=s.slides.length%P!==0,F=t&&s.slides.length%l.grid.rows!==0,$=Y=>{for(let ae=0;ae<Y;ae+=1){const se=s.isElement?lb("swiper-slide",[l.slideBlankClass]):lb("div",[l.slideClass,l.slideBlankClass]);s.slidesEl.append(se)}};if(O){if(l.loopAddBlankSlides){const Y=P-s.slides.length%P;$(Y),s.recalcSlides(),s.updateSlides()}else kE("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");_()}else if(F){if(l.loopAddBlankSlides){const Y=l.grid.rows-s.slides.length%l.grid.rows;$(Y),s.recalcSlides(),s.updateSlides()}else kE("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");_()}else _();const W=l.centeredSlides||!!l.slidesOffsetBefore||!!l.slidesOffsetAfter;s.loopFix({slideRealIndex:e,direction:W?void 0:"next",initial:i})}function Lhe({slideRealIndex:e,slideTo:i=!0,direction:s,setTranslate:l,activeSlideIndex:p,initial:_,byController:b,byMousewheel:t}={}){const P=this;if(!P.params.loop)return;P.emit("beforeLoopFix");const{slides:O,allowSlidePrev:F,allowSlideNext:$,slidesEl:W,params:Y}=P,{centeredSlides:ae,slidesOffsetBefore:se,slidesOffsetAfter:ie,initialSlide:pe}=Y,ye=ae||!!se||!!ie;if(P.allowSlidePrev=!0,P.allowSlideNext=!0,P.virtual&&Y.virtual.enabled){i&&(!ye&&P.snapIndex===0?P.slideTo(P.virtual.slides.length,0,!1,!0):ye&&P.snapIndex<Y.slidesPerView?P.slideTo(P.virtual.slides.length+P.snapIndex,0,!1,!0):P.snapIndex===P.snapGrid.length-1&&P.slideTo(P.virtual.slidesBefore,0,!1,!0)),P.allowSlidePrev=F,P.allowSlideNext=$,P.emit("loopFix");return}let de=Y.slidesPerView;de==="auto"?de=P.slidesPerViewDynamic():(de=Math.ceil(parseFloat(Y.slidesPerView,10)),ye&&de%2===0&&(de=de+1));const Ee=Y.slidesPerGroupAuto?de:Y.slidesPerGroup;let Pe=ye?Math.max(Ee,Math.ceil(de/2)):Ee;Pe%Ee!==0&&(Pe+=Ee-Pe%Ee),Pe+=Y.loopAdditionalSlides,P.loopedSlides=Pe;const Ze=P.grid&&Y.grid&&Y.grid.rows>1;O.length<de+Pe||P.params.effect==="cards"&&O.length<de+Pe*2?kE("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled or not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):Ze&&Y.grid.fill==="row"&&kE("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const We=[],je=[],Ye=Ze?Math.ceil(O.length/Y.grid.rows):O.length,ct=_&&Ye-pe<de&&!ye;let Lt=ct?pe:P.activeIndex;typeof p>"u"?p=P.getSlideIndex(O.find(vt=>vt.classList.contains(Y.slideActiveClass))):Lt=p;const Ht=s==="next"||!s,ci=s==="prev"||!s;let Wt=0,$t=0;const Ft=(Ze?O[p].column:p)+(ye&&typeof l>"u"?-de/2+.5:0);if(Ft<Pe){Wt=Math.max(Pe-Ft,Ee);for(let vt=0;vt<Pe-Ft;vt+=1){const wi=vt-Math.floor(vt/Ye)*Ye;if(Ze){const Qi=Ye-wi-1;for(let wn=O.length-1;wn>=0;wn-=1)O[wn].column===Qi&&We.push(wn)}else We.push(Ye-wi-1)}}else if(Ft+de>Ye-Pe){$t=Math.max(Ft-(Ye-Pe*2),Ee),ct&&($t=Math.max($t,de-Ye+pe+1));for(let vt=0;vt<$t;vt+=1){const wi=vt-Math.floor(vt/Ye)*Ye;Ze?O.forEach((Qi,wn)=>{Qi.column===wi&&je.push(wn)}):je.push(wi)}}if(P.__preventObserver__=!0,requestAnimationFrame(()=>{P.__preventObserver__=!1}),P.params.effect==="cards"&&O.length<de+Pe*2&&(je.includes(p)&&je.splice(je.indexOf(p),1),We.includes(p)&&We.splice(We.indexOf(p),1)),ci&&We.forEach(vt=>{O[vt].swiperLoopMoveDOM=!0,W.prepend(O[vt]),O[vt].swiperLoopMoveDOM=!1}),Ht&&je.forEach(vt=>{O[vt].swiperLoopMoveDOM=!0,W.append(O[vt]),O[vt].swiperLoopMoveDOM=!1}),P.recalcSlides(),Y.slidesPerView==="auto"?P.updateSlides():Ze&&(We.length>0&&ci||je.length>0&&Ht)&&P.slides.forEach((vt,wi)=>{P.grid.updateSlide(wi,vt,P.slides)}),Y.watchSlidesProgress&&P.updateSlidesOffset(),i){if(We.length>0&&ci){if(typeof e>"u"){const vt=P.slidesGrid[Lt],Qi=P.slidesGrid[Lt+Wt]-vt;t?P.setTranslate(P.translate-Qi):(P.slideTo(Lt+Math.ceil(Wt),0,!1,!0),l&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-Qi,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-Qi))}else if(l){const vt=Ze?We.length/Y.grid.rows:We.length;P.slideTo(P.activeIndex+vt,0,!1,!0),P.touchEventsData.currentTranslate=P.translate}}else if(je.length>0&&Ht)if(typeof e>"u"){const vt=P.slidesGrid[Lt],Qi=P.slidesGrid[Lt-$t]-vt;t?P.setTranslate(P.translate-Qi):(P.slideTo(Lt-$t,0,!1,!0),l&&(P.touchEventsData.startTranslate=P.touchEventsData.startTranslate-Qi,P.touchEventsData.currentTranslate=P.touchEventsData.currentTranslate-Qi))}else{const vt=Ze?je.length/Y.grid.rows:je.length;P.slideTo(P.activeIndex-vt,0,!1,!0)}}if(P.allowSlidePrev=F,P.allowSlideNext=$,P.controller&&P.controller.control&&!b){const vt={slideRealIndex:e,direction:s,setTranslate:l,activeSlideIndex:p,byController:!0};Array.isArray(P.controller.control)?P.controller.control.forEach(wi=>{!wi.destroyed&&wi.params.loop&&wi.loopFix({...vt,slideTo:wi.params.slidesPerView===Y.slidesPerView?i:!1})}):P.controller.control instanceof P.constructor&&P.controller.control.params.loop&&P.controller.control.loopFix({...vt,slideTo:P.controller.control.params.slidesPerView===Y.slidesPerView?i:!1})}P.emit("loopFix")}function Rhe(){const e=this,{params:i,slidesEl:s}=e;if(!i.loop||!s||e.virtual&&e.params.virtual.enabled)return;e.recalcSlides();const l=[];e.slides.forEach(p=>{const _=typeof p.swiperSlideIndex>"u"?p.getAttribute("data-swiper-slide-index")*1:p.swiperSlideIndex;l[_]=p}),e.slides.forEach(p=>{p.removeAttribute("data-swiper-slide-index")}),l.forEach(p=>{s.append(p)}),e.recalcSlides(),e.slideTo(e.realIndex,0)}var zhe={loopCreate:Dhe,loopFix:Lhe,loopDestroy:Rhe};function Ohe(e){const i=this;if(!i.params.simulateTouch||i.params.watchOverflow&&i.isLocked||i.params.cssMode)return;const s=i.params.touchEventsTarget==="container"?i.el:i.wrapperEl;i.isElement&&(i.__preventObserver__=!0),s.style.cursor="move",s.style.cursor=e?"grabbing":"grab",i.isElement&&requestAnimationFrame(()=>{i.__preventObserver__=!1})}function Fhe(){const e=this;e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e.isElement&&(e.__preventObserver__=!0),e[e.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1}))}var Bhe={setGrabCursor:Ohe,unsetGrabCursor:Fhe};function Nhe(e,i=this){function s(l){if(!l||l===Og()||l===Zu())return null;l.assignedSlot&&(l=l.assignedSlot);const p=l.closest(e);return!p&&!l.getRootNode?null:p||s(l.getRootNode().host)}return s(i)}function pF(e,i,s){const l=Zu(),{params:p}=e,_=p.edgeSwipeDetection,b=p.edgeSwipeThreshold;return _&&(s<=b||s>=l.innerWidth-b)?_==="prevent"?(i.preventDefault(),!0):!1:!0}function Vhe(e){const i=this,s=Og();let l=e;l.originalEvent&&(l=l.originalEvent);const p=i.touchEventsData;if(l.type==="pointerdown"){if(p.pointerId!==null&&p.pointerId!==l.pointerId)return;p.pointerId=l.pointerId}else l.type==="touchstart"&&l.targetTouches.length===1&&(p.touchId=l.targetTouches[0].identifier);if(l.type==="touchstart"){pF(i,l,l.targetTouches[0].pageX);return}const{params:_,touches:b,enabled:t}=i;if(!t||!_.simulateTouch&&l.pointerType==="mouse"||i.animating&&_.preventInteractionOnTransition)return;!i.animating&&_.cssMode&&_.loop&&i.loopFix();let P=l.target;if(_.touchEventsTarget==="wrapper"&&!Wue(P,i.wrapperEl)||"which"in l&&l.which===3||"button"in l&&l.button>0||p.isTouched&&p.isMoved)return;const O=!!_.noSwipingClass&&_.noSwipingClass!=="",F=l.composedPath?l.composedPath():l.path;O&&l.target&&l.target.shadowRoot&&F&&(P=F[0]);const $=_.noSwipingSelector?_.noSwipingSelector:`.${_.noSwipingClass}`,W=!!(l.target&&l.target.shadowRoot);if(_.noSwiping&&(W?Nhe($,P):P.closest($))){i.allowClick=!0;return}if(_.swipeHandler&&!P.closest(_.swipeHandler))return;b.currentX=l.pageX,b.currentY=l.pageY;const Y=b.currentX,ae=b.currentY;if(!pF(i,l,Y))return;Object.assign(p,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),b.startX=Y,b.startY=ae,p.touchStartTime=ME(),i.allowClick=!0,i.updateSize(),i.swipeDirection=void 0,_.threshold>0&&(p.allowThresholdMove=!1);let se=!0;P.matches(p.focusableElements)&&(se=!1,P.nodeName==="SELECT"&&(p.isTouched=!1)),s.activeElement&&s.activeElement.matches(p.focusableElements)&&s.activeElement!==P&&(l.pointerType==="mouse"||l.pointerType!=="mouse"&&!P.matches(p.focusableElements))&&s.activeElement.blur();const ie=se&&i.allowTouchMove&&_.touchStartPreventDefault;(_.touchStartForcePreventDefault||ie)&&!P.isContentEditable&&l.preventDefault(),_.freeMode&&_.freeMode.enabled&&i.freeMode&&i.animating&&!_.cssMode&&i.freeMode.onTouchStart(),i.emit("touchStart",l)}function jhe(e){const i=Og(),s=this,l=s.touchEventsData,{params:p,touches:_,rtlTranslate:b,enabled:t}=s;if(!t||!p.simulateTouch&&e.pointerType==="mouse")return;let P=e;if(P.originalEvent&&(P=P.originalEvent),P.type==="pointermove"&&(l.touchId!==null||P.pointerId!==l.pointerId))return;let O;if(P.type==="touchmove"){if(O=[...P.changedTouches].find(Pe=>Pe.identifier===l.touchId),!O||O.identifier!==l.touchId)return}else O=P;if(!l.isTouched){l.startMoving&&l.isScrolling&&s.emit("touchMoveOpposite",P);return}const F=O.pageX,$=O.pageY;if(P.preventedByNestedSwiper){_.startX=F,_.startY=$;return}if(!s.allowTouchMove){P.target.matches(l.focusableElements)||(s.allowClick=!1),l.isTouched&&(Object.assign(_,{startX:F,startY:$,currentX:F,currentY:$}),l.touchStartTime=ME());return}if(p.touchReleaseOnEdges&&!p.loop)if(s.isVertical()){if($<_.startY&&s.translate<=s.maxTranslate()||$>_.startY&&s.translate>=s.minTranslate()){l.isTouched=!1,l.isMoved=!1;return}}else{if(b&&(F>_.startX&&-s.translate<=s.maxTranslate()||F<_.startX&&-s.translate>=s.minTranslate()))return;if(!b&&(F<_.startX&&s.translate<=s.maxTranslate()||F>_.startX&&s.translate>=s.minTranslate()))return}if(i.activeElement&&i.activeElement.matches(l.focusableElements)&&i.activeElement!==P.target&&P.pointerType!=="mouse"&&i.activeElement.blur(),i.activeElement&&P.target===i.activeElement&&P.target.matches(l.focusableElements)){l.isMoved=!0,s.allowClick=!1;return}l.allowTouchCallbacks&&s.emit("touchMove",P),_.previousX=_.currentX,_.previousY=_.currentY,_.currentX=F,_.currentY=$;const W=_.currentX-_.startX,Y=_.currentY-_.startY;if(s.params.threshold&&Math.sqrt(W**2+Y**2)<s.params.threshold)return;if(typeof l.isScrolling>"u"){let Pe;s.isHorizontal()&&_.currentY===_.startY||s.isVertical()&&_.currentX===_.startX?l.isScrolling=!1:W*W+Y*Y>=25&&(Pe=Math.atan2(Math.abs(Y),Math.abs(W))*180/Math.PI,l.isScrolling=s.isHorizontal()?Pe>p.touchAngle:90-Pe>p.touchAngle)}if(l.isScrolling&&s.emit("touchMoveOpposite",P),typeof l.startMoving>"u"&&(_.currentX!==_.startX||_.currentY!==_.startY)&&(l.startMoving=!0),l.isScrolling||P.type==="touchmove"&&l.preventTouchMoveFromPointerMove){l.isTouched=!1;return}if(!l.startMoving)return;s.allowClick=!1,!p.cssMode&&P.cancelable&&P.preventDefault(),p.touchMoveStopPropagation&&!p.nested&&P.stopPropagation();let ae=s.isHorizontal()?W:Y,se=s.isHorizontal()?_.currentX-_.previousX:_.currentY-_.previousY;p.oneWayMovement&&(ae=Math.abs(ae)*(b?1:-1),se=Math.abs(se)*(b?1:-1)),_.diff=ae,ae*=p.touchRatio,b&&(ae=-ae,se=-se);const ie=s.touchesDirection;s.swipeDirection=ae>0?"prev":"next",s.touchesDirection=se>0?"prev":"next";const pe=s.params.loop&&!p.cssMode,ye=s.touchesDirection==="next"&&s.allowSlideNext||s.touchesDirection==="prev"&&s.allowSlidePrev;if(!l.isMoved){if(pe&&ye&&s.loopFix({direction:s.swipeDirection}),l.startTranslate=s.getTranslate(),s.setTransition(0),s.animating){const Pe=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});s.wrapperEl.dispatchEvent(Pe)}l.allowMomentumBounce=!1,p.grabCursor&&(s.allowSlideNext===!0||s.allowSlidePrev===!0)&&s.setGrabCursor(!0),s.emit("sliderFirstMove",P)}if(new Date().getTime(),p._loopSwapReset!==!1&&l.isMoved&&l.allowThresholdMove&&ie!==s.touchesDirection&&pe&&ye&&Math.abs(ae)>=1){Object.assign(_,{startX:F,startY:$,currentX:F,currentY:$,startTranslate:l.currentTranslate}),l.loopSwapReset=!0,l.startTranslate=l.currentTranslate;return}s.emit("sliderMove",P),l.isMoved=!0,l.currentTranslate=ae+l.startTranslate;let de=!0,Ee=p.resistanceRatio;if(p.touchReleaseOnEdges&&(Ee=0),ae>0?(pe&&ye&&l.allowThresholdMove&&l.currentTranslate>(p.centeredSlides?s.minTranslate()-s.slidesSizesGrid[s.activeIndex+1]-(p.slidesPerView!=="auto"&&s.slides.length-p.slidesPerView>=2?s.slidesSizesGrid[s.activeIndex+1]+s.params.spaceBetween:0)-s.params.spaceBetween:s.minTranslate())&&s.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),l.currentTranslate>s.minTranslate()&&(de=!1,p.resistance&&(l.currentTranslate=s.minTranslate()-1+(-s.minTranslate()+l.startTranslate+ae)**Ee))):ae<0&&(pe&&ye&&l.allowThresholdMove&&l.currentTranslate<(p.centeredSlides?s.maxTranslate()+s.slidesSizesGrid[s.slidesSizesGrid.length-1]+s.params.spaceBetween+(p.slidesPerView!=="auto"&&s.slides.length-p.slidesPerView>=2?s.slidesSizesGrid[s.slidesSizesGrid.length-1]+s.params.spaceBetween:0):s.maxTranslate())&&s.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:s.slides.length-(p.slidesPerView==="auto"?s.slidesPerViewDynamic():Math.ceil(parseFloat(p.slidesPerView,10)))}),l.currentTranslate<s.maxTranslate()&&(de=!1,p.resistance&&(l.currentTranslate=s.maxTranslate()+1-(s.maxTranslate()-l.startTranslate-ae)**Ee))),de&&(P.preventedByNestedSwiper=!0),!s.allowSlideNext&&s.swipeDirection==="next"&&l.currentTranslate<l.startTranslate&&(l.currentTranslate=l.startTranslate),!s.allowSlidePrev&&s.swipeDirection==="prev"&&l.currentTranslate>l.startTranslate&&(l.currentTranslate=l.startTranslate),!s.allowSlidePrev&&!s.allowSlideNext&&(l.currentTranslate=l.startTranslate),p.threshold>0)if(Math.abs(ae)>p.threshold||l.allowThresholdMove){if(!l.allowThresholdMove){l.allowThresholdMove=!0,_.startX=_.currentX,_.startY=_.currentY,l.currentTranslate=l.startTranslate,_.diff=s.isHorizontal()?_.currentX-_.startX:_.currentY-_.startY;return}}else{l.currentTranslate=l.startTranslate;return}!p.followFinger||p.cssMode||((p.freeMode&&p.freeMode.enabled&&s.freeMode||p.watchSlidesProgress)&&(s.updateActiveIndex(),s.updateSlidesClasses()),p.freeMode&&p.freeMode.enabled&&s.freeMode&&s.freeMode.onTouchMove(),s.updateProgress(l.currentTranslate),s.setTranslate(l.currentTranslate))}function Uhe(e){const i=this,s=i.touchEventsData;let l=e;l.originalEvent&&(l=l.originalEvent);let p;if(l.type==="touchend"||l.type==="touchcancel"){if(p=[...l.changedTouches].find(Pe=>Pe.identifier===s.touchId),!p||p.identifier!==s.touchId)return}else{if(s.touchId!==null||l.pointerId!==s.pointerId)return;p=l}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(l.type)&&!(["pointercancel","contextmenu"].includes(l.type)&&(i.browser.isSafari||i.browser.isWebView)))return;s.pointerId=null,s.touchId=null;const{params:b,touches:t,rtlTranslate:P,slidesGrid:O,enabled:F}=i;if(!F||!b.simulateTouch&&l.pointerType==="mouse")return;if(s.allowTouchCallbacks&&i.emit("touchEnd",l),s.allowTouchCallbacks=!1,!s.isTouched){s.isMoved&&b.grabCursor&&i.setGrabCursor(!1),s.isMoved=!1,s.startMoving=!1;return}b.grabCursor&&s.isMoved&&s.isTouched&&(i.allowSlideNext===!0||i.allowSlidePrev===!0)&&i.setGrabCursor(!1);const $=ME(),W=$-s.touchStartTime;if(i.allowClick){const Pe=l.path||l.composedPath&&l.composedPath();i.updateClickedSlide(Pe&&Pe[0]||l.target,Pe),i.emit("tap click",l),W<300&&$-s.lastClickTime<300&&i.emit("doubleTap doubleClick",l)}if(s.lastClickTime=ME(),fj(()=>{i.destroyed||(i.allowClick=!0)}),!s.isTouched||!s.isMoved||!i.swipeDirection||t.diff===0&&!s.loopSwapReset||s.currentTranslate===s.startTranslate&&!s.loopSwapReset){s.isTouched=!1,s.isMoved=!1,s.startMoving=!1;return}s.isTouched=!1,s.isMoved=!1,s.startMoving=!1;let Y;if(b.followFinger?Y=P?i.translate:-i.translate:Y=-s.currentTranslate,b.cssMode)return;if(b.freeMode&&b.freeMode.enabled){i.freeMode.onTouchEnd({currentPos:Y});return}const ae=Y>=-i.maxTranslate()&&!i.params.loop;let se=0,ie=i.slidesSizesGrid[0];for(let Pe=0;Pe<O.length;Pe+=Pe<b.slidesPerGroupSkip?1:b.slidesPerGroup){const Ze=Pe<b.slidesPerGroupSkip-1?1:b.slidesPerGroup;typeof O[Pe+Ze]<"u"?(ae||Y>=O[Pe]&&Y<O[Pe+Ze])&&(se=Pe,ie=O[Pe+Ze]-O[Pe]):(ae||Y>=O[Pe])&&(se=Pe,ie=O[O.length-1]-O[O.length-2])}let pe=null,ye=null;b.rewind&&(i.isBeginning?ye=b.virtual&&b.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1:i.isEnd&&(pe=0));const de=(Y-O[se])/ie,Ee=se<b.slidesPerGroupSkip-1?1:b.slidesPerGroup;if(W>b.longSwipesMs){if(!b.longSwipes){i.slideTo(i.activeIndex);return}i.swipeDirection==="next"&&(de>=b.longSwipesRatio?i.slideTo(b.rewind&&i.isEnd?pe:se+Ee):i.slideTo(se)),i.swipeDirection==="prev"&&(de>1-b.longSwipesRatio?i.slideTo(se+Ee):ye!==null&&de<0&&Math.abs(de)>b.longSwipesRatio?i.slideTo(ye):i.slideTo(se))}else{if(!b.shortSwipes){i.slideTo(i.activeIndex);return}i.navigation&&(l.target===i.navigation.nextEl||l.target===i.navigation.prevEl)?l.target===i.navigation.nextEl?i.slideTo(se+Ee):i.slideTo(se):(i.swipeDirection==="next"&&i.slideTo(pe!==null?pe:se+Ee),i.swipeDirection==="prev"&&i.slideTo(ye!==null?ye:se))}}function mF(){const e=this,{params:i,el:s}=e;if(s&&s.offsetWidth===0)return;i.breakpoints&&e.setBreakpoint();const{allowSlideNext:l,allowSlidePrev:p,snapGrid:_}=e,b=e.virtual&&e.params.virtual.enabled;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses();const t=b&&i.loop;(i.slidesPerView==="auto"||i.slidesPerView>1)&&e.isEnd&&!e.isBeginning&&!e.params.centeredSlides&&!t?e.slideTo(e.slides.length-1,0,!1,!0):e.params.loop&&!b?e.slideToLoop(e.realIndex,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&(clearTimeout(e.autoplay.resizeTimeout),e.autoplay.resizeTimeout=setTimeout(()=>{e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.resume()},500)),e.allowSlidePrev=p,e.allowSlideNext=l,e.params.watchOverflow&&_!==e.snapGrid&&e.checkOverflow()}function $he(e){const i=this;i.enabled&&(i.allowClick||(i.params.preventClicks&&e.preventDefault(),i.params.preventClicksPropagation&&i.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function Ghe(){const e=this,{wrapperEl:i,rtlTranslate:s,enabled:l}=e;if(!l)return;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=-i.scrollLeft:e.translate=-i.scrollTop,e.translate===0&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();let p;const _=e.maxTranslate()-e.minTranslate();_===0?p=0:p=(e.translate-e.minTranslate())/_,p!==e.progress&&e.updateProgress(s?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}function qhe(e){const i=this;qS(i,e.target),!(i.params.cssMode||i.params.slidesPerView!=="auto"&&!i.params.autoHeight)&&i.update()}function Hhe(){const e=this;e.documentTouchHandlerProceeded||(e.documentTouchHandlerProceeded=!0,e.params.touchReleaseOnEdges&&(e.el.style.touchAction="auto"))}const vj=(e,i)=>{const s=Og(),{params:l,el:p,wrapperEl:_,device:b}=e,t=!!l.nested,P=i==="on"?"addEventListener":"removeEventListener",O=i;!p||typeof p=="string"||(s[P]("touchstart",e.onDocumentTouchStart,{passive:!1,capture:t}),p[P]("touchstart",e.onTouchStart,{passive:!1}),p[P]("pointerdown",e.onTouchStart,{passive:!1}),s[P]("touchmove",e.onTouchMove,{passive:!1,capture:t}),s[P]("pointermove",e.onTouchMove,{passive:!1,capture:t}),s[P]("touchend",e.onTouchEnd,{passive:!0}),s[P]("pointerup",e.onTouchEnd,{passive:!0}),s[P]("pointercancel",e.onTouchEnd,{passive:!0}),s[P]("touchcancel",e.onTouchEnd,{passive:!0}),s[P]("pointerout",e.onTouchEnd,{passive:!0}),s[P]("pointerleave",e.onTouchEnd,{passive:!0}),s[P]("contextmenu",e.onTouchEnd,{passive:!0}),(l.preventClicks||l.preventClicksPropagation)&&p[P]("click",e.onClick,!0),l.cssMode&&_[P]("scroll",e.onScroll),l.updateOnWindowResize?e[O](b.ios||b.android?"resize orientationchange observerUpdate":"resize observerUpdate",mF,!0):e[O]("observerUpdate",mF,!0),p[P]("load",e.onLoad,{capture:!0}))};function Whe(){const e=this,{params:i}=e;e.onTouchStart=Vhe.bind(e),e.onTouchMove=jhe.bind(e),e.onTouchEnd=Uhe.bind(e),e.onDocumentTouchStart=Hhe.bind(e),i.cssMode&&(e.onScroll=Ghe.bind(e)),e.onClick=$he.bind(e),e.onLoad=qhe.bind(e),vj(e,"on")}function Zhe(){vj(this,"off")}var Xhe={attachEvents:Whe,detachEvents:Zhe};const gF=(e,i)=>e.grid&&i.grid&&i.grid.rows>1;function Yhe(){const e=this,{realIndex:i,initialized:s,params:l,el:p}=e,_=l.breakpoints;if(!_||_&&Object.keys(_).length===0)return;const b=Og(),t=l.breakpointsBase==="window"||!l.breakpointsBase?l.breakpointsBase:"container",P=["window","container"].includes(l.breakpointsBase)||!l.breakpointsBase?e.el:b.querySelector(l.breakpointsBase),O=e.getBreakpoint(_,t,P);if(!O||e.currentBreakpoint===O)return;const $=(O in _?_[O]:void 0)||e.originalParams,W=gF(e,l),Y=gF(e,$),ae=e.params.grabCursor,se=$.grabCursor,ie=l.enabled;W&&!Y?(p.classList.remove(`${l.containerModifierClass}grid`,`${l.containerModifierClass}grid-column`),e.emitContainerClasses()):!W&&Y&&(p.classList.add(`${l.containerModifierClass}grid`),($.grid.fill&&$.grid.fill==="column"||!$.grid.fill&&l.grid.fill==="column")&&p.classList.add(`${l.containerModifierClass}grid-column`),e.emitContainerClasses()),ae&&!se?e.unsetGrabCursor():!ae&&se&&e.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(Ze=>{if(typeof $[Ze]>"u")return;const We=l[Ze]&&l[Ze].enabled,je=$[Ze]&&$[Ze].enabled;We&&!je&&e[Ze].disable(),!We&&je&&e[Ze].enable()});const pe=$.direction&&$.direction!==l.direction,ye=l.loop&&($.slidesPerView!==l.slidesPerView||pe),de=l.loop;pe&&s&&e.changeDirection(),Ff(e.params,$);const Ee=e.params.enabled,Pe=e.params.loop;Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),ie&&!Ee?e.disable():!ie&&Ee&&e.enable(),e.currentBreakpoint=O,e.emit("_beforeBreakpoint",$),s&&(ye?(e.loopDestroy(),e.loopCreate(i),e.updateSlides()):!de&&Pe?(e.loopCreate(i),e.updateSlides()):de&&!Pe&&e.loopDestroy()),e.emit("breakpoint",$)}function Khe(e,i="window",s){if(!e||i==="container"&&!s)return;let l=!1;const p=Zu(),_=i==="window"?p.innerHeight:s.clientHeight,b=Object.keys(e).map(t=>{if(typeof t=="string"&&t.indexOf("@")===0){const P=parseFloat(t.substr(1));return{value:_*P,point:t}}return{value:t,point:t}});b.sort((t,P)=>parseInt(t.value,10)-parseInt(P.value,10));for(let t=0;t<b.length;t+=1){const{point:P,value:O}=b[t];i==="window"?p.matchMedia(`(min-width: ${O}px)`).matches&&(l=P):O<=s.clientWidth&&(l=P)}return l||"max"}var Jhe={setBreakpoint:Yhe,getBreakpoint:Khe};function Qhe(e,i){const s=[];return e.forEach(l=>{typeof l=="object"?Object.keys(l).forEach(p=>{l[p]&&s.push(i+p)}):typeof l=="string"&&s.push(i+l)}),s}function ede(){const e=this,{classNames:i,params:s,rtl:l,el:p,device:_}=e,b=Qhe(["initialized",s.direction,{"free-mode":e.params.freeMode&&s.freeMode.enabled},{autoheight:s.autoHeight},{rtl:l},{grid:s.grid&&s.grid.rows>1},{"grid-column":s.grid&&s.grid.rows>1&&s.grid.fill==="column"},{android:_.android},{ios:_.ios},{"css-mode":s.cssMode},{centered:s.cssMode&&s.centeredSlides},{"watch-progress":s.watchSlidesProgress}],s.containerModifierClass);i.push(...b),p.classList.add(...i),e.emitContainerClasses()}function tde(){const e=this,{el:i,classNames:s}=e;!i||typeof i=="string"||(i.classList.remove(...s),e.emitContainerClasses())}var ide={addClasses:ede,removeClasses:tde};function nde(){const e=this,{isLocked:i,params:s}=e,{slidesOffsetBefore:l}=s;if(l){const p=e.slides.length-1,_=e.slidesGrid[p]+e.slidesSizesGrid[p]+l*2;e.isLocked=e.size>_}else e.isLocked=e.snapGrid.length===1;s.allowSlideNext===!0&&(e.allowSlideNext=!e.isLocked),s.allowSlidePrev===!0&&(e.allowSlidePrev=!e.isLocked),i&&i!==e.isLocked&&(e.isEnd=!1),i!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock")}var rde={checkOverflow:nde},jP={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function sde(e,i){return function(l={}){const p=Object.keys(l)[0],_=l[p];if(typeof _!="object"||_===null){Ff(i,l);return}if(e[p]===!0&&(e[p]={enabled:!0}),p==="navigation"&&e[p]&&e[p].enabled&&!e[p].prevEl&&!e[p].nextEl&&(e[p].auto=!0),["pagination","scrollbar"].indexOf(p)>=0&&e[p]&&e[p].enabled&&!e[p].el&&(e[p].auto=!0),!(p in e&&"enabled"in _)){Ff(i,l);return}typeof e[p]=="object"&&!("enabled"in e[p])&&(e[p].enabled=!0),e[p]||(e[p]={enabled:!1}),Ff(i,l)}}const cA={eventsEmitter:ihe,update:fhe,translate:vhe,transition:The,slide:khe,loop:zhe,grabCursor:Bhe,events:Xhe,breakpoints:Jhe,checkOverflow:rde,classes:ide},uA={};let _k=class R_{constructor(...i){let s,l;i.length===1&&i[0].constructor&&Object.prototype.toString.call(i[0]).slice(8,-1)==="Object"?l=i[0]:[s,l]=i,l||(l={}),l=Ff({},l),s&&!l.el&&(l.el=s);const p=Og();if(l.el&&typeof l.el=="string"&&p.querySelectorAll(l.el).length>1){const P=[];return p.querySelectorAll(l.el).forEach(O=>{const F=Ff({},l,{el:O});P.push(new R_(F))}),P}const _=this;_.__swiper__=!0,_.support=mj(),_.device=gj({userAgent:l.userAgent}),_.browser=_j(),_.eventsListeners={},_.eventsAnyListeners=[],_.modules=[..._.__modules__],l.modules&&Array.isArray(l.modules)&&_.modules.push(...l.modules);const b={};_.modules.forEach(P=>{P({params:l,swiper:_,extendParams:sde(l,b),on:_.on.bind(_),once:_.once.bind(_),off:_.off.bind(_),emit:_.emit.bind(_)})});const t=Ff({},jP,b);return _.params=Ff({},t,uA,l),_.originalParams=Ff({},_.params),_.passedParams=Ff({},l),_.params&&_.params.on&&Object.keys(_.params.on).forEach(P=>{_.on(P,_.params.on[P])}),_.params&&_.params.onAny&&_.onAny(_.params.onAny),Object.assign(_,{enabled:_.params.enabled,el:s,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return _.params.direction==="horizontal"},isVertical(){return _.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:_.params.allowSlideNext,allowSlidePrev:_.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:_.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:_.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),_.emit("_swiper"),_.params.init&&_.init(),_}getDirectionLabel(i){return this.isHorizontal()?i:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[i]}getSlideIndex(i){const{slidesEl:s,params:l}=this,p=bm(s,`.${l.slideClass}, swiper-slide`),_=hF(p[0]);return hF(i)-_}getSlideIndexByData(i){return this.getSlideIndex(this.slides.find(s=>s.getAttribute("data-swiper-slide-index")*1===i))}getSlideIndexWhenGrid(i){return this.grid&&this.params.grid&&this.params.grid.rows>1&&(this.params.grid.fill==="column"?i=Math.floor(i/this.params.grid.rows):this.params.grid.fill==="row"&&(i=i%Math.ceil(this.slides.length/this.params.grid.rows))),i}recalcSlides(){const i=this,{slidesEl:s,params:l}=i;i.slides=bm(s,`.${l.slideClass}, swiper-slide`)}enable(){const i=this;i.enabled||(i.enabled=!0,i.params.grabCursor&&i.setGrabCursor(),i.emit("enable"))}disable(){const i=this;i.enabled&&(i.enabled=!1,i.params.grabCursor&&i.unsetGrabCursor(),i.emit("disable"))}setProgress(i,s){const l=this;i=Math.min(Math.max(i,0),1);const p=l.minTranslate(),b=(l.maxTranslate()-p)*i+p;l.translateTo(b,typeof s>"u"?0:s),l.updateActiveIndex(),l.updateSlidesClasses()}emitContainerClasses(){const i=this;if(!i.params._emitClasses||!i.el)return;const s=i.el.className.split(" ").filter(l=>l.indexOf("swiper")===0||l.indexOf(i.params.containerModifierClass)===0);i.emit("_containerClasses",s.join(" "))}getSlideClasses(i){const s=this;return s.destroyed?"":i.className.split(" ").filter(l=>l.indexOf("swiper-slide")===0||l.indexOf(s.params.slideClass)===0).join(" ")}emitSlidesClasses(){const i=this;if(!i.params._emitClasses||!i.el)return;const s=[];i.slides.forEach(l=>{const p=i.getSlideClasses(l);s.push({slideEl:l,classNames:p}),i.emit("_slideClass",l,p)}),i.emit("_slideClasses",s)}slidesPerViewDynamic(i="current",s=!1){const l=this,{params:p,slides:_,slidesGrid:b,slidesSizesGrid:t,size:P,activeIndex:O}=l;let F=1;if(typeof p.slidesPerView=="number")return p.slidesPerView;if(p.centeredSlides){let $=_[O]?Math.ceil(_[O].swiperSlideSize):0,W;for(let Y=O+1;Y<_.length;Y+=1)_[Y]&&!W&&($+=Math.ceil(_[Y].swiperSlideSize),F+=1,$>P&&(W=!0));for(let Y=O-1;Y>=0;Y-=1)_[Y]&&!W&&($+=_[Y].swiperSlideSize,F+=1,$>P&&(W=!0))}else if(i==="current")for(let $=O+1;$<_.length;$+=1)(s?b[$]+t[$]-b[O]<P:b[$]-b[O]<P)&&(F+=1);else for(let $=O-1;$>=0;$-=1)b[O]-b[$]<P&&(F+=1);return F}update(){const i=this;if(!i||i.destroyed)return;const{snapGrid:s,params:l}=i;l.breakpoints&&i.setBreakpoint(),[...i.el.querySelectorAll('[loading="lazy"]')].forEach(b=>{b.complete&&qS(i,b)}),i.updateSize(),i.updateSlides(),i.updateProgress(),i.updateSlidesClasses();function p(){const b=i.rtlTranslate?i.translate*-1:i.translate,t=Math.min(Math.max(b,i.maxTranslate()),i.minTranslate());i.setTranslate(t),i.updateActiveIndex(),i.updateSlidesClasses()}let _;if(l.freeMode&&l.freeMode.enabled&&!l.cssMode)p(),l.autoHeight&&i.updateAutoHeight();else{if((l.slidesPerView==="auto"||l.slidesPerView>1)&&i.isEnd&&!l.centeredSlides){const b=i.virtual&&l.virtual.enabled?i.virtual.slides:i.slides;_=i.slideTo(b.length-1,0,!1,!0)}else _=i.slideTo(i.activeIndex,0,!1,!0);_||p()}l.watchOverflow&&s!==i.snapGrid&&i.checkOverflow(),i.emit("update")}changeDirection(i,s=!0){const l=this,p=l.params.direction;return i||(i=p==="horizontal"?"vertical":"horizontal"),i===p||i!=="horizontal"&&i!=="vertical"||(l.el.classList.remove(`${l.params.containerModifierClass}${p}`),l.el.classList.add(`${l.params.containerModifierClass}${i}`),l.emitContainerClasses(),l.params.direction=i,l.slides.forEach(_=>{i==="vertical"?_.style.width="":_.style.height=""}),l.emit("changeDirection"),s&&l.update()),l}changeLanguageDirection(i){const s=this;s.rtl&&i==="rtl"||!s.rtl&&i==="ltr"||(s.rtl=i==="rtl",s.rtlTranslate=s.params.direction==="horizontal"&&s.rtl,s.rtl?(s.el.classList.add(`${s.params.containerModifierClass}rtl`),s.el.dir="rtl"):(s.el.classList.remove(`${s.params.containerModifierClass}rtl`),s.el.dir="ltr"),s.update())}mount(i){const s=this;if(s.mounted)return!0;let l=i||s.params.el;if(typeof l=="string"&&(l=document.querySelector(l)),!l)return!1;l.swiper=s,l.parentNode&&l.parentNode.host&&l.parentNode.host.nodeName===s.params.swiperElementNodeName.toUpperCase()&&(s.isElement=!0);const p=()=>`.${(s.params.wrapperClass||"").trim().split(" ").join(".")}`;let b=l&&l.shadowRoot&&l.shadowRoot.querySelector?l.shadowRoot.querySelector(p()):bm(l,p())[0];return!b&&s.params.createElements&&(b=lb("div",s.params.wrapperClass),l.append(b),bm(l,`.${s.params.slideClass}`).forEach(t=>{b.append(t)})),Object.assign(s,{el:l,wrapperEl:b,slidesEl:s.isElement&&!l.parentNode.host.slideSlots?l.parentNode.host:b,hostEl:s.isElement?l.parentNode.host:l,mounted:!0,rtl:l.dir.toLowerCase()==="rtl"||e0(l,"direction")==="rtl",rtlTranslate:s.params.direction==="horizontal"&&(l.dir.toLowerCase()==="rtl"||e0(l,"direction")==="rtl"),wrongRTL:e0(b,"display")==="-webkit-box"}),!0}init(i){const s=this;if(s.initialized||s.mount(i)===!1)return s;s.emit("beforeInit"),s.params.breakpoints&&s.setBreakpoint(),s.addClasses(),s.updateSize(),s.updateSlides(),s.params.watchOverflow&&s.checkOverflow(),s.params.grabCursor&&s.enabled&&s.setGrabCursor(),s.params.loop&&s.virtual&&s.params.virtual.enabled?s.slideTo(s.params.initialSlide+s.virtual.slidesBefore,0,s.params.runCallbacksOnInit,!1,!0):s.slideTo(s.params.initialSlide,0,s.params.runCallbacksOnInit,!1,!0),s.params.loop&&s.loopCreate(void 0,!0),s.attachEvents();const p=[...s.el.querySelectorAll('[loading="lazy"]')];return s.isElement&&p.push(...s.hostEl.querySelectorAll('[loading="lazy"]')),p.forEach(_=>{_.complete?qS(s,_):_.addEventListener("load",b=>{qS(s,b.target)})}),VP(s),s.initialized=!0,VP(s),s.emit("init"),s.emit("afterInit"),s}destroy(i=!0,s=!0){const l=this,{params:p,el:_,wrapperEl:b,slides:t}=l;return typeof l.params>"u"||l.destroyed||(l.emit("beforeDestroy"),l.initialized=!1,l.detachEvents(),p.loop&&l.loopDestroy(),s&&(l.removeClasses(),_&&typeof _!="string"&&_.removeAttribute("style"),b&&b.removeAttribute("style"),t&&t.length&&t.forEach(P=>{P.classList.remove(p.slideVisibleClass,p.slideFullyVisibleClass,p.slideActiveClass,p.slideNextClass,p.slidePrevClass),P.removeAttribute("style"),P.removeAttribute("data-swiper-slide-index")})),l.emit("destroy"),Object.keys(l.eventsListeners).forEach(P=>{l.off(P)}),i!==!1&&(l.el&&typeof l.el!="string"&&(l.el.swiper=null),Uue(l)),l.destroyed=!0),null}static extendDefaults(i){Ff(uA,i)}static get extendedDefaults(){return uA}static get defaults(){return jP}static installModule(i){R_.prototype.__modules__||(R_.prototype.__modules__=[]);const s=R_.prototype.__modules__;typeof i=="function"&&s.indexOf(i)<0&&s.push(i)}static use(i){return Array.isArray(i)?(i.forEach(s=>R_.installModule(s)),R_):(R_.installModule(i),R_)}};Object.keys(cA).forEach(e=>{Object.keys(cA[e]).forEach(i=>{_k.prototype[i]=cA[e][i]})});_k.use([ehe,the]);const xj=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function yv(e){return typeof e=="object"&&e!==null&&e.constructor&&Object.prototype.toString.call(e).slice(8,-1)==="Object"&&!e.__swiper__}function Wx(e,i){const s=["__proto__","constructor","prototype"];Object.keys(i).filter(l=>s.indexOf(l)<0).forEach(l=>{typeof e[l]>"u"?e[l]=i[l]:yv(i[l])&&yv(e[l])&&Object.keys(i[l]).length>0?i[l].__swiper__?e[l]=i[l]:Wx(e[l],i[l]):e[l]=i[l]})}function bj(e={}){return e.navigation&&typeof e.navigation.nextEl>"u"&&typeof e.navigation.prevEl>"u"}function wj(e={}){return e.pagination&&typeof e.pagination.el>"u"}function Tj(e={}){return e.scrollbar&&typeof e.scrollbar.el>"u"}function Sj(e=""){const i=e.split(" ").map(l=>l.trim()).filter(l=>!!l),s=[];return i.forEach(l=>{s.indexOf(l)<0&&s.push(l)}),s.join(" ")}function ode(e=""){return e?e.includes("swiper-wrapper")?e:`swiper-wrapper ${e}`:"swiper-wrapper"}function ade({swiper:e,slides:i,passedParams:s,changedParams:l,nextEl:p,prevEl:_,scrollbarEl:b,paginationEl:t}){const P=l.filter(je=>je!=="children"&&je!=="direction"&&je!=="wrapperClass"),{params:O,pagination:F,navigation:$,scrollbar:W,virtual:Y,thumbs:ae}=e;let se,ie,pe,ye,de,Ee,Pe,Ze;l.includes("thumbs")&&s.thumbs&&s.thumbs.swiper&&!s.thumbs.swiper.destroyed&&O.thumbs&&(!O.thumbs.swiper||O.thumbs.swiper.destroyed)&&(se=!0),l.includes("controller")&&s.controller&&s.controller.control&&O.controller&&!O.controller.control&&(ie=!0),l.includes("pagination")&&s.pagination&&(s.pagination.el||t)&&(O.pagination||O.pagination===!1)&&F&&!F.el&&(pe=!0),l.includes("scrollbar")&&s.scrollbar&&(s.scrollbar.el||b)&&(O.scrollbar||O.scrollbar===!1)&&W&&!W.el&&(ye=!0),l.includes("navigation")&&s.navigation&&(s.navigation.prevEl||_)&&(s.navigation.nextEl||p)&&(O.navigation||O.navigation===!1)&&$&&!$.prevEl&&!$.nextEl&&(de=!0);const We=je=>{e[je]&&(e[je].destroy(),je==="navigation"?(e.isElement&&(e[je].prevEl.remove(),e[je].nextEl.remove()),O[je].prevEl=void 0,O[je].nextEl=void 0,e[je].prevEl=void 0,e[je].nextEl=void 0):(e.isElement&&e[je].el.remove(),O[je].el=void 0,e[je].el=void 0))};l.includes("loop")&&e.isElement&&(O.loop&&!s.loop?Ee=!0:!O.loop&&s.loop?Pe=!0:Ze=!0),P.forEach(je=>{if(yv(O[je])&&yv(s[je]))Object.assign(O[je],s[je]),(je==="navigation"||je==="pagination"||je==="scrollbar")&&"enabled"in s[je]&&!s[je].enabled&&We(je);else{const Ye=s[je];(Ye===!0||Ye===!1)&&(je==="navigation"||je==="pagination"||je==="scrollbar")?Ye===!1&&We(je):O[je]=s[je]}}),P.includes("controller")&&!ie&&e.controller&&e.controller.control&&O.controller&&O.controller.control&&(e.controller.control=O.controller.control),l.includes("children")&&i&&Y&&O.virtual.enabled?(Y.slides=i,Y.update(!0)):l.includes("virtual")&&Y&&O.virtual.enabled&&(i&&(Y.slides=i),Y.update(!0)),l.includes("children")&&i&&O.loop&&(Ze=!0),se&&ae.init()&&ae.update(!0),ie&&(e.controller.control=O.controller.control),pe&&(e.isElement&&(!t||typeof t=="string")&&(t=document.createElement("div"),t.classList.add("swiper-pagination"),t.part.add("pagination"),e.el.appendChild(t)),t&&(O.pagination.el=t),F.init(),F.render(),F.update()),ye&&(e.isElement&&(!b||typeof b=="string")&&(b=document.createElement("div"),b.classList.add("swiper-scrollbar"),b.part.add("scrollbar"),e.el.appendChild(b)),b&&(O.scrollbar.el=b),W.init(),W.updateSize(),W.setTranslate()),de&&(e.isElement&&((!p||typeof p=="string")&&(p=document.createElement("div"),p.classList.add("swiper-button-next"),Ww(p,e.navigation.arrowSvg),p.part.add("button-next"),e.el.appendChild(p)),(!_||typeof _=="string")&&(_=document.createElement("div"),_.classList.add("swiper-button-prev"),Ww(_,e.navigation.arrowSvg),_.part.add("button-prev"),e.el.appendChild(_))),p&&(O.navigation.nextEl=p),_&&(O.navigation.prevEl=_),$.init(),$.update()),l.includes("allowSlideNext")&&(e.allowSlideNext=s.allowSlideNext),l.includes("allowSlidePrev")&&(e.allowSlidePrev=s.allowSlidePrev),l.includes("direction")&&e.changeDirection(s.direction,!1),(Ee||Ze)&&e.loopDestroy(),(Pe||Ze)&&e.loopCreate(),e.update()}function _F(e={},i=!0){const s={on:{}},l={},p={};Wx(s,jP),s._emitClasses=!0,s.init=!1;const _={},b=xj.map(P=>P.replace(/_/,"")),t=Object.assign({},e);return Object.keys(t).forEach(P=>{typeof e[P]>"u"||(b.indexOf(P)>=0?yv(e[P])?(s[P]={},p[P]={},Wx(s[P],e[P]),Wx(p[P],e[P])):(s[P]=e[P],p[P]=e[P]):P.search(/on[A-Z]/)===0&&typeof e[P]=="function"?i?l[`${P[2].toLowerCase()}${P.substr(3)}`]=e[P]:s.on[`${P[2].toLowerCase()}${P.substr(3)}`]=e[P]:_[P]=e[P])}),["navigation","pagination","scrollbar"].forEach(P=>{s[P]===!0&&(s[P]={}),s[P]===!1&&delete s[P]}),{params:s,passedParams:p,rest:_,events:l}}function lde({el:e,nextEl:i,prevEl:s,paginationEl:l,scrollbarEl:p,swiper:_},b){bj(b)&&i&&s&&(_.params.navigation.nextEl=i,_.originalParams.navigation.nextEl=i,_.params.navigation.prevEl=s,_.originalParams.navigation.prevEl=s),wj(b)&&l&&(_.params.pagination.el=l,_.originalParams.pagination.el=l),Tj(b)&&p&&(_.params.scrollbar.el=p,_.originalParams.scrollbar.el=p),_.init(e)}function cde(e,i,s,l,p){const _=[];if(!i)return _;const b=P=>{_.indexOf(P)<0&&_.push(P)};if(s&&l){const P=l.map(p),O=s.map(p);P.join("")!==O.join("")&&b("children"),l.length!==s.length&&b("children")}return xj.filter(P=>P[0]==="_").map(P=>P.replace(/_/,"")).forEach(P=>{if(P in e&&P in i)if(yv(e[P])&&yv(i[P])){const O=Object.keys(e[P]),F=Object.keys(i[P]);O.length!==F.length?b(P):(O.forEach($=>{e[P][$]!==i[P][$]&&b(P)}),F.forEach($=>{e[P][$]!==i[P][$]&&b(P)}))}else e[P]!==i[P]&&b(P)}),_}const ude=e=>{!e||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.emit("_virtualUpdated"),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())};function hA(e={},i,s){const l=[],p={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]},_=(b,t)=>{Array.isArray(b)&&b.forEach(P=>{const O=typeof P.type=="symbol";t==="default"&&(t="container-end"),O&&P.children?_(P.children,t):P.type&&(P.type.name==="SwiperSlide"||P.type.name==="AsyncComponentWrapper")||P.componentOptions&&P.componentOptions.tag==="SwiperSlide"?l.push(P):p[t]&&p[t].push(P)})};return Object.keys(e).forEach(b=>{if(typeof e[b]!="function")return;const t=e[b]();_(t,b)}),s.value=i.value,i.value=l,{slides:l,slots:p}}function hde(e,i,s){if(!s)return null;const l=F=>{let $=F;return F<0?$=i.length+F:$>=i.length&&($=$-i.length),$},p=e.value.isHorizontal()?{[e.value.rtlTranslate?"right":"left"]:`${s.offset}px`}:{top:`${s.offset}px`},{from:_,to:b}=s,t=e.value.params.loop?-i.length:0,P=e.value.params.loop?i.length*2:i.length,O=[];for(let F=t;F<P;F+=1)F>=_&&F<=b&&O.length<i.length&&O.push(i[l(F)]);return O.map(F=>{if(F.props||(F.props={}),F.props.style||(F.props.style={}),F.props.swiperRef=e,F.props.style=p,F.type)return Ns(F.type,{...F.props},F.children);if(F.componentOptions)return Ns(F.componentOptions.Ctor,{...F.props},F.componentOptions.children)})}const dde={name:"Swiper",props:{tag:{type:String,default:"div"},wrapperTag:{type:String,default:"div"},modules:{type:Array,default:void 0},init:{type:Boolean,default:void 0},direction:{type:String,default:void 0},oneWayMovement:{type:Boolean,default:void 0},swiperElementNodeName:{type:String,default:"SWIPER-CONTAINER"},touchEventsTarget:{type:String,default:void 0},initialSlide:{type:Number,default:void 0},speed:{type:Number,default:void 0},cssMode:{type:Boolean,default:void 0},updateOnWindowResize:{type:Boolean,default:void 0},resizeObserver:{type:Boolean,default:void 0},nested:{type:Boolean,default:void 0},focusableElements:{type:String,default:void 0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},preventInteractionOnTransition:{type:Boolean,default:void 0},userAgent:{type:String,default:void 0},url:{type:String,default:void 0},edgeSwipeDetection:{type:[Boolean,String],default:void 0},edgeSwipeThreshold:{type:Number,default:void 0},autoHeight:{type:Boolean,default:void 0},setWrapperSize:{type:Boolean,default:void 0},virtualTranslate:{type:Boolean,default:void 0},effect:{type:String,default:void 0},breakpoints:{type:Object,default:void 0},breakpointsBase:{type:String,default:void 0},spaceBetween:{type:[Number,String],default:void 0},slidesPerView:{type:[Number,String],default:void 0},maxBackfaceHiddenSlides:{type:Number,default:void 0},slidesPerGroup:{type:Number,default:void 0},slidesPerGroupSkip:{type:Number,default:void 0},slidesPerGroupAuto:{type:Boolean,default:void 0},centeredSlides:{type:Boolean,default:void 0},centeredSlidesBounds:{type:Boolean,default:void 0},slidesOffsetBefore:{type:Number,default:void 0},slidesOffsetAfter:{type:Number,default:void 0},normalizeSlideIndex:{type:Boolean,default:void 0},centerInsufficientSlides:{type:Boolean,default:void 0},watchOverflow:{type:Boolean,default:void 0},roundLengths:{type:Boolean,default:void 0},touchRatio:{type:Number,default:void 0},touchAngle:{type:Number,default:void 0},simulateTouch:{type:Boolean,default:void 0},shortSwipes:{type:Boolean,default:void 0},longSwipes:{type:Boolean,default:void 0},longSwipesRatio:{type:Number,default:void 0},longSwipesMs:{type:Number,default:void 0},followFinger:{type:Boolean,default:void 0},allowTouchMove:{type:Boolean,default:void 0},threshold:{type:Number,default:void 0},touchMoveStopPropagation:{type:Boolean,default:void 0},touchStartPreventDefault:{type:Boolean,default:void 0},touchStartForcePreventDefault:{type:Boolean,default:void 0},touchReleaseOnEdges:{type:Boolean,default:void 0},uniqueNavElements:{type:Boolean,default:void 0},resistance:{type:Boolean,default:void 0},resistanceRatio:{type:Number,default:void 0},watchSlidesProgress:{type:Boolean,default:void 0},grabCursor:{type:Boolean,default:void 0},preventClicks:{type:Boolean,default:void 0},preventClicksPropagation:{type:Boolean,default:void 0},slideToClickedSlide:{type:Boolean,default:void 0},loop:{type:Boolean,default:void 0},loopedSlides:{type:Number,default:void 0},loopPreventsSliding:{type:Boolean,default:void 0},loopAdditionalSlides:{type:Number,default:void 0},loopAddBlankSlides:{type:Boolean,default:void 0},rewind:{type:Boolean,default:void 0},allowSlidePrev:{type:Boolean,default:void 0},allowSlideNext:{type:Boolean,default:void 0},swipeHandler:{type:Boolean,default:void 0},noSwiping:{type:Boolean,default:void 0},noSwipingClass:{type:String,default:void 0},noSwipingSelector:{type:String,default:void 0},passiveListeners:{type:Boolean,default:void 0},containerModifierClass:{type:String,default:void 0},slideClass:{type:String,default:void 0},slideActiveClass:{type:String,default:void 0},slideVisibleClass:{type:String,default:void 0},slideFullyVisibleClass:{type:String,default:void 0},slideBlankClass:{type:String,default:void 0},slideNextClass:{type:String,default:void 0},slidePrevClass:{type:String,default:void 0},wrapperClass:{type:String,default:void 0},lazyPreloaderClass:{type:String,default:void 0},lazyPreloadPrevNext:{type:Number,default:void 0},runCallbacksOnInit:{type:Boolean,default:void 0},observer:{type:Boolean,default:void 0},observeParents:{type:Boolean,default:void 0},observeSlideChildren:{type:Boolean,default:void 0},a11y:{type:[Boolean,Object],default:void 0},autoplay:{type:[Boolean,Object],default:void 0},controller:{type:Object,default:void 0},coverflowEffect:{type:Object,default:void 0},cubeEffect:{type:Object,default:void 0},fadeEffect:{type:Object,default:void 0},flipEffect:{type:Object,default:void 0},creativeEffect:{type:Object,default:void 0},cardsEffect:{type:Object,default:void 0},hashNavigation:{type:[Boolean,Object],default:void 0},history:{type:[Boolean,Object],default:void 0},keyboard:{type:[Boolean,Object],default:void 0},mousewheel:{type:[Boolean,Object],default:void 0},navigation:{type:[Boolean,Object],default:void 0},pagination:{type:[Boolean,Object],default:void 0},parallax:{type:[Boolean,Object],default:void 0},scrollbar:{type:[Boolean,Object],default:void 0},thumbs:{type:Object,default:void 0},virtual:{type:[Boolean,Object],default:void 0},zoom:{type:[Boolean,Object],default:void 0},grid:{type:[Object],default:void 0},freeMode:{type:[Boolean,Object],default:void 0},enabled:{type:Boolean,default:void 0}},emits:["_beforeBreakpoint","_containerClasses","_slideClass","_slideClasses","_swiper","_freeModeNoMomentumRelease","_virtualUpdated","activeIndexChange","afterInit","autoplay","autoplayStart","autoplayStop","autoplayPause","autoplayResume","autoplayTimeLeft","beforeDestroy","beforeInit","beforeLoopFix","beforeResize","beforeSlideChangeStart","beforeTransitionStart","breakpoint","changeDirection","click","disable","doubleTap","doubleClick","destroy","enable","fromEdge","hashChange","hashSet","init","keyPress","lock","loopFix","momentumBounce","navigationHide","navigationShow","navigationPrev","navigationNext","observerUpdate","orientationchange","paginationHide","paginationRender","paginationShow","paginationUpdate","progress","reachBeginning","reachEnd","realIndexChange","resize","scroll","scrollbarDragEnd","scrollbarDragMove","scrollbarDragStart","setTransition","setTranslate","slidesUpdated","slideChange","slideChangeTransitionEnd","slideChangeTransitionStart","slideNextTransitionEnd","slideNextTransitionStart","slidePrevTransitionEnd","slidePrevTransitionStart","slideResetTransitionStart","slideResetTransitionEnd","sliderMove","sliderFirstMove","slidesLengthChange","slidesGridLengthChange","snapGridLengthChange","snapIndexChange","swiper","tap","toEdge","touchEnd","touchMove","touchMoveOpposite","touchStart","transitionEnd","transitionStart","unlock","update","virtualUpdate","zoomChange"],setup(e,{slots:i,emit:s}){const{tag:l,wrapperTag:p}=e,_=an("swiper"),b=an(null),t=an(!1),P=an(!1),O=an(null),F=an(null),$=an(null),W={value:[]},Y={value:[]},ae=an(null),se=an(null),ie=an(null),pe=an(null),{params:ye,passedParams:de}=_F(e,!1);hA(i,W,Y),$.value=de,Y.value=W.value;const Ee=()=>{hA(i,W,Y),t.value=!0};ye.onAny=(We,...je)=>{s(We,...je)},Object.assign(ye.on,{_beforeBreakpoint:Ee,_containerClasses(We,je){_.value=je}});const Pe={...ye};if(delete Pe.wrapperClass,F.value=new _k(Pe),F.value.virtual&&F.value.params.virtual.enabled){F.value.virtual.slides=W.value;const We={cache:!1,slides:W.value,renderExternal:je=>{b.value=je},renderExternalUpdate:!1};Wx(F.value.params.virtual,We),Wx(F.value.originalParams.virtual,We)}xv(()=>{!P.value&&F.value&&(F.value.emitSlidesClasses(),P.value=!0);const{passedParams:We}=_F(e,!1),je=cde(We,$.value,W.value,Y.value,Ye=>Ye.props&&Ye.props.key);$.value=We,(je.length||t.value)&&F.value&&!F.value.destroyed&&ade({swiper:F.value,slides:W.value,passedParams:We,changedParams:je,nextEl:ae.value,prevEl:se.value,scrollbarEl:pe.value,paginationEl:ie.value}),t.value=!1}),Ka("swiper",F),Qn(b,()=>{Da(()=>{ude(F.value)})}),La(()=>{O.value&&(lde({el:O.value,nextEl:ae.value,prevEl:se.value,paginationEl:ie.value,scrollbarEl:pe.value,swiper:F.value},ye),s("swiper",F.value))}),Vf(()=>{F.value&&!F.value.destroyed&&F.value.destroy(!0,!1)});function Ze(We){return ye.virtual?hde(F,We,b.value):(We.forEach((je,Ye)=>{je.props||(je.props={}),je.props.swiperRef=F,je.props.swiperSlideIndex=Ye}),We)}return()=>{const{slides:We,slots:je}=hA(i,W,Y);return Ns(l,{ref:O,class:Sj(_.value)},[je["container-start"],Ns(p,{class:ode(ye.wrapperClass)},[je["wrapper-start"],Ze(We),je["wrapper-end"]]),bj(e)&&[Ns("div",{ref:se,class:"swiper-button-prev"}),Ns("div",{ref:ae,class:"swiper-button-next"})],Tj(e)&&Ns("div",{ref:pe,class:"swiper-scrollbar"}),wj(e)&&Ns("div",{ref:ie,class:"swiper-pagination"}),je["container-end"]])}}},fde={name:"SwiperSlide",props:{tag:{type:String,default:"div"},swiperRef:{type:Object,required:!1},swiperSlideIndex:{type:Number,default:void 0,required:!1},zoom:{type:Boolean,default:void 0,required:!1},lazy:{type:Boolean,default:!1,required:!1},virtualIndex:{type:[String,Number],default:void 0}},setup(e,{slots:i}){let s=!1;const{swiperRef:l}=e,p=an(null),_=an("swiper-slide"),b=an(!1);function t(F,$,W){$===p.value&&(_.value=W)}La(()=>{!l||!l.value||(l.value.on("_slideClass",t),s=!0)}),oM(()=>{s||!l||!l.value||(l.value.on("_slideClass",t),s=!0)}),xv(()=>{!p.value||!l||!l.value||(typeof e.swiperSlideIndex<"u"&&(p.value.swiperSlideIndex=e.swiperSlideIndex),l.value.destroyed&&_.value!=="swiper-slide"&&(_.value="swiper-slide"))}),Vf(()=>{!l||!l.value||l.value.off("_slideClass",t)});const P=Ei(()=>({isActive:_.value.indexOf("swiper-slide-active")>=0,isVisible:_.value.indexOf("swiper-slide-visible")>=0,isPrev:_.value.indexOf("swiper-slide-prev")>=0,isNext:_.value.indexOf("swiper-slide-next")>=0}));Ka("swiperSlide",P);const O=()=>{b.value=!0};return()=>Ns(e.tag,{class:Sj(`${_.value}`),ref:p,"data-swiper-slide-index":typeof e.virtualIndex>"u"&&l&&l.value&&l.value.params.loop?e.swiperSlideIndex:e.virtualIndex,onLoadCapture:O},e.zoom?Ns("div",{class:"swiper-zoom-container","data-swiper-zoom":typeof e.zoom=="number"?e.zoom:void 0},[i.default&&i.default(P.value),e.lazy&&!b.value&&Ns("div",{class:"swiper-lazy-preloader"})]):[i.default&&i.default(P.value),e.lazy&&!b.value&&Ns("div",{class:"swiper-lazy-preloader"})])}};function pde({swiper:e,extendParams:i,on:s,emit:l}){i({virtual:{enabled:!1,slides:[],cache:!0,slidesPerViewAutoSlideSize:320,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});let p;const _=Og();e.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const b=_.createElement("div");function t(Y,ae){const se=e.params.virtual;if(se.cache&&e.virtual.cache[ae])return e.virtual.cache[ae];let ie;return se.renderSlide?(ie=se.renderSlide.call(e,Y,ae),typeof ie=="string"&&(Ww(b,ie),ie=b.children[0])):e.isElement?ie=lb("swiper-slide"):ie=lb("div",e.params.slideClass),ie.setAttribute("data-swiper-slide-index",ae),se.renderSlide||Ww(ie,Y),se.cache&&(e.virtual.cache[ae]=ie),ie}function P(Y,ae,se){const{slidesPerGroup:ie,centeredSlides:pe,slidesPerView:ye,loop:de,initialSlide:Ee}=e.params;if(ae&&!de&&Ee>0)return;const{addSlidesBefore:Pe,addSlidesAfter:Ze,slidesPerViewAutoSlideSize:We}=e.params.virtual,{from:je,to:Ye,slides:ct,slidesGrid:Lt,offset:Ht}=e.virtual;e.params.cssMode||e.updateActiveIndex();const ci=typeof se>"u"?e.activeIndex||0:se;let Wt;e.rtlTranslate?Wt="right":Wt=e.isHorizontal()?"left":"top";let $t;if(ye==="auto")if(We){let ti=e.size;ti||(ti=e.isHorizontal()?e.el.getBoundingClientRect().width:e.el.getBoundingClientRect().height),$t=Math.max(1,Math.ceil(ti/We))}else $t=1;else $t=ye;let Dt,Ft;pe?(Dt=Math.floor($t/2)+ie+Ze,Ft=Math.floor($t/2)+ie+Pe):(Dt=$t+(ie-1)+Ze,Ft=(de?$t:ie)+Pe);let vt=ci-Ft,wi=ci+Dt;de||(vt=Math.max(vt,0),wi=Math.min(wi,ct.length-1));let Qi=(e.slidesGrid[vt]||0)-(e.slidesGrid[0]||0);de&&ci>=Ft?(vt-=Ft,pe||(Qi+=e.slidesGrid[0])):de&&ci<Ft&&(vt=-Ft,pe&&(Qi+=e.slidesGrid[0])),Object.assign(e.virtual,{from:vt,to:wi,offset:Qi,slidesGrid:e.slidesGrid,slidesBefore:Ft,slidesAfter:Dt});function wn(){e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),l("virtualUpdate")}if(je===vt&&Ye===wi&&!Y){e.slidesGrid!==Lt&&Qi!==Ht&&e.slides.forEach(ti=>{ti.style[Wt]=`${Qi-Math.abs(e.cssOverflowAdjustment())}px`}),e.updateProgress(),l("virtualUpdate");return}if(e.params.virtual.renderExternal){e.params.virtual.renderExternal.call(e,{offset:Qi,from:vt,to:wi,slides:(function(){const sn=[];for(let Gi=vt;Gi<=wi;Gi+=1)sn.push(ct[Gi]);return sn})()}),e.params.virtual.renderExternalUpdate?wn():l("virtualUpdate");return}const qn=[],Fn=[],mr=ti=>{let sn=ti;return ti<0?sn=ct.length+ti:sn>=ct.length&&(sn=sn-ct.length),sn};if(Y)e.slides.filter(ti=>ti.matches(`.${e.params.slideClass}, swiper-slide`)).forEach(ti=>{ti.remove()});else for(let ti=je;ti<=Ye;ti+=1)if(ti<vt||ti>wi){const sn=mr(ti);e.slides.filter(Gi=>Gi.matches(`.${e.params.slideClass}[data-swiper-slide-index="${sn}"], swiper-slide[data-swiper-slide-index="${sn}"]`)).forEach(Gi=>{Gi.remove()})}const Sr=de?-ct.length:0,Hr=de?ct.length*2:ct.length;for(let ti=Sr;ti<Hr;ti+=1)if(ti>=vt&&ti<=wi){const sn=mr(ti);typeof Ye>"u"||Y?Fn.push(sn):(ti>Ye&&Fn.push(sn),ti<je&&qn.push(sn))}if(Fn.forEach(ti=>{e.slidesEl.append(t(ct[ti],ti))}),de)for(let ti=qn.length-1;ti>=0;ti-=1){const sn=qn[ti];e.slidesEl.prepend(t(ct[sn],sn))}else qn.sort((ti,sn)=>sn-ti),qn.forEach(ti=>{e.slidesEl.prepend(t(ct[ti],ti))});bm(e.slidesEl,".swiper-slide, swiper-slide").forEach(ti=>{ti.style[Wt]=`${Qi-Math.abs(e.cssOverflowAdjustment())}px`}),wn()}function O(Y){if(typeof Y=="object"&&"length"in Y)for(let ae=0;ae<Y.length;ae+=1)Y[ae]&&e.virtual.slides.push(Y[ae]);else e.virtual.slides.push(Y);P(!0)}function F(Y){const ae=e.activeIndex;let se=ae+1,ie=1;if(Array.isArray(Y)){for(let pe=0;pe<Y.length;pe+=1)Y[pe]&&e.virtual.slides.unshift(Y[pe]);se=ae+Y.length,ie=Y.length}else e.virtual.slides.unshift(Y);if(e.params.virtual.cache){const pe=e.virtual.cache,ye={};Object.keys(pe).forEach(de=>{const Ee=pe[de],Pe=Ee.getAttribute("data-swiper-slide-index");Pe&&Ee.setAttribute("data-swiper-slide-index",parseInt(Pe,10)+ie),ye[parseInt(de,10)+ie]=Ee}),e.virtual.cache=ye}P(!0),e.slideTo(se,0)}function $(Y){if(typeof Y>"u"||Y===null)return;let ae=e.activeIndex;if(Array.isArray(Y))for(let se=Y.length-1;se>=0;se-=1)e.params.virtual.cache&&(delete e.virtual.cache[Y[se]],Object.keys(e.virtual.cache).forEach(ie=>{ie>Y&&(e.virtual.cache[ie-1]=e.virtual.cache[ie],e.virtual.cache[ie-1].setAttribute("data-swiper-slide-index",ie-1),delete e.virtual.cache[ie])})),e.virtual.slides.splice(Y[se],1),Y[se]<ae&&(ae-=1),ae=Math.max(ae,0);else e.params.virtual.cache&&(delete e.virtual.cache[Y],Object.keys(e.virtual.cache).forEach(se=>{se>Y&&(e.virtual.cache[se-1]=e.virtual.cache[se],e.virtual.cache[se-1].setAttribute("data-swiper-slide-index",se-1),delete e.virtual.cache[se])})),e.virtual.slides.splice(Y,1),Y<ae&&(ae-=1),ae=Math.max(ae,0);P(!0),e.slideTo(ae,0)}function W(){e.virtual.slides=[],e.params.virtual.cache&&(e.virtual.cache={}),P(!0),e.slideTo(0,0)}s("beforeInit",()=>{if(!e.params.virtual.enabled)return;let Y;if(typeof e.passedParams.virtual.slides>"u"){const ae=[...e.slidesEl.children].filter(se=>se.matches(`.${e.params.slideClass}, swiper-slide`));ae&&ae.length&&(e.virtual.slides=[...ae],Y=!0,ae.forEach((se,ie)=>{se.setAttribute("data-swiper-slide-index",ie),e.virtual.cache[ie]=se,se.remove()}))}Y||(e.virtual.slides=e.params.virtual.slides),e.classNames.push(`${e.params.containerModifierClass}virtual`),e.params.watchSlidesProgress=!0,e.originalParams.watchSlidesProgress=!0,P(!1,!0)}),s("setTranslate",()=>{e.params.virtual.enabled&&(e.params.cssMode&&!e._immediateVirtual?(clearTimeout(p),p=setTimeout(()=>{P()},100)):P())}),s("init update resize",()=>{e.params.virtual.enabled&&e.params.cssMode&&nw(e.wrapperEl,"--swiper-virtual-size",`${e.virtualSize}px`)}),Object.assign(e.virtual,{appendSlide:O,prependSlide:F,removeSlide:$,removeAllSlides:W,update:P})}function mde({swiper:e,extendParams:i,on:s,emit:l}){const p=Og(),_=Zu();e.keyboard={enabled:!1},i({keyboard:{enabled:!1,onlyInViewport:!0,pageUpDown:!0}});function b(O){if(!e.enabled)return;const{rtlTranslate:F}=e;let $=O;$.originalEvent&&($=$.originalEvent);const W=$.keyCode||$.charCode,Y=e.params.keyboard.pageUpDown,ae=Y&&W===33,se=Y&&W===34,ie=W===37,pe=W===39,ye=W===38,de=W===40;if(!e.allowSlideNext&&(e.isHorizontal()&&pe||e.isVertical()&&de||se)||!e.allowSlidePrev&&(e.isHorizontal()&&ie||e.isVertical()&&ye||ae))return!1;if(!($.shiftKey||$.altKey||$.ctrlKey||$.metaKey)&&!(p.activeElement&&(p.activeElement.isContentEditable||p.activeElement.nodeName&&(p.activeElement.nodeName.toLowerCase()==="input"||p.activeElement.nodeName.toLowerCase()==="textarea")))){if(e.params.keyboard.onlyInViewport&&(ae||se||ie||pe||ye||de)){let Ee=!1;if(NP(e.el,`.${e.params.slideClass}, swiper-slide`).length>0&&NP(e.el,`.${e.params.slideActiveClass}`).length===0)return;const Pe=e.el,Ze=Pe.clientWidth,We=Pe.clientHeight,je=_.innerWidth,Ye=_.innerHeight,ct=Zue(Pe);F&&(ct.left-=Pe.scrollLeft);const Lt=[[ct.left,ct.top],[ct.left+Ze,ct.top],[ct.left,ct.top+We],[ct.left+Ze,ct.top+We]];for(let Ht=0;Ht<Lt.length;Ht+=1){const ci=Lt[Ht];if(ci[0]>=0&&ci[0]<=je&&ci[1]>=0&&ci[1]<=Ye){if(ci[0]===0&&ci[1]===0)continue;Ee=!0}}if(!Ee)return}e.isHorizontal()?((ae||se||ie||pe)&&($.preventDefault?$.preventDefault():$.returnValue=!1),((se||pe)&&!F||(ae||ie)&&F)&&e.slideNext(),((ae||ie)&&!F||(se||pe)&&F)&&e.slidePrev()):((ae||se||ye||de)&&($.preventDefault?$.preventDefault():$.returnValue=!1),(se||de)&&e.slideNext(),(ae||ye)&&e.slidePrev()),l("keyPress",W)}}function t(){e.keyboard.enabled||(p.addEventListener("keydown",b),e.keyboard.enabled=!0)}function P(){e.keyboard.enabled&&(p.removeEventListener("keydown",b),e.keyboard.enabled=!1)}s("init",()=>{e.params.keyboard.enabled&&t()}),s("destroy",()=>{e.keyboard.enabled&&P()}),Object.assign(e.keyboard,{enable:t,disable:P})}function gde(e,i,s,l){return e.params.createElements&&Object.keys(l).forEach(p=>{if(!s[p]&&s.auto===!0){let _=bm(e.el,`.${l[p]}`)[0];_||(_=lb("div",l[p]),_.className=l[p],e.el.append(_)),s[p]=_,i[p]=_}}),s}const yF='<svg class="swiper-navigation-icon" width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.38296 20.0762C0.111788 19.805 0.111788 19.3654 0.38296 19.0942L9.19758 10.2796L0.38296 1.46497C0.111788 1.19379 0.111788 0.754138 0.38296 0.482966C0.654131 0.211794 1.09379 0.211794 1.36496 0.482966L10.4341 9.55214C10.8359 9.9539 10.8359 10.6053 10.4341 11.007L1.36496 20.0762C1.09379 20.3474 0.654131 20.3474 0.38296 20.0762Z" fill="currentColor"/></svg>';function _de({swiper:e,extendParams:i,on:s,emit:l}){i({navigation:{nextEl:null,prevEl:null,addIcons:!0,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null,arrowSvg:yF};function p(Y){let ae;return Y&&typeof Y=="string"&&e.isElement&&(ae=e.el.querySelector(Y)||e.hostEl.querySelector(Y),ae)?ae:(Y&&(typeof Y=="string"&&(ae=[...document.querySelectorAll(Y)]),e.params.uniqueNavElements&&typeof Y=="string"&&ae&&ae.length>1&&e.el.querySelectorAll(Y).length===1?ae=e.el.querySelector(Y):ae&&ae.length===1&&(ae=ae[0])),Y&&!ae?Y:ae)}function _(Y,ae){const se=e.params.navigation;Y=D_(Y),Y.forEach(ie=>{ie&&(ie.classList[ae?"add":"remove"](...se.disabledClass.split(" ")),ie.tagName==="BUTTON"&&(ie.disabled=ae),e.params.watchOverflow&&e.enabled&&ie.classList[e.isLocked?"add":"remove"](se.lockClass))})}function b(){const{nextEl:Y,prevEl:ae}=e.navigation;if(e.params.loop){_(ae,!1),_(Y,!1);return}_(ae,e.isBeginning&&!e.params.rewind),_(Y,e.isEnd&&!e.params.rewind)}function t(Y){Y.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),l("navigationPrev"))}function P(Y){Y.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),l("navigationNext"))}function O(){const Y=e.params.navigation;if(e.params.navigation=gde(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(Y.nextEl||Y.prevEl))return;let ae=p(Y.nextEl),se=p(Y.prevEl);Object.assign(e.navigation,{nextEl:ae,prevEl:se}),ae=D_(ae),se=D_(se);const ie=(pe,ye)=>{if(pe){if(Y.addIcons&&pe.matches(".swiper-button-next,.swiper-button-prev")&&!pe.querySelector("svg")){const de=document.createElement("div");Ww(de,yF),pe.appendChild(de.querySelector("svg")),de.remove()}pe.addEventListener("click",ye==="next"?P:t)}!e.enabled&&pe&&pe.classList.add(...Y.lockClass.split(" "))};ae.forEach(pe=>ie(pe,"next")),se.forEach(pe=>ie(pe,"prev"))}function F(){let{nextEl:Y,prevEl:ae}=e.navigation;Y=D_(Y),ae=D_(ae);const se=(ie,pe)=>{ie.removeEventListener("click",pe==="next"?P:t),ie.classList.remove(...e.params.navigation.disabledClass.split(" "))};Y.forEach(ie=>se(ie,"next")),ae.forEach(ie=>se(ie,"prev"))}s("init",()=>{e.params.navigation.enabled===!1?W():(O(),b())}),s("toEdge fromEdge lock unlock",()=>{b()}),s("destroy",()=>{F()}),s("enable disable",()=>{let{nextEl:Y,prevEl:ae}=e.navigation;if(Y=D_(Y),ae=D_(ae),e.enabled){b();return}[...Y,...ae].filter(se=>!!se).forEach(se=>se.classList.add(e.params.navigation.lockClass))}),s("click",(Y,ae)=>{let{nextEl:se,prevEl:ie}=e.navigation;se=D_(se),ie=D_(ie);const pe=ae.target;let ye=ie.includes(pe)||se.includes(pe);if(e.isElement&&!ye){const de=ae.path||ae.composedPath&&ae.composedPath();de&&(ye=de.find(Ee=>se.includes(Ee)||ie.includes(Ee)))}if(e.params.navigation.hideOnClick&&!ye){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===pe||e.pagination.el.contains(pe)))return;let de;se.length?de=se[0].classList.contains(e.params.navigation.hiddenClass):ie.length&&(de=ie[0].classList.contains(e.params.navigation.hiddenClass)),l(de===!0?"navigationShow":"navigationHide"),[...se,...ie].filter(Ee=>!!Ee).forEach(Ee=>Ee.classList.toggle(e.params.navigation.hiddenClass))}});const $=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),O(),b()},W=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),F()};Object.assign(e.navigation,{enable:$,disable:W,update:b,init:O,destroy:F})}const yde={class:"flex items-start gap-2 text-white"},vde={class:"flex flex-col min-w-0 gap-0.5"},xde={class:"text-xs font-medium text-red-400"},bde={class:"text-xs text-white/70"},wde={key:1,class:"text-xs font-medium text-white tabular-nums"},Tde={class:"flex items-center gap-2"},Sde={class:"text-xs font-medium text-white"},Ede={class:"text-xs text-white/70"},Ide={class:"flex items-center gap-2"},Cde={class:"text-xs font-medium text-white"},Ade={class:"text-xs text-white/60 tabular-nums"},Pde={key:0,class:"text-xs text-white/70 tabular-nums"},Mde=kr({__name:"LoadingIndicator",setup(e,{expose:i}){const s={isVisible:!1,isConverting:!1,isHeic:!1,progress:0,bytesLoaded:0,bytesTotal:0,codec:void 0,isWebGLLoading:!1,webglMessage:void 0,webglQuality:"unknown",isError:!1,message:void 0,errorMessage:void 0},l=an(s);i({updateLoadingState:t=>{l.value=t.isVisible===!1?s:{...l.value,...t}},resetLoadingState:()=>{l.value=s}});const b={initial:{opacity:0,x:20,y:10,scale:.9},animate:{opacity:1,x:0,y:0,scale:1}};return(t,P)=>{const O=Wd;return li(),En(ut(ym),null,{default:Jn(()=>[x5(tr(ut(Gl).div,{key:"loading-indicator",class:"absolute bottom-4 right-4 z-40 pointer-events-none bg-black/40 backdrop-blur-3xl rounded-xl border border-white/10 p-3 shadow-2xl",initial:b.initial,animate:b.animate,exit:b.initial,transition:{type:"spring",duration:.3,bounce:0}},{default:Jn(()=>[Bn("div",yde,[tr(O,{name:"tabler:loader-2",class:"text-lg animate-spin"}),Bn("div",vde,[ut(l).isError?(li(),ir(qs,{key:0},[Bn("p",xde,Lr(ut(l).errorMessage||t.$t("viewer.photoload.loadError")),1),Bn("p",bde,Lr(t.$t("viewer.photoload.loading")),1)],64)):ut(l).isConverting?(li(),ir("p",wde,Lr(ut(l).message||t.$t("viewer.photoload.converting")),1)):ut(l).isWebGLLoading?(li(),ir(qs,{key:2},[Bn("div",Tde,[Bn("p",Sde,Lr(ut(l).webglMessage||t.$t("viewer.photoload.loadingWebGL")),1),ut(l).webglQuality!=="unknown"?(li(),ir("span",{key:0,class:"text-xs tabular-nums",style:Su({color:ut(l).webglQuality==="high"?"#4ade80":ut(l).webglQuality==="medium"?"#fbbf24":ut(l).webglQuality==="low"?"#f87171":"#94a3b8"})},Lr(ut(l).webglQuality),5)):gr("",!0)]),Bn("p",Ede,Lr(t.$t("viewer.photoload.loadingTexture")),1)],64)):(li(),ir(qs,{key:3},[Bn("div",Ide,[Bn("p",Cde,Lr(ut(l).isHeic?t.$t("viewer.photoload.loadingHEIC"):t.$t("viewer.photoload.loading")),1),Bn("span",Ade,Lr(Math.round(ut(l).progress))+"% ",1)]),ut(l).bytesTotal>0?(li(),ir("p",Pde,Lr((ut(l).bytesLoaded/1024/1024).toFixed(1))+"MB / "+Lr((ut(l).bytesTotal/1024/1024).toFixed(1))+"MB ",1)):gr("",!0)],64))])])]),_:1},8,["initial","animate","exit"]),[[gB,ut(l).isVisible]])]),_:1})}}}),kde=Object.assign(Mde,{__name:"PhotoLoadingIndicator"}),Dde=["src","alt"],Lde={key:2,class:"absolute inset-0 flex justify-center items-center bg-neutral-200 dark:bg-neutral-800"},Rde=kr({__name:"ThumbImage",props:{src:{},alt:{},thumbhash:{default:null},class:{default:""},thumbhashClass:{default:""},style:{default:void 0},threshold:{default:.1},rootMargin:{default:"50px"},imageContain:{type:Boolean,default:!1},lazy:{type:Boolean,default:!0}},emits:["load","error"],setup(e,{emit:i}){const s=e,l=i,p=iM("elemRef"),_=an(!1),b=an(!1),t=an(!1);La(()=>{s.lazy||(_.value=!0)});const{stop:P}=Gie(p,([$],W)=>{_.value=$?.isIntersecting||!1,_.value&&P()},{threshold:s.threshold,rootMargin:s.rootMargin,immediate:s.lazy}),O=()=>{b.value=!0,l("load")},F=()=>{t.value=!0,l("error")};return($,W)=>{const Y=RM,ae=Wd;return li(),ir("div",{ref_key:"elemRef",ref:p,class:_s(ut(q_)("relative overflow-hidden",$.$props.class)),style:Su(e.style)},[e.thumbhash?(li(),En(Y,{key:0,thumbhash:e.thumbhash,class:_s(ut(q_)("absolute inset-0 scale-110 blur-sm",e.thumbhashClass))},null,8,["thumbhash","class"])):gr("",!0),ut(_)?(li(),ir("img",{key:1,loading:"lazy",src:e.src,alt:e.alt,class:_s(ut(q_)("absolute inset-0 w-full h-full transition-opacity duration-300",e.imageContain?"object-contain":"object-cover",ut(b)?"opacity-100":"opacity-0")),onLoad:O,onError:F},null,42,Dde)):gr("",!0),ut(t)?(li(),ir("div",Lde,[tr(ae,{name:"tabler:photo-off",class:"size-6 text-neutral-400"}),W[0]||(W[0]=Bn("p",{class:"mt-2 text-sm text-neutral-500 dark:text-neutral-400"},"  ",-1))])):gr("",!0)],6)}}}),zde=Object.assign(Rde,{__name:"ThumbImage"});var gS={};var vF;function Ode(){return vF||(vF=1,gS.read=function(e,i,s,l,p){var _,b,t=p*8-l-1,P=(1<<t)-1,O=P>>1,F=-7,$=s?p-1:0,W=s?-1:1,Y=e[i+$];for($+=W,_=Y&(1<<-F)-1,Y>>=-F,F+=t;F>0;_=_*256+e[i+$],$+=W,F-=8);for(b=_&(1<<-F)-1,_>>=-F,F+=l;F>0;b=b*256+e[i+$],$+=W,F-=8);if(_===0)_=1-O;else{if(_===P)return b?NaN:(Y?-1:1)*(1/0);b=b+Math.pow(2,l),_=_-O}return(Y?-1:1)*b*Math.pow(2,_-l)},gS.write=function(e,i,s,l,p,_){var b,t,P,O=_*8-p-1,F=(1<<O)-1,$=F>>1,W=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=l?0:_-1,ae=l?1:-1,se=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(t=isNaN(i)?1:0,b=F):(b=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-b))<1&&(b--,P*=2),b+$>=1?i+=W/P:i+=W*Math.pow(2,1-$),i*P>=2&&(b++,P/=2),b+$>=F?(t=0,b=F):b+$>=1?(t=(i*P-1)*Math.pow(2,p),b=b+$):(t=i*Math.pow(2,$-1)*Math.pow(2,p),b=0));p>=8;e[s+Y]=t&255,Y+=ae,t/=256,p-=8);for(b=b<<p|t,O+=p;O>0;e[s+Y]=b&255,Y+=ae,b/=256,O-=8);e[s+Y-ae]|=se*128}),gS}Ode();const UP={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""};for(const[e,i]of Object.entries(UP));function Fde(e,i="utf-8"){switch(i.toLowerCase()){case"utf-8":case"utf8":return typeof globalThis.TextDecoder<"u"?new globalThis.TextDecoder("utf-8").decode(e):Bde(e);case"utf-16le":return Nde(e);case"ascii":return Vde(e);case"latin1":case"iso-8859-1":return jde(e);case"windows-1252":return Ude(e);default:throw new RangeError(`Encoding '${i}' not supported`)}}function Bde(e){let i="",s=0;for(;s<e.length;){const l=e[s++];if(l<128)i+=String.fromCharCode(l);else if(l<224){const p=e[s++]&63;i+=String.fromCharCode((l&31)<<6|p)}else if(l<240){const p=e[s++]&63,_=e[s++]&63;i+=String.fromCharCode((l&15)<<12|p<<6|_)}else{const p=e[s++]&63,_=e[s++]&63,b=e[s++]&63;let t=(l&7)<<18|p<<12|_<<6|b;t-=65536,i+=String.fromCharCode(55296+(t>>10&1023),56320+(t&1023))}}return i}function Nde(e){let i="";for(let s=0;s<e.length;s+=2)i+=String.fromCharCode(e[s]|e[s+1]<<8);return i}function Vde(e){return String.fromCharCode(...e.map(i=>i&127))}function jde(e){return String.fromCharCode(...e)}function Ude(e){let i="";for(const s of e)s>=128&&s<=159&&UP[s]?i+=UP[s]:i+=String.fromCharCode(s);return i}function Hd(e){return new DataView(e.buffer,e.byteOffset)}const $de={len:1,get(e,i){return Hd(e).getUint8(i)},put(e,i,s){return Hd(e).setUint8(i,s),i+1}},vc={len:2,get(e,i){return Hd(e).getUint16(i,!0)},put(e,i,s){return Hd(e).setUint16(i,s,!0),i+2}},K1={len:2,get(e,i){return Hd(e).getUint16(i)},put(e,i,s){return Hd(e).setUint16(i,s),i+2}},Tu={len:4,get(e,i){return Hd(e).getUint32(i,!0)},put(e,i,s){return Hd(e).setUint32(i,s,!0),i+4}},Gde={len:4,get(e,i){return Hd(e).getUint32(i)},put(e,i,s){return Hd(e).setUint32(i,s),i+4}},qde={len:4,get(e,i){return Hd(e).getInt32(i)},put(e,i,s){return Hd(e).setInt32(i,s),i+4}},Hde={len:8,get(e,i){return Hd(e).getBigUint64(i,!0)},put(e,i,s){return Hd(e).setBigUint64(i,s,!0),i+8}};class B_{constructor(i,s){this.len=i,this.encoding=s}get(i,s=0){const l=i.subarray(s,s+this.len);return Fde(l,this.encoding)}}const Wde="End-Of-Stream";class $d extends Error{constructor(){super(Wde),this.name="EndOfStreamError"}}class Zde extends Error{constructor(i="The operation was aborted"){super(i),this.name="AbortError"}}class Ej{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(i,s=!1){const l=await this.read(i,s);return this.peekQueue.push(i.subarray(0,l)),l}async read(i,s=!1){if(i.length===0)return 0;let l=this.readFromPeekBuffer(i);if(this.endOfStream||(l+=await this.readRemainderFromStream(i.subarray(l),s)),l===0&&!s)throw new $d;return l}readFromPeekBuffer(i){let s=i.length,l=0;for(;this.peekQueue.length>0&&s>0;){const p=this.peekQueue.pop();if(!p)throw new Error("peekData should be defined");const _=Math.min(p.length,s);i.set(p.subarray(0,_),l),l+=_,s-=_,_<p.length&&this.peekQueue.push(p.subarray(_))}return l}async readRemainderFromStream(i,s){let l=0;for(;l<i.length&&!this.endOfStream;){if(this.interrupted)throw new Zde;const p=await this.readFromStream(i.subarray(l),s);if(p===0)break;l+=p}if(!s&&l<i.length)throw new $d;return l}}class Xde extends Ej{constructor(i){super(),this.reader=i}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class Yde extends Xde{async readFromStream(i,s){if(i.length===0)return 0;const l=await this.reader.read(new Uint8Array(i.length),{min:s?void 0:i.length});return l.done&&(this.endOfStream=l.done),l.value?(i.set(l.value),l.value.length):0}}class xF extends Ej{constructor(i){super(),this.reader=i,this.buffer=null}writeChunk(i,s){const l=Math.min(s.length,i.length);return i.set(s.subarray(0,l)),l<s.length?this.buffer=s.subarray(l):this.buffer=null,l}async readFromStream(i,s){if(i.length===0)return 0;let l=0;for(this.buffer&&(l+=this.writeChunk(i,this.buffer));l<i.length&&!this.endOfStream;){const p=await this.reader.read();if(p.done){this.endOfStream=!0;break}p.value&&(l+=this.writeChunk(i.subarray(l),p.value))}if(!s&&l===0&&this.endOfStream)throw new $d;return l}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}function Kde(e){try{const i=e.getReader({mode:"byob"});return i instanceof ReadableStreamDefaultReader?new xF(i):new Yde(i)}catch(i){if(i instanceof TypeError)return new xF(e.getReader());throw i}}class yk{constructor(i){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=i?.onClose,i?.abortSignal&&i.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(i,s=this.position){const l=new Uint8Array(i.len);if(await this.readBuffer(l,{position:s})<i.len)throw new $d;return i.get(l,0)}async peekToken(i,s=this.position){const l=new Uint8Array(i.len);if(await this.peekBuffer(l,{position:s})<i.len)throw new $d;return i.get(l,0)}async readNumber(i){if(await this.readBuffer(this.numBuffer,{length:i.len})<i.len)throw new $d;return i.get(this.numBuffer,0)}async peekNumber(i){if(await this.peekBuffer(this.numBuffer,{length:i.len})<i.len)throw new $d;return i.get(this.numBuffer,0)}async ignore(i){if(this.fileInfo.size!==void 0){const s=this.fileInfo.size-this.position;if(i>s)return this.position+=s,s}return this.position+=i,i}async close(){await this.abort(),await this.onClose?.()}normalizeOptions(i,s){if(!this.supportsRandomAccess()&&s&&s.position!==void 0&&s.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:i.length,position:this.position,...s}}abort(){return Promise.resolve()}}const Jde=256e3;class Qde extends yk{constructor(i,s){super(s),this.streamReader=i,this.fileInfo=s?.fileInfo??{}}async readBuffer(i,s){const l=this.normalizeOptions(i,s),p=l.position-this.position;if(p>0)return await this.ignore(p),this.readBuffer(i,s);if(p<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(l.length===0)return 0;const _=await this.streamReader.read(i.subarray(0,l.length),l.mayBeLess);if(this.position+=_,(!s||!s.mayBeLess)&&_<l.length)throw new $d;return _}async peekBuffer(i,s){const l=this.normalizeOptions(i,s);let p=0;if(l.position){const _=l.position-this.position;if(_>0){const b=new Uint8Array(l.length+_);return p=await this.peekBuffer(b,{mayBeLess:l.mayBeLess}),i.set(b.subarray(_)),p-_}if(_<0)throw new Error("Cannot peek from a negative offset in a stream")}if(l.length>0){try{p=await this.streamReader.peek(i.subarray(0,l.length),l.mayBeLess)}catch(_){if(s?.mayBeLess&&_ instanceof $d)return 0;throw _}if(!l.mayBeLess&&p<l.length)throw new $d}return p}async ignore(i){const s=Math.min(Jde,i),l=new Uint8Array(s);let p=0;for(;p<i;){const _=i-p,b=await this.readBuffer(l,{length:Math.min(s,_)});if(b<0)return b;p+=b}return p}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class efe extends yk{constructor(i,s){super(s),this.uint8Array=i,this.fileInfo={...s?.fileInfo??{},size:i.length}}async readBuffer(i,s){s?.position&&(this.position=s.position);const l=await this.peekBuffer(i,s);return this.position+=l,l}async peekBuffer(i,s){const l=this.normalizeOptions(i,s),p=Math.min(this.uint8Array.length-l.position,l.length);if(!l.mayBeLess&&p<l.length)throw new $d;return i.set(this.uint8Array.subarray(l.position,l.position+p)),p}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(i){this.position=i}}class tfe extends yk{constructor(i,s){super(s),this.blob=i,this.fileInfo={...s?.fileInfo??{},size:i.size,mimeType:i.type}}async readBuffer(i,s){s?.position&&(this.position=s.position);const l=await this.peekBuffer(i,s);return this.position+=l,l}async peekBuffer(i,s){const l=this.normalizeOptions(i,s),p=Math.min(this.blob.size-l.position,l.length);if(!l.mayBeLess&&p<l.length)throw new $d;const _=await this.blob.slice(l.position,l.position+p).arrayBuffer();return i.set(new Uint8Array(_)),p}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(i){this.position=i}}function ife(e,i){const s=Kde(e),l=i??{},p=l.onClose;return l.onClose=async()=>{if(await s.close(),p)return p()},new Qde(s,l)}function nfe(e,i){return new efe(e,i)}function rfe(e,i){return new tfe(e,i)}var _S={exports:{}},dA,bF;function sfe(){if(bF)return dA;bF=1;var e=1e3,i=e*60,s=i*60,l=s*24,p=l*7,_=l*365.25;dA=function(F,$){$=$||{};var W=typeof F;if(W==="string"&&F.length>0)return b(F);if(W==="number"&&isFinite(F))return $.long?P(F):t(F);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(F))};function b(F){if(F=String(F),!(F.length>100)){var $=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(F);if($){var W=parseFloat($[1]),Y=($[2]||"ms").toLowerCase();switch(Y){case"years":case"year":case"yrs":case"yr":case"y":return W*_;case"weeks":case"week":case"w":return W*p;case"days":case"day":case"d":return W*l;case"hours":case"hour":case"hrs":case"hr":case"h":return W*s;case"minutes":case"minute":case"mins":case"min":case"m":return W*i;case"seconds":case"second":case"secs":case"sec":case"s":return W*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return W;default:return}}}}function t(F){var $=Math.abs(F);return $>=l?Math.round(F/l)+"d":$>=s?Math.round(F/s)+"h":$>=i?Math.round(F/i)+"m":$>=e?Math.round(F/e)+"s":F+"ms"}function P(F){var $=Math.abs(F);return $>=l?O(F,$,l,"day"):$>=s?O(F,$,s,"hour"):$>=i?O(F,$,i,"minute"):$>=e?O(F,$,e,"second"):F+" ms"}function O(F,$,W,Y){var ae=$>=W*1.5;return Math.round(F/W)+" "+Y+(ae?"s":"")}return dA}var fA,wF;function ofe(){if(wF)return fA;wF=1;function e(i){l.debug=l,l.default=l,l.coerce=O,l.disable=t,l.enable=_,l.enabled=P,l.humanize=sfe(),l.destroy=F,Object.keys(i).forEach($=>{l[$]=i[$]}),l.names=[],l.skips=[],l.formatters={};function s($){let W=0;for(let Y=0;Y<$.length;Y++)W=(W<<5)-W+$.charCodeAt(Y),W|=0;return l.colors[Math.abs(W)%l.colors.length]}l.selectColor=s;function l($){let W,Y=null,ae,se;function ie(...pe){if(!ie.enabled)return;const ye=ie,de=Number(new Date),Ee=de-(W||de);ye.diff=Ee,ye.prev=W,ye.curr=de,W=de,pe[0]=l.coerce(pe[0]),typeof pe[0]!="string"&&pe.unshift("%O");let Pe=0;pe[0]=pe[0].replace(/%([a-zA-Z%])/g,(We,je)=>{if(We==="%%")return"%";Pe++;const Ye=l.formatters[je];if(typeof Ye=="function"){const ct=pe[Pe];We=Ye.call(ye,ct),pe.splice(Pe,1),Pe--}return We}),l.formatArgs.call(ye,pe),(ye.log||l.log).apply(ye,pe)}return ie.namespace=$,ie.useColors=l.useColors(),ie.color=l.selectColor($),ie.extend=p,ie.destroy=l.destroy,Object.defineProperty(ie,"enabled",{enumerable:!0,configurable:!1,get:()=>Y!==null?Y:(ae!==l.namespaces&&(ae=l.namespaces,se=l.enabled($)),se),set:pe=>{Y=pe}}),typeof l.init=="function"&&l.init(ie),ie}function p($,W){const Y=l(this.namespace+(typeof W>"u"?":":W)+$);return Y.log=this.log,Y}function _($){l.save($),l.namespaces=$,l.names=[],l.skips=[];const W=(typeof $=="string"?$:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const Y of W)Y[0]==="-"?l.skips.push(Y.slice(1)):l.names.push(Y)}function b($,W){let Y=0,ae=0,se=-1,ie=0;for(;Y<$.length;)if(ae<W.length&&(W[ae]===$[Y]||W[ae]==="*"))W[ae]==="*"?(se=ae,ie=Y,ae++):(Y++,ae++);else if(se!==-1)ae=se+1,ie++,Y=ie;else return!1;for(;ae<W.length&&W[ae]==="*";)ae++;return ae===W.length}function t(){const $=[...l.names,...l.skips.map(W=>"-"+W)].join(",");return l.enable(""),$}function P($){for(const W of l.skips)if(b($,W))return!1;for(const W of l.names)if(b($,W))return!0;return!1}function O($){return $ instanceof Error?$.stack||$.message:$}function F(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return l.enable(l.load()),l}return fA=e,fA}var TF;function afe(){return TF||(TF=1,(function(e,i){var s={};i.formatArgs=p,i.save=_,i.load=b,i.useColors=l,i.storage=t(),i.destroy=(()=>{let O=!1;return()=>{O||(O=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function l(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let O;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(O=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(O[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function p(O){if(O[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+O[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const F="color: "+this.color;O.splice(1,0,F,"color: inherit");let $=0,W=0;O[0].replace(/%[a-zA-Z%]/g,Y=>{Y!=="%%"&&($++,Y==="%c"&&(W=$))}),O.splice(W,0,F)}i.log=console.debug||console.log||(()=>{});function _(O){try{O?i.storage.setItem("debug",O):i.storage.removeItem("debug")}catch{}}function b(){let O;try{O=i.storage.getItem("debug")||i.storage.getItem("DEBUG")}catch{}return!O&&typeof process<"u"&&"env"in process&&(O=s.DEBUG),O}function t(){try{return localStorage}catch{}}e.exports=ofe()(i);const{formatters:P}=e.exports;P.j=function(O){try{return JSON.stringify(O)}catch(F){return"[UnexpectedJSONParseError]: "+F.message}}})(_S,_S.exports)),_S.exports}var lfe=afe();const cfe=Uf(lfe),Ox={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256},SF={get(e){return{signature:Tu.get(e,0),compressedSize:Tu.get(e,8),uncompressedSize:Tu.get(e,12)}},len:16},ufe={get(e){const i=vc.get(e,6);return{signature:Tu.get(e,0),minVersion:vc.get(e,4),dataDescriptor:!!(i&8),compressedMethod:vc.get(e,8),compressedSize:Tu.get(e,18),uncompressedSize:Tu.get(e,22),filenameLength:vc.get(e,26),extraFieldLength:vc.get(e,28),filename:null}},len:30},hfe={get(e){return{signature:Tu.get(e,0),nrOfThisDisk:vc.get(e,4),nrOfThisDiskWithTheStart:vc.get(e,6),nrOfEntriesOnThisDisk:vc.get(e,8),nrOfEntriesOfSize:vc.get(e,10),sizeOfCd:Tu.get(e,12),offsetOfStartOfCd:Tu.get(e,16),zipFileCommentLength:vc.get(e,20)}},len:22},dfe={get(e){const i=vc.get(e,8);return{signature:Tu.get(e,0),minVersion:vc.get(e,6),dataDescriptor:!!(i&8),compressedMethod:vc.get(e,10),compressedSize:Tu.get(e,20),uncompressedSize:Tu.get(e,24),filenameLength:vc.get(e,28),extraFieldLength:vc.get(e,30),fileCommentLength:vc.get(e,32),relativeOffsetOfLocalHeader:Tu.get(e,42),filename:null}},len:46};function Ij(e){const i=new Uint8Array(Tu.len);return Tu.put(i,0,e),i}const bg=cfe("tokenizer:inflate"),pA=256*1024,ffe=Ij(Ox.DataDescriptor),yS=Ij(Ox.EndOfCentralDirectory);class vk{constructor(i){this.tokenizer=i,this.syncBuffer=new Uint8Array(pA)}async isZip(){return await this.peekSignature()===Ox.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(Tu)}async findEndOfCentralDirectoryLocator(){const i=this.tokenizer,s=Math.min(16*1024,i.fileInfo.size),l=this.syncBuffer.subarray(0,s);await this.tokenizer.readBuffer(l,{position:i.fileInfo.size-s});for(let p=l.length-4;p>=0;p--)if(l[p]===yS[0]&&l[p+1]===yS[1]&&l[p+2]===yS[2]&&l[p+3]===yS[3])return i.fileInfo.size-s+p;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){bg("Cannot reading central-directory without random-read support");return}bg("Reading central-directory...");const i=this.tokenizer.position,s=await this.findEndOfCentralDirectoryLocator();if(s>0){bg("Central-directory 32-bit signature found");const l=await this.tokenizer.readToken(hfe,s),p=[];this.tokenizer.setPosition(l.offsetOfStartOfCd);for(let _=0;_<l.nrOfEntriesOfSize;++_){const b=await this.tokenizer.readToken(dfe);if(b.signature!==Ox.CentralFileHeader)throw new Error("Expected Central-File-Header signature");b.filename=await this.tokenizer.readToken(new B_(b.filenameLength,"utf-8")),await this.tokenizer.ignore(b.extraFieldLength),await this.tokenizer.ignore(b.fileCommentLength),p.push(b),bg(`Add central-directory file-entry: n=${_+1}/${p.length}: filename=${p[_].filename}`)}return this.tokenizer.setPosition(i),p}this.tokenizer.setPosition(i)}async unzip(i){const s=await this.readCentralDirectory();if(s)return this.iterateOverCentralDirectory(s,i);let l=!1;do{const p=await this.readLocalFileHeader();if(!p)break;const _=i(p);l=!!_.stop;let b;if(await this.tokenizer.ignore(p.extraFieldLength),p.dataDescriptor&&p.compressedSize===0){const t=[];let P=pA;bg("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let O=-1;for(;O<0&&P===pA;){P=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),O=pfe(this.syncBuffer.subarray(0,P),ffe);const F=O>=0?O:P;if(_.handler){const $=new Uint8Array(F);await this.tokenizer.readBuffer($),t.push($)}else await this.tokenizer.ignore(F)}bg(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),_.handler&&await this.inflate(p,mfe(t),_.handler)}else _.handler?(bg(`Reading compressed-file-data: ${p.compressedSize} bytes`),b=new Uint8Array(p.compressedSize),await this.tokenizer.readBuffer(b),await this.inflate(p,b,_.handler)):(bg(`Ignoring compressed-file-data: ${p.compressedSize} bytes`),await this.tokenizer.ignore(p.compressedSize));if(bg(`Reading data-descriptor at pos=${this.tokenizer.position}`),p.dataDescriptor&&(await this.tokenizer.readToken(SF)).signature!==134695760)throw new Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-SF.len}`)}while(!l)}async iterateOverCentralDirectory(i,s){for(const l of i){const p=s(l);if(p.handler){this.tokenizer.setPosition(l.relativeOffsetOfLocalHeader);const _=await this.readLocalFileHeader();if(_){await this.tokenizer.ignore(_.extraFieldLength);const b=new Uint8Array(l.compressedSize);await this.tokenizer.readBuffer(b),await this.inflate(_,b,p.handler)}}if(p.stop)break}}async inflate(i,s,l){if(i.compressedMethod===0)return l(s);if(i.compressedMethod!==8)throw new Error(`Unsupported ZIP compression method: ${i.compressedMethod}`);bg(`Decompress filename=${i.filename}, compressed-size=${s.length}`);const p=await vk.decompressDeflateRaw(s);return l(p)}static async decompressDeflateRaw(i){const s=new ReadableStream({start(_){_.enqueue(i),_.close()}}),l=new DecompressionStream("deflate-raw"),p=s.pipeThrough(l);try{const b=await new Response(p).arrayBuffer();return new Uint8Array(b)}catch(_){const b=_ instanceof Error?`Failed to deflate ZIP entry: ${_.message}`:"Unknown decompression error in ZIP entry";throw new TypeError(b)}}async readLocalFileHeader(){const i=await this.tokenizer.peekToken(Tu);if(i===Ox.LocalFileHeader){const s=await this.tokenizer.readToken(ufe);return s.filename=await this.tokenizer.readToken(new B_(s.filenameLength,"utf-8")),s}if(i===Ox.CentralFileHeader)return!1;throw i===3759263696?new Error("Encrypted ZIP"):new Error("Unexpected signature")}}function pfe(e,i){const s=e.length,l=i.length;if(l>s)return-1;for(let p=0;p<=s-l;p++){let _=!0;for(let b=0;b<l;b++)if(e[p+b]!==i[b]){_=!1;break}if(_)return p}return-1}function mfe(e){const i=e.reduce((p,_)=>p+_.length,0),s=new Uint8Array(i);let l=0;for(const p of e)s.set(p,l),l+=p.length;return s}class gfe{constructor(i){this.tokenizer=i}inflate(){const i=this.tokenizer;return new ReadableStream({async pull(s){const l=new Uint8Array(1024),p=await i.readBuffer(l,{mayBeLess:!0});if(p===0){s.close();return}s.enqueue(l.subarray(0,p))}}).pipeThrough(new DecompressionStream("gzip"))}}new globalThis.TextDecoder("utf8");new globalThis.TextEncoder;Array.from({length:256},(e,i)=>i.toString(16).padStart(2,"0"));function EF(e){const{byteLength:i}=e;if(i===6)return e.getUint16(0)*2**32+e.getUint32(2);if(i===5)return e.getUint8(0)*2**32+e.getUint32(1);if(i===4)return e.getUint32(0);if(i===3)return e.getUint8(0)*2**16+e.getUint16(1);if(i===2)return e.getUint16(0);if(i===1)return e.getUint8(0)}function _fe(e,i){if(i==="utf-16le"){const s=[];for(let l=0;l<e.length;l++){const p=e.charCodeAt(l);s.push(p&255,p>>8&255)}return s}if(i==="utf-16be"){const s=[];for(let l=0;l<e.length;l++){const p=e.charCodeAt(l);s.push(p>>8&255,p&255)}return s}return[...e].map(s=>s.charCodeAt(0))}function yfe(e,i=0){const s=Number.parseInt(new B_(6).get(e,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(s))return!1;let l=256;for(let p=i;p<i+148;p++)l+=e[p];for(let p=i+156;p<i+512;p++)l+=e[p];return s===l}const vfe={get:(e,i)=>e[i+3]&127|e[i+2]<<7|e[i+1]<<14|e[i]<<21,len:4},xfe=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","jmp","rm","sav","ppsm","ppsx","tar.gz","reg","dat"],bfe=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia","application/x-spss-sav","application/x-ms-regedit","application/x-ft-windows-registry-hive","application/x-jmp-data"],mA=4100;async function wfe(e,i){return new Tfe(i).fromBlob(e)}function gA(e){switch(e=e.toLowerCase(),e){case"application/epub+zip":return{ext:"epub",mime:e};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:e};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:e};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:e};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:e};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:e};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:e};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:e};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:e};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:e};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:e};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:e};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:e};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:e};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:e};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:e};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"}}}function wg(e,i,s){s={offset:0,...s};for(const[l,p]of i.entries())if(s.mask){if(p!==(s.mask[l]&e[l+s.offset]))return!1}else if(p!==e[l+s.offset])return!1;return!0}class Tfe{constructor(i){this.options={mpegOffsetTolerance:0,...i},this.detectors=[...i?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:i?.signal}}async fromTokenizer(i){const s=i.position;for(const l of this.detectors){const p=await l.detect(i);if(p)return p;if(s!==i.position)return}}async fromBuffer(i){if(!(i instanceof Uint8Array||i instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof i}\``);const s=i instanceof Uint8Array?i:new Uint8Array(i);if(s?.length>1)return this.fromTokenizer(nfe(s,this.tokenizerOptions))}async fromBlob(i){const s=rfe(i,this.tokenizerOptions);try{return await this.fromTokenizer(s)}finally{await s.close()}}async fromStream(i){const s=ife(i,this.tokenizerOptions);try{return await this.fromTokenizer(s)}finally{await s.close()}}async toDetectionStream(i,s){const{sampleSize:l=mA}=s;let p,_;const b=i.getReader({mode:"byob"});try{const{value:O,done:F}=await b.read(new Uint8Array(l));if(_=O,!F&&O)try{p=await this.fromBuffer(O.subarray(0,l))}catch($){if(!($ instanceof $d))throw $;p=void 0}_=O}finally{b.releaseLock()}const t=new TransformStream({async start(O){O.enqueue(_)},transform(O,F){F.enqueue(O)}}),P=i.pipeThrough(t);return P.fileType=p,P}check(i,s){return wg(this.buffer,i,s)}checkString(i,s){return this.check(_fe(i,s?.encoding),s)}detectConfident=async i=>{if(this.buffer=new Uint8Array(mA),i.fileInfo.size===void 0&&(i.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=i,await i.peekBuffer(this.buffer,{length:32,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await i.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(i);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8])){const l=new gfe(i).inflate();let p=!0;try{let _;try{_=await this.fromStream(l)}catch{p=!1}if(_&&_.ext==="tar")return{ext:"tar.gz",mime:"application/gzip"}}finally{p&&await l.cancel()}return{ext:"gz",mime:"application/gzip"}}if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await i.ignore(6);const s=await i.readToken(vfe);return i.position+s>i.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await i.ignore(s),this.fromTokenizer(i))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let s;return await new vk(i).unzip(l=>{switch(l.filename){case"META-INF/mozilla.rsa":return s={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return s={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(p){const _=new TextDecoder("utf-8").decode(p).trim();s=gA(_)},stop:!0};case"[Content_Types].xml":return{async handler(p){let _=new TextDecoder("utf-8").decode(p);const b=_.indexOf('.main+xml"');if(b===-1){const t="application/vnd.ms-package.3dmanufacturing-3dmodel+xml";_.includes(`ContentType="${t}"`)&&(s=gA(t))}else{_=_.slice(0,Math.max(0,b));const t=_.lastIndexOf('"'),P=_.slice(Math.max(0,t+1));s=gA(P)}},stop:!0};default:return/classes\d*\.dex/.test(l.filename)?(s={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0}):{}}}).catch(l=>{if(!(l instanceof $d))throw l}),s??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await i.ignore(28);const s=new Uint8Array(8);return await i.readBuffer(s),wg(s,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:wg(s,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:wg(s,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:wg(s,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:wg(s,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:wg(s,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const s=await this.readTiffHeader(!1);if(s)return s}if(this.check([77,77])){const s=await this.readTiffHeader(!0);if(s)return s}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function s(){const t=await i.peekNumber($de);let P=128,O=0;for(;(t&P)===0&&P!==0;)++O,P>>=1;const F=new Uint8Array(O+1);return await i.readBuffer(F),F}async function l(){const t=await s(),P=await s();P[0]^=128>>P.length-1;const O=Math.min(6,P.length),F=new DataView(t.buffer),$=new DataView(P.buffer,P.length-O,O);return{id:EF(F),len:EF($)}}async function p(t){for(;t>0;){const P=await l();if(P.id===17026)return(await i.readToken(new B_(P.len))).replaceAll(/\00.*$/g,"");await i.ignore(P.len),--t}}const _=await l();switch(await p(_.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.checkString("regf"))return{ext:"dat",mime:"application/x-ft-windows-registry-hive"};if(this.checkString("$FL2")||this.checkString("$FL3"))return{ext:"sav",mime:"application/x-spss-sav"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const s=new B_(4,"latin1").get(this.buffer,2);if(s.match("^d*")&&s>=1e3&&s<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await i.ignore(8),await i.readToken(new B_(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("WEBVTT")&&[`
`,"\r","	"," ","\0"].some(s=>this.checkString(s,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await i.ignore(8);async function s(){return{length:await i.readToken(qde),type:await i.readToken(new B_(4,"latin1"))}}do{const l=await s();if(l.length<0)return;switch(l.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await i.ignore(l.length+4)}}while(i.position+8<i.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){const s=new B_(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(s){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return s.startsWith("3g")?s.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString(`REGEDIT4\r
`))return{ext:"reg",mime:"application/x-ms-regedit"};if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function s(){const l=new Uint8Array(16);return await i.readBuffer(l),{id:l,size:Number(await i.readToken(Hde))}}for(await i.ignore(30);i.position+24<i.fileInfo.size;){const l=await s();let p=l.size-24;if(wg(l.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const _=new Uint8Array(16);if(p-=await i.readBuffer(_),wg(_,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(wg(_,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await i.ignore(p)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await i.ignore(20),await i.readToken(new B_(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.checkString("<?xml ",{offset:2,encoding:"utf-16be"})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await i.peekBuffer(this.buffer,{length:Math.min(256,i.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const s=new DataView(this.buffer.buffer).getUint32(12,!0);if(s>12&&this.buffer.length>=s+16)try{const l=new TextDecoder().decode(this.buffer.subarray(16,s+16));if(JSON.parse(l).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(this.check([255,255,0,0,7,0,0,0,4,0,0,0,1,0,1,0])||this.check([0,0,255,255,0,0,0,7,0,0,0,4,0,1,0,1]))return{ext:"jmp",mime:"application/x-jmp-data"};if(await i.peekBuffer(this.buffer,{length:Math.min(512,i.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\0",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&yfe(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254])){const s="utf-16le";return this.checkString("<?xml ",{offset:2,encoding:s})?{ext:"xml",mime:"application/xml"}:this.check([255,14],{offset:2})&&this.checkString("SketchUp Model",{offset:4,encoding:s})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:this.checkString(`Windows Registry Editor Version 5.00\r
`,{offset:2,encoding:s})?{ext:"reg",mime:"application/x-ms-regedit"}:void 0}if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"}};detectImprecise=async i=>{if(this.buffer=new Uint8Array(mA),await i.peekBuffer(this.buffer,{length:Math.min(8,i.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await i.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,i.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let s=0;s<=this.options.mpegOffsetTolerance;++s){const l=this.scanMpeg(s);if(l)return l}};async readTiffTag(i){const s=await this.tokenizer.readToken(i?K1:vc);switch(this.tokenizer.ignore(10),s){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(i){const s=await this.tokenizer.readToken(i?K1:vc);for(let l=0;l<s;++l){const p=await this.readTiffTag(i);if(p)return p}}async readTiffHeader(i){const s=(i?K1:vc).get(this.buffer,2),l=(i?Gde:Tu).get(this.buffer,4);if(s===42){if(l>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(l>=8){const _=(i?K1:vc).get(this.buffer,8),b=(i?K1:vc).get(this.buffer,10);if(_===28&&b===254||_===31&&b===11)return{ext:"nef",mime:"image/x-nikon-nef"}}}return await this.tokenizer.ignore(l),await this.readTiffIFD(i)??{ext:"tif",mime:"image/tiff"}}if(s===43)return{ext:"tif",mime:"image/tiff"}}scanMpeg(i){if(this.check([255,224],{offset:i,mask:[255,224]})){if(this.check([16],{offset:i+1,mask:[22]}))return this.check([8],{offset:i+1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:i+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:i+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:i+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}new Set(xfe);new Set(bfe);class Sfe{capacity;storage=new Map;onEvict;constructor(i=10,s){this.capacity=Math.max(1,i),this.onEvict=s}get(i){const s=this.storage.get(i);if(s!==void 0)return this.storage.delete(i),this.storage.set(i,s),s}set(i,s){if(this.storage.has(i)){const l=this.storage.get(i);this.executeCleanup(l,i,`: ${String(i)}`),this.storage.delete(i)}else this.ensureCapacity();this.storage.set(i,s),this.logCacheOperation("",i)}delete(i){const s=this.storage.get(i);return s===void 0?!1:(this.executeCleanup(s,i,`: ${String(i)}`),this.storage.delete(i))}has(i){return this.storage.has(i)}clear(){const i=this.storage.size;for(const[s,l]of this.storage.entries())this.executeCleanup(l,s,`: ${String(s)}`);this.storage.clear(),console.info(` ${i} `)}size(){return this.storage.size}getStats(){return{size:this.storage.size,maxSize:this.capacity,keys:[...this.storage.keys()]}}values(){return this.storage.values()}entries(){return this.storage.entries()}ensureCapacity(){for(;this.storage.size>=this.capacity;){const i=this.storage.keys().next().value;if(i!==void 0){const s=this.storage.get(i);this.executeCleanup(s,i,`: ${String(i)}`),this.storage.delete(i)}}}executeCleanup(i,s,l){if(this.onEvict)try{this.onEvict(i,s,l)}catch(p){console.warn(` (${l}):`,p)}}logCacheOperation(i,s){console.info(`LRU : ${i} ${String(s)}: ${this.storage.size}/${this.capacity}`)}}const IF=new Sfe(6,(e,i,s)=>{try{URL.revokeObjectURL(e.blobSrc),console.log(` Blob URL - ${i} (${s})`)}catch(l){console.warn(`Blob URL  (${i}):`,l)}});class Efe{lastXHR=null;timer=null;async isValidImageBlob(i){if(i.size===0)return!1;try{const s=await wfe(i);return!(!s||!s.mime.startsWith("image/"))}catch{return!1}}async loadImage(i,s={}){const{onProgress:l,onError:p,onUpdateLoadingState:_}=s;return _?.({isVisible:!0}),new Promise((b,t)=>{this.timer=setTimeout(async()=>{const P=new XMLHttpRequest;P.open("GET",i),P.responseType="blob",P.onload=async()=>{if(P.status===200)try{const O=P.response;if(!await this.isValidImageBlob(O)){p?.(),_?.({isVisible:!1});return}const F=await this.processNormalImage(O,i,s);b(F)}catch(O){p?.(),_?.({isVisible:!1}),t(O)}else p?.(),_?.({isVisible:!1}),t(new Error(`Failed to load image: ${P.status}`))},P.onprogress=O=>{if(O.lengthComputable){const F=O.loaded/O.total*100;l?.(F),_?.({progress:F,bytesLoaded:O.loaded,bytesTotal:O.total})}},P.onerror=()=>{p?.(),_?.({isVisible:!1}),t(new Error("Failed to load image"))},P.send(),this.lastXHR=P},300)})}async processNormalImage(i,s,l){const{onUpdateLoadingState:p}=l,_=s,b=IF.get(_);if(b)return p?.({isVisible:!1}),{blobSrc:b.blobSrc};const P={blobSrc:URL.createObjectURL(i),originalSize:i.size,format:i.type};return IF.set(_,P),p?.({isVisible:!1}),{blobSrc:s}}cleanup(){this.lastXHR&&(this.lastXHR.abort(),this.lastXHR=null),this.timer&&(clearTimeout(this.timer),this.timer=null)}}const Ife=(e,i,s,l,p,_,b,t,P,O,F,$)=>{if(s||!i||l)return null;const W=new Efe,Y=()=>{W.cleanup(),t?.(null),F?.(!1),P?.(!1),O?.(!1)},ae=async()=>{try{const se=await W.loadImage(e,{onProgress:_,onError:b,onUpdateLoadingState:ie=>{p?.updateLoadingState(ie)}});t?.(se.blobSrc),P?.(!0),$?.()}catch{O?.(!0),p?.updateLoadingState({isVisible:!0,isError:!0,message:""})}};return Y(),ae(),W},Cfe=e=>{const{t:i}=h0();return(s,l,p)=>{let _="";l===Ig.TEXTURE_LOADING?_=i("viewer.photoload.loadingTexture"):l===Ig.IMAGE_LOADING&&(_=i("viewer.photoload.loading")),e?.updateLoadingState({isVisible:s,isWebGLLoading:s,webglMessage:_,webglQuality:p})}},Afe={key:2,class:"flex flex-col items-center justify-center text-white/70 gap-2"},Pfe=kr({__name:"ProgressiveImage",props:{src:{},thumbnailSrc:{default:""},thumbhash:{default:null},alt:{default:"Image"},width:{default:void 0},height:{default:void 0},className:{default:""},enablePan:{type:Boolean,default:!0},enableZoom:{type:Boolean,default:!0},isCurrentImage:{type:Boolean,default:!0},loadingIndicatorRef:{},onProgress:{type:Function,default:void 0},onError:{type:Function,default:void 0},onZoomChange:{type:Function,default:void 0},onBlobSrcChange:{type:Function,default:void 0},onImageLoaded:{type:Function,default:void 0},isLivePhoto:{type:Boolean,default:!1},livePhotoVideoUrl:{default:""},isHDR:{type:Boolean,default:!1}},setup(e){const i=e,s=an(),l=an(!1),p=an(!1),_=an(!1),b=an(),t=Ei(()=>!1),P=Ei(()=>t.value&&!1),O=an(),F=an(null),$=Ei(()=>i.thumbnailSrc&&(!p.value||_.value)),W=Ei(()=>l.value&&b.value&&i.isCurrentImage&&!_.value),Y=()=>{F.value=Ife(i.src,i.isCurrentImage,l.value,_.value,i.loadingIndicatorRef,i.onProgress,i.onError,ie=>b.value=ie,ie=>l.value=ie,ie=>_.value=ie,ie=>p.value=ie,i.onImageLoaded)};Qn(()=>i.isCurrentImage,(ie,pe)=>{!ie&&pe?(F.value?.cleanup(),F.value=null):ie&&!pe&&!l.value&&!_.value&&Y()},{immediate:!1}),Qn(()=>i.src,(ie,pe)=>{ie!==pe&&(F.value?.cleanup(),F.value=null,l.value=!1,p.value=!1,_.value=!1,b.value=null,i.isCurrentImage&&Y())},{immediate:!1}),Y();const ae=Cfe(i.loadingIndicatorRef),se=(ie,pe)=>{const ye=pe>1.1;i.onZoomChange&&i.onZoomChange(ye,Math.round(ie*10)/10)};return ru(()=>{F.value?.cleanup(),F.value=null}),(ie,pe)=>{const ye=zde,de=Wd;return li(),ir("div",{ref_key:"containerRef",ref:s,class:"relative w-full h-full flex items-center justify-center"},[ut($)?(li(),En(ye,{key:0,src:e.thumbnailSrc,thumbhash:e.thumbhash,alt:e.alt,class:"absolute inset-0 w-full h-full object-contain","thumbhash-class":"opacity-50","image-contain":""},null,8,["src","thumbhash","alt"])):gr("",!0),ut(W)?(li(),En(ut(z6),{key:1,ref_key:"webglViewerRef",ref:O,src:ut(b),class:_s([e.className,"w-full h-full"]),width:e.width,height:e.height,"center-on-init":!0,"limit-to-bounds":!0,smooth:!0,"min-scale":1,"max-scale":12,wheel:{step:.2,wheelDisabled:!1,touchPadDisabled:!1},pinch:{step:.2},"double-click":{mode:"toggle",step:2.4,animationTime:400},panning:{velocityDisabled:!1},debug:ut(P),onZoomChange:se,onLoadingStateChange:ut(ae)},null,8,["src","class","width","height","debug","onLoadingStateChange"])):gr("",!0),ut(_)?(li(),ir("div",Afe,[tr(de,{name:"tabler:photo-off",class:"w-12 h-12"}),pe[0]||(pe[0]=Bn("p",{class:"text-sm"},"",-1))])):gr("",!0)],512)}}}),Mfe=Object.assign(Pfe,{__name:"PhotoProgressiveImage"}),kfe=["onClick"],Dfe=["src","alt"],Lfe={key:2,class:"absolute inset-0 w-full h-full bg-gray-700 flex items-center justify-center"},Rfe=kr({__name:"GalleryThumbnail",props:{photos:{},currentIndex:{}},emits:["indexChange"],setup(e,{emit:i}){const s=e,l=i,p=an(),_=an(0),b=jM("(max-width: 768px)"),t={size:{sm:48,lg:64},gap:{sm:8,lg:12},padding:{sm:12,lg:16}},P=Ei(()=>b.value?t.size.sm:t.size.lg),O=Ei(()=>b.value?t.gap.sm:t.gap.lg),F=Ei(()=>b.value?t.padding.sm:t.padding.lg),$=Ei(()=>s.photos.map((ie,pe)=>({...ie,index:pe,isActive:pe===s.currentIndex}))),W=ie=>{l("indexChange",ie)},Y=()=>{p.value&&(_.value=p.value.clientWidth)},ae=async()=>{if(!p.value)return;await Da();const ie=_.value,pe=P.value,ye=O.value,Ee=s.currentIndex*pe+ye*s.currentIndex-ie/2+pe/2;p.value.scrollTo({left:Ee,behavior:"smooth"})},se=ie=>{if(!p.value)return;ie.preventDefault();const pe=Math.abs(ie.deltaX)>Math.abs(ie.deltaY)?ie.deltaX:ie.deltaY;p.value.scrollLeft+=pe};return La(()=>{if(Y(),p.value){const ie=new ResizeObserver(Y);ie.observe(p.value),p.value.addEventListener("wheel",se,{passive:!1}),ru(()=>{ie.disconnect(),p.value&&p.value.removeEventListener("wheel",se)})}setTimeout(()=>{ae()},500)}),Qn(()=>s.currentIndex,(ie,pe)=>{ae()},{immediate:!0}),Qn(b,ae),(ie,pe)=>{const ye=RM,de=Wd;return li(),En(ut(Gl).div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{type:"spring",duration:.4,bounce:0,delay:.1},class:"gallery-thumbnail-container bg-black/20 dark:bg-black/30 backdrop-blur-xl border-t border-white/10 shrink-0 z-10"},{default:Jn(()=>[Bn("div",{ref_key:"galleryScrollContainer",ref:p,class:"gallery-scroll-area overflow-x-auto scrollbar-none flex",style:Su({gap:`${O.value}px`,padding:`${F.value}px`})},[(li(!0),ir(qs,null,Eu($.value,Ee=>(li(),ir("button",{key:Ee.id,type:"button",class:_s(["thumbnail-item relative flex-shrink-0 rounded-lg overflow-hidden border-2 transition-all duration-200 contain-intrinsic-size",{"thumbnail-active border-white shadow-lg scale-110":Ee.isActive,"thumbnail-inactive border-white/20 hover:border-white/40 grayscale-50 hover:grayscale-0":!Ee.isActive}]),style:Su({width:`${P.value}px`,height:`${P.value}px`}),onClick:Pe=>W(Ee.index)},[Ee.thumbnailHash?(li(),En(ye,{key:0,thumbhash:Ee.thumbnailHash,class:"absolute inset-0 w-full h-full"},null,8,["thumbhash"])):gr("",!0),Ee.thumbnailUrl?(li(),ir("img",{key:1,src:Ee.thumbnailUrl,alt:Ee.title||"Photo thumbnail",class:"absolute inset-0 w-full h-full object-cover",loading:"lazy"},null,8,Dfe)):Ee.thumbnailHash?gr("",!0):(li(),ir("div",Lfe,[tr(de,{name:"tabler:photo",class:"w-6 h-6 text-gray-400"})]))],14,kfe))),128))],4)]),_:1})}}}),d0=(e,i)=>{const s=e.__vccOpts||e;for(const[l,p]of i)s[l]=p;return s},zfe=Object.assign(d0(Rfe,[["__scopeId","data-v-e12e3d31"]]),{__name:"PhotoGalleryThumbnail"});var HS={exports:{}};var Ofe=HS.exports,CF;function Ffe(){return CF||(CF=1,(function(e,i){(function(s,l){e.exports=l()})(Ofe,(function(){var s={},l={};function p(b,t,P){if(l[b]=P,b==="index"){var O="var sharedModule = {}; ("+l.shared+")(sharedModule); ("+l.worker+")(sharedModule);",F={};return l.shared(F),l.index(s,F),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),s}}p("shared",["exports"],(function(b){function t(m,c,f,T){return new(f||(f=Promise))((function(C,R){function z(re){try{X(T.next(re))}catch(ue){R(ue)}}function U(re){try{X(T.throw(re))}catch(ue){R(ue)}}function X(re){var ue;re.done?C(re.value):(ue=re.value,ue instanceof f?ue:new f((function(ve){ve(ue)}))).then(z,U)}X((T=T.apply(m,c||[])).next())}))}function P(m,c){this.x=m,this.y=c}function O(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var F,$;typeof SuppressedError=="function"&&SuppressedError,P.prototype={clone(){return new P(this.x,this.y)},add(m){return this.clone()._add(m)},sub(m){return this.clone()._sub(m)},multByPoint(m){return this.clone()._multByPoint(m)},divByPoint(m){return this.clone()._divByPoint(m)},mult(m){return this.clone()._mult(m)},div(m){return this.clone()._div(m)},rotate(m){return this.clone()._rotate(m)},rotateAround(m,c){return this.clone()._rotateAround(m,c)},matMult(m){return this.clone()._matMult(m)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(m){return this.x===m.x&&this.y===m.y},dist(m){return Math.sqrt(this.distSqr(m))},distSqr(m){const c=m.x-this.x,f=m.y-this.y;return c*c+f*f},angle(){return Math.atan2(this.y,this.x)},angleTo(m){return Math.atan2(this.y-m.y,this.x-m.x)},angleWith(m){return this.angleWithSep(m.x,m.y)},angleWithSep(m,c){return Math.atan2(this.x*c-this.y*m,this.x*m+this.y*c)},_matMult(m){const c=m[2]*this.x+m[3]*this.y;return this.x=m[0]*this.x+m[1]*this.y,this.y=c,this},_add(m){return this.x+=m.x,this.y+=m.y,this},_sub(m){return this.x-=m.x,this.y-=m.y,this},_mult(m){return this.x*=m,this.y*=m,this},_div(m){return this.x/=m,this.y/=m,this},_multByPoint(m){return this.x*=m.x,this.y*=m.y,this},_divByPoint(m){return this.x/=m.x,this.y/=m.y,this},_unit(){return this._div(this.mag()),this},_perp(){const m=this.y;return this.y=this.x,this.x=-m,this},_rotate(m){const c=Math.cos(m),f=Math.sin(m),T=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=T,this},_rotateAround(m,c){const f=Math.cos(m),T=Math.sin(m),C=c.y+T*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-T*(this.y-c.y),this.y=C,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:P},P.convert=function(m){if(m instanceof P)return m;if(Array.isArray(m))return new P(+m[0],+m[1]);if(m.x!==void 0&&m.y!==void 0)return new P(+m.x,+m.y);throw new Error("Expected [x, y] or {x, y} point format")};var W=(function(){if($)return F;function m(c,f,T,C){this.cx=3*c,this.bx=3*(T-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(C-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=f,this.p2x=T,this.p2y=C}return $=1,F=m,m.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,f){if(f===void 0&&(f=1e-6),c<0)return 0;if(c>1)return 1;for(var T=c,C=0;C<8;C++){var R=this.sampleCurveX(T)-c;if(Math.abs(R)<f)return T;var z=this.sampleCurveDerivativeX(T);if(Math.abs(z)<1e-6)break;T-=R/z}var U=0,X=1;for(T=c,C=0;C<20&&(R=this.sampleCurveX(T),!(Math.abs(R-c)<f));C++)c>R?U=T:X=T,T=.5*(X-U)+U;return T},solve:function(c,f){return this.sampleCurveY(this.solveCurveX(c,f))}},F})(),Y=O(W);let ae,se;function ie(){return ae==null&&(ae=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ae}function pe(){if(se==null&&(se=!1,ie())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let T=0;T<25;T++){const C=4*T;c.fillStyle=`rgb(${C},${C+1},${C+2})`,c.fillRect(T%5,Math.floor(T/5),1,1)}const f=c.getImageData(0,0,5,5).data;for(let T=0;T<100;T++)if(T%4!=3&&f[T]!==T){se=!0;break}}}return se||!1}var ye=1e-6,de=typeof Float32Array<"u"?Float32Array:Array;function Ee(){var m=new de(9);return de!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[5]=0,m[6]=0,m[7]=0),m[0]=1,m[4]=1,m[8]=1,m}function Pe(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function Ze(){var m=new de(3);return de!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0),m}function We(m){var c=m[0],f=m[1],T=m[2];return Math.sqrt(c*c+f*f+T*T)}function je(m,c,f){var T=new de(3);return T[0]=m,T[1]=c,T[2]=f,T}function Ye(m,c,f){return m[0]=c[0]+f[0],m[1]=c[1]+f[1],m[2]=c[2]+f[2],m}function ct(m,c,f){return m[0]=c[0]*f,m[1]=c[1]*f,m[2]=c[2]*f,m}function Lt(m,c,f){var T=c[0],C=c[1],R=c[2],z=f[0],U=f[1],X=f[2];return m[0]=C*X-R*U,m[1]=R*z-T*X,m[2]=T*U-C*z,m}var Ht,ci=We;function Wt(m,c,f){var T=c[0],C=c[1],R=c[2],z=c[3];return m[0]=f[0]*T+f[4]*C+f[8]*R+f[12]*z,m[1]=f[1]*T+f[5]*C+f[9]*R+f[13]*z,m[2]=f[2]*T+f[6]*C+f[10]*R+f[14]*z,m[3]=f[3]*T+f[7]*C+f[11]*R+f[15]*z,m}function $t(){var m=new de(4);return de!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0),m[3]=1,m}function Dt(m,c,f,T){var C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",R=Math.PI/360;c*=R,T*=R,f*=R;var z=Math.sin(c),U=Math.cos(c),X=Math.sin(f),re=Math.cos(f),ue=Math.sin(T),ve=Math.cos(T);switch(C){case"xyz":m[0]=z*re*ve+U*X*ue,m[1]=U*X*ve-z*re*ue,m[2]=U*re*ue+z*X*ve,m[3]=U*re*ve-z*X*ue;break;case"xzy":m[0]=z*re*ve-U*X*ue,m[1]=U*X*ve-z*re*ue,m[2]=U*re*ue+z*X*ve,m[3]=U*re*ve+z*X*ue;break;case"yxz":m[0]=z*re*ve+U*X*ue,m[1]=U*X*ve-z*re*ue,m[2]=U*re*ue-z*X*ve,m[3]=U*re*ve+z*X*ue;break;case"yzx":m[0]=z*re*ve+U*X*ue,m[1]=U*X*ve+z*re*ue,m[2]=U*re*ue-z*X*ve,m[3]=U*re*ve-z*X*ue;break;case"zxy":m[0]=z*re*ve-U*X*ue,m[1]=U*X*ve+z*re*ue,m[2]=U*re*ue+z*X*ve,m[3]=U*re*ve-z*X*ue;break;case"zyx":m[0]=z*re*ve-U*X*ue,m[1]=U*X*ve+z*re*ue,m[2]=U*re*ue-z*X*ve,m[3]=U*re*ve+z*X*ue;break;default:throw new Error("Unknown angle order "+C)}return m}function Ft(){var m=new de(2);return de!=Float32Array&&(m[0]=0,m[1]=0),m}function vt(m,c){var f=new de(2);return f[0]=m,f[1]=c,f}Ze(),Ht=new de(4),de!=Float32Array&&(Ht[0]=0,Ht[1]=0,Ht[2]=0,Ht[3]=0),Ze(),je(1,0,0),je(0,1,0),$t(),$t(),Ee(),Ft();const wi=8192;function Qi(m,c,f){return c*(wi/(m.tileSize*Math.pow(2,f-m.tileID.overscaledZ)))}function wn(m,c){return(m%c+c)%c}function qn(m,c,f){return m*(1-f)+c*f}function Fn(m){if(m<=0)return 0;if(m>=1)return 1;const c=m*m,f=c*m;return 4*(m<.5?f:3*(m-c)+f-.75)}function mr(m,c,f,T){const C=new Y(m,c,f,T);return R=>C.solve(R)}const Sr=mr(.25,.1,.25,1);function Hr(m,c,f){return Math.min(f,Math.max(c,m))}function ti(m,c,f){const T=f-c,C=((m-c)%T+T)%T+c;return C===c?f:C}function sn(m,...c){for(const f of c)for(const T in f)m[T]=f[T];return m}let Gi=1;function gn(m,c,f){const T={};for(const C in m)T[C]=c.call(this,m[C],C,m);return T}function nr(m,c,f){const T={};for(const C in m)c.call(this,m[C],C,m)&&(T[C]=m[C]);return T}function Ur(m){return Array.isArray(m)?m.map(Ur):typeof m=="object"&&m?gn(m,Ur):m}const St={};function Gt(m){St[m]||(typeof console<"u"&&console.warn(m),St[m]=!0)}function Ai(m,c,f){return(f.y-m.y)*(c.x-m.x)>(c.y-m.y)*(f.x-m.x)}function hn(m){return typeof WorkerGlobalScope<"u"&&m!==void 0&&m instanceof WorkerGlobalScope}let Ui=null;function pt(m){return typeof ImageBitmap<"u"&&m instanceof ImageBitmap}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function vi(m,c,f,T,C){return t(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const R=new VideoFrame(m,{timestamp:0});try{const z=R?.format;if(!z||!z.startsWith("BGR")&&!z.startsWith("RGB"))throw new Error(`Unrecognized format ${z}`);const U=z.startsWith("BGR"),X=new Uint8ClampedArray(T*C*4);if(yield R.copyTo(X,(function(re,ue,ve,Ce,Me){const ze=4*Math.max(-ue,0),Fe=(Math.max(0,ve)-ve)*Ce*4+ze,$e=4*Ce,it=Math.max(0,ue),zt=Math.max(0,ve);return{rect:{x:it,y:zt,width:Math.min(re.width,ue+Ce)-it,height:Math.min(re.height,ve+Me)-zt},layout:[{offset:Fe,stride:$e}]}})(m,c,f,T,C)),U)for(let re=0;re<X.length;re+=4){const ue=X[re];X[re]=X[re+2],X[re+2]=ue}return X}finally{R.close()}}))}let qi,on;function Hi(m,c,f,T){return m.addEventListener(c,f,T),{unsubscribe:()=>{m.removeEventListener(c,f,T)}}}function Bt(m){return m*Math.PI/180}function Ii(m){return m/Math.PI*180}const qt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ne={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ge="AbortError";class Ke extends Error{constructor(c=Ge){super(c instanceof Error?c.message:c),this.name=Ge,c instanceof Error&&c.stack&&(this.stack=c.stack)}}function At(m){return m.name===Ge}const jt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function bi(m){return jt.REGISTERED_PROTOCOLS[m.substring(0,m.indexOf("://"))]}const gi="global-dispatcher";class ii extends Error{constructor(c,f,T,C){super(`AJAXError: ${f} (${c}): ${T}`),this.status=c,this.statusText=f,this.url=T,this.body=C}}const Ci=()=>hn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,un=function(m,c){if(/:\/\//.test(m.url)&&!/^https?:|^file:/.test(m.url)){const T=bi(m.url);if(T)return T(m,c);if(hn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:m,targetMapId:gi},c)}if(!(/^file:/.test(f=m.url)||/^file:/.test(Ci())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(T,C){return t(this,void 0,void 0,(function*(){const R=new Request(T.url,{method:T.method||"GET",body:T.body,credentials:T.credentials,headers:T.headers,cache:T.cache,referrer:Ci(),signal:C.signal});let z,U;T.type!=="json"||R.headers.has("Accept")||R.headers.set("Accept","application/json");try{z=yield fetch(R)}catch(re){throw At(re)?re:new ii(0,re.message,T.url,new Blob)}if(!z.ok){const re=yield z.blob();throw new ii(z.status,z.statusText,T.url,re)}U=T.type==="arrayBuffer"||T.type==="image"?z.arrayBuffer():T.type==="json"?z.json():z.text();const X=yield U;return C.signal.throwIfAborted(),{data:X,cacheControl:z.headers.get("Cache-Control"),expires:z.headers.get("Expires")}}))})(m,c);if(hn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:m,mustQueue:!0,targetMapId:gi},c)}var f;return(function(T,C){return new Promise(((R,z)=>{var U;const X=new XMLHttpRequest;X.open(T.method||"GET",T.url,!0),T.type!=="arrayBuffer"&&T.type!=="image"||(X.responseType="arraybuffer");for(const re in T.headers)X.setRequestHeader(re,T.headers[re]);T.type==="json"&&(X.responseType="text",!((U=T.headers)===null||U===void 0)&&U.Accept||X.setRequestHeader("Accept","application/json")),X.withCredentials=T.credentials==="include",X.onerror=()=>{z(new Error(X.statusText))},X.onload=()=>{if(!C.signal.aborted)if((X.status>=200&&X.status<300||X.status===0)&&X.response!==null){let re=X.response;if(T.type==="json")try{re=JSON.parse(X.response)}catch(ue){return void z(ue)}R({data:re,cacheControl:X.getResponseHeader("Cache-Control"),expires:X.getResponseHeader("Expires")})}else{const re=new Blob([X.response],{type:X.getResponseHeader("Content-Type")});z(new ii(X.status,X.statusText,T.url,re))}},C.signal.addEventListener("abort",(()=>{X.abort(),z(new Ke(C.signal.reason))})),X.send(T.body)}))})(m,c)};function nn(m){if(!m||m.indexOf("://")<=0||m.indexOf("data:image/")===0||m.indexOf("blob:")===0)return!0;const c=new URL(m),f=window.location;return c.protocol===f.protocol&&c.host===f.host}function Zn(m,c,f){f[m]&&f[m].indexOf(c)!==-1||(f[m]=f[m]||[],f[m].push(c))}function fr(m,c,f){if(f&&f[m]){const T=f[m].indexOf(c);T!==-1&&f[m].splice(T,1)}}class Gr{constructor(c,f={}){sn(this,f),this.type=c}}class xo extends Gr{constructor(c,f={}){super("error",sn({error:c},f))}}class Js{on(c,f){return this._listeners=this._listeners||{},Zn(c,f,this._listeners),{unsubscribe:()=>{this.off(c,f)}}}off(c,f){return fr(c,f,this._listeners),fr(c,f,this._oneTimeListeners),this}once(c,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},Zn(c,f,this._oneTimeListeners),this):new Promise((T=>this.once(c,T)))}fire(c,f){typeof c=="string"&&(c=new Gr(c,f||{}));const T=c.type;if(this.listens(T)){c.target=this;const C=this._listeners&&this._listeners[T]?this._listeners[T].slice():[];for(const U of C)U.call(this,c);const R=this._oneTimeListeners&&this._oneTimeListeners[T]?this._oneTimeListeners[T].slice():[];for(const U of R)fr(T,U,this._oneTimeListeners),U.call(this,c);const z=this._eventedParent;z&&(sn(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(c))}else c instanceof xo&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,f){return this._eventedParent=c,this._eventedParentData=f,this}}var mi={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const bs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function al(m,c){const f={};for(const T in m)T!=="ref"&&(f[T]=m[T]);return bs.forEach((T=>{T in c&&(f[T]=c[T])})),f}function is(m,c){if(Array.isArray(m)){if(!Array.isArray(c)||m.length!==c.length)return!1;for(let f=0;f<m.length;f++)if(!is(m[f],c[f]))return!1;return!0}if(typeof m=="object"&&m!==null&&c!==null){if(typeof c!="object"||Object.keys(m).length!==Object.keys(c).length)return!1;for(const f in m)if(!is(m[f],c[f]))return!1;return!0}return m===c}function Hs(m,c){m.push(c)}function ll(m,c,f){Hs(f,{command:"addSource",args:[m,c[m]]})}function yi(m,c,f){Hs(c,{command:"removeSource",args:[m]}),f[m]=!0}function Ao(m,c,f,T){yi(m,f,T),ll(m,c,f)}function Bo(m,c,f){let T;for(T in m[f])if(Object.prototype.hasOwnProperty.call(m[f],T)&&T!=="data"&&!is(m[f][T],c[f][T]))return!1;for(T in c[f])if(Object.prototype.hasOwnProperty.call(c[f],T)&&T!=="data"&&!is(m[f][T],c[f][T]))return!1;return!0}function sa(m,c,f,T,C,R){m=m||{},c=c||{};for(const z in m)Object.prototype.hasOwnProperty.call(m,z)&&(is(m[z],c[z])||f.push({command:R,args:[T,z,c[z],C]}));for(const z in c)Object.prototype.hasOwnProperty.call(c,z)&&!Object.prototype.hasOwnProperty.call(m,z)&&(is(m[z],c[z])||f.push({command:R,args:[T,z,c[z],C]}))}function ns(m){return m.id}function Ja(m,c){return m[c.id]=c,m}class Mn{constructor(c,f,T,C){this.message=(c?`${c}: `:"")+T,C&&(this.identifier=C),f!=null&&f.__line__&&(this.line=f.__line__)}}function Qa(m,...c){for(const f of c)for(const T in f)m[T]=f[T];return m}class gl extends Error{constructor(c,f){super(f),this.message=f,this.key=c}}class Nt{constructor(c,f=[]){this.parent=c,this.bindings={};for(const[T,C]of f)this.bindings[T]=C}concat(c){return new Nt(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const we={kind:"null"},Ie={kind:"number"},qe={kind:"string"},ot={kind:"boolean"},ft={kind:"color"},Ct={kind:"projectionDefinition"},Jt={kind:"object"},_t={kind:"value"},Qt={kind:"collator"},Ri={kind:"formatted"},xi={kind:"padding"},yn={kind:"colorArray"},$n={kind:"numberArray"},mn={kind:"resolvedImage"},Tr={kind:"variableAnchorOffsetCollection"};function rr(m,c){return{kind:"array",itemType:m,N:c}}function jn(m){if(m.kind==="array"){const c=jn(m.itemType);return typeof m.N=="number"?`array<${c}, ${m.N}>`:m.itemType.kind==="value"?"array":`array<${c}>`}return m.kind}const Kr=[we,Ie,qe,ot,ft,Ct,Ri,Jt,rr(_t),xi,$n,yn,mn,Tr];function io(m,c){if(c.kind==="error")return null;if(m.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!io(m.itemType,c.itemType))&&(typeof m.N!="number"||m.N===c.N))return null}else{if(m.kind===c.kind)return null;if(m.kind==="value"){for(const f of Kr)if(!io(f,c))return null}}return`Expected ${jn(m)} but found ${jn(c)} instead.`}function No(m,c){return c.some((f=>f.kind===m.kind))}function oo(m,c){return c.some((f=>f==="null"?m===null:f==="array"?Array.isArray(m):f==="object"?m&&!Array.isArray(m)&&typeof m=="object":f===typeof m))}function po(m,c){return m.kind==="array"&&c.kind==="array"?m.itemType.kind===c.itemType.kind&&typeof m.N=="number":m.kind===c.kind}const go=.96422,Wr=.82521,ao=4/29,Br=6/29,qr=3*Br*Br,Po=Br*Br*Br,Ra=Math.PI/180,_l=180/Math.PI;function Hl(m){return(m%=360)<0&&(m+=360),m}function dd([m,c,f,T]){let C,R;const z=hc((.2225045*(m=wa(m))+.7168786*(c=wa(c))+.0606169*(f=wa(f)))/1);m===c&&c===f?C=R=z:(C=hc((.4360747*m+.3850649*c+.1430804*f)/go),R=hc((.0139322*m+.0971045*c+.7141733*f)/Wr));const U=116*z-16;return[U<0?0:U,500*(C-z),200*(z-R),T]}function wa(m){return m<=.04045?m/12.92:Math.pow((m+.055)/1.055,2.4)}function hc(m){return m>Po?Math.pow(m,1/3):m/qr+ao}function yl([m,c,f,T]){let C=(m+16)/116,R=isNaN(c)?C:C+c/500,z=isNaN(f)?C:C-f/200;return C=1*Ta(C),R=go*Ta(R),z=Wr*Ta(z),[su(3.1338561*R-1.6168667*C-.4906146*z),su(-.9787684*R+1.9161415*C+.033454*z),su(.0719453*R-.2289914*C+1.4052427*z),T]}function su(m){return(m=m<=.00304?12.92*m:1.055*Math.pow(m,1/2.4)-.055)<0?0:m>1?1:m}function Ta(m){return m>Br?m*m*m:qr*(m-ao)}const Zd=Object.hasOwn||function(m,c){return Object.prototype.hasOwnProperty.call(m,c)};function Xu(m,c){return Zd(m,c)?m[c]:void 0}function Xd(m){return parseInt(m.padEnd(2,m),16)/255}function Op(m,c){return Dh(c?m/100:m,0,1)}function Dh(m,c,f){return Math.min(Math.max(c,m),f)}function Yd(m){return!m.some(Number.isNaN)}const bc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ja(m,c,f){return m+f*(c-m)}function Wl(m,c,f){return m.map(((T,C)=>ja(T,c[C],f)))}class as{constructor(c,f,T,C=1,R=!0){this.r=c,this.g=f,this.b=T,this.a=C,R||(this.r*=C,this.g*=C,this.b*=C,C||this.overwriteGetter("rgb",[c,f,T,C]))}static parse(c){if(c instanceof as)return c;if(typeof c!="string")return;const f=(function(T){if((T=T.toLowerCase().trim())==="transparent")return[0,0,0,0];const C=Xu(bc,T);if(C){const[z,U,X]=C;return[z/255,U/255,X/255,1]}if(T.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(T)){const z=T.length<6?1:2;let U=1;return[Xd(T.slice(U,U+=z)),Xd(T.slice(U,U+=z)),Xd(T.slice(U,U+=z)),Xd(T.slice(U,U+z)||"ff")]}if(T.startsWith("rgb")){const z=T.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(z){const[U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it,zt]=z,lt=[ue||" ",Me||" ",$e].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const gt=[re,Ce,Fe].join(""),Vt=gt==="%%%"?100:gt===""?255:0;if(Vt){const Xt=[Dh(+X/Vt,0,1),Dh(+ve/Vt,0,1),Dh(+ze/Vt,0,1),it?Op(+it,zt):1];if(Yd(Xt))return Xt}}return}}const R=T.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(R){const[z,U,X,re,ue,ve,Ce,Me,ze]=R,Fe=[X||" ",ue||" ",Ce].join("");if(Fe==="  "||Fe==="  /"||Fe===",,"||Fe===",,,"){const $e=[+U,Dh(+re,0,100),Dh(+ve,0,100),Me?Op(+Me,ze):1];if(Yd($e))return(function([it,zt,lt,gt]){function Vt(Xt){const Mi=(Xt+it/30)%12,ln=zt*Math.min(lt,1-lt);return lt-ln*Math.max(-1,Math.min(Mi-3,9-Mi,1))}return it=Hl(it),zt/=100,lt/=100,[Vt(0),Vt(8),Vt(4),gt]})($e)}}})(c);return f?new as(...f,!1):void 0}get rgb(){const{r:c,g:f,b:T,a:C}=this,R=C||1/0;return this.overwriteGetter("rgb",[c/R,f/R,T/R,C])}get hcl(){return this.overwriteGetter("hcl",(function(c){const[f,T,C,R]=dd(c),z=Math.sqrt(T*T+C*C);return[Math.round(1e4*z)?Hl(Math.atan2(C,T)*_l):NaN,z,f,R]})(this.rgb))}get lab(){return this.overwriteGetter("lab",dd(this.rgb))}overwriteGetter(c,f){return Object.defineProperty(this,c,{value:f}),f}toString(){const[c,f,T,C]=this.rgb;return`rgba(${[c,f,T].map((R=>Math.round(255*R))).join(",")},${C})`}static interpolate(c,f,T,C="rgb"){switch(C){case"rgb":{const[R,z,U,X]=Wl(c.rgb,f.rgb,T);return new as(R,z,U,X,!1)}case"hcl":{const[R,z,U,X]=c.hcl,[re,ue,ve,Ce]=f.hcl;let Me,ze;if(isNaN(R)||isNaN(re))isNaN(R)?isNaN(re)?Me=NaN:(Me=re,U!==1&&U!==0||(ze=ue)):(Me=R,ve!==1&&ve!==0||(ze=z));else{let lt=re-R;re>R&&lt>180?lt-=360:re<R&&R-re>180&&(lt+=360),Me=R+T*lt}const[Fe,$e,it,zt]=(function([lt,gt,Vt,Xt]){return lt=isNaN(lt)?0:lt*Ra,yl([Vt,Math.cos(lt)*gt,Math.sin(lt)*gt,Xt])})([Me,ze??ja(z,ue,T),ja(U,ve,T),ja(X,Ce,T)]);return new as(Fe,$e,it,zt,!1)}case"lab":{const[R,z,U,X]=yl(Wl(c.lab,f.lab,T));return new as(R,z,U,X,!1)}}}}as.black=new as(0,0,0,1),as.white=new as(1,1,1,1),as.transparent=new as(0,0,0,0),as.red=new as(1,0,0,1);class wc{constructor(c,f,T){this.sensitivity=c?f?"variant":"case":f?"accent":"base",this.locale=T,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,f){return this.collator.compare(c,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Yu=["bottom","center","top"];class Ku{constructor(c,f,T,C,R,z){this.text=c,this.image=f,this.scale=T,this.fontStack=C,this.textColor=R,this.verticalAlign=z}}class cl{constructor(c){this.sections=c}static fromString(c){return new cl([new Ku(c,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((c=>c.text.length!==0||c.image&&c.image.name.length!==0))}static factory(c){return c instanceof cl?c:cl.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map((c=>c.text)).join("")}}class vl{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof vl)return c;if(typeof c=="number")return new vl([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const f of c)if(typeof f!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new vl(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,f,T){return new vl(Wl(c.values,f.values,T))}}class Vo{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Vo)return c;if(typeof c=="number")return new Vo([c]);if(Array.isArray(c)){for(const f of c)if(typeof f!="number")return;return new Vo(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,f,T){return new Vo(Wl(c.values,f.values,T))}}class Jr{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Jr)return c;if(typeof c=="string"){const T=as.parse(c);return T?new Jr([T]):void 0}if(!Array.isArray(c))return;const f=[];for(const T of c){if(typeof T!="string")return;const C=as.parse(T);if(!C)return;f.push(C)}return new Jr(f)}toString(){return JSON.stringify(this.values)}static interpolate(c,f,T,C="rgb"){const R=[];if(c.values.length!=f.values.length)throw new Error(`colorArray: Arrays have mismatched length (${c.values.length} vs. ${f.values.length}), cannot interpolate.`);for(let z=0;z<c.values.length;z++)R.push(as.interpolate(c.values[z],f.values[z],T,C));return new Jr(R)}}class Zo extends Error{constructor(c){super(c),this.name="RuntimeError"}toJSON(){return this.message}}const ou=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ko{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Ko)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let f=0;f<c.length;f+=2){const T=c[f],C=c[f+1];if(typeof T!="string"||!ou.has(T)||!Array.isArray(C)||C.length!==2||typeof C[0]!="number"||typeof C[1]!="number")return}return new Ko(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,f,T){const C=c.values,R=f.values;if(C.length!==R.length)throw new Zo(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${f.toString()}`);const z=[];for(let U=0;U<C.length;U+=2){if(C[U]!==R[U])throw new Zo(`Cannot interpolate values containing mismatched anchors. from[${U}]: ${C[U]}, to[${U}]: ${R[U]}`);z.push(C[U]);const[X,re]=C[U+1],[ue,ve]=R[U+1];z.push([ja(X,ue,T),ja(re,ve,T)])}return new Ko(z)}}class Zl{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Zl({name:c,available:!1}):null}}class el{constructor(c,f,T){this.from=c,this.to=f,this.transition=T}static interpolate(c,f,T){return new el(c,f,T)}static parse(c){return c instanceof el?c:Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"?new el(c[0],c[1],c[2]):typeof c=="object"&&typeof c.from=="string"&&typeof c.to=="string"&&typeof c.transition=="number"?new el(c.from,c.to,c.transition):typeof c=="string"?new el(c,c,1):void 0}}function Tc(m,c,f,T){return typeof m=="number"&&m>=0&&m<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid rgba value [${[m,c,f,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof T=="number"?[m,c,f,T]:[m,c,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fd(m){if(m===null||typeof m=="string"||typeof m=="boolean"||typeof m=="number"||m instanceof el||m instanceof as||m instanceof wc||m instanceof cl||m instanceof vl||m instanceof Vo||m instanceof Jr||m instanceof Ko||m instanceof Zl)return!0;if(Array.isArray(m)){for(const c of m)if(!fd(c))return!1;return!0}if(typeof m=="object"){for(const c in m)if(!fd(m[c]))return!1;return!0}return!1}function za(m){if(m===null)return we;if(typeof m=="string")return qe;if(typeof m=="boolean")return ot;if(typeof m=="number")return Ie;if(m instanceof as)return ft;if(m instanceof el)return Ct;if(m instanceof wc)return Qt;if(m instanceof cl)return Ri;if(m instanceof vl)return xi;if(m instanceof Vo)return $n;if(m instanceof Jr)return yn;if(m instanceof Ko)return Tr;if(m instanceof Zl)return mn;if(Array.isArray(m)){const c=m.length;let f;for(const T of m){const C=za(T);if(f){if(f===C)continue;f=_t;break}f=C}return rr(f||_t,c)}return Jt}function Iu(m){const c=typeof m;return m===null?"":c==="string"||c==="number"||c==="boolean"?String(m):m instanceof as||m instanceof el||m instanceof cl||m instanceof vl||m instanceof Vo||m instanceof Jr||m instanceof Ko||m instanceof Zl?m.toString():JSON.stringify(m)}class $r{constructor(c,f){this.type=c,this.value=f}static parse(c,f){if(c.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!fd(c[1]))return f.error("invalid value");const T=c[1];let C=za(T);const R=f.expectedType;return C.kind!=="array"||C.N!==0||!R||R.kind!=="array"||typeof R.N=="number"&&R.N!==0||(C=R),new $r(C,T)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Kd={string:qe,number:Ie,boolean:ot,object:Jt};class Xl{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");let T,C=1;const R=c[0];if(R==="array"){let U,X;if(c.length>2){const re=c[1];if(typeof re!="string"||!(re in Kd)||re==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);U=Kd[re],C++}else U=_t;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return f.error('The length argument to "array" must be a positive integer literal',2);X=c[2],C++}T=rr(U,X)}else{if(!Kd[R])throw new Error(`Types doesn't contain name = ${R}`);T=Kd[R]}const z=[];for(;C<c.length;C++){const U=f.parse(c[C],C,_t);if(!U)return null;z.push(U)}return new Xl(T,z)}evaluate(c){for(let f=0;f<this.args.length;f++){const T=this.args[f].evaluate(c);if(!io(this.type,za(T)))return T;if(f===this.args.length-1)throw new Zo(`Expected value to be of type ${jn(this.type)}, but found ${jn(za(T))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every((c=>c.outputDefined()))}}const pd={"to-boolean":ot,"to-color":ft,"to-number":Ie,"to-string":qe};class Ju{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const T=c[0];if(!pd[T])throw new Error(`Can't parse ${T} as it is not part of the known types`);if((T==="to-boolean"||T==="to-string")&&c.length!==2)return f.error("Expected one argument.");const C=pd[T],R=[];for(let z=1;z<c.length;z++){const U=f.parse(c[z],z,_t);if(!U)return null;R.push(U)}return new Ju(C,R)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let f,T;for(const C of this.args){if(f=C.evaluate(c),T=null,f instanceof as)return f;if(typeof f=="string"){const R=c.parseColor(f);if(R)return R}else if(Array.isArray(f)&&(T=f.length<3||f.length>4?`Invalid rgba value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:Tc(f[0],f[1],f[2],f[3]),!T))return new as(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Zo(T||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const T of this.args){f=T.evaluate(c);const C=vl.parse(f);if(C)return C}throw new Zo(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"numberArray":{let f;for(const T of this.args){f=T.evaluate(c);const C=Vo.parse(f);if(C)return C}throw new Zo(`Could not parse numberArray from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"colorArray":{let f;for(const T of this.args){f=T.evaluate(c);const C=Jr.parse(f);if(C)return C}throw new Zo(`Could not parse colorArray from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const T of this.args){f=T.evaluate(c);const C=Ko.parse(f);if(C)return C}throw new Zo(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const T of this.args){if(f=T.evaluate(c),f===null)return 0;const C=Number(f);if(!isNaN(C))return C}throw new Zo(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return cl.fromString(Iu(this.args[0].evaluate(c)));case"resolvedImage":return Zl.fromString(Iu(this.args[0].evaluate(c)));case"projectionDefinition":return this.args[0].evaluate(c);default:return Iu(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every((c=>c.outputDefined()))}}const Lh=["Unknown","Point","LineString","Polygon"];class Jd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Lh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let f=this._parseColorCache.get(c);return f||(f=as.parse(c),this._parseColorCache.set(c,f)),f}}class Cu{constructor(c,f,T=[],C,R=new Nt,z=[]){this.registry=c,this.path=T,this.key=T.map((U=>`[${U}]`)).join(""),this.scope=R,this.errors=z,this.expectedType=C,this._isConstant=f}parse(c,f,T,C,R={}){return f?this.concat(f,T,C)._parse(c,R):this._parse(c,R)}_parse(c,f){function T(C,R,z){return z==="assert"?new Xl(R,[C]):z==="coerce"?new Ju(R,[C]):C}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const C=c[0];if(typeof C!="string")return this.error(`Expression name must be a string, but found ${typeof C} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const R=this.registry[C];if(R){let z=R.parse(c,this);if(!z)return null;if(this.expectedType){const U=this.expectedType,X=z.type;if(U.kind!=="string"&&U.kind!=="number"&&U.kind!=="boolean"&&U.kind!=="object"&&U.kind!=="array"||X.kind!=="value"){if(U.kind==="projectionDefinition"&&["string","array"].includes(X.kind)||["color","formatted","resolvedImage"].includes(U.kind)&&["value","string"].includes(X.kind)||["padding","numberArray"].includes(U.kind)&&["value","number","array"].includes(X.kind)||U.kind==="colorArray"&&["value","string","array"].includes(X.kind)||U.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(X.kind))z=T(z,U,f.typeAnnotation||"coerce");else if(this.checkSubtype(U,X))return null}else z=T(z,U,f.typeAnnotation||"assert")}if(!(z instanceof $r)&&z.type.kind!=="resolvedImage"&&this._isConstant(z)){const U=new Jd;try{z=new $r(z.type,z.evaluate(U))}catch(X){return this.error(X.message),null}}return z}return this.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,f,T){const C=typeof c=="number"?this.path.concat(c):this.path,R=T?this.scope.concat(T):this.scope;return new Cu(this.registry,this._isConstant,C,f||null,R,this.errors)}error(c,...f){const T=`${this.key}${f.map((C=>`[${C}]`)).join("")}`;this.errors.push(new gl(T,c))}checkSubtype(c,f){const T=io(c,f);return T&&this.error(T),T}}class jo{constructor(c,f){this.type=f.type,this.bindings=[].concat(c),this.result=f}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const f of this.bindings)c(f[1]);c(this.result)}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const T=[];for(let R=1;R<c.length-1;R+=2){const z=c[R];if(typeof z!="string")return f.error(`Expected string, but found ${typeof z} instead.`,R);if(/[^a-zA-Z0-9_]/.test(z))return f.error("Variable names must contain only alphanumeric characters or '_'.",R);const U=f.parse(c[R+1],R+1);if(!U)return null;T.push([z,U])}const C=f.parse(c[c.length-1],c.length-1,f.expectedType,T);return C?new jo(T,C):null}outputDefined(){return this.result.outputDefined()}}class Rh{constructor(c,f){this.type=f.type,this.name=c,this.boundExpression=f}static parse(c,f){if(c.length!==2||typeof c[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const T=c[1];return f.scope.has(T)?new Rh(T,f.scope.get(T)):f.error(`Unknown variable "${T}". Make sure "${T}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class Cs{constructor(c,f,T){this.type=c,this.index=f,this.input=T}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const T=f.parse(c[1],1,Ie),C=f.parse(c[2],2,rr(f.expectedType||_t));return T&&C?new Cs(C.type.itemType,T,C):null}evaluate(c){const f=this.index.evaluate(c),T=this.input.evaluate(c);if(f<0)throw new Zo(`Array index out of bounds: ${f} < 0.`);if(f>=T.length)throw new Zo(`Array index out of bounds: ${f} > ${T.length-1}.`);if(f!==Math.floor(f))throw new Zo(`Array index must be an integer, but found ${f} instead.`);return T[f]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class ms{constructor(c,f){this.type=ot,this.needle=c,this.haystack=f}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const T=f.parse(c[1],1,_t),C=f.parse(c[2],2,_t);return T&&C?No(T.type,[ot,qe,Ie,we,_t])?new ms(T,C):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${jn(T.type)} instead`):null}evaluate(c){const f=this.needle.evaluate(c),T=this.haystack.evaluate(c);if(!T)return!1;if(!oo(f,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${jn(za(f))} instead.`);if(!oo(T,["string","array"]))throw new Zo(`Expected second argument to be of type array or string, but found ${jn(za(T))} instead.`);return T.indexOf(f)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class md{constructor(c,f,T){this.type=Ie,this.needle=c,this.haystack=f,this.fromIndex=T}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 2 or 3 arguments, but found ${c.length-1} instead.`);const T=f.parse(c[1],1,_t),C=f.parse(c[2],2,_t);if(!T||!C)return null;if(!No(T.type,[ot,qe,Ie,we,_t]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${jn(T.type)} instead`);if(c.length===4){const R=f.parse(c[3],3,Ie);return R?new md(T,C,R):null}return new md(T,C)}evaluate(c){const f=this.needle.evaluate(c),T=this.haystack.evaluate(c);if(!oo(f,["boolean","string","number","null"]))throw new Zo(`Expected first argument to be of type boolean, string, number or null, but found ${jn(za(f))} instead.`);let C;if(this.fromIndex&&(C=this.fromIndex.evaluate(c)),oo(T,["string"])){const R=T.indexOf(f,C);return R===-1?-1:[...T.slice(0,R)].length}if(oo(T,["array"]))return T.indexOf(f,C);throw new Zo(`Expected second argument to be of type array or string, but found ${jn(za(T))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class js{constructor(c,f,T,C,R,z){this.inputType=c,this.type=f,this.input=T,this.cases=C,this.outputs=R,this.otherwise=z}static parse(c,f){if(c.length<5)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return f.error("Expected an even number of arguments.");let T,C;f.expectedType&&f.expectedType.kind!=="value"&&(C=f.expectedType);const R={},z=[];for(let re=2;re<c.length-1;re+=2){let ue=c[re];const ve=c[re+1];Array.isArray(ue)||(ue=[ue]);const Ce=f.concat(re);if(ue.length===0)return Ce.error("Expected at least one branch label.");for(const ze of ue){if(typeof ze!="number"&&typeof ze!="string")return Ce.error("Branch labels must be numbers or strings.");if(typeof ze=="number"&&Math.abs(ze)>Number.MAX_SAFE_INTEGER)return Ce.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ze=="number"&&Math.floor(ze)!==ze)return Ce.error("Numeric branch labels must be integer values.");if(T){if(Ce.checkSubtype(T,za(ze)))return null}else T=za(ze);if(R[String(ze)]!==void 0)return Ce.error("Branch labels must be unique.");R[String(ze)]=z.length}const Me=f.parse(ve,re,C);if(!Me)return null;C=C||Me.type,z.push(Me)}const U=f.parse(c[1],1,_t);if(!U)return null;const X=f.parse(c[c.length-1],c.length-1,C);return X?U.type.kind!=="value"&&f.concat(1).checkSubtype(T,U.type)?null:new js(T,C,U,R,z,X):null}evaluate(c){const f=this.input.evaluate(c);return(za(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every((c=>c.outputDefined()))&&this.otherwise.outputDefined()}}class Au{constructor(c,f,T){this.type=c,this.branches=f,this.otherwise=T}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return f.error("Expected an odd number of arguments.");let T;f.expectedType&&f.expectedType.kind!=="value"&&(T=f.expectedType);const C=[];for(let z=1;z<c.length-1;z+=2){const U=f.parse(c[z],z,ot);if(!U)return null;const X=f.parse(c[z+1],z+1,T);if(!X)return null;C.push([U,X]),T=T||X.type}const R=f.parse(c[c.length-1],c.length-1,T);if(!R)return null;if(!T)throw new Error("Can't infer output type");return new Au(T,C,R)}evaluate(c){for(const[f,T]of this.branches)if(f.evaluate(c))return T.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[f,T]of this.branches)c(f),c(T);c(this.otherwise)}outputDefined(){return this.branches.every((([c,f])=>f.outputDefined()))&&this.otherwise.outputDefined()}}class Jo{constructor(c,f,T,C){this.type=c,this.input=f,this.beginIndex=T,this.endIndex=C}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 2 or 3 arguments, but found ${c.length-1} instead.`);const T=f.parse(c[1],1,_t),C=f.parse(c[2],2,Ie);if(!T||!C)return null;if(!No(T.type,[rr(_t),qe,_t]))return f.error(`Expected first argument to be of type array or string, but found ${jn(T.type)} instead`);if(c.length===4){const R=f.parse(c[3],3,Ie);return R?new Jo(T.type,T,C,R):null}return new Jo(T.type,T,C)}evaluate(c){const f=this.input.evaluate(c),T=this.beginIndex.evaluate(c);let C;if(this.endIndex&&(C=this.endIndex.evaluate(c)),oo(f,["string"]))return[...f].slice(T,C).join("");if(oo(f,["array"]))return f.slice(T,C);throw new Zo(`Expected first argument to be of type array or string, but found ${jn(za(f))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function zh(m,c){const f=m.length-1;let T,C,R=0,z=f,U=0;for(;R<=z;)if(U=Math.floor((R+z)/2),T=m[U],C=m[U+1],T<=c){if(U===f||c<C)return U;R=U+1}else{if(!(T>c))throw new Zo("Input is not a number.");z=U-1}return 0}class au{constructor(c,f,T){this.type=c,this.input=f,this.labels=[],this.outputs=[];for(const[C,R]of T)this.labels.push(C),this.outputs.push(R)}static parse(c,f){if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");const T=f.parse(c[1],1,Ie);if(!T)return null;const C=[];let R=null;f.expectedType&&f.expectedType.kind!=="value"&&(R=f.expectedType);for(let z=1;z<c.length;z+=2){const U=z===1?-1/0:c[z],X=c[z+1],re=z,ue=z+1;if(typeof U!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(C.length&&C[C.length-1][0]>=U)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',re);const ve=f.parse(X,ue,R);if(!ve)return null;R=R||ve.type,C.push([U,ve])}return new au(R,T,C)}evaluate(c){const f=this.labels,T=this.outputs;if(f.length===1)return T[0].evaluate(c);const C=this.input.evaluate(c);if(C<=f[0])return T[0].evaluate(c);const R=f.length;return C>=f[R-1]?T[R-1].evaluate(c):T[zh(f,C)].evaluate(c)}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every((c=>c.outputDefined()))}}function Uc(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var ps,km,sy=(function(){if(km)return ps;function m(c,f,T,C){this.cx=3*c,this.bx=3*(T-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(C-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=f,this.p2x=T,this.p2y=C}return km=1,ps=m,m.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,f){if(f===void 0&&(f=1e-6),c<0)return 0;if(c>1)return 1;for(var T=c,C=0;C<8;C++){var R=this.sampleCurveX(T)-c;if(Math.abs(R)<f)return T;var z=this.sampleCurveDerivativeX(T);if(Math.abs(z)<1e-6)break;T-=R/z}var U=0,X=1;for(T=c,C=0;C<20&&(R=this.sampleCurveX(T),!(Math.abs(R-c)<f));C++)c>R?U=T:X=T,T=.5*(X-U)+U;return T},solve:function(c,f){return this.sampleCurveY(this.solveCurveX(c,f))}},ps})(),Fg=Uc(sy);class Gn{constructor(c,f,T,C,R){this.type=c,this.operator=f,this.interpolation=T,this.input=C,this.labels=[],this.outputs=[];for(const[z,U]of R)this.labels.push(z),this.outputs.push(U)}static interpolationFactor(c,f,T,C){let R=0;if(c.name==="exponential")R=lu(f,c.base,T,C);else if(c.name==="linear")R=lu(f,1,T,C);else if(c.name==="cubic-bezier"){const z=c.controlPoints;R=new Fg(z[0],z[1],z[2],z[3]).solve(lu(f,1,T,C))}return R}static parse(c,f){let[T,C,R,...z]=c;if(!Array.isArray(C)||C.length===0)return f.error("Expected an interpolation type expression.",1);if(C[0]==="linear")C={name:"linear"};else if(C[0]==="exponential"){const re=C[1];if(typeof re!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);C={name:"exponential",base:re}}else{if(C[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(C[0])}`,1,0);{const re=C.slice(1);if(re.length!==4||re.some((ue=>typeof ue!="number"||ue<0||ue>1)))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);C={name:"cubic-bezier",controlPoints:re}}}if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(R=f.parse(R,2,Ie),!R)return null;const U=[];let X=null;T!=="interpolate-hcl"&&T!=="interpolate-lab"||f.expectedType==yn?f.expectedType&&f.expectedType.kind!=="value"&&(X=f.expectedType):X=ft;for(let re=0;re<z.length;re+=2){const ue=z[re],ve=z[re+1],Ce=re+3,Me=re+4;if(typeof ue!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ce);if(U.length&&U[U.length-1][0]>=ue)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ce);const ze=f.parse(ve,Me,X);if(!ze)return null;X=X||ze.type,U.push([ue,ze])}return po(X,Ie)||po(X,Ct)||po(X,ft)||po(X,xi)||po(X,$n)||po(X,yn)||po(X,Tr)||po(X,rr(Ie))?new Gn(X,T,C,R,U):f.error(`Type ${jn(X)} is not interpolatable.`)}evaluate(c){const f=this.labels,T=this.outputs;if(f.length===1)return T[0].evaluate(c);const C=this.input.evaluate(c);if(C<=f[0])return T[0].evaluate(c);const R=f.length;if(C>=f[R-1])return T[R-1].evaluate(c);const z=zh(f,C),U=Gn.interpolationFactor(this.interpolation,C,f[z],f[z+1]),X=T[z].evaluate(c),re=T[z+1].evaluate(c);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ja(X,re,U);case"color":return as.interpolate(X,re,U);case"padding":return vl.interpolate(X,re,U);case"colorArray":return Jr.interpolate(X,re,U);case"numberArray":return Vo.interpolate(X,re,U);case"variableAnchorOffsetCollection":return Ko.interpolate(X,re,U);case"array":return Wl(X,re,U);case"projectionDefinition":return el.interpolate(X,re,U)}case"interpolate-hcl":switch(this.type.kind){case"color":return as.interpolate(X,re,U,"hcl");case"colorArray":return Jr.interpolate(X,re,U,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return as.interpolate(X,re,U,"lab");case"colorArray":return Jr.interpolate(X,re,U,"lab")}}}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every((c=>c.outputDefined()))}}function lu(m,c,f,T){const C=T-f,R=m-f;return C===0?0:c===1?R/C:(Math.pow(c,R)-1)/(Math.pow(c,C)-1)}const Xo={color:as.interpolate,number:ja,padding:vl.interpolate,numberArray:Vo.interpolate,colorArray:Jr.interpolate,variableAnchorOffsetCollection:Ko.interpolate,array:Wl};class Al{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");let T=null;const C=f.expectedType;C&&C.kind!=="value"&&(T=C);const R=[];for(const U of c.slice(1)){const X=f.parse(U,1+R.length,T,void 0,{typeAnnotation:"omit"});if(!X)return null;T=T||X.type,R.push(X)}if(!T)throw new Error("No output type");const z=C&&R.some((U=>io(C,U.type)));return new Al(z?_t:T,R)}evaluate(c){let f,T=null,C=0;for(const R of this.args)if(C++,T=R.evaluate(c),T&&T instanceof Zl&&!T.available&&(f||(f=T.name),T=null,C===this.args.length&&(T=f)),T!==null)break;return T}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every((c=>c.outputDefined()))}}function gd(m,c){return m==="=="||m==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function dc(m,c,f,T){return T.compare(c,f)===0}function vn(m,c,f){const T=m!=="=="&&m!=="!=";return class Cj{constructor(R,z,U){this.type=ot,this.lhs=R,this.rhs=z,this.collator=U,this.hasUntypedArgument=R.type.kind==="value"||z.type.kind==="value"}static parse(R,z){if(R.length!==3&&R.length!==4)return z.error("Expected two or three arguments.");const U=R[0];let X=z.parse(R[1],1,_t);if(!X)return null;if(!gd(U,X.type))return z.concat(1).error(`"${U}" comparisons are not supported for type '${jn(X.type)}'.`);let re=z.parse(R[2],2,_t);if(!re)return null;if(!gd(U,re.type))return z.concat(2).error(`"${U}" comparisons are not supported for type '${jn(re.type)}'.`);if(X.type.kind!==re.type.kind&&X.type.kind!=="value"&&re.type.kind!=="value")return z.error(`Cannot compare types '${jn(X.type)}' and '${jn(re.type)}'.`);T&&(X.type.kind==="value"&&re.type.kind!=="value"?X=new Xl(re.type,[X]):X.type.kind!=="value"&&re.type.kind==="value"&&(re=new Xl(X.type,[re])));let ue=null;if(R.length===4){if(X.type.kind!=="string"&&re.type.kind!=="string"&&X.type.kind!=="value"&&re.type.kind!=="value")return z.error("Cannot use collator to compare non-string types.");if(ue=z.parse(R[3],3,Qt),!ue)return null}return new Cj(X,re,ue)}evaluate(R){const z=this.lhs.evaluate(R),U=this.rhs.evaluate(R);if(T&&this.hasUntypedArgument){const X=za(z),re=za(U);if(X.kind!==re.kind||X.kind!=="string"&&X.kind!=="number")throw new Zo(`Expected arguments for "${m}" to be (string, string) or (number, number), but found (${X.kind}, ${re.kind}) instead.`)}if(this.collator&&!T&&this.hasUntypedArgument){const X=za(z),re=za(U);if(X.kind!=="string"||re.kind!=="string")return c(R,z,U)}return this.collator?f(R,z,U,this.collator.evaluate(R)):c(R,z,U)}eachChild(R){R(this.lhs),R(this.rhs),this.collator&&R(this.collator)}outputDefined(){return!0}}}const Qr=vn("==",(function(m,c,f){return c===f}),dc),ws=vn("!=",(function(m,c,f){return c!==f}),(function(m,c,f,T){return!dc(0,c,f,T)})),Yl=vn("<",(function(m,c,f){return c<f}),(function(m,c,f,T){return T.compare(c,f)<0})),Qu=vn(">",(function(m,c,f){return c>f}),(function(m,c,f,T){return T.compare(c,f)>0})),hs=vn("<=",(function(m,c,f){return c<=f}),(function(m,c,f,T){return T.compare(c,f)<=0})),Qd=vn(">=",(function(m,c,f){return c>=f}),(function(m,c,f,T){return T.compare(c,f)>=0}));class eh{constructor(c,f,T){this.type=Qt,this.locale=T,this.caseSensitive=c,this.diacriticSensitive=f}static parse(c,f){if(c.length!==2)return f.error("Expected one argument.");const T=c[1];if(typeof T!="object"||Array.isArray(T))return f.error("Collator options argument must be an object.");const C=f.parse(T["case-sensitive"]!==void 0&&T["case-sensitive"],1,ot);if(!C)return null;const R=f.parse(T["diacritic-sensitive"]!==void 0&&T["diacritic-sensitive"],1,ot);if(!R)return null;let z=null;return T.locale&&(z=f.parse(T.locale,1,qe),!z)?null:new eh(C,R,z)}evaluate(c){return new wc(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}class ef{constructor(c,f,T,C,R){this.type=qe,this.number=c,this.locale=f,this.currency=T,this.minFractionDigits=C,this.maxFractionDigits=R}static parse(c,f){if(c.length!==3)return f.error("Expected two arguments.");const T=f.parse(c[1],1,Ie);if(!T)return null;const C=c[2];if(typeof C!="object"||Array.isArray(C))return f.error("NumberFormat options argument must be an object.");let R=null;if(C.locale&&(R=f.parse(C.locale,1,qe),!R))return null;let z=null;if(C.currency&&(z=f.parse(C.currency,1,qe),!z))return null;let U=null;if(C["min-fraction-digits"]&&(U=f.parse(C["min-fraction-digits"],1,Ie),!U))return null;let X=null;return C["max-fraction-digits"]&&(X=f.parse(C["max-fraction-digits"],1,Ie),!X)?null:new ef(T,R,z,U,X)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class Ua{constructor(c){this.type=Ri,this.sections=c}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const T=c[1];if(!Array.isArray(T)&&typeof T=="object")return f.error("First argument must be an image or text section.");const C=[];let R=!1;for(let z=1;z<=c.length-1;++z){const U=c[z];if(R&&typeof U=="object"&&!Array.isArray(U)){R=!1;let X=null;if(U["font-scale"]&&(X=f.parse(U["font-scale"],1,Ie),!X))return null;let re=null;if(U["text-font"]&&(re=f.parse(U["text-font"],1,rr(qe)),!re))return null;let ue=null;if(U["text-color"]&&(ue=f.parse(U["text-color"],1,ft),!ue))return null;let ve=null;if(U["vertical-align"]){if(typeof U["vertical-align"]=="string"&&!Yu.includes(U["vertical-align"]))return f.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${U["vertical-align"]}' instead.`);if(ve=f.parse(U["vertical-align"],1,qe),!ve)return null}const Ce=C[C.length-1];Ce.scale=X,Ce.font=re,Ce.textColor=ue,Ce.verticalAlign=ve}else{const X=f.parse(c[z],1,_t);if(!X)return null;const re=X.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");R=!0,C.push({content:X,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ua(C)}evaluate(c){return new cl(this.sections.map((f=>{const T=f.content.evaluate(c);return za(T)===mn?new Ku("",T,null,null,null,f.verticalAlign?f.verticalAlign.evaluate(c):null):new Ku(Iu(T),null,f.scale?f.scale.evaluate(c):null,f.font?f.font.evaluate(c).join(","):null,f.textColor?f.textColor.evaluate(c):null,f.verticalAlign?f.verticalAlign.evaluate(c):null)})))}eachChild(c){for(const f of this.sections)c(f.content),f.scale&&c(f.scale),f.font&&c(f.font),f.textColor&&c(f.textColor),f.verticalAlign&&c(f.verticalAlign)}outputDefined(){return!1}}class Mo{constructor(c){this.type=mn,this.input=c}static parse(c,f){if(c.length!==2)return f.error("Expected two arguments.");const T=f.parse(c[1],1,qe);return T?new Mo(T):f.error("No image name provided.")}evaluate(c){const f=this.input.evaluate(c),T=Zl.fromString(f);return T&&c.availableImages&&(T.available=c.availableImages.indexOf(f)>-1),T}eachChild(c){c(this.input)}outputDefined(){return!1}}class $f{constructor(c){this.type=Ie,this.input=c}static parse(c,f){if(c.length!==2)return f.error(`Expected 1 argument, but found ${c.length-1} instead.`);const T=f.parse(c[1],1);return T?T.type.kind!=="array"&&T.type.kind!=="string"&&T.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${jn(T.type)} instead.`):new $f(T):null}evaluate(c){const f=this.input.evaluate(c);if(typeof f=="string")return[...f].length;if(Array.isArray(f))return f.length;throw new Zo(`Expected value to be of type string or array, but found ${jn(za(f))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const ea=8192;function Dm(m,c){const f=(180+m[0])/360,T=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m[1]*Math.PI/360)))/360,C=Math.pow(2,c.z);return[Math.round(f*C*ea),Math.round(T*C*ea)]}function th(m,c){const f=Math.pow(2,c.z);return[(C=(m[0]/ea+c.x)/f,360*C-180),(T=(m[1]/ea+c.y)/f,360/Math.PI*Math.atan(Math.exp((180-360*T)*Math.PI/180))-90)];var T,C}function _d(m,c){m[0]=Math.min(m[0],c[0]),m[1]=Math.min(m[1],c[1]),m[2]=Math.max(m[2],c[0]),m[3]=Math.max(m[3],c[1])}function Oh(m,c){return!(m[0]<=c[0]||m[2]>=c[2]||m[1]<=c[1]||m[3]>=c[3])}function Lm(m,c,f){const T=m[0]-c[0],C=m[1]-c[1],R=m[0]-f[0],z=m[1]-f[1];return T*z-R*C==0&&T*R<=0&&C*z<=0}function xl(m,c,f,T){return(C=[T[0]-f[0],T[1]-f[1]])[0]*(R=[c[0]-m[0],c[1]-m[1]])[1]-C[1]*R[0]!=0&&!(!Sc(m,c,f,T)||!Sc(f,T,m,c));var C,R}function Fh(m,c,f){for(const T of f)for(let C=0;C<T.length-1;++C)if(xl(m,c,T[C],T[C+1]))return!0;return!1}function tl(m,c,f=!1){let T=!1;for(const U of c)for(let X=0;X<U.length-1;X++){if(Lm(m,U[X],U[X+1]))return f;(R=U[X])[1]>(C=m)[1]!=(z=U[X+1])[1]>C[1]&&C[0]<(z[0]-R[0])*(C[1]-R[1])/(z[1]-R[1])+R[0]&&(T=!T)}var C,R,z;return T}function ih(m,c){for(const f of c)if(tl(m,f))return!0;return!1}function tf(m,c){for(const f of m)if(!tl(f,c))return!1;for(let f=0;f<m.length-1;++f)if(Fh(m[f],m[f+1],c))return!1;return!0}function Oa(m,c){for(const f of c)if(tf(m,f))return!0;return!1}function Sc(m,c,f,T){const C=T[0]-f[0],R=T[1]-f[1],z=(m[0]-f[0])*R-C*(m[1]-f[1]),U=(c[0]-f[0])*R-C*(c[1]-f[1]);return z>0&&U<0||z<0&&U>0}function Pu(m,c,f){const T=[];for(let C=0;C<m.length;C++){const R=[];for(let z=0;z<m[C].length;z++){const U=Dm(m[C][z],f);_d(c,U),R.push(U)}T.push(R)}return T}function da(m,c,f){const T=[];for(let C=0;C<m.length;C++){const R=Pu(m[C],c,f);T.push(R)}return T}function Rm(m,c,f,T){if(m[0]<f[0]||m[0]>f[2]){const C=.5*T;let R=m[0]-f[0]>C?-T:f[0]-m[0]>C?T:0;R===0&&(R=m[0]-f[2]>C?-T:f[2]-m[0]>C?T:0),m[0]+=R}_d(c,m)}function cu(m,c,f,T){const C=Math.pow(2,T.z)*ea,R=[T.x*ea,T.y*ea],z=[];for(const U of m)for(const X of U){const re=[X.x+R[0],X.y+R[1]];Rm(re,c,f,C),z.push(re)}return z}function Mu(m,c,f,T){const C=Math.pow(2,T.z)*ea,R=[T.x*ea,T.y*ea],z=[];for(const X of m){const re=[];for(const ue of X){const ve=[ue.x+R[0],ue.y+R[1]];_d(c,ve),re.push(ve)}z.push(re)}if(c[2]-c[0]<=C/2){(U=c)[0]=U[1]=1/0,U[2]=U[3]=-1/0;for(const X of z)for(const re of X)Rm(re,c,f,C)}var U;return z}class yr{constructor(c,f){this.type=ot,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(fd(c[1])){const T=c[1];if(T.type==="FeatureCollection"){const C=[];for(const R of T.features){const{type:z,coordinates:U}=R.geometry;z==="Polygon"&&C.push(U),z==="MultiPolygon"&&C.push(...U)}if(C.length)return new yr(T,{type:"MultiPolygon",coordinates:C})}else if(T.type==="Feature"){const C=T.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new yr(T,T.geometry)}else if(T.type==="Polygon"||T.type==="MultiPolygon")return new yr(T,T)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return(function(f,T){const C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],z=f.canonicalID();if(T.type==="Polygon"){const U=Pu(T.coordinates,R,z),X=cu(f.geometry(),C,R,z);if(!Oh(C,R))return!1;for(const re of X)if(!tl(re,U))return!1}if(T.type==="MultiPolygon"){const U=da(T.coordinates,R,z),X=cu(f.geometry(),C,R,z);if(!Oh(C,R))return!1;for(const re of X)if(!ih(re,U))return!1}return!0})(c,this.geometries);if(c.geometryType()==="LineString")return(function(f,T){const C=[1/0,1/0,-1/0,-1/0],R=[1/0,1/0,-1/0,-1/0],z=f.canonicalID();if(T.type==="Polygon"){const U=Pu(T.coordinates,R,z),X=Mu(f.geometry(),C,R,z);if(!Oh(C,R))return!1;for(const re of X)if(!tf(re,U))return!1}if(T.type==="MultiPolygon"){const U=da(T.coordinates,R,z),X=Mu(f.geometry(),C,R,z);if(!Oh(C,R))return!1;for(const re of X)if(!Oa(re,U))return!1}return!0})(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zn=class{constructor(m=[],c=(f,T)=>f<T?-1:f>T?1:0){if(this.data=m,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(m){this.data.push(m),this._up(this.length++)}pop(){if(this.length===0)return;const m=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),m}peek(){return this.data[0]}_up(m){const{data:c,compare:f}=this,T=c[m];for(;m>0;){const C=m-1>>1,R=c[C];if(f(T,R)>=0)break;c[m]=R,m=C}c[m]=T}_down(m){const{data:c,compare:f}=this,T=this.length>>1,C=c[m];for(;m<T;){let R=1+(m<<1);const z=R+1;if(z<this.length&&f(c[z],c[R])<0&&(R=z),f(c[R],C)>=0)break;c[m]=c[R],m=R}c[m]=C}};function Gf(m,c,f=0,T=m.length-1,C=nf){for(;T>f;){if(T-f>600){const X=T-f+1,re=c-f+1,ue=Math.log(X),ve=.5*Math.exp(2*ue/3),Ce=.5*Math.sqrt(ue*ve*(X-ve)/X)*(re-X/2<0?-1:1);Gf(m,c,Math.max(f,Math.floor(c-re*ve/X+Ce)),Math.min(T,Math.floor(c+(X-re)*ve/X+Ce)),C)}const R=m[c];let z=f,U=T;for(sr(m,f,c),C(m[T],R)>0&&sr(m,f,T);z<U;){for(sr(m,z,U),z++,U--;C(m[z],R)<0;)z++;for(;C(m[U],R)>0;)U--}C(m[f],R)===0?sr(m,f,U):(U++,sr(m,U,T)),U<=c&&(f=U+1),c<=U&&(T=U-1)}}function sr(m,c,f){const T=m[c];m[c]=m[f],m[f]=T}function nf(m,c){return m<c?-1:m>c?1:0}function rf(m,c){if(m.length<=1)return[m];const f=[];let T,C;for(const R of m){const z=nh(R);z!==0&&(R.area=Math.abs(z),C===void 0&&(C=z<0),C===z<0?(T&&f.push(T),T=[R]):T.push(R))}if(T&&f.push(T),c>1)for(let R=0;R<f.length;R++)f[R].length<=c||(Gf(f[R],c,1,f[R].length-1,pr),f[R]=f[R].slice(0,c));return f}function pr(m,c){return c.area-m.area}function nh(m){let c=0;for(let f,T,C=0,R=m.length,z=R-1;C<R;z=C++)f=m[C],T=m[z],c+=(T.x-f.x)*(f.y+T.y);return c}const zm=1/298.257223563,yd=zm*(2-zm),Fl=Math.PI/180;class qf{constructor(c){const f=6378.137*Fl*1e3,T=Math.cos(c*Fl),C=1/(1-yd*(1-T*T)),R=Math.sqrt(C);this.kx=f*R*T,this.ky=f*R*C*(1-yd)}distance(c,f){const T=this.wrap(c[0]-f[0])*this.kx,C=(c[1]-f[1])*this.ky;return Math.sqrt(T*T+C*C)}pointOnLine(c,f){let T,C,R,z,U=1/0;for(let X=0;X<c.length-1;X++){let re=c[X][0],ue=c[X][1],ve=this.wrap(c[X+1][0]-re)*this.kx,Ce=(c[X+1][1]-ue)*this.ky,Me=0;ve===0&&Ce===0||(Me=(this.wrap(f[0]-re)*this.kx*ve+(f[1]-ue)*this.ky*Ce)/(ve*ve+Ce*Ce),Me>1?(re=c[X+1][0],ue=c[X+1][1]):Me>0&&(re+=ve/this.kx*Me,ue+=Ce/this.ky*Me)),ve=this.wrap(f[0]-re)*this.kx,Ce=(f[1]-ue)*this.ky;const ze=ve*ve+Ce*Ce;ze<U&&(U=ze,T=re,C=ue,R=X,z=Me)}return{point:[T,C],index:R,t:Math.max(0,Math.min(1,z))}}wrap(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}}function $a(m,c){return c[0]-m[0]}function sf(m){return m[1]-m[0]+1}function il(m,c){return m[1]>=m[0]&&m[1]<c}function Hf(m,c){if(m[0]>m[1])return[null,null];const f=sf(m);if(c){if(f===2)return[m,null];const C=Math.floor(f/2);return[[m[0],m[0]+C],[m[0]+C,m[1]]]}if(f===1)return[m,null];const T=Math.floor(f/2)-1;return[[m[0],m[0]+T],[m[0]+T+1,m[1]]]}function rh(m,c){if(!il(c,m.length))return[1/0,1/0,-1/0,-1/0];const f=[1/0,1/0,-1/0,-1/0];for(let T=c[0];T<=c[1];++T)_d(f,m[T]);return f}function Ec(m){const c=[1/0,1/0,-1/0,-1/0];for(const f of m)for(const T of f)_d(c,T);return c}function of(m){return m[0]!==-1/0&&m[1]!==-1/0&&m[2]!==1/0&&m[3]!==1/0}function Om(m,c,f){if(!of(m)||!of(c))return NaN;let T=0,C=0;return m[2]<c[0]&&(T=c[0]-m[2]),m[0]>c[2]&&(T=m[0]-c[2]),m[1]>c[3]&&(C=m[1]-c[3]),m[3]<c[1]&&(C=c[1]-m[3]),f.distance([0,0],[T,C])}function uu(m,c,f){const T=f.pointOnLine(c,m);return f.distance(m,T.point)}function af(m,c,f,T,C){const R=Math.min(uu(m,[f,T],C),uu(c,[f,T],C)),z=Math.min(uu(f,[m,c],C),uu(T,[m,c],C));return Math.min(R,z)}function Fp(m,c,f,T,C){if(!il(c,m.length)||!il(T,f.length))return 1/0;let R=1/0;for(let z=c[0];z<c[1];++z){const U=m[z],X=m[z+1];for(let re=T[0];re<T[1];++re){const ue=f[re],ve=f[re+1];if(xl(U,X,ue,ve))return 0;R=Math.min(R,af(U,X,ue,ve,C))}}return R}function sh(m,c,f,T,C){if(!il(c,m.length)||!il(T,f.length))return NaN;let R=1/0;for(let z=c[0];z<=c[1];++z)for(let U=T[0];U<=T[1];++U)if(R=Math.min(R,C.distance(m[z],f[U])),R===0)return R;return R}function vd(m,c,f){if(tl(m,c,!0))return 0;let T=1/0;for(const C of c){const R=C[0],z=C[C.length-1];if(R!==z&&(T=Math.min(T,uu(m,[z,R],f)),T===0))return T;const U=f.pointOnLine(C,m);if(T=Math.min(T,f.distance(m,U.point)),T===0)return T}return T}function f0(m,c,f,T){if(!il(c,m.length))return NaN;for(let R=c[0];R<=c[1];++R)if(tl(m[R],f,!0))return 0;let C=1/0;for(let R=c[0];R<c[1];++R){const z=m[R],U=m[R+1];for(const X of f)for(let re=0,ue=X.length,ve=ue-1;re<ue;ve=re++){const Ce=X[ve],Me=X[re];if(xl(z,U,Ce,Me))return 0;C=Math.min(C,af(z,U,Ce,Me,T))}}return C}function Fm(m,c){for(const f of m)for(const T of f)if(tl(T,c,!0))return!0;return!1}function p0(m,c,f,T=1/0){const C=Ec(m),R=Ec(c);if(T!==1/0&&Om(C,R,f)>=T)return T;if(Oh(C,R)){if(Fm(m,c))return 0}else if(Fm(c,m))return 0;let z=1/0;for(const U of m)for(let X=0,re=U.length,ue=re-1;X<re;ue=X++){const ve=U[ue],Ce=U[X];for(const Me of c)for(let ze=0,Fe=Me.length,$e=Fe-1;ze<Fe;$e=ze++){const it=Me[$e],zt=Me[ze];if(xl(ve,Ce,it,zt))return 0;z=Math.min(z,af(ve,Ce,it,zt,f))}}return z}function _o(m,c,f,T,C,R){if(!R)return;const z=Om(rh(T,R),C,f);z<c&&m.push([z,R,[0,0]])}function Bp(m,c,f,T,C,R,z){if(!R||!z)return;const U=Om(rh(T,R),rh(C,z),f);U<c&&m.push([U,R,z])}function Wf(m,c,f,T,C=1/0){let R=Math.min(T.distance(m[0],f[0][0]),C);if(R===0)return R;const z=new zn([[0,[0,m.length-1],[0,0]]],$a),U=Ec(f);for(;z.length>0;){const X=z.pop();if(X[0]>=R)continue;const re=X[1],ue=c?50:100;if(sf(re)<=ue){if(!il(re,m.length))return NaN;if(c){const ve=f0(m,re,f,T);if(isNaN(ve)||ve===0)return ve;R=Math.min(R,ve)}else for(let ve=re[0];ve<=re[1];++ve){const Ce=vd(m[ve],f,T);if(R=Math.min(R,Ce),R===0)return 0}}else{const ve=Hf(re,c);_o(z,R,T,m,U,ve[0]),_o(z,R,T,m,U,ve[1])}}return R}function ku(m,c,f,T,C,R=1/0){let z=Math.min(R,C.distance(m[0],f[0]));if(z===0)return z;const U=new zn([[0,[0,m.length-1],[0,f.length-1]]],$a);for(;U.length>0;){const X=U.pop();if(X[0]>=z)continue;const re=X[1],ue=X[2],ve=c?50:100,Ce=T?50:100;if(sf(re)<=ve&&sf(ue)<=Ce){if(!il(re,m.length)&&il(ue,f.length))return NaN;let Me;if(c&&T)Me=Fp(m,re,f,ue,C),z=Math.min(z,Me);else if(c&&!T){const ze=m.slice(re[0],re[1]+1);for(let Fe=ue[0];Fe<=ue[1];++Fe)if(Me=uu(f[Fe],ze,C),z=Math.min(z,Me),z===0)return z}else if(!c&&T){const ze=f.slice(ue[0],ue[1]+1);for(let Fe=re[0];Fe<=re[1];++Fe)if(Me=uu(m[Fe],ze,C),z=Math.min(z,Me),z===0)return z}else Me=sh(m,re,f,ue,C),z=Math.min(z,Me)}else{const Me=Hf(re,c),ze=Hf(ue,T);Bp(U,z,C,m,f,Me[0],ze[0]),Bp(U,z,C,m,f,Me[0],ze[1]),Bp(U,z,C,m,f,Me[1],ze[0]),Bp(U,z,C,m,f,Me[1],ze[1])}}return z}function Bm(m){return m.type==="MultiPolygon"?m.coordinates.map((c=>({type:"Polygon",coordinates:c}))):m.type==="MultiLineString"?m.coordinates.map((c=>({type:"LineString",coordinates:c}))):m.type==="MultiPoint"?m.coordinates.map((c=>({type:"Point",coordinates:c}))):[m]}class xd{constructor(c,f){this.type=Ie,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'distance' expression requires exactly one argument, but found ${c.length-1} instead.`);if(fd(c[1])){const T=c[1];if(T.type==="FeatureCollection")return new xd(T,T.features.map((C=>Bm(C.geometry))).flat());if(T.type==="Feature")return new xd(T,Bm(T.geometry));if("type"in T&&"coordinates"in T)return new xd(T,Bm(T))}return f.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return(function(f,T){const C=f.geometry(),R=C.flat().map((X=>th([X.x,X.y],f.canonical)));if(C.length===0)return NaN;const z=new qf(R[0][1]);let U=1/0;for(const X of T){switch(X.type){case"Point":U=Math.min(U,ku(R,!1,[X.coordinates],!1,z,U));break;case"LineString":U=Math.min(U,ku(R,!1,X.coordinates,!0,z,U));break;case"Polygon":U=Math.min(U,Wf(R,!1,X.coordinates,z,U))}if(U===0)return U}return U})(c,this.geometries);if(c.geometryType()==="LineString")return(function(f,T){const C=f.geometry(),R=C.flat().map((X=>th([X.x,X.y],f.canonical)));if(C.length===0)return NaN;const z=new qf(R[0][1]);let U=1/0;for(const X of T){switch(X.type){case"Point":U=Math.min(U,ku(R,!0,[X.coordinates],!1,z,U));break;case"LineString":U=Math.min(U,ku(R,!0,X.coordinates,!0,z,U));break;case"Polygon":U=Math.min(U,Wf(R,!0,X.coordinates,z,U))}if(U===0)return U}return U})(c,this.geometries);if(c.geometryType()==="Polygon")return(function(f,T){const C=f.geometry();if(C.length===0||C[0].length===0)return NaN;const R=rf(C,0).map((X=>X.map((re=>re.map((ue=>th([ue.x,ue.y],f.canonical))))))),z=new qf(R[0][0][0][1]);let U=1/0;for(const X of T)for(const re of R){switch(X.type){case"Point":U=Math.min(U,Wf([X.coordinates],!1,re,z,U));break;case"LineString":U=Math.min(U,Wf(X.coordinates,!0,re,z,U));break;case"Polygon":U=Math.min(U,p0(re,X.coordinates,z,U))}if(U===0)return U}return U})(c,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class bd{constructor(c){this.type=_t,this.key=c}static parse(c,f){if(c.length!==2)return f.error(`Expected 1 argument, but found ${c.length-1} instead.`);const T=c[1];return T==null?f.error("Global state property must be defined."):typeof T!="string"?f.error(`Global state property must be string, but found ${typeof c[1]} instead.`):new bd(T)}evaluate(c){var f;const T=(f=c.globals)===null||f===void 0?void 0:f.globalState;return T&&Object.keys(T).length!==0?Xu(T,this.key):null}eachChild(){}outputDefined(){return!1}}const $c={"==":Qr,"!=":ws,">":Qu,"<":Yl,">=":Qd,"<=":hs,array:Xl,at:Cs,boolean:Xl,case:Au,coalesce:Al,collator:eh,format:Ua,image:Mo,in:ms,"index-of":md,interpolate:Gn,"interpolate-hcl":Gn,"interpolate-lab":Gn,length:$f,let:jo,literal:$r,match:js,number:Xl,"number-format":ef,object:Xl,slice:Jo,step:au,string:Xl,"to-boolean":Ju,"to-color":Ju,"to-number":Ju,"to-string":Ju,var:Rh,within:yr,distance:xd,"global-state":bd};class Kl{constructor(c,f,T,C){this.name=c,this.type=f,this._evaluate=T,this.args=C}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,f){const T=c[0],C=Kl.definitions[T];if(!C)return f.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0);const R=Array.isArray(C)?C[0]:C.type,z=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,U=z.filter((([re])=>!Array.isArray(re)||re.length===c.length-1));let X=null;for(const[re,ue]of U){X=new Cu(f.registry,Zf,f.path,null,f.scope);const ve=[];let Ce=!1;for(let Me=1;Me<c.length;Me++){const ze=c[Me],Fe=Array.isArray(re)?re[Me-1]:re.type,$e=X.parse(ze,1+ve.length,Fe);if(!$e){Ce=!0;break}ve.push($e)}if(!Ce)if(Array.isArray(re)&&re.length!==ve.length)X.error(`Expected ${re.length} arguments, but found ${ve.length} instead.`);else{for(let Me=0;Me<ve.length;Me++){const ze=Array.isArray(re)?re[Me]:re.type,Fe=ve[Me];X.concat(Me+1).checkSubtype(ze,Fe.type)}if(X.errors.length===0)return new Kl(T,R,ue,ve)}}if(U.length===1)f.errors.push(...X.errors);else{const re=(U.length?U:z).map((([ve])=>{return Ce=ve,Array.isArray(Ce)?`(${Ce.map(jn).join(", ")})`:`(${jn(Ce.type)}...)`;var Ce})).join(" | "),ue=[];for(let ve=1;ve<c.length;ve++){const Ce=f.parse(c[ve],1+ue.length);if(!Ce)return null;ue.push(jn(Ce.type))}f.error(`Expected arguments of type ${re}, but found (${ue.join(", ")}) instead.`)}return null}static register(c,f){Kl.definitions=f;for(const T in f)c[T]=Kl}}function Gc(m,[c,f,T,C]){c=c.evaluate(m),f=f.evaluate(m),T=T.evaluate(m);const R=C?C.evaluate(m):1,z=Tc(c,f,T,R);if(z)throw new Zo(z);return new as(c/255,f/255,T/255,R,!1)}function Bg(m,c){return m in c}function wd(m,c){const f=c[m];return f===void 0?null:f}function hu(m){return{type:m}}function Zf(m){if(m instanceof Rh)return Zf(m.boundExpression);if(m instanceof Kl&&m.name==="error"||m instanceof eh||m instanceof yr||m instanceof xd||m instanceof bd)return!1;const c=m instanceof Ju||m instanceof Xl;let f=!0;return m.eachChild((T=>{f=c?f&&Zf(T):f&&T instanceof $r})),!!f&&lf(m)&&cf(m,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function lf(m){if(m instanceof Kl&&(m.name==="get"&&m.args.length===1||m.name==="feature-state"||m.name==="has"&&m.args.length===1||m.name==="properties"||m.name==="geometry-type"||m.name==="id"||/^filter-/.test(m.name))||m instanceof yr||m instanceof xd)return!1;let c=!0;return m.eachChild((f=>{c&&!lf(f)&&(c=!1)})),c}function Bl(m){if(m instanceof Kl&&m.name==="feature-state")return!1;let c=!0;return m.eachChild((f=>{c&&!Bl(f)&&(c=!1)})),c}function cf(m,c){if(m instanceof Kl&&c.indexOf(m.name)>=0)return!1;let f=!0;return m.eachChild((T=>{f&&!cf(T,c)&&(f=!1)})),f}function Ji(m){return{result:"success",value:m}}function Td(m){return{result:"error",value:m}}function Bh(m){return m["property-type"]==="data-driven"||m["property-type"]==="cross-faded-data-driven"}function Np(m){return!!m.expression&&m.expression.parameters.indexOf("zoom")>-1}function Vp(m){return!!m.expression&&m.expression.interpolated}function As(m){return m instanceof Number?"number":m instanceof String?"string":m instanceof Boolean?"boolean":Array.isArray(m)?"array":m===null?"null":typeof m}function qc(m){return typeof m=="object"&&m!==null&&!Array.isArray(m)&&za(m)===Jt}function Ng(m){return m}function Sd(m,c){const f=m.stops&&typeof m.stops[0][0]=="object",T=f||!(f||m.property!==void 0),C=m.type||(Vp(c)?"exponential":"interval"),R=(function(ue){switch(ue.type){case"color":return as.parse;case"padding":return vl.parse;case"numberArray":return Vo.parse;case"colorArray":return Jr.parse;default:return null}})(c);if(R&&((m=Qa({},m)).stops&&(m.stops=m.stops.map((ue=>[ue[0],R(ue[1])]))),m.default=R(m.default?m.default:c.default)),m.colorSpace&&(z=m.colorSpace)!=="rgb"&&z!=="hcl"&&z!=="lab")throw new Error(`Unknown color space: "${m.colorSpace}"`);var z;const U=(function(ue){switch(ue){case"exponential":return Vg;case"interval":return Nm;case"categorical":return Ed;case"identity":return Vm;default:throw new Error(`Unknown function type "${ue}"`)}})(C);let X,re;if(C==="categorical"){X=Object.create(null);for(const ue of m.stops)X[ue[0]]=ue[1];re=typeof m.stops[0][0]}if(f){const ue={},ve=[];for(let ze=0;ze<m.stops.length;ze++){const Fe=m.stops[ze],$e=Fe[0].zoom;ue[$e]===void 0&&(ue[$e]={zoom:$e,type:m.type,property:m.property,default:m.default,stops:[]},ve.push($e)),ue[$e].stops.push([Fe[0].value,Fe[1]])}const Ce=[];for(const ze of ve)Ce.push([ue[ze].zoom,Sd(ue[ze],c)]);const Me={name:"linear"};return{kind:"composite",interpolationType:Me,interpolationFactor:Gn.interpolationFactor.bind(void 0,Me),zoomStops:Ce.map((ze=>ze[0])),evaluate:({zoom:ze},Fe)=>Vg({stops:Ce,base:m.base},c,ze).evaluate(ze,Fe)}}if(T){const ue=C==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:ue,interpolationFactor:Gn.interpolationFactor.bind(void 0,ue),zoomStops:m.stops.map((ve=>ve[0])),evaluate:({zoom:ve})=>U(m,c,ve,X,re)}}return{kind:"source",evaluate(ue,ve){const Ce=ve&&ve.properties?ve.properties[m.property]:void 0;return Ce===void 0?Du(m.default,c.default):U(m,c,Ce,X,re)}}}function Du(m,c,f){return m!==void 0?m:c!==void 0?c:f!==void 0?f:void 0}function Ed(m,c,f,T,C){return Du(typeof f===C?T[f]:void 0,m.default,c.default)}function Nm(m,c,f){if(As(f)!=="number")return Du(m.default,c.default);const T=m.stops.length;if(T===1||f<=m.stops[0][0])return m.stops[0][1];if(f>=m.stops[T-1][0])return m.stops[T-1][1];const C=zh(m.stops.map((R=>R[0])),f);return m.stops[C][1]}function Vg(m,c,f){const T=m.base!==void 0?m.base:1;if(As(f)!=="number")return Du(m.default,c.default);const C=m.stops.length;if(C===1||f<=m.stops[0][0])return m.stops[0][1];if(f>=m.stops[C-1][0])return m.stops[C-1][1];const R=zh(m.stops.map((ue=>ue[0])),f),z=(function(ue,ve,Ce,Me){const ze=Me-Ce,Fe=ue-Ce;return ze===0?0:ve===1?Fe/ze:(Math.pow(ve,Fe)-1)/(Math.pow(ve,ze)-1)})(f,T,m.stops[R][0],m.stops[R+1][0]),U=m.stops[R][1],X=m.stops[R+1][1],re=Xo[c.type]||Ng;return typeof U.evaluate=="function"?{evaluate(...ue){const ve=U.evaluate.apply(void 0,ue),Ce=X.evaluate.apply(void 0,ue);if(ve!==void 0&&Ce!==void 0)return re(ve,Ce,z,m.colorSpace)}}:re(U,X,z,m.colorSpace)}function Vm(m,c,f){switch(c.type){case"color":f=as.parse(f);break;case"formatted":f=cl.fromString(f.toString());break;case"resolvedImage":f=Zl.fromString(f.toString());break;case"padding":f=vl.parse(f);break;case"colorArray":f=Jr.parse(f);break;case"numberArray":f=Vo.parse(f);break;default:As(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0)}return Du(f,m.default,c.default)}Kl.register($c,{error:[{kind:"error"},[qe],(m,[c])=>{throw new Zo(c.evaluate(m))}],typeof:[qe,[_t],(m,[c])=>jn(za(c.evaluate(m)))],"to-rgba":[rr(Ie,4),[ft],(m,[c])=>{const[f,T,C,R]=c.evaluate(m).rgb;return[255*f,255*T,255*C,R]}],rgb:[ft,[Ie,Ie,Ie],Gc],rgba:[ft,[Ie,Ie,Ie,Ie],Gc],has:{type:ot,overloads:[[[qe],(m,[c])=>Bg(c.evaluate(m),m.properties())],[[qe,Jt],(m,[c,f])=>Bg(c.evaluate(m),f.evaluate(m))]]},get:{type:_t,overloads:[[[qe],(m,[c])=>wd(c.evaluate(m),m.properties())],[[qe,Jt],(m,[c,f])=>wd(c.evaluate(m),f.evaluate(m))]]},"feature-state":[_t,[qe],(m,[c])=>wd(c.evaluate(m),m.featureState||{})],properties:[Jt,[],m=>m.properties()],"geometry-type":[qe,[],m=>m.geometryType()],id:[_t,[],m=>m.id()],zoom:[Ie,[],m=>m.globals.zoom],"heatmap-density":[Ie,[],m=>m.globals.heatmapDensity||0],elevation:[Ie,[],m=>m.globals.elevation||0],"line-progress":[Ie,[],m=>m.globals.lineProgress||0],accumulated:[_t,[],m=>m.globals.accumulated===void 0?null:m.globals.accumulated],"+":[Ie,hu(Ie),(m,c)=>{let f=0;for(const T of c)f+=T.evaluate(m);return f}],"*":[Ie,hu(Ie),(m,c)=>{let f=1;for(const T of c)f*=T.evaluate(m);return f}],"-":{type:Ie,overloads:[[[Ie,Ie],(m,[c,f])=>c.evaluate(m)-f.evaluate(m)],[[Ie],(m,[c])=>-c.evaluate(m)]]},"/":[Ie,[Ie,Ie],(m,[c,f])=>c.evaluate(m)/f.evaluate(m)],"%":[Ie,[Ie,Ie],(m,[c,f])=>c.evaluate(m)%f.evaluate(m)],ln2:[Ie,[],()=>Math.LN2],pi:[Ie,[],()=>Math.PI],e:[Ie,[],()=>Math.E],"^":[Ie,[Ie,Ie],(m,[c,f])=>Math.pow(c.evaluate(m),f.evaluate(m))],sqrt:[Ie,[Ie],(m,[c])=>Math.sqrt(c.evaluate(m))],log10:[Ie,[Ie],(m,[c])=>Math.log(c.evaluate(m))/Math.LN10],ln:[Ie,[Ie],(m,[c])=>Math.log(c.evaluate(m))],log2:[Ie,[Ie],(m,[c])=>Math.log(c.evaluate(m))/Math.LN2],sin:[Ie,[Ie],(m,[c])=>Math.sin(c.evaluate(m))],cos:[Ie,[Ie],(m,[c])=>Math.cos(c.evaluate(m))],tan:[Ie,[Ie],(m,[c])=>Math.tan(c.evaluate(m))],asin:[Ie,[Ie],(m,[c])=>Math.asin(c.evaluate(m))],acos:[Ie,[Ie],(m,[c])=>Math.acos(c.evaluate(m))],atan:[Ie,[Ie],(m,[c])=>Math.atan(c.evaluate(m))],min:[Ie,hu(Ie),(m,c)=>Math.min(...c.map((f=>f.evaluate(m))))],max:[Ie,hu(Ie),(m,c)=>Math.max(...c.map((f=>f.evaluate(m))))],abs:[Ie,[Ie],(m,[c])=>Math.abs(c.evaluate(m))],round:[Ie,[Ie],(m,[c])=>{const f=c.evaluate(m);return f<0?-Math.round(-f):Math.round(f)}],floor:[Ie,[Ie],(m,[c])=>Math.floor(c.evaluate(m))],ceil:[Ie,[Ie],(m,[c])=>Math.ceil(c.evaluate(m))],"filter-==":[ot,[qe,_t],(m,[c,f])=>m.properties()[c.value]===f.value],"filter-id-==":[ot,[_t],(m,[c])=>m.id()===c.value],"filter-type-==":[ot,[qe],(m,[c])=>m.geometryType()===c.value],"filter-<":[ot,[qe,_t],(m,[c,f])=>{const T=m.properties()[c.value],C=f.value;return typeof T==typeof C&&T<C}],"filter-id-<":[ot,[_t],(m,[c])=>{const f=m.id(),T=c.value;return typeof f==typeof T&&f<T}],"filter->":[ot,[qe,_t],(m,[c,f])=>{const T=m.properties()[c.value],C=f.value;return typeof T==typeof C&&T>C}],"filter-id->":[ot,[_t],(m,[c])=>{const f=m.id(),T=c.value;return typeof f==typeof T&&f>T}],"filter-<=":[ot,[qe,_t],(m,[c,f])=>{const T=m.properties()[c.value],C=f.value;return typeof T==typeof C&&T<=C}],"filter-id-<=":[ot,[_t],(m,[c])=>{const f=m.id(),T=c.value;return typeof f==typeof T&&f<=T}],"filter->=":[ot,[qe,_t],(m,[c,f])=>{const T=m.properties()[c.value],C=f.value;return typeof T==typeof C&&T>=C}],"filter-id->=":[ot,[_t],(m,[c])=>{const f=m.id(),T=c.value;return typeof f==typeof T&&f>=T}],"filter-has":[ot,[_t],(m,[c])=>c.value in m.properties()],"filter-has-id":[ot,[],m=>m.id()!==null&&m.id()!==void 0],"filter-type-in":[ot,[rr(qe)],(m,[c])=>c.value.indexOf(m.geometryType())>=0],"filter-id-in":[ot,[rr(_t)],(m,[c])=>c.value.indexOf(m.id())>=0],"filter-in-small":[ot,[qe,rr(_t)],(m,[c,f])=>f.value.indexOf(m.properties()[c.value])>=0],"filter-in-large":[ot,[qe,rr(_t)],(m,[c,f])=>(function(T,C,R,z){for(;R<=z;){const U=R+z>>1;if(C[U]===T)return!0;C[U]>T?z=U-1:R=U+1}return!1})(m.properties()[c.value],f.value,0,f.value.length-1)],all:{type:ot,overloads:[[[ot,ot],(m,[c,f])=>c.evaluate(m)&&f.evaluate(m)],[hu(ot),(m,c)=>{for(const f of c)if(!f.evaluate(m))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],(m,[c,f])=>c.evaluate(m)||f.evaluate(m)],[hu(ot),(m,c)=>{for(const f of c)if(f.evaluate(m))return!0;return!1}]]},"!":[ot,[ot],(m,[c])=>!c.evaluate(m)],"is-supported-script":[ot,[qe],(m,[c])=>{const f=m.globals&&m.globals.isSupportedScript;return!f||f(c.evaluate(m))}],upcase:[qe,[qe],(m,[c])=>c.evaluate(m).toUpperCase()],downcase:[qe,[qe],(m,[c])=>c.evaluate(m).toLowerCase()],concat:[qe,hu(_t),(m,c)=>c.map((f=>Iu(f.evaluate(m)))).join("")],"resolved-locale":[qe,[Qt],(m,[c])=>c.evaluate(m).resolvedLocale()]});class jg{constructor(c,f,T){this.expression=c,this._warningHistory={},this._evaluator=new Jd,this._defaultValue=f?(function(C){if(C.type==="color"&&qc(C.default))return new as(0,0,0,0);switch(C.type){case"color":return as.parse(C.default)||null;case"padding":return vl.parse(C.default)||null;case"numberArray":return Vo.parse(C.default)||null;case"colorArray":return Jr.parse(C.default)||null;case"variableAnchorOffsetCollection":return Ko.parse(C.default)||null;case"projectionDefinition":return el.parse(C.default)||null;default:return C.default===void 0?null:C.default}})(f):null,this._enumValues=f&&f.type==="enum"?f.values:null,this._globalState=T}evaluateWithoutErrorHandling(c,f,T,C,R,z){return this._globalState&&(c=df(c,this._globalState)),this._evaluator.globals=c,this._evaluator.feature=f,this._evaluator.featureState=T,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=z,this.expression.evaluate(this._evaluator)}evaluate(c,f,T,C,R,z){this._globalState&&(c=df(c,this._globalState)),this._evaluator.globals=c,this._evaluator.feature=f||null,this._evaluator.featureState=T||null,this._evaluator.canonical=C,this._evaluator.availableImages=R||null,this._evaluator.formattedSection=z||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new Zo(`Expected value to be one of ${Object.keys(this._enumValues).map((X=>JSON.stringify(X))).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(U.message)),this._defaultValue}}}function uf(m){return Array.isArray(m)&&m.length>0&&typeof m[0]=="string"&&m[0]in $c}function hf(m,c,f){const T=new Cu($c,Zf,[],c?(function(R){const z={color:ft,string:qe,number:Ie,enum:qe,boolean:ot,formatted:Ri,padding:xi,numberArray:$n,colorArray:yn,projectionDefinition:Ct,resolvedImage:mn,variableAnchorOffsetCollection:Tr};return R.type==="array"?rr(z[R.value]||_t,R.length):z[R.type]})(c):void 0),C=T.parse(m,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?Ji(new jg(C,c,f)):Td(T.errors)}class Lu{constructor(c,f,T){this.kind=c,this._styleExpression=f,this.isStateDependent=c!=="constant"&&!Bl(f.expression),this.globalStateRefs=oh(f.expression),this._globalState=T}evaluateWithoutErrorHandling(c,f,T,C,R,z){return this._globalState&&(c=df(c,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(c,f,T,C,R,z)}evaluate(c,f,T,C,R,z){return this._globalState&&(c=df(c,this._globalState)),this._styleExpression.evaluate(c,f,T,C,R,z)}}class es{constructor(c,f,T,C,R){this.kind=c,this.zoomStops=T,this._styleExpression=f,this.isStateDependent=c!=="camera"&&!Bl(f.expression),this.globalStateRefs=oh(f.expression),this.interpolationType=C,this._globalState=R}evaluateWithoutErrorHandling(c,f,T,C,R,z){return this._globalState&&(c=df(c,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(c,f,T,C,R,z)}evaluate(c,f,T,C,R,z){return this._globalState&&(c=df(c,this._globalState)),this._styleExpression.evaluate(c,f,T,C,R,z)}interpolationFactor(c,f,T){return this.interpolationType?Gn.interpolationFactor(this.interpolationType,c,f,T):0}}function Ug(m,c,f){const T=hf(m,c,f);if(T.result==="error")return T;const C=T.value.expression,R=lf(C);if(!R&&!Bh(c))return Td([new gl("","data expressions not supported")]);const z=cf(C,["zoom"]);if(!z&&!Np(c))return Td([new gl("","zoom expressions not supported")]);const U=Um(C);return U||z?U instanceof gl?Td([U]):U instanceof Gn&&!Vp(c)?Td([new gl("",'"interpolate" expressions cannot be used with this property')]):Ji(U?new es(R?"camera":"composite",T.value,U.labels,U instanceof Gn?U.interpolation:void 0,f):new Lu(R?"constant":"source",T.value,f)):Td([new gl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jm{constructor(c,f){this._parameters=c,this._specification=f,Qa(this,Sd(this._parameters,this._specification))}static deserialize(c){return new jm(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Um(m){let c=null;if(m instanceof jo)c=Um(m.result);else if(m instanceof Al){for(const f of m.args)if(c=Um(f),c)break}else(m instanceof au||m instanceof Gn)&&m.input instanceof Kl&&m.input.name==="zoom"&&(c=m);return c instanceof gl||m.eachChild((f=>{const T=Um(f);T instanceof gl?c=T:!c&&T?c=new gl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&T&&c!==T&&(c=new gl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),c}function oh(m,c=new Set){return m instanceof bd&&c.add(m.key),m.eachChild((f=>{oh(f,c)})),c}function df(m,c){const{zoom:f,heatmapDensity:T,elevation:C,lineProgress:R,isSupportedScript:z,accumulated:U}=m??{};return{zoom:f,heatmapDensity:T,elevation:C,lineProgress:R,isSupportedScript:z,accumulated:U,globalState:c}}function no(m){if(m===!0||m===!1)return!0;if(!Array.isArray(m)||m.length===0)return!1;switch(m[0]){case"has":return m.length>=2&&m[1]!=="$id"&&m[1]!=="$type";case"in":return m.length>=3&&(typeof m[1]!="string"||Array.isArray(m[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return m.length!==3||Array.isArray(m[1])||Array.isArray(m[2]);case"any":case"all":for(const c of m.slice(1))if(!no(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const m0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xf(m,c){if(m==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};no(m)||(m=ff(m));const f=hf(m,m0,c);if(f.result==="error")throw new Error(f.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return{filter:(T,C,R)=>f.value.evaluate(T,C,{},R),needGeometry:jp(m),getGlobalStateRefs:()=>oh(f.value.expression)}}function $g(m,c){return m<c?-1:m>c?1:0}function jp(m){if(!Array.isArray(m))return!1;if(m[0]==="within"||m[0]==="distance")return!0;for(let c=1;c<m.length;c++)if(jp(m[c]))return!0;return!1}function ff(m){if(!m)return!0;const c=m[0];return m.length<=1?c!=="any":c==="=="?ah(m[1],m[2],"=="):c==="!="?lh(ah(m[1],m[2],"==")):c==="<"||c===">"||c==="<="||c===">="?ah(m[1],m[2],c):c==="any"?(f=m.slice(1),["any"].concat(f.map(ff))):c==="all"?["all"].concat(m.slice(1).map(ff)):c==="none"?["all"].concat(m.slice(1).map(ff).map(lh)):c==="in"?pf(m[1],m.slice(2)):c==="!in"?lh(pf(m[1],m.slice(2))):c==="has"?Yf(m[1]):c!=="!has"||lh(Yf(m[1]));var f}function ah(m,c,f){switch(m){case"$type":return[`filter-type-${f}`,c];case"$id":return[`filter-id-${f}`,c];default:return[`filter-${f}`,m,c]}}function pf(m,c){if(c.length===0)return!1;switch(m){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some((f=>typeof f!=typeof c[0]))?["filter-in-large",m,["literal",c.sort($g)]]:["filter-in-small",m,["literal",c]]}}function Yf(m){switch(m){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",m]}}function lh(m){return["!",m]}function Up(m){const c=typeof m;if(c==="number"||c==="boolean"||c==="string"||m==null)return JSON.stringify(m);if(Array.isArray(m)){let C="[";for(const R of m)C+=`${Up(R)},`;return`${C}]`}const f=Object.keys(m).sort();let T="{";for(let C=0;C<f.length;C++)T+=`${JSON.stringify(f[C])}:${Up(m[f[C]])},`;return`${T}}`}function $m(m){let c="";for(const f of bs)c+=`/${Up(m[f])}`;return c}function Gg(m){const c=m.value;return c?[new Mn(m.key,c,"constants have been deprecated as of v8")]:[]}function ta(m){return m instanceof Number||m instanceof String||m instanceof Boolean?m.valueOf():m}function ch(m){if(Array.isArray(m))return m.map(ch);if(m instanceof Object&&!(m instanceof Number||m instanceof String||m instanceof Boolean)){const c={};for(const f in m)c[f]=ch(m[f]);return c}return ta(m)}function Jl(m){const c=m.key,f=m.value,T=m.valueSpec||{},C=m.objectElementValidators||{},R=m.style,z=m.styleSpec,U=m.validateSpec;let X=[];const re=As(f);if(re!=="object")return[new Mn(c,f,`object expected, ${re} found`)];for(const ue in f){const ve=ue.split(".")[0],Ce=Xu(T,ve)||T["*"];let Me;if(Xu(C,ve))Me=C[ve];else if(Xu(T,ve)){if(f[ue]===void 0)continue;Me=U}else if(C["*"])Me=C["*"];else{if(!T["*"]){X.push(new Mn(c,f[ue],`unknown property "${ue}"`));continue}Me=U}X=X.concat(Me({key:(c&&`${c}.`)+ue,value:f[ue],valueSpec:Ce,style:R,styleSpec:z,object:f,objectKey:ue,validateSpec:U},f))}for(const ue in T)C[ue]||T[ue].required&&T[ue].default===void 0&&f[ue]===void 0&&X.push(new Mn(c,f,`missing required property "${ue}"`));return X}function Kf(m){const c=m.value,f=m.valueSpec,T=m.style,C=m.styleSpec,R=m.key,z=m.arrayElementValidator||m.validateSpec;if(As(c)!=="array")return[new Mn(R,c,`array expected, ${As(c)} found`)];if(f.length&&c.length!==f.length)return[new Mn(R,c,`array length ${f.length} expected, length ${c.length} found`)];let U={type:f.value,values:f.values};C.$version<7&&(U.function=f.function),As(f.value)==="object"&&(U=f.value);let X=[];for(let re=0;re<c.length;re++)X=X.concat(z({array:c,arrayIndex:re,value:c[re],valueSpec:U,validateSpec:m.validateSpec,style:T,styleSpec:C,key:`${R}[${re}]`}));return X}function Id(m){const c=m.key,f=m.value,T=m.valueSpec;let C=As(f);return C==="number"&&f!=f&&(C="NaN"),C!=="number"?[new Mn(c,f,`number expected, ${C} found`)]:"minimum"in T&&f<T.minimum?[new Mn(c,f,`${f} is less than the minimum value ${T.minimum}`)]:"maximum"in T&&f>T.maximum?[new Mn(c,f,`${f} is greater than the maximum value ${T.maximum}`)]:[]}function Cd(m){const c=m.valueSpec,f=ta(m.value.type);let T,C,R,z={};const U=f!=="categorical"&&m.value.property===void 0,X=!U,re=As(m.value.stops)==="array"&&As(m.value.stops[0])==="array"&&As(m.value.stops[0][0])==="object",ue=Jl({key:m.key,value:m.value,valueSpec:m.styleSpec.function,validateSpec:m.validateSpec,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(Me){if(f==="identity")return[new Mn(Me.key,Me.value,'identity function may not have a "stops" property')];let ze=[];const Fe=Me.value;return ze=ze.concat(Kf({key:Me.key,value:Fe,valueSpec:Me.valueSpec,validateSpec:Me.validateSpec,style:Me.style,styleSpec:Me.styleSpec,arrayElementValidator:ve})),As(Fe)==="array"&&Fe.length===0&&ze.push(new Mn(Me.key,Fe,"array must have at least one stop")),ze},default:function(Me){return Me.validateSpec({key:Me.key,value:Me.value,valueSpec:c,validateSpec:Me.validateSpec,style:Me.style,styleSpec:Me.styleSpec})}}});return f==="identity"&&U&&ue.push(new Mn(m.key,m.value,'missing required property "property"')),f==="identity"||m.value.stops||ue.push(new Mn(m.key,m.value,'missing required property "stops"')),f==="exponential"&&m.valueSpec.expression&&!Vp(m.valueSpec)&&ue.push(new Mn(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(X&&!Bh(m.valueSpec)?ue.push(new Mn(m.key,m.value,"property functions not supported")):U&&!Np(m.valueSpec)&&ue.push(new Mn(m.key,m.value,"zoom functions not supported"))),f!=="categorical"&&!re||m.value.property!==void 0||ue.push(new Mn(m.key,m.value,'"property" property is required')),ue;function ve(Me){let ze=[];const Fe=Me.value,$e=Me.key;if(As(Fe)!=="array")return[new Mn($e,Fe,`array expected, ${As(Fe)} found`)];if(Fe.length!==2)return[new Mn($e,Fe,`array length 2 expected, length ${Fe.length} found`)];if(re){if(As(Fe[0])!=="object")return[new Mn($e,Fe,`object expected, ${As(Fe[0])} found`)];if(Fe[0].zoom===void 0)return[new Mn($e,Fe,"object stop key must have zoom")];if(Fe[0].value===void 0)return[new Mn($e,Fe,"object stop key must have value")];if(R&&R>ta(Fe[0].zoom))return[new Mn($e,Fe[0].zoom,"stop zoom values must appear in ascending order")];ta(Fe[0].zoom)!==R&&(R=ta(Fe[0].zoom),C=void 0,z={}),ze=ze.concat(Jl({key:`${$e}[0]`,value:Fe[0],valueSpec:{zoom:{}},validateSpec:Me.validateSpec,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{zoom:Id,value:Ce}}))}else ze=ze.concat(Ce({key:`${$e}[0]`,value:Fe[0],validateSpec:Me.validateSpec,style:Me.style,styleSpec:Me.styleSpec},Fe));return uf(ch(Fe[1]))?ze.concat([new Mn(`${$e}[1]`,Fe[1],"expressions are not allowed in function stops.")]):ze.concat(Me.validateSpec({key:`${$e}[1]`,value:Fe[1],valueSpec:c,validateSpec:Me.validateSpec,style:Me.style,styleSpec:Me.styleSpec}))}function Ce(Me,ze){const Fe=As(Me.value),$e=ta(Me.value),it=Me.value!==null?Me.value:ze;if(T){if(Fe!==T)return[new Mn(Me.key,it,`${Fe} stop domain type must match previous stop domain type ${T}`)]}else T=Fe;if(Fe!=="number"&&Fe!=="string"&&Fe!=="boolean")return[new Mn(Me.key,it,"stop domain value must be a number, string, or boolean")];if(Fe!=="number"&&f!=="categorical"){let zt=`number expected, ${Fe} found`;return Bh(c)&&f===void 0&&(zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mn(Me.key,it,zt)]}return f!=="categorical"||Fe!=="number"||isFinite($e)&&Math.floor($e)===$e?f!=="categorical"&&Fe==="number"&&C!==void 0&&$e<C?[new Mn(Me.key,it,"stop domain values must appear in ascending order")]:(C=$e,f==="categorical"&&$e in z?[new Mn(Me.key,it,"stop domain values must be unique")]:(z[$e]=!0,[])):[new Mn(Me.key,it,`integer expected, found ${$e}`)]}}function Nh(m){const c=(m.expressionContext==="property"?Ug:hf)(ch(m.value),m.valueSpec);if(c.result==="error")return c.value.map((T=>new Mn(`${m.key}${T.key}`,m.value,T.message)));const f=c.value.expression||c.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!f.outputDefined())return[new Mn(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!Bl(f))return[new Mn(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter"&&!Bl(f))return[new Mn(m.key,m.value,'"feature-state" data expressions are not supported with filters.')];if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!cf(f,["zoom","feature-state"]))return[new Mn(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!lf(f))return[new Mn(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jf(m){const c=m.key,f=m.value,T=As(f);return T!=="string"?[new Mn(c,f,`color expected, ${T} found`)]:as.parse(String(f))?[]:[new Mn(c,f,`color expected, "${f}" found`)]}function Ad(m){const c=m.key,f=m.value,T=m.valueSpec,C=[];return Array.isArray(T.values)?T.values.indexOf(ta(f))===-1&&C.push(new Mn(c,f,`expected one of [${T.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(T.values).indexOf(ta(f))===-1&&C.push(new Mn(c,f,`expected one of [${Object.keys(T.values).join(", ")}], ${JSON.stringify(f)} found`)),C}function Ru(m){return no(ch(m.value))?Nh(Qa({},m,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qg(m)}function qg(m){const c=m.value,f=m.key;if(As(c)!=="array")return[new Mn(f,c,`array expected, ${As(c)} found`)];const T=m.styleSpec;let C,R=[];if(c.length<1)return[new Mn(f,c,"filter array must have at least 1 element")];switch(R=R.concat(Ad({key:`${f}[0]`,value:c[0],valueSpec:T.filter_operator,style:m.style,styleSpec:m.styleSpec})),ta(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&ta(c[1])==="$type"&&R.push(new Mn(f,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&R.push(new Mn(f,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(C=As(c[1]),C!=="string"&&R.push(new Mn(`${f}[1]`,c[1],`string expected, ${C} found`)));for(let z=2;z<c.length;z++)C=As(c[z]),ta(c[1])==="$type"?R=R.concat(Ad({key:`${f}[${z}]`,value:c[z],valueSpec:T.geometry_type,style:m.style,styleSpec:m.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&R.push(new Mn(`${f}[${z}]`,c[z],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let z=1;z<c.length;z++)R=R.concat(qg({key:`${f}[${z}]`,value:c[z],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":C=As(c[1]),c.length!==2?R.push(new Mn(f,c,`filter array for "${c[0]}" operator must have 2 elements`)):C!=="string"&&R.push(new Mn(`${f}[1]`,c[1],`string expected, ${C} found`))}return R}function oy(m,c){const f=m.key,T=m.validateSpec,C=m.style,R=m.styleSpec,z=m.value,U=m.objectKey,X=R[`${c}_${m.layerType}`];if(!X)return[];const re=U.match(/^(.*)-transition$/);if(c==="paint"&&re&&X[re[1]]&&X[re[1]].transition)return T({key:f,value:z,valueSpec:R.transition,style:C,styleSpec:R});const ue=m.valueSpec||X[U];if(!ue)return[new Mn(f,z,`unknown property "${U}"`)];let ve;if(As(z)==="string"&&Bh(ue)&&!ue.tokens&&(ve=/^{([^}]+)}$/.exec(z)))return[new Mn(f,z,`"${U}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ve[1])} }\`.`)];const Ce=[];return m.layerType==="symbol"&&U==="text-font"&&qc(ch(z))&&ta(z.type)==="identity"&&Ce.push(new Mn(f,z,'"text-font" does not support identity functions')),Ce.concat(T({key:m.key,value:z,valueSpec:ue,style:C,styleSpec:R,expressionContext:"property",propertyType:c,propertyKey:U}))}function ay(m){return oy(m,"paint")}function ly(m){return oy(m,"layout")}function Gm(m){let c=[];const f=m.value,T=m.key,C=m.style,R=m.styleSpec;if(As(f)!=="object")return[new Mn(T,f,`object expected, ${As(f)} found`)];f.type||f.ref||c.push(new Mn(T,f,'either "type" or "ref" is required'));let z=ta(f.type);const U=ta(f.ref);if(f.id){const X=ta(f.id);for(let re=0;re<m.arrayIndex;re++){const ue=C.layers[re];ta(ue.id)===X&&c.push(new Mn(T,f.id,`duplicate layer id "${f.id}", previously used at line ${ue.id.__line__}`))}}if("ref"in f){let X;["type","source","source-layer","filter","layout"].forEach((re=>{re in f&&c.push(new Mn(T,f[re],`"${re}" is prohibited for ref layers`))})),C.layers.forEach((re=>{ta(re.id)===U&&(X=re)})),X?X.ref?c.push(new Mn(T,f.ref,"ref cannot reference another ref layer")):z=ta(X.type):c.push(new Mn(T,f.ref,`ref layer "${U}" not found`))}else if(z!=="background")if(f.source){const X=C.sources&&C.sources[f.source],re=X&&ta(X.type);X?re==="vector"&&z==="raster"?c.push(new Mn(T,f.source,`layer "${f.id}" requires a raster source`)):re!=="raster-dem"&&z==="hillshade"||re!=="raster-dem"&&z==="color-relief"?c.push(new Mn(T,f.source,`layer "${f.id}" requires a raster-dem source`)):re==="raster"&&z!=="raster"?c.push(new Mn(T,f.source,`layer "${f.id}" requires a vector source`)):re!=="vector"||f["source-layer"]?re==="raster-dem"&&z!=="hillshade"&&z!=="color-relief"?c.push(new Mn(T,f.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):z!=="line"||!f.paint||!f.paint["line-gradient"]||re==="geojson"&&X.lineMetrics||c.push(new Mn(T,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Mn(T,f,`layer "${f.id}" must specify a "source-layer"`)):c.push(new Mn(T,f.source,`source "${f.source}" not found`))}else c.push(new Mn(T,f,'missing required property "source"'));return c=c.concat(Jl({key:T,value:f,valueSpec:R.layer,style:m.style,styleSpec:m.styleSpec,validateSpec:m.validateSpec,objectElementValidators:{"*":()=>[],type:()=>m.validateSpec({key:`${T}.type`,value:f.type,valueSpec:R.layer.type,style:m.style,styleSpec:m.styleSpec,validateSpec:m.validateSpec,object:f,objectKey:"type"}),filter:Ru,layout:X=>Jl({layer:f,key:X.key,value:X.value,style:X.style,styleSpec:X.styleSpec,validateSpec:X.validateSpec,objectElementValidators:{"*":re=>ly(Qa({layerType:z},re))}}),paint:X=>Jl({layer:f,key:X.key,value:X.value,style:X.style,styleSpec:X.styleSpec,validateSpec:X.validateSpec,objectElementValidators:{"*":re=>ay(Qa({layerType:z},re))}})}})),c}function uh(m){const c=m.value,f=m.key,T=As(c);return T!=="string"?[new Mn(f,c,`string expected, ${T} found`)]:[]}const $p={promoteId:function({key:m,value:c}){if(As(c)==="string")return uh({key:m,value:c});{const f=[];for(const T in c)f.push(...uh({key:`${m}.${T}`,value:c[T]}));return f}}};function Gp(m){const c=m.value,f=m.key,T=m.styleSpec,C=m.style,R=m.validateSpec;if(!c.type)return[new Mn(f,c,'"type" is required')];const z=ta(c.type);let U;switch(z){case"vector":case"raster":return U=Jl({key:f,value:c,valueSpec:T[`source_${z.replace("-","_")}`],style:m.style,styleSpec:T,objectElementValidators:$p,validateSpec:R}),U;case"raster-dem":return U=(function(X){var re;const ue=(re=X.sourceName)!==null&&re!==void 0?re:"",ve=X.value,Ce=X.styleSpec,Me=Ce.source_raster_dem,ze=X.style;let Fe=[];const $e=As(ve);if(ve===void 0)return Fe;if($e!=="object")return Fe.push(new Mn("source_raster_dem",ve,`object expected, ${$e} found`)),Fe;const it=ta(ve.encoding)==="custom",zt=["redFactor","greenFactor","blueFactor","baseShift"],lt=X.value.encoding?`"${X.value.encoding}"`:"Default";for(const gt in ve)!it&&zt.includes(gt)?Fe.push(new Mn(gt,ve[gt],`In "${ue}": "${gt}" is only valid when "encoding" is set to "custom". ${lt} encoding found`)):Me[gt]?Fe=Fe.concat(X.validateSpec({key:gt,value:ve[gt],valueSpec:Me[gt],validateSpec:X.validateSpec,style:ze,styleSpec:Ce})):Fe.push(new Mn(gt,ve[gt],`unknown property "${gt}"`));return Fe})({sourceName:f,value:c,style:m.style,styleSpec:T,validateSpec:R}),U;case"geojson":if(U=Jl({key:f,value:c,valueSpec:T.source_geojson,style:C,styleSpec:T,validateSpec:R,objectElementValidators:$p}),c.cluster)for(const X in c.clusterProperties){const[re,ue]=c.clusterProperties[X],ve=typeof re=="string"?[re,["accumulated"],["get",X]]:re;U.push(...Nh({key:`${f}.${X}.map`,value:ue,expressionContext:"cluster-map"})),U.push(...Nh({key:`${f}.${X}.reduce`,value:ve,expressionContext:"cluster-reduce"}))}return U;case"video":return Jl({key:f,value:c,valueSpec:T.source_video,style:C,validateSpec:R,styleSpec:T});case"image":return Jl({key:f,value:c,valueSpec:T.source_image,style:C,validateSpec:R,styleSpec:T});case"canvas":return[new Mn(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ad({key:`${f}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Qf(m){const c=m.value,f=m.styleSpec,T=f.light,C=m.style;let R=[];const z=As(c);if(c===void 0)return R;if(z!=="object")return R=R.concat([new Mn("light",c,`object expected, ${z} found`)]),R;for(const U in c){const X=U.match(/^(.*)-transition$/);R=R.concat(X&&T[X[1]]&&T[X[1]].transition?m.validateSpec({key:U,value:c[U],valueSpec:f.transition,validateSpec:m.validateSpec,style:C,styleSpec:f}):T[U]?m.validateSpec({key:U,value:c[U],valueSpec:T[U],validateSpec:m.validateSpec,style:C,styleSpec:f}):[new Mn(U,c[U],`unknown property "${U}"`)])}return R}function qp(m){const c=m.value,f=m.styleSpec,T=f.sky,C=m.style,R=As(c);if(c===void 0)return[];if(R!=="object")return[new Mn("sky",c,`object expected, ${R} found`)];let z=[];for(const U in c)z=z.concat(T[U]?m.validateSpec({key:U,value:c[U],valueSpec:T[U],style:C,styleSpec:f}):[new Mn(U,c[U],`unknown property "${U}"`)]);return z}function ep(m){const c=m.value,f=m.styleSpec,T=f.terrain,C=m.style;let R=[];const z=As(c);if(c===void 0)return R;if(z!=="object")return R=R.concat([new Mn("terrain",c,`object expected, ${z} found`)]),R;for(const U in c)R=R.concat(T[U]?m.validateSpec({key:U,value:c[U],valueSpec:T[U],validateSpec:m.validateSpec,style:C,styleSpec:f}):[new Mn(U,c[U],`unknown property "${U}"`)]);return R}function Pd(m){let c=[];const f=m.value,T=m.key;if(Array.isArray(f)){const C=[],R=[];for(const z in f)f[z].id&&C.includes(f[z].id)&&c.push(new Mn(T,f,`all the sprites' ids must be unique, but ${f[z].id} is duplicated`)),C.push(f[z].id),f[z].url&&R.includes(f[z].url)&&c.push(new Mn(T,f,`all the sprites' URLs must be unique, but ${f[z].url} is duplicated`)),R.push(f[z].url),c=c.concat(Jl({key:`${T}[${z}]`,value:f[z],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:m.validateSpec}));return c}return uh({key:T,value:f})}function tp(m){return!!m&&m.constructor===Object}function qm(m){return tp(m.value)?[]:[new Mn(m.key,m.value,`object expected, ${As(m.value)} found`)]}const fc={"*":()=>[],array:Kf,boolean:function(m){const c=m.value,f=m.key,T=As(c);return T!=="boolean"?[new Mn(f,c,`boolean expected, ${T} found`)]:[]},number:Id,color:Jf,constants:Gg,enum:Ad,filter:Ru,function:Cd,layer:Gm,object:Jl,source:Gp,light:Qf,sky:qp,terrain:ep,projection:function(m){const c=m.value,f=m.styleSpec,T=f.projection,C=m.style,R=As(c);if(c===void 0)return[];if(R!=="object")return[new Mn("projection",c,`object expected, ${R} found`)];let z=[];for(const U in c)z=z.concat(T[U]?m.validateSpec({key:U,value:c[U],valueSpec:T[U],style:C,styleSpec:f}):[new Mn(U,c[U],`unknown property "${U}"`)]);return z},projectionDefinition:function(m){const c=m.key;let f=m.value;f=f instanceof String?f.valueOf():f;const T=As(f);return T!=="array"||(function(C){return Array.isArray(C)&&C.length===3&&typeof C[0]=="string"&&typeof C[1]=="string"&&typeof C[2]=="number"})(f)||(function(C){return!!["interpolate","step","literal"].includes(C[0])})(f)?["array","string"].includes(T)?[]:[new Mn(c,f,`projection expected, invalid type "${T}" found`)]:[new Mn(c,f,`projection expected, invalid array ${JSON.stringify(f)} found`)]},string:uh,formatted:function(m){return uh(m).length===0?[]:Nh(m)},resolvedImage:function(m){return uh(m).length===0?[]:Nh(m)},padding:function(m){const c=m.key,f=m.value;if(As(f)==="array"){if(f.length<1||f.length>4)return[new Mn(c,f,`padding requires 1 to 4 values; ${f.length} values found`)];const T={type:"number"};let C=[];for(let R=0;R<f.length;R++)C=C.concat(m.validateSpec({key:`${c}[${R}]`,value:f[R],validateSpec:m.validateSpec,valueSpec:T}));return C}return Id({key:c,value:f,valueSpec:{}})},numberArray:function(m){const c=m.key,f=m.value;if(As(f)==="array"){const T={type:"number"};if(f.length<1)return[new Mn(c,f,"array length at least 1 expected, length 0 found")];let C=[];for(let R=0;R<f.length;R++)C=C.concat(m.validateSpec({key:`${c}[${R}]`,value:f[R],validateSpec:m.validateSpec,valueSpec:T}));return C}return Id({key:c,value:f,valueSpec:{}})},colorArray:function(m){const c=m.key,f=m.value;if(As(f)==="array"){if(f.length<1)return[new Mn(c,f,"array length at least 1 expected, length 0 found")];let T=[];for(let C=0;C<f.length;C++)T=T.concat(Jf({key:`${c}[${C}]`,value:f[C]}));return T}return Jf({key:c,value:f})},variableAnchorOffsetCollection:function(m){const c=m.key,f=m.value,T=As(f),C=m.styleSpec;if(T!=="array"||f.length<1||f.length%2!=0)return[new Mn(c,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let R=[];for(let z=0;z<f.length;z+=2)R=R.concat(Ad({key:`${c}[${z}]`,value:f[z],valueSpec:C.layout_symbol["text-anchor"]})),R=R.concat(Kf({key:`${c}[${z+1}]`,value:f[z+1],valueSpec:{length:2,value:"number"},validateSpec:m.validateSpec,style:m.style,styleSpec:C}));return R},sprite:Pd,state:qm,fontFaces:function(m){const c=m.key,f=m.value,T=m.validateSpec,C=m.styleSpec,R=m.style;if(!tp(f))return[new Mn(c,f,`object expected, ${As(f)} found`)];const z=[];for(const U in f){const X=f[U],re=As(X);if(re==="string")z.push(...uh({key:`${c}.${U}`,value:X}));else if(re==="array"){const ue={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[ve,Ce]of X.entries())z.push(...Jl({key:`${c}.${U}[${ve}]`,value:Ce,valueSpec:ue,styleSpec:C,style:R,validateSpec:T}))}else z.push(new Mn(`${c}.${U}`,X,`string or array expected, ${re} found`))}return z}};function zu(m){const c=m.value,f=m.valueSpec,T=m.styleSpec;return m.validateSpec=zu,f.expression&&qc(ta(c))?Cd(m):f.expression&&uf(ch(c))?Nh(m):f.type&&fc[f.type]?fc[f.type](m):Jl(Qa({},m,{valueSpec:f.type?T[f.type]:f}))}function ip(m){const c=m.value,f=m.key,T=uh(m);return T.length||(c.indexOf("{fontstack}")===-1&&T.push(new Mn(f,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&T.push(new Mn(f,c,'"glyphs" url must include a "{range}" token'))),T}function ul(m,c=mi){let f=[];return f=f.concat(zu({key:"",value:m,valueSpec:c.$root,styleSpec:c,style:m,validateSpec:zu,objectElementValidators:{glyphs:ip,"*":()=>[]}})),m.constants&&(f=f.concat(Gg({key:"constants",value:m.constants}))),Hp(f)}function Ic(m){return function(c){return m(Object.assign({},c,{validateSpec:zu}))}}function Hp(m){return[].concat(m).sort(((c,f)=>c.line-f.line))}function Hc(m){return function(...c){return Hp(m.apply(this,c))}}ul.source=Hc(Ic(Gp)),ul.sprite=Hc(Ic(Pd)),ul.glyphs=Hc(Ic(ip)),ul.light=Hc(Ic(Qf)),ul.sky=Hc(Ic(qp)),ul.terrain=Hc(Ic(ep)),ul.state=Hc(Ic(qm)),ul.layer=Hc(Ic(Gm)),ul.filter=Hc(Ic(Ru)),ul.paintProperty=Hc(Ic(ay)),ul.layoutProperty=Hc(Ic(ly));const np={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Vh{constructor(c,f){this._globalState=f,this.setValue(c)}evaluate(){var c;return(c=this._literalValue)!==null&&c!==void 0?c:this._compiledValue.evaluate({})}setValue(c){if(c==null||c==="visible"||c==="none")return this._literalValue=c==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const f=hf(c,np,this._globalState);if(f.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(f.value.map((T=>`${T.key}: ${T.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=f.value,this._globalStateRefs=oh(f.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const jh=mi,nl=ul,mf=nl.light,Hm=nl.sky,Hg=nl.paintProperty,rp=nl.layoutProperty;function sp(m,c){let f=!1;if(c&&c.length)for(const T of c)m.fire(new xo(new Error(T.message))),f=!0;return f}class op{constructor(c,f,T){const C=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const z=new Int32Array(this.arrayBuffer);c=z[0],this.d=(f=z[1])+2*(T=z[2]);for(let X=0;X<this.d*this.d;X++){const re=z[3+X],ue=z[3+X+1];C.push(re===ue?null:z.subarray(re,ue))}const U=z[3+C.length+1];this.keys=z.subarray(z[3+C.length],U),this.bboxes=z.subarray(U),this.insert=this._insertReadonly}else{this.d=f+2*T;for(let z=0;z<this.d*this.d;z++)C.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=T,this.scale=f/c,this.uid=0;const R=T/f*c;this.min=-R,this.max=c+R}insert(c,f,T,C,R){this._forEachCell(f,T,C,R,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(T),this.bboxes.push(C),this.bboxes.push(R)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,f,T,C,R,z){this.cells[R].push(z)}query(c,f,T,C,R){const z=this.min,U=this.max;if(c<=z&&f<=z&&U<=T&&U<=C&&!R)return Array.prototype.slice.call(this.keys);{const X=[];return this._forEachCell(c,f,T,C,this._queryCell,X,{},R),X}}_queryCell(c,f,T,C,R,z,U,X){const re=this.cells[R];if(re!==null){const ue=this.keys,ve=this.bboxes;for(let Ce=0;Ce<re.length;Ce++){const Me=re[Ce];if(U[Me]===void 0){const ze=4*Me;(X?X(ve[ze+0],ve[ze+1],ve[ze+2],ve[ze+3]):c<=ve[ze+2]&&f<=ve[ze+3]&&T>=ve[ze+0]&&C>=ve[ze+1])?(U[Me]=!0,z.push(ue[Me])):U[Me]=!1}}}}_forEachCell(c,f,T,C,R,z,U,X){const re=this._convertToCellCoord(c),ue=this._convertToCellCoord(f),ve=this._convertToCellCoord(T),Ce=this._convertToCellCoord(C);for(let Me=re;Me<=ve;Me++)for(let ze=ue;ze<=Ce;ze++){const Fe=this.d*ze+Me;if((!X||X(this._convertFromCellCoord(Me),this._convertFromCellCoord(ze),this._convertFromCellCoord(Me+1),this._convertFromCellCoord(ze+1)))&&R.call(this,c,f,T,C,Fe,z,U,X))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,f=3+this.cells.length+1+1;let T=0;for(let z=0;z<this.cells.length;z++)T+=this.cells[z].length;const C=new Int32Array(f+T+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;let R=f;for(let z=0;z<c.length;z++){const U=c[z];C[3+z]=R,C.set(U,R),R+=U.length}return C[3+c.length]=R,C.set(this.keys,R),R+=this.keys.length,C[3+c.length+1]=R,C.set(this.bboxes,R),R+=this.bboxes.length,C.buffer}static serialize(c,f){const T=c.toArrayBuffer();return f&&f.push(T),{buffer:T}}static deserialize(c){return new op(c.buffer)}}const du={};function ur(m,c,f={}){if(du[m])throw new Error(`${m} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:m,writeable:!1}),du[m]={klass:c,omit:f.omit||[],shallow:f.shallow||[]}}ur("Object",Object),ur("Set",Set),ur("TransferableGridIndex",op),ur("Color",as),ur("Error",Error),ur("AJAXError",ii),ur("ResolvedImage",Zl),ur("StylePropertyFunction",jm),ur("StyleExpression",jg,{omit:["_evaluator"]}),ur("ZoomDependentExpression",es),ur("ZoomConstantExpression",Lu),ur("CompoundExpression",Kl,{omit:["_evaluate"]});for(const m in $c)$c[m]._classRegistryKey||ur(`Expression_${m}`,$c[m]);function gf(m){return m&&typeof ArrayBuffer<"u"&&(m instanceof ArrayBuffer||m.constructor&&m.constructor.name==="ArrayBuffer")}function Wg(m){return m.$name||m.constructor._classRegistryKey}function Uh(m){return!(function(c){if(c===null||typeof c!="object")return!1;const f=Wg(c);return!(!f||f==="Object")})(m)&&(m==null||typeof m=="boolean"||typeof m=="number"||typeof m=="string"||m instanceof Boolean||m instanceof Number||m instanceof String||m instanceof Date||m instanceof RegExp||m instanceof Blob||m instanceof Error||gf(m)||pt(m)||ArrayBuffer.isView(m)||m instanceof ImageData)}function _f(m,c){if(Uh(m))return(gf(m)||pt(m))&&c&&c.push(m),ArrayBuffer.isView(m)&&c&&c.push(m.buffer),m instanceof ImageData&&c&&c.push(m.data.buffer),m;if(Array.isArray(m)){const R=[];for(const z of m)R.push(_f(z,c));return R}if(typeof m!="object")throw new Error("can't serialize object of type "+typeof m);const f=Wg(m);if(!f)throw new Error(`can't serialize object of unregistered class ${m.constructor.name}`);if(!du[f])throw new Error(`${f} is not registered.`);const{klass:T}=du[f],C=T.serialize?T.serialize(m,c):{};if(T.serialize){if(c&&C===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const R in m){if(!m.hasOwnProperty(R)||du[f].omit.indexOf(R)>=0)continue;const z=m[R];C[R]=du[f].shallow.indexOf(R)>=0?z:_f(z,c)}m instanceof Error&&(C.message=m.message)}if(C.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(C.$name=f),C}function ap(m){if(Uh(m))return m;if(Array.isArray(m))return m.map(ap);if(typeof m!="object")throw new Error("can't deserialize object of type "+typeof m);const c=Wg(m)||"Object";if(!du[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:f}=du[c];if(!f)throw new Error(`can't deserialize unregistered class ${c}`);if(f.deserialize)return f.deserialize(m);const T=Object.create(f.prototype);for(const C of Object.keys(m)){if(C==="$name")continue;const R=m[C];T[C]=du[c].shallow.indexOf(C)>=0?R:ap(R)}return T}class Md{constructor(){this.first=!0}update(c,f){const T=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=T,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=T,!0):(this.lastFloorZoom>T?(this.lastIntegerZoom=T+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<T&&(this.lastIntegerZoom=T,this.lastIntegerZoomTime=f),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=T,!0))}}function yf(m){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(m))}function Wp(m){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(m))}function Zg(m){return/\s/u.test(String.fromCodePoint(m))}function kd(m){for(const c of m)if(Wp(c.codePointAt(0)))return!0;return!1}function Dd(m){for(const c of m)if(!Xg(c.codePointAt(0)))return!1;return!0}function hh(m){const c=m.map((f=>{try{return new RegExp(`\\p{sc=${f}}`,"u").source}catch{return null}})).filter((f=>f));return new RegExp(c.join("|"),"u")}const vf=hh(["Arab","Dupl","Mong","Ougr","Syrc"]);function Xg(m){return!vf.test(String.fromCodePoint(m))}function dh(m){return!(Wp(m)||(c=m,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(c))));var c}const Wm=hh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xf(m){return Wm.test(String.fromCodePoint(m))}function Zm(m,c){return!(!c&&xf(m)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(m)))}function Yg(m){for(const c of m)if(xf(c.codePointAt(0)))return!0;return!1}const Ou=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(m){this.pluginStatus=m.pluginStatus,this.pluginURL=m.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(m){if(Ou.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=m.applyArabicShaping,this.processBidirectionalText=m.processBidirectionalText,this.processStyledBidirectionalText=m.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(m,c){return t(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(m.pluginStatus!=="loading")return this.setState(m),m;const f=m.pluginURL,T=new Promise((R=>{this.loadScriptResolve=R}));c(f);const C=new Promise((R=>setTimeout((()=>R()),this.TIMEOUT)));if(yield Promise.race([T,C]),this.isParsed()){const R={pluginStatus:"loaded",pluginURL:f};return this.setState(R),R}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${f}`)}))}};class To{constructor(c,f){this.isSupportedScript=cy,this.zoom=c,f?(this.now=f.now||0,this.fadeDuration=f.fadeDuration||0,this.zoomHistory=f.zoomHistory||new Md,this.transition=f.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Md,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,f=c-Math.floor(c),T=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*T}:{fromScale:.5,toScale:1,t:1-(1-T)*f}}}function cy(m){return(function(c,f){for(const T of c)if(!Zm(T.codePointAt(0),f))return!1;return!0})(m,Ou.getRTLTextPluginStatus()==="loaded")}const lp="-transition";class Wc{constructor(c,f,T){this.property=c,this.value=f,this.expression=(function(C,R,z){if(qc(C))return new jm(C,R);if(uf(C)){const U=Ug(C,R,z);if(U.result==="error")throw new Error(U.value.map((X=>`${X.key}: ${X.message}`)).join(", "));return U.value}{let U=C;return R.type==="color"&&typeof C=="string"?U=as.parse(C):R.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?R.type!=="numberArray"||typeof C!="number"&&!Array.isArray(C)?R.type!=="colorArray"||typeof C!="string"&&!Array.isArray(C)?R.type==="variableAnchorOffsetCollection"&&Array.isArray(C)?U=Ko.parse(C):R.type==="projectionDefinition"&&typeof C=="string"&&(U=el.parse(C)):U=Jr.parse(C):U=Vo.parse(C):U=vl.parse(C),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>U}}})(f===void 0?c.specification.default:f,c.specification,T)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(c,f,T){return this.property.possiblyEvaluate(this,c,f,T)}}class Xm{constructor(c,f){this.property=c,this.value=new Wc(c,void 0,f)}transitioned(c,f){return new Jg(this.property,this.value,f,sn({},c.transition,this.transition),c.now)}untransitioned(){return new Jg(this.property,this.value,null,{},0)}}class Kg{constructor(c,f){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues),this._globalState=f}getValue(c){return Ur(this._values[c].value.value)}setValue(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Xm(this._values[c].property,this._globalState)),this._values[c].value=new Wc(this._values[c].property,f===null?void 0:Ur(f),this._globalState)}getTransition(c){return Ur(this._values[c].transition)}setTransition(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Xm(this._values[c].property,this._globalState)),this._values[c].transition=Ur(f)||void 0}serialize(){const c={};for(const f of Object.keys(this._values)){const T=this.getValue(f);T!==void 0&&(c[f]=T);const C=this.getTransition(f);C!==void 0&&(c[`${f}${lp}`]=C)}return c}transitioned(c,f){const T=new Qg(this._properties);for(const C of Object.keys(this._values))T._values[C]=this._values[C].transitioned(c,f._values[C]);return T}untransitioned(){const c=new Qg(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].untransitioned();return c}}class Jg{constructor(c,f,T,C,R){this.property=c,this.value=f,this.begin=R+C.delay||0,this.end=this.begin+C.duration||0,c.specification.transition&&(C.delay||C.duration)&&(this.prior=T)}possiblyEvaluate(c,f,T){const C=c.now||0,R=this.value.possiblyEvaluate(c,f,T),z=this.prior;if(z){if(C>this.end)return this.prior=null,R;if(this.value.isDataDriven())return this.prior=null,R;if(C<this.begin)return z.possiblyEvaluate(c,f,T);{const U=(C-this.begin)/(this.end-this.begin);return this.property.interpolate(z.possiblyEvaluate(c,f,T),R,Fn(U))}}return R}}class Qg{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,f,T){const C=new fu(this._properties);for(const R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(c,f,T);return C}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class Zp{constructor(c,f){this._properties=c,this._values=Object.create(c.defaultPropertyValues),this._globalState=f}hasValue(c){return this._values[c].value!==void 0}getValue(c){return Ur(this._values[c].value)}setValue(c,f){this._values[c]=new Wc(this._values[c].property,f===null?void 0:Ur(f),this._globalState)}serialize(){const c={};for(const f of Object.keys(this._values)){const T=this.getValue(f);T!==void 0&&(c[f]=T)}return c}possiblyEvaluate(c,f,T){const C=new fu(this._properties);for(const R of Object.keys(this._values))C._values[R]=this._values[R].possiblyEvaluate(c,f,T);return C}}class pc{constructor(c,f,T){this.property=c,this.value=f,this.parameters=T}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,f,T,C){return this.property.evaluate(this.value,this.parameters,c,f,T,C)}}class fu{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class vr{constructor(c){this.specification=c}possiblyEvaluate(c,f){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(f)}interpolate(c,f,T){const C=Xo[this.specification.type];return C?C(c,f,T):c}}class Cr{constructor(c,f){this.specification=c,this.overrides=f}possiblyEvaluate(c,f,T,C){return new pc(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(f,null,{},T,C)}:c.expression,f)}interpolate(c,f,T){if(c.value.kind!=="constant"||f.value.kind!=="constant")return c;if(c.value.value===void 0||f.value.value===void 0)return new pc(this,{kind:"constant",value:void 0},c.parameters);const C=Xo[this.specification.type];if(C){const R=C(c.value.value,f.value.value,T);return new pc(this,{kind:"constant",value:R},c.parameters)}return c}evaluate(c,f,T,C,R,z){return c.kind==="constant"?c.value:c.evaluate(f,T,C,R,z)}}class bf extends Cr{possiblyEvaluate(c,f,T,C){if(c.value===void 0)return new pc(this,{kind:"constant",value:void 0},f);if(c.expression.kind==="constant"){const R=c.expression.evaluate(f,null,{},T,C),z=c.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,U=this._calculate(z,z,z,f);return new pc(this,{kind:"constant",value:U},f)}if(c.expression.kind==="camera"){const R=this._calculate(c.expression.evaluate({zoom:f.zoom-1}),c.expression.evaluate({zoom:f.zoom}),c.expression.evaluate({zoom:f.zoom+1}),f);return new pc(this,{kind:"constant",value:R},f)}return new pc(this,c.expression,f)}evaluate(c,f,T,C,R,z){if(c.kind==="source"){const U=c.evaluate(f,T,C,R,z);return this._calculate(U,U,U,f)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(f.zoom)-1},T,C),c.evaluate({zoom:Math.floor(f.zoom)},T,C),c.evaluate({zoom:Math.floor(f.zoom)+1},T,C),f):c.value}_calculate(c,f,T,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:T,to:f}}interpolate(c){return c}}class wf{constructor(c){this.specification=c}possiblyEvaluate(c,f,T,C){if(c.value!==void 0){if(c.expression.kind==="constant"){const R=c.expression.evaluate(f,null,{},T,C);return this._calculate(R,R,R,f)}return this._calculate(c.expression.evaluate(new To(Math.floor(f.zoom-1),f)),c.expression.evaluate(new To(Math.floor(f.zoom),f)),c.expression.evaluate(new To(Math.floor(f.zoom+1),f)),f)}}_calculate(c,f,T,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:T,to:f}}interpolate(c){return c}}class Cc{constructor(c){this.specification=c}possiblyEvaluate(c,f,T,C){return!!c.expression.evaluate(f,null,{},T,C)}interpolate(){return!1}}class Nl{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in c){const T=c[f];T.specification.overridable&&this.overridableProperties.push(f);const C=this.defaultPropertyValues[f]=new Wc(T,void 0,void 0),R=this.defaultTransitionablePropertyValues[f]=new Xm(T,void 0);this.defaultTransitioningPropertyValues[f]=R.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=C.possiblyEvaluate({})}}}ur("DataDrivenProperty",Cr),ur("DataConstantProperty",vr),ur("CrossFadedDataDrivenProperty",bf),ur("CrossFadedProperty",wf),ur("ColorRampProperty",Cc);class Zc extends Js{constructor(c,f,T){if(super(),this.id=c.id,this.type=c.type,this._globalState=T,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,this._visibilityExpression=(function(C,R){return new Vh(C,R)})(this.visibility,T),c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter,this._featureFilter=Xf(c.filter,T)),f.layout&&(this._unevaluatedLayout=new Zp(f.layout,T)),f.paint)){this._transitionablePaint=new Kg(f.paint,T);for(const C in c.paint)this.setPaintProperty(C,c.paint[C],{validate:!1});for(const C in c.layout)this.setLayoutProperty(C,c.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fu(f.paint)}}setFilter(c){this.filter=c,this._featureFilter=Xf(c,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}getLayoutAffectingGlobalStateRefs(){const c=new Set;for(const f of this._visibilityExpression.getGlobalStateRefs())c.add(f);if(this._unevaluatedLayout)for(const f in this._unevaluatedLayout._values){const T=this._unevaluatedLayout._values[f];for(const C of T.getGlobalStateRefs())c.add(C)}for(const f of this._featureFilter.getGlobalStateRefs())c.add(f);return c}getPaintAffectingGlobalStateRefs(){var c;const f=new globalThis.Map;if(this._transitionablePaint)for(const T in this._transitionablePaint._values){const C=this._transitionablePaint._values[T].value;for(const R of C.getGlobalStateRefs()){const z=(c=f.get(R))!==null&&c!==void 0?c:[];z.push({name:T,value:C.value}),f.set(R,z)}}return f}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(c,f,T={}){if(f==null||!this._validate(rp,`layers.${this.id}.layout.${c}`,c,f,T))return c==="visibility"?(this.visibility=f,this._visibilityExpression.setValue(f),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(c,f)}getPaintProperty(c){return c.endsWith(lp)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,f,T={}){if(f!=null&&this._validate(Hg,`layers.${this.id}.paint.${c}`,c,f,T))return!1;if(c.endsWith(lp))return this._transitionablePaint.setTransition(c.slice(0,-11),f||void 0),!1;{const C=this._transitionablePaint._values[c],R=C.property.specification["property-type"]==="cross-faded-data-driven",z=C.value.isDataDriven(),U=C.value;this._transitionablePaint.setValue(c,f),this._handleSpecialPaintPropertyUpdate(c);const X=this._transitionablePaint._values[c].value;return X.isDataDriven()||z||R||this._handleOverridablePaintPropertyUpdate(c,U,X)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,f,T){return!1}isHidden(c=this.minzoom,f=!1){return!!(this.minzoom&&c<(f?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&c>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(c,f){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,f)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),nr(c,((f,T)=>!(f===void 0||T==="layout"&&!Object.keys(f).length||T==="paint"&&!Object.keys(f).length)))}_validate(c,f,T,C,R={}){return(!R||R.validate!==!1)&&sp(this,c.call(nl,{key:f,layerType:this.type,objectKey:T,value:C,styleSpec:mi,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const f=this.paint.get(c);if(f instanceof pc&&Bh(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}let Ym;var Tf={get paint(){return Ym=Ym||new Nl({"raster-opacity":new vr(mi.paint_raster["raster-opacity"]),"raster-hue-rotate":new vr(mi.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vr(mi.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vr(mi.paint_raster["raster-brightness-max"]),"raster-saturation":new vr(mi.paint_raster["raster-saturation"]),"raster-contrast":new vr(mi.paint_raster["raster-contrast"]),"raster-resampling":new vr(mi.paint_raster["raster-resampling"]),"raster-fade-duration":new vr(mi.paint_raster["raster-fade-duration"])})}};class Sf extends Zc{constructor(c,f){super(c,Tf,f)}}const Cn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $h{constructor(c,f){this._structArray=c,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class So{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,f){return c._trim(),f&&(c.isTransferred=!0,f.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const f=Object.create(this.prototype);return f.arrayBuffer=c.arrayBuffer,f.length=c.length,f.capacity=c.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Yo(m,c=1){let f=0,T=0;return{members:m.map((C=>{const R=Cn[C.type].BYTES_PER_ELEMENT,z=f=Hn(f,Math.max(c,R)),U=C.components||1;return T=Math.max(T,R),f+=R*U,{name:C.name,type:C.type,components:U,offset:z}})),size:Hn(f,Math.max(T,c)),alignment:c}}function Hn(m,c){return Math.ceil(m/c)*c}class Gh extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f){const T=this.length;return this.resize(T+1),this.emplace(T,c,f)}emplace(c,f,T){const C=2*c;return this.int16[C+0]=f,this.int16[C+1]=T,c}}Gh.prototype.bytesPerElement=4,ur("StructArrayLayout2i4",Gh);class cp extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T){const C=this.length;return this.resize(C+1),this.emplace(C,c,f,T)}emplace(c,f,T,C){const R=3*c;return this.int16[R+0]=f,this.int16[R+1]=T,this.int16[R+2]=C,c}}cp.prototype.bytesPerElement=6,ur("StructArrayLayout3i6",cp);class Km extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C){const R=this.length;return this.resize(R+1),this.emplace(R,c,f,T,C)}emplace(c,f,T,C,R){const z=4*c;return this.int16[z+0]=f,this.int16[z+1]=T,this.int16[z+2]=C,this.int16[z+3]=R,c}}Km.prototype.bytesPerElement=8,ur("StructArrayLayout4i8",Km);class Ef extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,T,C,R,z)}emplace(c,f,T,C,R,z,U){const X=6*c;return this.int16[X+0]=f,this.int16[X+1]=T,this.int16[X+2]=C,this.int16[X+3]=R,this.int16[X+4]=z,this.int16[X+5]=U,c}}Ef.prototype.bytesPerElement=12,ur("StructArrayLayout2i4i12",Ef);class up extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,T,C,R,z)}emplace(c,f,T,C,R,z,U){const X=4*c,re=8*c;return this.int16[X+0]=f,this.int16[X+1]=T,this.uint8[re+4]=C,this.uint8[re+5]=R,this.uint8[re+6]=z,this.uint8[re+7]=U,c}}up.prototype.bytesPerElement=8,ur("StructArrayLayout2i4ub8",up);class Ld extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f){const T=this.length;return this.resize(T+1),this.emplace(T,c,f)}emplace(c,f,T){const C=2*c;return this.float32[C+0]=f,this.float32[C+1]=T,c}}Ld.prototype.bytesPerElement=8,ur("StructArrayLayout2f8",Ld);class Fu extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X,re,ue){const ve=this.length;return this.resize(ve+1),this.emplace(ve,c,f,T,C,R,z,U,X,re,ue)}emplace(c,f,T,C,R,z,U,X,re,ue,ve){const Ce=10*c;return this.uint16[Ce+0]=f,this.uint16[Ce+1]=T,this.uint16[Ce+2]=C,this.uint16[Ce+3]=R,this.uint16[Ce+4]=z,this.uint16[Ce+5]=U,this.uint16[Ce+6]=X,this.uint16[Ce+7]=re,this.uint16[Ce+8]=ue,this.uint16[Ce+9]=ve,c}}Fu.prototype.bytesPerElement=20,ur("StructArrayLayout10ui20",Fu);class pu extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X){const re=this.length;return this.resize(re+1),this.emplace(re,c,f,T,C,R,z,U,X)}emplace(c,f,T,C,R,z,U,X,re){const ue=8*c;return this.uint16[ue+0]=f,this.uint16[ue+1]=T,this.uint16[ue+2]=C,this.uint16[ue+3]=R,this.uint16[ue+4]=z,this.uint16[ue+5]=U,this.uint16[ue+6]=X,this.uint16[ue+7]=re,c}}pu.prototype.bytesPerElement=16,ur("StructArrayLayout8ui16",pu);class Xp extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X,re,ue,ve,Ce){const Me=this.length;return this.resize(Me+1),this.emplace(Me,c,f,T,C,R,z,U,X,re,ue,ve,Ce)}emplace(c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me){const ze=12*c;return this.int16[ze+0]=f,this.int16[ze+1]=T,this.int16[ze+2]=C,this.int16[ze+3]=R,this.uint16[ze+4]=z,this.uint16[ze+5]=U,this.uint16[ze+6]=X,this.uint16[ze+7]=re,this.int16[ze+8]=ue,this.int16[ze+9]=ve,this.int16[ze+10]=Ce,this.int16[ze+11]=Me,c}}Xp.prototype.bytesPerElement=24,ur("StructArrayLayout4i4ui4i24",Xp);class Vl extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,T){const C=this.length;return this.resize(C+1),this.emplace(C,c,f,T)}emplace(c,f,T,C){const R=3*c;return this.float32[R+0]=f,this.float32[R+1]=T,this.float32[R+2]=C,c}}Vl.prototype.bytesPerElement=12,ur("StructArrayLayout3f12",Vl);class If extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint32[1*c+0]=f,c}}If.prototype.bytesPerElement=4,ur("StructArrayLayout1ul4",If);class Pl extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,c,f,T,C,R,z,U,X,re)}emplace(c,f,T,C,R,z,U,X,re,ue){const ve=10*c,Ce=5*c;return this.int16[ve+0]=f,this.int16[ve+1]=T,this.int16[ve+2]=C,this.int16[ve+3]=R,this.int16[ve+4]=z,this.int16[ve+5]=U,this.uint32[Ce+3]=X,this.uint16[ve+8]=re,this.uint16[ve+9]=ue,c}}Pl.prototype.bytesPerElement=20,ur("StructArrayLayout6i1ul2ui20",Pl);class Ac extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,T,C,R,z)}emplace(c,f,T,C,R,z,U){const X=6*c;return this.int16[X+0]=f,this.int16[X+1]=T,this.int16[X+2]=C,this.int16[X+3]=R,this.int16[X+4]=z,this.int16[X+5]=U,c}}Ac.prototype.bytesPerElement=12,ur("StructArrayLayout2i2i2i12",Ac);class Bu extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R){const z=this.length;return this.resize(z+1),this.emplace(z,c,f,T,C,R)}emplace(c,f,T,C,R,z){const U=4*c,X=8*c;return this.float32[U+0]=f,this.float32[U+1]=T,this.float32[U+2]=C,this.int16[X+6]=R,this.int16[X+7]=z,c}}Bu.prototype.bytesPerElement=16,ur("StructArrayLayout2f1f2i16",Bu);class hp extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z){const U=this.length;return this.resize(U+1),this.emplace(U,c,f,T,C,R,z)}emplace(c,f,T,C,R,z,U){const X=16*c,re=4*c,ue=8*c;return this.uint8[X+0]=f,this.uint8[X+1]=T,this.float32[re+1]=C,this.float32[re+2]=R,this.int16[ue+6]=z,this.int16[ue+7]=U,c}}hp.prototype.bytesPerElement=16,ur("StructArrayLayout2ub2f2i16",hp);class Rd extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T){const C=this.length;return this.resize(C+1),this.emplace(C,c,f,T)}emplace(c,f,T,C){const R=3*c;return this.uint16[R+0]=f,this.uint16[R+1]=T,this.uint16[R+2]=C,c}}Rd.prototype.bytesPerElement=6,ur("StructArrayLayout3ui6",Rd);class Nu extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it){const zt=this.length;return this.resize(zt+1),this.emplace(zt,c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it)}emplace(c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it,zt){const lt=24*c,gt=12*c,Vt=48*c;return this.int16[lt+0]=f,this.int16[lt+1]=T,this.uint16[lt+2]=C,this.uint16[lt+3]=R,this.uint32[gt+2]=z,this.uint32[gt+3]=U,this.uint32[gt+4]=X,this.uint16[lt+10]=re,this.uint16[lt+11]=ue,this.uint16[lt+12]=ve,this.float32[gt+7]=Ce,this.float32[gt+8]=Me,this.uint8[Vt+36]=ze,this.uint8[Vt+37]=Fe,this.uint8[Vt+38]=$e,this.uint32[gt+10]=it,this.int16[lt+22]=zt,c}}Nu.prototype.bytesPerElement=48,ur("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Nu);class Jm extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it,zt,lt,gt,Vt,Xt,Mi,ln,rn,Sn,Xn,An){const cn=this.length;return this.resize(cn+1),this.emplace(cn,c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it,zt,lt,gt,Vt,Xt,Mi,ln,rn,Sn,Xn,An)}emplace(c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe,$e,it,zt,lt,gt,Vt,Xt,Mi,ln,rn,Sn,Xn,An,cn){const Zi=32*c,dr=16*c;return this.int16[Zi+0]=f,this.int16[Zi+1]=T,this.int16[Zi+2]=C,this.int16[Zi+3]=R,this.int16[Zi+4]=z,this.int16[Zi+5]=U,this.int16[Zi+6]=X,this.int16[Zi+7]=re,this.uint16[Zi+8]=ue,this.uint16[Zi+9]=ve,this.uint16[Zi+10]=Ce,this.uint16[Zi+11]=Me,this.uint16[Zi+12]=ze,this.uint16[Zi+13]=Fe,this.uint16[Zi+14]=$e,this.uint16[Zi+15]=it,this.uint16[Zi+16]=zt,this.uint16[Zi+17]=lt,this.uint16[Zi+18]=gt,this.uint16[Zi+19]=Vt,this.uint16[Zi+20]=Xt,this.uint16[Zi+21]=Mi,this.uint16[Zi+22]=ln,this.uint32[dr+12]=rn,this.float32[dr+13]=Sn,this.float32[dr+14]=Xn,this.uint16[Zi+30]=An,this.uint16[Zi+31]=cn,c}}Jm.prototype.bytesPerElement=64,ur("StructArrayLayout8i15ui1ul2f2ui64",Jm);class mu extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.float32[1*c+0]=f,c}}mu.prototype.bytesPerElement=4,ur("StructArrayLayout1f4",mu);class Us extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,T){const C=this.length;return this.resize(C+1),this.emplace(C,c,f,T)}emplace(c,f,T,C){const R=3*c;return this.uint16[6*c+0]=f,this.float32[R+1]=T,this.float32[R+2]=C,c}}Us.prototype.bytesPerElement=12,ur("StructArrayLayout1ui2f12",Us);class dp extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,T){const C=this.length;return this.resize(C+1),this.emplace(C,c,f,T)}emplace(c,f,T,C){const R=4*c;return this.uint32[2*c+0]=f,this.uint16[R+2]=T,this.uint16[R+3]=C,c}}dp.prototype.bytesPerElement=8,ur("StructArrayLayout1ul2ui8",dp);class V extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f){const T=this.length;return this.resize(T+1),this.emplace(T,c,f)}emplace(c,f,T){const C=2*c;return this.uint16[C+0]=f,this.uint16[C+1]=T,c}}V.prototype.bytesPerElement=4,ur("StructArrayLayout2ui4",V);class u extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint16[1*c+0]=f,c}}u.prototype.bytesPerElement=2,ur("StructArrayLayout1ui2",u);class y extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,T,C){const R=this.length;return this.resize(R+1),this.emplace(R,c,f,T,C)}emplace(c,f,T,C,R){const z=4*c;return this.float32[z+0]=f,this.float32[z+1]=T,this.float32[z+2]=C,this.float32[z+3]=R,c}}y.prototype.bytesPerElement=16,ur("StructArrayLayout4f16",y);class I extends $h{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}I.prototype.size=20;class D extends Pl{get(c){return new I(this,c)}}ur("CollisionBoxArray",D);class j extends $h{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}j.prototype.size=48;class H extends Nu{get(c){return new j(this,c)}}ur("PlacedSymbolArray",H);class K extends $h{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}K.prototype.size=64;class te extends Jm{get(c){return new K(this,c)}}ur("SymbolInstanceArray",te);class ge extends mu{getoffsetX(c){return this.float32[1*c+0]}}ur("GlyphOffsetArray",ge);class xe extends cp{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}ur("SymbolLineVertexArray",xe);class fe extends $h{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fe.prototype.size=12;class De extends Us{get(c){return new fe(this,c)}}ur("TextAnchorOffsetArray",De);class Ve extends $h{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ve.prototype.size=8;class Xe extends dp{get(c){return new Ve(this,c)}}ur("FeatureIndexArray",Xe);class xt extends Gh{}class wt extends Gh{}class Tt extends Gh{}class Mt extends Ef{}class Yt extends up{}class Rt extends Ld{}class Zt extends Fu{}class ei extends pu{}class Ut extends Xp{}class hi extends Vl{}class $i extends If{}class ki extends Ac{}class Di extends hp{}class Pi extends Rd{}class On extends V{}const Nn=Yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:bn}=Nn;class Yn{constructor(c=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=c}prepareSegment(c,f,T,C){const R=this.segments[this.segments.length-1];return c>Yn.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${Yn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Yn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!R||R.vertexLength+c>Yn.MAX_VERTEX_ARRAY_LENGTH||R.sortKey!==C?this.createNewSegment(f,T,C):R}createNewSegment(c,f,T){const C={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0,vaos:{}};return T!==void 0&&(C.sortKey=T),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(C),C}getOrCreateLatestSegment(c,f,T){return this.prepareSegment(0,c,f,T)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const c of this.segments)for(const f in c.vaos)c.vaos[f].destroy()}static simpleSegment(c,f,T,C){return new Yn([{vertexOffset:c,primitiveOffset:f,vertexLength:T,primitiveLength:C,vaos:{},sortKey:0}])}}function Zr(m,c){return 256*(m=Hr(Math.floor(m),0,255))+Hr(Math.floor(c),0,255)}Yn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ur("SegmentVector",Yn);const Ps=Yo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ia=Yo([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Eo,fa,Nr,hr={exports:{}},oa={exports:{}},pa={exports:{}},aa=(function(){if(Nr)return hr.exports;Nr=1;var m=(Eo||(Eo=1,oa.exports=function(f,T){var C,R,z,U,X,re,ue,ve;for(R=f.length-(C=3&f.length),z=T,X=3432918353,re=461845907,ve=0;ve<R;)ue=255&f.charCodeAt(ve)|(255&f.charCodeAt(++ve))<<8|(255&f.charCodeAt(++ve))<<16|(255&f.charCodeAt(++ve))<<24,++ve,z=27492+(65535&(U=5*(65535&(z=(z^=ue=(65535&(ue=(ue=(65535&ue)*X+(((ue>>>16)*X&65535)<<16)&4294967295)<<15|ue>>>17))*re+(((ue>>>16)*re&65535)<<16)&4294967295)<<13|z>>>19))+((5*(z>>>16)&65535)<<16)&4294967295))+((58964+(U>>>16)&65535)<<16);switch(ue=0,C){case 3:ue^=(255&f.charCodeAt(ve+2))<<16;case 2:ue^=(255&f.charCodeAt(ve+1))<<8;case 1:z^=ue=(65535&(ue=(ue=(65535&(ue^=255&f.charCodeAt(ve)))*X+(((ue>>>16)*X&65535)<<16)&4294967295)<<15|ue>>>17))*re+(((ue>>>16)*re&65535)<<16)&4294967295}return z^=f.length,z=2246822507*(65535&(z^=z>>>16))+((2246822507*(z>>>16)&65535)<<16)&4294967295,z=3266489909*(65535&(z^=z>>>13))+((3266489909*(z>>>16)&65535)<<16)&4294967295,(z^=z>>>16)>>>0}),oa.exports),c=(fa||(fa=1,pa.exports=function(f,T){for(var C,R=f.length,z=T^R,U=0;R>=4;)C=1540483477*(65535&(C=255&f.charCodeAt(U)|(255&f.charCodeAt(++U))<<8|(255&f.charCodeAt(++U))<<16|(255&f.charCodeAt(++U))<<24))+((1540483477*(C>>>16)&65535)<<16),z=1540483477*(65535&z)+((1540483477*(z>>>16)&65535)<<16)^(C=1540483477*(65535&(C^=C>>>24))+((1540483477*(C>>>16)&65535)<<16)),R-=4,++U;switch(R){case 3:z^=(255&f.charCodeAt(U+2))<<16;case 2:z^=(255&f.charCodeAt(U+1))<<8;case 1:z=1540483477*(65535&(z^=255&f.charCodeAt(U)))+((1540483477*(z>>>16)&65535)<<16)}return z=1540483477*(65535&(z^=z>>>13))+((1540483477*(z>>>16)&65535)<<16),(z^=z>>>15)>>>0}),pa.exports);return hr.exports=m,hr.exports.murmur3=m,hr.exports.murmur2=c,hr.exports})(),na=O(aa);class ma{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,f,T,C){this.ids.push(fh(c)),this.positions.push(f,T,C)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=fh(c);let T=0,C=this.ids.length-1;for(;T<C;){const z=T+C>>1;this.ids[z]>=f?C=z:T=z+1}const R=[];for(;this.ids[T]===f;)R.push({index:this.positions[3*T],start:this.positions[3*T+1],end:this.positions[3*T+2]}),T++;return R}static serialize(c,f){const T=new Float64Array(c.ids),C=new Uint32Array(c.positions);return Vu(T,C,0,T.length-1),f&&f.push(T.buffer,C.buffer),{ids:T,positions:C}}static deserialize(c){const f=new ma;return f.ids=c.ids,f.positions=c.positions,f.indexed=!0,f}}function fh(m){const c=+m;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:na(String(m))}function Vu(m,c,f,T){for(;f<T;){const C=m[f+T>>1];let R=f-1,z=T+1;for(;;){do R++;while(m[R]<C);do z--;while(m[z]>C);if(R>=z)break;gu(m,R,z),gu(c,3*R,3*z),gu(c,3*R+1,3*z+1),gu(c,3*R+2,3*z+2)}z-f<T-z?(Vu(m,c,f,z),f=z+1):(Vu(m,c,z+1,T),T=z)}}function gu(m,c,f){const T=m[c];m[c]=m[f],m[f]=T}ur("FeaturePositionMap",ma);class jl{constructor(c,f){this.gl=c.gl,this.location=f}}class bl extends jl{constructor(c,f){super(c,f),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class wl extends jl{constructor(c,f){super(c,f),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Xc extends jl{constructor(c,f){super(c,f),this.current=as.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const mc=new Float32Array(16);function _u(m){return[Zr(255*m.r,255*m.g),Zr(255*m.b,255*m.a)]}class Yc{constructor(c,f,T){this.value=c,this.uniformNames=f.map((C=>`u_${C}`)),this.type=T}setUniform(c,f,T){c.set(T.constantOr(this.value))}getBinding(c,f,T){return this.type==="color"?new Xc(c,f):new bl(c,f)}}class Ml{constructor(c,f){this.uniformNames=f.map((T=>`u_${T}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=c.tlbr}setConstantDashPositions(c,f){this.dashTo=[0,c.y,c.height,c.width],this.dashFrom=[0,f.y,f.height,f.width]}setUniform(c,f,T,C){let R=null;C==="u_pattern_to"?R=this.patternTo:C==="u_pattern_from"?R=this.patternFrom:C==="u_dasharray_to"?R=this.dashTo:C==="u_dasharray_from"?R=this.dashFrom:C==="u_pixel_ratio_to"?R=this.pixelRatioTo:C==="u_pixel_ratio_from"&&(R=this.pixelRatioFrom),R!==null&&c.set(R)}getBinding(c,f,T){return T.substr(0,9)==="u_pattern"||T.substr(0,12)==="u_dasharray_"?new wl(c,f):new bl(c,f)}}class Uo{constructor(c,f,T,C){this.expression=c,this.type=T,this.maxValue=0,this.paintVertexAttributes=f.map((R=>({name:`a_${R}`,type:"Float32",components:T==="color"?2:1,offset:0}))),this.paintVertexArray=new C}populatePaintArray(c,f,T){const C=this.paintVertexArray.length,R=this.expression.evaluate(new To(0,T),f,{},T.canonical,[],T.formattedSection);this.paintVertexArray.resize(c),this._setPaintValue(C,c,R)}updatePaintArray(c,f,T,C,R){const z=this.expression.evaluate(new To(0,R),T,C);this._setPaintValue(c,f,z)}_setPaintValue(c,f,T){if(this.type==="color"){const C=_u(T);for(let R=c;R<f;R++)this.paintVertexArray.emplace(R,C[0],C[1])}else{for(let C=c;C<f;C++)this.paintVertexArray.emplace(C,T);this.maxValue=Math.max(this.maxValue,Math.abs(T))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ws{constructor(c,f,T,C,R,z){this.expression=c,this.uniformNames=f.map((U=>`u_${U}_t`)),this.type=T,this.useIntegerZoom=C,this.zoom=R,this.maxValue=0,this.paintVertexAttributes=f.map((U=>({name:`a_${U}`,type:"Float32",components:T==="color"?4:2,offset:0}))),this.paintVertexArray=new z}populatePaintArray(c,f,T){const C=this.expression.evaluate(new To(this.zoom,T),f,{},T.canonical,[],T.formattedSection),R=this.expression.evaluate(new To(this.zoom+1,T),f,{},T.canonical,[],T.formattedSection),z=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(z,c,C,R)}updatePaintArray(c,f,T,C,R){const z=this.expression.evaluate(new To(this.zoom,R),T,C),U=this.expression.evaluate(new To(this.zoom+1,R),T,C);this._setPaintValue(c,f,z,U)}_setPaintValue(c,f,T,C){if(this.type==="color"){const R=_u(T),z=_u(C);for(let U=c;U<f;U++)this.paintVertexArray.emplace(U,R[0],R[1],z[0],z[1])}else{for(let R=c;R<f;R++)this.paintVertexArray.emplace(R,T,C);this.maxValue=Math.max(this.maxValue,Math.abs(T),Math.abs(C))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,f){const T=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,C=Hr(this.expression.interpolationFactor(T,this.zoom,this.zoom+1),0,1);c.set(C)}getBinding(c,f,T){return new bl(c,f)}}class Ga{constructor(c,f,T,C,R,z){this.expression=c,this.type=f,this.useIntegerZoom=T,this.zoom=C,this.layerId=z,this.zoomInPaintVertexArray=new R,this.zoomOutPaintVertexArray=new R}populatePaintArray(c,f,T){const C=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(C,c,this.getPositionIds(f),T)}updatePaintArray(c,f,T,C,R){this._setPaintValues(c,f,this.getPositionIds(T),R)}_setPaintValues(c,f,T,C){const R=this.getPositions(C);if(!R||!T)return;const z=R[T.min],U=R[T.mid],X=R[T.max];if(z&&U&&X)for(let re=c;re<f;re++)this.emplace(this.zoomInPaintVertexArray,re,U,z),this.emplace(this.zoomOutPaintVertexArray,re,U,X)}upload(c){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const f=this.getVertexAttributes();this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,f,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,f,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qa extends Ga{getPositions(c){return c.imagePositions}getPositionIds(c){return c.patterns&&c.patterns[this.layerId]}getVertexAttributes(){return Ps.members}emplace(c,f,T,C){c.emplace(f,T.tlbr[0],T.tlbr[1],T.tlbr[2],T.tlbr[3],C.tlbr[0],C.tlbr[1],C.tlbr[2],C.tlbr[3],T.pixelRatio,C.pixelRatio)}}class Yp extends Ga{getPositions(c){return c.dashPositions}getPositionIds(c){return c.dashes&&c.dashes[this.layerId]}getVertexAttributes(){return ia.members}emplace(c,f,T,C){c.emplace(f,0,T.y,T.height,T.width,0,C.y,C.height,C.width)}}class Qm{constructor(c,f,T){this.binders={},this._buffers=[];const C=[];for(const R in c.paint._values){if(!T(R))continue;const z=c.paint.get(R);if(!(z instanceof pc&&Bh(z.property.specification)))continue;const U=fp(R,c.type),X=z.value,re=z.property.specification.type,ue=z.property.useIntegerZoom,ve=z.property.specification["property-type"],Ce=ve==="cross-faded"||ve==="cross-faded-data-driven";if(X.kind==="constant")this.binders[R]=Ce?new Ml(X.value,U):new Yc(X.value,U,re),C.push(`/u_${R}`);else if(X.kind==="source"||Ce){const Me=eg(R,re,"source");this.binders[R]=Ce?R==="line-dasharray"?new Yp(X,re,ue,f,Me,c.id):new qa(X,re,ue,f,Me,c.id):new Uo(X,U,re,Me),C.push(`/a_${R}`)}else{const Me=eg(R,re,"composite");this.binders[R]=new Ws(X,U,re,ue,f,Me),C.push(`/z_${R}`)}}this.cacheKey=C.sort().join("")}getMaxValue(c){const f=this.binders[c];return f instanceof Uo||f instanceof Ws?f.maxValue:0}populatePaintArrays(c,f,T){for(const C in this.binders){const R=this.binders[C];(R instanceof Uo||R instanceof Ws||R instanceof Ga)&&R.populatePaintArray(c,f,T)}}setConstantPatternPositions(c,f){for(const T in this.binders){const C=this.binders[T];C instanceof Ml&&C.setConstantPatternPositions(c,f)}}setConstantDashPositions(c,f){for(const T in this.binders){const C=this.binders[T];C instanceof Ml&&C.setConstantDashPositions(c,f)}}updatePaintArrays(c,f,T,C,R){let z=!1;for(const U in c){const X=f.getPositions(U);for(const re of X){const ue=T.feature(re.index);for(const ve in this.binders){const Ce=this.binders[ve];if((Ce instanceof Uo||Ce instanceof Ws||Ce instanceof Ga)&&Ce.expression.isStateDependent===!0){const Me=C.paint.get(ve);Ce.expression=Me.value,Ce.updatePaintArray(re.start,re.end,ue,c[U],R),z=!0}}}}return z}defines(){const c=[];for(const f in this.binders){const T=this.binders[f];(T instanceof Yc||T instanceof Ml)&&c.push(...T.uniformNames.map((C=>`#define HAS_UNIFORM_${C}`)))}return c}getBinderAttributes(){const c=[];for(const f in this.binders){const T=this.binders[f];if(T instanceof Uo||T instanceof Ws)for(let C=0;C<T.paintVertexAttributes.length;C++)c.push(T.paintVertexAttributes[C].name);else if(T instanceof Ga){const C=T.getVertexAttributes();for(const R of C)c.push(R.name)}}return c}getBinderUniforms(){const c=[];for(const f in this.binders){const T=this.binders[f];if(T instanceof Yc||T instanceof Ml||T instanceof Ws)for(const C of T.uniformNames)c.push(C)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,f){const T=[];for(const C in this.binders){const R=this.binders[C];if(R instanceof Yc||R instanceof Ml||R instanceof Ws){for(const z of R.uniformNames)if(f[z]){const U=R.getBinding(c,f[z],z);T.push({name:z,property:C,binding:U})}}}return T}setUniforms(c,f,T,C){for(const{name:R,property:z,binding:U}of f)this.binders[z].setUniform(U,C,T.get(z),R)}updatePaintBuffers(c){this._buffers=[];for(const f in this.binders){const T=this.binders[f];if(c&&T instanceof Ga){const C=c.fromScale===2?T.zoomInPaintVertexBuffer:T.zoomOutPaintVertexBuffer;C&&this._buffers.push(C)}else(T instanceof Uo||T instanceof Ws)&&T.paintVertexBuffer&&this._buffers.push(T.paintVertexBuffer)}}upload(c){for(const f in this.binders){const T=this.binders[f];(T instanceof Uo||T instanceof Ws||T instanceof Ga)&&T.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const f=this.binders[c];(f instanceof Uo||f instanceof Ws||f instanceof Ga)&&f.destroy()}}}class $o{constructor(c,f,T=()=>!0){this.programConfigurations={};for(const C of c)this.programConfigurations[C.id]=new Qm(C,f,T);this.needsUpload=!1,this._featureMap=new ma,this._bufferOffset=0}populatePaintArrays(c,f,T,C){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(c,f,C);f.id!==void 0&&this._featureMap.add(f.id,T,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,f,T,C){for(const R of T)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(c,this._featureMap,f,R,C)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function fp(m,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[m]||[m.replace(`${c}-`,"").replace(/-/g,"_")]}function eg(m,c,f){const T={color:{source:Ld,composite:y},number:{source:mu,composite:Ld}},C=(function(R){return{"line-pattern":{source:Zt,composite:Zt},"fill-pattern":{source:Zt,composite:Zt},"fill-extrusion-pattern":{source:Zt,composite:Zt},"line-dasharray":{source:ei,composite:ei}}[R]})(m);return C&&C[f]||T[c][f]}ur("ConstantBinder",Yc),ur("CrossFadedConstantBinder",Ml),ur("SourceExpressionBinder",Uo),ur("CrossFadedPatternBinder",qa),ur("CrossFadedDasharrayBinder",Yp),ur("CompositeExpressionBinder",Ws),ur("ProgramConfiguration",Qm,{omit:["_buffers"]}),ur("ProgramConfigurationSet",$o);const Kp=Math.pow(2,14)-1,Pc=-Kp-1;function ph(m){const c=wi/m.extent,f=m.loadGeometry();for(let T=0;T<f.length;T++){const C=f[T];for(let R=0;R<C.length;R++){const z=C[R],U=Math.round(z.x*c),X=Math.round(z.y*c);z.x=Hr(U,Pc,Kp),z.y=Hr(X,Pc,Kp),(U<z.x||U>z.x+1||X<z.y||X>z.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function mh(m,c){return{type:m.type,id:m.id,properties:m.properties,geometry:c?ph(m):[]}}const zd=-32768;function yu(m,c,f,T,C){m.emplaceBack(zd+8*c+T,zd+8*f+C)}class kl{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=c.index,this.hasDependencies=!1,this.layoutVertexArray=new wt,this.indexArray=new Pi,this.segments=new Yn,this.programConfigurations=new $o(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id))}populate(c,f,T){const C=this.layers[0],R=[];let z=null,U=!1,X=C.type==="heatmap";if(C.type==="circle"){const ue=C;z=ue.layout.get("circle-sort-key"),U=!z.isConstant(),X=X||ue.paint.get("circle-pitch-alignment")==="map"}const re=X?f.subdivisionGranularity.circle:1;for(const{feature:ue,id:ve,index:Ce,sourceLayerIndex:Me}of c){const ze=this.layers[0]._featureFilter.needGeometry,Fe=mh(ue,ze);if(!this.layers[0]._featureFilter.filter(new To(this.zoom),Fe,T))continue;const $e=U?z.evaluate(Fe,{},T):void 0,it={id:ve,properties:ue.properties,type:ue.type,sourceLayerIndex:Me,index:Ce,geometry:ze?Fe.geometry:ph(ue),patterns:{},sortKey:$e};R.push(it)}U&&R.sort(((ue,ve)=>ue.sortKey-ve.sortKey));for(const ue of R){const{geometry:ve,index:Ce,sourceLayerIndex:Me}=ue,ze=c[Ce].feature;this.addFeature(ue,ve,Ce,T,re),f.featureIndex.insert(ze,ve,Ce,Me,this.index)}}update(c,f,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,{imagePositions:T})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,f,T,C,R=1){let z;switch(R){case 1:z=[0,7];break;case 3:z=[0,2,5,7];break;case 5:z=[0,1,3,4,6,7];break;case 7:z=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${R}; valid values are 1, 3, 5, 7.`)}const U=z.length;for(const X of f)for(const re of X){const ue=re.x,ve=re.y;if(ue<0||ue>=wi||ve<0||ve>=wi)continue;const Ce=this.segments.prepareSegment(U*U,this.layoutVertexArray,this.indexArray,c.sortKey),Me=Ce.vertexLength;for(let ze=0;ze<U;ze++)for(let Fe=0;Fe<U;Fe++)yu(this.layoutVertexArray,ue,ve,z[Fe],z[ze]);for(let ze=0;ze<U-1;ze++)for(let Fe=0;Fe<U-1;Fe++){const $e=Me+ze*U+Fe,it=Me+(ze+1)*U+Fe;this.indexArray.emplaceBack($e,it+1,$e+1),this.indexArray.emplaceBack($e,it,it+1)}Ce.vertexLength+=U*U,Ce.primitiveLength+=(U-1)*(U-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,T,{imagePositions:{},canonical:C})}}function ju(m,c){for(let f=0;f<m.length;f++)if(Jp(c,m[f]))return!0;for(let f=0;f<c.length;f++)if(Jp(m,c[f]))return!0;return!!ig(m,c)}function tg(m,c,f){return!!Jp(m,c)||!!hy(c,m,f)}function e_(m,c){if(m.length===1)return _0(c,m[0]);for(let f=0;f<c.length;f++){const T=c[f];for(let C=0;C<T.length;C++)if(Jp(m,T[C]))return!0}for(let f=0;f<m.length;f++)if(_0(c,m[f]))return!0;for(let f=0;f<c.length;f++)if(ig(m,c[f]))return!0;return!1}function g0(m,c,f){if(m.length>1){if(ig(m,c))return!0;for(let T=0;T<c.length;T++)if(hy(c[T],m,f))return!0}for(let T=0;T<m.length;T++)if(hy(m[T],c,f))return!0;return!1}function ig(m,c){if(m.length===0||c.length===0)return!1;for(let f=0;f<m.length-1;f++){const T=m[f],C=m[f+1];for(let R=0;R<c.length-1;R++)if(uy(T,C,c[R],c[R+1]))return!0}return!1}function uy(m,c,f,T){return Ai(m,f,T)!==Ai(c,f,T)&&Ai(m,c,f)!==Ai(m,c,T)}function hy(m,c,f){const T=f*f;if(c.length===1)return m.distSqr(c[0])<T;for(let C=1;C<c.length;C++)if(t_(m,c[C-1],c[C])<T)return!0;return!1}function t_(m,c,f){const T=c.distSqr(f);if(T===0)return m.distSqr(c);const C=((m.x-c.x)*(f.x-c.x)+(m.y-c.y)*(f.y-c.y))/T;return m.distSqr(C<0?c:C>1?f:f.sub(c)._mult(C)._add(c))}function _0(m,c){let f,T,C,R=!1;for(let z=0;z<m.length;z++){f=m[z];for(let U=0,X=f.length-1;U<f.length;X=U++)T=f[U],C=f[X],T.y>c.y!=C.y>c.y&&c.x<(C.x-T.x)*(c.y-T.y)/(C.y-T.y)+T.x&&(R=!R)}return R}function Jp(m,c){let f=!1;for(let T=0,C=m.length-1;T<m.length;C=T++){const R=m[T],z=m[C];R.y>c.y!=z.y>c.y&&c.x<(z.x-R.x)*(c.y-R.y)/(z.y-R.y)+R.x&&(f=!f)}return f}function y0(m,c,f){const T=f[0],C=f[2];if(m.x<T.x&&c.x<T.x||m.x>C.x&&c.x>C.x||m.y<T.y&&c.y<T.y||m.y>C.y&&c.y>C.y)return!1;const R=Ai(m,c,f[0]);return R!==Ai(m,c,f[1])||R!==Ai(m,c,f[2])||R!==Ai(m,c,f[3])}function Cf(m,c,f){const T=c.paint.get(m).value;return T.kind==="constant"?T.value:f.programConfigurations.get(c.id).getMaxValue(m)}function i_(m){return Math.sqrt(m[0]*m[0]+m[1]*m[1])}function ng(m,c,f,T,C){if(!c[0]&&!c[1])return m;const R=P.convert(c)._mult(C);f==="viewport"&&R._rotate(-T);const z=[];for(let U=0;U<m.length;U++)z.push(m[U].sub(R));return z}function v0(m){const c=[];for(let f=0;f<m.length;f++){const T=m[f],C=c.at(-1);(f===0||C&&!T.equals(C))&&c.push(T)}return c}function wv({queryGeometry:m,size:c},f){return tg(m,f,c)}function dy({queryGeometry:m,size:c,transform:f,unwrappedTileID:T,getElevation:C},R){return tg(m,R,c*(f.projectTileCoordinates(R.x,R.y,T,C).signedDistanceFromCamera/f.cameraToCenterDistance))}function n_({queryGeometry:m,size:c,transform:f,unwrappedTileID:T,getElevation:C},R){const z=f.projectTileCoordinates(R.x,R.y,T,C).signedDistanceFromCamera,U=c*(f.cameraToCenterDistance/z);return tg(m,fy(R,f,T,C),U)}function Tv({queryGeometry:m,size:c,transform:f,unwrappedTileID:T,getElevation:C},R){return tg(m,fy(R,f,T,C),c)}function Sv({queryGeometry:m,size:c,transform:f,unwrappedTileID:T,getElevation:C,pitchAlignment:R="map",pitchScale:z="map"},U){const X=R==="map"?z==="map"?wv:dy:z==="map"?n_:Tv,re={queryGeometry:m,size:c,transform:f,unwrappedTileID:T,getElevation:C};for(const ue of U)for(const ve of ue)if(X(re,ve))return!0;return!1}function fy(m,c,f,T){const C=c.projectTileCoordinates(m.x,m.y,f,T).point;return new P((.5*C.x+.5)*c.width,(.5*-C.y+.5)*c.height)}let bo,r_;ur("CircleBucket",kl,{omit:["layers"]});var bb={get paint(){return r_=r_||new Nl({"circle-radius":new Cr(mi.paint_circle["circle-radius"]),"circle-color":new Cr(mi.paint_circle["circle-color"]),"circle-blur":new Cr(mi.paint_circle["circle-blur"]),"circle-opacity":new Cr(mi.paint_circle["circle-opacity"]),"circle-translate":new vr(mi.paint_circle["circle-translate"]),"circle-translate-anchor":new vr(mi.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vr(mi.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vr(mi.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cr(mi.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cr(mi.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cr(mi.paint_circle["circle-stroke-opacity"])})},get layout(){return bo=bo||new Nl({"circle-sort-key":new Cr(mi.layout_circle["circle-sort-key"])})}};class wb extends Zc{constructor(c,f){super(c,bb,f)}createBucket(c){return new kl(c)}queryRadius(c){const f=c;return Cf("circle-radius",this,f)+Cf("circle-stroke-width",this,f)+i_(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:c,feature:f,featureState:T,geometry:C,transform:R,pixelsToTileUnits:z,unwrappedTileID:U,getElevation:X}){const re=ng(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-R.bearingInRadians,z),ue=this.paint.get("circle-radius").evaluate(f,T)+this.paint.get("circle-stroke-width").evaluate(f,T),ve=this.paint.get("circle-pitch-scale"),Ce=this.paint.get("circle-pitch-alignment");let Me,ze;return Ce==="map"?(Me=re,ze=ue*z):(Me=(function(Fe,$e,it,zt){return Fe.map((lt=>fy(lt,$e,it,zt)))})(re,R,U,X),ze=ue),Sv({queryGeometry:Me,size:ze,transform:R,unwrappedTileID:U,getElevation:X,pitchAlignment:Ce,pitchScale:ve},C)}}class Ev extends kl{}let rg;ur("HeatmapBucket",Ev,{omit:["layers"]});var x0={get paint(){return rg=rg||new Nl({"heatmap-radius":new Cr(mi.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cr(mi.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vr(mi.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cc(mi.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vr(mi.paint_heatmap["heatmap-opacity"])})}};function s_(m,{width:c,height:f},T,C){if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==c*f*T)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${c*f*T}`)}else C=new Uint8Array(c*f*T);return m.width=c,m.height=f,m.data=C,m}function o_(m,{width:c,height:f},T){if(c===m.width&&f===m.height)return;const C=s_({},{width:c,height:f},T);qh(m,C,{x:0,y:0},{x:0,y:0},{width:Math.min(m.width,c),height:Math.min(m.height,f)},T),m.width=c,m.height=f,m.data=C.data}function qh(m,c,f,T,C,R){if(C.width===0||C.height===0)return c;if(C.width>m.width||C.height>m.height||f.x>m.width-C.width||f.y>m.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>c.width||C.height>c.height||T.x>c.width-C.width||T.y>c.height-C.height)throw new RangeError("out of range destination coordinates for image copy");const z=m.data,U=c.data;if(z===U)throw new Error("srcData equals dstData, so image is already copied");for(let X=0;X<C.height;X++){const re=((f.y+X)*m.width+f.x)*R,ue=((T.y+X)*c.width+T.x)*R;for(let ve=0;ve<C.width*R;ve++)U[ue+ve]=z[re+ve]}return c}class pp{constructor(c,f){s_(this,c,1,f)}resize(c){o_(this,c,1)}clone(){return new pp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,T,C,R){qh(c,f,T,C,R,1)}}class lo{constructor(c,f){s_(this,c,4,f)}resize(c){o_(this,c,4)}replace(c,f){f?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,T,C,R){qh(c,f,T,C,R,4)}setPixel(c,f,T){const C=4*(c*this.width+f);this.data[C+0]=Math.round(255*T.r/T.a),this.data[C+1]=Math.round(255*T.g/T.a),this.data[C+2]=Math.round(255*T.b/T.a),this.data[C+3]=Math.round(255*T.a)}}function Hh(m){const c={},f=m.resolution||256,T=m.clips?m.clips.length:1,C=m.image||new lo({width:f,height:T});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const R=(z,U,X)=>{c[m.evaluationKey]=X;const re=m.expression.evaluate(c);C.setPixel(z/4/f,U/4,re)};if(m.clips)for(let z=0,U=0;z<T;++z,U+=4*f)for(let X=0,re=0;X<f;X++,re+=4){const ue=X/(f-1),{start:ve,end:Ce}=m.clips[z];R(U,re,ve*(1-ue)+Ce*ue)}else for(let z=0,U=0;z<f;z++,U+=4)R(0,U,z/(f-1));return C}ur("AlphaImage",pp),ur("RGBAImage",lo);const Qp="big-fb";class py extends Zc{createBucket(c){return new Ev(c)}constructor(c,f){super(c,x0,f),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Qp)&&this.heatmapFbos.delete(Qp)}queryRadius(c){return Cf("heatmap-radius",this,c)}queryIntersectsFeature({queryGeometry:c,feature:f,featureState:T,geometry:C,transform:R,pixelsToTileUnits:z,unwrappedTileID:U,getElevation:X}){return Sv({queryGeometry:c,size:this.paint.get("heatmap-radius").evaluate(f,T)*z,transform:R,unwrappedTileID:U,getElevation:X},C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let sg;var Tb={get paint(){return sg=sg||new Nl({"hillshade-illumination-direction":new vr(mi.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new vr(mi.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new vr(mi.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vr(mi.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vr(mi.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vr(mi.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vr(mi.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new vr(mi.paint_hillshade["hillshade-method"])})}};class a_ extends Zc{constructor(c,f){super(c,Tb,f),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let c=this.paint.get("hillshade-illumination-direction").values,f=this.paint.get("hillshade-illumination-altitude").values,T=this.paint.get("hillshade-highlight-color").values,C=this.paint.get("hillshade-shadow-color").values;const R=Math.max(c.length,f.length,T.length,C.length);c=c.concat(Array(R-c.length).fill(c.at(-1))),f=f.concat(Array(R-f.length).fill(f.at(-1))),T=T.concat(Array(R-T.length).fill(T.at(-1))),C=C.concat(Array(R-C.length).fill(C.at(-1)));const z=f.map(Bt);return{directionRadians:c.map(Bt),altitudeRadians:z,shadowColor:C,highlightColor:T}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let l_;var Sb={get paint(){return l_=l_||new Nl({"color-relief-opacity":new vr(mi["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Cc(mi["paint_color-relief"]["color-relief-color"])})}};class og{constructor(c,f,T,C){this.context=c,this.format=T,this.texture=c.gl.createTexture(),this.update(f,C)}update(c,f,T){const{width:C,height:R}=c,z=!(this.size&&this.size[0]===C&&this.size[1]===R||T),{context:U}=this,{gl:X}=U;if(this.useMipmap=!!(f&&f.useMipmap),X.bindTexture(X.TEXTURE_2D,this.texture),U.pixelStoreUnpackFlipY.set(!1),U.pixelStoreUnpack.set(1),U.pixelStoreUnpackPremultiplyAlpha.set(this.format===X.RGBA&&(!f||f.premultiply!==!1)),z)this.size=[C,R],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||pt(c)?X.texImage2D(X.TEXTURE_2D,0,this.format,this.format,X.UNSIGNED_BYTE,c):X.texImage2D(X.TEXTURE_2D,0,this.format,C,R,0,this.format,X.UNSIGNED_BYTE,c.data);else{const{x:re,y:ue}=T||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||pt(c)?X.texSubImage2D(X.TEXTURE_2D,0,re,ue,X.RGBA,X.UNSIGNED_BYTE,c):X.texSubImage2D(X.TEXTURE_2D,0,re,ue,C,R,X.RGBA,X.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&X.generateMipmap(X.TEXTURE_2D),U.pixelStoreUnpackFlipY.setDefault(),U.pixelStoreUnpack.setDefault(),U.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(c,f,T){const{context:C}=this,{gl:R}=C;R.bindTexture(R.TEXTURE_2D,this.texture),T!==R.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(T=R.LINEAR),c!==this.filter&&(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,c),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,T||c),this.filter=c),f!==this.wrap&&(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,f),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}class my{constructor(c,f,T,C=1,R=1,z=1,U=0){if(this.uid=c,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(T&&!["mapbox","terrarium","custom"].includes(T))return void Gt(`"${T}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const X=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),T){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=C,this.greenFactor=R,this.blueFactor=z,this.baseShift=U;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let re=0;re<X;re++)this.data[this._idx(-1,re)]=this.data[this._idx(0,re)],this.data[this._idx(X,re)]=this.data[this._idx(X-1,re)],this.data[this._idx(re,-1)]=this.data[this._idx(re,0)],this.data[this._idx(re,X)]=this.data[this._idx(re,X-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(X,-1)]=this.data[this._idx(X-1,0)],this.data[this._idx(-1,X)]=this.data[this._idx(0,X-1)],this.data[this._idx(X,X)]=this.data[this._idx(X-1,X-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let re=0;re<X;re++)for(let ue=0;ue<X;ue++){const ve=this.get(re,ue);ve>this.max&&(this.max=ve),ve<this.min&&(this.min=ve)}}get(c,f){const T=new Uint8Array(this.data.buffer),C=4*this._idx(c,f);return this.unpack(T[C],T[C+1],T[C+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,f){if(c<-1||c>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${c}, y: ${f}, dim: ${this.dim}`);return(f+1)*this.stride+(c+1)}unpack(c,f,T){return c*this.redFactor+f*this.greenFactor+T*this.blueFactor-this.baseShift}pack(c){return ag(c,this.getUnpackVector())}getPixels(){return new lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,f,T){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let C=f*this.dim,R=f*this.dim+this.dim,z=T*this.dim,U=T*this.dim+this.dim;switch(f){case-1:C=R-1;break;case 1:R=C+1}switch(T){case-1:z=U-1;break;case 1:U=z+1}const X=-f*this.dim,re=-T*this.dim;for(let ue=z;ue<U;ue++)for(let ve=C;ve<R;ve++)this.data[this._idx(ve,ue)]=c.data[this._idx(ve+X,ue+re)]}}function ag(m,c){const f=c[0],T=c[1],C=c[2],R=c[3],z=Math.min(f,T,C),U=Math.round((m+R)/z);return{r:Math.floor(U*z/f)%256,g:Math.floor(U*z/T)%256,b:Math.floor(U*z/C)%256}}ur("DEMData",my);class c_ extends Zc{constructor(c,f){super(c,Sb,f)}_createColorRamp(c){const f={elevationStops:[],colorStops:[]},T=this._transitionablePaint._values["color-relief-color"].value.expression;if(T instanceof Lu&&T._styleExpression.expression instanceof Gn){this.colorRampExpression=T;const z=T._styleExpression.expression;f.elevationStops=z.labels,f.colorStops=[];for(const U of f.elevationStops)f.colorStops.push(z.evaluate({globals:{elevation:U}}))}if(f.elevationStops.length<1&&(f.elevationStops=[0],f.colorStops=[as.transparent]),f.elevationStops.length<2&&(f.elevationStops.push(f.elevationStops[0]+1),f.colorStops.push(f.colorStops[0])),f.elevationStops.length<=c)return f;const C={elevationStops:[],colorStops:[]},R=(f.elevationStops.length-1)/(c-1);for(let z=0;z<f.elevationStops.length-.5;z+=R)C.elevationStops.push(f.elevationStops[Math.round(z)]),C.colorStops.push(f.colorStops[Math.round(z)]);return Gt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${c}, provided: ${f.elevationStops.length}`),C}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(c,f,T){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const C=this._createColorRamp(f),R=new lo({width:C.colorStops.length,height:1}),z=new lo({width:C.colorStops.length,height:1});for(let U=0;U<C.elevationStops.length;U++){const X=ag(C.elevationStops[U],T);z.setPixel(0,U,new as(X.r/255,X.g/255,X.b/255,1)),R.setPixel(0,U,C.colorStops[U])}return this.colorRampTextures={elevationTexture:new og(c,z,c.gl.RGBA),colorTexture:new og(c,R,c.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const lg=Yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Af}=lg;function gh(m,c,f){const T=f.patternDependencies;let C=!1;for(const R of c){const z=R.paint.get(`${m}-pattern`);z.isConstant()||(C=!0);const U=z.constantOr(null);U&&(C=!0,T[U.to]=!0,T[U.from]=!0)}return C}function Wh(m,c,f,T,C){const{zoom:R}=T,z=C.patternDependencies;for(const U of c){const X=U.paint.get(`${m}-pattern`).value;if(X.kind!=="constant"){let re=X.evaluate({zoom:R-1},f,{},C.availableImages),ue=X.evaluate({zoom:R},f,{},C.availableImages),ve=X.evaluate({zoom:R+1},f,{},C.availableImages);re=re&&re.name?re.name:re,ue=ue&&ue.name?ue.name:ue,ve=ve&&ve.name?ve.name:ve,z[re]=!0,z[ue]=!0,z[ve]=!0,f.patterns[U.id]={min:re,mid:ue,max:ve}}}return f}function Pf(m,c,f,T,C){let R;if(C===(function(z,U,X,re){let ue=0;for(let ve=U,Ce=X-re;ve<X;ve+=re)ue+=(z[Ce]-z[ve])*(z[ve+1]+z[Ce+1]),Ce=ve;return ue})(m,c,f,T)>0)for(let z=c;z<f;z+=T)R=M(z/T|0,m[z],m[z+1],R);else for(let z=f-T;z>=c;z-=T)R=M(z/T|0,m[z],m[z+1],R);return R&&Zh(R,R.next)&&(k(R),R=R.next),R}function gc(m,c){if(!m)return m;c||(c=m);let f,T=m;do if(f=!1,T.steiner||!Zh(T,T.next)&&ra(T.prev,T,T.next)!==0)T=T.next;else{if(k(T),T=c=T.prev,T===T.next)break;f=!0}while(f||T!==c);return c}function u_(m,c,f,T,C,R,z){if(!m)return;!z&&R&&(function(X,re,ue,ve){let Ce=X;do Ce.z===0&&(Ce.z=w0(Ce.x,Ce.y,re,ue,ve)),Ce.prevZ=Ce.prev,Ce.nextZ=Ce.next,Ce=Ce.next;while(Ce!==X);Ce.prevZ.nextZ=null,Ce.prevZ=null,(function(Me){let ze,Fe=1;do{let $e,it=Me;Me=null;let zt=null;for(ze=0;it;){ze++;let lt=it,gt=0;for(let Xt=0;Xt<Fe&&(gt++,lt=lt.nextZ,lt);Xt++);let Vt=Fe;for(;gt>0||Vt>0&&lt;)gt!==0&&(Vt===0||!lt||it.z<=lt.z)?($e=it,it=it.nextZ,gt--):($e=lt,lt=lt.nextZ,Vt--),zt?zt.nextZ=$e:Me=$e,$e.prevZ=zt,zt=$e;it=lt}zt.nextZ=null,Fe*=2}while(ze>1)})(Ce)})(m,T,C,R);let U=m;for(;m.prev!==m.next;){const X=m.prev,re=m.next;if(R?Ib(m,T,C,R):Eb(m))c.push(X.i,m.i,re.i),k(m),m=re.next,U=re.next;else if((m=re)===U){z?z===1?u_(m=Cb(gc(m),c),c,f,T,C,R,2):z===2&&b0(m,c,f,T,C,R):u_(gc(m),c,f,T,C,R,1);break}}}function Eb(m){const c=m.prev,f=m,T=m.next;if(ra(c,f,T)>=0)return!1;const C=c.x,R=f.x,z=T.x,U=c.y,X=f.y,re=T.y,ue=Math.min(C,R,z),ve=Math.min(U,X,re),Ce=Math.max(C,R,z),Me=Math.max(U,X,re);let ze=T.next;for(;ze!==c;){if(ze.x>=ue&&ze.x<=Ce&&ze.y>=ve&&ze.y<=Me&&Mc(C,U,R,X,z,re,ze.x,ze.y)&&ra(ze.prev,ze,ze.next)>=0)return!1;ze=ze.next}return!0}function Ib(m,c,f,T){const C=m.prev,R=m,z=m.next;if(ra(C,R,z)>=0)return!1;const U=C.x,X=R.x,re=z.x,ue=C.y,ve=R.y,Ce=z.y,Me=Math.min(U,X,re),ze=Math.min(ue,ve,Ce),Fe=Math.max(U,X,re),$e=Math.max(ue,ve,Ce),it=w0(Me,ze,c,f,T),zt=w0(Fe,$e,c,f,T);let lt=m.prevZ,gt=m.nextZ;for(;lt&&lt.z>=it&&gt&&gt.z<=zt;){if(lt.x>=Me&&lt.x<=Fe&&lt.y>=ze&&lt.y<=$e&&lt!==C&&lt!==z&&Mc(U,ue,X,ve,re,Ce,lt.x,lt.y)&&ra(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,gt.x>=Me&&gt.x<=Fe&&gt.y>=ze&&gt.y<=$e&&gt!==C&&gt!==z&&Mc(U,ue,X,ve,re,Ce,gt.x,gt.y)&&ra(gt.prev,gt,gt.next)>=0))return!1;gt=gt.nextZ}for(;lt&&lt.z>=it;){if(lt.x>=Me&&lt.x<=Fe&&lt.y>=ze&&lt.y<=$e&&lt!==C&&lt!==z&&Mc(U,ue,X,ve,re,Ce,lt.x,lt.y)&&ra(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;gt&&gt.z<=zt;){if(gt.x>=Me&&gt.x<=Fe&&gt.y>=ze&&gt.y<=$e&&gt!==C&&gt!==z&&Mc(U,ue,X,ve,re,Ce,gt.x,gt.y)&&ra(gt.prev,gt,gt.next)>=0)return!1;gt=gt.nextZ}return!0}function Cb(m,c){let f=m;do{const T=f.prev,C=f.next.next;!Zh(T,C)&&v(T,f,f.next,C)&&x(T,C)&&x(C,T)&&(c.push(T.i,f.i,C.i),k(f),k(f.next),f=m=C),f=f.next}while(f!==m);return gc(f)}function b0(m,c,f,T,C,R){let z=m;do{let U=z.next.next;for(;U!==z.prev;){if(z.i!==U.i&&yh(z,U)){let X=E(z,U);return z=gc(z,z.next),X=gc(X,X.next),u_(z,c,f,T,C,R,0),void u_(X,c,f,T,C,R,0)}U=U.next}z=z.next}while(z!==m)}function Ql(m,c){let f=m.x-c.x;return f===0&&(f=m.y-c.y,f===0)&&(f=(m.next.y-m.y)/(m.next.x-m.x)-(c.next.y-c.y)/(c.next.x-c.x)),f}function _h(m,c){const f=(function(C,R){let z=R;const U=C.x,X=C.y;let re,ue=-1/0;if(Zh(C,z))return z;do{if(Zh(C,z.next))return z.next;if(X<=z.y&&X>=z.next.y&&z.next.y!==z.y){const Fe=z.x+(X-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(Fe<=U&&Fe>ue&&(ue=Fe,re=z.x<z.next.x?z:z.next,Fe===U))return re}z=z.next}while(z!==R);if(!re)return null;const ve=re,Ce=re.x,Me=re.y;let ze=1/0;z=re;do{if(U>=z.x&&z.x>=Ce&&U!==z.x&&_y(X<Me?U:ue,X,Ce,Me,X<Me?ue:U,X,z.x,z.y)){const Fe=Math.abs(X-z.y)/(U-z.x);x(z,C)&&(Fe<ze||Fe===ze&&(z.x>re.x||z.x===re.x&&gy(re,z)))&&(re=z,ze=Fe)}z=z.next}while(z!==ve);return re})(m,c);if(!f)return c;const T=E(f,m);return gc(T,T.next),gc(f,f.next)}function gy(m,c){return ra(m.prev,m,c.prev)<0&&ra(c.next,m,m.next)<0}function w0(m,c,f,T,C){return(m=1431655765&((m=858993459&((m=252645135&((m=16711935&((m=(m-f)*C|0)|m<<8))|m<<4))|m<<2))|m<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-T)*C|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function cg(m){let c=m,f=m;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==m);return f}function _y(m,c,f,T,C,R,z,U){return(C-z)*(c-U)>=(m-z)*(R-U)&&(m-z)*(T-U)>=(f-z)*(c-U)&&(f-z)*(R-U)>=(C-z)*(T-U)}function Mc(m,c,f,T,C,R,z,U){return!(m===z&&c===U)&&_y(m,c,f,T,C,R,z,U)}function yh(m,c){return m.next.i!==c.i&&m.prev.i!==c.i&&!(function(f,T){let C=f;do{if(C.i!==f.i&&C.next.i!==f.i&&C.i!==T.i&&C.next.i!==T.i&&v(C,C.next,f,T))return!0;C=C.next}while(C!==f);return!1})(m,c)&&(x(m,c)&&x(c,m)&&(function(f,T){let C=f,R=!1;const z=(f.x+T.x)/2,U=(f.y+T.y)/2;do C.y>U!=C.next.y>U&&C.next.y!==C.y&&z<(C.next.x-C.x)*(U-C.y)/(C.next.y-C.y)+C.x&&(R=!R),C=C.next;while(C!==f);return R})(m,c)&&(ra(m.prev,m,c.prev)||ra(m,c.prev,c))||Zh(m,c)&&ra(m.prev,m,m.next)>0&&ra(c.prev,c,c.next)>0)}function ra(m,c,f){return(c.y-m.y)*(f.x-c.x)-(c.x-m.x)*(f.y-c.y)}function Zh(m,c){return m.x===c.x&&m.y===c.y}function v(m,c,f,T){const C=h(ra(m,c,f)),R=h(ra(m,c,T)),z=h(ra(f,T,m)),U=h(ra(f,T,c));return C!==R&&z!==U||!(C!==0||!r(m,f,c))||!(R!==0||!r(m,T,c))||!(z!==0||!r(f,m,T))||!(U!==0||!r(f,c,T))}function r(m,c,f){return c.x<=Math.max(m.x,f.x)&&c.x>=Math.min(m.x,f.x)&&c.y<=Math.max(m.y,f.y)&&c.y>=Math.min(m.y,f.y)}function h(m){return m>0?1:m<0?-1:0}function x(m,c){return ra(m.prev,m,m.next)<0?ra(m,c,m.next)>=0&&ra(m,m.prev,c)>=0:ra(m,c,m.prev)<0||ra(m,m.next,c)<0}function E(m,c){const f=B(m.i,m.x,m.y),T=B(c.i,c.x,c.y),C=m.next,R=c.prev;return m.next=c,c.prev=m,f.next=C,C.prev=f,T.next=f,f.prev=T,R.next=T,T.prev=R,T}function M(m,c,f,T){const C=B(m,c,f);return T?(C.next=T.next,C.prev=T,T.next.prev=C,T.next=C):(C.prev=C,C.next=C),C}function k(m){m.next.prev=m.prev,m.prev.next=m.next,m.prevZ&&(m.prevZ.nextZ=m.nextZ),m.nextZ&&(m.nextZ.prevZ=m.prevZ)}function B(m,c,f){return{i:m,x:c,y:f,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class G{constructor(c,f){if(f>c)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=c,this._minGranularity=f}getGranularityForZoomLevel(c){return Math.max(Math.floor(this._baseZoomGranularity/(1<<c)),this._minGranularity,1)}}class J{constructor(c){this.fill=c.fill,this.line=c.line,this.tile=c.tile,this.stencil=c.stencil,this.circle=c.circle}}J.noSubdivision=new J({fill:new G(0,0),line:new G(0,0),tile:new G(0,0),stencil:new G(0,0),circle:1}),ur("SubdivisionGranularityExpression",G),ur("SubdivisionGranularitySetting",J);const ee=-32768,ce=32767;class le{constructor(c,f){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=c,this._granularityCellSize=wi/c,this._canonical=f}_getKey(c,f){return(c+=32768)<<16|f+32768}_vertexToIndex(c,f){if(c<-32768||f<-32768||c>32767||f>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const T=0|Math.round(c),C=0|Math.round(f),R=this._getKey(T,C);if(this._vertexDictionary.has(R))return this._vertexDictionary.get(R);const z=this._vertexBuffer.length/2;return this._vertexDictionary.set(R,z),this._vertexBuffer.push(T,C),z}_subdivideTrianglesScanline(c){if(this._granularity<2)return(function(C,R){const z=[];for(let U=0;U<R.length;U+=3){const X=R[U],re=R[U+1],ue=R[U+2],ve=C[2*X],Ce=C[2*X+1];(C[2*re]-ve)*(C[2*ue+1]-Ce)-(C[2*re+1]-Ce)*(C[2*ue]-ve)>0?(z.push(X),z.push(ue),z.push(re)):(z.push(X),z.push(re),z.push(ue))}return z})(this._vertexBuffer,c);const f=[],T=c.length;for(let C=0;C<T;C+=3){const R=[c[C+0],c[C+1],c[C+2]],z=[this._vertexBuffer[2*c[C+0]+0],this._vertexBuffer[2*c[C+0]+1],this._vertexBuffer[2*c[C+1]+0],this._vertexBuffer[2*c[C+1]+1],this._vertexBuffer[2*c[C+2]+0],this._vertexBuffer[2*c[C+2]+1]];let U=1/0,X=1/0,re=-1/0,ue=-1/0;for(let Fe=0;Fe<3;Fe++){const $e=z[2*Fe],it=z[2*Fe+1];U=Math.min(U,$e),re=Math.max(re,$e),X=Math.min(X,it),ue=Math.max(ue,it)}if(U===re||X===ue)continue;const ve=Math.floor(U/this._granularityCellSize),Ce=Math.ceil(re/this._granularityCellSize),Me=Math.floor(X/this._granularityCellSize),ze=Math.ceil(ue/this._granularityCellSize);if(ve!==Ce||Me!==ze)for(let Fe=Me;Fe<ze;Fe++){const $e=this._scanlineGenerateVertexRingForCellRow(Fe,z,R);_e(this._vertexBuffer,$e,f)}else f.push(...R)}return f}_scanlineGenerateVertexRingForCellRow(c,f,T){const C=c*this._granularityCellSize,R=C+this._granularityCellSize,z=[];for(let U=0;U<3;U++){const X=f[2*U],re=f[2*U+1],ue=f[2*(U+1)%6],ve=f[(2*(U+1)+1)%6],Ce=f[2*(U+2)%6],Me=f[(2*(U+2)+1)%6],ze=ue-X,Fe=ve-re,$e=ze===0,it=Fe===0,zt=(C-re)/Fe,lt=(R-re)/Fe,gt=Math.min(zt,lt),Vt=Math.max(zt,lt);if(!it&&(gt>=1||Vt<=0)||it&&(re<C||re>R)){ve>=C&&ve<=R&&z.push(T[(U+1)%3]);continue}!it&&gt>0&&z.push(this._vertexToIndex(X+ze*gt,re+Fe*gt));const Xt=X+ze*Math.max(gt,0),Mi=X+ze*Math.min(Vt,1);$e||this._generateIntraEdgeVertices(z,X,re,ue,ve,Xt,Mi),!it&&Vt<1&&z.push(this._vertexToIndex(X+ze*Vt,re+Fe*Vt)),(it||ve>=C&&ve<=R)&&z.push(T[(U+1)%3]),!it&&(ve<=C||ve>=R)&&this._generateInterEdgeVertices(z,X,re,ue,ve,Ce,Me,Mi,C,R)}return z}_generateIntraEdgeVertices(c,f,T,C,R,z,U){const X=C-f,re=R-T,ue=re===0,ve=ue?Math.min(f,C):Math.min(z,U),Ce=ue?Math.max(f,C):Math.max(z,U),Me=Math.floor(ve/this._granularityCellSize)+1,ze=Math.ceil(Ce/this._granularityCellSize)-1;if(ue?f<C:z<U)for(let Fe=Me;Fe<=ze;Fe++){const $e=Fe*this._granularityCellSize;c.push(this._vertexToIndex($e,T+re*($e-f)/X))}else for(let Fe=ze;Fe>=Me;Fe--){const $e=Fe*this._granularityCellSize;c.push(this._vertexToIndex($e,T+re*($e-f)/X))}}_generateInterEdgeVertices(c,f,T,C,R,z,U,X,re,ue){const ve=R-T,Ce=z-C,Me=U-R,ze=(re-R)/Me,Fe=(ue-R)/Me,$e=Math.min(ze,Fe),it=Math.max(ze,Fe),zt=C+Ce*$e;let lt=Math.floor(Math.min(zt,X)/this._granularityCellSize)+1,gt=Math.ceil(Math.max(zt,X)/this._granularityCellSize)-1,Vt=X<zt;const Xt=Me===0;if(Xt&&(U===re||U===ue))return;if(Xt||$e>=1||it<=0){const ln=T-U,rn=z+(f-z)*Math.min((re-U)/ln,(ue-U)/ln);lt=Math.floor(Math.min(rn,X)/this._granularityCellSize)+1,gt=Math.ceil(Math.max(rn,X)/this._granularityCellSize)-1,Vt=X<rn}const Mi=ve>0?ue:re;if(Vt)for(let ln=lt;ln<=gt;ln++)c.push(this._vertexToIndex(ln*this._granularityCellSize,Mi));else for(let ln=gt;ln>=lt;ln--)c.push(this._vertexToIndex(ln*this._granularityCellSize,Mi))}_generateOutline(c){const f=[];for(const T of c){const C=be(T,this._granularity,!0),R=this._pointArrayToIndices(C),z=[];for(let U=1;U<R.length;U++)z.push(R[U-1]),z.push(R[U]);f.push(z)}return f}_handlePoles(c){let f=!1,T=!1;this._canonical&&(this._canonical.y===0&&(f=!0),this._canonical.y===(1<<this._canonical.z)-1&&(T=!0)),(f||T)&&this._fillPoles(c,f,T)}_ensureNoPoleVertices(){const c=this._vertexBuffer;for(let f=0;f<c.length;f+=2){const T=c[f+1];T===ee&&(c[f+1]=-32767),T===ce&&(c[f+1]=32766)}}_generatePoleQuad(c,f,T,C,R,z){C>R!=(z===ee)?(c.push(f),c.push(T),c.push(this._vertexToIndex(C,z)),c.push(T),c.push(this._vertexToIndex(R,z)),c.push(this._vertexToIndex(C,z))):(c.push(T),c.push(f),c.push(this._vertexToIndex(C,z)),c.push(this._vertexToIndex(R,z)),c.push(T),c.push(this._vertexToIndex(C,z)))}_fillPoles(c,f,T){const C=this._vertexBuffer,R=wi,z=c.length;for(let U=2;U<z;U+=3){const X=c[U-2],re=c[U-1],ue=c[U],ve=C[2*X],Ce=C[2*X+1],Me=C[2*re],ze=C[2*re+1],Fe=C[2*ue],$e=C[2*ue+1];f&&(Ce===0&&ze===0&&this._generatePoleQuad(c,X,re,ve,Me,ee),ze===0&&$e===0&&this._generatePoleQuad(c,re,ue,Me,Fe,ee),$e===0&&Ce===0&&this._generatePoleQuad(c,ue,X,Fe,ve,ee)),T&&(Ce===R&&ze===R&&this._generatePoleQuad(c,X,re,ve,Me,ce),ze===R&&$e===R&&this._generatePoleQuad(c,re,ue,Me,Fe,ce),$e===R&&Ce===R&&this._generatePoleQuad(c,ue,X,Fe,ve,ce))}}_initializeVertices(c){for(let f=0;f<c.length;f+=2)this._vertexToIndex(c[f],c[f+1])}subdividePolygonInternal(c,f){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:T,holeIndices:C}=(function(U){const X=[],re=[];for(const ue of U)if(ue.length!==0){ue!==U[0]&&X.push(re.length/2);for(let ve=0;ve<ue.length;ve++)re.push(ue[ve].x),re.push(ue[ve].y)}return{flattened:re,holeIndices:X}})(c);let R;this._initializeVertices(T);try{const U=(function(re,ue,ve=2){const Ce=ue&&ue.length,Me=Ce?ue[0]*ve:re.length;let ze=Pf(re,0,Me,ve,!0);const Fe=[];if(!ze||ze.next===ze.prev)return Fe;let $e,it,zt;if(Ce&&(ze=(function(lt,gt,Vt,Xt){const Mi=[];for(let ln=0,rn=gt.length;ln<rn;ln++){const Sn=Pf(lt,gt[ln]*Xt,ln<rn-1?gt[ln+1]*Xt:lt.length,Xt,!1);Sn===Sn.next&&(Sn.steiner=!0),Mi.push(cg(Sn))}Mi.sort(Ql);for(let ln=0;ln<Mi.length;ln++)Vt=_h(Mi[ln],Vt);return Vt})(re,ue,ze,ve)),re.length>80*ve){$e=re[0],it=re[1];let lt=$e,gt=it;for(let Vt=ve;Vt<Me;Vt+=ve){const Xt=re[Vt],Mi=re[Vt+1];Xt<$e&&($e=Xt),Mi<it&&(it=Mi),Xt>lt&&(lt=Xt),Mi>gt&&(gt=Mi)}zt=Math.max(lt-$e,gt-it),zt=zt!==0?32767/zt:0}return u_(ze,Fe,ve,$e,it,zt,0),Fe})(T,C),X=this._convertIndices(T,U);R=this._subdivideTrianglesScanline(X)}catch(U){console.error(U)}let z=[];return f&&(z=this._generateOutline(c)),this._ensureNoPoleVertices(),this._handlePoles(R),{verticesFlattened:this._vertexBuffer,indicesTriangles:R,indicesLineList:z}}_convertIndices(c,f){const T=[];for(let C=0;C<f.length;C++)T.push(this._vertexToIndex(c[2*f[C]],c[2*f[C]+1]));return T}_pointArrayToIndices(c){const f=[];for(let T=0;T<c.length;T++){const C=c[T];f.push(this._vertexToIndex(C.x,C.y))}return f}}function he(m,c,f,T=!0){return new le(f,c).subdividePolygonInternal(m,T)}function be(m,c,f=!1){if(!m||m.length<1)return[];if(m.length<2)return[];const T=m[0],C=m[m.length-1],R=f&&(T.x!==C.x||T.y!==C.y);if(c<2)return R?[...m,m[0]]:[...m];const z=Math.floor(wi/c),U=[];U.push(new P(m[0].x,m[0].y));const X=m.length,re=R?X:X-1;for(let ue=0;ue<re;ue++){const ve=m[ue],Ce=ue<X-1?m[ue+1]:m[0],Me=ve.x,ze=ve.y,Fe=Ce.x,$e=Ce.y,it=Me!==Fe,zt=ze!==$e;if(!it&&!zt)continue;const lt=Fe-Me,gt=$e-ze,Vt=Math.abs(lt),Xt=Math.abs(gt);let Mi=Me,ln=ze;for(;;){const Sn=lt>0?(Math.floor(Mi/z)+1)*z:(Math.ceil(Mi/z)-1)*z,Xn=gt>0?(Math.floor(ln/z)+1)*z:(Math.ceil(ln/z)-1)*z,An=Math.abs(Mi-Sn),cn=Math.abs(ln-Xn),Zi=Math.abs(Mi-Fe),dr=Math.abs(ln-$e),or=it?An/Vt:Number.POSITIVE_INFINITY,_r=zt?cn/Xt:Number.POSITIVE_INFINITY;if((Zi<=An||!it)&&(dr<=cn||!zt))break;if(or<_r&&it||!zt){Mi=Sn,ln+=gt*or;const er=new P(Mi,Math.round(ln));U[U.length-1].x===er.x&&U[U.length-1].y===er.y||U.push(er)}else{Mi+=lt*_r,ln=Xn;const er=new P(Math.round(Mi),ln);U[U.length-1].x===er.x&&U[U.length-1].y===er.y||U.push(er)}}const rn=new P(Fe,$e);U[U.length-1].x===rn.x&&U[U.length-1].y===rn.y||U.push(rn)}return U}function _e(m,c,f){if(c.length===0)throw new Error("Subdivision vertex ring is empty.");let T=0,C=m[2*c[0]];for(let X=1;X<c.length;X++){const re=m[2*c[X]];re<C&&(C=re,T=X)}const R=c.length;let z=T,U=(z+1)%R;for(;;){const X=z-1>=0?z-1:R-1,re=(U+1)%R,ue=m[2*c[X]],ve=m[2*c[re]],Ce=m[2*c[z]],Me=m[2*c[z]+1],ze=m[2*c[U]+1];let Fe=!1;if(ue<ve)Fe=!0;else if(ue>ve)Fe=!1;else{const $e=ze-Me,it=-(m[2*c[U]]-Ce),zt=Me<ze?1:-1;((ue-Ce)*$e+(m[2*c[X]+1]-Me)*it)*zt>((ve-Ce)*$e+(m[2*c[re]+1]-Me)*it)*zt&&(Fe=!0)}if(Fe){const $e=c[X],it=c[z],zt=c[U];$e!==it&&$e!==zt&&it!==zt&&f.push(zt,it,$e),z--,z<0&&(z=R-1)}else{const $e=c[re],it=c[z],zt=c[U];$e!==it&&$e!==zt&&it!==zt&&f.push(zt,it,$e),U++,U>=R&&(U=0)}if(X===re)break}}function ke(m,c,f,T,C,R,z,U,X){const re=C.length/2,ue=z&&U&&X;if(re<Yn.MAX_VERTEX_ARRAY_LENGTH){const ve=c.prepareSegment(re,f,T),Ce=ve.vertexLength;for(let Fe=0;Fe<R.length;Fe+=3)T.emplaceBack(Ce+R[Fe],Ce+R[Fe+1],Ce+R[Fe+2]);let Me,ze;ve.vertexLength+=re,ve.primitiveLength+=R.length/3,ue&&(ze=z.prepareSegment(re,f,U),Me=ze.vertexLength,ze.vertexLength+=re);for(let Fe=0;Fe<C.length;Fe+=2)m(C[Fe],C[Fe+1]);if(ue)for(let Fe=0;Fe<X.length;Fe++){const $e=X[Fe];for(let it=1;it<$e.length;it+=2)U.emplaceBack(Me+$e[it-1],Me+$e[it]);ze.primitiveLength+=$e.length/2}}else(function(ve,Ce,Me,ze,Fe,$e){const it=[];for(let Xt=0;Xt<ze.length/2;Xt++)it.push(-1);const zt={count:0};let lt=0,gt=ve.getOrCreateLatestSegment(Ce,Me),Vt=gt.vertexLength;for(let Xt=2;Xt<Fe.length;Xt+=3){const Mi=Fe[Xt-2],ln=Fe[Xt-1],rn=Fe[Xt];let Sn=it[Mi]<lt,Xn=it[ln]<lt,An=it[rn]<lt;gt.vertexLength+((Sn?1:0)+(Xn?1:0)+(An?1:0))>Yn.MAX_VERTEX_ARRAY_LENGTH&&(gt=ve.createNewSegment(Ce,Me),lt=zt.count,Sn=!0,Xn=!0,An=!0,Vt=0);const cn=Ae(it,ze,$e,zt,Mi,Sn,gt),Zi=Ae(it,ze,$e,zt,ln,Xn,gt),dr=Ae(it,ze,$e,zt,rn,An,gt);Me.emplaceBack(Vt+cn-lt,Vt+Zi-lt,Vt+dr-lt),gt.primitiveLength++}})(c,f,T,C,R,m),ue&&(function(ve,Ce,Me,ze,Fe,$e){const it=[];for(let Xt=0;Xt<ze.length/2;Xt++)it.push(-1);const zt={count:0};let lt=0,gt=ve.getOrCreateLatestSegment(Ce,Me),Vt=gt.vertexLength;for(let Xt=0;Xt<Fe.length;Xt++){const Mi=Fe[Xt];for(let ln=1;ln<Fe[Xt].length;ln+=2){const rn=Mi[ln-1],Sn=Mi[ln];let Xn=it[rn]<lt,An=it[Sn]<lt;gt.vertexLength+((Xn?1:0)+(An?1:0))>Yn.MAX_VERTEX_ARRAY_LENGTH&&(gt=ve.createNewSegment(Ce,Me),lt=zt.count,Xn=!0,An=!0,Vt=0);const cn=Ae(it,ze,$e,zt,rn,Xn,gt),Zi=Ae(it,ze,$e,zt,Sn,An,gt);Me.emplaceBack(Vt+cn-lt,Vt+Zi-lt),gt.primitiveLength++}}})(z,f,U,C,X,m),c.forceNewSegmentOnNextPrepare(),z?.forceNewSegmentOnNextPrepare()}function Ae(m,c,f,T,C,R,z){if(R){const U=T.count;return f(c[2*C],c[2*C+1]),m[C]=T.count,T.count++,z.vertexLength++,U}return m[C]}class Oe{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=c.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Tt,this.indexArray=new Pi,this.indexArray2=new On,this.programConfigurations=new $o(c.layers,c.zoom),this.segments=new Yn,this.segments2=new Yn,this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id))}populate(c,f,T){this.hasDependencies=gh("fill",this.layers,f);const C=this.layers[0].layout.get("fill-sort-key"),R=!C.isConstant(),z=[];for(const{feature:U,id:X,index:re,sourceLayerIndex:ue}of c){const ve=this.layers[0]._featureFilter.needGeometry,Ce=mh(U,ve);if(!this.layers[0]._featureFilter.filter(new To(this.zoom),Ce,T))continue;const Me=R?C.evaluate(Ce,{},T,f.availableImages):void 0,ze={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ue,index:re,geometry:ve?Ce.geometry:ph(U),patterns:{},sortKey:Me};z.push(ze)}R&&z.sort(((U,X)=>U.sortKey-X.sortKey));for(const U of z){const{geometry:X,index:re,sourceLayerIndex:ue}=U;if(this.hasDependencies){const ve=Wh("fill",this.layers,U,{zoom:this.zoom},f);this.patternFeatures.push(ve)}else this.addFeature(U,X,re,T,{},f.subdivisionGranularity);f.featureIndex.insert(c[re].feature,X,re,ue,this.index)}}update(c,f,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,{imagePositions:T})}addFeatures(c,f,T){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,f,T,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Af),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,f,T,C,R,z){for(const U of rf(f,500)){const X=he(U,C,z.fill.getGranularityForZoomLevel(C.z)),re=this.layoutVertexArray;ke(((ue,ve)=>{re.emplaceBack(ue,ve)}),this.segments,this.layoutVertexArray,this.indexArray,X.verticesFlattened,X.indicesTriangles,this.segments2,this.indexArray2,X.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,T,{imagePositions:R,canonical:C})}}let He,Be;ur("FillBucket",Oe,{omit:["layers","patternFeatures"]});var dt={get paint(){return Be=Be||new Nl({"fill-antialias":new vr(mi.paint_fill["fill-antialias"]),"fill-opacity":new Cr(mi.paint_fill["fill-opacity"]),"fill-color":new Cr(mi.paint_fill["fill-color"]),"fill-outline-color":new Cr(mi.paint_fill["fill-outline-color"]),"fill-translate":new vr(mi.paint_fill["fill-translate"]),"fill-translate-anchor":new vr(mi.paint_fill["fill-translate-anchor"]),"fill-pattern":new bf(mi.paint_fill["fill-pattern"])})},get layout(){return He=He||new Nl({"fill-sort-key":new Cr(mi.layout_fill["fill-sort-key"])})}};class nt extends Zc{constructor(c,f){super(c,dt,f)}recalculate(c,f){super.recalculate(c,f);const T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Oe(c)}queryRadius(){return i_(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:c,geometry:f,transform:T,pixelsToTileUnits:C}){return e_(ng(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-T.bearingInRadians,C),f)}isTileClipped(){return!0}}const at=Yo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tt=Yo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Je}=at;class mt{constructor(c,f,T,C,R){this.properties={},this.extent=T,this.type=0,this.id=void 0,this._pbf=c,this._geometry=-1,this._keys=C,this._values=R,c.readFields(Pt,this,f)}loadGeometry(){const c=this._pbf;c.pos=this._geometry;const f=c.readVarint()+c.pos,T=[];let C,R=1,z=0,U=0,X=0;for(;c.pos<f;){if(z<=0){const re=c.readVarint();R=7&re,z=re>>3}if(z--,R===1||R===2)U+=c.readSVarint(),X+=c.readSVarint(),R===1&&(C&&T.push(C),C=[]),C&&C.push(new P(U,X));else{if(R!==7)throw new Error(`unknown command ${R}`);C&&C.push(C[0].clone())}}return C&&T.push(C),T}bbox(){const c=this._pbf;c.pos=this._geometry;const f=c.readVarint()+c.pos;let T=1,C=0,R=0,z=0,U=1/0,X=-1/0,re=1/0,ue=-1/0;for(;c.pos<f;){if(C<=0){const ve=c.readVarint();T=7&ve,C=ve>>3}if(C--,T===1||T===2)R+=c.readSVarint(),z+=c.readSVarint(),R<U&&(U=R),R>X&&(X=R),z<re&&(re=z),z>ue&&(ue=z);else if(T!==7)throw new Error(`unknown command ${T}`)}return[U,re,X,ue]}toGeoJSON(c,f,T){const C=this.extent*Math.pow(2,T),R=this.extent*c,z=this.extent*f,U=this.loadGeometry();function X(Ce){return[360*(Ce.x+R)/C-180,360/Math.PI*Math.atan(Math.exp((1-2*(Ce.y+z)/C)*Math.PI))-90]}function re(Ce){return Ce.map(X)}let ue;if(this.type===1){const Ce=[];for(const ze of U)Ce.push(ze[0]);const Me=re(Ce);ue=Ce.length===1?{type:"Point",coordinates:Me[0]}:{type:"MultiPoint",coordinates:Me}}else if(this.type===2){const Ce=U.map(re);ue=Ce.length===1?{type:"LineString",coordinates:Ce[0]}:{type:"MultiLineString",coordinates:Ce}}else{if(this.type!==3)throw new Error("unknown feature type");{const Ce=It(U),Me=[];for(const ze of Ce)Me.push(ze.map(re));ue=Me.length===1?{type:"Polygon",coordinates:Me[0]}:{type:"MultiPolygon",coordinates:Me}}}const ve={type:"Feature",geometry:ue,properties:this.properties};return this.id!=null&&(ve.id=this.id),ve}}function Pt(m,c,f){m===1?c.id=f.readVarint():m===2?(function(T,C){const R=T.readVarint()+T.pos;for(;T.pos<R;){const z=C._keys[T.readVarint()],U=C._values[T.readVarint()];C.properties[z]=U}})(f,c):m===3?c.type=f.readVarint():m===4&&(c._geometry=f.pos)}function It(m){const c=m.length;if(c<=1)return[m];const f=[];let T,C;for(let R=0;R<c;R++){const z=ri(m[R]);z!==0&&(C===void 0&&(C=z<0),C===z<0?(T&&f.push(T),T=[m[R]]):T&&T.push(m[R]))}return T&&f.push(T),f}function ri(m){let c=0;for(let f,T,C=0,R=m.length,z=R-1;C<R;z=C++)f=m[C],T=m[z],c+=(T.x-f.x)*(f.y+T.y);return c}mt.types=["Unknown","Point","LineString","Polygon"];class si{constructor(c,f){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(_i,this,f),this.length=this._features.length}feature(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];const f=this._pbf.readVarint()+this._pbf.pos;return new mt(this._pbf,f,this.extent,this._keys,this._values)}}function _i(m,c,f){m===15?c.version=f.readVarint():m===1?c.name=f.readString():m===5?c.extent=f.readVarint():m===2?c._features.push(f.pos):m===3?c._keys.push(f.readString()):m===4&&c._values.push((function(T){let C=null;const R=T.readVarint()+T.pos;for(;T.pos<R;){const z=T.readVarint()>>3;C=z===1?T.readString():z===2?T.readFloat():z===3?T.readDouble():z===4?T.readVarint64():z===5?T.readVarint():z===6?T.readSVarint():z===7?T.readBoolean():null}if(C==null)throw new Error("unknown feature value");return C})(f))}class Vi{constructor(c,f){this.layers=c.readFields(Kt,{},f)}}function Kt(m,c,f){if(m===3){const T=new si(f,f.readVarint()+f.pos);T.length&&(c[T.name]=T)}}const bt=Math.pow(2,13);function oi(m,c,f,T,C,R,z,U){m.emplaceBack(c,f,2*Math.floor(T*bt)+z,C*bt*2,R*bt*2,Math.round(U))}class ni{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=c.index,this.hasDependencies=!1,this.layoutVertexArray=new Mt,this.centroidVertexArray=new xt,this.indexArray=new Pi,this.programConfigurations=new $o(c.layers,c.zoom),this.segments=new Yn,this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id))}populate(c,f,T){this.features=[],this.hasDependencies=gh("fill-extrusion",this.layers,f);for(const{feature:C,id:R,index:z,sourceLayerIndex:U}of c){const X=this.layers[0]._featureFilter.needGeometry,re=mh(C,X);if(!this.layers[0]._featureFilter.filter(new To(this.zoom),re,T))continue;const ue={id:R,sourceLayerIndex:U,index:z,geometry:X?re.geometry:ph(C),properties:C.properties,type:C.type,patterns:{}};this.hasDependencies?this.features.push(Wh("fill-extrusion",this.layers,ue,{zoom:this.zoom},f)):this.addFeature(ue,ue.geometry,z,T,{},f.subdivisionGranularity),f.featureIndex.insert(C,ue.geometry,z,U,this.index,!0)}}addFeatures(c,f,T){for(const C of this.features){const{geometry:R}=C;this.addFeature(C,R,C.index,f,T,c.subdivisionGranularity)}}update(c,f,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,{imagePositions:T})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Je),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,tt.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,f,T,C,R,z){for(const U of rf(f,500)){const X={x:0,y:0,sampleCount:0},re=this.layoutVertexArray.length;this.processPolygon(X,C,c,U,z);const ue=this.layoutVertexArray.length-re,ve=Math.floor(X.x/X.sampleCount),Ce=Math.floor(X.y/X.sampleCount);for(let Me=0;Me<ue;Me++)this.centroidVertexArray.emplaceBack(ve,Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,T,{imagePositions:R,canonical:C})}processPolygon(c,f,T,C,R){if(C.length<1||xn(C[0]))return;for(const ve of C)ve.length!==0&&Li(c,ve);const z={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},U=R.fill.getGranularityForZoomLevel(f.z),X=mt.types[T.type]==="Polygon";for(const ve of C){if(ve.length===0||xn(ve))continue;const Ce=be(ve,U,X);this._generateSideFaces(Ce,z)}if(!X)return;const re=he(C,f,U,!1),ue=this.layoutVertexArray;ke(((ve,Ce)=>{oi(ue,ve,Ce,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,re.verticesFlattened,re.indicesTriangles)}_generateSideFaces(c,f){let T=0;for(let C=1;C<c.length;C++){const R=c[C],z=c[C-1];if(en(R,z))continue;f.segment.vertexLength+4>Yn.MAX_VERTEX_ARRAY_LENGTH&&(f.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const U=R.sub(z)._perp()._unit(),X=z.dist(R);T+X>32768&&(T=0),oi(this.layoutVertexArray,R.x,R.y,U.x,U.y,0,0,T),oi(this.layoutVertexArray,R.x,R.y,U.x,U.y,0,1,T),T+=X,oi(this.layoutVertexArray,z.x,z.y,U.x,U.y,0,0,T),oi(this.layoutVertexArray,z.x,z.y,U.x,U.y,0,1,T);const re=f.segment.vertexLength;this.indexArray.emplaceBack(re,re+2,re+1),this.indexArray.emplaceBack(re+1,re+2,re+3),f.segment.vertexLength+=4,f.segment.primitiveLength+=2}}}function Li(m,c){for(let f=0;f<c.length;f++){const T=c[f];f===c.length-1&&c[0].x===T.x&&c[0].y===T.y||(m.x+=T.x,m.y+=T.y,m.sampleCount++)}}function en(m,c){return m.x===c.x&&(m.x<0||m.x>wi)||m.y===c.y&&(m.y<0||m.y>wi)}function xn(m){return m.every((c=>c.x<0))||m.every((c=>c.x>wi))||m.every((c=>c.y<0))||m.every((c=>c.y>wi))}let Yi;ur("FillExtrusionBucket",ni,{omit:["layers","features"]});var Wi={get paint(){return Yi=Yi||new Nl({"fill-extrusion-opacity":new vr(mi["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cr(mi["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vr(mi["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vr(mi["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bf(mi["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cr(mi["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cr(mi["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vr(mi["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class kn extends Zc{constructor(c,f){super(c,Wi,f)}createBucket(c){return new ni(c)}queryRadius(){return i_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:c,feature:f,featureState:T,geometry:C,transform:R,pixelsToTileUnits:z,pixelPosMatrix:U}){const X=ng(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-R.bearingInRadians,z),re=this.paint.get("fill-extrusion-height").evaluate(f,T),ue=this.paint.get("fill-extrusion-base").evaluate(f,T),ve=(function(Me,ze){const Fe=[];for(const $e of Me){const it=[$e.x,$e.y,0,1];Wt(it,it,ze),Fe.push(new P(it[0]/it[3],it[1]/it[3]))}return Fe})(X,U),Ce=(function(Me,ze,Fe,$e){const it=[],zt=[],lt=$e[8]*ze,gt=$e[9]*ze,Vt=$e[10]*ze,Xt=$e[11]*ze,Mi=$e[8]*Fe,ln=$e[9]*Fe,rn=$e[10]*Fe,Sn=$e[11]*Fe;for(const Xn of Me){const An=[],cn=[];for(const Zi of Xn){const dr=Zi.x,or=Zi.y,_r=$e[0]*dr+$e[4]*or+$e[12],er=$e[1]*dr+$e[5]*or+$e[13],Dr=$e[2]*dr+$e[6]*or+$e[14],vo=$e[3]*dr+$e[7]*or+$e[15],Qs=Dr+Vt,Ia=vo+Xt,zc=_r+Mi,Ll=er+ln,Na=Dr+rn,Ca=vo+Sn,qo=new P((_r+lt)/Ia,(er+gt)/Ia);qo.z=Qs/Ia,An.push(qo);const Ha=new P(zc/Ca,Ll/Ca);Ha.z=Na/Ca,cn.push(Ha)}it.push(An),zt.push(cn)}return[it,zt]})(C,ue,re,U);return(function(Me,ze,Fe){let $e=1/0;e_(Fe,ze)&&($e=pn(Fe,ze[0]));for(let it=0;it<ze.length;it++){const zt=ze[it],lt=Me[it];for(let gt=0;gt<zt.length-1;gt++){const Vt=zt[gt],Xt=[Vt,zt[gt+1],lt[gt+1],lt[gt],Vt];ju(Fe,Xt)&&($e=Math.min($e,pn(Fe,Xt)))}}return $e!==1/0&&$e})(Ce[0],Ce[1],ve)}}function Pn(m,c){return m.x*c.x+m.y*c.y}function pn(m,c){if(m.length===1){let f=0;const T=c[f++];let C;for(;!C||T.equals(C);)if(C=c[f++],!C)return 1/0;for(;f<c.length;f++){const R=c[f],z=m[0],U=C.sub(T),X=R.sub(T),re=z.sub(T),ue=Pn(U,U),ve=Pn(U,X),Ce=Pn(X,X),Me=Pn(re,U),ze=Pn(re,X),Fe=ue*Ce-ve*ve,$e=(Ce*Me-ve*ze)/Fe,it=(ue*ze-ve*Me)/Fe,zt=T.z*(1-$e-it)+C.z*$e+R.z*it;if(isFinite(zt))return zt}return 1/0}{let f=1/0;for(const T of c)f=Math.min(f,T.z);return f}}const Tn=Yo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Kn}=Tn,Er=Yo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ts}=Er,ys=Math.cos(Math.PI/180*37.5),Ln=Math.pow(2,14)/.5;class fs{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=c.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((f=>{this.gradients[f.id]={}})),this.layoutVertexArray=new Yt,this.layoutVertexArray2=new Rt,this.indexArray=new Pi,this.programConfigurations=new $o(c.layers,c.zoom),this.segments=new Yn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id))}populate(c,f,T){this.hasDependencies=gh("line",this.layers,f)||this.hasLineDasharray(this.layers);const C=this.layers[0].layout.get("line-sort-key"),R=!C.isConstant(),z=[];for(const{feature:U,id:X,index:re,sourceLayerIndex:ue}of c){const ve=this.layers[0]._featureFilter.needGeometry,Ce=mh(U,ve);if(!this.layers[0]._featureFilter.filter(new To(this.zoom),Ce,T))continue;const Me=R?C.evaluate(Ce,{},T):void 0,ze={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ue,index:re,geometry:ve?Ce.geometry:ph(U),patterns:{},dashes:{},sortKey:Me};z.push(ze)}R&&z.sort(((U,X)=>U.sortKey-X.sortKey));for(const U of z){const{geometry:X,index:re,sourceLayerIndex:ue}=U;this.hasDependencies?(gh("line",this.layers,f)?Wh("line",this.layers,U,{zoom:this.zoom},f):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,U,this.zoom,f),this.patternFeatures.push(U)):this.addFeature(U,X,re,T,{},{},f.subdivisionGranularity),f.featureIndex.insert(c[re].feature,X,re,ue,this.index)}}update(c,f,T,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,{imagePositions:T,dashPositions:C})}addFeatures(c,f,T,C){for(const R of this.patternFeatures)this.addFeature(R,R.geometry,R.index,f,T,C,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,ts)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Kn),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,f,T,C,R,z,U){const X=this.layers[0].layout,re=X.get("line-join").evaluate(c,{}),ue=X.get("line-cap"),ve=X.get("line-miter-limit"),Ce=X.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const Me of f)this.addLine(Me,c,re,ue,ve,Ce,C,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,T,{imagePositions:R,dashPositions:z,canonical:C})}addLine(c,f,T,C,R,z,U,X){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,c=be(c,U?X.line.getGranularityForZoomLevel(U.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let lt=0;lt<c.length-1;lt++)this.totalDistance+=c[lt].dist(c[lt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const re=mt.types[f.type]==="Polygon";let ue=c.length;for(;ue>=2&&c[ue-1].equals(c[ue-2]);)ue--;let ve=0;for(;ve<ue-1&&c[ve].equals(c[ve+1]);)ve++;if(ue<(re?3:2))return;T==="bevel"&&(R=1.05);const Ce=this.overscaling<=16?122880/(512*this.overscaling):0,Me=this.segments.prepareSegment(10*ue,this.layoutVertexArray,this.indexArray);let ze,Fe,$e,it,zt;this.e1=this.e2=-1,re&&(ze=c[ue-2],zt=c[ve].sub(ze)._unit()._perp());for(let lt=ve;lt<ue;lt++){if($e=lt===ue-1?re?c[ve+1]:void 0:c[lt+1],$e&&c[lt].equals($e))continue;zt&&(it=zt),ze&&(Fe=ze),ze=c[lt],zt=$e?$e.sub(ze)._unit()._perp():it,it=it||zt;let gt=it.add(zt);gt.x===0&&gt.y===0||gt._unit();const Vt=it.x*zt.x+it.y*zt.y,Xt=gt.x*zt.x+gt.y*zt.y,Mi=Xt!==0?1/Xt:1/0,ln=2*Math.sqrt(2-2*Xt),rn=Xt<ys&&Fe&&$e,Sn=it.x*zt.y-it.y*zt.x>0;if(rn&&lt>ve){const cn=ze.dist(Fe);if(cn>2*Ce){const Zi=ze.sub(ze.sub(Fe)._mult(Ce/cn)._round());this.updateDistance(Fe,Zi),this.addCurrentVertex(Zi,it,0,0,Me),Fe=Zi}}const Xn=Fe&&$e;let An=Xn?T:re?"butt":C;if(Xn&&An==="round"&&(Mi<z?An="miter":Mi<=2&&(An="fakeround")),An==="miter"&&Mi>R&&(An="bevel"),An==="bevel"&&(Mi>2&&(An="flipbevel"),Mi<R&&(An="miter")),Fe&&this.updateDistance(Fe,ze),An==="miter")gt._mult(Mi),this.addCurrentVertex(ze,gt,0,0,Me);else if(An==="flipbevel"){if(Mi>100)gt=zt.mult(-1);else{const cn=Mi*it.add(zt).mag()/it.sub(zt).mag();gt._perp()._mult(cn*(Sn?-1:1))}this.addCurrentVertex(ze,gt,0,0,Me),this.addCurrentVertex(ze,gt.mult(-1),0,0,Me)}else if(An==="bevel"||An==="fakeround"){const cn=-Math.sqrt(Mi*Mi-1),Zi=Sn?cn:0,dr=Sn?0:cn;if(Fe&&this.addCurrentVertex(ze,it,Zi,dr,Me),An==="fakeround"){const or=Math.round(180*ln/Math.PI/20);for(let _r=1;_r<or;_r++){let er=_r/or;if(er!==.5){const vo=er-.5;er+=er*vo*(er-1)*((1.0904+Vt*(Vt*(3.55645-1.43519*Vt)-3.2452))*vo*vo+(.848013+Vt*(.215638*Vt-1.06021)))}const Dr=zt.sub(it)._mult(er)._add(it)._unit()._mult(Sn?-1:1);this.addHalfVertex(ze,Dr.x,Dr.y,!1,Sn,0,Me)}}$e&&this.addCurrentVertex(ze,zt,-Zi,-dr,Me)}else if(An==="butt")this.addCurrentVertex(ze,gt,0,0,Me);else if(An==="square"){const cn=Fe?1:-1;this.addCurrentVertex(ze,gt,cn,cn,Me)}else An==="round"&&(Fe&&(this.addCurrentVertex(ze,it,0,0,Me),this.addCurrentVertex(ze,it,1,1,Me,!0)),$e&&(this.addCurrentVertex(ze,zt,-1,-1,Me,!0),this.addCurrentVertex(ze,zt,0,0,Me)));if(rn&&lt<ue-1){const cn=ze.dist($e);if(cn>2*Ce){const Zi=ze.add($e.sub(ze)._mult(Ce/cn)._round());this.updateDistance(ze,Zi),this.addCurrentVertex(Zi,zt,0,0,Me),ze=Zi}}}}addCurrentVertex(c,f,T,C,R,z=!1){const U=f.y*C-f.x,X=-f.y-f.x*C;this.addHalfVertex(c,f.x+f.y*T,f.y-f.x*T,z,!1,T,R),this.addHalfVertex(c,U,X,z,!0,-C,R),this.distance>Ln/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,f,T,C,R,z))}addHalfVertex({x:c,y:f},T,C,R,z,U,X){const re=.5*(this.lineClips?this.scaledDistance*(Ln-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((c<<1)+(R?1:0),(f<<1)+(z?1:0),Math.round(63*T)+128,Math.round(63*C)+128,1+(U===0?0:U<0?-1:1)|(63&re)<<2,re>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const ue=X.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,ue,this.e2),X.primitiveLength++),z?this.e2=ue:this.e1=ue}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,f){this.distance+=c.dist(f),this.updateScaledDistance()}hasLineDasharray(c){for(const f of c){const T=f.paint.get("line-dasharray");if(T&&!T.isConstant())return!0}return!1}addLineDashDependencies(c,f,T,C){for(const R of c){const z=R.paint.get("line-dasharray");if(!z||z.value.kind==="constant")continue;const U=R.layout.get("line-cap")==="round",X={dasharray:z.value.evaluate({zoom:T-1},f,{}),round:U},re={dasharray:z.value.evaluate({zoom:T},f,{}),round:U},ue={dasharray:z.value.evaluate({zoom:T+1},f,{}),round:U},ve=`${X.dasharray.join(",")},${X.round}`,Ce=`${re.dasharray.join(",")},${re.round}`,Me=`${ue.dasharray.join(",")},${ue.round}`;C.dashDependencies[ve]=X,C.dashDependencies[Ce]=re,C.dashDependencies[Me]=ue,f.dashes[R.id]={min:ve,mid:Ce,max:Me}}}}let br,Ts;ur("LineBucket",fs,{omit:["layers","patternFeatures"]});var zs={get paint(){return Ts=Ts||new Nl({"line-opacity":new Cr(mi.paint_line["line-opacity"]),"line-color":new Cr(mi.paint_line["line-color"]),"line-translate":new vr(mi.paint_line["line-translate"]),"line-translate-anchor":new vr(mi.paint_line["line-translate-anchor"]),"line-width":new Cr(mi.paint_line["line-width"]),"line-gap-width":new Cr(mi.paint_line["line-gap-width"]),"line-offset":new Cr(mi.paint_line["line-offset"]),"line-blur":new Cr(mi.paint_line["line-blur"]),"line-dasharray":new bf(mi.paint_line["line-dasharray"]),"line-pattern":new bf(mi.paint_line["line-pattern"]),"line-gradient":new Cc(mi.paint_line["line-gradient"])})},get layout(){return br=br||new Nl({"line-cap":new vr(mi.layout_line["line-cap"]),"line-join":new Cr(mi.layout_line["line-join"]),"line-miter-limit":new vr(mi.layout_line["line-miter-limit"]),"line-round-limit":new vr(mi.layout_line["line-round-limit"]),"line-sort-key":new Cr(mi.layout_line["line-sort-key"])})}};class Os extends Cr{possiblyEvaluate(c,f){return f=new To(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(c,f)}evaluate(c,f,T,C){return f=sn({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(c,f,T,C)}}let ls;class Ar extends Zc{constructor(c,f){super(c,zs,f),this.gradientVersion=0,ls||(ls=new Os(zs.paint.properties["line-width"].specification),ls.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!(function(T){return T._styleExpression!==void 0})(f)&&f._styleExpression.expression instanceof au,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,f){super.recalculate(c,f),this.paint._values["line-floorwidth"]=ls.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new fs(c)}queryRadius(c){const f=c,T=vs(Cf("line-width",this,f),Cf("line-gap-width",this,f)),C=Cf("line-offset",this,f);return T/2+Math.abs(C)+i_(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:c,feature:f,featureState:T,geometry:C,transform:R,pixelsToTileUnits:z}){const U=ng(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-R.bearingInRadians,z),X=z/2*vs(this.paint.get("line-width").evaluate(f,T),this.paint.get("line-gap-width").evaluate(f,T)),re=this.paint.get("line-offset").evaluate(f,T);return re&&(C=(function(ue,ve){const Ce=[];for(let Me=0;Me<ue.length;Me++){const ze=v0(ue[Me]),Fe=[];for(let $e=0;$e<ze.length;$e++){const it=ze[$e],zt=ze[$e-1],lt=ze[$e+1],gt=$e===0?new P(0,0):it.sub(zt)._unit()._perp(),Vt=$e===ze.length-1?new P(0,0):lt.sub(it)._unit()._perp(),Xt=gt._add(Vt)._unit(),Mi=Xt.x*Vt.x+Xt.y*Vt.y;Mi!==0&&Xt._mult(1/Mi),Fe.push(Xt._mult(ve)._add(it))}Ce.push(Fe)}return Ce})(C,re*z)),(function(ue,ve,Ce){for(let Me=0;Me<ve.length;Me++){const ze=ve[Me];if(ue.length>=3){for(let Fe=0;Fe<ze.length;Fe++)if(Jp(ue,ze[Fe]))return!0}if(g0(ue,ze,Ce))return!0}return!1})(U,C,X)}isTileClipped(){return!0}}function vs(m,c){return c>0?c+2*m:m}const ko=Yo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yo=Yo([{name:"a_projected_pos",components:3,type:"Float32"}],4);Yo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ms=Yo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Yo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cs=Yo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pr=Yo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function co(m,c,f){return m.sections.forEach((T=>{T.text=(function(C,R,z){const U=R.layout.get("text-transform").evaluate(z,{});return U==="uppercase"?C=C.toLocaleUpperCase():U==="lowercase"&&(C=C.toLocaleLowerCase()),Ou.applyArabicShaping&&(C=Ou.applyArabicShaping(C)),C})(T.text,c,f)})),m}Yo([{name:"triangle",components:3,type:"Uint16"}]),Yo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Yo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Yo([{type:"Float32",name:"offsetX"}]),Yo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Yo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ss=24;const uo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Zs={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},kc={40:!0};function Dl(m,c,f,T,C,R){if("fontStack"in c){const z=f[c.fontStack],U=z&&z[m];return U?U.metrics.advance*c.scale+C:0}{const z=T[c.imageName];return z?z.displaySize[0]*c.scale*Ss/R+C:0}}function Fa(m,c,f,T){const C=Math.pow(m-c,2);return T?m<c?C/2:2*C:C+Math.abs(f)*f}function ec(m,c,f){let T=0;return m===10&&(T-=1e4),f&&(T+=150),m!==40&&m!==65288||(T+=50),c!==41&&c!==65289||(T+=50),T}function Ul(m,c,f,T,C,R){let z=null,U=Fa(c,f,C,R);for(const X of T){const re=Fa(c-X.x,f,C,R)+X.badness;re<=U&&(z=X,U=re)}return{index:m,x:c,priorBreak:z,badness:U}}function Tl(m){return m?Tl(m.priorBreak).concat(m.index):[]}class tc{constructor(c="",f=[],T=[]){this.text=c,this.sections=f,this.sectionIndex=T,this.imageSectionID=null}static fromFeature(c,f){const T=new tc;for(let C=0;C<c.sections.length;C++){const R=c.sections[C];R.image?T.addImageSection(R):T.addTextSection(R,f)}return T}length(){return[...this.text].length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}verticalizePunctuation(){this.text=(function(c){let f="",T={premature:!0,value:void 0};const C=c[Symbol.iterator]();let R=C.next();const z=c[Symbol.iterator]();z.next();let U=z.next();for(;!R.done;)f+=!U.done&&dh(U.value.codePointAt(0))&&!uo[U.value]||!T.premature&&dh(T.value.codePointAt(0))&&!uo[T.value]||!uo[R.value]?R.value:uo[R.value],T={value:R.value,premature:!1},R=C.next(),U=z.next();return f})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const c=this.text.match(/^\s*/),f=c?c[0].length:0,T=this.text.match(/\S\s*$/),C=T?T[0].length-1:0;this.text=this.text.substring(f,this.text.length-C),this.sectionIndex=this.sectionIndex.slice(f,this.sectionIndex.length-C)}substring(c,f){const T=[...this.text].slice(c,f).join(""),C=this.sectionIndex.slice(c,f);return new tc(T,this.sections,C)}toCodeUnitIndex(c){return[...this.text].slice(0,c).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((c,f)=>Math.max(c,this.sections[f].scale)),0)}getMaxImageSize(c){let f=0,T=0;for(let C=0;C<this.length();C++){const R=this.getSection(C);if("imageName"in R){const z=c[R.imageName];if(!z)continue;const U=z.displaySize;f=Math.max(f,U[0]),T=Math.max(T,U[1])}}return{maxImageWidth:f,maxImageHeight:T}}addTextSection(c,f){this.text+=c.text,this.sections.push({scale:c.scale||1,verticalAlign:c.verticalAlign||"bottom",fontStack:c.fontStack||f});const T=this.sections.length-1;this.sectionIndex.push(...[...c.text].map((()=>T)))}addImageSection(c){const f=c.image?c.image.name:"";if(f.length===0)return void Gt("Can't add FormattedSection with an empty image.");const T=this.getNextImageSectionCharCode();T?(this.text+=String.fromCharCode(T),this.sections.push({scale:1,verticalAlign:c.verticalAlign||"bottom",imageName:f}),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(c,f,T,C,R){const z=[],U=this.determineAverageLineWidth(c,f,T,C,R),X=this.hasZeroWidthSpaces();let re=0,ue=0;const ve=this.text[Symbol.iterator]();let Ce=ve.next();const Me=this.text[Symbol.iterator]();Me.next();let ze=Me.next();const Fe=this.text[Symbol.iterator]();Fe.next(),Fe.next();let $e=Fe.next();for(;!Ce.done;){const it=this.getSection(ue),zt=Ce.value.codePointAt(0);if(Zg(zt)||(re+=Dl(zt,it,T,C,c,R)),!ze.done){const lt=yf(zt),gt=ze.value.codePointAt(0);(Zs[zt]||lt||"imageName"in it||!$e.done&&kc[gt])&&z.push(Ul(ue+1,re,U,z,ec(zt,gt,lt&&X),!1))}ue++,Ce=ve.next(),ze=Me.next(),$e=Fe.next()}return Tl(Ul(this.length(),re,U,z,0,!0))}determineAverageLineWidth(c,f,T,C,R){let z=0,U=0;for(const X of this.text){const re=this.getSection(U);z+=Dl(X.codePointAt(0),re,T,C,c,R),U++}return z/Math.max(1,Math.ceil(z/f))}}const vu=4294967296,Dc=1/vu,Do=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Go{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,f,T=this.length){for(;this.pos<T;){const C=this.readVarint(),R=C>>3,z=this.pos;this.type=7&C,c(R,f,this),this.pos===z&&this.skip(C)}return f}readMessage(c,f){return this.readFields(c,f,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vu;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vu;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const f=this.buf;let T,C;return C=f[this.pos++],T=127&C,C<128?T:(C=f[this.pos++],T|=(127&C)<<7,C<128?T:(C=f[this.pos++],T|=(127&C)<<14,C<128?T:(C=f[this.pos++],T|=(127&C)<<21,C<128?T:(C=f[this.pos],T|=(15&C)<<28,(function(R,z,U){const X=U.buf;let re,ue;if(ue=X[U.pos++],re=(112&ue)>>4,ue<128||(ue=X[U.pos++],re|=(127&ue)<<3,ue<128)||(ue=X[U.pos++],re|=(127&ue)<<10,ue<128)||(ue=X[U.pos++],re|=(127&ue)<<17,ue<128)||(ue=X[U.pos++],re|=(127&ue)<<24,ue<128)||(ue=X[U.pos++],re|=(1&ue)<<31,ue<128))return Ds(R,re,z);throw new Error("Expected varint not more than 10 bytes")})(T,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,f=this.pos;return this.pos=c,c-f>=12&&Do?Do.decode(this.buf.subarray(f,c)):(function(T,C,R){let z="",U=C;for(;U<R;){const X=T[U];let re,ue,ve,Ce=null,Me=X>239?4:X>223?3:X>191?2:1;if(U+Me>R)break;Me===1?X<128&&(Ce=X):Me===2?(re=T[U+1],(192&re)==128&&(Ce=(31&X)<<6|63&re,Ce<=127&&(Ce=null))):Me===3?(re=T[U+1],ue=T[U+2],(192&re)==128&&(192&ue)==128&&(Ce=(15&X)<<12|(63&re)<<6|63&ue,(Ce<=2047||Ce>=55296&&Ce<=57343)&&(Ce=null))):Me===4&&(re=T[U+1],ue=T[U+2],ve=T[U+3],(192&re)==128&&(192&ue)==128&&(192&ve)==128&&(Ce=(15&X)<<18|(63&re)<<12|(63&ue)<<6|63&ve,(Ce<=65535||Ce>=1114112)&&(Ce=null))),Ce===null?(Ce=65533,Me=1):Ce>65535&&(Ce-=65536,z+=String.fromCharCode(Ce>>>10&1023|55296),Ce=56320|1023&Ce),z+=String.fromCharCode(Ce),U+=Me}return z})(this.buf,f,c)}readBytes(){const c=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,c);return this.pos=c,f}readPackedVarint(c=[],f){const T=this.readPackedEnd();for(;this.pos<T;)c.push(this.readVarint(f));return c}readPackedSVarint(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const f=this.readPackedEnd();for(;this.pos<f;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const f=7&c;if(f===0)for(;this.buf[this.pos++]>127;);else if(f===2)this.pos=this.readVarint()+this.pos;else if(f===5)this.pos+=4;else{if(f!==1)throw new Error(`Unimplemented type: ${f}`);this.pos+=8}}writeTag(c,f){this.writeVarint(c<<3|f)}realloc(c){let f=this.length||16;for(;f<this.pos+c;)f*=2;if(f!==this.length){const T=new Uint8Array(f);T.set(this.buf),this.buf=T,this.dataView=new DataView(T.buffer),this.length=f}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*Dc),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*Dc),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?(function(f,T){let C,R;if(f>=0?(C=f%4294967296|0,R=f/4294967296|0):(C=~(-f%4294967296),R=~(-f/4294967296),4294967295^C?C=C+1|0:(C=0,R=R+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");T.realloc(10),(function(z,U,X){X.buf[X.pos++]=127&z|128,z>>>=7,X.buf[X.pos++]=127&z|128,z>>>=7,X.buf[X.pos++]=127&z|128,z>>>=7,X.buf[X.pos++]=127&z|128,X.buf[X.pos]=127&(z>>>=7)})(C,0,T),(function(z,U){const X=(7&z)<<4;U.buf[U.pos++]|=X|((z>>>=3)?128:0),z&&(U.buf[U.pos++]=127&z|((z>>>=7)?128:0),z&&(U.buf[U.pos++]=127&z|((z>>>=7)?128:0),z&&(U.buf[U.pos++]=127&z|((z>>>=7)?128:0),z&&(U.buf[U.pos++]=127&z|((z>>>=7)?128:0),z&&(U.buf[U.pos++]=127&z)))))})(R,T)})(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const f=this.pos;this.pos=(function(C,R,z){for(let U,X,re=0;re<R.length;re++){if(U=R.charCodeAt(re),U>55295&&U<57344){if(!X){U>56319||re+1===R.length?(C[z++]=239,C[z++]=191,C[z++]=189):X=U;continue}if(U<56320){C[z++]=239,C[z++]=191,C[z++]=189,X=U;continue}U=X-55296<<10|U-56320|65536,X=null}else X&&(C[z++]=239,C[z++]=191,C[z++]=189,X=null);U<128?C[z++]=U:(U<2048?C[z++]=U>>6|192:(U<65536?C[z++]=U>>12|224:(C[z++]=U>>18|240,C[z++]=U>>12&63|128),C[z++]=U>>6&63|128),C[z++]=63&U|128)}return z})(this.buf,c,this.pos);const T=this.pos-f;T>=128&&la(f,T,this),this.pos=f-1,this.writeVarint(T),this.pos+=T}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const f=c.length;this.writeVarint(f),this.realloc(f);for(let T=0;T<f;T++)this.buf[this.pos++]=c[T]}writeRawMessage(c,f){this.pos++;const T=this.pos;c(f,this);const C=this.pos-T;C>=128&&la(T,C,this),this.pos=T-1,this.writeVarint(C),this.pos+=C}writeMessage(c,f,T){this.writeTag(c,2),this.writeRawMessage(f,T)}writePackedVarint(c,f){f.length&&this.writeMessage(c,Lo,f)}writePackedSVarint(c,f){f.length&&this.writeMessage(c,Io,f)}writePackedBoolean(c,f){f.length&&this.writeMessage(c,Xh,f)}writePackedFloat(c,f){f.length&&this.writeMessage(c,vh,f)}writePackedDouble(c,f){f.length&&this.writeMessage(c,h_,f)}writePackedFixed32(c,f){f.length&&this.writeMessage(c,d_,f)}writePackedSFixed32(c,f){f.length&&this.writeMessage(c,ug,f)}writePackedFixed64(c,f){f.length&&this.writeMessage(c,Od,f)}writePackedSFixed64(c,f){f.length&&this.writeMessage(c,Mf,f)}writeBytesField(c,f){this.writeTag(c,2),this.writeBytes(f)}writeFixed32Field(c,f){this.writeTag(c,5),this.writeFixed32(f)}writeSFixed32Field(c,f){this.writeTag(c,5),this.writeSFixed32(f)}writeFixed64Field(c,f){this.writeTag(c,1),this.writeFixed64(f)}writeSFixed64Field(c,f){this.writeTag(c,1),this.writeSFixed64(f)}writeVarintField(c,f){this.writeTag(c,0),this.writeVarint(f)}writeSVarintField(c,f){this.writeTag(c,0),this.writeSVarint(f)}writeStringField(c,f){this.writeTag(c,2),this.writeString(f)}writeFloatField(c,f){this.writeTag(c,5),this.writeFloat(f)}writeDoubleField(c,f){this.writeTag(c,1),this.writeDouble(f)}writeBooleanField(c,f){this.writeVarintField(c,+f)}}function Ds(m,c,f){return f?4294967296*c+(m>>>0):4294967296*(c>>>0)+(m>>>0)}function la(m,c,f){const T=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));f.realloc(T);for(let C=f.pos-1;C>=m;C--)f.buf[C+T]=f.buf[C]}function Lo(m,c){for(let f=0;f<m.length;f++)c.writeVarint(m[f])}function Io(m,c){for(let f=0;f<m.length;f++)c.writeSVarint(m[f])}function vh(m,c){for(let f=0;f<m.length;f++)c.writeFloat(m[f])}function h_(m,c){for(let f=0;f<m.length;f++)c.writeDouble(m[f])}function Xh(m,c){for(let f=0;f<m.length;f++)c.writeBoolean(m[f])}function d_(m,c){for(let f=0;f<m.length;f++)c.writeFixed32(m[f])}function ug(m,c){for(let f=0;f<m.length;f++)c.writeSFixed32(m[f])}function Od(m,c){for(let f=0;f<m.length;f++)c.writeFixed64(m[f])}function Mf(m,c){for(let f=0;f<m.length;f++)c.writeSFixed64(m[f])}function hg(m,c,f){m===1&&f.readMessage(mp,c)}function mp(m,c,f){if(m===3){const{id:T,bitmap:C,width:R,height:z,left:U,top:X,advance:re}=f.readMessage(kf,{});c.push({id:T,bitmap:new pp({width:R+6,height:z+6},C),metrics:{width:R,height:z,left:U,top:X,advance:re}})}}function kf(m,c,f){m===1?c.id=f.readVarint():m===2?c.bitmap=f.readBytes():m===3?c.width=f.readVarint():m===4?c.height=f.readVarint():m===5?c.left=f.readSVarint():m===6?c.top=f.readSVarint():m===7&&(c.advance=f.readVarint())}function xh(m){let c=0,f=0;for(const z of m)c+=z.w*z.h,f=Math.max(f,z.w);m.sort(((z,U)=>U.h-z.h));const T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}];let C=0,R=0;for(const z of m)for(let U=T.length-1;U>=0;U--){const X=T[U];if(!(z.w>X.w||z.h>X.h)){if(z.x=X.x,z.y=X.y,R=Math.max(R,z.y+z.h),C=Math.max(C,z.x+z.w),z.w===X.w&&z.h===X.h){const re=T.pop();re&&U<T.length&&(T[U]=re)}else z.h===X.h?(X.x+=z.w,X.w-=z.w):z.w===X.w?(X.y+=z.h,X.h-=z.h):(T.push({x:X.x+z.w,y:X.y,w:X.w-z.w,h:z.h}),X.y+=z.h,X.h-=z.h);break}}return{w:C,h:R,fill:c/(C*R)||0}}class Yh{constructor(c,{pixelRatio:f,version:T,stretchX:C,stretchY:R,content:z,textFitWidth:U,textFitHeight:X}){this.paddedRect=c,this.pixelRatio=f,this.stretchX=C,this.stretchY=R,this.content=z,this.version=T,this.textFitWidth=U,this.textFitHeight=X}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ab{constructor(c,f){const T={},C={};this.haveRenderCallbacks=[];const R=[];this.addImages(c,T,R),this.addImages(f,C,R);const{w:z,h:U}=xh(R),X=new lo({width:z||1,height:U||1});for(const re in c){const ue=c[re],ve=T[re].paddedRect;lo.copy(ue.data,X,{x:0,y:0},{x:ve.x+1,y:ve.y+1},ue.data)}for(const re in f){const ue=f[re],ve=C[re].paddedRect,Ce=ve.x+1,Me=ve.y+1,ze=ue.data.width,Fe=ue.data.height;lo.copy(ue.data,X,{x:0,y:0},{x:Ce,y:Me},ue.data),lo.copy(ue.data,X,{x:0,y:Fe-1},{x:Ce,y:Me-1},{width:ze,height:1}),lo.copy(ue.data,X,{x:0,y:0},{x:Ce,y:Me+Fe},{width:ze,height:1}),lo.copy(ue.data,X,{x:ze-1,y:0},{x:Ce-1,y:Me},{width:1,height:Fe}),lo.copy(ue.data,X,{x:0,y:0},{x:Ce+ze,y:Me},{width:1,height:Fe})}this.image=X,this.iconPositions=T,this.patternPositions=C}addImages(c,f,T){for(const C in c){const R=c[C],z={x:0,y:0,w:R.data.width+2,h:R.data.height+2};T.push(z),f[C]=new Yh(z,R),R.hasRenderCallback&&this.haveRenderCallbacks.push(C)}}patchUpdatedImages(c,f){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const T in c.updatedImages)this.patchUpdatedImage(this.iconPositions[T],c.getImage(T),f),this.patchUpdatedImage(this.patternPositions[T],c.getImage(T),f)}patchUpdatedImage(c,f,T){if(!c||!f||c.version===f.version)return;c.version=f.version;const[C,R]=c.tl;T.update(f.data,void 0,{x:C,y:R})}}var em;function f_(m,c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze){const Fe=tc.fromFeature(m,C);let $e;ve===b.az.vertical&&Fe.verticalizePunctuation();let it=Fe.determineLineBreaks(re,R,c,T,Me);const{processBidirectionalText:zt,processStyledBidirectionalText:lt}=Ou;if(zt&&Fe.sections.length===1){$e=[],it=it.map((Mi=>Fe.toCodeUnitIndex(Mi)));const Xt=zt(Fe.toString(),it);for(const Mi of Xt){const ln=[...Mi].map((()=>0));$e.push(new tc(Mi,Fe.sections,ln))}}else if(lt){$e=[],it=it.map((rn=>Fe.toCodeUnitIndex(rn)));let Xt=0;const Mi=[];for(const rn of Fe.text)Mi.push(...Array(rn.length).fill(Fe.sectionIndex[Xt])),Xt++;const ln=lt(Fe.text,Mi,it);for(const rn of ln){const Sn=[];let Xn="";for(const An of rn[0])Sn.push(rn[1][Xn.length]),Xn+=An;$e.push(new tc(rn[0],Fe.sections,Sn))}}else $e=(function(Xt,Mi){const ln=[];let rn=0;for(const Sn of Mi)ln.push(Xt.substring(rn,Sn)),rn=Sn;return rn<Xt.length()&&ln.push(Xt.substring(rn,Xt.length())),ln})(Fe,it);const gt=[],Vt={positionedLines:gt,text:Fe.toString(),top:ue[1],bottom:ue[1],left:ue[0],right:ue[0],writingMode:ve,iconsInText:!1,verticalizable:!1};return(function(Xt,Mi,ln,rn,Sn,Xn,An,cn,Zi,dr,or,_r){let er=0,Dr=0,vo=0,Qs=0;const Ia=cn==="right"?1:cn==="left"?0:.5,zc=Ss/_r;let Ll=0;for(const qo of Sn){qo.trim();const Ha=qo.getMaxScale(),Va={positionedGlyphs:[],lineOffset:0};Xt.positionedLines[Ll]=Va;const ga=Va.positionedGlyphs;let Uu=0;if(!qo.length()){Dr+=Xn,++Ll;continue}const rc=S0(rn,qo,zc);let Jc=0;for(const sc of qo.text){const Wa=qo.getSection(Jc),Sl=sc.codePointAt(0),Za=c2(Zi,or,Sl),oc={glyph:Sl,imageName:null,x:er,y:Dr+-17,vertical:Za,scale:1,fontStack:"",sectionIndex:qo.getSectionIndex(Jc),metrics:null,rect:null};let cm;if("fontStack"in Wa){if(cm=Iv(Wa,Sl,Za,rc,Mi,ln),!cm)continue;oc.fontStack=Wa.fontStack}else{if(Xt.iconsInText=!0,Wa.scale*=zc,cm=Pb(Wa,Za,Ha,rc,rn),!cm)continue;Uu=Math.max(Uu,cm.imageOffset),oc.imageName=Wa.imageName}const{rect:Lf,metrics:U0,baselineOffset:pg}=cm;oc.y+=pg,oc.scale=Wa.scale,oc.metrics=U0,oc.rect=Lf,ga.push(oc),Za?(Xt.verticalizable=!0,er+=("imageName"in Wa?U0.advance:Ss)*Wa.scale+dr):er+=U0.advance*Wa.scale+dr,Jc++}ga.length!==0&&(vo=Math.max(er-dr,vo),Mb(ga,0,ga.length-1,Ia)),er=0,Va.lineOffset=Math.max(Uu,(Ha-1)*Ss);const Qh=Xn*Ha+Uu;Dr+=Qh,Qs=Math.max(Qh,Qs),++Ll}const{horizontalAlign:Na,verticalAlign:Ca}=T0(An);(function(qo,Ha,Va,ga,Uu,rc,Jc,Qh,sc){const Wa=(Ha-Va)*Uu;let Sl=0;Sl=rc!==Jc?-Qh*ga- -17:-ga*sc*Jc+.5*Jc;for(const Za of qo)for(const oc of Za.positionedGlyphs)oc.x+=Wa,oc.y+=Sl})(Xt.positionedLines,Ia,Na,Ca,vo,Qs,Xn,Dr,Sn.length),Xt.top+=-Ca*Dr,Xt.bottom=Xt.top+Dr,Xt.left+=-Na*vo,Xt.right=Xt.left+vo})(Vt,c,f,T,$e,z,U,X,ve,re,Ce,ze),!(function(Xt){for(const Mi of Xt)if(Mi.positionedGlyphs.length!==0)return!1;return!0})(gt)&&Vt}function T0(m){let c=.5,f=.5;switch(m){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(m){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function S0(m,c,f){const T=c.getMaxScale()*Ss,{maxImageWidth:C,maxImageHeight:R}=c.getMaxImageSize(m),z=Math.max(T,R*f);return{verticalLineContentWidth:Math.max(T,C*f),horizontalLineContentHeight:z}}function E0(m){switch(m){case"top":return 0;case"center":return .5;default:return 1}}function c2(m,c,f){return!(m===b.az.horizontal||!c&&!Wp(f)||c&&(Zg(f)||(T=f,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(T)))));var T}function Iv(m,c,f,T,C,R){const z=R[m.fontStack],U=(function(re,ue,ve,Ce){if(re&&re.rect)return re;const Me=ue[ve.fontStack],ze=Me&&Me[Ce];return ze?{rect:null,metrics:ze.metrics}:null})(z&&z[c],C,m,c);if(U===null)return null;let X;if(f)X=T.verticalLineContentWidth-m.scale*Ss;else{const re=E0(m.verticalAlign);X=(T.horizontalLineContentHeight-m.scale*Ss)*re}return{rect:U.rect,metrics:U.metrics,baselineOffset:X}}function Pb(m,c,f,T,C){const R=C[m.imageName];if(!R)return null;const z=R.paddedRect,U=R.displaySize,X={width:U[0],height:U[1],left:1,top:-3,advance:c?U[1]:U[0]};let re;if(c)re=T.verticalLineContentWidth-U[1]*m.scale;else{const ue=E0(m.verticalAlign);re=(T.horizontalLineContentHeight-U[1]*m.scale)*ue}return{rect:z,metrics:X,baselineOffset:re,imageOffset:(c?U[0]:U[1])*m.scale-Ss*f}}function Mb(m,c,f,T){if(T===0)return;const C=m[f],R=(m[f].x+C.metrics.advance*C.scale)*T;for(let z=c;z<=f;z++)m[z].x-=R}function u2(m,c,f){const{horizontalAlign:T,verticalAlign:C}=T0(f),R=c[0]-m.displaySize[0]*T,z=c[1]-m.displaySize[1]*C;return{image:m,top:z,bottom:z+m.displaySize[1],left:R,right:R+m.displaySize[0]}}function kb(m){var c,f;let T=m.left,C=m.top,R=m.right-T,z=m.bottom-C;const U=(c=m.image.textFitWidth)!==null&&c!==void 0?c:"stretchOrShrink",X=(f=m.image.textFitHeight)!==null&&f!==void 0?f:"stretchOrShrink",re=(m.image.content[2]-m.image.content[0])/(m.image.content[3]-m.image.content[1]);if(X==="proportional"){if(U==="stretchOnly"&&R/z<re||U==="proportional"){const ue=Math.ceil(z*re);T*=ue/R,R=ue}}else if(U==="proportional"&&X==="stretchOnly"&&re!==0&&R/z>re){const ue=Math.ceil(R/re);C*=ue/z,z=ue}return{x1:T,y1:C,x2:T+R,y2:C+z}}function tm(m,c,f,T,C,R){const z=m.image;let U;if(z.content){const $e=z.content,it=z.pixelRatio||1;U=[$e[0]/it,$e[1]/it,z.displaySize[0]-$e[2]/it,z.displaySize[1]-$e[3]/it]}const X=c.left*R,re=c.right*R;let ue,ve,Ce,Me;f==="width"||f==="both"?(Me=C[0]+X-T[3],ve=C[0]+re+T[1]):(Me=C[0]+(X+re-z.displaySize[0])/2,ve=Me+z.displaySize[0]);const ze=c.top*R,Fe=c.bottom*R;return f==="height"||f==="both"?(ue=C[1]+ze-T[0],Ce=C[1]+Fe+T[2]):(ue=C[1]+(ze+Fe-z.displaySize[1])/2,Ce=ue+z.displaySize[1]),{image:z,top:ue,right:ve,bottom:Ce,left:Me,collisionPadding:U}}ur("ImagePosition",Yh),ur("ImageAtlas",Ab),b.az=void 0,(em=b.az||(b.az={}))[em.none=0]="none",em[em.horizontal=1]="horizontal",em[em.vertical=2]="vertical",em[em.horizontalOnly=3]="horizontalOnly";const gp=128,_p=32640;function Db(m,c){const{expression:f}=c;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new To(m+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:T,interpolationType:C}=f;let R=0;for(;R<T.length&&T[R]<=m;)R++;R=Math.max(0,R-1);let z=R;for(;z<T.length&&T[z]<m+1;)z++;z=Math.min(T.length-1,z);const U=T[R],X=T[z];return f.kind==="composite"?{kind:"composite",minZoom:U,maxZoom:X,interpolationType:C}:{kind:"camera",minZoom:U,maxZoom:X,minSize:f.evaluate(new To(U)),maxSize:f.evaluate(new To(X)),interpolationType:C}}}function Lb(m,c,f){let T="never";const C=m.get(c);return C?T=C:m.get(f)&&(T="always"),T}const gI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cv(m,c,f,T,C,R,z,U,X,re,ue,ve,Ce){const Me=U?Math.min(_p,Math.round(U[0])):0,ze=U?Math.min(_p,Math.round(U[1])):0;m.emplaceBack(c,f,Math.round(32*T),Math.round(32*C),R,z,(Me<<1)+(X?1:0),ze,16*re,16*ue,256*ve,256*Ce)}function Av(m,c,f){m.emplaceBack(c.x,c.y,f),m.emplaceBack(c.x,c.y,f),m.emplaceBack(c.x,c.y,f),m.emplaceBack(c.x,c.y,f)}function h2(m){for(const c of m.sections)if(Yg(c.text))return!0;return!1}class Rb{constructor(c){this.layoutVertexArray=new Ut,this.indexArray=new Pi,this.programConfigurations=c,this.segments=new Yn,this.dynamicLayoutVertexArray=new hi,this.opacityVertexArray=new $i,this.hasVisibleVertices=!1,this.placedSymbolArray=new H}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,f,T,C){this.isEmpty()||(T&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,ko.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,yo.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,gI,!0),this.opacityVertexBuffer.itemSize=1),(T||C)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ur("SymbolBuffers",Rb);class Pv{constructor(c,f,T){this.layoutVertexArray=new c,this.layoutAttributes=f,this.indexArray=new T,this.segments=new Yn,this.collisionVertexArray=new Di}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Ms.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ur("CollisionBuffers",Pv);class yy{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map((z=>z.id)),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Db(this.zoom,f["text-size"]),this.iconSizeData=Db(this.zoom,f["icon-size"]);const T=this.layers[0].layout,C=T.get("symbol-sort-key"),R=T.get("symbol-z-order");this.canOverlap=Lb(T,"text-overlap","text-allow-overlap")!=="never"||Lb(T,"icon-overlap","icon-allow-overlap")!=="never"||T.get("text-ignore-placement")||T.get("icon-ignore-placement"),this.sortFeaturesByKey=R!=="viewport-y"&&!C.isConstant(),this.sortFeaturesByY=(R==="viewport-y"||R==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,T.get("symbol-placement")==="point"&&(this.writingModes=T.get("text-writing-mode").map((z=>b.az[z]))),this.stateDependentLayerIds=this.layers.filter((z=>z.isStateDependent())).map((z=>z.id)),this.sourceID=c.sourceID}createArrays(){this.text=new Rb(new $o(this.layers,this.zoom,(c=>/^text/.test(c)))),this.icon=new Rb(new $o(this.layers,this.zoom,(c=>/^icon/.test(c)))),this.glyphOffsetArray=new ge,this.lineVertexArray=new xe,this.symbolInstances=new te,this.textAnchorOffsets=new De}calculateGlyphDependencies(c,f,T,C,R){for(const z of c)if(f[z.codePointAt(0)]=!0,(T||C)&&R){const U=uo[z];U&&(f[U.codePointAt(0)]=!0)}}populate(c,f,T){const C=this.layers[0],R=C.layout,z=R.get("text-font"),U=R.get("text-field"),X=R.get("icon-image"),re=(U.value.kind!=="constant"||U.value.value instanceof cl&&!U.value.value.isEmpty()||U.value.value.toString().length>0)&&(z.value.kind!=="constant"||z.value.value.length>0),ue=X.value.kind!=="constant"||!!X.value.value||Object.keys(X.parameters).length>0,ve=R.get("symbol-sort-key");if(this.features=[],!re&&!ue)return;const Ce=f.iconDependencies,Me=f.glyphDependencies,ze=f.availableImages,Fe=new To(this.zoom);for(const{feature:$e,id:it,index:zt,sourceLayerIndex:lt}of c){const gt=C._featureFilter.needGeometry,Vt=mh($e,gt);if(!C._featureFilter.filter(Fe,Vt,T))continue;let Xt,Mi;if(gt||(Vt.geometry=ph($e)),re){const rn=C.getValueAndResolveTokens("text-field",Vt,T,ze),Sn=cl.factory(rn),Xn=this.hasRTLText=this.hasRTLText||h2(Sn);(!Xn||Ou.getRTLTextPluginStatus()==="unavailable"||Xn&&Ou.isParsed())&&(Xt=co(Sn,C,Vt))}if(ue){const rn=C.getValueAndResolveTokens("icon-image",Vt,T,ze);Mi=rn instanceof Zl?rn:Zl.fromString(rn)}if(!Xt&&!Mi)continue;const ln=this.sortFeaturesByKey?ve.evaluate(Vt,{},T):void 0;if(this.features.push({id:it,text:Xt,icon:Mi,index:zt,sourceLayerIndex:lt,geometry:Vt.geometry,properties:$e.properties,type:mt.types[$e.type],sortKey:ln}),Mi&&(Ce[Mi.name]=!0),Xt){const rn=z.evaluate(Vt,{},T).join(","),Sn=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.az.vertical)>=0;for(const Xn of Xt.sections)if(Xn.image)Ce[Xn.image.name]=!0;else{const An=kd(Xt.toString()),cn=Xn.fontStack||rn,Zi=Me[cn]=Me[cn]||{};this.calculateGlyphDependencies(Xn.text,Zi,Sn,this.allowVerticalPlacement,An)}}}R.get("symbol-placement")==="line"&&(this.features=(function($e){const it={},zt={},lt=[];let gt=0;function Vt(rn){lt.push($e[rn]),gt++}function Xt(rn,Sn,Xn){const An=zt[rn];return delete zt[rn],zt[Sn]=An,lt[An].geometry[0].pop(),lt[An].geometry[0]=lt[An].geometry[0].concat(Xn[0]),An}function Mi(rn,Sn,Xn){const An=it[Sn];return delete it[Sn],it[rn]=An,lt[An].geometry[0].shift(),lt[An].geometry[0]=Xn[0].concat(lt[An].geometry[0]),An}function ln(rn,Sn,Xn){const An=Xn?Sn[0][Sn[0].length-1]:Sn[0][0];return`${rn}:${An.x}:${An.y}`}for(let rn=0;rn<$e.length;rn++){const Sn=$e[rn],Xn=Sn.geometry,An=Sn.text?Sn.text.toString():null;if(!An){Vt(rn);continue}const cn=ln(An,Xn),Zi=ln(An,Xn,!0);if(cn in zt&&Zi in it&&zt[cn]!==it[Zi]){const dr=Mi(cn,Zi,Xn),or=Xt(cn,Zi,lt[dr].geometry);delete it[cn],delete zt[Zi],zt[ln(An,lt[or].geometry,!0)]=or,lt[dr].geometry=null}else cn in zt?Xt(cn,Zi,Xn):Zi in it?Mi(cn,Zi,Xn):(Vt(rn),it[cn]=gt-1,zt[Zi]=gt-1)}return lt.filter((rn=>rn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort((($e,it)=>$e.sortKey-it.sortKey))}update(c,f,T){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,f,this.layers,{imagePositions:T}),this.icon.programConfigurations.updatePaintArrays(c,f,this.layers,{imagePositions:T}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,f){const T=this.lineVertexArray.length;if(c.segment!==void 0){let C=c.dist(f[c.segment+1]),R=c.dist(f[c.segment]);const z={};for(let U=c.segment+1;U<f.length;U++)z[U]={x:f[U].x,y:f[U].y,tileUnitDistanceFromAnchor:C},U<f.length-1&&(C+=f[U+1].dist(f[U]));for(let U=c.segment||0;U>=0;U--)z[U]={x:f[U].x,y:f[U].y,tileUnitDistanceFromAnchor:R},U>0&&(R+=f[U-1].dist(f[U]));for(let U=0;U<f.length;U++){const X=z[U];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:T,lineLength:this.lineVertexArray.length-T}}addSymbols(c,f,T,C,R,z,U,X,re,ue,ve,Ce){const Me=c.indexArray,ze=c.layoutVertexArray,Fe=c.segments.prepareSegment(4*f.length,ze,Me,this.canOverlap?z.sortKey:void 0),$e=this.glyphOffsetArray.length,it=Fe.vertexLength,zt=this.allowVerticalPlacement&&U===b.az.vertical?Math.PI/2:0,lt=z.text&&z.text.sections;for(let gt=0;gt<f.length;gt++){const{tl:Vt,tr:Xt,bl:Mi,br:ln,tex:rn,pixelOffsetTL:Sn,pixelOffsetBR:Xn,minFontScaleX:An,minFontScaleY:cn,glyphOffset:Zi,isSDF:dr,sectionIndex:or}=f[gt],_r=Fe.vertexLength,er=Zi[1];Cv(ze,X.x,X.y,Vt.x,er+Vt.y,rn.x,rn.y,T,dr,Sn.x,Sn.y,An,cn),Cv(ze,X.x,X.y,Xt.x,er+Xt.y,rn.x+rn.w,rn.y,T,dr,Xn.x,Sn.y,An,cn),Cv(ze,X.x,X.y,Mi.x,er+Mi.y,rn.x,rn.y+rn.h,T,dr,Sn.x,Xn.y,An,cn),Cv(ze,X.x,X.y,ln.x,er+ln.y,rn.x+rn.w,rn.y+rn.h,T,dr,Xn.x,Xn.y,An,cn),Av(c.dynamicLayoutVertexArray,X,zt),Me.emplaceBack(_r,_r+2,_r+1),Me.emplaceBack(_r+1,_r+2,_r+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zi[0]),gt!==f.length-1&&or===f[gt+1].sectionIndex||c.programConfigurations.populatePaintArrays(ze.length,z,z.index,{imagePositions:{},canonical:Ce,formattedSection:lt&&lt[or]})}c.placedSymbolArray.emplaceBack(X.x,X.y,$e,this.glyphOffsetArray.length-$e,it,re,ue,X.segment,T?T[0]:0,T?T[1]:0,C[0],C[1],U,0,!1,0,ve)}_addCollisionDebugVertex(c,f,T,C,R,z){return f.emplaceBack(0,0),c.emplaceBack(T.x,T.y,C,R,Math.round(z.x),Math.round(z.y))}addCollisionDebugVertices(c,f,T,C,R,z,U){const X=R.segments.prepareSegment(4,R.layoutVertexArray,R.indexArray),re=X.vertexLength,ue=R.layoutVertexArray,ve=R.collisionVertexArray,Ce=U.anchorX,Me=U.anchorY;this._addCollisionDebugVertex(ue,ve,z,Ce,Me,new P(c,f)),this._addCollisionDebugVertex(ue,ve,z,Ce,Me,new P(T,f)),this._addCollisionDebugVertex(ue,ve,z,Ce,Me,new P(T,C)),this._addCollisionDebugVertex(ue,ve,z,Ce,Me,new P(c,C)),X.vertexLength+=4;const ze=R.indexArray;ze.emplaceBack(re,re+1),ze.emplaceBack(re+1,re+2),ze.emplaceBack(re+2,re+3),ze.emplaceBack(re+3,re),X.primitiveLength+=4}addDebugCollisionBoxes(c,f,T,C){for(let R=c;R<f;R++){const z=this.collisionBoxArray.get(R);this.addCollisionDebugVertices(z.x1,z.y1,z.x2,z.y2,C?this.textCollisionBox:this.iconCollisionBox,z.anchorPoint,T)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pv(ki,cs.members,On),this.iconCollisionBox=new Pv(ki,cs.members,On);for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(c,f,T,C,R,z,U,X,re){const ue={};for(let ve=f;ve<T;ve++){const Ce=c.get(ve);ue.textBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},ue.textFeatureIndex=Ce.featureIndex;break}for(let ve=C;ve<R;ve++){const Ce=c.get(ve);ue.verticalTextBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},ue.verticalTextFeatureIndex=Ce.featureIndex;break}for(let ve=z;ve<U;ve++){const Ce=c.get(ve);ue.iconBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},ue.iconFeatureIndex=Ce.featureIndex;break}for(let ve=X;ve<re;ve++){const Ce=c.get(ve);ue.verticalIconBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},ue.verticalIconFeatureIndex=Ce.featureIndex;break}return ue}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const T=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,T.textBoxStartIndex,T.textBoxEndIndex,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T.iconBoxStartIndex,T.iconBoxEndIndex,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,f){const T=c.placedSymbolArray.get(f),C=T.vertexStartIndex+4*T.numGlyphs;for(let R=T.vertexStartIndex;R<C;R+=4)c.indexArray.emplaceBack(R,R+2,R+1),c.indexArray.emplaceBack(R+1,R+2,R+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(c),T=Math.cos(c),C=[],R=[],z=[];for(let U=0;U<this.symbolInstances.length;++U){z.push(U);const X=this.symbolInstances.get(U);C.push(0|Math.round(f*X.anchorX+T*X.anchorY)),R.push(X.featureIndex)}return z.sort(((U,X)=>C[U]-C[X]||R[X]-R[U])),z}addToSortKeyRanges(c,f){const T=this.sortKeyRanges[this.sortKeyRanges.length-1];T&&T.sortKey===f?T.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const T=this.symbolInstances.get(f);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach(((C,R,z)=>{C>=0&&z.indexOf(C)===R&&this.addIndicesForPlacedSymbol(this.text,C)})),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let d2,zb;ur("SymbolBucket",yy,{omit:["layers","collisionBoxArray","features","compareText"]}),yy.MAX_GLYPHS=65535,yy.addDynamicAttributes=Av;var Mv={get paint(){return zb=zb||new Nl({"icon-opacity":new Cr(mi.paint_symbol["icon-opacity"]),"icon-color":new Cr(mi.paint_symbol["icon-color"]),"icon-halo-color":new Cr(mi.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cr(mi.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cr(mi.paint_symbol["icon-halo-blur"]),"icon-translate":new vr(mi.paint_symbol["icon-translate"]),"icon-translate-anchor":new vr(mi.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cr(mi.paint_symbol["text-opacity"]),"text-color":new Cr(mi.paint_symbol["text-color"],{runtimeType:ft,getOverride:m=>m.textColor,hasOverride:m=>!!m.textColor}),"text-halo-color":new Cr(mi.paint_symbol["text-halo-color"]),"text-halo-width":new Cr(mi.paint_symbol["text-halo-width"]),"text-halo-blur":new Cr(mi.paint_symbol["text-halo-blur"]),"text-translate":new vr(mi.paint_symbol["text-translate"]),"text-translate-anchor":new vr(mi.paint_symbol["text-translate-anchor"])})},get layout(){return d2=d2||new Nl({"symbol-placement":new vr(mi.layout_symbol["symbol-placement"]),"symbol-spacing":new vr(mi.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vr(mi.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cr(mi.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vr(mi.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vr(mi.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vr(mi.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vr(mi.layout_symbol["icon-ignore-placement"]),"icon-optional":new vr(mi.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vr(mi.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cr(mi.layout_symbol["icon-size"]),"icon-text-fit":new vr(mi.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vr(mi.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cr(mi.layout_symbol["icon-image"]),"icon-rotate":new Cr(mi.layout_symbol["icon-rotate"]),"icon-padding":new Cr(mi.layout_symbol["icon-padding"]),"icon-keep-upright":new vr(mi.layout_symbol["icon-keep-upright"]),"icon-offset":new Cr(mi.layout_symbol["icon-offset"]),"icon-anchor":new Cr(mi.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vr(mi.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vr(mi.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vr(mi.layout_symbol["text-rotation-alignment"]),"text-field":new Cr(mi.layout_symbol["text-field"]),"text-font":new Cr(mi.layout_symbol["text-font"]),"text-size":new Cr(mi.layout_symbol["text-size"]),"text-max-width":new Cr(mi.layout_symbol["text-max-width"]),"text-line-height":new vr(mi.layout_symbol["text-line-height"]),"text-letter-spacing":new Cr(mi.layout_symbol["text-letter-spacing"]),"text-justify":new Cr(mi.layout_symbol["text-justify"]),"text-radial-offset":new Cr(mi.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vr(mi.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Cr(mi.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Cr(mi.layout_symbol["text-anchor"]),"text-max-angle":new vr(mi.layout_symbol["text-max-angle"]),"text-writing-mode":new vr(mi.layout_symbol["text-writing-mode"]),"text-rotate":new Cr(mi.layout_symbol["text-rotate"]),"text-padding":new vr(mi.layout_symbol["text-padding"]),"text-keep-upright":new vr(mi.layout_symbol["text-keep-upright"]),"text-transform":new Cr(mi.layout_symbol["text-transform"]),"text-offset":new Cr(mi.layout_symbol["text-offset"]),"text-allow-overlap":new vr(mi.layout_symbol["text-allow-overlap"]),"text-overlap":new vr(mi.layout_symbol["text-overlap"]),"text-ignore-placement":new vr(mi.layout_symbol["text-ignore-placement"]),"text-optional":new vr(mi.layout_symbol["text-optional"])})}};class Ob{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:we,this.defaultValue=c}evaluate(c){if(c.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(c.formattedSection))return f.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ur("FormatSectionOverride",Ob,{omit:["defaultValue"]});class I0 extends Zc{constructor(c,f){super(c,Mv,f)}recalculate(c,f){if(super.recalculate(c,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const T=this.layout.get("text-writing-mode");if(T){const C=[];for(const R of T)C.indexOf(R)<0&&C.push(R);this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,f,T,C){const R=this.layout.get(c).evaluate(f,{},T,C),z=this._unevaluatedLayout._values[c];return z.isDataDriven()||uf(z.value)||!R?R:(function(U,X){return X.replace(/{([^{}]+)}/g,((re,ue)=>U&&ue in U?String(U[ue]):""))})(f.properties,R)}createBucket(c){return new yy(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of Mv.paint.overridableProperties){if(!I0.hasPaintOverride(this.layout,c))continue;const f=this.paint.get(c),T=new Ob(f),C=new jg(T,f.property.specification);let R=null;R=f.value.kind==="constant"||f.value.kind==="source"?new Lu("source",C):new es("composite",C,f.value.zoomStops),this.paint._values[c]=new pc(f.property,R,f.parameters)}}_handleOverridablePaintPropertyUpdate(c,f,T){return!(!this.layout||f.isDataDriven()||T.isDataDriven())&&I0.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,f){const T=c.get("text-field"),C=Mv.paint.properties[f];let R=!1;const z=U=>{for(const X of U)if(C.overrides&&C.overrides.hasOverride(X))return void(R=!0)};if(T.value.kind==="constant"&&T.value.value instanceof cl)z(T.value.value.sections);else if(T.value.kind==="source"||T.value.kind==="composite"){const U=re=>{R||(re instanceof $r&&za(re.value)===Ri?z(re.value.sections):re instanceof Ua?z(re.sections):re.eachChild(U))},X=T.value;X._styleExpression&&U(X._styleExpression.expression)}return R}}let Fb;var f2={get paint(){return Fb=Fb||new Nl({"background-color":new vr(mi.paint_background["background-color"]),"background-pattern":new wf(mi.paint_background["background-pattern"]),"background-opacity":new vr(mi.paint_background["background-opacity"])})}};class p2 extends Zc{constructor(c,f){super(c,f2,f)}}class Bb extends Zc{constructor(c,f){super(c,{},f),this.onAdd=T=>{this.implementation.onAdd&&this.implementation.onAdd(T,T.painter.context.gl)},this.onRemove=T=>{this.implementation.onRemove&&this.implementation.onRemove(T,T.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class dg{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ic={once:!0},kv=63710088e-1;class Fd{constructor(c,f){if(isNaN(c)||isNaN(f))throw new Error(`Invalid LngLat object: (${c}, ${f})`);if(this.lng=+c,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fd(ti(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const f=Math.PI/180,T=this.lat*f,C=c.lat*f,R=Math.sin(T)*Math.sin(C)+Math.cos(T)*Math.cos(C)*Math.cos((c.lng-this.lng)*f);return kv*Math.acos(Math.min(R,1))}static convert(c){if(c instanceof Fd)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Fd(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Fd(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const m2=2*Math.PI*kv;function g2(m){return m2*Math.cos(m*Math.PI/180)}function _2(m){return(180+m)/360}function y2(m){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m*Math.PI/360)))/360}function p_(m,c){return m/g2(c)}function Nb(m){return 360*m-180}function yp(m){return 360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90}function vy(m,c){return m*g2(yp(c))}class C0{constructor(c,f,T=0){this.x=+c,this.y=+f,this.z=+T}static fromLngLat(c,f=0){const T=Fd.convert(c);return new C0(_2(T.lng),y2(T.lat),p_(f,T.lat))}toLngLat(){return new Fd(Nb(this.x),yp(this.y))}toAltitude(){return vy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/m2*(c=yp(this.y),1/Math.cos(c*Math.PI/180));var c}}function v2(m,c,f){var T=2*Math.PI*6378137/256/Math.pow(2,f);return[m*T-2*Math.PI*6378137/2,c*T-2*Math.PI*6378137/2]}class Vb{constructor(c,f,T){if(!(function(C,R,z){return!(C<0||C>25||z<0||z>=Math.pow(2,C)||R<0||R>=Math.pow(2,C))})(c,f,T))throw new Error(`x=${f}, y=${T}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=f,this.y=T,this.key=xy(0,c,c,f,T)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,f,T){const C=(function(z,U,X){var re=v2(256*z,256*(U=Math.pow(2,X)-U-1),X),ue=v2(256*(z+1),256*(U+1),X);return re[0]+","+re[1]+","+ue[0]+","+ue[1]})(this.x,this.y,this.z),R=(function(z,U,X){let re,ue="";for(let ve=z;ve>0;ve--)re=1<<ve-1,ue+=(U&re?1:0)+(X&re?2:0);return ue})(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(T==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,C)}isChildOf(c){const f=this.z-c.z;return f>0&&c.x===this.x>>f&&c.y===this.y>>f}getTilePoint(c){const f=Math.pow(2,this.z);return new P((c.x*f-this.x)*wi,(c.y*f-this.y)*wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class x2{constructor(c,f){this.wrap=c,this.canonical=f,this.key=xy(c,f.z,f.z,f.x,f.y)}}class Kh{constructor(c,f,T,C,R){if(this.terrainRttPosMatrix32f=null,c<T)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${T}`);this.overscaledZ=c,this.wrap=f,this.canonical=new Vb(T,+C,+R),this.key=xy(f,c,T,C,R)}clone(){return new Kh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-c;return c>this.canonical.z?new Kh(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Kh(c,this.wrap,c,this.canonical.x>>f,this.canonical.y>>f)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(c,f){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const T=this.canonical.z-c;return c>this.canonical.z?xy(this.wrap*+f,c,this.canonical.z,this.canonical.x,this.canonical.y):xy(this.wrap*+f,c,c,this.canonical.x>>T,this.canonical.y>>T)}isChildOf(c){if(c.wrap!==this.wrap||this.overscaledZ-c.overscaledZ<=0)return!1;if(c.overscaledZ===0)return this.overscaledZ>0;const f=this.canonical.z-c.canonical.z;return!(f<0)&&c.canonical.x===this.canonical.x>>f&&c.canonical.y===this.canonical.y>>f}children(c){if(this.overscaledZ>=c)return[new Kh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,T=2*this.canonical.x,C=2*this.canonical.y;return[new Kh(f,this.wrap,f,T,C),new Kh(f,this.wrap,f,T+1,C),new Kh(f,this.wrap,f,T,C+1),new Kh(f,this.wrap,f,T+1,C+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Kh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Kh(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new x2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new C0(c.x-this.wrap,c.y))}}function xy(m,c,f,T,C){(m*=2)<0&&(m=-1*m-1);const R=1<<f;return(R*R*m+R*C+T).toString(36)+f.toString(36)+c.toString(36)}function jb(m,c){return c?m.properties[c]:m.id}function Ub(m,c){const f={id:m.id};if(c.removeAllProperties&&(delete m.removeProperties,delete m.addOrUpdateProperties,delete c.removeProperties),c.removeProperties)for(const T of c.removeProperties){const C=m.addOrUpdateProperties.findIndex((R=>R.key===T));C>-1&&m.addOrUpdateProperties.splice(C,1)}return(m.removeAllProperties||c.removeAllProperties)&&(f.removeAllProperties=!0),(m.removeProperties||c.removeProperties)&&(f.removeProperties=[...m.removeProperties||[],...c.removeProperties||[]]),(m.addOrUpdateProperties||c.addOrUpdateProperties)&&(f.addOrUpdateProperties=[...m.addOrUpdateProperties||[],...c.addOrUpdateProperties||[]]),(m.newGeometry||c.newGeometry)&&(f.newGeometry=c.newGeometry||m.newGeometry),f}function b2(m){var c,f;if(!m)return{};const T={};return T.removeAll=m.removeAll,T.remove=new Set(m.remove||[]),T.add=new Map((c=m.add)===null||c===void 0?void 0:c.map((C=>[C.id,C]))),T.update=new Map((f=m.update)===null||f===void 0?void 0:f.map((C=>[C.id,C]))),T}ur("CanonicalTileID",Vb),ur("OverscaledTileID",Kh,{omit:["terrainRttPosMatrix32f"]});class fg{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(c){return this.minX=Math.min(this.minX,c.x),this.minY=Math.min(this.minY,c.y),this.maxX=Math.max(this.maxX,c.x),this.maxY=Math.max(this.maxY,c.y),this}expandBy(c){return this.minX-=c,this.minY-=c,this.maxX+=c,this.maxY+=c,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(c){return this.expandBy(-c)}map(c){const f=new fg;return f.extend(c(new P(this.minX,this.minY))),f.extend(c(new P(this.maxX,this.minY))),f.extend(c(new P(this.minX,this.maxY))),f.extend(c(new P(this.maxX,this.maxY))),f}static fromPoints(c){const f=new fg;for(const T of c)f.extend(T);return f}contains(c){return c.x>=this.minX&&c.x<=this.maxX&&c.y>=this.minY&&c.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(c){return!this.empty()&&!c.empty()&&c.minX>=this.minX&&c.maxX<=this.maxX&&c.minY>=this.minY&&c.maxY<=this.maxY}intersects(c){return!this.empty()&&!c.empty()&&c.minX<=this.maxX&&c.maxX>=this.minX&&c.minY<=this.maxY&&c.maxY>=this.minY}}class by{constructor(c){this._stringToNumber={},this._numberToString=[];for(let f=0;f<c.length;f++){const T=c[f];this._stringToNumber[T]=f,this._numberToString[f]=T}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class w2{constructor(c,f,T,C,R){this.type="Feature",this._vectorTileFeature=c,this._x=T,this._y=C,this._z=f,this.properties=c.properties,this.id=R}projectPoint(c,f,T,C){return[360*(c.x+f)/C-180,360/Math.PI*Math.atan(Math.exp((1-2*(c.y+T)/C)*Math.PI))-90]}projectLine(c,f,T,C){return c.map((R=>this.projectPoint(R,f,T,C)))}get geometry(){if(this._geometry)return this._geometry;const c=this._vectorTileFeature,f=c.extent*Math.pow(2,this._z),T=c.extent*this._x,C=c.extent*this._y,R=c.loadGeometry();switch(c.type){case 1:{const z=[];for(const X of R)z.push(X[0]);const U=this.projectLine(z,T,C,f);this._geometry=z.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U};break}case 2:{const z=R.map((U=>this.projectLine(U,T,C,f)));this._geometry=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z};break}case 3:{const z=It(R),U=[];for(const X of z)U.push(X.map((re=>this.projectLine(re,T,C,f))));this._geometry=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U};break}default:throw new Error(`unknown feature type: ${c.type}`)}return this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&f!=="_x"&&f!=="_y"&&f!=="_z"&&(c[f]=this[f]);return c}}class Sa{_name;dataBuffer;nullabilityBuffer;_size;constructor(c,f,T){this._name=c,this.dataBuffer=f,typeof T=="number"?this._size=T:(this.nullabilityBuffer=T,this._size=T.size())}getValue(c){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(c)?null:this.getValueFromBuffer(c)}has(c){return this.nullabilityBuffer&&this.nullabilityBuffer.get(c)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class im extends Sa{}class Dv extends im{getValueFromBuffer(c){return this.dataBuffer[c]}}class wy extends im{getValueFromBuffer(c){return this.dataBuffer[c]}}class A0 extends Sa{delta;constructor(c,f,T,C){super(c,f,C),this.delta=T}}class m_ extends A0{constructor(c,f,T,C){super(c,Int32Array.of(f),T,C)}getValueFromBuffer(c){return this.dataBuffer[0]+c*this.delta}}class Lv extends Sa{constructor(c,f,T){super(c,Int32Array.of(f),T)}getValueFromBuffer(c){return this.dataBuffer[0]}}class T2{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(c,f,T,C,R=4096){this._name=c,this._geometryVector=f,this._idVector=T,this._propertyVectors=C,this._extent=R}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(c){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((f=>[f.name,f])))),this.propertyVectorsMap.get(c)}*[Symbol.iterator](){const c=this.geometryVector[Symbol.iterator]();let f=0;for(;f<this.numFeatures;){let T;this.idVector&&(T=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(f)):this.idVector.getValue(f));const C=c?.next().value,R={};for(const z of this.propertyVectors){if(!z)continue;const U=z.name,X=z.getValue(f);X!==null&&(R[U]=X)}f++,yield{id:T,geometry:C,properties:R}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const c=[],f=this.geometryVector.getGeometries();for(let T=0;T<this.numFeatures;T++){let C;this.idVector&&(C=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(T)):this.idVector.getValue(T));const R={coordinates:f[T],type:this.geometryVector.geometryType(T)},z={};for(const U of this.propertyVectors){if(!U)continue;const X=U.name,re=U.getValue(T);re!==null&&(z[X]=re)}c.push({id:C,geometry:R,properties:z})}return c}containsMaxSaveIntegerValues(c){return c instanceof Dv||c instanceof Lv&&c instanceof m_||c instanceof wy}}class P0{value;constructor(c){this.value=c}get(){return this.value}set(c){this.value=c}increment(){return this.value++}add(c){this.value+=c}}var Xs,Jh,Lc,Bd,nm,xu,$l,Ea,S2,Ba;function nc(m,c,f){const T=new Int32Array(f);let C=0,R=c.get();for(let z=0;z<T.length;z++){let U=m[R++],X=127&U;U<128||(U=m[R++],X|=(127&U)<<7,U<128||(U=m[R++],X|=(127&U)<<14,U<128||(U=m[R++],X|=(127&U)<<21,U<128||(U=m[R++],X|=(15&U)<<28)))),T[C++]=X}return c.set(R),T}function M0(m,c,f){const T=new BigInt64Array(f);for(let C=0;C<T.length;C++)T[C]=$b(m,c);return T}function E2(m,c){let f,T;return T=m[c.get()],c.increment(),f=127&T,T<128?f:(T=m[c.get()],c.increment(),f|=(127&T)<<7,T<128?f:(T=m[c.get()],c.increment(),f|=(127&T)<<14,T<128?f:(T=m[c.get()],c.increment(),f|=(127&T)<<21,T<128?f:(T=m[c.get()],f|=(15&T)<<28,(function(C,R,z){let U,X;if(X=R[z.get()],z.increment(),U=(112&X)>>4,X<128||(X=R[z.get()],z.increment(),U|=(127&X)<<3,X<128)||(X=R[z.get()],z.increment(),U|=(127&X)<<10,X<128)||(X=R[z.get()],z.increment(),U|=(127&X)<<17,X<128)||(X=R[z.get()],z.increment(),U|=(127&X)<<24,X<128)||(X=R[z.get()],z.increment(),U|=(1&X)<<31,X<128))return 4294967296*U+(C>>>0);throw new Error("Expected varint not more than 10 bytes")})(f,m,c)))))}function k0(m,c,f,T){throw new Error("FastPFor is not implemented yet.")}function g_(m){return m>>>1^-(1&m)}function Ty(m){return m>>1n^-(1n&m)}function $b(m,c){let f=0n,T=0,C=c.get();for(;C<m.length;){const R=m[C++];if(f|=BigInt(127&R)<<BigInt(T),!(128&R))break;if(T+=7,T>=64)throw new Error("Varint too long")}return c.set(C),f}function Gb(m,c,f){const T=new Int32Array(f);let C=0;for(let R=0;R<c;R++){const z=m[R];T.fill(m[R+c],C,C+z),C+=z}return T}function Rv(m,c,f){const T=new BigInt64Array(f);let C=0;for(let R=0;R<c;R++){const z=Number(m[R]);T.fill(m[R+c],C,C+z),C+=z}return T}function zv(m,c,f){const T=new Float64Array(f);let C=0;for(let R=0;R<c;R++){const z=m[R];T.fill(m[R+c],C,C+z),C+=z}return T}function Ov(m){const c=m.length/4*4;let f=1;if(c>=4)for(let T=m[0];f<c-4;f+=4)T=m[f]+=T,T=m[f+1]+=T,T=m[f+2]+=T,T=m[f+3]+=T;for(;f!=m.length;)m[f]+=m[f-1],++f}function qb(m){m[0]=m[0]>>>1^-(1&m[0]),m[1]=m[1]>>>1^-(1&m[1]);const c=m.length/4*4;let f=2;if(c>=4)for(;f<c-4;f+=4){const T=m[f],C=m[f+1],R=m[f+2],z=m[f+3];m[f]=(T>>>1^-(1&T))+m[f-2],m[f+1]=(C>>>1^-(1&C))+m[f-1],m[f+2]=(R>>>1^-(1&R))+m[f],m[f+3]=(z>>>1^-(1&z))+m[f+1]}for(;f!=m.length;f+=2)m[f]=(m[f]>>>1^-(1&m[f]))+m[f-2],m[f+1]=(m[f+1]>>>1^-(1&m[f+1]))+m[f-1]}(function(m){m.NONE="NONE",m.DELTA="DELTA",m.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",m.RLE="RLE",m.MORTON="MORTON",m.PDE="PDE"})(Xs||(Xs={})),(function(m){m.NONE="NONE",m.FAST_PFOR="FAST_PFOR",m.VARINT="VARINT",m.ALP="ALP"})(Jh||(Jh={})),(function(m){m.PRESENT="PRESENT",m.DATA="DATA",m.OFFSET="OFFSET",m.LENGTH="LENGTH"})(Lc||(Lc={}));class Fv{_dictionaryType;_offsetType;_lengthType;constructor(c,f,T){this._dictionaryType=c,this._offsetType=f,this._lengthType=T}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Kc(m,c){const f=(function(T,C){const R=T[C.get()],z=Object.values(Lc)[R>>4];let U=null;switch(z){case Lc.DATA:U=new Fv(Object.values(Bd)[15&R]);break;case Lc.OFFSET:U=new Fv(null,Object.values(nm)[15&R]);break;case Lc.LENGTH:U=new Fv(null,null,Object.values(xu)[15&R])}C.increment();const X=T[C.get()],re=Object.values(Xs)[X>>5],ue=Object.values(Xs)[X>>2&7],ve=Object.values(Jh)[3&X];C.increment();const Ce=nc(T,C,2),Me=Ce[0];return{physicalStreamType:z,logicalStreamType:U,logicalLevelTechnique1:re,logicalLevelTechnique2:ue,physicalLevelTechnique:ve,numValues:Me,byteLength:Ce[1],decompressedCount:Me}})(m,c);return f.logicalLevelTechnique1===Xs.MORTON?(function(T,C,R){const z=nc(C,R,2);return{physicalStreamType:T.physicalStreamType,logicalStreamType:T.logicalStreamType,logicalLevelTechnique1:T.logicalLevelTechnique1,logicalLevelTechnique2:T.logicalLevelTechnique2,physicalLevelTechnique:T.physicalLevelTechnique,numValues:T.numValues,byteLength:T.byteLength,decompressedCount:T.decompressedCount,numBits:z[0],coordinateShift:z[1]}})(f,m,c):Xs.RLE!==f.logicalLevelTechnique1&&Xs.RLE!==f.logicalLevelTechnique2||Jh.NONE===f.physicalLevelTechnique?f:(function(T,C,R){const z=nc(C,R,2);return{physicalStreamType:T.physicalStreamType,logicalStreamType:T.logicalStreamType,logicalLevelTechnique1:T.logicalLevelTechnique1,logicalLevelTechnique2:T.logicalLevelTechnique2,physicalLevelTechnique:T.physicalLevelTechnique,numValues:T.numValues,byteLength:T.byteLength,decompressedCount:z[1],runs:z[0],numRleValues:z[1]}})(f,m,c)}(function(m){m.NONE="NONE",m.SINGLE="SINGLE",m.SHARED="SHARED",m.VERTEX="VERTEX",m.MORTON="MORTON",m.FSST="FSST"})(Bd||(Bd={})),(function(m){m.VERTEX="VERTEX",m.INDEX="INDEX",m.STRING="STRING",m.KEY="KEY"})(nm||(nm={})),(function(m){m.VAR_BINARY="VAR_BINARY",m.GEOMETRIES="GEOMETRIES",m.PARTS="PARTS",m.RINGS="RINGS",m.TRIANGLES="TRIANGLES",m.SYMBOL="SYMBOL",m.DICTIONARY="DICTIONARY"})(xu||(xu={})),(function(m){m[m.FLAT=0]="FLAT",m[m.CONST=1]="CONST",m[m.SEQUENCE=2]="SEQUENCE",m[m.DICTIONARY=3]="DICTIONARY",m[m.FSST_DICTIONARY=4]="FSST_DICTIONARY"})($l||($l={}));class bh{values;_size;constructor(c,f){this.values=c,this._size=f}get(c){const f=Math.floor(c/8);return(this.values[f]>>c%8&1)==1}set(c,f){const T=Math.floor(c/8);this.values[T]=this.values[T]|(f?1:0)<<c%8}getInt(c){const f=Math.floor(c/8);return this.values[f]>>c%8&1}size(){return this._size}getBuffer(){return this.values}}function rl(m,c,f,T,C){return(function(R,z,U){switch(z.logicalLevelTechnique1){case Xs.DELTA:return z.logicalLevelTechnique2===Xs.RLE?(function(X,re,ue){const ve=new Int32Array(ue);let Ce=0,Me=0;for(let ze=0;ze<re;ze++){const Fe=X[ze],$e=g_(X[ze+re]);for(let it=0;it<Fe;it++)Me+=$e,ve[Ce++]=Me}return ve})(R,z.runs,z.numRleValues):((function(X){X[0]=X[0]>>>1^-(1&X[0]);const re=X.length/4*4;let ue=1;if(re>=4)for(;ue<re-4;ue+=4){const ve=X[ue],Ce=X[ue+1],Me=X[ue+2],ze=X[ue+3];X[ue]=(ve>>>1^-(1&ve))+X[ue-1],X[ue+1]=(Ce>>>1^-(1&Ce))+X[ue],X[ue+2]=(Me>>>1^-(1&Me))+X[ue+1],X[ue+3]=(ze>>>1^-(1&ze))+X[ue+2]}for(;ue!=X.length;++ue)X[ue]=(X[ue]>>>1^-(1&X[ue]))+X[ue-1]})(R),R);case Xs.RLE:return(function(X,re,ue){return ue?(function(ve,Ce,Me){const ze=new Int32Array(Me);let Fe=0;for(let $e=0;$e<Ce;$e++){const it=ve[$e];let zt=ve[$e+Ce];zt=zt>>>1^-(1&zt),ze.fill(zt,Fe,Fe+it),Fe+=it}return ze})(X,re.runs,re.numRleValues):Gb(X,re.runs,re.numRleValues)})(R,z,U);case Xs.MORTON:return Ov(R),R;case Xs.COMPONENTWISE_DELTA:return qb(R),R;case Xs.NONE:return U&&(function(X){for(let re=0;re<X.length;re++){const ue=X[re];X[re]=ue>>>1^-(1&ue)}})(R),R;default:throw new Error(`The specified Logical level technique is not supported: ${z.logicalLevelTechnique1}`)}})(Bv(m,c,f),f,T)}function rm(m,c,f){return(function(T,C){if(C.logicalLevelTechnique1===Xs.DELTA&&C.logicalLevelTechnique2===Xs.NONE)return(function(z){const U=new Int32Array(z.length+1);U[0]=0,U[1]=g_(z[0]);let X=U[1],re=2;for(;re!=U.length;++re){const ue=z[re-1];X+=ue>>>1^-(1&ue),U[re]=U[re-1]+X}return U})(T);if(C.logicalLevelTechnique1===Xs.RLE&&C.logicalLevelTechnique2===Xs.NONE)return(function(z,U,X){const re=new Int32Array(X+1);re[0]=0;let ue=1,ve=re[0];for(let Ce=0;Ce<U;Ce++){const Me=z[Ce],ze=z[Ce+U];for(let Fe=ue;Fe<ue+Me;Fe++)re[Fe]=ze+ve,ve=re[Fe];ue+=Me}return re})(T,C.runs,C.numRleValues);if(C.logicalLevelTechnique1===Xs.NONE&&C.logicalLevelTechnique2===Xs.NONE){(function(z){let U=0;for(let X=0;X<z.length;X++)z[X]+=U,U=z[X]})(T);const R=new Int32Array(C.numValues+1);return R[0]=0,R.set(T,1),R}if(C.logicalLevelTechnique1===Xs.DELTA&&C.logicalLevelTechnique2===Xs.RLE){const R=(function(z,U,X){const re=new Int32Array(X+1);re[0]=0;let ue=1,ve=re[0];for(let Ce=0;Ce<U;Ce++){const Me=z[Ce];let ze=z[Ce+U];ze=ze>>>1^-(1&ze);for(let Fe=ue;Fe<ue+Me;Fe++)re[Fe]=ze+ve,ve=re[Fe];ue+=Me}return re})(T,C.runs,C.numRleValues);return Ov(R),R}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Bv(m,c,f),f)}function Bv(m,c,f){const T=f.physicalLevelTechnique;if(T===Jh.FAST_PFOR)return k0();if(T===Jh.VARINT)return nc(m,c,f.numValues);if(T===Jh.NONE){const C=c.get();c.add(f.byteLength);const R=m.subarray(C,c.get());return new Int32Array(R)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Hb(m,c,f,T){const C=Bv(m,c,f);if(C.length===1){const R=C[0];return T?g_(R):R}return T?(function(R){return g_(R[1])})(C):(function(R){return R[1]})(C)}function I2(m,c,f){return(function(T){if(T.length==2){const C=g_(T[1]);return[C,C]}return[g_(T[2]),g_(T[3])]})(Bv(m,c,f))}function C2(m,c,f){return(function(T){if(T.length==2){const C=Ty(T[1]);return[C,C]}return[Ty(T[2]),Ty(T[3])]})(M0(m,c,f.numValues))}function A2(m,c,f,T){return(function(C,R,z){switch(R.logicalLevelTechnique1){case Xs.DELTA:return R.logicalLevelTechnique2===Xs.RLE?(function(U,X,re){const ue=new BigInt64Array(re);let ve=0,Ce=0n;for(let Me=0;Me<X;Me++){const ze=Number(U[Me]),Fe=Ty(U[Me+X]);for(let $e=0;$e<ze;$e++)Ce+=Fe,ue[ve++]=Ce}return ue})(C,R.runs,R.numRleValues):((function(U){U[0]=U[0]>>1n^-(1n&U[0]);const X=U.length/4*4;let re=1;if(X>=4)for(;re<X-4;re+=4){const ue=U[re],ve=U[re+1],Ce=U[re+2],Me=U[re+3];U[re]=(ue>>1n^-(1n&ue))+U[re-1],U[re+1]=(ve>>1n^-(1n&ve))+U[re],U[re+2]=(Ce>>1n^-(1n&Ce))+U[re+1],U[re+3]=(Me>>1n^-(1n&Me))+U[re+2]}for(;re!=U.length;++re)U[re]=(U[re]>>1n^-(1n&U[re]))+U[re-1]})(C),C);case Xs.RLE:return(function(U,X,re){return re?(function(ue,ve,Ce){const Me=new BigInt64Array(Ce);let ze=0;for(let Fe=0;Fe<ve;Fe++){const $e=Number(ue[Fe]);let it=ue[Fe+ve];it=it>>1n^-(1n&it),Me.fill(it,ze,ze+$e),ze+=$e}return Me})(U,X.runs,X.numRleValues):Rv(U,X.runs,X.numRleValues)})(C,R,z);case Xs.NONE:return z&&(function(U){for(let X=0;X<U.length;X++){const re=U[X];U[X]=re>>1n^-(1n&re)}})(C),C;default:throw new Error(`The specified Logical level technique is not supported: ${R.logicalLevelTechnique1}`)}})(M0(m,c,f.numValues),f,T)}function P2(m,c,f,T){const C=M0(m,c,f.numValues);if(C.length===1){const R=C[0];return T?Ty(R):R}return T?(function(R){return Ty(R[1])})(C):(function(R){return R[1]})(C)}function Wb(m,c,f,T,C){return(function(R,z,U,X){switch(z.logicalLevelTechnique1){case Xs.DELTA:return z.logicalLevelTechnique2===Xs.RLE&&(R=Gb(R,z.runs,z.numRleValues)),(function(re,ue){const ve=new Int32Array(re.size());let Ce=0;re.get(0)?(ve[0]=re.get(0)?ue[0]>>>1^-(1&ue[0]):0,Ce=1):ve[0]=0;let Me=1;for(;Me!=ve.length;++Me)ve[Me]=re.get(Me)?ve[Me-1]+(ue[Ce]>>>1^-(1&ue[Ce++])):ve[Me-1];return ve})(X,R);case Xs.RLE:return(function(re,ue,ve,Ce){const Me=ue;return ve?(function(ze,Fe,$e){const it=new Int32Array(ze.size());let zt=0;for(let lt=0;lt<$e;lt++){const gt=Fe[lt];let Vt=Fe[lt+$e];Vt=Vt>>>1^-(1&Vt);for(let Xt=zt;Xt<zt+gt;Xt++)ze.get(Xt)?it[Xt]=Vt:(it[Xt]=0,zt++);zt+=gt}return it})(Ce,re,Me.runs):(function(ze,Fe,$e){const it=new Int32Array(ze.size());let zt=0;for(let lt=0;lt<$e;lt++){const gt=Fe[lt],Vt=Fe[lt+$e];for(let Xt=zt;Xt<zt+gt;Xt++)ze.get(Xt)?it[Xt]=Vt:(it[Xt]=0,zt++);zt+=gt}return it})(Ce,re,Me.runs)})(R,z,U,X);case Xs.MORTON:return Ov(R),R;case Xs.COMPONENTWISE_DELTA:return qb(R),R;case Xs.NONE:return R=U?(function(re,ue){const ve=new Int32Array(re.size());let Ce=0,Me=0;for(;Me!=ve.length;++Me)if(re.get(Me)){const ze=ue[Ce++];ve[Me]=ze>>>1^-(1&ze)}else ve[Me]=0;return ve})(X,R):(function(re,ue){const ve=new Int32Array(re.size());let Ce=0,Me=0;for(;Me!=ve.length;++Me)ve[Me]=re.get(Me)?ue[Ce++]:0;return ve})(X,R),R;default:throw new Error("The specified Logical level technique is not supported")}})(f.physicalLevelTechnique===Jh.FAST_PFOR?k0():nc(m,c,f.numValues),f,T,C)}function Nv(m,c,f,T){const C=m.logicalLevelTechnique1;if(C===Xs.RLE)return m.runs===1?$l.CONST:$l.FLAT;const R=c instanceof bh?c.size():c;if(C===Xs.DELTA&&m.logicalLevelTechnique2===Xs.RLE){const z=m.runs,U=2;if(m.numRleValues!==R)return $l.FLAT;if(z===1)return $l.SEQUENCE;if(z===2){const X=T.get();let re;if(m.physicalLevelTechnique===Jh.VARINT)re=nc(f,T,4);else{const ue=T.get();re=new Int32Array(f.buffer,f.byteOffset+ue,4)}if(T.set(X),re[2]===U&&re[3]===U)return $l.SEQUENCE}}return m.numValues===1?$l.CONST:$l.FLAT}class Sy extends im{getValueFromBuffer(c){return this.dataBuffer[c]}}class Zb extends A0{constructor(c,f,T,C){super(c,BigInt64Array.of(f),T,C)}getValueFromBuffer(c){return this.dataBuffer[0]+BigInt(c)*this.delta}}class __{_geometryOffsets;_partOffsets;_ringOffsets;constructor(c,f,T){this._geometryOffsets=c,this._partOffsets=f,this._ringOffsets=T}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Ey(m,c,f){return{x:Xb(m,c)-f,y:Xb(m>>1,c)-f}}function Xb(m,c){let f=0;for(let T=0;T<c;T++)f|=(m&1<<2*T)>>T;return f}(function(m){m[m.POINT=0]="POINT",m[m.LINESTRING=1]="LINESTRING",m[m.POLYGON=2]="POLYGON",m[m.MULTIPOINT=3]="MULTIPOINT",m[m.MULTILINESTRING=4]="MULTILINESTRING",m[m.MULTIPOLYGON=5]="MULTIPOLYGON"})(Ea||(Ea={})),(function(m){m[m.POINT=0]="POINT",m[m.LINESTRING=1]="LINESTRING",m[m.POLYGON=2]="POLYGON"})(S2||(S2={})),(function(m){m[m.MORTON=0]="MORTON",m[m.VEC_2=1]="VEC_2",m[m.VEC_3=2]="VEC_3"})(Ba||(Ba={}));class Yb{createPoint(c){return[[c]]}createMultiPoint(c){return c.map((f=>[f]))}createLineString(c){return[c]}createMultiLineString(c){return c}createPolygon(c,f){return[c].concat(f)}createMultiPolygon(c){return c.flat()}}function D0(m){const c=new Array(m.numGeometries);let f=1,T=1,C=1,R=0;const z=new Yb;let U=0,X=0;const re=m.mortonSettings,ue=m.topologyVector,ve=ue.geometryOffsets,Ce=ue.partOffsets,Me=ue.ringOffsets,ze=m.vertexOffsets,Fe=m.containsPolygonGeometry(),$e=m.vertexBuffer;for(let it=0;it<m.numGeometries;it++){const zt=m.geometryType(it);if(zt===Ea.POINT){if(ze&&ze.length!==0)if(m.vertexBufferType===Ba.VEC_2){const lt=2*ze[X++],gt=new P($e[lt],$e[lt+1]);c[R++]=z.createPoint(gt)}else{const lt=Ey($e[ze[X++]],re.numBits,re.coordinateShift),gt=new P(lt.x,lt.y);c[R++]=z.createPoint(gt)}else{const lt=new P($e[U++],$e[U++]);c[R++]=z.createPoint(lt)}ve&&C++,Ce&&f++,Me&&T++}else if(zt===Ea.MULTIPOINT){const lt=ve[C]-ve[C-1];C++;const gt=new Array(lt);if(ze&&ze.length!==0){for(let Vt=0;Vt<lt;Vt++){const Xt=2*ze[X++];gt[Vt]=new P($e[Xt],$e[Xt+1])}c[R++]=z.createMultiPoint(gt)}else{for(let Vt=0;Vt<lt;Vt++){const Xt=$e[U++],Mi=$e[U++];gt[Vt]=new P(Xt,Mi)}c[R++]=z.createMultiPoint(gt)}}else if(zt===Ea.LINESTRING){let lt,gt=0;Fe?(gt=Me[T]-Me[T-1],T++):gt=Ce[f]-Ce[f-1],f++,ze&&ze.length!==0?(lt=m.vertexBufferType===Ba.VEC_2?Uv($e,ze,X,gt,!1):$v($e,ze,X,gt,!1,re),X+=gt):(lt=jv($e,U,gt,!1),U+=2*gt),c[R++]=z.createLineString(lt),ve&&C++}else if(zt===Ea.POLYGON){const lt=Ce[f]-Ce[f-1];f++;const gt=new Array(lt-1);let Vt=Me[T]-Me[T-1];if(T++,ze&&ze.length!==0){const Xt=m.vertexBufferType===Ba.VEC_2?Vv($e,ze,X,Vt):Iy($e,ze,X,Vt,0,re);X+=Vt;for(let Mi=0;Mi<gt.length;Mi++)Vt=Me[T]-Me[T-1],T++,gt[Mi]=m.vertexBufferType===Ba.VEC_2?Vv($e,ze,X,Vt):Iy($e,ze,X,Vt,0,re),X+=Vt;c[R++]=z.createPolygon(Xt,gt)}else{const Xt=L0($e,U,Vt);U+=2*Vt;for(let Mi=0;Mi<gt.length;Mi++)Vt=Me[T]-Me[T-1],T++,gt[Mi]=L0($e,U,Vt),U+=2*Vt;c[R++]=z.createPolygon(Xt,gt)}ve&&C++}else if(zt===Ea.MULTILINESTRING){const lt=ve[C]-ve[C-1];C++;const gt=new Array(lt);if(ze&&ze.length!==0){for(let Vt=0;Vt<lt;Vt++){let Xt=0;Fe?(Xt=Me[T]-Me[T-1],T++):Xt=Ce[f]-Ce[f-1],f++;const Mi=m.vertexBufferType===Ba.VEC_2?Uv($e,ze,X,Xt,!1):$v($e,ze,X,Xt,!1,re);gt[Vt]=Mi,X+=Xt}c[R++]=z.createMultiLineString(gt)}else{for(let Vt=0;Vt<lt;Vt++){let Xt=0;Fe?(Xt=Me[T]-Me[T-1],T++):Xt=Ce[f]-Ce[f-1],f++,gt[Vt]=jv($e,U,Xt,!1),U+=2*Xt}c[R++]=z.createMultiLineString(gt)}}else{if(zt!==Ea.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const lt=ve[C]-ve[C-1];C++;const gt=new Array(lt);let Vt=0;if(ze&&ze.length!==0){for(let Xt=0;Xt<lt;Xt++){const Mi=Ce[f]-Ce[f-1];f++;const ln=new Array(Mi-1);Vt=Me[T]-Me[T-1],T++;const rn=m.vertexBufferType===Ba.VEC_2?Vv($e,ze,X,Vt):Iy($e,ze,X,Vt,0,re);X+=Vt;for(let Sn=0;Sn<ln.length;Sn++)Vt=Me[T]-Me[T-1],T++,ln[Sn]=m.vertexBufferType===Ba.VEC_2?Vv($e,ze,X,Vt):Iy($e,ze,X,Vt,0,re),X+=Vt;gt[Xt]=z.createPolygon(rn,ln)}c[R++]=z.createMultiPolygon(gt)}else{for(let Xt=0;Xt<lt;Xt++){const Mi=Ce[f]-Ce[f-1];f++;const ln=new Array(Mi-1);Vt=Me[T]-Me[T-1],T++;const rn=L0($e,U,Vt);U+=2*Vt;for(let Sn=0;Sn<ln.length;Sn++){const Xn=Me[T]-Me[T-1];T++,ln[Sn]=L0($e,U,Xn),U+=2*Xn}gt[Xt]=z.createPolygon(rn,ln)}c[R++]=z.createMultiPolygon(gt)}}}}return c}function L0(m,c,f){return jv(m,c,f,!0)}function Vv(m,c,f,T){return Uv(m,c,f,T,!0)}function Iy(m,c,f,T,C,R){return $v(m,c,f,T,!0,R)}function jv(m,c,f,T){const C=new Array(T?f+1:f);for(let R=0;R<2*f;R+=2)C[R/2]=new P(m[c+R],m[c+R+1]);return T&&(C[C.length-1]=C[0]),C}function Uv(m,c,f,T,C){const R=new Array(C?T+1:T);for(let z=0;z<2*T;z+=2){const U=2*c[f+z/2];R[z/2]=new P(m[U],m[U+1])}return C&&(R[R.length-1]=R[0]),R}function $v(m,c,f,T,C,R){const z=new Array(C?T+1:T);for(let U=0;U<T;U++){const X=Ey(m[c[f+U]],R.numBits,R.coordinateShift);z[U]=new P(X.x,X.y)}return C&&(z[z.length-1]=z[0]),z}class Gv{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(c,f,T,C,R){this._vertexBufferType=c,this._topologyVector=f,this._vertexOffsets=T,this._vertexBuffer=C,this._mortonSettings=R}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const c=D0(this);let f=0;for(;f<this.numGeometries;)yield{coordinates:c[f],type:this.geometryType(f)},f++}getSimpleEncodedVertex(c){const f=this.vertexOffsets?2*this.vertexOffsets[c]:2*c;return[this.vertexBuffer[f],this.vertexBuffer[f+1]]}getVertex(c){if(this.vertexOffsets&&this.mortonSettings){const T=Ey(this.vertexBuffer[this.vertexOffsets[c]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[T.x,T.y]}const f=this.vertexOffsets?2*this.vertexOffsets[c]:2*c;return[this.vertexBuffer[f],this.vertexBuffer[f+1]]}getGeometries(){return D0(this)}get mortonSettings(){return this._mortonSettings}}class Kb extends Gv{_numGeometries;_geometryType;constructor(c,f,T,C,R,z,U){super(T,C,R,z,U),this._numGeometries=c,this._geometryType=f}geometryType(c){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Ea.POLYGON||this._geometryType===Ea.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class qv extends Gv{_geometryTypes;constructor(c,f,T,C,R,z){super(c,T,C,R,z),this._geometryTypes=f}geometryType(c){return this._geometryTypes[c]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let c=0;c<this.numGeometries;c++)if(this.geometryType(c)===Ea.POLYGON||this.geometryType(c)===Ea.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class M2{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(c,f,T,C){this._triangleOffsets=c,this._indexBuffer=f,this._vertexBuffer=T,this._topologyVector=C}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const c=new Array(this.numGeometries),f=this._topologyVector,T=f.partOffsets,C=f.ringOffsets,R=f.geometryOffsets;let z=0,U=1,X=1,re=1;for(let ue=0;ue<this.numGeometries;ue++)switch(this.geometryType(ue)){case Ea.POLYGON:{const ve=T[U]-T[U-1];U++;const Ce=[];for(let Me=0;Me<ve;Me++){const ze=C[X]-C[X-1];X++;const Fe=[];for(let $e=0;$e<ze;$e++){const it=this._vertexBuffer[z++],zt=this._vertexBuffer[z++];Fe.push(new P(it,zt))}Fe.length>0&&Fe.push(Fe[0]),Ce.push(Fe)}c[ue]=Ce,R&&re++}break;case Ea.MULTIPOLYGON:{const ve=R[re]-R[re-1];re++;const Ce=[];for(let Me=0;Me<ve;Me++){const ze=T[U]-T[U-1];U++;for(let Fe=0;Fe<ze;Fe++){const $e=C[X]-C[X-1];X++;const it=[];for(let zt=0;zt<$e;zt++){const lt=this._vertexBuffer[z++],gt=this._vertexBuffer[z++];it.push(new P(lt,gt))}it.length>0&&it.push(it[0]),Ce.push(it)}}c[ue]=Ce}}return c}[Symbol.iterator](){return null}}function k2(m,c,f,T,C,R){return new _I(m,c,f,T,C,R)}class _I extends M2{_numGeometries;_geometryType;constructor(c,f,T,C,R,z){super(T,C,R,z),this._numGeometries=c,this._geometryType=f}geometryType(c){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function D2(m,c,f,T,C){return new L2(m,c,f,T,C)}class L2 extends M2{_geometryTypes;constructor(c,f,T,C,R){super(f,T,C,R),this._geometryTypes=c}geometryType(c){return this._geometryTypes[c]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function sm(m,c,f,T,C){const R=Kc(m,f);let z=null,U=null,X=null,re=null,ue=null,ve=null,Ce=null,Me=null;if(Nv(R,T,m,f)===$l.CONST){const Fe=Hb(m,f,R,!1);for(let $e=0;$e<c-1;$e++){const it=Kc(m,f);switch(it.physicalStreamType){case Lc.LENGTH:switch(it.logicalStreamType.lengthType){case xu.GEOMETRIES:z=rm(m,f,it);break;case xu.PARTS:U=rm(m,f,it);break;case xu.RINGS:X=rm(m,f,it);break;case xu.TRIANGLES:Ce=rm(m,f,it)}break;case Lc.OFFSET:switch(it.logicalStreamType.offsetType){case nm.VERTEX:re=rl(m,f,it,!1);break;case nm.INDEX:Me=rl(m,f,it,!1)}break;case Lc.DATA:Bd.VERTEX===it.logicalStreamType.dictionaryType?ue=rl(m,f,it,!0):(ve={numBits:it.numBits,coordinateShift:it.coordinateShift},ue=rl(m,f,it,!1))}}return Me!==null?z!=null||U!=null?k2(T,Fe,Ce,Me,ue,new __(z,U,X)):k2(T,Fe,Ce,Me,ue):ve===null?(function($e,it,zt,lt,gt){return new Kb($e,it,Ba.VEC_2,zt,lt,gt)})(T,Fe,new __(z,U,X),re,ue):(function($e,it,zt,lt,gt,Vt){return new Kb($e,it,Ba.MORTON,zt,lt,gt,Vt)})(T,Fe,new __(z,U,X),re,ue,ve)}const ze=rl(m,f,R,!1);for(let Fe=0;Fe<c-1;Fe++){const $e=Kc(m,f);switch($e.physicalStreamType){case Lc.LENGTH:switch($e.logicalStreamType.lengthType){case xu.GEOMETRIES:z=rl(m,f,$e,!1);break;case xu.PARTS:U=rl(m,f,$e,!1);break;case xu.RINGS:X=rl(m,f,$e,!1);break;case xu.TRIANGLES:Ce=rm(m,f,$e)}break;case Lc.OFFSET:switch($e.logicalStreamType.offsetType){case nm.VERTEX:re=rl(m,f,$e,!1);break;case nm.INDEX:Me=rl(m,f,$e,!1)}break;case Lc.DATA:Bd.VERTEX===$e.logicalStreamType.dictionaryType?ue=rl(m,f,$e,!0):(ve={numBits:$e.numBits,coordinateShift:$e.coordinateShift},ue=rl(m,f,$e,!1))}}return Me!==null&&U===null?D2(ze,Ce,Me,ue):(z!==null?(z=Hv(ze,z,2),U!==null&&X!==null?(U=Jb(ze,z,U,!1),X=(function(Fe,$e,it,zt){const lt=new Int32Array(it[it.length-1]+1);let gt=0;lt[0]=gt;let Vt=1,Xt=1,Mi=0;for(let ln=0;ln<Fe.length;ln++){const rn=Fe[ln],Sn=$e[ln+1]-$e[ln];if(rn!==0&&rn!==3)for(let Xn=0;Xn<Sn;Xn++){const An=it[Vt]-it[Vt-1];Vt++;for(let cn=0;cn<An;cn++)gt=lt[Xt++]=gt+zt[Mi++]}else for(let Xn=0;Xn<Sn;Xn++)lt[Xt++]=++gt,Vt++}return lt})(ze,z,U,X)):U!==null&&(U=(function(Fe,$e,it){const zt=new Int32Array($e[$e.length-1]+1);let lt=0;zt[0]=lt;let gt=1,Vt=0;for(let Xt=0;Xt<Fe.length;Xt++){const Mi=Fe[Xt],ln=$e[Xt+1]-$e[Xt];if(Mi===4||Mi===1)for(let rn=0;rn<ln;rn++)lt=zt[gt++]=lt+it[Vt++];else for(let rn=0;rn<ln;rn++)zt[gt++]=++lt}return zt})(ze,z,U))):U!==null&&X!==null?(U=Hv(ze,U,1),X=Jb(ze,U,X,!0)):U!==null&&(U=Hv(ze,U,0)),Me!==null?D2(ze,Ce,Me,ue,new __(z,U,X)):ve===null?(function(Fe,$e,it,zt){return new qv(Ba.VEC_2,Fe,$e,it,zt)})(ze,new __(z,U,X),re,ue):(function(Fe,$e,it,zt,lt){return new qv(Ba.MORTON,Fe,$e,it,zt,lt)})(ze,new __(z,U,X),re,ue,ve))}function Hv(m,c,f){const T=new Int32Array(m.length+1);let C=0;T[0]=C;let R=0;for(let z=0;z<m.length;z++)C=T[z+1]=C+(m[z]>f?c[R++]:1);return T}function Jb(m,c,f,T){const C=new Int32Array(c[c.length-1]+1);let R=0;C[0]=R;let z=1,U=0;for(let X=0;X<m.length;X++){const re=m[X],ue=c[X+1]-c[X];if(re===5||re===2||T&&(re===4||re===1))for(let ve=0;ve<ue;ve++)R=C[z++]=R+f[U++];else for(let ve=0;ve<ue;ve++)C[z++]=++R}return C}class R0 extends Sa{dataVector;constructor(c,f,T){super(c,f.getBuffer(),T),this.dataVector=f}getValueFromBuffer(c){return this.dataVector.get(c)}}class z0 extends im{getValueFromBuffer(c){return this.dataBuffer[c]}}class O0 extends Sa{constructor(c,f,T){super(c,BigInt64Array.of(f),T)}getValueFromBuffer(c){return this.dataBuffer[0]}}function om(m,c,f){return Qb(m,Math.ceil(c/8),f)}function Qb(m,c,f){const T=new Uint8Array(c);let C=0;for(;C<c;){const R=m[f.increment()];if(R<=127){const z=R+3,U=m[f.increment()],X=C+z;T.fill(U,C,X),C=X}else{const z=256-R;for(let U=0;U<z;U++)T[C++]=m[f.increment()]}}return T}const R2=new TextDecoder;function Wv(m,c,f){return f-c>=12?R2.decode(m.subarray(c,f)):(function(T,C,R){let z="",U=C;for(;U<R;){const X=T[U];let re,ue,ve,Ce=null,Me=X>239?4:X>223?3:X>191?2:1;if(U+Me>R)break;Me===1?X<128&&(Ce=X):Me===2?(re=T[U+1],(192&re)==128&&(Ce=(31&X)<<6|63&re,Ce<=127&&(Ce=null))):Me===3?(re=T[U+1],ue=T[U+2],(192&re)==128&&(192&ue)==128&&(Ce=(15&X)<<12|(63&re)<<6|63&ue,(Ce<=2047||Ce>=55296&&Ce<=57343)&&(Ce=null))):Me===4&&(re=T[U+1],ue=T[U+2],ve=T[U+3],(192&re)==128&&(192&ue)==128&&(192&ve)==128&&(Ce=(15&X)<<18|(63&re)<<12|(63&ue)<<6|63&ve,(Ce<=65535||Ce>=1114112)&&(Ce=null))),Ce===null?(Ce=65533,Me=1):Ce>65535&&(Ce-=65536,z+=String.fromCharCode(Ce>>>10&1023|55296),Ce=56320|1023&Ce),z+=String.fromCharCode(Ce),U+=Me}return z})(m,c,f)}class Zv extends Sa{offsetBuffer;constructor(c,f,T,C){super(c,T,C),this.offsetBuffer=f}}class z2 extends Zv{textEncoder;constructor(c,f,T,C){super(c,f,T,C??f.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(c){return Wv(this.dataBuffer,this.offsetBuffer[c],this.offsetBuffer[c+1])}}class Cy extends Zv{indexBuffer;textEncoder;constructor(c,f,T,C,R){super(c,T,C,R??f.length),this.indexBuffer=f,this.indexBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(c){const f=this.indexBuffer[c];return Wv(this.dataBuffer,this.offsetBuffer[f],this.offsetBuffer[f+1])}}class Xv extends Zv{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(c,f,T,C,R,z,U){super(c,T,C,U),this.indexBuffer=f,this.symbolOffsetBuffer=R,this.symbolTableBuffer=z,this.textEncoder=new TextEncoder}getValueFromBuffer(c){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(T,C,R){const z=[],U=new Array(C.length).fill(0);for(let X=1;X<C.length;X++)U[X]=U[X-1]+C[X-1];for(let X=0;X<R.length;X++)if(R[X]===255)z.push(R[++X]);else{const re=C[R[X]],ue=U[R[X]];for(let ve=0;ve<re;ve++)z.push(T[ue+ve])}return new Uint8Array(z)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const f=this.indexBuffer[c];return Wv(this.decodedDictionary,this.offsetBuffer[f],this.offsetBuffer[f+1])}offsetToLengthBuffer(c){const f=new Uint32Array(c.length-1);let T=c[0];for(let C=1;C<c.length;C++){const R=c[C];f[C-1]=R-T,T=R}return f}}function Yv(m,c,f,T,C,R){return f.type==="scalarType"?(function(z,U,X,re,ue,ve){let Ce=null,Me=0;if(z===0)return null;if(ve.nullable){const Fe=Kc(U,X);Me=Fe.numValues;const $e=X.get(),it=om(U,Me,X);X.set($e+Fe.byteLength),Ce=new bh(it,Fe.numValues)}const ze=Ce??re;switch(ue.physicalType){case 4:case 3:return(function(Fe,$e,it,zt,lt){const gt=Kc(Fe,$e),Vt=Nv(gt,lt,Fe,$e),Xt=zt.physicalType===3;if(Vt===$l.FLAT){const Mi=Ay(lt)?Wb(Fe,$e,gt,Xt,lt):rl(Fe,$e,gt,Xt);return new Dv(it.name,Mi,lt)}if(Vt===$l.SEQUENCE){const Mi=I2(Fe,$e,gt);return new m_(it.name,Mi[0],Mi[1],gt.numRleValues)}{const Mi=Hb(Fe,$e,gt,Xt);return new Lv(it.name,Mi,lt)}})(U,X,ve,ue,ze);case 9:return(function(Fe,$e,it,zt,lt){let gt=null,Vt=null,Xt=null,Mi=null,ln=null,rn=null,Sn=null,Xn=null;for(let An=0;An<zt;An++){const cn=Kc($e,it);if(cn.byteLength!==0)switch(cn.physicalStreamType){case Lc.PRESENT:{const Zi=om($e,cn.numValues,it);rn=new bh(Zi,cn.numValues);break}case Lc.OFFSET:Vt=lt!=null||rn!=null?Wb($e,it,cn,!1,lt??rn):rl($e,it,cn,!1);break;case Lc.LENGTH:{const Zi=rm($e,it,cn);xu.DICTIONARY===cn.logicalStreamType.lengthType?gt=Zi:xu.SYMBOL===cn.logicalStreamType.lengthType?Mi=Zi:Sn=Zi;break}case Lc.DATA:{const Zi=$e.subarray(it.get(),it.get()+cn.byteLength);it.add(cn.byteLength);const dr=cn.logicalStreamType.dictionaryType;Bd.FSST===dr?ln=Zi:Bd.SINGLE===dr||Bd.SHARED===dr?Xt=Zi:Bd.NONE===dr&&(Xn=Zi);break}}}return(function(An,cn,Zi,dr,or,_r,er){return cn?new Xv(An,Zi,dr,or,_r,cn,er):null})(Fe,ln,Vt,gt,Xt,Mi,lt??rn)??(function(An,cn,Zi,dr,or){return cn?or?new Cy(An,Zi,dr,cn,or):new Cy(An,Zi,dr,cn):null})(Fe,Xt,Vt,gt,lt??rn)??(function(An,cn,Zi,dr,or){if(!cn||!Zi)return null;if(dr)return or?new Cy(An,dr,cn,Zi,or):new Cy(An,dr,cn,Zi);if(or&&or.size()!==cn.length-1){const _r=new Int32Array(or.size());let er=0;for(let Dr=0;Dr<or.size();Dr++)_r[Dr]=or.get(Dr)?er++:0;return new Cy(An,_r,cn,Zi,or)}return or?new z2(An,cn,Zi,or):new z2(An,cn,Zi)})(Fe,Sn,Xn,Vt,lt??rn)})(ve.name,U,X,ve.nullable?z-1:z,Ce);case 0:return(function(Fe,$e,it,zt,lt){const gt=Kc(Fe,$e),Vt=gt.numValues,Xt=$e.get(),Mi=Ay(lt)?(function(rn,Sn,Xn,An){const cn=Qb(rn,Math.ceil(Sn/8),Xn),Zi=new bh(cn,Sn),dr=An.size(),or=new bh(new Uint8Array(dr),dr);let _r=0;for(let er=0;er<An.size();er++){const Dr=!!An.get(er)&&Zi.get(_r++);or.set(er,Dr)}return or.getBuffer()})(Fe,Vt,$e,lt):om(Fe,Vt,$e);$e.set(Xt+gt.byteLength);const ln=new bh(Mi,Vt);return new R0(it.name,ln,lt)})(U,X,ve,0,ze);case 6:case 5:return(function(Fe,$e,it,zt,lt){const gt=Kc(Fe,$e),Vt=Nv(gt,zt,Fe,$e),Xt=lt.physicalType===5;if(Vt===$l.FLAT){const Mi=Ay(zt)?(function(ln,rn,Sn,Xn,An){return(function(cn,Zi,dr,or){switch(Zi.logicalLevelTechnique1){case Xs.DELTA:return Zi.logicalLevelTechnique2===Xs.RLE&&(cn=Rv(cn,Zi.runs,Zi.numRleValues)),(function(_r,er){const Dr=new BigInt64Array(_r.size());let vo=0;_r.get(0)?(Dr[0]=_r.get(0)?er[0]>>1n^-(1n&er[0]):0n,vo=1):Dr[0]=0n;let Qs=1;for(;Qs!=Dr.length;++Qs)Dr[Qs]=_r.get(Qs)?Dr[Qs-1]+(er[vo]>>1n^-(1n&er[vo++])):Dr[Qs-1];return Dr})(or,cn);case Xs.RLE:return(function(_r,er,Dr,vo){const Qs=er;return Dr?(function(Ia,zc,Ll){const Na=new BigInt64Array(Ia.size());let Ca=0;for(let qo=0;qo<Ll;qo++){const Ha=Number(zc[qo]);let Va=zc[qo+Ll];Va=Va>>1n^-(1n&Va);for(let ga=Ca;ga<Ca+Ha;ga++)Ia.get(ga)?Na[ga]=Va:(Na[ga]=0n,Ca++);Ca+=Ha}return Na})(vo,_r,Qs.runs):(function(Ia,zc,Ll){const Na=new BigInt64Array(Ia.size());let Ca=0;for(let qo=0;qo<Ll;qo++){const Ha=Number(zc[qo]),Va=zc[qo+Ll];for(let ga=Ca;ga<Ca+Ha;ga++)Ia.get(ga)?Na[ga]=Va:(Na[ga]=0n,Ca++);Ca+=Ha}return Na})(vo,_r,Qs.runs)})(cn,Zi,dr,or);case Xs.NONE:return cn=dr?(function(_r,er){const Dr=new BigInt64Array(_r.size());let vo=0,Qs=0;for(;Qs!=Dr.length;++Qs)if(_r.get(Qs)){const Ia=er[vo++];Dr[Qs]=Ia>>1n^-(1n&Ia)}else Dr[Qs]=0n;return Dr})(or,cn):(function(_r,er){const Dr=new BigInt64Array(_r.size());let vo=0,Qs=0;for(;Qs!=Dr.length;++Qs)Dr[Qs]=_r.get(Qs)?er[vo++]:0n;return Dr})(or,cn),cn;default:throw new Error("The specified Logical level technique is not supported")}})(M0(ln,rn,Sn.numValues),Sn,Xn,An)})(Fe,$e,gt,Xt,zt):A2(Fe,$e,gt,Xt);return new Sy(it.name,Mi,zt)}if(Vt===$l.SEQUENCE){const Mi=C2(Fe,$e,gt);return new Zb(it.name,Mi[0],Mi[1],gt.numRleValues)}{const Mi=P2(Fe,$e,gt,Xt);return new O0(it.name,Mi,zt)}})(U,X,ve,ze,ue);case 7:return(function(Fe,$e,it,zt){const lt=Kc(Fe,$e),gt=Ay(zt)?(function(Vt,Xt,Mi,ln){const rn=Xt.get(),Sn=rn+ln*Float32Array.BYTES_PER_ELEMENT,Xn=new Uint8Array(Vt.subarray(rn,Sn)).buffer,An=new Float32Array(Xn);Xt.set(Sn);const cn=Mi.size(),Zi=new Float32Array(cn);let dr=0;for(let or=0;or<cn;or++)Zi[or]=Mi.get(or)?An[dr++]:0;return Zi})(Fe,$e,zt,lt.numValues):(function(Vt,Xt,Mi){const ln=Xt.get(),rn=ln+Mi*Float32Array.BYTES_PER_ELEMENT,Sn=new Uint8Array(Vt.subarray(ln,rn)).buffer,Xn=new Float32Array(Sn);return Xt.set(rn),Xn})(Fe,$e,lt.numValues);return new z0(it.name,gt,zt)})(U,X,ve,ze);case 8:return(function(Fe,$e,it,zt){const lt=Kc(Fe,$e),gt=Ay(zt)?(function(Vt,Xt,Mi,ln){const rn=Xt.get(),Sn=rn+ln*Float64Array.BYTES_PER_ELEMENT,Xn=new Uint8Array(Vt.subarray(rn,Sn)).buffer,An=new Float64Array(Xn);Xt.set(Sn);const cn=Mi.size(),Zi=new Float64Array(cn);let dr=0;for(let or=0;or<cn;or++)Zi[or]=Mi.get(or)?An[dr++]:0;return Zi})(Fe,$e,zt,lt.numValues):(function(Vt,Xt,Mi){const ln=Xt.get(),rn=ln+Mi*Float64Array.BYTES_PER_ELEMENT,Sn=new Uint8Array(Vt.subarray(ln,rn)).buffer,Xn=new Float64Array(Sn);return Xt.set(rn),Xn})(Fe,$e,lt.numValues);return new wy(it.name,gt,zt)})(U,X,ve,ze);default:throw new Error(`The specified data type for the field is currently not supported: ${ue}`)}})(T,m,c,C,f.scalarType,f):T!=1?null:(function(z,U,X,re){let ue=null,ve=null,Ce=null,Me=null,ze=!1;for(;!ze;){const zt=Kc(z,U);switch(zt.physicalStreamType){case Lc.LENGTH:xu.DICTIONARY===zt.logicalStreamType.lengthType?ue=rm(z,U,zt):Ce=rm(z,U,zt);break;case Lc.DATA:Bd.SINGLE===zt.logicalStreamType.dictionaryType||Bd.SHARED===zt.logicalStreamType.dictionaryType?(ve=z.subarray(U.get(),U.get()+zt.byteLength),ze=!0):Me=z.subarray(U.get(),U.get()+zt.byteLength),U.add(zt.byteLength)}}const Fe=X.complexType.children,$e=[];let it=0;for(const zt of Fe){const lt=nc(z,U,1)[0];if(lt==0)continue;const gt=`${X.name}${zt.name==="default"?"":":"+zt.name}`;if(lt!==2||zt.type!=="scalarField"||zt.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Vt=Kc(z,U),Xt=om(z,Vt.numValues,U),Mi=Kc(z,U),ln=Mi.decompressedCount!==re?Wb(z,U,Mi,!1,new bh(Xt,Vt.numValues)):rl(z,U,Mi,!1);$e[it++]=Me?new Xv(gt,ln,ue,ve,Ce,Me,new bh(Xt,Vt.numValues)):new Cy(gt,ln,ue,ve,new bh(Xt,Vt.numValues))}return $e})(m,c,f,C)}function Ay(m){return m instanceof bh}function yI(m){if(m.name==="id")return!1;if(m.type==="scalarType"){const c=m.scalarType;if(c.type==="physicalType")switch(c.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(c.type==="logicalType")return!1}else if(m.type==="complexType"){const c=m.complexType;if(c.type==="physicalType")switch(c.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",m),!1}const O2=new TextDecoder;function Kv(m,c){const f=nc(m,c,1)[0];if(f===0)return"";const T=c.get(),C=m.subarray(T,T+f);return c.add(f),O2.decode(C)}function e1(m,c){const f=nc(m,c,1)[0]>>>0,T=!!(4&f),C=!!(2&f),R=nc(m,c,1)[0]>>>0,z={};if(1&f&&(z.nullable=!0),C){const U={};if(T?(U.type="logicalType",U.logicalType=R):(U.type="physicalType",U.physicalType=R),8&f){const X=nc(m,c,1)[0]>>>0;U.children=new Array(X);for(let re=0;re<X;re++)U.children[re]=e1(m,c)}z.type="complexField",z.complexField=U}else{const U={};T?(U.type="logicalType",U.logicalType=R):(U.type="physicalType",U.physicalType=R),z.type="scalarField",z.scalarField=U}return z}function F2(m,c){const f=nc(m,c,1)[0]>>>0,T=(function(C){switch(C){case 0:case 1:case 2:case 3:{const R={};R.nullable=!!(1&C),R.columnScope=0;const z={};return z.physicalType=C>1?6:4,z.type="physicalType",R.scalarType=z,R.type="scalarType",R}case 4:{const R={nullable:!1,columnScope:0},z={type:"physicalType",physicalType:0};return R.type="complexType",R.complexType=z,R}case 30:{const R={nullable:!1,columnScope:0},z={type:"physicalType",physicalType:1};return R.type="complexType",R.complexType=z,R}default:return(function(R){let z=null;switch(R){case 10:case 11:z=0;break;case 12:case 13:z=1;break;case 14:case 15:z=2;break;case 16:case 17:z=3;break;case 18:case 19:z=4;break;case 20:case 21:z=5;break;case 22:case 23:z=6;break;case 24:case 25:z=7;break;case 26:case 27:z=8;break;case 28:case 29:z=9;break;default:return null}const U={};U.nullable=!!(1&R),U.columnScope=0;const X={type:"physicalType"};return X.physicalType=z,U.type="scalarType",U.scalarType=X,U})(C)}})(f);if(!T)throw new Error(`Unsupported column type code: ${f}`);if((function(C){return C>=10})(f)?T.name=Kv(m,c):f>=0&&f<=3?T.name="id":f===4&&(T.name="geometry"),(function(C){return C===30})(f)){const C=nc(m,c,1)[0]>>>0,R=T.complexType;R.children=new Array(C);for(let z=0;z<C;z++)R.children[z]=e1(m,c)}return T}function B2(m,c){const f={featureTables:[]},T={};T.name=Kv(m,c);const C=nc(m,c,1)[0]>>>0,R=nc(m,c,1)[0]>>>0;T.columns=new Array(R);for(let z=0;z<R;z++)T.columns[z]=F2(m,c);return f.featureTables.push(T),[f,C]}function N2(m,c,f,T,C,R,z=!1){const U=c.scalarType.physicalType,X=Nv(C,R,m,f);if(U===4)switch(X){case $l.FLAT:{const re=rl(m,f,C,!1);return new Dv(T,re,R)}case $l.SEQUENCE:{const re=I2(m,f,C);return new m_(T,re[0],re[1],C.numRleValues)}case $l.CONST:{const re=Hb(m,f,C,!1);return new Lv(T,re,R)}}else switch(X){case $l.FLAT:{if(z){const ue=(function(ve,Ce,Me,ze){const Fe=(function($e,it,zt){const lt=new Float64Array(it);for(let gt=0;gt<it;gt++)lt[gt]=E2($e,zt);return lt})(ve,Me.numValues,Ce);return(function($e,it,zt){switch(it.logicalLevelTechnique1){case Xs.DELTA:return it.logicalLevelTechnique2===Xs.RLE&&($e=zv($e,it.runs,it.numRleValues)),(function(lt){lt[0]=lt[0]%2==1?(lt[0]+1)/-2:lt[0]/2;const gt=lt.length/4*4;let Vt=1;if(gt>=4)for(;Vt<gt-4;Vt+=4){const Xt=lt[Vt],Mi=lt[Vt+1],ln=lt[Vt+2],rn=lt[Vt+3];lt[Vt]=(Xt%2==1?(Xt+1)/-2:Xt/2)+lt[Vt-1],lt[Vt+1]=(Mi%2==1?(Mi+1)/-2:Mi/2)+lt[Vt],lt[Vt+2]=(ln%2==1?(ln+1)/-2:ln/2)+lt[Vt+1],lt[Vt+3]=(rn%2==1?(rn+1)/-2:rn/2)+lt[Vt+2]}for(;Vt!=lt.length;++Vt)lt[Vt]=(lt[Vt]%2==1?(lt[Vt]+1)/-2:lt[Vt]/2)+lt[Vt-1]})($e),$e;case Xs.RLE:return(function(lt,gt,Vt){return zv(lt,gt.runs,gt.numRleValues)})($e,it);case Xs.NONE:return $e;default:throw new Error(`The specified Logical level technique is not supported: ${it.logicalLevelTechnique1}`)}})(Fe,Me)})(m,f,C);return new wy(T,ue,R)}const re=A2(m,f,C,!1);return new Sy(T,re,R)}case $l.SEQUENCE:{const re=C2(m,f,C);return new Zb(T,re[0],re[1],C.numRleValues)}case $l.CONST:{const re=P2(m,f,C,!1);return new O0(T,re,R)}}throw new Error("Vector type not supported for id column.")}class V2{constructor(c,f){var T;switch(this._featureData=c,this.properties=this._featureData.properties||{},(T=this._featureData.geometry)===null||T===void 0?void 0:T.type){case Ea.POINT:case Ea.MULTIPOINT:this.type=1;break;case Ea.LINESTRING:case Ea.MULTILINESTRING:this.type=2;break;case Ea.POLYGON:case Ea.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=f,this.id=Number(this._featureData.id)}loadGeometry(){const c=[];for(const f of this._featureData.geometry.coordinates){const T=[];for(const C of f)T.push(new P(C.x,C.y));c.push(T)}return c}}class vI{constructor(c){this.features=[],this.featureTable=c,this.name=c.name,this.extent=c.extent,this.version=2,this.features=c.getFeatures(),this.length=this.features.length}feature(c){return new V2(this.features[c],this.extent)}}class t1{constructor(c){this.layers={};const f=(function(T,C,R=!0){const z=new P0(0),U=[];for(;z.get()<T.length;){const X=nc(T,z,1)[0]>>>0,re=z.get()+X;if(re>T.length)throw new Error(`Block overruns tile: ${re} > ${T.length}`);if(nc(T,z,1)[0]>>>0!=1){z.set(re);continue}const ue=B2(T,z),ve=ue[1],Ce=ue[0].featureTables[0];let Me=null,ze=null;const Fe=[];let $e=0;for(const zt of Ce.columns){const lt=zt.name;if(lt==="id"){let gt=null;if(zt.nullable){const Xt=Kc(T,z),Mi=z.get(),ln=om(T,Xt.numValues,z);z.set(Mi+Xt.byteLength),gt=new bh(ln,Xt.numValues)}const Vt=Kc(T,z);$e=Vt.decompressedCount,Me=N2(T,zt,z,lt,Vt,gt??$e,R)}else if(lt==="geometry"){const gt=nc(T,z,1)[0];if($e===0){const Vt=z.get();$e=Kc(T,z).decompressedCount,z.set(Vt)}ze=sm(T,gt,z,$e)}else{const gt=yI(zt)?nc(T,z,1)[0]:1;if(gt===0&&zt.type==="scalarType")continue;const Vt=Yv(T,z,zt,gt,$e);if(Vt)if(Array.isArray(Vt))for(const Xt of Vt)Fe.push(Xt);else Fe.push(Vt)}}const it=new T2(Ce.name,ze,Me,Fe,ve);U.push(it),z.set(re)}return U})(new Uint8Array(c));this.layers=f.reduce(((T,C)=>Object.assign(Object.assign({},T),{[C.name]:new vI(C)})),{})}}class j2{constructor(c,f){this.feature=c,this.type=c.type,this.properties=c.tags?c.tags:{},this.extent=f,"id"in c&&(typeof c.id=="string"?this.id=parseInt(c.id,10):typeof c.id!="number"||isNaN(c.id)||(this.id=c.id))}loadGeometry(){const c=[],f=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const T of f){const C=[];for(const R of T)C.push(new P(R[0],R[1]));c.push(C)}return c}}const Df="_geojsonTileLayer";function U2(m,c){c.writeVarintField(15,m.version||1),c.writeStringField(1,m.name||""),c.writeVarintField(5,m.extent||4096);const f={keys:[],values:[],keycache:{},valuecache:{}};for(let R=0;R<m.length;R++)f.feature=m.feature(R),c.writeMessage(2,$2,f);const T=f.keys;for(const R of T)c.writeStringField(3,R);const C=f.values;for(const R of C)c.writeMessage(4,F0,R)}function $2(m,c){if(!m.feature)return;const f=m.feature;f.id!==void 0&&c.writeVarintField(1,f.id),c.writeMessage(2,G2,m),c.writeVarintField(3,f.type),c.writeMessage(4,H2,f)}function G2(m,c){for(const f in m.feature?.properties){let T=m.feature.properties[f],C=m.keycache[f];if(T==null)continue;C===void 0&&(m.keys.push(f),C=m.keys.length-1,m.keycache[f]=C),c.writeVarint(C),typeof T!="string"&&typeof T!="boolean"&&typeof T!="number"&&(T=JSON.stringify(T));const R=typeof T+":"+T;let z=m.valuecache[R];z===void 0&&(m.values.push(T),z=m.values.length-1,m.valuecache[R]=z),c.writeVarint(z)}}function Py(m,c){return(c<<3)+(7&m)}function q2(m){return m<<1^m>>31}function H2(m,c){const f=m.loadGeometry(),T=m.type;let C=0,R=0;for(const z of f){let U=1;T===1&&(U=z.length),c.writeVarint(Py(1,U));const X=T===3?z.length-1:z.length;for(let re=0;re<X;re++){re===1&&T!==1&&c.writeVarint(Py(2,X-1));const ue=z[re].x-C,ve=z[re].y-R;c.writeVarint(q2(ue)),c.writeVarint(q2(ve)),C+=ue,R+=ve}m.type===3&&c.writeVarint(Py(7,1))}}function F0(m,c){const f=typeof m;f==="string"?c.writeStringField(1,m):f==="boolean"?c.writeBooleanField(7,m):f==="number"&&(m%1!=0?c.writeDoubleField(3,m):m<0?c.writeSVarintField(6,m):c.writeVarintField(5,m))}class i1{constructor(c,f){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new op(wi,16,0),this.grid3D=new op(wi,16,0),this.featureIndexArray=new Xe,this.promoteId=f}insert(c,f,T,C,R,z){const U=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(T,C,R);const X=z?this.grid3D:this.grid;for(let re=0;re<f.length;re++){const ue=f[re],ve=[1/0,1/0,-1/0,-1/0];for(let Ce=0;Ce<ue.length;Ce++){const Me=ue[Ce];ve[0]=Math.min(ve[0],Me.x),ve[1]=Math.min(ve[1],Me.y),ve[2]=Math.max(ve[2],Me.x),ve[3]=Math.max(ve[3],Me.y)}ve[0]<wi&&ve[1]<wi&&ve[2]>=0&&ve[3]>=0&&X.insert(U,ve[0],ve[1],ve[2],ve[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Vi(new Go(this.rawTileData)).layers:new t1(this.rawTileData).layers,this.sourceLayerCoder=new by(this.vtLayers?Object.keys(this.vtLayers).sort():[Df])),this.vtLayers}query(c,f,T,C){this.loadVTLayers();const R=c.params,z=wi/c.tileSize/c.scale,U=Xf(R.filter,R.globalState),X=c.queryGeometry,re=c.queryPadding*z,ue=fg.fromPoints(X),ve=this.grid.query(ue.minX-re,ue.minY-re,ue.maxX+re,ue.maxY+re),Ce=fg.fromPoints(c.cameraQueryGeometry).expandBy(re),Me=this.grid3D.query(Ce.minX,Ce.minY,Ce.maxX,Ce.maxY,(($e,it,zt,lt)=>(function(gt,Vt,Xt,Mi,ln){for(const Sn of gt)if(Vt<=Sn.x&&Xt<=Sn.y&&Mi>=Sn.x&&ln>=Sn.y)return!0;const rn=[new P(Vt,Xt),new P(Vt,ln),new P(Mi,ln),new P(Mi,Xt)];if(gt.length>2){for(const Sn of rn)if(Jp(gt,Sn))return!0}for(let Sn=0;Sn<gt.length-1;Sn++)if(y0(gt[Sn],gt[Sn+1],rn))return!0;return!1})(c.cameraQueryGeometry,$e-re,it-re,zt+re,lt+re)));for(const $e of Me)ve.push($e);ve.sort(W2);const ze={};let Fe;for(let $e=0;$e<ve.length;$e++){const it=ve[$e];if(it===Fe)continue;Fe=it;const zt=this.featureIndexArray.get(it);let lt=null;this.loadMatchingFeature(ze,zt.bucketIndex,zt.sourceLayerIndex,zt.featureIndex,U,R.layers,R.availableImages,f,T,C,((gt,Vt,Xt)=>(lt||(lt=ph(gt)),Vt.queryIntersectsFeature({queryGeometry:X,feature:gt,featureState:Xt,geometry:lt,zoom:this.z,transform:c.transform,pixelsToTileUnits:z,pixelPosMatrix:c.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:c.getElevation}))))}return ze}loadMatchingFeature(c,f,T,C,R,z,U,X,re,ue,ve){const Ce=this.bucketLayerIDs[f];if(z&&!Ce.some(($e=>z.has($e))))return;const Me=this.sourceLayerCoder.decode(T),ze=this.vtLayers[Me].feature(C);if(R.needGeometry){const $e=mh(ze,!0);if(!R.filter(new To(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!R.filter(new To(this.tileID.overscaledZ),ze))return;const Fe=this.getId(ze,Me);for(let $e=0;$e<Ce.length;$e++){const it=Ce[$e];if(z&&!z.has(it))continue;const zt=X[it];if(!zt)continue;let lt={};Fe&&ue&&(lt=ue.getState(zt.sourceLayer||Df,Fe));const gt=sn({},re[it]);gt.paint=n1(gt.paint,zt.paint,ze,lt,U),gt.layout=n1(gt.layout,zt.layout,ze,lt,U);const Vt=!ve||ve(ze,zt,lt);if(!Vt)continue;const Xt=new w2(ze,this.z,this.x,this.y,Fe);Xt.layer=gt;let Mi=c[it];Mi===void 0&&(Mi=c[it]=[]),Mi.push({featureIndex:C,feature:Xt,intersectionZ:Vt})}}lookupSymbolFeatures(c,f,T,C,R,z,U,X){const re={};this.loadVTLayers();const ue=Xf(R.filterSpec,R.globalState);for(const ve of c)this.loadMatchingFeature(re,T,C,ve,ue,z,U,X,f);return re}hasLayer(c){for(const f of this.bucketLayerIDs)for(const T of f)if(c===T)return!0;return!1}getId(c,f){var T;let C=c.id;return this.promoteId&&(C=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof C=="boolean"&&(C=Number(C)),C===void 0&&(!((T=c.properties)===null||T===void 0)&&T.cluster)&&this.promoteId&&(C=Number(c.properties.cluster_id))),C}}function n1(m,c,f,T,C){return gn(m,((R,z)=>{const U=c instanceof fu?c.get(z):null;return U&&U.evaluate?U.evaluate(f,T,C):U}))}function W2(m,c){return c-m}function r1(m,c,f,T,C){const R=[];for(let z=0;z<m.length;z++){const U=m[z];let X;for(let re=0;re<U.length-1;re++){let ue=U[re],ve=U[re+1];ue.x<c&&ve.x<c||(ue.x<c?ue=new P(c,ue.y+(c-ue.x)/(ve.x-ue.x)*(ve.y-ue.y))._round():ve.x<c&&(ve=new P(c,ue.y+(c-ue.x)/(ve.x-ue.x)*(ve.y-ue.y))._round()),ue.y<f&&ve.y<f||(ue.y<f?ue=new P(ue.x+(f-ue.y)/(ve.y-ue.y)*(ve.x-ue.x),f)._round():ve.y<f&&(ve=new P(ue.x+(f-ue.y)/(ve.y-ue.y)*(ve.x-ue.x),f)._round()),ue.x>=T&&ve.x>=T||(ue.x>=T?ue=new P(T,ue.y+(T-ue.x)/(ve.x-ue.x)*(ve.y-ue.y))._round():ve.x>=T&&(ve=new P(T,ue.y+(T-ue.x)/(ve.x-ue.x)*(ve.y-ue.y))._round()),ue.y>=C&&ve.y>=C||(ue.y>=C?ue=new P(ue.x+(C-ue.y)/(ve.y-ue.y)*(ve.x-ue.x),C)._round():ve.y>=C&&(ve=new P(ue.x+(C-ue.y)/(ve.y-ue.y)*(ve.x-ue.x),C)._round()),X&&ue.equals(X[X.length-1])||(X=[ue],R.push(X)),X.push(ve)))))}}return R}function Z2(m,c,f,T,C){switch(c){case 1:return(function(R,z,U,X){const re=[];for(const ue of R)for(const ve of ue){const Ce=X===0?ve.x:ve.y;Ce>=z&&Ce<=U&&re.push([ve])}return re})(m,f,T,C);case 2:return s1(m,f,T,C,!1);case 3:return s1(m,f,T,C,!0)}return[]}function xI(m,c,f,T,C){const R=T===0?B0:o1;let z=[];const U=[];for(let ue=0;ue<m.length-1;ue++){const ve=m[ue],Ce=m[ue+1],Me=T===0?ve.x:ve.y,ze=T===0?Ce.x:Ce.y;let Fe=!1;Me<c?ze>c&&z.push(R(ve,Ce,c)):Me>f?ze<f&&z.push(R(ve,Ce,f)):z.push(ve),ze<c&&Me>=c&&(z.push(R(ve,Ce,c)),Fe=!0),ze>f&&Me<=f&&(z.push(R(ve,Ce,f)),Fe=!0),!C&&Fe&&(U.push(z),z=[])}const X=m.length-1,re=T===0?m[X].x:m[X].y;return re>=c&&re<=f&&z.push(m[X]),C&&z.length>0&&!z[0].equals(z[z.length-1])&&z.push(new P(z[0].x,z[0].y)),z.length>0&&U.push(z),U}function s1(m,c,f,T,C){const R=[];for(const z of m){const U=xI(z,c,f,T,C);U.length>0&&R.push(...U)}return R}function B0(m,c,f){return new P(f,m.y+(f-m.x)/(c.x-m.x)*(c.y-m.y))}function o1(m,c,f){return new P(m.x+(f-m.y)/(c.y-m.y)*(c.x-m.x),f)}ur("FeatureIndex",i1,{omit:["rawTileData","sourceLayerCoder"]});class wh extends P{constructor(c,f,T,C){super(c,f),this.angle=T,C!==void 0&&(this.segment=C)}clone(){return new wh(this.x,this.y,this.angle,this.segment)}}function y_(m,c,f,T,C){if(c.segment===void 0||f===0)return!0;let R=c,z=c.segment+1,U=0;for(;U>-f/2;){if(z--,z<0)return!1;U-=m[z].dist(R),R=m[z]}U+=m[z].dist(m[z+1]),z++;const X=[];let re=0;for(;U<f/2;){const ue=m[z],ve=m[z+1];if(!ve)return!1;let Ce=m[z-1].angleTo(ue)-ue.angleTo(ve);for(Ce=Math.abs((Ce+3*Math.PI)%(2*Math.PI)-Math.PI),X.push({distance:U,angleDelta:Ce}),re+=Ce;U-X[0].distance>T;)re-=X.shift().angleDelta;if(re>C)return!1;z++,U+=ue.dist(ve)}return!0}function My(m){let c=0;for(let f=0;f<m.length-1;f++)c+=m[f].dist(m[f+1]);return c}function Jv(m,c,f){return m?.6*c*f:0}function N0(m,c){return Math.max(m?m.right-m.left:0,c?c.right-c.left:0)}function a1(m,c,f,T,C,R){const z=Jv(f,C,R),U=N0(f,T)*R;let X=0;const re=My(m)/2;for(let ue=0;ue<m.length-1;ue++){const ve=m[ue],Ce=m[ue+1],Me=ve.dist(Ce);if(X+Me>re){const ze=(re-X)/Me,Fe=Xo.number(ve.x,Ce.x,ze),$e=Xo.number(ve.y,Ce.y,ze),it=new wh(Fe,$e,Ce.angleTo(ve),ue);return it._round(),!z||y_(m,it,U,z,c)?it:void 0}X+=Me}}function bI(m,c,f,T,C,R,z,U,X){const re=Jv(T,R,z),ue=N0(T,C),ve=ue*z,Ce=m[0].x===0||m[0].x===X||m[0].y===0||m[0].y===X;return c-ve<c/4&&(c=ve+c/4),ky(m,Ce?c/2*U%c:(ue/2+2*R)*z*U%c,c,re,f,ve,Ce,!1,X)}function ky(m,c,f,T,C,R,z,U,X){const re=R/2,ue=My(m);let ve=0,Ce=c-f,Me=[];for(let ze=0;ze<m.length-1;ze++){const Fe=m[ze],$e=m[ze+1],it=Fe.dist($e),zt=$e.angleTo(Fe);for(;Ce+f<ve+it;){Ce+=f;const lt=(Ce-ve)/it,gt=Xo.number(Fe.x,$e.x,lt),Vt=Xo.number(Fe.y,$e.y,lt);if(gt>=0&&gt<X&&Vt>=0&&Vt<X&&Ce-re>=0&&Ce+re<=ue){const Xt=new wh(gt,Vt,zt,ze);Xt._round(),T&&!y_(m,Xt,R,T,C)||Me.push(Xt)}}ve+=it}return U||Me.length||z||(Me=ky(m,ve/2,f,T,C,R,z,!0,X)),Me}function Qv(m,c,f,T){const C=[],R=m.image,z=R.pixelRatio,U=R.paddedRect.w-2,X=R.paddedRect.h-2;let re={x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};const ue=R.stretchX||[[0,U]],ve=R.stretchY||[[0,X]],Ce=(Zi,dr)=>Zi+dr[1]-dr[0],Me=ue.reduce(Ce,0),ze=ve.reduce(Ce,0),Fe=U-Me,$e=X-ze;let it=0,zt=Me,lt=0,gt=ze,Vt=0,Xt=Fe,Mi=0,ln=$e;if(R.content&&T){const Zi=R.content,dr=Zi[2]-Zi[0],or=Zi[3]-Zi[1];(R.textFitWidth||R.textFitHeight)&&(re=kb(m)),it=Th(ue,0,Zi[0]),lt=Th(ve,0,Zi[1]),zt=Th(ue,Zi[0],Zi[2]),gt=Th(ve,Zi[1],Zi[3]),Vt=Zi[0]-it,Mi=Zi[1]-lt,Xt=dr-zt,ln=or-gt}const rn=re.x1,Sn=re.y1,Xn=re.x2-rn,An=re.y2-Sn,cn=(Zi,dr,or,_r)=>{const er=Dy(Zi.stretch-it,zt,Xn,rn),Dr=am(Zi.fixed-Vt,Xt,Zi.stretch,Me),vo=Dy(dr.stretch-lt,gt,An,Sn),Qs=am(dr.fixed-Mi,ln,dr.stretch,ze),Ia=Dy(or.stretch-it,zt,Xn,rn),zc=am(or.fixed-Vt,Xt,or.stretch,Me),Ll=Dy(_r.stretch-lt,gt,An,Sn),Na=am(_r.fixed-Mi,ln,_r.stretch,ze),Ca=new P(er,vo),qo=new P(Ia,vo),Ha=new P(Ia,Ll),Va=new P(er,Ll),ga=new P(Dr/z,Qs/z),Uu=new P(zc/z,Na/z),rc=c*Math.PI/180;if(rc){const sc=Math.sin(rc),Wa=Math.cos(rc),Sl=[Wa,-sc,sc,Wa];Ca._matMult(Sl),qo._matMult(Sl),Va._matMult(Sl),Ha._matMult(Sl)}const Jc=Zi.stretch+Zi.fixed,Qh=dr.stretch+dr.fixed;return{tl:Ca,tr:qo,bl:Va,br:Ha,tex:{x:R.paddedRect.x+1+Jc,y:R.paddedRect.y+1+Qh,w:or.stretch+or.fixed-Jc,h:_r.stretch+_r.fixed-Qh},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ga,pixelOffsetBR:Uu,minFontScaleX:Xt/z/Xn,minFontScaleY:ln/z/An,isSDF:f}};if(T&&(R.stretchX||R.stretchY)){const Zi=v_(ue,Fe,Me),dr=v_(ve,$e,ze);for(let or=0;or<Zi.length-1;or++){const _r=Zi[or],er=Zi[or+1];for(let Dr=0;Dr<dr.length-1;Dr++)C.push(cn(_r,dr[Dr],er,dr[Dr+1]))}}else C.push(cn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:U+1},{fixed:0,stretch:X+1}));return C}function Th(m,c,f){let T=0;for(const C of m)T+=Math.max(c,Math.min(f,C[1]))-Math.max(c,Math.min(f,C[0]));return T}function v_(m,c,f){const T=[{fixed:-1,stretch:0}];for(const[C,R]of m){const z=T[T.length-1];T.push({fixed:C-z.stretch,stretch:z.stretch}),T.push({fixed:C-z.stretch,stretch:z.stretch+(R-C)})}return T.push({fixed:c+1,stretch:f}),T}function Dy(m,c,f,T){return m/c*f+T}function am(m,c,f,T){return m-c*f/T}ur("Anchor",wh);class lm{constructor(c,f,T,C,R,z,U,X,re,ue){var ve;if(this.boxStartIndex=c.length,re){let Ce=z.top,Me=z.bottom;const ze=z.collisionPadding;ze&&(Ce-=ze[1],Me+=ze[3]);let Fe=Me-Ce;Fe>0&&(Fe=Math.max(10,Fe),this.circleDiameter=Fe)}else{const Ce=!((ve=z.image)===null||ve===void 0)&&ve.content&&(z.image.textFitWidth||z.image.textFitHeight)?kb(z):{x1:z.left,y1:z.top,x2:z.right,y2:z.bottom};Ce.y1=Ce.y1*U-X[0],Ce.y2=Ce.y2*U+X[2],Ce.x1=Ce.x1*U-X[3],Ce.x2=Ce.x2*U+X[1];const Me=z.collisionPadding;if(Me&&(Ce.x1-=Me[0]*U,Ce.y1-=Me[1]*U,Ce.x2+=Me[2]*U,Ce.y2+=Me[3]*U),ue){const ze=new P(Ce.x1,Ce.y1),Fe=new P(Ce.x2,Ce.y1),$e=new P(Ce.x1,Ce.y2),it=new P(Ce.x2,Ce.y2),zt=ue*Math.PI/180;ze._rotate(zt),Fe._rotate(zt),$e._rotate(zt),it._rotate(zt),Ce.x1=Math.min(ze.x,Fe.x,$e.x,it.x),Ce.x2=Math.max(ze.x,Fe.x,$e.x,it.x),Ce.y1=Math.min(ze.y,Fe.y,$e.y,it.y),Ce.y2=Math.max(ze.y,Fe.y,$e.y,it.y)}c.emplaceBack(f.x,f.y,Ce.x1,Ce.y1,Ce.x2,Ce.y2,T,C,R)}this.boxEndIndex=c.length}}class X2{constructor(c=[],f=(T,C)=>T<C?-1:T>C?1:0){if(this.data=c,this.length=this.data.length,this.compare=f,this.length>0)for(let T=(this.length>>1)-1;T>=0;T--)this._down(T)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],f=this.data.pop();return--this.length>0&&(this.data[0]=f,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:f,compare:T}=this,C=f[c];for(;c>0;){const R=c-1>>1,z=f[R];if(T(C,z)>=0)break;f[c]=z,c=R}f[c]=C}_down(c){const{data:f,compare:T}=this,C=this.length>>1,R=f[c];for(;c<C;){let z=1+(c<<1);const U=z+1;if(U<this.length&&T(f[U],f[z])<0&&(z=U),T(f[z],R)>=0)break;f[c]=f[z],c=z}f[c]=R}}function ex(m,c=1,f=!1){const T=fg.fromPoints(m[0]),C=Math.min(T.width(),T.height());let R=C/2;const z=new X2([],Y2),{minX:U,minY:X,maxX:re,maxY:ue}=T;if(C===0)return new P(U,X);for(let Me=U;Me<re;Me+=C)for(let ze=X;ze<ue;ze+=C)z.push(new x_(Me+R,ze+R,R,m));let ve=(function(Me){let ze=0,Fe=0,$e=0;const it=Me[0];for(let zt=0,lt=it.length,gt=lt-1;zt<lt;gt=zt++){const Vt=it[zt],Xt=it[gt],Mi=Vt.x*Xt.y-Xt.x*Vt.y;Fe+=(Vt.x+Xt.x)*Mi,$e+=(Vt.y+Xt.y)*Mi,ze+=3*Mi}return new x_(Fe/ze,$e/ze,0,Me)})(m),Ce=z.length;for(;z.length;){const Me=z.pop();(Me.d>ve.d||!ve.d)&&(ve=Me,f&&console.log("found best %d after %d probes",Math.round(1e4*Me.d)/1e4,Ce)),Me.max-ve.d<=c||(R=Me.h/2,z.push(new x_(Me.p.x-R,Me.p.y-R,R,m)),z.push(new x_(Me.p.x+R,Me.p.y-R,R,m)),z.push(new x_(Me.p.x-R,Me.p.y+R,R,m)),z.push(new x_(Me.p.x+R,Me.p.y+R,R,m)),Ce+=4)}return f&&(console.log(`num probes: ${Ce}`),console.log(`best distance: ${ve.d}`)),ve.p}function Y2(m,c){return c.max-m.max}function x_(m,c,f,T){this.p=new P(m,c),this.h=f,this.d=(function(C,R){let z=!1,U=1/0;for(let X=0;X<R.length;X++){const re=R[X];for(let ue=0,ve=re.length,Ce=ve-1;ue<ve;Ce=ue++){const Me=re[ue],ze=re[Ce];Me.y>C.y!=ze.y>C.y&&C.x<(ze.x-Me.x)*(C.y-Me.y)/(ze.y-Me.y)+Me.x&&(z=!z),U=Math.min(U,t_(C,Me,ze))}}return(z?1:-1)*Math.sqrt(U)})(this.p,T),this.max=this.d+this.h*Math.SQRT2}var Rc;b.aP=void 0,(Rc=b.aP||(b.aP={}))[Rc.center=1]="center",Rc[Rc.left=2]="left",Rc[Rc.right=3]="right",Rc[Rc.top=4]="top",Rc[Rc.bottom=5]="bottom",Rc[Rc["top-left"]=6]="top-left",Rc[Rc["top-right"]=7]="top-right",Rc[Rc["bottom-left"]=8]="bottom-left",Rc[Rc["bottom-right"]=9]="bottom-right";const Ly=Number.POSITIVE_INFINITY;function K2(m,c){return c[1]!==Ly?(function(f,T,C){let R=0,z=0;switch(T=Math.abs(T),C=Math.abs(C),f){case"top-right":case"top-left":case"top":z=C-7;break;case"bottom-right":case"bottom-left":case"bottom":z=7-C}switch(f){case"top-right":case"bottom-right":case"right":R=-T;break;case"top-left":case"bottom-left":case"left":R=T}return[R,z]})(m,c[0],c[1]):(function(f,T){let C=0,R=0;T<0&&(T=0);const z=T/Math.SQRT2;switch(f){case"top-right":case"top-left":R=z-7;break;case"bottom-right":case"bottom-left":R=7-z;break;case"bottom":R=7-T;break;case"top":R=T-7}switch(f){case"top-right":case"bottom-right":C=-z;break;case"top-left":case"bottom-left":C=z;break;case"left":C=T;break;case"right":C=-T}return[C,R]})(m,c[0])}function Ry(m,c,f){var T;const C=m.layout,R=(T=C.get("text-variable-anchor-offset"))===null||T===void 0?void 0:T.evaluate(c,{},f);if(R){const U=R.values,X=[];for(let re=0;re<U.length;re+=2){const ue=X[re]=U[re],ve=U[re+1].map((Ce=>Ce*Ss));ue.startsWith("top")?ve[1]-=7:ue.startsWith("bottom")&&(ve[1]+=7),X[re+1]=ve}return new Ko(X)}const z=C.get("text-variable-anchor");if(z){let U;U=m._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[C.get("text-radial-offset").evaluate(c,{},f)*Ss,Ly]:C.get("text-offset").evaluate(c,{},f).map((re=>re*Ss));const X=[];for(const re of z)X.push(re,K2(re,U));return new Ko(X)}return null}function tx(m){switch(m){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function l1(m,c,f,T,C,R,z,U,X,re,ue,ve){let Ce=R.textMaxSize.evaluate(c,{});Ce===void 0&&(Ce=z);const Me=m.layers[0].layout,ze=Me.get("icon-offset").evaluate(c,{},ue),Fe=V0(f.horizontal),$e=z/24,it=m.tilePixelRatio*$e,zt=m.tilePixelRatio*Ce/24,lt=m.tilePixelRatio*U,gt=m.tilePixelRatio*Me.get("symbol-spacing"),Vt=Me.get("text-padding")*m.tilePixelRatio,Xt=(function(or,_r,er,Dr=1){const vo=or.get("icon-padding").evaluate(_r,{},er),Qs=vo&&vo.values;return[Qs[0]*Dr,Qs[1]*Dr,Qs[2]*Dr,Qs[3]*Dr]})(Me,c,ue,m.tilePixelRatio),Mi=Me.get("text-max-angle")/180*Math.PI,ln=Me.get("text-rotation-alignment")!=="viewport"&&Me.get("symbol-placement")!=="point",rn=Me.get("icon-rotation-alignment")==="map"&&Me.get("symbol-placement")!=="point",Sn=Me.get("symbol-placement"),Xn=gt/2,An=Me.get("icon-text-fit");let cn;T&&An!=="none"&&(m.allowVerticalPlacement&&f.vertical&&(cn=tm(T,f.vertical,An,Me.get("icon-text-fit-padding"),ze,$e)),Fe&&(T=tm(T,Fe,An,Me.get("icon-text-fit-padding"),ze,$e)));const Zi=ue?ve.line.getGranularityForZoomLevel(ue.z):1,dr=(or,_r)=>{_r.x<0||_r.x>=wi||_r.y<0||_r.y>=wi||(function(er,Dr,vo,Qs,Ia,zc,Ll,Na,Ca,qo,Ha,Va,ga,Uu,rc,Jc,Qh,sc,Wa,Sl,Za,oc,cm,Lf,U0){const pg=er.addToLineVertexArray(Dr,vo);let T_,Fy,S_,By,eT=0,tT=0,sx=0,ox=0,ax=-1,lx=-1;const vp={};let f1=na("");if(er.allowVerticalPlacement&&Qs.vertical){const Qc=Na.layout.get("text-rotate").evaluate(Za,{},Lf)+90;S_=new lm(Ca,Dr,qo,Ha,Va,Qs.vertical,ga,Uu,rc,Qc),Ll&&(By=new lm(Ca,Dr,qo,Ha,Va,Ll,Qh,sc,rc,Qc))}if(Ia){const Qc=Na.layout.get("icon-rotate").evaluate(Za,{}),ed=Na.layout.get("icon-text-fit")!=="none",mg=Qv(Ia,Qc,cm,ed),zf=Ll?Qv(Ll,Qc,cm,ed):void 0;Fy=new lm(Ca,Dr,qo,Ha,Va,Ia,Qh,sc,!1,Qc),eT=4*mg.length;const ca=er.iconSizeData;let xp=null;ca.kind==="source"?(xp=[gp*Na.layout.get("icon-size").evaluate(Za,{})],xp[0]>_p&&Gt(`${er.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ca.kind==="composite"&&(xp=[gp*oc.compositeIconSizes[0].evaluate(Za,{},Lf),gp*oc.compositeIconSizes[1].evaluate(Za,{},Lf)],(xp[0]>_p||xp[1]>_p)&&Gt(`${er.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),er.addSymbols(er.icon,mg,xp,Sl,Wa,Za,b.az.none,Dr,pg.lineStartIndex,pg.lineLength,-1,Lf),ax=er.icon.placedSymbolArray.length-1,zf&&(tT=4*zf.length,er.addSymbols(er.icon,zf,xp,Sl,Wa,Za,b.az.vertical,Dr,pg.lineStartIndex,pg.lineLength,-1,Lf),lx=er.icon.placedSymbolArray.length-1)}const p1=Object.keys(Qs.horizontal);for(const Qc of p1){const ed=Qs.horizontal[Qc];if(!T_){f1=na(ed.text);const zf=Na.layout.get("text-rotate").evaluate(Za,{},Lf);T_=new lm(Ca,Dr,qo,Ha,Va,ed,ga,Uu,rc,zf)}const mg=ed.positionedLines.length===1;if(sx+=J2(er,Dr,ed,zc,Na,rc,Za,Jc,pg,Qs.vertical?b.az.horizontal:b.az.horizontalOnly,mg?p1:[Qc],vp,ax,oc,Lf),mg)break}Qs.vertical&&(ox+=J2(er,Dr,Qs.vertical,zc,Na,rc,Za,Jc,pg,b.az.vertical,["vertical"],vp,lx,oc,Lf));const iT=T_?T_.boxStartIndex:er.collisionBoxArray.length,nT=T_?T_.boxEndIndex:er.collisionBoxArray.length,rT=S_?S_.boxStartIndex:er.collisionBoxArray.length,m1=S_?S_.boxEndIndex:er.collisionBoxArray.length,sT=Fy?Fy.boxStartIndex:er.collisionBoxArray.length,SI=Fy?Fy.boxEndIndex:er.collisionBoxArray.length,$0=By?By.boxStartIndex:er.collisionBoxArray.length,oT=By?By.boxEndIndex:er.collisionBoxArray.length;let Rf=-1;const cx=(Qc,ed)=>Qc&&Qc.circleDiameter?Math.max(Qc.circleDiameter,ed):ed;Rf=cx(T_,Rf),Rf=cx(S_,Rf),Rf=cx(Fy,Rf),Rf=cx(By,Rf);const aT=Rf>-1?1:0;aT&&(Rf*=U0/Ss),er.glyphOffsetArray.length>=yy.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Za.sortKey!==void 0&&er.addToSortKeyRanges(er.symbolInstances.length,Za.sortKey);const EI=Ry(Na,Za,Lf),[II,CI]=(function(Qc,ed){const mg=Qc.length,zf=ed?.values;if(zf?.length>0)for(let ca=0;ca<zf.length;ca+=2){const xp=zf[ca+1];Qc.emplaceBack(b.aP[zf[ca]],xp[0],xp[1])}return[mg,Qc.length]})(er.textAnchorOffsets,EI);er.symbolInstances.emplaceBack(Dr.x,Dr.y,vp.right>=0?vp.right:-1,vp.center>=0?vp.center:-1,vp.left>=0?vp.left:-1,vp.vertical||-1,ax,lx,f1,iT,nT,rT,m1,sT,SI,$0,oT,qo,sx,ox,eT,tT,aT,0,ga,Rf,II,CI)})(m,_r,or,f,T,C,cn,m.layers[0],m.collisionBoxArray,c.index,c.sourceLayerIndex,m.index,it,[Vt,Vt,Vt,Vt],ln,X,lt,Xt,rn,ze,c,R,re,ue,z)};if(Sn==="line")for(const or of r1(c.geometry,0,0,wi,wi)){const _r=be(or,Zi),er=bI(_r,gt,Mi,f.vertical||Fe,T,24,zt,m.overscaling,wi);for(const Dr of er)Fe&&wI(m,Fe.text,Xn,Dr)||dr(_r,Dr)}else if(Sn==="line-center"){for(const or of c.geometry)if(or.length>1){const _r=be(or,Zi),er=a1(_r,Mi,f.vertical||Fe,T,24,zt);er&&dr(_r,er)}}else if(c.type==="Polygon")for(const or of rf(c.geometry,0)){const _r=ex(or,16);dr(be(or[0],Zi,!0),new wh(_r.x,_r.y,0))}else if(c.type==="LineString")for(const or of c.geometry){const _r=be(or,Zi);dr(_r,new wh(_r[0].x,_r[0].y,0))}else if(c.type==="Point")for(const or of c.geometry)for(const _r of or)dr([_r],new wh(_r.x,_r.y,0))}function J2(m,c,f,T,C,R,z,U,X,re,ue,ve,Ce,Me,ze){const Fe=(function(zt,lt,gt,Vt,Xt,Mi,ln,rn){const Sn=Vt.layout.get("text-rotate").evaluate(Mi,{})*Math.PI/180,Xn=[];for(const An of lt.positionedLines)for(const cn of An.positionedGlyphs){if(!cn.rect)continue;const Zi=cn.rect||{};let dr=4,or=!0,_r=1,er=0;const Dr=(Xt||rn)&&cn.vertical,vo=cn.metrics.advance*cn.scale/2;if(rn&&lt.verticalizable&&(er=An.lineOffset/2-(cn.imageName?-(Ss-cn.metrics.width*cn.scale)/2:(cn.scale-1)*Ss)),cn.imageName){const sc=ln[cn.imageName];or=sc.sdf,_r=sc.pixelRatio,dr=1/_r}const Qs=Xt?[cn.x+vo,cn.y]:[0,0];let Ia=Xt?[0,0]:[cn.x+vo+gt[0],cn.y+gt[1]-er],zc=[0,0];Dr&&(zc=Ia,Ia=[0,0]);const Ll=cn.metrics.isDoubleResolution?2:1,Na=(cn.metrics.left-dr)*cn.scale-vo+Ia[0],Ca=(-cn.metrics.top-dr)*cn.scale+Ia[1],qo=Na+Zi.w/Ll*cn.scale/_r,Ha=Ca+Zi.h/Ll*cn.scale/_r,Va=new P(Na,Ca),ga=new P(qo,Ca),Uu=new P(Na,Ha),rc=new P(qo,Ha);if(Dr){const sc=new P(-vo,vo- -17),Wa=-Math.PI/2,Sl=12-vo,Za=new P(22-Sl,-(cn.imageName?Sl:0)),oc=new P(...zc);Va._rotateAround(Wa,sc)._add(Za)._add(oc),ga._rotateAround(Wa,sc)._add(Za)._add(oc),Uu._rotateAround(Wa,sc)._add(Za)._add(oc),rc._rotateAround(Wa,sc)._add(Za)._add(oc)}if(Sn){const sc=Math.sin(Sn),Wa=Math.cos(Sn),Sl=[Wa,-sc,sc,Wa];Va._matMult(Sl),ga._matMult(Sl),Uu._matMult(Sl),rc._matMult(Sl)}const Jc=new P(0,0),Qh=new P(0,0);Xn.push({tl:Va,tr:ga,bl:Uu,br:rc,tex:Zi,writingMode:lt.writingMode,glyphOffset:Qs,sectionIndex:cn.sectionIndex,isSDF:or,pixelOffsetTL:Jc,pixelOffsetBR:Qh,minFontScaleX:0,minFontScaleY:0})}return Xn})(0,f,U,C,R,z,T,m.allowVerticalPlacement),$e=m.textSizeData;let it=null;$e.kind==="source"?(it=[gp*C.layout.get("text-size").evaluate(z,{})],it[0]>_p&&Gt(`${m.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):$e.kind==="composite"&&(it=[gp*Me.compositeTextSizes[0].evaluate(z,{},ze),gp*Me.compositeTextSizes[1].evaluate(z,{},ze)],(it[0]>_p||it[1]>_p)&&Gt(`${m.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),m.addSymbols(m.text,Fe,it,U,R,z,re,c,X.lineStartIndex,X.lineLength,Ce,ze);for(const zt of ue)ve[zt]=m.text.placedSymbolArray.length-1;return 4*Fe.length}function V0(m){for(const c in m)return m[c];return null}function wI(m,c,f,T){const C=m.compareText;if(c in C){const R=C[c];for(let z=R.length-1;z>=0;z--)if(T.dist(R[z])<f)return!0}else C[c]=[];return C[c].push(T),!1}const c1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ix{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,T]=new Uint8Array(c,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const C=T>>4;if(C!==1)throw new Error(`Got v${C} data when expected v1.`);const R=c1[15&T];if(!R)throw new Error("Unrecognized array type.");const[z]=new Uint16Array(c,2,1),[U]=new Uint32Array(c,4,1);return new ix(U,z,R,c)}constructor(c,f=64,T=Float64Array,C){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=T,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const R=c1.indexOf(this.ArrayType),z=2*c*this.ArrayType.BYTES_PER_ELEMENT,U=c*this.IndexArrayType.BYTES_PER_ELEMENT,X=(8-U%8)%8;if(R<0)throw new Error(`Unexpected typed array class: ${T}.`);C&&C instanceof ArrayBuffer?(this.data=C,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+U+X,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+z+U+X),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+U+X,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+R]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=c)}add(c,f){const T=this._pos>>1;return this.ids[T]=T,this.coords[this._pos++]=c,this.coords[this._pos++]=f,T}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return nx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,f,T,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:R,coords:z,nodeSize:U}=this,X=[0,R.length-1,0],re=[];for(;X.length;){const ue=X.pop()||0,ve=X.pop()||0,Ce=X.pop()||0;if(ve-Ce<=U){for(let $e=Ce;$e<=ve;$e++){const it=z[2*$e],zt=z[2*$e+1];it>=c&&it<=T&&zt>=f&&zt<=C&&re.push(R[$e])}continue}const Me=Ce+ve>>1,ze=z[2*Me],Fe=z[2*Me+1];ze>=c&&ze<=T&&Fe>=f&&Fe<=C&&re.push(R[Me]),(ue===0?c<=ze:f<=Fe)&&(X.push(Ce),X.push(Me-1),X.push(1-ue)),(ue===0?T>=ze:C>=Fe)&&(X.push(Me+1),X.push(ve),X.push(1-ue))}return re}within(c,f,T){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:C,coords:R,nodeSize:z}=this,U=[0,C.length-1,0],X=[],re=T*T;for(;U.length;){const ue=U.pop()||0,ve=U.pop()||0,Ce=U.pop()||0;if(ve-Ce<=z){for(let $e=Ce;$e<=ve;$e++)h1(R[2*$e],R[2*$e+1],c,f)<=re&&X.push(C[$e]);continue}const Me=Ce+ve>>1,ze=R[2*Me],Fe=R[2*Me+1];h1(ze,Fe,c,f)<=re&&X.push(C[Me]),(ue===0?c-T<=ze:f-T<=Fe)&&(U.push(Ce),U.push(Me-1),U.push(1-ue)),(ue===0?c+T>=ze:f+T>=Fe)&&(U.push(Me+1),U.push(ve),U.push(1-ue))}return X}}function nx(m,c,f,T,C,R){if(C-T<=f)return;const z=T+C>>1;Q2(m,c,z,T,C,R),nx(m,c,f,T,z-1,1-R),nx(m,c,f,z+1,C,1-R)}function Q2(m,c,f,T,C,R){for(;C>T;){if(C-T>600){const re=C-T+1,ue=f-T+1,ve=Math.log(re),Ce=.5*Math.exp(2*ve/3),Me=.5*Math.sqrt(ve*Ce*(re-Ce)/re)*(ue-re/2<0?-1:1);Q2(m,c,f,Math.max(T,Math.floor(f-ue*Ce/re+Me)),Math.min(C,Math.floor(f+(re-ue)*Ce/re+Me)),R)}const z=c[2*f+R];let U=T,X=C;for(zy(m,c,T,f),c[2*C+R]>z&&zy(m,c,T,C);U<X;){for(zy(m,c,U,X),U++,X--;c[2*U+R]<z;)U++;for(;c[2*X+R]>z;)X--}c[2*T+R]===z?zy(m,c,T,X):(X++,zy(m,c,X,C)),X<=f&&(T=X+1),f<=X&&(C=X-1)}}function zy(m,c,f,T){u1(m,f,T),u1(c,2*f,2*T),u1(c,2*f+1,2*T+1)}function u1(m,c,f){const T=m[c];m[c]=m[f],m[f]=T}function h1(m,c,f,T){const C=m-f,R=c-T;return C*C+R*R}var rx;b.cH=void 0,(rx=b.cH||(b.cH={})).create="create",rx.load="load",rx.fullLoad="fullLoad";let Oy=null,b_=[];const j0=1e3/60,w_="loadTime",d1="fullLoadTime",TI={mark(m){performance.mark(m)},frame(m){const c=m;Oy!=null&&b_.push(c-Oy),Oy=c},clearMetrics(){Oy=null,b_=[],performance.clearMeasures(w_),performance.clearMeasures(d1);for(const m in b.cH)performance.clearMarks(b.cH[m])},getPerformanceMetrics(){performance.measure(w_,b.cH.create,b.cH.load),performance.measure(d1,b.cH.create,b.cH.fullLoad);const m=performance.getEntriesByName(w_)[0].duration,c=performance.getEntriesByName(d1)[0].duration,f=b_.length,T=1/(b_.reduce(((R,z)=>R+z),0)/f/1e3),C=b_.filter((R=>R>j0)).reduce(((R,z)=>R+(z-j0)/j0),0);return{loadTime:m,fullLoadTime:c,fps:T,percentDroppedFrames:C/(f+C)*100,totalFrames:f}}};b.$=ie,b.A=de,b.B=sp,b.C=nl,b.D=vr,b.E=Js,b.F=function([m,c,f]){return c+=90,c*=Math.PI/180,f*=Math.PI/180,{x:m*Math.cos(c)*Math.sin(f),y:m*Math.sin(c)*Math.sin(f),z:m*Math.cos(f)}},b.G=Xo,b.H=To,b.I=Yh,b.J=Hm,b.K=function(m){if(Ui==null){const c=m.navigator?m.navigator.userAgent:null;Ui=!!m.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Ui},b.L=class{constructor(m,c){this.target=m,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new dg((()=>this.process())),this.subscription=Hi(this.target,"message",(f=>this.receive(f)),!1),this.globalScope=hn(self)?m:window}registerMessageHandler(m,c){this.messageHandlers[m]=c}unregisterMessageHandler(m){delete this.messageHandlers[m]}sendAsync(m,c){return new Promise(((f,T)=>{const C=Math.round(1e18*Math.random()).toString(36).substring(0,10),R=c?Hi(c.signal,"abort",(()=>{R?.unsubscribe(),delete this.resolveRejects[C];const X={id:C,type:"<cancel>",origin:location.origin,targetMapId:m.targetMapId,sourceMapId:this.mapId};this.target.postMessage(X)}),ic):null;this.resolveRejects[C]={resolve:X=>{R?.unsubscribe(),f(X)},reject:X=>{R?.unsubscribe(),T(X)}};const z=[],U=Object.assign(Object.assign({},m),{id:C,sourceMapId:this.mapId,origin:location.origin,data:_f(m.data,z)});this.target.postMessage(U,{transfer:z})}))}receive(m){const c=m.data,f=c.id;if(!(c.origin!=="file://"&&location.origin!=="file://"&&c.origin!=="resource://android"&&location.origin!=="resource://android"&&c.origin!==location.origin||c.targetMapId&&this.mapId!==c.targetMapId)){if(c.type==="<cancel>"){delete this.tasks[f];const T=this.abortControllers[f];return delete this.abortControllers[f],void(T&&T.abort())}if(hn(self)||c.mustQueue)return this.tasks[f]=c,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,c)}}process(){if(this.taskQueue.length===0)return;const m=this.taskQueue.shift(),c=this.tasks[m];delete this.tasks[m],this.taskQueue.length>0&&this.invoker.trigger(),c&&this.processTask(m,c)}processTask(m,c){return t(this,void 0,void 0,(function*(){if(c.type==="<response>"){const C=this.resolveRejects[m];return delete this.resolveRejects[m],C?void(c.error?C.reject(ap(c.error)):C.resolve(ap(c.data))):void 0}if(!this.messageHandlers[c.type])return void this.completeTask(m,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=ap(c.data),T=new AbortController;this.abortControllers[m]=T;try{const C=yield this.messageHandlers[c.type](c.sourceMapId,f,T);this.completeTask(m,null,C)}catch(C){this.completeTask(m,C)}}))}completeTask(m,c,f){const T=[];delete this.abortControllers[m];const C={id:m,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?_f(c):null,data:_f(f,T)};this.target.postMessage(C,{transfer:T})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.M=gi,b.N=function(){var m=new de(16);return de!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0),m[0]=1,m[5]=1,m[10]=1,m[15]=1,m},b.O=function(m,c,f){var T,C,R,z,U,X,re,ue,ve,Ce,Me,ze,Fe=f[0],$e=f[1],it=f[2];return c===m?(m[12]=c[0]*Fe+c[4]*$e+c[8]*it+c[12],m[13]=c[1]*Fe+c[5]*$e+c[9]*it+c[13],m[14]=c[2]*Fe+c[6]*$e+c[10]*it+c[14],m[15]=c[3]*Fe+c[7]*$e+c[11]*it+c[15]):(C=c[1],R=c[2],z=c[3],U=c[4],X=c[5],re=c[6],ue=c[7],ve=c[8],Ce=c[9],Me=c[10],ze=c[11],m[0]=T=c[0],m[1]=C,m[2]=R,m[3]=z,m[4]=U,m[5]=X,m[6]=re,m[7]=ue,m[8]=ve,m[9]=Ce,m[10]=Me,m[11]=ze,m[12]=T*Fe+U*$e+ve*it+c[12],m[13]=C*Fe+X*$e+Ce*it+c[13],m[14]=R*Fe+re*$e+Me*it+c[14],m[15]=z*Fe+ue*$e+ze*it+c[15]),m},b.P=P,b.Q=function(m,c,f){var T=f[0],C=f[1],R=f[2];return m[0]=c[0]*T,m[1]=c[1]*T,m[2]=c[2]*T,m[3]=c[3]*T,m[4]=c[4]*C,m[5]=c[5]*C,m[6]=c[6]*C,m[7]=c[7]*C,m[8]=c[8]*R,m[9]=c[9]*R,m[10]=c[10]*R,m[11]=c[11]*R,m[12]=c[12],m[13]=c[13],m[14]=c[14],m[15]=c[15],m},b.R=lo,b.S=function(m,c,f){var T=c[0],C=c[1],R=c[2],z=c[3],U=c[4],X=c[5],re=c[6],ue=c[7],ve=c[8],Ce=c[9],Me=c[10],ze=c[11],Fe=c[12],$e=c[13],it=c[14],zt=c[15],lt=f[0],gt=f[1],Vt=f[2],Xt=f[3];return m[0]=lt*T+gt*U+Vt*ve+Xt*Fe,m[1]=lt*C+gt*X+Vt*Ce+Xt*$e,m[2]=lt*R+gt*re+Vt*Me+Xt*it,m[3]=lt*z+gt*ue+Vt*ze+Xt*zt,m[4]=(lt=f[4])*T+(gt=f[5])*U+(Vt=f[6])*ve+(Xt=f[7])*Fe,m[5]=lt*C+gt*X+Vt*Ce+Xt*$e,m[6]=lt*R+gt*re+Vt*Me+Xt*it,m[7]=lt*z+gt*ue+Vt*ze+Xt*zt,m[8]=(lt=f[8])*T+(gt=f[9])*U+(Vt=f[10])*ve+(Xt=f[11])*Fe,m[9]=lt*C+gt*X+Vt*Ce+Xt*$e,m[10]=lt*R+gt*re+Vt*Me+Xt*it,m[11]=lt*z+gt*ue+Vt*ze+Xt*zt,m[12]=(lt=f[12])*T+(gt=f[13])*U+(Vt=f[14])*ve+(Xt=f[15])*Fe,m[13]=lt*C+gt*X+Vt*Ce+Xt*$e,m[14]=lt*R+gt*re+Vt*Me+Xt*it,m[15]=lt*z+gt*ue+Vt*ze+Xt*zt,m},b.T=og,b.U=function(m,c){const f={};for(let T=0;T<c.length;T++){const C=c[T];C in m&&(f[C]=m[C])}return f},b.V=Fd,b.W=ti,b.X=y2,b.Y=_2,b.Z=At,b._=t,b.a=Ke,b.a$=ct,b.a0=pe,b.a1=vi,b.a2=Kh,b.a3=Nb,b.a4=yp,b.a5=wi,b.a6=function(m,c,f){if(!m)return c||{};if(!c)return m||{};const T=b2(m),C=b2(c);(function(z,U){U.removeAll&&(z.add.clear(),z.update.clear(),z.remove.clear(),U.remove.clear());for(const X of U.remove)z.add.delete(X),z.update.delete(X);for(const[X,re]of U.update){const ue=z.update.get(X);ue&&(U.update.set(X,Ub(ue,re)),z.update.delete(X))}})(T,C);const R={};if((T.removeAll||C.removeAll)&&(R.removeAll=!0),R.remove=new Set([...T.remove,...C.remove]),R.add=new Map([...T.add,...C.add]),R.update=new Map([...T.update,...C.update]),R.remove.size&&R.add.size)for(const z of R.add.keys())R.remove.delete(z);return(function(z){const U={};return z.removeAll&&(U.removeAll=z.removeAll),z.remove&&(U.remove=Array.from(z.remove)),z.add&&(U.add=Array.from(z.add.values())),z.update&&(U.update=Array.from(z.update.values())),U})(R)},b.a7=function(m,c){const f=new Map;if(m==null||m.type==null)return f;if(m.type==="Feature"){const T=jb(m,c);return T==null?void 0:(f.set(T,m),f)}if(m.type==="FeatureCollection"){const T=new Set;for(const C of m.features){const R=jb(C,c);if(R==null||T.has(R))return;T.add(R),f.set(R,C)}return f}},b.a8=function(m,c,f){var T,C;const R=[];if(c.removeAll)m.clear();else if(c.remove)for(const z of c.remove){const U=m.get(z);U&&(R.push(U.geometry),m.delete(z))}if(c.add)for(const z of c.add){const U=jb(z,f);if(U==null)continue;const X=m.get(U);X&&R.push(X.geometry),R.push(z.geometry),m.set(U,z)}if(c.update)for(const z of c.update){const U=m.get(z.id);if(!U)continue;const X=!!z.newGeometry,re=z.removeAllProperties||((T=z.removeProperties)===null||T===void 0?void 0:T.length)>0||((C=z.addOrUpdateProperties)===null||C===void 0?void 0:C.length)>0;if(!X&&!re)continue;R.push(U.geometry);const ue=Object.assign({},U);if(m.set(z.id,ue),X&&(R.push(z.newGeometry),ue.geometry=z.newGeometry),re){if(ue.properties=z.removeAllProperties?{}:Object.assign({},ue.properties||{}),z.removeProperties)for(const ve of z.removeProperties)delete ue.properties[ve];if(z.addOrUpdateProperties)for(const{key:ve,value:Ce}of z.addOrUpdateProperties)ue.properties[ve]=Ce}}return R},b.a9=C0,b.aA=function(m,{uSize:c,uSizeT:f},{lowerSize:T,upperSize:C}){return m.kind==="source"?T/gp:m.kind==="composite"?Xo.number(T/gp,C/gp,f):c},b.aB=function(m,c){var f=c[0],T=c[1],C=c[2],R=c[3],z=c[4],U=c[5],X=c[6],re=c[7],ue=c[8],ve=c[9],Ce=c[10],Me=c[11],ze=c[12],Fe=c[13],$e=c[14],it=c[15],zt=f*U-T*z,lt=f*X-C*z,gt=f*re-R*z,Vt=T*X-C*U,Xt=T*re-R*U,Mi=C*re-R*X,ln=ue*Fe-ve*ze,rn=ue*$e-Ce*ze,Sn=ue*it-Me*ze,Xn=ve*$e-Ce*Fe,An=ve*it-Me*Fe,cn=Ce*it-Me*$e,Zi=zt*cn-lt*An+gt*Xn+Vt*Sn-Xt*rn+Mi*ln;return Zi?(m[0]=(U*cn-X*An+re*Xn)*(Zi=1/Zi),m[1]=(C*An-T*cn-R*Xn)*Zi,m[2]=(Fe*Mi-$e*Xt+it*Vt)*Zi,m[3]=(Ce*Xt-ve*Mi-Me*Vt)*Zi,m[4]=(X*Sn-z*cn-re*rn)*Zi,m[5]=(f*cn-C*Sn+R*rn)*Zi,m[6]=($e*gt-ze*Mi-it*lt)*Zi,m[7]=(ue*Mi-Ce*gt+Me*lt)*Zi,m[8]=(z*An-U*Sn+re*ln)*Zi,m[9]=(T*Sn-f*An-R*ln)*Zi,m[10]=(ze*Xt-Fe*gt+it*zt)*Zi,m[11]=(ve*gt-ue*Xt-Me*zt)*Zi,m[12]=(U*rn-z*Xn-X*ln)*Zi,m[13]=(f*Xn-T*rn+C*ln)*Zi,m[14]=(Fe*lt-ze*Vt-$e*zt)*Zi,m[15]=(ue*Vt-ve*lt+Ce*zt)*Zi,m):null},b.aC=Ft,b.aD=function(m){var c=m[0],f=m[1];return Math.sqrt(c*c+f*f)},b.aE=function(m){return m[0]=0,m[1]=0,m},b.aF=function(m,c,f){return m[0]=c[0]*f,m[1]=c[1]*f,m},b.aG=Av,b.aH=Wt,b.aI=function(m,c,f,T){const C=c.y-m.y,R=c.x-m.x,z=T.y-f.y,U=T.x-f.x,X=z*R-U*C;if(X===0)return null;const re=(U*(m.y-f.y)-z*(m.x-f.x))/X;return new P(m.x+re*R,m.y+re*C)},b.aJ=r1,b.aK=ju,b.aL=function(m){let c=1/0,f=1/0,T=-1/0,C=-1/0;for(const R of m)c=Math.min(c,R.x),f=Math.min(f,R.y),T=Math.max(T,R.x),C=Math.max(C,R.y);return[c,f,T,C]},b.aM=Ss,b.aN=Qi,b.aO=function(m,c,f,T,C=!1){if(!f[0]&&!f[1])return[0,0];const R=C?T==="map"?-m.bearingInRadians:0:T==="viewport"?m.bearingInRadians:0;if(R){const z=Math.sin(R),U=Math.cos(R);f=[f[0]*U-f[1]*z,f[0]*z+f[1]*U]}return[C?f[0]:Qi(c,f[0],m.zoom),C?f[1]:Qi(c,f[1],m.zoom)]},b.aQ=Lb,b.aR=tx,b.aS=T0,b.aT=ix,b.aU=Yo,b.aV=J,b.aW=xt,b.aX=Yn,b.aY=Pi,b.aZ=Ii,b.a_=vy,b.aa=fg,b.ab=25,b.ac=Vb,b.ad=m=>{const c=window.document.createElement("video");return c.muted=!0,new Promise((f=>{c.onloadstart=()=>{f(c)};for(const T of m){const C=window.document.createElement("source");nn(T)||(c.crossOrigin="Anonymous"),C.src=T,c.appendChild(C)}}))},b.ae=Mn,b.af=function(){return Gi++},b.ag=D,b.ah=yy,b.ai=Df,b.aj=Xf,b.ak=mh,b.al=w2,b.am=function(m){const c={};if(m.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((f,T,C,R)=>{const z=C||R;return c[T]=!z||z.toLowerCase(),""})),c["max-age"]){const f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c},b.an=Hr,b.ao=85.051129,b.ap=Bt,b.aq=function(m){return Math.pow(2,m)},b.ar=Pe,b.as=p_,b.at=function(m){return Math.log(m)/Math.LN2},b.au=function(m){var c=m[0],f=m[1];return c*c+f*f},b.av=function(m){if(!m.length)return new Set;const c=Math.max(...m.map((X=>X.canonical.z)));let f=1/0,T=-1/0,C=1/0,R=-1/0;const z=[];for(const X of m){const{x:re,y:ue,z:ve}=X.canonical,Ce=Math.pow(2,c-ve),Me=re*Ce,ze=ue*Ce;z.push({id:X,x:Me,y:ze}),Me<f&&(f=Me),Me>T&&(T=Me),ze<C&&(C=ze),ze>R&&(R=ze)}const U=new Set;for(const X of z)X.x!==f&&X.x!==T&&X.y!==C&&X.y!==R||U.add(X.id);return U},b.aw=function(m,c){const f=Math.abs(2*m.wrap)-+(m.wrap<0),T=Math.abs(2*c.wrap)-+(c.wrap<0);return m.overscaledZ-c.overscaledZ||T-f||c.canonical.y-m.canonical.y||c.canonical.x-m.canonical.x},b.ax=class{constructor(m,c){this.max=m,this.onRemove=c,this.reset()}reset(){for(const m in this.data)for(const c of this.data[m])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(m,c,f){const T=m.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);const C={value:c,timeout:void 0};if(f!==void 0&&(C.timeout=setTimeout((()=>{this.remove(m,C)}),f)),this.data[T].push(C),this.order.push(T),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(m){return m.wrapped().key in this.data}getAndRemove(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null}_getAndRemoveByKey(m){const c=this.data[m].shift();return c.timeout&&clearTimeout(c.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),c.value}getByKey(m){const c=this.data[m];return c?c[0].value:null}get(m){return this.has(m)?this.data[m.wrapped().key][0].value:null}remove(m,c){if(!this.has(m))return this;const f=m.wrapped().key,T=c===void 0?0:this.data[f].indexOf(c),C=this.data[f][T];return this.data[f].splice(T,1),C.timeout&&clearTimeout(C.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(C.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(m){for(this.max=m;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(m){const c=[];for(const f in this.data)for(const T of this.data[f])m(T.value)||c.push(T);for(const f of c)this.remove(f.value.tileID,f)}},b.ay=function(m,c){let f=0,T=0;if(m.kind==="constant")T=m.layoutSize;else if(m.kind!=="source"){const{interpolationType:C,minZoom:R,maxZoom:z}=m,U=C?Hr(Gn.interpolationFactor(C,c,R,z),0,1):0;m.kind==="camera"?T=Xo.number(m.minSize,m.maxSize,U):f=U}return{uSizeT:f,uSize:T}},b.b=pt,b.b$=Xc,b.b0=Ye,b.b1=function(m){var c=new de(3);return c[0]=m[0],c[1]=m[1],c[2]=m[2],c},b.b2=function(m,c,f){return m[0]=c[0]-f[0],m[1]=c[1]-f[1],m[2]=c[2]-f[2],m},b.b3=function(m,c){var f=c[0],T=c[1],C=c[2],R=f*f+T*T+C*C;return R>0&&(R=1/Math.sqrt(R)),m[0]=c[0]*R,m[1]=c[1]*R,m[2]=c[2]*R,m},b.b4=Lt,b.b5=function(m,c){return m[0]*c[0]+m[1]*c[1]+m[2]*c[2]},b.b6=function(m,c,f){return m[0]=c[0]*f[0],m[1]=c[1]*f[1],m[2]=c[2]*f[2],m[3]=c[3]*f[3],m},b.b7=We,b.b8=function(m,c,f){const T=c[0]*f[0]+c[1]*f[1]+c[2]*f[2];return T===0?null:(-(m[0]*f[0]+m[1]*f[1]+m[2]*f[2])-f[3])/T},b.b9=ci,b.bA=function(m,c,f,T){return m[0]=c[0]+f[0]*T,m[1]=c[1]+f[1]*T,m[2]=c[2]+f[2]*T,m},b.bB=Dt,b.bC=function(m,c,f){var T=f[0],C=f[1],R=f[2],z=f[3],U=c[0],X=c[1],re=c[2],ue=C*re-R*X,ve=R*U-T*re,Ce=T*X-C*U;return m[0]=U+z*(ue+=ue)+C*(Ce+=Ce)-R*(ve+=ve),m[1]=X+z*ve+R*ue-T*Ce,m[2]=re+z*Ce+T*ve-C*ue,m},b.bD=function(m,c,f){const T=(function(X){var re=X[3],ue=X[4],ve=X[5],Ce=X[6],Me=X[7],ze=X[8];return X[0]*(ze*ue-ve*Me)+X[1]*(-ze*re+ve*Ce)+X[2]*(Me*re-ue*Ce)})([m[0],m[1],m[2],c[0],c[1],c[2],f[0],f[1],f[2]]);if(T===0)return null;const C=Lt([],[c[0],c[1],c[2]],[f[0],f[1],f[2]]),R=Lt([],[f[0],f[1],f[2]],[m[0],m[1],m[2]]),z=Lt([],[m[0],m[1],m[2]],[c[0],c[1],c[2]]),U=ct([],C,-m[3]);return Ye(U,U,ct([],R,-c[3])),Ye(U,U,ct([],z,-f[3])),ct(U,U,1/T),U},b.bE=kv,b.bF=function(){return new Float64Array(4)},b.bG=function(m,c,f,T){var C=[],R=[];return C[0]=c[0]-f[0],C[1]=c[1]-f[1],C[2]=c[2]-f[2],R[0]=C[0]*Math.cos(T)-C[1]*Math.sin(T),R[1]=C[0]*Math.sin(T)+C[1]*Math.cos(T),R[2]=C[2],m[0]=R[0]+f[0],m[1]=R[1]+f[1],m[2]=R[2]+f[2],m},b.bH=function(m,c,f,T){var C=[],R=[];return C[0]=c[0]-f[0],C[1]=c[1]-f[1],C[2]=c[2]-f[2],R[0]=C[0],R[1]=C[1]*Math.cos(T)-C[2]*Math.sin(T),R[2]=C[1]*Math.sin(T)+C[2]*Math.cos(T),m[0]=R[0]+f[0],m[1]=R[1]+f[1],m[2]=R[2]+f[2],m},b.bI=function(m,c,f,T){var C=[],R=[];return C[0]=c[0]-f[0],C[1]=c[1]-f[1],C[2]=c[2]-f[2],R[0]=C[2]*Math.sin(T)+C[0]*Math.cos(T),R[1]=C[1],R[2]=C[2]*Math.cos(T)-C[0]*Math.sin(T),m[0]=R[0]+f[0],m[1]=R[1]+f[1],m[2]=R[2]+f[2],m},b.bJ=function(m,c,f){var T=Math.sin(f),C=Math.cos(f),R=c[0],z=c[1],U=c[2],X=c[3],re=c[8],ue=c[9],ve=c[10],Ce=c[11];return c!==m&&(m[4]=c[4],m[5]=c[5],m[6]=c[6],m[7]=c[7],m[12]=c[12],m[13]=c[13],m[14]=c[14],m[15]=c[15]),m[0]=R*C-re*T,m[1]=z*C-ue*T,m[2]=U*C-ve*T,m[3]=X*C-Ce*T,m[8]=R*T+re*C,m[9]=z*T+ue*C,m[10]=U*T+ve*C,m[11]=X*T+Ce*C,m},b.bK=function(m,c){const f=wn(m,360),T=wn(c,360),C=T-f,R=T>f?C-360:C+360;return Math.abs(C)<Math.abs(R)?C:R},b.bL=function(m){return m[0]=0,m[1]=0,m[2]=0,m},b.bM=function(m,c,f,T){const C=Math.sqrt(m*m+c*c),R=Math.sqrt(f*f+T*T);m/=C,c/=C,f/=R,T/=R;const z=Math.acos(m*f+c*T);return-c*f+m*T>0?z:-z},b.bN=function(m,c){const f=wn(m,2*Math.PI),T=wn(c,2*Math.PI);return Math.min(Math.abs(f-T),Math.abs(f-T+2*Math.PI),Math.abs(f-T-2*Math.PI))},b.bO=function(){const m={},c=mi.$version;for(const f in mi.$root){const T=mi.$root[f];if(T.required){let C=null;C=f==="version"?c:T.type==="array"?[]:{},C!=null&&(m[f]=C)}}return m},b.bP=Ci,b.bQ=Md,b.bR=function m(c,f){if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(let T=0;T<c.length;T++)if(!m(c[T],f[T]))return!1;return!0}if(typeof c=="object"&&c!==null&&f!==null){if(typeof f!="object"||Object.keys(c).length!==Object.keys(f).length)return!1;for(const T in c)if(!m(c[T],f[T]))return!1;return!0}return c===f},b.bS=function(m){m=m.slice();const c=Object.create(null);for(let f=0;f<m.length;f++)c[m[f].id]=m[f];for(let f=0;f<m.length;f++)"ref"in m[f]&&(m[f]=al(m[f],c[m[f].ref]));return m},b.bT=function(m,c){if(m.type==="custom")return new Bb(m,c);switch(m.type){case"background":return new p2(m,c);case"circle":return new wb(m,c);case"color-relief":return new c_(m,c);case"fill":return new nt(m,c);case"fill-extrusion":return new kn(m,c);case"heatmap":return new py(m,c);case"hillshade":return new a_(m,c);case"line":return new Ar(m,c);case"raster":return new Sf(m,c);case"symbol":return new I0(m,c)}},b.bU=m=>m.type==="raster",b.bV=Ur,b.bW=function(m,c){if(!m)return[{command:"setStyle",args:[c]}];let f=[];try{if(!is(m.version,c.version))return[{command:"setStyle",args:[c]}];is(m.center,c.center)||f.push({command:"setCenter",args:[c.center]}),is(m.state,c.state)||f.push({command:"setGlobalState",args:[c.state]}),is(m.centerAltitude,c.centerAltitude)||f.push({command:"setCenterAltitude",args:[c.centerAltitude]}),is(m.zoom,c.zoom)||f.push({command:"setZoom",args:[c.zoom]}),is(m.bearing,c.bearing)||f.push({command:"setBearing",args:[c.bearing]}),is(m.pitch,c.pitch)||f.push({command:"setPitch",args:[c.pitch]}),is(m.roll,c.roll)||f.push({command:"setRoll",args:[c.roll]}),is(m.sprite,c.sprite)||f.push({command:"setSprite",args:[c.sprite]}),is(m.glyphs,c.glyphs)||f.push({command:"setGlyphs",args:[c.glyphs]}),is(m.transition,c.transition)||f.push({command:"setTransition",args:[c.transition]}),is(m.light,c.light)||f.push({command:"setLight",args:[c.light]}),is(m.terrain,c.terrain)||f.push({command:"setTerrain",args:[c.terrain]}),is(m.sky,c.sky)||f.push({command:"setSky",args:[c.sky]}),is(m.projection,c.projection)||f.push({command:"setProjection",args:[c.projection]});const T={},C=[];(function(z,U,X,re){let ue;for(ue in U=U||{},z=z||{})Object.prototype.hasOwnProperty.call(z,ue)&&(Object.prototype.hasOwnProperty.call(U,ue)||yi(ue,X,re));for(ue in U)Object.prototype.hasOwnProperty.call(U,ue)&&(Object.prototype.hasOwnProperty.call(z,ue)?is(z[ue],U[ue])||(z[ue].type==="geojson"&&U[ue].type==="geojson"&&Bo(z,U,ue)?Hs(X,{command:"setGeoJSONSourceData",args:[ue,U[ue].data]}):Ao(ue,U,X,re)):ll(ue,U,X))})(m.sources,c.sources,C,T);const R=[];m.layers&&m.layers.forEach((z=>{"source"in z&&T[z.source]?f.push({command:"removeLayer",args:[z.id]}):R.push(z)})),f=f.concat(C),(function(z,U,X){U=U||[];const re=(z=z||[]).map(ns),ue=U.map(ns),ve=z.reduce(Ja,{}),Ce=U.reduce(Ja,{}),Me=re.slice(),ze=Object.create(null);let Fe,$e,it,zt,lt;for(let gt=0,Vt=0;gt<re.length;gt++)Fe=re[gt],Object.prototype.hasOwnProperty.call(Ce,Fe)?Vt++:(Hs(X,{command:"removeLayer",args:[Fe]}),Me.splice(Me.indexOf(Fe,Vt),1));for(let gt=0,Vt=0;gt<ue.length;gt++)Fe=ue[ue.length-1-gt],Me[Me.length-1-gt]!==Fe&&(Object.prototype.hasOwnProperty.call(ve,Fe)?(Hs(X,{command:"removeLayer",args:[Fe]}),Me.splice(Me.lastIndexOf(Fe,Me.length-Vt),1)):Vt++,zt=Me[Me.length-gt],Hs(X,{command:"addLayer",args:[Ce[Fe],zt]}),Me.splice(Me.length-gt,0,Fe),ze[Fe]=!0);for(let gt=0;gt<ue.length;gt++)if(Fe=ue[gt],$e=ve[Fe],it=Ce[Fe],!ze[Fe]&&!is($e,it))if(is($e.source,it.source)&&is($e["source-layer"],it["source-layer"])&&is($e.type,it.type)){for(lt in sa($e.layout,it.layout,X,Fe,null,"setLayoutProperty"),sa($e.paint,it.paint,X,Fe,null,"setPaintProperty"),is($e.filter,it.filter)||Hs(X,{command:"setFilter",args:[Fe,it.filter]}),is($e.minzoom,it.minzoom)&&is($e.maxzoom,it.maxzoom)||Hs(X,{command:"setLayerZoomRange",args:[Fe,it.minzoom,it.maxzoom]}),$e)Object.prototype.hasOwnProperty.call($e,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?sa($e[lt],it[lt],X,Fe,lt.slice(6),"setPaintProperty"):is($e[lt],it[lt])||Hs(X,{command:"setLayerProperty",args:[Fe,lt,it[lt]]}));for(lt in it)Object.prototype.hasOwnProperty.call(it,lt)&&!Object.prototype.hasOwnProperty.call($e,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?sa($e[lt],it[lt],X,Fe,lt.slice(6),"setPaintProperty"):is($e[lt],it[lt])||Hs(X,{command:"setLayerProperty",args:[Fe,lt,it[lt]]}))}else Hs(X,{command:"removeLayer",args:[Fe]}),zt=Me[Me.lastIndexOf(Fe)+1],Hs(X,{command:"addLayer",args:[it,zt]})})(R,c.layers,f)}catch(T){console.warn("Unable to compute style diff:",T),f=[{command:"setStyle",args:[c]}]}return f},b.bX=function(m){const c=[],f=m.id;return f===void 0&&c.push({message:`layers.${f}: missing required property "id"`}),m.render===void 0&&c.push({message:`layers.${f}: missing required method "render"`}),m.renderingMode&&m.renderingMode!=="2d"&&m.renderingMode!=="3d"&&c.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),c},b.bY=gn,b.bZ=nr,b.b_=class extends jl{constructor(m,c){super(m,c),this.current=0}set(m){this.current!==m&&(this.current=m,this.gl.uniform1i(this.location,m))}},b.ba=function(m,c,f){return m[0]=c[0]*f,m[1]=c[1]*f,m[2]=c[2]*f,m[3]=c[3]*f,m},b.bb=function(m,c){return m[0]*c[0]+m[1]*c[1]+m[2]*c[2]+m[3]},b.bc=x2,b.bd=xy,b.be=function(m,c,f,T,C){var R=1/Math.tan(c/2);if(m[0]=R/f,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=R,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,C!=null&&C!==1/0){var z=1/(T-C);m[10]=(C+T)*z,m[14]=2*C*T*z}else m[10]=-1,m[14]=-2*T;return m},b.bf=function(m){var c=new de(16);return c[0]=m[0],c[1]=m[1],c[2]=m[2],c[3]=m[3],c[4]=m[4],c[5]=m[5],c[6]=m[6],c[7]=m[7],c[8]=m[8],c[9]=m[9],c[10]=m[10],c[11]=m[11],c[12]=m[12],c[13]=m[13],c[14]=m[14],c[15]=m[15],c},b.bg=function(m,c,f){var T=Math.sin(f),C=Math.cos(f),R=c[0],z=c[1],U=c[2],X=c[3],re=c[4],ue=c[5],ve=c[6],Ce=c[7];return c!==m&&(m[8]=c[8],m[9]=c[9],m[10]=c[10],m[11]=c[11],m[12]=c[12],m[13]=c[13],m[14]=c[14],m[15]=c[15]),m[0]=R*C+re*T,m[1]=z*C+ue*T,m[2]=U*C+ve*T,m[3]=X*C+Ce*T,m[4]=re*C-R*T,m[5]=ue*C-z*T,m[6]=ve*C-U*T,m[7]=Ce*C-X*T,m},b.bh=function(m,c,f){var T=Math.sin(f),C=Math.cos(f),R=c[4],z=c[5],U=c[6],X=c[7],re=c[8],ue=c[9],ve=c[10],Ce=c[11];return c!==m&&(m[0]=c[0],m[1]=c[1],m[2]=c[2],m[3]=c[3],m[12]=c[12],m[13]=c[13],m[14]=c[14],m[15]=c[15]),m[4]=R*C+re*T,m[5]=z*C+ue*T,m[6]=U*C+ve*T,m[7]=X*C+Ce*T,m[8]=re*C-R*T,m[9]=ue*C-z*T,m[10]=ve*C-U*T,m[11]=Ce*C-X*T,m},b.bi=function(){const m=new Float32Array(16);return Pe(m),m},b.bj=function(){const m=new Float64Array(16);return Pe(m),m},b.bk=function(){return new Float64Array(16)},b.bl=function(m,c,f){const T=new Float64Array(4);return Dt(T,m,c-90,f),T},b.bm=function(m,c,f,T){var C,R,z,U,X,re=c[0],ue=c[1],ve=c[2],Ce=c[3],Me=f[0],ze=f[1],Fe=f[2],$e=f[3];return(R=re*Me+ue*ze+ve*Fe+Ce*$e)<0&&(R=-R,Me=-Me,ze=-ze,Fe=-Fe,$e=-$e),1-R>ye?(C=Math.acos(R),z=Math.sin(C),U=Math.sin((1-T)*C)/z,X=Math.sin(T*C)/z):(U=1-T,X=T),m[0]=U*re+X*Me,m[1]=U*ue+X*ze,m[2]=U*ve+X*Fe,m[3]=U*Ce+X*$e,m},b.bn=function(m){const c=new Float64Array(9);(function(R,z){var U=z[0],X=z[1],re=z[2],ue=z[3],ve=U+U,Ce=X+X,Me=re+re,ze=U*ve,Fe=X*ve,$e=X*Ce,it=re*ve,zt=re*Ce,lt=re*Me,gt=ue*ve,Vt=ue*Ce,Xt=ue*Me;R[0]=1-$e-lt,R[3]=Fe-Xt,R[6]=it+Vt,R[1]=Fe+Xt,R[4]=1-ze-lt,R[7]=zt-gt,R[2]=it-Vt,R[5]=zt+gt,R[8]=1-ze-$e})(c,m);const f=Ii(-Math.asin(Hr(c[2],-1,1)));let T,C;return Math.hypot(c[5],c[8])<.001?(T=0,C=-Ii(Math.atan2(c[3],c[4]))):(T=Ii(c[5]===0&&c[8]===0?0:Math.atan2(c[5],c[8])),C=Ii(c[1]===0&&c[0]===0?0:Math.atan2(c[1],c[0]))),{roll:T,pitch:f+90,bearing:C}},b.bo=function(m,c){return m.roll==c.roll&&m.pitch==c.pitch&&m.bearing==c.bearing},b.bp=as,b.bq=bl,b.br=ee,b.bs=ce,b.bt=G,b.bu=qn,b.bv=Fn,b.bw=el,b.bx=function(m,c,f,T,C){return qn(T,C,Hr((m-c)/(f-c),0,1))},b.by=wn,b.bz=function(){return new Float64Array(3)},b.c=jt,b.c$=function(m,c,f,T,C){return t(this,void 0,void 0,(function*(){if(pe())try{return yield vi(m,c,f,T,C)}catch{}return(function(R,z,U,X,re){const ue=R.width,ve=R.height;qi&&on||(qi=new OffscreenCanvas(ue,ve),on=qi.getContext("2d",{willReadFrequently:!0})),qi.width=ue,qi.height=ve,on.drawImage(R,0,0,ue,ve);const Ce=on.getImageData(z,U,X,re);return on.clearRect(0,0,ue,ve),Ce.data})(m,c,f,T,C)}))},b.c0=class extends jl{constructor(m,c){super(m,c),this.current=mc}set(m){if(m[12]!==this.current[12]||m[0]!==this.current[0])return this.current=m,void this.gl.uniformMatrix4fv(this.location,!1,m);for(let c=1;c<16;c++)if(m[c]!==this.current[c]){this.current=m,this.gl.uniformMatrix4fv(this.location,!1,m);break}}},b.c1=wl,b.c2=class extends jl{constructor(m,c){super(m,c),this.current=[0,0,0]}set(m){m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]||(this.current=m,this.gl.uniform3f(this.location,m[0],m[1],m[2]))}},b.c3=class extends jl{constructor(m,c){super(m,c),this.current=[0,0]}set(m){m[0]===this.current[0]&&m[1]===this.current[1]||(this.current=m,this.gl.uniform2f(this.location,m[0],m[1]))}},b.c4=Ee,b.c5=function(m,c){var f=Math.sin(c),T=Math.cos(c);return m[0]=T,m[1]=f,m[2]=0,m[3]=-f,m[4]=T,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},b.c6=function(m,c,f){var T=c[0],C=c[1],R=c[2];return m[0]=T*f[0]+C*f[3]+R*f[6],m[1]=T*f[1]+C*f[4]+R*f[7],m[2]=T*f[2]+C*f[5]+R*f[8],m},b.c7=function(m,c,f,T,C,R,z){var U=1/(c-f),X=1/(T-C),re=1/(R-z);return m[0]=-2*U,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*X,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2*re,m[11]=0,m[12]=(c+f)*U,m[13]=(C+T)*X,m[14]=(z+R)*re,m[15]=1,m},b.c8=class extends jl{constructor(m,c){super(m,c),this.current=new Array}set(m){if(m!=this.current){this.current=m;const c=new Float32Array(4*m.length);for(let f=0;f<m.length;f++)c[4*f]=m[f].r,c[4*f+1]=m[f].g,c[4*f+2]=m[f].b,c[4*f+3]=m[f].a;this.gl.uniform4fv(this.location,c)}}},b.c9=class extends jl{constructor(m,c){super(m,c),this.current=new Array}set(m){if(m!=this.current){this.current=m;const c=new Float32Array(m);this.gl.uniform1fv(this.location,c)}}},b.cA=function(m,c){return qt[c]&&"touches"in m},b.cB=function(m){return qt[m]||Ne[m]},b.cC=function(m,c,f){var T=c[0],C=c[1];return m[0]=f[0]*T+f[4]*C+f[12],m[1]=f[1]*T+f[5]*C+f[13],m},b.cD=function(m,c){const{x:f,y:T}=C0.fromLngLat(c);return!(m<0||m>25||T<0||T>=1||f<0||f>=1)},b.cE=function(m,c){return m[0]=c[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=c[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=c[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},b.cF=class extends cp{},b.cG=TI,b.cI=ii,b.cJ=function(m,c){jt.REGISTERED_PROTOCOLS[m]=c},b.cK=function(m){delete jt.REGISTERED_PROTOCOLS[m]},b.cL=function(m,c){const f={};for(let C=0;C<m.length;C++){const R=c&&c[m[C].id]||$m(m[C]);c&&(c[m[C].id]=R);let z=f[R];z||(z=f[R]=[]),z.push(m[C])}const T=[];for(const C in f)T.push(f[C]);return T},b.cM=ur,b.cN=by,b.cO=i1,b.cP=Ab,b.cQ=function(m){m.bucket.createArrays(),m.bucket.tilePixelRatio=wi/(512*m.bucket.overscaling),m.bucket.compareText={},m.bucket.iconsNeedLinear=!1;const c=m.bucket.layers[0],f=c.layout,T=c._unevaluatedLayout._values,C={layoutIconSize:T["icon-size"].possiblyEvaluate(new To(m.bucket.zoom+1),m.canonical),layoutTextSize:T["text-size"].possiblyEvaluate(new To(m.bucket.zoom+1),m.canonical),textMaxSize:T["text-size"].possiblyEvaluate(new To(18))};if(m.bucket.textSizeData.kind==="composite"){const{minZoom:re,maxZoom:ue}=m.bucket.textSizeData;C.compositeTextSizes=[T["text-size"].possiblyEvaluate(new To(re),m.canonical),T["text-size"].possiblyEvaluate(new To(ue),m.canonical)]}if(m.bucket.iconSizeData.kind==="composite"){const{minZoom:re,maxZoom:ue}=m.bucket.iconSizeData;C.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new To(re),m.canonical),T["icon-size"].possiblyEvaluate(new To(ue),m.canonical)]}const R=f.get("text-line-height")*Ss,z=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",U=f.get("text-keep-upright"),X=f.get("text-size");for(const re of m.bucket.features){const ue=f.get("text-font").evaluate(re,{},m.canonical).join(","),ve=X.evaluate(re,{},m.canonical),Ce=C.layoutTextSize.evaluate(re,{},m.canonical),Me=C.layoutIconSize.evaluate(re,{},m.canonical),ze={horizontal:{},vertical:void 0},Fe=re.text;let $e,it=[0,0];if(Fe){const gt=Fe.toString(),Vt=f.get("text-letter-spacing").evaluate(re,{},m.canonical)*Ss,Xt=Dd(gt)?Vt:0,Mi=f.get("text-anchor").evaluate(re,{},m.canonical),ln=Ry(c,re,m.canonical);if(!ln){const An=f.get("text-radial-offset").evaluate(re,{},m.canonical);it=An?K2(Mi,[An*Ss,Ly]):f.get("text-offset").evaluate(re,{},m.canonical).map((cn=>cn*Ss))}let rn=z?"center":f.get("text-justify").evaluate(re,{},m.canonical);const Sn=f.get("symbol-placement")==="point"?f.get("text-max-width").evaluate(re,{},m.canonical)*Ss:1/0,Xn=()=>{m.bucket.allowVerticalPlacement&&kd(gt)&&(ze.vertical=f_(Fe,m.glyphMap,m.glyphPositions,m.imagePositions,ue,Sn,R,Mi,"left",Xt,it,b.az.vertical,!0,Ce,ve))};if(!z&&ln){const An=new Set;if(rn==="auto")for(let Zi=0;Zi<ln.values.length;Zi+=2)An.add(tx(ln.values[Zi]));else An.add(rn);let cn=!1;for(const Zi of An)if(!ze.horizontal[Zi])if(cn)ze.horizontal[Zi]=ze.horizontal[0];else{const dr=f_(Fe,m.glyphMap,m.glyphPositions,m.imagePositions,ue,Sn,R,"center",Zi,Xt,it,b.az.horizontal,!1,Ce,ve);dr&&(ze.horizontal[Zi]=dr,cn=dr.positionedLines.length===1)}Xn()}else{rn==="auto"&&(rn=tx(Mi));const An=f_(Fe,m.glyphMap,m.glyphPositions,m.imagePositions,ue,Sn,R,Mi,rn,Xt,it,b.az.horizontal,!1,Ce,ve);An&&(ze.horizontal[rn]=An),Xn(),kd(gt)&&z&&U&&(ze.vertical=f_(Fe,m.glyphMap,m.glyphPositions,m.imagePositions,ue,Sn,R,Mi,rn,Xt,it,b.az.vertical,!1,Ce,ve))}}let zt=!1;if(re.icon&&re.icon.name){const gt=m.imageMap[re.icon.name];gt&&($e=u2(m.imagePositions[re.icon.name],f.get("icon-offset").evaluate(re,{},m.canonical),f.get("icon-anchor").evaluate(re,{},m.canonical)),zt=!!gt.sdf,m.bucket.sdfIcons===void 0?m.bucket.sdfIcons=zt:m.bucket.sdfIcons!==zt&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(gt.pixelRatio!==m.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(m.bucket.iconsNeedLinear=!0))}const lt=V0(ze.horizontal)||ze.vertical;m.bucket.iconsInText=!!lt&&lt.iconsInText,(lt||$e)&&l1(m.bucket,re,ze,$e,m.imageMap,C,Ce,Me,it,zt,m.canonical,m.subdivisionGranularity)}m.showCollisionBoxes&&m.bucket.generateCollisionDebugBuffers()},b.cR=Oe,b.cS=ni,b.cT=fs,b.cU=function(m){const c=new Go;return(function(f,T){for(const C in f.layers)T.writeMessage(3,U2,f.layers[C])})(m,c),c.finish()},b.cV=function(m,c,f,T,C,R){let z=Z2(m,c,f,C,0);return z=Z2(z,c,T,R,1),z},b.cW=class{constructor(m){this.maxEntries=m,this.map=new Map}get(m){const c=this.map.get(m);return c!==void 0&&(this.map.delete(m),this.map.set(m,c)),c}set(m,c){if(this.map.has(m))this.map.delete(m);else if(this.map.size>=this.maxEntries){const f=this.map.keys().next().value;this.map.delete(f)}this.map.set(m,c)}clear(){this.map.clear()}},b.cX=Vi,b.cY=Go,b.cZ=t1,b.c_=class{constructor(m){this._marks={start:[m.url,"start"].join("#"),end:[m.url,"end"].join("#"),measure:m.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let m=performance.getEntriesByName(this._marks.measure);return m.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),m=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),m}},b.ca=class extends Bu{},b.cb=Pr,b.cc=class extends Rd{},b.cd=Qp,b.ce=function(m){return m<=1?1:Math.pow(2,Math.ceil(Math.log(m)/Math.LN2))},b.cf=Hh,b.cg=function(m,c,f){var T=c[0],C=c[1],R=c[2],z=f[3]*T+f[7]*C+f[11]*R+f[15];return m[0]=(f[0]*T+f[4]*C+f[8]*R+f[12])/(z=z||1),m[1]=(f[1]*T+f[5]*C+f[9]*R+f[13])/z,m[2]=(f[2]*T+f[6]*C+f[10]*R+f[14])/z,m},b.ch=class extends Km{},b.ci=class extends u{},b.cj=function(m,c){return m[0]===c[0]&&m[1]===c[1]&&m[2]===c[2]&&m[3]===c[3]&&m[4]===c[4]&&m[5]===c[5]&&m[6]===c[6]&&m[7]===c[7]&&m[8]===c[8]&&m[9]===c[9]&&m[10]===c[10]&&m[11]===c[11]&&m[12]===c[12]&&m[13]===c[13]&&m[14]===c[14]&&m[15]===c[15]},b.ck=function(m,c){var f=m[0],T=m[1],C=m[2],R=m[3],z=m[4],U=m[5],X=m[6],re=m[7],ue=m[8],ve=m[9],Ce=m[10],Me=m[11],ze=m[12],Fe=m[13],$e=m[14],it=m[15],zt=c[0],lt=c[1],gt=c[2],Vt=c[3],Xt=c[4],Mi=c[5],ln=c[6],rn=c[7],Sn=c[8],Xn=c[9],An=c[10],cn=c[11],Zi=c[12],dr=c[13],or=c[14],_r=c[15];return Math.abs(f-zt)<=ye*Math.max(1,Math.abs(f),Math.abs(zt))&&Math.abs(T-lt)<=ye*Math.max(1,Math.abs(T),Math.abs(lt))&&Math.abs(C-gt)<=ye*Math.max(1,Math.abs(C),Math.abs(gt))&&Math.abs(R-Vt)<=ye*Math.max(1,Math.abs(R),Math.abs(Vt))&&Math.abs(z-Xt)<=ye*Math.max(1,Math.abs(z),Math.abs(Xt))&&Math.abs(U-Mi)<=ye*Math.max(1,Math.abs(U),Math.abs(Mi))&&Math.abs(X-ln)<=ye*Math.max(1,Math.abs(X),Math.abs(ln))&&Math.abs(re-rn)<=ye*Math.max(1,Math.abs(re),Math.abs(rn))&&Math.abs(ue-Sn)<=ye*Math.max(1,Math.abs(ue),Math.abs(Sn))&&Math.abs(ve-Xn)<=ye*Math.max(1,Math.abs(ve),Math.abs(Xn))&&Math.abs(Ce-An)<=ye*Math.max(1,Math.abs(Ce),Math.abs(An))&&Math.abs(Me-cn)<=ye*Math.max(1,Math.abs(Me),Math.abs(cn))&&Math.abs(ze-Zi)<=ye*Math.max(1,Math.abs(ze),Math.abs(Zi))&&Math.abs(Fe-dr)<=ye*Math.max(1,Math.abs(Fe),Math.abs(dr))&&Math.abs($e-or)<=ye*Math.max(1,Math.abs($e),Math.abs(or))&&Math.abs(it-_r)<=ye*Math.max(1,Math.abs(it),Math.abs(_r))},b.cl=function(m,c){return m[0]=c[0],m[1]=c[1],m[2]=c[2],m[3]=c[3],m[4]=c[4],m[5]=c[5],m[6]=c[6],m[7]=c[7],m[8]=c[8],m[9]=c[9],m[10]=c[10],m[11]=c[11],m[12]=c[12],m[13]=c[13],m[14]=c[14],m[15]=c[15],m},b.cm=m=>m.type==="symbol",b.cn=m=>m.type==="circle",b.co=m=>m.type==="heatmap",b.cp=m=>m.type==="line",b.cq=m=>m.type==="fill",b.cr=m=>m.type==="fill-extrusion",b.cs=m=>m.type==="hillshade",b.ct=m=>m.type==="color-relief",b.cu=m=>m.type==="background",b.cv=m=>m.type==="custom",b.cw=mr,b.cx=function(m,c,f){const T=vt(c.x-f.x,c.y-f.y),C=vt(m.x-f.x,m.y-f.y),R=Math.atan2(T[0]*C[1]-T[1]*C[0],(function(z,U){return z[0]*U[0]+z[1]*U[1]})(T,C));return Ii(R)},b.cy=Sr,b.cz=function(m,c){return Ne[c]&&(m instanceof MouseEvent||m instanceof WheelEvent)},b.d=nn,b.d0=my,b.d1=O,b.d2=class{constructor(m,c){this.layers={[Df]:this},this.name=Df,this.version=c?c.version:1,this.extent=c?c.extent:4096,this.length=m.length,this.features=m}feature(m){return new j2(this.features[m],this.extent)}},b.d3=hf,b.d4=Ou,b.e=sn,b.f=m=>t(void 0,void 0,void 0,(function*(){if(m.byteLength===0)return createImageBitmap(new ImageData(1,1));const c=new Blob([new Uint8Array(m)],{type:"image/png"});try{return createImageBitmap(c)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),b.g=bi,b.h=m=>new Promise(((c,f)=>{const T=new Image;T.onload=()=>{c(T),URL.revokeObjectURL(T.src),T.onload=null,window.requestAnimationFrame((()=>{T.src=Ot}))},T.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(m)],{type:"image/png"});T.src=m.byteLength?URL.createObjectURL(C):Ot})),b.i=hn,b.j=(m,c)=>un(sn(m,{type:"json"}),c),b.k=xo,b.l=Gr,b.m=un,b.n=(m,c)=>un(sn(m,{type:"arrayBuffer"}),c),b.o=function(m){return new Go(m).readFields(hg,[])},b.p=xh,b.q=function(m){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(m))},b.r=pp,b.s=Hi,b.t=Nl,b.u=mi,b.v=jh,b.w=Gt,b.x=Kg,b.y=mf,b.z=lp})),p("worker",["./shared"],(function(b){class t{constructor(Ne,Ge){this.keyCache={},Ne&&this.replace(Ne,Ge)}replace(Ne,Ge){this._layerConfigs={},this._layers={},this.update(Ne,[],Ge)}update(Ne,Ge,Ke){for(const jt of Ne){this._layerConfigs[jt.id]=jt;const bi=this._layers[jt.id]=b.bT(jt,Ke);bi._featureFilter=b.aj(bi.filter,Ke),this.keyCache[jt.id]&&delete this.keyCache[jt.id]}for(const jt of Ge)delete this.keyCache[jt],delete this._layerConfigs[jt],delete this._layers[jt];this.familiesBySource={};const At=b.cL(Object.values(this._layerConfigs),this.keyCache);for(const jt of At){const bi=jt.map((Zn=>this._layers[Zn.id])),gi=bi[0];if(gi.isHidden())continue;const ii=gi.source||"";let Ci=this.familiesBySource[ii];Ci||(Ci=this.familiesBySource[ii]={});const un=gi.sourceLayer||b.ai;let nn=Ci[un];nn||(nn=Ci[un]=[]),nn.push(bi)}}}class P{constructor(Ne){const Ge={},Ke=[];for(const gi in Ne){const ii=Ne[gi],Ci=Ge[gi]={};for(const un in ii){const nn=ii[+un];if(!nn||nn.bitmap.width===0||nn.bitmap.height===0)continue;const Zn={x:0,y:0,w:nn.bitmap.width+2,h:nn.bitmap.height+2};Ke.push(Zn),Ci[un]={rect:Zn,metrics:nn.metrics}}}const{w:At,h:jt}=b.p(Ke),bi=new b.r({width:At||1,height:jt||1});for(const gi in Ne){const ii=Ne[gi];for(const Ci in ii){const un=ii[+Ci];if(!un||un.bitmap.width===0||un.bitmap.height===0)continue;const nn=Ge[gi][Ci].rect;b.r.copy(un.bitmap,bi,{x:0,y:0},{x:nn.x+1,y:nn.y+1},un.bitmap)}}this.image=bi,this.positions=Ge}}b.cM("GlyphAtlas",P);class O{constructor(Ne){this.tileID=new b.a2(Ne.tileID.overscaledZ,Ne.tileID.wrap,Ne.tileID.canonical.z,Ne.tileID.canonical.x,Ne.tileID.canonical.y),this.uid=Ne.uid,this.zoom=Ne.zoom,this.pixelRatio=Ne.pixelRatio,this.tileSize=Ne.tileSize,this.source=Ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ne.showCollisionBoxes,this.collectResourceTiming=!!Ne.collectResourceTiming,this.returnDependencies=!!Ne.returnDependencies,this.promoteId=Ne.promoteId,this.inFlightDependencies=[]}parse(Ne,Ge,Ke,At,jt){return b._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Ne,this.collisionBoxArray=new b.ag;const bi=new b.cN(Object.keys(Ne.layers).sort()),gi=new b.cO(this.tileID,this.promoteId);gi.bucketLayerIDs=[];const ii={},Ci={featureIndex:gi,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Ke,subdivisionGranularity:jt},un=Ge.familiesBySource[this.source];for(const Bo in un){const sa=Ne.layers[Bo];if(!sa)continue;sa.version===1&&b.w(`Vector tile source "${this.source}" layer "${Bo}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ns=bi.encode(Bo),Ja=[];for(let Mn=0;Mn<sa.length;Mn++){const Qa=sa.feature(Mn),gl=gi.getId(Qa,Bo);Ja.push({feature:Qa,id:gl,index:Mn,sourceLayerIndex:ns})}for(const Mn of un[Bo]){const Qa=Mn[0];Qa.source!==this.source&&b.w(`layer.source = ${Qa.source} does not equal this.source = ${this.source}`),Qa.isHidden(this.zoom,!0)||(F(Mn,this.zoom,Ke),(ii[Qa.id]=Qa.createBucket({index:gi.bucketLayerIDs.length,layers:Mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ns,sourceID:this.source})).populate(Ja,Ci,this.tileID.canonical),gi.bucketLayerIDs.push(Mn.map((gl=>gl.id))))}}const nn=b.bY(Ci.glyphDependencies,(Bo=>Object.keys(Bo).map(Number)));this.inFlightDependencies.forEach((Bo=>Bo?.abort())),this.inFlightDependencies=[];let Zn=Promise.resolve({});if(Object.keys(nn).length){const Bo=new AbortController;this.inFlightDependencies.push(Bo),Zn=At.sendAsync({type:"GG",data:{stacks:nn,source:this.source,tileID:this.tileID,type:"glyphs"}},Bo)}const fr=Object.keys(Ci.iconDependencies);let Gr=Promise.resolve({});if(fr.length){const Bo=new AbortController;this.inFlightDependencies.push(Bo),Gr=At.sendAsync({type:"GI",data:{icons:fr,source:this.source,tileID:this.tileID,type:"icons"}},Bo)}const xo=Object.keys(Ci.patternDependencies);let Js=Promise.resolve({});if(xo.length){const Bo=new AbortController;this.inFlightDependencies.push(Bo),Js=At.sendAsync({type:"GI",data:{icons:xo,source:this.source,tileID:this.tileID,type:"patterns"}},Bo)}const mi=Ci.dashDependencies;let bs=Promise.resolve({});if(Object.keys(mi).length){const Bo=new AbortController;this.inFlightDependencies.push(Bo),bs=At.sendAsync({type:"GDA",data:{dashes:mi}},Bo)}const[al,is,Hs,ll]=yield Promise.all([Zn,Gr,Js,bs]),yi=new P(al),Ao=new b.cP(is,Hs);for(const Bo in ii){const sa=ii[Bo];sa instanceof b.ah?(F(sa.layers,this.zoom,Ke),b.cQ({bucket:sa,glyphMap:al,glyphPositions:yi.positions,imageMap:is,imagePositions:Ao.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ci.subdivisionGranularity})):sa.hasDependencies&&(sa instanceof b.cR||sa instanceof b.cS||sa instanceof b.cT)&&(F(sa.layers,this.zoom,Ke),sa.addFeatures(Ci,this.tileID.canonical,Ao.patternPositions,ll))}return this.status="done",{buckets:Object.values(ii).filter((Bo=>!Bo.isEmpty())),featureIndex:gi,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yi.image,imageAtlas:Ao,dashPositions:ll,glyphMap:this.returnDependencies?al:null,iconMap:this.returnDependencies?is:null,glyphPositions:this.returnDependencies?yi.positions:null}}))}}function F(qt,Ne,Ge){const Ke=new b.H(Ne);for(const At of qt)At.recalculate(Ke,Ge)}class ${constructor(Ne,Ge,Ke,At,jt){this.type=Ne,this.properties=Ke||{},this.extent=jt,this.pointsArray=Ge,this.id=At}loadGeometry(){return this.pointsArray.map((Ne=>Ne.map((Ge=>new b.P(Ge.x,Ge.y)))))}}class W{constructor(Ne,Ge,Ke){this.version=2,this._myFeatures=Ne,this.name=Ge,this.length=Ne.length,this.extent=Ke}feature(Ne){return this._myFeatures[Ne]}}class Y{constructor(){this.layers={}}addLayer(Ne){this.layers[Ne.name]=Ne}}function ae(qt){let Ne=b.cU(qt);return Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),{vectorTile:qt,rawData:Ne.buffer}}function se(qt,Ne,Ge){const{extent:Ke}=qt,At=Math.pow(2,Ge.z-Ne.z),jt=(Ge.x-Ne.x*At)*Ke,bi=(Ge.y-Ne.y*At)*Ke,gi=[];for(let ii=0;ii<qt.length;ii++){const Ci=qt.feature(ii);let un=Ci.loadGeometry();for(const Zn of un)for(const fr of Zn)fr.x=fr.x*At-jt,fr.y=fr.y*At-bi;const nn=128;un=b.cV(un,Ci.type,-nn,-nn,Ke+nn,Ke+nn),un.length!==0&&gi.push(new $(Ci.type,un,Ci.properties,Ci.id,Ke))}return new W(gi,qt.name,Ke)}class ie{constructor(Ne,Ge,Ke){this.actor=Ne,this.layerIndex=Ge,this.availableImages=Ke,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new b.cW(1e3)}loadVectorTile(Ne,Ge){return b._(this,void 0,void 0,(function*(){const Ke=yield b.n(Ne.request,Ge);try{return{vectorTile:Ne.encoding!=="mlt"?new b.cX(new b.cY(Ke.data)):new b.cZ(Ke.data),rawData:Ke.data,cacheControl:Ke.cacheControl,expires:Ke.expires}}catch(At){const jt=new Uint8Array(Ke.data);let bi=`Unable to parse the tile at ${Ne.request.url}, `;throw bi+=jt[0]===31&&jt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${At.message}`,new Error(bi)}}))}loadTile(Ne){return b._(this,void 0,void 0,(function*(){const{uid:Ge,overzoomParameters:Ke}=Ne;Ke&&(Ne.request=Ke.overzoomRequest);const At=!!(Ne&&Ne.request&&Ne.request.collectResourceTiming)&&new b.c_(Ne.request),jt=new O(Ne);this.loading[Ge]=jt;const bi=new AbortController;jt.abort=bi;try{const gi=yield this.loadVectorTile(Ne,bi);if(delete this.loading[Ge],!gi)return null;if(Ke){const Zn=this._getOverzoomTile(Ne,gi.vectorTile);gi.rawData=Zn.rawData,gi.vectorTile=Zn.vectorTile}const ii=gi.rawData,Ci={};gi.expires&&(Ci.expires=gi.expires),gi.cacheControl&&(Ci.cacheControl=gi.cacheControl);const un={};if(At){const Zn=At.finish();Zn&&(un.resourceTiming=JSON.parse(JSON.stringify(Zn)))}jt.vectorTile=gi.vectorTile;const nn=jt.parse(gi.vectorTile,this.layerIndex,this.availableImages,this.actor,Ne.subdivisionGranularity);this.loaded[Ge]=jt,this.fetching[Ge]={rawTileData:ii,cacheControl:Ci,resourceTiming:un};try{const Zn=yield nn;return b.e({rawTileData:ii.slice(0),encoding:Ne.encoding},Zn,Ci,un)}finally{delete this.fetching[Ge]}}catch(gi){throw delete this.loading[Ge],jt.status="done",this.loaded[Ge]=jt,gi}}))}_getOverzoomTile(Ne,Ge){const{tileID:Ke,source:At,overzoomParameters:jt}=Ne,{maxZoomTileID:bi}=jt,gi=`${bi.key}_${Ke.key}`,ii=this.overzoomedTileResultCache.get(gi);if(ii)return ii;const Ci=new Y,un=this.layerIndex.familiesBySource[At];for(const Zn in un){const fr=Ge.layers[Zn];if(!fr)continue;const Gr=se(fr,bi,Ke.canonical);Gr.length>0&&Ci.addLayer(Gr)}const nn=ae(Ci);return this.overzoomedTileResultCache.set(gi,nn),nn}reloadTile(Ne){return b._(this,void 0,void 0,(function*(){const Ge=Ne.uid;if(!this.loaded||!this.loaded[Ge])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Ke=this.loaded[Ge];if(Ke.showCollisionBoxes=Ne.showCollisionBoxes,Ke.status==="parsing"){const At=yield Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,Ne.subdivisionGranularity);let jt;if(this.fetching[Ge]){const{rawTileData:bi,cacheControl:gi,resourceTiming:ii}=this.fetching[Ge];delete this.fetching[Ge],jt=b.e({rawTileData:bi.slice(0),encoding:Ne.encoding},At,gi,ii)}else jt=At;return jt}if(Ke.status==="done"&&Ke.vectorTile)return Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,Ne.subdivisionGranularity)}))}abortTile(Ne){return b._(this,void 0,void 0,(function*(){const Ge=this.loading,Ke=Ne.uid;Ge&&Ge[Ke]&&Ge[Ke].abort&&(Ge[Ke].abort.abort(),delete Ge[Ke])}))}removeTile(Ne){return b._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Ne.uid]&&delete this.loaded[Ne.uid]}))}}class pe{constructor(){this.loaded={}}loadTile(Ne){return b._(this,void 0,void 0,(function*(){const{uid:Ge,encoding:Ke,rawImageData:At,redFactor:jt,greenFactor:bi,blueFactor:gi,baseShift:ii}=Ne,Ci=At.width+2,un=At.height+2,nn=b.b(At)?new b.R({width:Ci,height:un},yield b.c$(At,-1,-1,Ci,un)):At,Zn=new b.d0(Ge,nn,Ke,jt,bi,gi,ii);return this.loaded=this.loaded||{},this.loaded[Ge]=Zn,Zn}))}removeTile(Ne){const Ge=this.loaded,Ke=Ne.uid;Ge&&Ge[Ke]&&delete Ge[Ke]}}var ye,de,Ee=(function(){if(de)return ye;function qt(Ge,Ke){if(Ge.length!==0){Ne(Ge[0],Ke);for(var At=1;At<Ge.length;At++)Ne(Ge[At],!Ke)}}function Ne(Ge,Ke){for(var At=0,jt=0,bi=0,gi=Ge.length,ii=gi-1;bi<gi;ii=bi++){var Ci=(Ge[bi][0]-Ge[ii][0])*(Ge[ii][1]+Ge[bi][1]),un=At+Ci;jt+=Math.abs(At)>=Math.abs(Ci)?At-un+Ci:Ci-un+At,At=un}At+jt>=0!=!!Ke&&Ge.reverse()}return de=1,ye=function Ge(Ke,At){var jt,bi=Ke&&Ke.type;if(bi==="FeatureCollection")for(jt=0;jt<Ke.features.length;jt++)Ge(Ke.features[jt],At);else if(bi==="GeometryCollection")for(jt=0;jt<Ke.geometries.length;jt++)Ge(Ke.geometries[jt],At);else if(bi==="Feature")Ge(Ke.geometry,At);else if(bi==="Polygon")qt(Ke.coordinates,At);else if(bi==="MultiPolygon")for(jt=0;jt<Ke.coordinates.length;jt++)qt(Ke.coordinates[jt],At);return Ke}})(),Pe=b.d1(Ee);const Ze={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qt=>qt},We=Math.fround||(je=new Float32Array(1),qt=>(je[0]=+qt,je[0]));var je;class Ye{constructor(Ne){this.options=Object.assign(Object.create(Ze),Ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ne){const{log:Ge,minZoom:Ke,maxZoom:At}=this.options;Ge&&console.time("total time");const jt=`prepare ${Ne.length} points`;Ge&&console.time(jt),this.points=Ne;const bi=[];for(let ii=0;ii<Ne.length;ii++){const Ci=Ne[ii];if(!Ci.geometry)continue;const[un,nn]=Ci.geometry.coordinates,Zn=We(Ht(un)),fr=We(ci(nn));bi.push(Zn,fr,1/0,ii,-1,1),this.options.reduce&&bi.push(0)}let gi=this.trees[At+1]=this._createTree(bi);Ge&&console.timeEnd(jt);for(let ii=At;ii>=Ke;ii--){const Ci=+Date.now();gi=this.trees[ii]=this._createTree(this._cluster(gi,ii)),Ge&&console.log("z%d: %d clusters in %dms",ii,gi.numItems,+Date.now()-Ci)}return Ge&&console.timeEnd("total time"),this}getClusters(Ne,Ge){let Ke=((Ne[0]+180)%360+360)%360-180;const At=Math.max(-90,Math.min(90,Ne[1]));let jt=Ne[2]===180?180:((Ne[2]+180)%360+360)%360-180;const bi=Math.max(-90,Math.min(90,Ne[3]));if(Ne[2]-Ne[0]>=360)Ke=-180,jt=180;else if(Ke>jt){const nn=this.getClusters([Ke,At,180,bi],Ge),Zn=this.getClusters([-180,At,jt,bi],Ge);return nn.concat(Zn)}const gi=this.trees[this._limitZoom(Ge)],ii=gi.range(Ht(Ke),ci(bi),Ht(jt),ci(At)),Ci=gi.data,un=[];for(const nn of ii){const Zn=this.stride*nn;un.push(Ci[Zn+5]>1?ct(Ci,Zn,this.clusterProps):this.points[Ci[Zn+3]])}return un}getChildren(Ne){const Ge=this._getOriginId(Ne),Ke=this._getOriginZoom(Ne),At="No cluster with the specified id.",jt=this.trees[Ke];if(!jt)throw new Error(At);const bi=jt.data;if(Ge*this.stride>=bi.length)throw new Error(At);const gi=this.options.radius/(this.options.extent*Math.pow(2,Ke-1)),ii=jt.within(bi[Ge*this.stride],bi[Ge*this.stride+1],gi),Ci=[];for(const un of ii){const nn=un*this.stride;bi[nn+4]===Ne&&Ci.push(bi[nn+5]>1?ct(bi,nn,this.clusterProps):this.points[bi[nn+3]])}if(Ci.length===0)throw new Error(At);return Ci}getLeaves(Ne,Ge,Ke){const At=[];return this._appendLeaves(At,Ne,Ge=Ge||10,Ke=Ke||0,0),At}getTile(Ne,Ge,Ke){const At=this.trees[this._limitZoom(Ne)],jt=Math.pow(2,Ne),{extent:bi,radius:gi}=this.options,ii=gi/bi,Ci=(Ke-ii)/jt,un=(Ke+1+ii)/jt,nn={features:[]};return this._addTileFeatures(At.range((Ge-ii)/jt,Ci,(Ge+1+ii)/jt,un),At.data,Ge,Ke,jt,nn),Ge===0&&this._addTileFeatures(At.range(1-ii/jt,Ci,1,un),At.data,jt,Ke,jt,nn),Ge===jt-1&&this._addTileFeatures(At.range(0,Ci,ii/jt,un),At.data,-1,Ke,jt,nn),nn.features.length?nn:null}getClusterExpansionZoom(Ne){let Ge=this._getOriginZoom(Ne)-1;for(;Ge<=this.options.maxZoom;){const Ke=this.getChildren(Ne);if(Ge++,Ke.length!==1)break;Ne=Ke[0].properties.cluster_id}return Ge}_appendLeaves(Ne,Ge,Ke,At,jt){const bi=this.getChildren(Ge);for(const gi of bi){const ii=gi.properties;if(ii&&ii.cluster?jt+ii.point_count<=At?jt+=ii.point_count:jt=this._appendLeaves(Ne,ii.cluster_id,Ke,At,jt):jt<At?jt++:Ne.push(gi),Ne.length===Ke)break}return jt}_createTree(Ne){const Ge=new b.aT(Ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ke=0;Ke<Ne.length;Ke+=this.stride)Ge.add(Ne[Ke],Ne[Ke+1]);return Ge.finish(),Ge.data=Ne,Ge}_addTileFeatures(Ne,Ge,Ke,At,jt,bi){for(const gi of Ne){const ii=gi*this.stride,Ci=Ge[ii+5]>1;let un,nn,Zn;if(Ci)un=Lt(Ge,ii,this.clusterProps),nn=Ge[ii],Zn=Ge[ii+1];else{const xo=this.points[Ge[ii+3]];un=xo.properties;const[Js,mi]=xo.geometry.coordinates;nn=Ht(Js),Zn=ci(mi)}const fr={type:1,geometry:[[Math.round(this.options.extent*(nn*jt-Ke)),Math.round(this.options.extent*(Zn*jt-At))]],tags:un};let Gr;Gr=Ci||this.options.generateId?Ge[ii+3]:this.points[Ge[ii+3]].id,Gr!==void 0&&(fr.id=Gr),bi.features.push(fr)}}_limitZoom(Ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ne),this.options.maxZoom+1))}_cluster(Ne,Ge){const{radius:Ke,extent:At,reduce:jt,minPoints:bi}=this.options,gi=Ke/(At*Math.pow(2,Ge)),ii=Ne.data,Ci=[],un=this.stride;for(let nn=0;nn<ii.length;nn+=un){if(ii[nn+2]<=Ge)continue;ii[nn+2]=Ge;const Zn=ii[nn],fr=ii[nn+1],Gr=Ne.within(ii[nn],ii[nn+1],gi),xo=ii[nn+5];let Js=xo;for(const mi of Gr){const bs=mi*un;ii[bs+2]>Ge&&(Js+=ii[bs+5])}if(Js>xo&&Js>=bi){let mi,bs=Zn*xo,al=fr*xo,is=-1;const Hs=(nn/un<<5)+(Ge+1)+this.points.length;for(const ll of Gr){const yi=ll*un;if(ii[yi+2]<=Ge)continue;ii[yi+2]=Ge;const Ao=ii[yi+5];bs+=ii[yi]*Ao,al+=ii[yi+1]*Ao,ii[yi+4]=Hs,jt&&(mi||(mi=this._map(ii,nn,!0),is=this.clusterProps.length,this.clusterProps.push(mi)),jt(mi,this._map(ii,yi)))}ii[nn+4]=Hs,Ci.push(bs/Js,al/Js,1/0,Hs,-1,Js),jt&&Ci.push(is)}else{for(let mi=0;mi<un;mi++)Ci.push(ii[nn+mi]);if(Js>1)for(const mi of Gr){const bs=mi*un;if(!(ii[bs+2]<=Ge)){ii[bs+2]=Ge;for(let al=0;al<un;al++)Ci.push(ii[bs+al])}}}}return Ci}_getOriginId(Ne){return Ne-this.points.length>>5}_getOriginZoom(Ne){return(Ne-this.points.length)%32}_map(Ne,Ge,Ke){if(Ne[Ge+5]>1){const bi=this.clusterProps[Ne[Ge+6]];return Ke?Object.assign({},bi):bi}const At=this.points[Ne[Ge+3]].properties,jt=this.options.map(At);return Ke&&jt===At?Object.assign({},jt):jt}}function ct(qt,Ne,Ge){return{type:"Feature",id:qt[Ne+3],properties:Lt(qt,Ne,Ge),geometry:{type:"Point",coordinates:[(Ke=qt[Ne],360*(Ke-.5)),Wt(qt[Ne+1])]}};var Ke}function Lt(qt,Ne,Ge){const Ke=qt[Ne+5],At=Ke>=1e4?`${Math.round(Ke/1e3)}k`:Ke>=1e3?Math.round(Ke/100)/10+"k":Ke,jt=qt[Ne+6],bi=jt===-1?{}:Object.assign({},Ge[jt]);return Object.assign(bi,{cluster:!0,cluster_id:qt[Ne+3],point_count:Ke,point_count_abbreviated:At})}function Ht(qt){return qt/360+.5}function ci(qt){const Ne=Math.sin(qt*Math.PI/180),Ge=.5-.25*Math.log((1+Ne)/(1-Ne))/Math.PI;return Ge<0?0:Ge>1?1:Ge}function Wt(qt){const Ne=(180-360*qt)*Math.PI/180;return 360*Math.atan(Math.exp(Ne))/Math.PI-90}function $t(qt,Ne,Ge,Ke){let At=Ke;const jt=Ne+(Ge-Ne>>1);let bi,gi=Ge-Ne;const ii=qt[Ne],Ci=qt[Ne+1],un=qt[Ge],nn=qt[Ge+1];for(let Zn=Ne+3;Zn<Ge;Zn+=3){const fr=Dt(qt[Zn],qt[Zn+1],ii,Ci,un,nn);if(fr>At)bi=Zn,At=fr;else if(fr===At){const Gr=Math.abs(Zn-jt);Gr<gi&&(bi=Zn,gi=Gr)}}At>Ke&&(bi-Ne>3&&$t(qt,Ne,bi,Ke),qt[bi+2]=At,Ge-bi>3&&$t(qt,bi,Ge,Ke))}function Dt(qt,Ne,Ge,Ke,At,jt){let bi=At-Ge,gi=jt-Ke;if(bi!==0||gi!==0){const ii=((qt-Ge)*bi+(Ne-Ke)*gi)/(bi*bi+gi*gi);ii>1?(Ge=At,Ke=jt):ii>0&&(Ge+=bi*ii,Ke+=gi*ii)}return bi=qt-Ge,gi=Ne-Ke,bi*bi+gi*gi}function Ft(qt,Ne,Ge,Ke){const At={id:qt??null,type:Ne,geometry:Ge,tags:Ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")vt(At,Ge);else if(Ne==="Polygon")vt(At,Ge[0]);else if(Ne==="MultiLineString")for(const jt of Ge)vt(At,jt);else if(Ne==="MultiPolygon")for(const jt of Ge)vt(At,jt[0]);return At}function vt(qt,Ne){for(let Ge=0;Ge<Ne.length;Ge+=3)qt.minX=Math.min(qt.minX,Ne[Ge]),qt.minY=Math.min(qt.minY,Ne[Ge+1]),qt.maxX=Math.max(qt.maxX,Ne[Ge]),qt.maxY=Math.max(qt.maxY,Ne[Ge+1])}function wi(qt,Ne,Ge,Ke){if(!Ne.geometry)return;const At=Ne.geometry.coordinates;if(At&&At.length===0)return;const jt=Ne.geometry.type,bi=Math.pow(Ge.tolerance/((1<<Ge.maxZoom)*Ge.extent),2);let gi=[],ii=Ne.id;if(Ge.promoteId?ii=Ne.properties[Ge.promoteId]:Ge.generateId&&(ii=Ke||0),jt==="Point")Qi(At,gi);else if(jt==="MultiPoint")for(const Ci of At)Qi(Ci,gi);else if(jt==="LineString")wn(At,gi,bi,!1);else if(jt==="MultiLineString"){if(Ge.lineMetrics){for(const Ci of At)gi=[],wn(Ci,gi,bi,!1),qt.push(Ft(ii,"LineString",gi,Ne.properties));return}qn(At,gi,bi,!1)}else if(jt==="Polygon")qn(At,gi,bi,!0);else{if(jt!=="MultiPolygon"){if(jt==="GeometryCollection"){for(const Ci of Ne.geometry.geometries)wi(qt,{id:ii,geometry:Ci,properties:Ne.properties},Ge,Ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ci of At){const un=[];qn(Ci,un,bi,!0),gi.push(un)}}qt.push(Ft(ii,jt,gi,Ne.properties))}function Qi(qt,Ne){Ne.push(Fn(qt[0]),mr(qt[1]),0)}function wn(qt,Ne,Ge,Ke){let At,jt,bi=0;for(let ii=0;ii<qt.length;ii++){const Ci=Fn(qt[ii][0]),un=mr(qt[ii][1]);Ne.push(Ci,un,0),ii>0&&(bi+=Ke?(At*un-Ci*jt)/2:Math.sqrt(Math.pow(Ci-At,2)+Math.pow(un-jt,2))),At=Ci,jt=un}const gi=Ne.length-3;Ne[2]=1,$t(Ne,0,gi,Ge),Ne[gi+2]=1,Ne.size=Math.abs(bi),Ne.start=0,Ne.end=Ne.size}function qn(qt,Ne,Ge,Ke){for(let At=0;At<qt.length;At++){const jt=[];wn(qt[At],jt,Ge,Ke),Ne.push(jt)}}function Fn(qt){return qt/360+.5}function mr(qt){const Ne=Math.sin(qt*Math.PI/180),Ge=.5-.25*Math.log((1+Ne)/(1-Ne))/Math.PI;return Ge<0?0:Ge>1?1:Ge}function Sr(qt,Ne,Ge,Ke,At,jt,bi,gi){if(Ke/=Ne,jt>=(Ge/=Ne)&&bi<Ke)return qt;if(bi<Ge||jt>=Ke)return null;const ii=[];for(const Ci of qt){const un=Ci.geometry;let nn=Ci.type;const Zn=At===0?Ci.minX:Ci.minY,fr=At===0?Ci.maxX:Ci.maxY;if(Zn>=Ge&&fr<Ke){ii.push(Ci);continue}if(fr<Ge||Zn>=Ke)continue;let Gr=[];if(nn==="Point"||nn==="MultiPoint")Hr(un,Gr,Ge,Ke,At);else if(nn==="LineString")ti(un,Gr,Ge,Ke,At,!1,gi.lineMetrics);else if(nn==="MultiLineString")Gi(un,Gr,Ge,Ke,At,!1);else if(nn==="Polygon")Gi(un,Gr,Ge,Ke,At,!0);else if(nn==="MultiPolygon")for(const xo of un){const Js=[];Gi(xo,Js,Ge,Ke,At,!0),Js.length&&Gr.push(Js)}if(Gr.length){if(gi.lineMetrics&&nn==="LineString"){for(const xo of Gr)ii.push(Ft(Ci.id,nn,xo,Ci.tags));continue}nn!=="LineString"&&nn!=="MultiLineString"||(Gr.length===1?(nn="LineString",Gr=Gr[0]):nn="MultiLineString"),nn!=="Point"&&nn!=="MultiPoint"||(nn=Gr.length===3?"Point":"MultiPoint"),ii.push(Ft(Ci.id,nn,Gr,Ci.tags))}}return ii.length?ii:null}function Hr(qt,Ne,Ge,Ke,At){for(let jt=0;jt<qt.length;jt+=3){const bi=qt[jt+At];bi>=Ge&&bi<=Ke&&gn(Ne,qt[jt],qt[jt+1],qt[jt+2])}}function ti(qt,Ne,Ge,Ke,At,jt,bi){let gi=sn(qt);const ii=At===0?nr:Ur;let Ci,un,nn=qt.start;for(let Js=0;Js<qt.length-3;Js+=3){const mi=qt[Js],bs=qt[Js+1],al=qt[Js+2],is=qt[Js+3],Hs=qt[Js+4],ll=At===0?mi:bs,yi=At===0?is:Hs;let Ao=!1;bi&&(Ci=Math.sqrt(Math.pow(mi-is,2)+Math.pow(bs-Hs,2))),ll<Ge?yi>Ge&&(un=ii(gi,mi,bs,is,Hs,Ge),bi&&(gi.start=nn+Ci*un)):ll>Ke?yi<Ke&&(un=ii(gi,mi,bs,is,Hs,Ke),bi&&(gi.start=nn+Ci*un)):gn(gi,mi,bs,al),yi<Ge&&ll>=Ge&&(un=ii(gi,mi,bs,is,Hs,Ge),Ao=!0),yi>Ke&&ll<=Ke&&(un=ii(gi,mi,bs,is,Hs,Ke),Ao=!0),!jt&&Ao&&(bi&&(gi.end=nn+Ci*un),Ne.push(gi),gi=sn(qt)),bi&&(nn+=Ci)}let Zn=qt.length-3;const fr=qt[Zn],Gr=qt[Zn+1],xo=At===0?fr:Gr;xo>=Ge&&xo<=Ke&&gn(gi,fr,Gr,qt[Zn+2]),Zn=gi.length-3,jt&&Zn>=3&&(gi[Zn]!==gi[0]||gi[Zn+1]!==gi[1])&&gn(gi,gi[0],gi[1],gi[2]),gi.length&&Ne.push(gi)}function sn(qt){const Ne=[];return Ne.size=qt.size,Ne.start=qt.start,Ne.end=qt.end,Ne}function Gi(qt,Ne,Ge,Ke,At,jt){for(const bi of qt)ti(bi,Ne,Ge,Ke,At,jt,!1)}function gn(qt,Ne,Ge,Ke){qt.push(Ne,Ge,Ke)}function nr(qt,Ne,Ge,Ke,At,jt){const bi=(jt-Ne)/(Ke-Ne);return gn(qt,jt,Ge+(At-Ge)*bi,1),bi}function Ur(qt,Ne,Ge,Ke,At,jt){const bi=(jt-Ge)/(At-Ge);return gn(qt,Ne+(Ke-Ne)*bi,jt,1),bi}function St(qt,Ne){const Ge=[];for(let Ke=0;Ke<qt.length;Ke++){const At=qt[Ke],jt=At.type;let bi;if(jt==="Point"||jt==="MultiPoint"||jt==="LineString")bi=Gt(At.geometry,Ne);else if(jt==="MultiLineString"||jt==="Polygon"){bi=[];for(const gi of At.geometry)bi.push(Gt(gi,Ne))}else if(jt==="MultiPolygon"){bi=[];for(const gi of At.geometry){const ii=[];for(const Ci of gi)ii.push(Gt(Ci,Ne));bi.push(ii)}}Ge.push(Ft(At.id,jt,bi,At.tags))}return Ge}function Gt(qt,Ne){const Ge=[];Ge.size=qt.size,qt.start!==void 0&&(Ge.start=qt.start,Ge.end=qt.end);for(let Ke=0;Ke<qt.length;Ke+=3)Ge.push(qt[Ke]+Ne,qt[Ke+1],qt[Ke+2]);return Ge}function Ai(qt,Ne){if(qt.transformed)return qt;const Ge=1<<qt.z,Ke=qt.x,At=qt.y;for(const jt of qt.features){const bi=jt.geometry,gi=jt.type;if(jt.geometry=[],gi===1)for(let ii=0;ii<bi.length;ii+=2)jt.geometry.push(hn(bi[ii],bi[ii+1],Ne,Ge,Ke,At));else for(let ii=0;ii<bi.length;ii++){const Ci=[];for(let un=0;un<bi[ii].length;un+=2)Ci.push(hn(bi[ii][un],bi[ii][un+1],Ne,Ge,Ke,At));jt.geometry.push(Ci)}}return qt.transformed=!0,qt}function hn(qt,Ne,Ge,Ke,At,jt){return[Math.round(Ge*(qt*Ke-At)),Math.round(Ge*(Ne*Ke-jt))]}function Ui(qt,Ne,Ge,Ke,At){const jt=Ne===At.maxZoom?0:At.tolerance/((1<<Ne)*At.extent),bi={features:[],numPoints:0,numSimplified:0,numFeatures:qt.length,source:null,x:Ge,y:Ke,z:Ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const gi of qt)pt(bi,gi,jt,At);return bi}function pt(qt,Ne,Ge,Ke){const At=Ne.geometry,jt=Ne.type,bi=[];if(qt.minX=Math.min(qt.minX,Ne.minX),qt.minY=Math.min(qt.minY,Ne.minY),qt.maxX=Math.max(qt.maxX,Ne.maxX),qt.maxY=Math.max(qt.maxY,Ne.maxY),jt==="Point"||jt==="MultiPoint")for(let gi=0;gi<At.length;gi+=3)bi.push(At[gi],At[gi+1]),qt.numPoints++,qt.numSimplified++;else if(jt==="LineString")Ot(bi,At,qt,Ge,!1,!1);else if(jt==="MultiLineString"||jt==="Polygon")for(let gi=0;gi<At.length;gi++)Ot(bi,At[gi],qt,Ge,jt==="Polygon",gi===0);else if(jt==="MultiPolygon")for(let gi=0;gi<At.length;gi++){const ii=At[gi];for(let Ci=0;Ci<ii.length;Ci++)Ot(bi,ii[Ci],qt,Ge,!0,Ci===0)}if(bi.length){let gi=Ne.tags||null;if(jt==="LineString"&&Ke.lineMetrics){gi={};for(const Ci in Ne.tags)gi[Ci]=Ne.tags[Ci];gi.mapbox_clip_start=At.start/At.size,gi.mapbox_clip_end=At.end/At.size}const ii={geometry:bi,type:jt==="Polygon"||jt==="MultiPolygon"?3:jt==="LineString"||jt==="MultiLineString"?2:1,tags:gi};Ne.id!==null&&(ii.id=Ne.id),qt.features.push(ii)}}function Ot(qt,Ne,Ge,Ke,At,jt){const bi=Ke*Ke;if(Ke>0&&Ne.size<(At?bi:Ke))return void(Ge.numPoints+=Ne.length/3);const gi=[];for(let ii=0;ii<Ne.length;ii+=3)(Ke===0||Ne[ii+2]>bi)&&(Ge.numSimplified++,gi.push(Ne[ii],Ne[ii+1])),Ge.numPoints++;At&&(function(ii,Ci){let un=0;for(let nn=0,Zn=ii.length,fr=Zn-2;nn<Zn;fr=nn,nn+=2)un+=(ii[nn]-ii[fr])*(ii[nn+1]+ii[fr+1]);if(un>0===Ci)for(let nn=0,Zn=ii.length;nn<Zn/2;nn+=2){const fr=ii[nn],Gr=ii[nn+1];ii[nn]=ii[Zn-2-nn],ii[nn+1]=ii[Zn-1-nn],ii[Zn-2-nn]=fr,ii[Zn-1-nn]=Gr}})(gi,jt),qt.push(gi)}const vi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class qi{constructor(Ne,Ge){const Ke=(Ge=this.options=(function(jt,bi){for(const gi in bi)jt[gi]=bi[gi];return jt})(Object.create(vi),Ge)).debug;if(Ke&&console.time("preprocess data"),Ge.maxZoom<0||Ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ge.promoteId&&Ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let At=(function(jt,bi){const gi=[];if(jt.type==="FeatureCollection")for(let ii=0;ii<jt.features.length;ii++)wi(gi,jt.features[ii],bi,ii);else wi(gi,jt.type==="Feature"?jt:{geometry:jt},bi);return gi})(Ne,Ge);this.tiles={},this.tileCoords=[],Ke&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ge.indexMaxZoom,Ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),At=(function(jt,bi){const gi=bi.buffer/bi.extent;let ii=jt;const Ci=Sr(jt,1,-1-gi,gi,0,-1,2,bi),un=Sr(jt,1,1-gi,2+gi,0,-1,2,bi);return(Ci||un)&&(ii=Sr(jt,1,-gi,1+gi,0,-1,2,bi)||[],Ci&&(ii=St(Ci,1).concat(ii)),un&&(ii=ii.concat(St(un,-1)))),ii})(At,Ge),At.length&&this.splitTile(At,0,0,0),Ke&&(At.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ne,Ge,Ke,At,jt,bi,gi){const ii=[Ne,Ge,Ke,At],Ci=this.options,un=Ci.debug;for(;ii.length;){At=ii.pop(),Ke=ii.pop(),Ge=ii.pop(),Ne=ii.pop();const nn=1<<Ge,Zn=on(Ge,Ke,At);let fr=this.tiles[Zn];if(!fr&&(un>1&&console.time("creation"),fr=this.tiles[Zn]=Ui(Ne,Ge,Ke,At,Ci),this.tileCoords.push({z:Ge,x:Ke,y:At}),un)){un>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ge,Ke,At,fr.numFeatures,fr.numPoints,fr.numSimplified),console.timeEnd("creation"));const Ao=`z${Ge}`;this.stats[Ao]=(this.stats[Ao]||0)+1,this.total++}if(fr.source=Ne,jt==null){if(Ge===Ci.indexMaxZoom||fr.numPoints<=Ci.indexMaxPoints)continue}else{if(Ge===Ci.maxZoom||Ge===jt)continue;if(jt!=null){const Ao=jt-Ge;if(Ke!==bi>>Ao||At!==gi>>Ao)continue}}if(fr.source=null,Ne.length===0)continue;un>1&&console.time("clipping");const Gr=.5*Ci.buffer/Ci.extent,xo=.5-Gr,Js=.5+Gr,mi=1+Gr;let bs=null,al=null,is=null,Hs=null,ll=Sr(Ne,nn,Ke-Gr,Ke+Js,0,fr.minX,fr.maxX,Ci),yi=Sr(Ne,nn,Ke+xo,Ke+mi,0,fr.minX,fr.maxX,Ci);Ne=null,ll&&(bs=Sr(ll,nn,At-Gr,At+Js,1,fr.minY,fr.maxY,Ci),al=Sr(ll,nn,At+xo,At+mi,1,fr.minY,fr.maxY,Ci),ll=null),yi&&(is=Sr(yi,nn,At-Gr,At+Js,1,fr.minY,fr.maxY,Ci),Hs=Sr(yi,nn,At+xo,At+mi,1,fr.minY,fr.maxY,Ci),yi=null),un>1&&console.timeEnd("clipping"),ii.push(bs||[],Ge+1,2*Ke,2*At),ii.push(al||[],Ge+1,2*Ke,2*At+1),ii.push(is||[],Ge+1,2*Ke+1,2*At),ii.push(Hs||[],Ge+1,2*Ke+1,2*At+1)}}getTile(Ne,Ge,Ke){Ne=+Ne,Ge=+Ge,Ke=+Ke;const At=this.options,{extent:jt,debug:bi}=At;if(Ne<0||Ne>24)return null;const gi=1<<Ne,ii=on(Ne,Ge=Ge+gi&gi-1,Ke);if(this.tiles[ii])return Ai(this.tiles[ii],jt);bi>1&&console.log("drilling down to z%d-%d-%d",Ne,Ge,Ke);let Ci,un=Ne,nn=Ge,Zn=Ke;for(;!Ci&&un>0;)un--,nn>>=1,Zn>>=1,Ci=this.tiles[on(un,nn,Zn)];return Ci&&Ci.source?(bi>1&&(console.log("found parent tile z%d-%d-%d",un,nn,Zn),console.time("drilling down")),this.splitTile(Ci.source,un,nn,Zn,Ne,Ge,Ke),bi>1&&console.timeEnd("drilling down"),this.tiles[ii]?Ai(this.tiles[ii],jt):null):null}}function on(qt,Ne,Ge){return 32*((1<<qt)*Ge+Ne)+qt}class Hi extends ie{constructor(Ne,Ge,Ke,At=Bt){super(Ne,Ge,Ke),this._dataUpdateable=new Map,this._createGeoJSONIndex=At}loadVectorTile(Ne,Ge){return b._(this,void 0,void 0,(function*(){const Ke=Ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const At=this._geoJSONIndex.getTile(Ke.z,Ke.x,Ke.y);return At?ae(new b.d2(At.features,{version:2,extent:b.a5})):null}))}loadData(Ne){return b._(this,void 0,void 0,(function*(){var Ge;(Ge=this._pendingRequest)===null||Ge===void 0||Ge.abort();const Ke=this._startPerformance(Ne);this._pendingRequest=new AbortController;try{(!this._pendingData||Ne.request||Ne.data||Ne.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Ne,this._pendingRequest));const At=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(At,Ne),this.loaded={};const jt={};return Ne.request&&(jt.data=At),this._finishPerformance(Ke,Ne,jt),jt}catch(At){if(delete this._pendingRequest,b.Z(At))return{abandoned:!0};throw At}}))}_startPerformance(Ne){var Ge;if(!((Ge=Ne?.request)===null||Ge===void 0)&&Ge.collectResourceTiming)return new b.c_(Ne.request)}_finishPerformance(Ne,Ge,Ke){if(!Ne)return;const At=Ne.finish();At&&(Ke.resourceTiming={},Ke.resourceTiming[Ge.source]=JSON.parse(JSON.stringify(At)))}getData(){return b._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Ne){const Ge=this.loaded;return Ge&&Ge[Ne.uid]?super.reloadTile(Ne):this.loadTile(Ne)}loadAndProcessGeoJSON(Ne,Ge){return b._(this,void 0,void 0,(function*(){let Ke;if(Ne.request?Ke=yield this.loadGeoJSONFromUrl(Ne.request,Ne.promoteId,Ge):Ne.data?Ke=this._loadGeoJSONFromObject(Ne.data,Ne.promoteId):Ne.dataDiff&&(Ke=this._loadGeoJSONFromDiff(Ne.dataDiff,Ne.promoteId,Ne.source)),delete this._pendingRequest,typeof Ke!="object")throw new Error(`Input data given to '${Ne.source}' is not a valid GeoJSON object.`);return Pe(Ke,!0),Ne.filter&&(Ke=this._filterGeoJSON(Ke,Ne.filter)),Ke}))}loadGeoJSONFromUrl(Ne,Ge,Ke){return b._(this,void 0,void 0,(function*(){const At=yield b.j(Ne,Ke);return this._dataUpdateable=b.a7(At.data,Ge),At.data}))}_loadGeoJSONFromObject(Ne,Ge){return this._dataUpdateable=b.a7(Ne,Ge),Ne}_loadGeoJSONFromDiff(Ne,Ge,Ke){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Ke}`);b.a8(this._dataUpdateable,Ne,Ge);const At=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(At)}_filterGeoJSON(Ne,Ge){const Ke=b.d3(Ge,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ke.result==="error")throw new Error(Ke.value.map((jt=>`${jt.key}: ${jt.message}`)).join(", "));const At=Ne.features.filter((jt=>Ke.value.evaluate({zoom:0},jt)));return this._toFeatureCollection(At)}_toFeatureCollection(Ne){return{type:"FeatureCollection",features:Ne}}removeSource(Ne){return b._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Ne){return this._geoJSONIndex.getClusterExpansionZoom(Ne.clusterId)}getClusterChildren(Ne){return this._geoJSONIndex.getChildren(Ne.clusterId)}getClusterLeaves(Ne){return this._geoJSONIndex.getLeaves(Ne.clusterId,Ne.limit,Ne.offset)}}function Bt(qt,Ne){return Ne.cluster?new Ye((function({superclusterOptions:Ge,clusterProperties:Ke}){if(!Ke||!Ge)return Ge;const At={},jt={},bi={accumulated:null,zoom:0},gi={properties:null},ii=Object.keys(Ke);for(const Ci of ii){const[un,nn]=Ke[Ci],Zn=b.d3(nn),fr=b.d3(typeof un=="string"?[un,["accumulated"],["get",Ci]]:un);At[Ci]=Zn.value,jt[Ci]=fr.value}return Ge.map=Ci=>{gi.properties=Ci;const un={};for(const nn of ii)un[nn]=At[nn].evaluate(bi,gi);return un},Ge.reduce=(Ci,un)=>{gi.properties=un;for(const nn of ii)bi.accumulated=Ci[nn],Ci[nn]=jt[nn].evaluate(bi,gi)},Ge})(Ne)).load(qt.features):(function(Ge,Ke){return new qi(Ge,Ke)})(qt,Ne.geojsonVtOptions)}class Ii{constructor(Ne){this.self=Ne,this.actor=new b.L(Ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Ge,Ke)=>{if(this.externalWorkerSourceTypes[Ge])throw new Error(`Worker source with name "${Ge}" already registered.`);this.externalWorkerSourceTypes[Ge]=Ke},this.self.addProtocol=b.cJ,this.self.removeProtocol=b.cK,this.self.registerRTLTextPlugin=Ge=>{b.d4.setMethods(Ge)},this.actor.registerMessageHandler("LDT",((Ge,Ke)=>this._getDEMWorkerSource(Ge,Ke.source).loadTile(Ke))),this.actor.registerMessageHandler("RDT",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Ge,Ke.source).removeTile(Ke)})))),this.actor.registerMessageHandler("GCEZ",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(Ge,Ke.type,Ke.source).getClusterExpansionZoom(Ke)})))),this.actor.registerMessageHandler("GCC",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(Ge,Ke.type,Ke.source).getClusterChildren(Ke)})))),this.actor.registerMessageHandler("GCL",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(Ge,Ke.type,Ke.source).getClusterLeaves(Ke)})))),this.actor.registerMessageHandler("LD",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).loadData(Ke))),this.actor.registerMessageHandler("GD",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).getData())),this.actor.registerMessageHandler("LT",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).loadTile(Ke))),this.actor.registerMessageHandler("RT",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).reloadTile(Ke))),this.actor.registerMessageHandler("AT",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).abortTile(Ke))),this.actor.registerMessageHandler("RMT",((Ge,Ke)=>this._getWorkerSource(Ge,Ke.type,Ke.source).removeTile(Ke))),this.actor.registerMessageHandler("RS",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){if(!this.workerSources[Ge]||!this.workerSources[Ge][Ke.type]||!this.workerSources[Ge][Ke.type][Ke.source])return;const At=this.workerSources[Ge][Ke.type][Ke.source];delete this.workerSources[Ge][Ke.type][Ke.source],At.removeSource!==void 0&&At.removeSource(Ke)})))),this.actor.registerMessageHandler("RM",(Ge=>b._(this,void 0,void 0,(function*(){delete this.layerIndexes[Ge],delete this.availableImages[Ge],delete this.workerSources[Ge],delete this.demWorkerSources[Ge],this.globalStates.delete(Ge)})))),this.actor.registerMessageHandler("SR",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){this.referrer=Ke})))),this.actor.registerMessageHandler("SRPS",((Ge,Ke)=>this._syncRTLPluginState(Ge,Ke))),this.actor.registerMessageHandler("IS",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){this.self.importScripts(Ke)})))),this.actor.registerMessageHandler("SI",((Ge,Ke)=>this._setImages(Ge,Ke))),this.actor.registerMessageHandler("UL",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(Ge).update(Ke.layers,Ke.removedIds,this._getGlobalState(Ge))})))),this.actor.registerMessageHandler("UGS",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){const At=this._getGlobalState(Ge);for(const jt in Ke)At[jt]=Ke[jt]})))),this.actor.registerMessageHandler("SL",((Ge,Ke)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(Ge).replace(Ke,this._getGlobalState(Ge))}))))}_getGlobalState(Ne){let Ge=this.globalStates.get(Ne);return Ge||(Ge={},this.globalStates.set(Ne,Ge)),Ge}_setImages(Ne,Ge){return b._(this,void 0,void 0,(function*(){this.availableImages[Ne]=Ge;for(const Ke in this.workerSources[Ne]){const At=this.workerSources[Ne][Ke];for(const jt in At)At[jt].availableImages=Ge}}))}_syncRTLPluginState(Ne,Ge){return b._(this,void 0,void 0,(function*(){return yield b.d4.syncState(Ge,this.self.importScripts)}))}_getAvailableImages(Ne){let Ge=this.availableImages[Ne];return Ge||(Ge=[]),Ge}_getLayerIndex(Ne){let Ge=this.layerIndexes[Ne];return Ge||(Ge=this.layerIndexes[Ne]=new t),Ge}_getWorkerSource(Ne,Ge,Ke){if(this.workerSources[Ne]||(this.workerSources[Ne]={}),this.workerSources[Ne][Ge]||(this.workerSources[Ne][Ge]={}),!this.workerSources[Ne][Ge][Ke]){const At={sendAsync:(jt,bi)=>(jt.targetMapId=Ne,this.actor.sendAsync(jt,bi))};switch(Ge){case"vector":this.workerSources[Ne][Ge][Ke]=new ie(At,this._getLayerIndex(Ne),this._getAvailableImages(Ne));break;case"geojson":this.workerSources[Ne][Ge][Ke]=new Hi(At,this._getLayerIndex(Ne),this._getAvailableImages(Ne));break;default:this.workerSources[Ne][Ge][Ke]=new this.externalWorkerSourceTypes[Ge](At,this._getLayerIndex(Ne),this._getAvailableImages(Ne))}}return this.workerSources[Ne][Ge][Ke]}_getDEMWorkerSource(Ne,Ge){return this.demWorkerSources[Ne]||(this.demWorkerSources[Ne]={}),this.demWorkerSources[Ne][Ge]||(this.demWorkerSources[Ne][Ge]=new pe),this.demWorkerSources[Ne][Ge]}}return b.i(self)&&(self.worker=new Ii(self)),Ii})),p("index",["exports","./shared"],(function(b,t){var P="5.15.0";function O(){var V=new t.A(4);return t.A!=Float32Array&&(V[1]=0,V[2]=0),V[0]=1,V[3]=1,V}let F,$,W;const Y={frame(V,u,y){const I=requestAnimationFrame((j=>{D(),u(j)})),{unsubscribe:D}=t.s(V.signal,"abort",(()=>{D(),cancelAnimationFrame(I),y(new t.a(V.signal.reason))}),!1)},frameAsync(V){return new Promise(((u,y)=>{this.frame(V,u,y)}))},getImageData(V,u=0){return this.getImageCanvasContext(V).getImageData(-u,-u,V.width+2*u,V.height+2*u)},getImageCanvasContext(V){const u=window.document.createElement("canvas"),y=u.getContext("2d",{willReadFrequently:!0});if(!y)throw new Error("failed to create canvas 2d context");return u.width=V.width,u.height=V.height,y.drawImage(V,0,0,V.width,V.height),y},resolveURL:V=>(F||(F=document.createElement("a")),F.href=V,F.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return W!==void 0?W:!!matchMedia&&($==null&&($=matchMedia("(prefers-reduced-motion: reduce)")),$.matches)},set prefersReducedMotion(V){W=V}},ae=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(V){this._frozenAt=V}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function se(){return ae.getCurrentTime()}class ie{static testProp(u){if(!ie.docStyle)return u[0];for(let y=0;y<u.length;y++)if(u[y]in ie.docStyle)return u[y];return u[0]}static create(u,y,I){const D=window.document.createElement(u);return y!==void 0&&(D.className=y),I&&I.appendChild(D),D}static createNS(u,y){return window.document.createElementNS(u,y)}static disableDrag(){ie.docStyle&&ie.selectProp&&(ie.userSelect=ie.docStyle[ie.selectProp],ie.docStyle[ie.selectProp]="none")}static enableDrag(){ie.docStyle&&ie.selectProp&&(ie.docStyle[ie.selectProp]=ie.userSelect)}static setTransform(u,y){u.style[ie.transformProp]=y}static addEventListener(u,y,I,D={}){u.addEventListener(y,I,"passive"in D?D:D.capture)}static removeEventListener(u,y,I,D={}){u.removeEventListener(y,I,"passive"in D?D:D.capture)}static suppressClickInternal(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",ie.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ie.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ie.suppressClickInternal,!0)}),0)}static getScale(u){const y=u.getBoundingClientRect();return{x:y.width/u.offsetWidth||1,y:y.height/u.offsetHeight||1,boundingClientRect:y}}static getPoint(u,y,I){const D=y.boundingClientRect;return new t.P((I.clientX-D.left)/y.x-u.clientLeft,(I.clientY-D.top)/y.y-u.clientTop)}static mousePos(u,y){const I=ie.getScale(u);return ie.getPoint(u,I,y)}static touchPos(u,y){const I=[],D=ie.getScale(u);for(let j=0;j<y.length;j++)I.push(ie.getPoint(u,D,y[j]));return I}static mouseButton(u){return u.button}static remove(u){u.parentNode&&u.parentNode.removeChild(u)}static sanitize(u){const y=new DOMParser().parseFromString(u,"text/html").body||document.createElement("body"),I=y.querySelectorAll("script");for(const D of I)D.remove();return ie.clean(y),y.innerHTML}static isPossiblyDangerous(u,y){const I=y.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(u)||!I.includes("javascript:")&&!I.includes("data:"))||!!u.startsWith("on")||void 0}static clean(u){const y=u.children;for(const I of y)ie.removeAttributes(I),ie.clean(I)}static removeAttributes(u){for(const{name:y,value:I}of u.attributes)ie.isPossiblyDangerous(y,I)&&u.removeAttribute(y)}}ie.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ie.selectProp=ie.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ie.transformProp=ie.testProp(["transform","WebkitTransform"]);const pe={supported:!1,testSupport:function(V){!Ee&&de&&(Pe?Ze(V):ye=V)}};let ye,de,Ee=!1,Pe=!1;function Ze(V){const u=V.createTexture();V.bindTexture(V.TEXTURE_2D,u);try{if(V.texImage2D(V.TEXTURE_2D,0,V.RGBA,V.RGBA,V.UNSIGNED_BYTE,de),V.isContextLost())return;pe.supported=!0}catch{}V.deleteTexture(u),Ee=!0}var We;typeof document<"u"&&(de=document.createElement("img"),de.onload=()=>{ye&&Ze(ye),ye=null,Pe=!0},de.onerror=()=>{Ee=!0,ye=null},de.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(V){let u,y,I,D;V.resetRequestQueue=()=>{u=[],y=0,I=0,D={}},V.addThrottleControl=te=>{const ge=I++;return D[ge]=te,ge},V.removeThrottleControl=te=>{delete D[te],H()},V.getImage=(te,ge,xe=!0)=>new Promise(((fe,De)=>{pe.supported&&(te.headers||(te.headers={}),te.headers.accept="image/webp,*/*"),t.e(te,{type:"image"}),u.push({abortController:ge,requestParameters:te,supportImageRefresh:xe,state:"queued",onError:Ve=>{De(Ve)},onSuccess:Ve=>{fe(Ve)}}),H()}));const j=te=>t._(this,void 0,void 0,(function*(){te.state="running";const{requestParameters:ge,supportImageRefresh:xe,onError:fe,onSuccess:De,abortController:Ve}=te,Xe=xe===!1&&!t.i(self)&&!t.g(ge.url)&&(!ge.headers||Object.keys(ge.headers).reduce(((Tt,Mt)=>Tt&&Mt==="accept"),!0));y++;const xt=Xe?K(ge,Ve):t.m(ge,Ve);try{const Tt=yield xt;delete te.abortController,te.state="completed",Tt.data instanceof HTMLImageElement||t.b(Tt.data)?De(Tt):Tt.data&&De({data:yield(wt=Tt.data,typeof createImageBitmap=="function"?t.f(wt):t.h(wt)),cacheControl:Tt.cacheControl,expires:Tt.expires})}catch(Tt){delete te.abortController,fe(Tt)}finally{y--,H()}var wt})),H=()=>{const te=(()=>{for(const ge of Object.keys(D))if(D[ge]())return!0;return!1})()?t.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let ge=y;ge<te&&u.length>0;ge++){const xe=u.shift();xe.abortController.signal.aborted?ge--:j(xe)}},K=(te,ge)=>new Promise(((xe,fe)=>{const De=new Image,Ve=te.url,Xe=te.credentials;Xe&&Xe==="include"?De.crossOrigin="use-credentials":(Xe&&Xe==="same-origin"||!t.d(Ve))&&(De.crossOrigin="anonymous"),ge.signal.addEventListener("abort",(()=>{De.src="",fe(new t.a(ge.signal.reason))})),De.fetchPriority="high",De.onload=()=>{De.onerror=De.onload=null,xe({data:De})},De.onerror=()=>{De.onerror=De.onload=null,ge.signal.aborted||fe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},De.src=Ve}))})(We||(We={})),We.resetRequestQueue();class je{constructor(u){this._transformRequestFn=u??null}transformRequest(u,y){return this._transformRequestFn&&this._transformRequestFn(u,y)||{url:u}}setTransformRequest(u){this._transformRequestFn=u}}function Ye(V){const u=[];if(typeof V=="string")u.push({id:"default",url:V});else if(V&&V.length>0){const y=[];for(const{id:I,url:D}of V){const j=`${I}${D}`;y.indexOf(j)===-1&&(y.push(j),u.push({id:I,url:D}))}}return u}function ct(V,u,y){try{const I=new URL(V);return I.pathname+=`${u}${y}`,I.toString()}catch{throw new Error(`Invalid sprite URL "${V}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Lt(V){const{userImage:u}=V;return!!(u&&u.render&&u.render())&&(V.data.replace(new Uint8Array(u.data.buffer)),!0)}class Ht extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const u of Object.keys(this.images))this.removeImage(u);this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:y,promiseResolve:I}of this.requestors)I(this._getImagesForIds(y));this.requestors=[]}}getImage(u){const y=this.images[u];if(y&&!y.data&&y.spriteData){const I=y.spriteData;y.data=new t.R({width:I.width,height:I.height},I.context.getImageData(I.x,I.y,I.width,I.height).data),y.spriteData=null}return y}addImage(u,y){if(this.images[u])throw new Error(`Image id ${u} already exist, use updateImage instead`);this._validate(u,y)&&(this.images[u]=y)}_validate(u,y){let I=!0;const D=y.data||y.spriteData;return this._validateStretch(y.stretchX,D&&D.width)||(this.fire(new t.k(new Error(`Image "${u}" has invalid "stretchX" value`))),I=!1),this._validateStretch(y.stretchY,D&&D.height)||(this.fire(new t.k(new Error(`Image "${u}" has invalid "stretchY" value`))),I=!1),this._validateContent(y.content,y)||(this.fire(new t.k(new Error(`Image "${u}" has invalid "content" value`))),I=!1),I}_validateStretch(u,y){if(!u)return!0;let I=0;for(const D of u){if(D[0]<I||D[1]<D[0]||y<D[1])return!1;I=D[1]}return!0}_validateContent(u,y){if(!u)return!0;if(u.length!==4)return!1;const I=y.spriteData,D=I&&I.width||y.data.width,j=I&&I.height||y.data.height;return!(u[0]<0||D<u[0]||u[1]<0||j<u[1]||u[2]<0||D<u[2]||u[3]<0||j<u[3]||u[2]<u[0]||u[3]<u[1])}updateImage(u,y,I=!0){const D=this.getImage(u);if(I&&(D.data.width!==y.data.width||D.data.height!==y.data.height))throw new Error(`size mismatch between old image (${D.data.width}x${D.data.height}) and new image (${y.data.width}x${y.data.height}).`);y.version=D.version+1,this.images[u]=y,this.updatedImages[u]=!0}removeImage(u){const y=this.images[u];delete this.images[u],delete this.patterns[u],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u){return new Promise(((y,I)=>{let D=!0;if(!this.isLoaded())for(const j of u)this.images[j]||(D=!1);this.isLoaded()||D?y(this._getImagesForIds(u)):this.requestors.push({ids:u,promiseResolve:y})}))}_getImagesForIds(u){const y={};for(const I of u){let D=this.getImage(I);D||(this.fire(new t.l("styleimagemissing",{id:I})),D=this.getImage(I)),D?y[I]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,textFitWidth:D.textFitWidth,textFitHeight:D.textFitHeight,hasRenderCallback:!!(D.userImage&&D.userImage.render)}:t.w(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return y}getPixelSize(){const{width:u,height:y}=this.atlasImage;return{width:u,height:y}}getPattern(u){const y=this.patterns[u],I=this.getImage(u);if(!I)return null;if(y&&y.position.version===I.version)return y.position;if(y)y.position.version=I.version;else{const D={w:I.data.width+2,h:I.data.height+2,x:0,y:0},j=new t.I(D,I);this.patterns[u]={bin:D,position:j}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const y=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.T(u,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const j in this.patterns)u.push(this.patterns[j].bin);const{w:y,h:I}=t.p(u),D=this.atlasImage;D.resize({width:y||1,height:I||1});for(const j in this.patterns){const{bin:H}=this.patterns[j],K=H.x+1,te=H.y+1,ge=this.getImage(j).data,xe=ge.width,fe=ge.height;t.R.copy(ge,D,{x:0,y:0},{x:K,y:te},{width:xe,height:fe}),t.R.copy(ge,D,{x:0,y:fe-1},{x:K,y:te-1},{width:xe,height:1}),t.R.copy(ge,D,{x:0,y:0},{x:K,y:te+fe},{width:xe,height:1}),t.R.copy(ge,D,{x:xe-1,y:0},{x:K-1,y:te},{width:1,height:fe}),t.R.copy(ge,D,{x:0,y:0},{x:K+xe,y:te},{width:1,height:fe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const y of u){if(this.callbackDispatchedThisFrame[y])continue;this.callbackDispatchedThisFrame[y]=!0;const I=this.getImage(y);I||t.w(`Image with ID: "${y}" was not found`),Lt(I)&&this.updateImage(y,I)}}cloneImages(){const u={};for(const y in this.images){const I=this.images[y];u[y]=Object.assign(Object.assign({},I),{data:I.data?I.data.clone():null})}return u}}const ci=1e20;function Wt(V,u,y,I,D,j,H,K,te){for(let ge=u;ge<u+I;ge++)$t(V,y*j+ge,j,D,H,K,te);for(let ge=y;ge<y+D;ge++)$t(V,ge*j+u,1,I,H,K,te)}function $t(V,u,y,I,D,j,H){j[0]=0,H[0]=-ci,H[1]=ci,D[0]=V[u];for(let K=1,te=0,ge=0;K<I;K++){D[K]=V[u+K*y];const xe=K*K;do{const fe=j[te];ge=(D[K]-D[fe]+xe-fe*fe)/(K-fe)/2}while(ge<=H[te]&&--te>-1);te++,j[te]=K,H[te]=ge,H[te+1]=ci}for(let K=0,te=0;K<I;K++){for(;H[te+1]<K;)te++;const ge=j[te],xe=K-ge;V[u+K*y]=D[ge]+xe*xe}}const Dt=t.v.layout_symbol["text-font"].default.join(",");class Ft{constructor(u,y,I){this.requestManager=u,this.localIdeographFontFamily=y,this.entries={},this.lang=I}setURL(u){this.url=u}getGlyphs(u){return t._(this,void 0,void 0,(function*(){const y=[];for(const j in u)for(const H of u[j])y.push(this._getAndCacheGlyphsPromise(j,H));const I=yield Promise.all(y),D={};for(const{stack:j,id:H,glyph:K}of I)D[j]||(D[j]={}),D[j][H]=K&&{id:K.id,bitmap:K.bitmap.clone(),metrics:K.metrics};return D}))}_getAndCacheGlyphsPromise(u,y){return t._(this,void 0,void 0,(function*(){let I=this.entries[u];I||(I=this.entries[u]={glyphs:{},requests:{},ranges:{}});let D=I.glyphs[y];return D!==void 0?{stack:u,id:y,glyph:D}:!this.url||this._charUsesLocalIdeographFontFamily(y)?(D=I.glyphs[y]=this._drawGlyph(I,u,y),{stack:u,id:y,glyph:D}):yield this._downloadAndCacheRangePromise(u,y)}))}_downloadAndCacheRangePromise(u,y){return t._(this,void 0,void 0,(function*(){const I=this.entries[u],D=Math.floor(y/256);if(I.ranges[D])return{stack:u,id:y,glyph:null};if(!I.requests[D]){const j=Ft.loadGlyphRange(u,D,this.url,this.requestManager);I.requests[D]=j}try{const j=yield I.requests[D];for(const H in j)I.glyphs[+H]=j[+H];return I.ranges[D]=!0,{stack:u,id:y,glyph:j[y]||null}}catch(j){const H=I.glyphs[y]=this._drawGlyph(I,u,y);return this._warnOnMissingGlyphRange(H,D,y,j),{stack:u,id:y,glyph:H}}}))}_warnOnMissingGlyphRange(u,y,I,D){const j=256*y,H=j+255,K=I.toString(16).padStart(4,"0").toUpperCase();t.w(`Unable to load glyph range ${y}, ${j}-${H}. Rendering codepoint U+${K} locally instead. ${D}`)}_charUsesLocalIdeographFontFamily(u){return!!this.localIdeographFontFamily&&t.q(u)}_drawGlyph(u,y,I){const D=y===Dt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(I),j=D?"ideographTinySDF":"tinySDF";u[j]||(u[j]=this._createTinySDF(D?this.localIdeographFontFamily:y));const H=u[j].draw(String.fromCodePoint(I));return{id:I,bitmap:new t.r({width:H.width||60,height:H.height||60},H.data),metrics:{width:H.glyphWidth/2||24,height:H.glyphHeight/2||24,left:H.glyphLeft/2+.5||0,top:H.glyphTop/2-27.5||-8,advance:H.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(u){const y=u?u.split(","):[];y.push("sans-serif");const I=y.map((D=>/[-\w]+/.test(D)?D:`'${CSS.escape(D)}'`)).join(",");return new Ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:I,fontWeight:this._fontWeight(y[0]),fontStyle:this._fontStyle(y[0]),lang:this.lang})}_fontStyle(u){return/italic/i.test(u)?"italic":/oblique/i.test(u)?"oblique":"normal"}_fontWeight(u){const y={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let I;for(const[D,j]of Object.entries(y))new RegExp(`\\b${D}\\b`,"i").test(u)&&(I=`${j}`);return I}destroy(){for(const u in this.entries){const y=this.entries[u];y.tinySDF&&(y.tinySDF=null),y.ideographTinySDF&&(y.ideographTinySDF=null),y.glyphs={},y.requests={},y.ranges={}}this.entries={}}}Ft.loadGlyphRange=function(V,u,y,I){return t._(this,void 0,void 0,(function*(){const D=256*u,j=D+255,H=I.transformRequest(y.replace("{fontstack}",V).replace("{range}",`${D}-${j}`),"Glyphs"),K=yield t.n(H,new AbortController);if(!K||!K.data)throw new Error(`Could not load glyph range. range: ${u}, ${D}-${j}`);const te={};for(const ge of t.o(K.data))te[ge.id]=ge;return te}))},Ft.TinySDF=class{constructor({fontSize:V=24,buffer:u=3,radius:y=8,cutoff:I=.25,fontFamily:D="sans-serif",fontWeight:j="normal",fontStyle:H="normal",lang:K=null}={}){this.buffer=u,this.cutoff=I,this.radius=y,this.lang=K;const te=this.size=V+4*u,ge=this._createCanvas(te),xe=this.ctx=ge.getContext("2d",{willReadFrequently:!0});xe.font=`${H} ${j} ${V}px ${D}`,xe.textBaseline="alphabetic",xe.textAlign="left",xe.fillStyle="black",this.gridOuter=new Float64Array(te*te),this.gridInner=new Float64Array(te*te),this.f=new Float64Array(te),this.z=new Float64Array(te+1),this.v=new Uint16Array(te)}_createCanvas(V){const u=document.createElement("canvas");return u.width=u.height=V,u}draw(V){const{width:u,actualBoundingBoxAscent:y,actualBoundingBoxDescent:I,actualBoundingBoxLeft:D,actualBoundingBoxRight:j}=this.ctx.measureText(V),H=Math.ceil(y),K=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(j-D))),te=Math.min(this.size-this.buffer,H+Math.ceil(I)),ge=K+2*this.buffer,xe=te+2*this.buffer,fe=Math.max(ge*xe,0),De=new Uint8ClampedArray(fe),Ve={data:De,width:ge,height:xe,glyphWidth:K,glyphHeight:te,glyphTop:H,glyphLeft:0,glyphAdvance:u};if(K===0||te===0)return Ve;const{ctx:Xe,buffer:xt,gridInner:wt,gridOuter:Tt}=this;this.lang&&(Xe.lang=this.lang),Xe.clearRect(xt,xt,K,te),Xe.fillText(V,xt,xt+H);const Mt=Xe.getImageData(xt,xt,K,te);Tt.fill(ci,0,fe),wt.fill(0,0,fe);for(let Yt=0;Yt<te;Yt++)for(let Rt=0;Rt<K;Rt++){const Zt=Mt.data[4*(Yt*K+Rt)+3]/255;if(Zt===0)continue;const ei=(Yt+xt)*ge+Rt+xt;if(Zt===1)Tt[ei]=0,wt[ei]=ci;else{const Ut=.5-Zt;Tt[ei]=Ut>0?Ut*Ut:0,wt[ei]=Ut<0?Ut*Ut:0}}Wt(Tt,0,0,ge,xe,ge,this.f,this.v,this.z),Wt(wt,xt,xt,K,te,ge,this.f,this.v,this.z);for(let Yt=0;Yt<fe;Yt++){const Rt=Math.sqrt(Tt[Yt])-Math.sqrt(wt[Yt]);De[Yt]=Math.round(255-255*(Rt/this.radius+this.cutoff))}return Ve}};class vt{constructor(){this.specification=t.u.light.position}possiblyEvaluate(u,y){return t.F(u.expression.evaluate(y))}interpolate(u,y,I){return{x:t.G.number(u.x,y.x,I),y:t.G.number(u.y,y.y,I),z:t.G.number(u.z,y.z,I)}}}let wi;class Qi extends t.E{constructor(u){super(),wi=wi||new t.t({anchor:new t.D(t.u.light.anchor),position:new vt,color:new t.D(t.u.light.color),intensity:new t.D(t.u.light.intensity)}),this._transitionable=new t.x(wi,void 0),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,y={}){if(!this._validate(t.y,u,y))for(const I in u){const D=u[I];I.endsWith(t.z)?this._transitionable.setTransition(I.slice(0,-t.z.length),D):this._transitionable.setValue(I,D)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,y,I){return(!I||I.validate!==!1)&&t.B(this,u.call(t.C,{value:y,style:{glyphs:!0,sprite:!0},styleSpec:t.u}))}}const wn=new t.t({"sky-color":new t.D(t.u.sky["sky-color"]),"horizon-color":new t.D(t.u.sky["horizon-color"]),"fog-color":new t.D(t.u.sky["fog-color"]),"fog-ground-blend":new t.D(t.u.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.u.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.u.sky["atmosphere-blend"])});class qn extends t.E{constructor(u){super(),this._transitionable=new t.x(wn,void 0),this.setSky(u),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.H(0))}setSky(u,y={}){if(!this._validate(t.J,u,y)){u||(u={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const I in u){const D=u[I];I.endsWith(t.z)?this._transitionable.setTransition(I.slice(0,-t.z.length),D):this._transitionable.setValue(I,D)}}}getSky(){return this._transitionable.serialize()}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,y,I={}){return I?.validate!==!1&&t.B(this,u.call(t.C,t.e({value:y,style:{glyphs:!0,sprite:!0},styleSpec:t.u})))}calculateFogBlendOpacity(u){return u<60?0:u<70?(u-60)/10:1}}class Fn{constructor(u,y){this.width=u,this.height=y,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(u,y){const I=u.join(",")+String(y);return this.dashEntry[I]||(this.dashEntry[I]=this.addDash(u,y)),this.dashEntry[I]}getDashRanges(u,y,I){const D=[];let j=u.length%2==1?-u[u.length-1]*I:0,H=u[0]*I,K=!0;D.push({left:j,right:H,isDash:K,zeroLength:u[0]===0});let te=u[0];for(let ge=1;ge<u.length;ge++){K=!K;const xe=u[ge];j=te*I,te+=xe,H=te*I,D.push({left:j,right:H,isDash:K,zeroLength:xe===0})}return D}addRoundDash(u,y,I){const D=y/2;for(let j=-I;j<=I;j++){const H=this.width*(this.nextRow+I+j);let K=0,te=u[K];for(let ge=0;ge<this.width;ge++){ge/te.right>1&&(te=u[++K]);const xe=Math.abs(ge-te.left),fe=Math.abs(ge-te.right),De=Math.min(xe,fe);let Ve;const Xe=j/I*(D+1);if(te.isDash){const xt=D-Math.abs(Xe);Ve=Math.sqrt(De*De+xt*xt)}else Ve=D-Math.sqrt(De*De+Xe*Xe);this.data[H+ge]=Math.max(0,Math.min(255,Ve+128))}}}addRegularDash(u){for(let K=u.length-1;K>=0;--K){const te=u[K],ge=u[K+1];te.zeroLength?u.splice(K,1):ge&&ge.isDash===te.isDash&&(ge.left=te.left,u.splice(K,1))}const y=u[0],I=u[u.length-1];y.isDash===I.isDash&&(y.left=I.left-this.width,I.right=y.right+this.width);const D=this.width*this.nextRow;let j=0,H=u[j];for(let K=0;K<this.width;K++){K/H.right>1&&(H=u[++j]);const te=Math.abs(K-H.left),ge=Math.abs(K-H.right),xe=Math.min(te,ge);this.data[D+K]=Math.max(0,Math.min(255,(H.isDash?xe:-xe)+128))}}addDash(u,y){const I=y?7:0,D=2*I+1;if(this.nextRow+D>this.height)return t.w("LineAtlas out of space"),null;let j=0;for(let K=0;K<u.length;K++)j+=u[K];if(j!==0){const K=this.width/j,te=this.getDashRanges(u,this.width,K);y?this.addRoundDash(te,K,I):this.addRegularDash(te)}const H={y:this.nextRow+I,height:2*I,width:j};return this.nextRow+=D,this.dirty=!0,H}bind(u){const y=u.gl;this.texture?(y.bindTexture(y.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,y.texSubImage2D(y.TEXTURE_2D,0,0,0,this.width,this.height,y.ALPHA,y.UNSIGNED_BYTE,this.data))):(this.texture=y.createTexture(),y.bindTexture(y.TEXTURE_2D,this.texture),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR),y.texImage2D(y.TEXTURE_2D,0,y.ALPHA,this.width,this.height,0,y.ALPHA,y.UNSIGNED_BYTE,this.data))}}const mr="maplibre_preloaded_worker_pool";class Sr{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<Sr.workerCount;)this.workers.push(new Worker(t.c.WORKER_URL));return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach((y=>{y.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[mr]}numActive(){return Object.keys(this.active).length}}const Hr=Math.floor(Y.hardwareConcurrency/2);let ti,sn;function Gi(){return ti||(ti=new Sr),ti}Sr.workerCount=t.K(globalThis)?Math.max(Math.min(Hr,3),1):1;class gn{constructor(u,y){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=y;const I=this.workerPool.acquire(y);for(let D=0;D<I.length;D++){const j=new t.L(I[D],y);j.name=`Worker ${D}`,this.actors.push(j)}if(!this.actors.length)throw new Error("No actors found")}broadcast(u,y){const I=[];for(const D of this.actors)I.push(D.sendAsync({type:u,data:y}));return Promise.all(I)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(u=!0){this.actors.forEach((y=>{y.remove()})),this.actors=[],u&&this.workerPool.release(this.id)}registerMessageHandler(u,y){for(const I of this.actors)I.registerMessageHandler(u,y)}unregisterMessageHandler(u){for(const y of this.actors)y.unregisterMessageHandler(u)}}function nr(){return sn||(sn=new gn(Gi(),t.M),sn.registerMessageHandler("GR",((V,u,y)=>t.m(u,y)))),sn}function Ur(V,u){const y=t.N();return t.O(y,y,[1,1,0]),t.Q(y,y,[.5*V.width,.5*V.height,1]),V.calculatePosMatrix?t.S(y,y,V.calculatePosMatrix(u.toUnwrapped())):y}function St(V,u,y,I,D,j,H){var K;const te=(function(De,Ve,Xe){if(De)for(const xt of De){const wt=Ve[xt];if(wt&&wt.source===Xe&&wt.type==="fill-extrusion")return!0}else for(const xt in Ve){const wt=Ve[xt];if(wt.source===Xe&&wt.type==="fill-extrusion")return!0}return!1})((K=D?.layers)!==null&&K!==void 0?K:null,u,V.id),ge=j.maxPitchScaleFactor(),xe=V.tilesIn(I,ge,te);xe.sort(Gt);const fe=[];for(const De of xe)fe.push({wrappedTileID:De.tileID.wrapped().key,queryResults:De.tile.queryRenderedFeatures(u,y,V.getState(),De.queryGeometry,De.cameraQueryGeometry,De.scale,D,j,ge,Ur(j,De.tileID),H?(Ve,Xe)=>H(De.tileID,Ve,Xe):void 0)});return(function(De,Ve){for(const Xe in De)for(const xt of De[Xe])Ai(xt,Ve);return De})((function(De){const Ve={},Xe={};for(const xt of De){const wt=xt.queryResults,Tt=xt.wrappedTileID,Mt=Xe[Tt]=Xe[Tt]||{};for(const Yt in wt){const Rt=wt[Yt],Zt=Mt[Yt]=Mt[Yt]||{},ei=Ve[Yt]=Ve[Yt]||[];for(const Ut of Rt)Zt[Ut.featureIndex]||(Zt[Ut.featureIndex]=!0,ei.push(Ut))}}return Ve})(fe),V)}function Gt(V,u){const y=V.tileID,I=u.tileID;return y.overscaledZ-I.overscaledZ||y.canonical.y-I.canonical.y||y.wrap-I.wrap||y.canonical.x-I.canonical.x}function Ai(V,u){const y=V.feature,I=u.getFeatureState(y.layer["source-layer"],y.id);y.source=y.layer.source,y.layer["source-layer"]&&(y.sourceLayer=y.layer["source-layer"]),y.state=I}function hn(V,u,y){return t._(this,void 0,void 0,(function*(){let I=V;if(V.url?I=(yield t.j(u.transformRequest(V.url,"Source"),y)).data:yield Y.frameAsync(y),!I)return null;const D=t.U(t.e(I,V),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in I&&I.vector_layers&&(D.vectorLayerIds=I.vector_layers.map((j=>j.id))),D}))}class Ui{constructor(u,y){u&&(y?this.setSouthWest(u).setNorthEast(y):Array.isArray(u)&&(u.length===4?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1])))}setNorthEast(u){return this._ne=u instanceof t.V?new t.V(u.lng,u.lat):t.V.convert(u),this}setSouthWest(u){return this._sw=u instanceof t.V?new t.V(u.lng,u.lat):t.V.convert(u),this}extend(u){const y=this._sw,I=this._ne;let D,j;if(u instanceof t.V)D=u,j=u;else{if(!(u instanceof Ui))return Array.isArray(u)?u.length===4||u.every(Array.isArray)?this.extend(Ui.convert(u)):this.extend(t.V.convert(u)):u&&("lng"in u||"lon"in u)&&"lat"in u?this.extend(t.V.convert(u)):this;if(D=u._sw,j=u._ne,!D||!j)return this}return y||I?(y.lng=Math.min(D.lng,y.lng),y.lat=Math.min(D.lat,y.lat),I.lng=Math.max(j.lng,I.lng),I.lat=Math.max(j.lat,I.lat)):(this._sw=new t.V(D.lng,D.lat),this._ne=new t.V(j.lng,j.lat)),this}getCenter(){return new t.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.V(this.getWest(),this.getNorth())}getSouthEast(){return new t.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(u){const{lng:y,lat:I}=t.V.convert(u);let D=this._sw.lng<=y&&y<=this._ne.lng;return this._sw.lng>this._ne.lng&&(D=this._sw.lng>=y&&y>=this._ne.lng),this._sw.lat<=I&&I<=this._ne.lat&&D}intersects(u){if(!((u=Ui.convert(u)).getNorth()>=this.getSouth()&&u.getSouth()<=this.getNorth()))return!1;const y=Math.abs(this.getEast()-this.getWest()),I=Math.abs(u.getEast()-u.getWest());if(y>=360||I>=360)return!0;const D=t.W(this.getWest(),-180,180),j=t.W(this.getEast(),-180,180),H=t.W(u.getWest(),-180,180),K=t.W(u.getEast(),-180,180),te=D>=j,ge=H>=K;return!(!te||!ge)||(te?K>=D||H<=j:ge?j>=H||D<=K:H<=j&&K>=D)}static convert(u){return u instanceof Ui?u:u&&new Ui(u)}static fromLngLat(u,y=0){const I=360*y/40075017,D=I/Math.cos(Math.PI/180*u.lat);return new Ui(new t.V(u.lng-D,u.lat-I),new t.V(u.lng+D,u.lat+I))}adjustAntiMeridian(){const u=new t.V(this._sw.lng,this._sw.lat),y=new t.V(this._ne.lng,this._ne.lat);return new Ui(u,u.lng>y.lng?new t.V(y.lng+360,y.lat):y)}}class pt{constructor(u,y,I){this.bounds=Ui.convert(this.validateBounds(u)),this.minzoom=y||0,this.maxzoom=I||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const y=Math.pow(2,u.z),I=Math.floor(t.Y(this.bounds.getWest())*y),D=Math.floor(t.X(this.bounds.getNorth())*y),j=Math.ceil(t.Y(this.bounds.getEast())*y),H=Math.ceil(t.X(this.bounds.getSouth())*y);return u.x>=I&&u.x<j&&u.y>=D&&u.y<H}}class Ot extends t.E{constructor(u,y,I,D){if(super(),this.id=u,this.dispatcher=I,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.U(y,["url","scheme","tileSize","promoteId","encoding"])),this._options=t.e({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(D)}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),u&&(t.e(this,u),u.bounds&&(this.tileBounds=new pt(u.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,t.Z(u)||this.fire(new t.k(u))}}))}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.abort(),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(u){return t._(this,void 0,void 0,(function*(){const y=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I={request:this.map._requestManager.transformRequest(y,"Tile"),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(u)};I.request.collectResourceTiming=this._collectResourceTiming;let D="RT";if(u.actor&&u.state!=="expired"){if(u.state==="loading")return new Promise(((j,H)=>{u.reloadPromise={resolve:j,reject:H}}))}else u.actor=this.dispatcher.getActor(),D="LT";u.abortController=new AbortController;try{const j=yield u.actor.sendAsync({type:D,data:I},u.abortController);if(delete u.abortController,u.aborted)return;this._afterTileLoadWorkerResponse(u,j)}catch(j){if(delete u.abortController,u.aborted)return;if(j&&j.status!==404)throw j;this._afterTileLoadWorkerResponse(u,null)}}))}_getOverzoomParameters(u){if(u.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const y=u.tileID.scaledTo(this.maxzoom).canonical,I=y.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:y,overzoomRequest:this.map._requestManager.transformRequest(I,"Tile")}}_afterTileLoadWorkerResponse(u,y){if(y&&y.resourceTiming&&(u.resourceTiming=y.resourceTiming),y&&this.map._refreshExpiredTiles&&u.setExpiryData(y),u.loadVectorData(y,this.map.painter),u.reloadPromise){const I=u.reloadPromise;u.reloadPromise=null,this.loadTile(u).then(I.resolve).catch(I.reject)}}abortTile(u){return t._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.actor&&(yield u.actor.sendAsync({type:"AT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}unloadTile(u){return t._(this,void 0,void 0,(function*(){u.unloadVectorData(),u.actor&&(yield u.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class vi extends t.E{constructor(u,y,I,D){super(),this.id=u,this.dispatcher=I,this.setEventedParent(D),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},y),t.e(this,t.U(y,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,(function*(u=!1){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const y=yield hn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,y&&(t.e(this,y),y.bounds&&(this.tileBounds=new pt(y.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:u})))}catch(y){this._tileJSONRequest=null,this._loaded=!0,t.Z(y)||this.fire(new t.k(y))}}))}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(u){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),u(),this.load(!0)}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}serialize(){return t.e({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u){return t._(this,void 0,void 0,(function*(){const y=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);u.abortController=new AbortController;try{const I=yield We.getImage(this.map._requestManager.transformRequest(y,"Tile"),u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(I&&I.data){this.map._refreshExpiredTiles&&(I.cacheControl||I.expires)&&u.setExpiryData({cacheControl:I.cacheControl,expires:I.expires});const D=this.map.painter.context,j=D.gl,H=I.data;u.texture=this.map.painter.getTileTexture(H.width),u.texture?u.texture.update(H,{useMipmap:!0}):(u.texture=new t.T(D,H,j.RGBA,{useMipmap:!0}),u.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST)),u.state="loaded"}}catch(I){if(delete u.abortController,u.aborted)u.state="unloaded";else if(I)throw u.state="errored",I}}))}abortTile(u){return t._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController)}))}unloadTile(u){return t._(this,void 0,void 0,(function*(){u.texture&&this.map.painter.saveTileTexture(u.texture)}))}hasTransition(){return!1}}class qi extends vi{constructor(u,y,I,D){super(u,y,I,D),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox",this.redFactor=y.redFactor,this.greenFactor=y.greenFactor,this.blueFactor=y.blueFactor,this.baseShift=y.baseShift}loadTile(u){return t._(this,void 0,void 0,(function*(){const y=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I=this.map._requestManager.transformRequest(y,"Tile");u.neighboringTiles=this._getNeighboringTiles(u.tileID),u.abortController=new AbortController;try{const D=yield We.getImage(I,u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(D&&D.data){const j=D.data;this.map._refreshExpiredTiles&&(D.cacheControl||D.expires)&&u.setExpiryData({cacheControl:D.cacheControl,expires:D.expires});const H=t.b(j)&&t.$()?j:yield this.readImageNow(j),K={type:this.type,uid:u.uid,source:this.id,rawImageData:H,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!u.actor||u.state==="expired"){u.actor=this.dispatcher.getActor();const te=yield u.actor.sendAsync({type:"LDT",data:K});u.dem=te,u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0,u.state="loaded"}}}catch(D){if(delete u.abortController,u.aborted)u.state="unloaded";else if(D)throw u.state="errored",D}}))}readImageNow(u){return t._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&t.a0()){const y=u.width+2,I=u.height+2;try{return new t.R({width:y,height:I},yield t.a1(u,-1,-1,y,I))}catch{}}return Y.getImageData(u,1)}))}_getNeighboringTiles(u){const y=u.canonical,I=Math.pow(2,y.z),D=(y.x-1+I)%I,j=y.x===0?u.wrap-1:u.wrap,H=(y.x+1+I)%I,K=y.x+1===I?u.wrap+1:u.wrap,te={};return te[new t.a2(u.overscaledZ,j,y.z,D,y.y).key]={backfilled:!1},te[new t.a2(u.overscaledZ,K,y.z,H,y.y).key]={backfilled:!1},y.y>0&&(te[new t.a2(u.overscaledZ,j,y.z,D,y.y-1).key]={backfilled:!1},te[new t.a2(u.overscaledZ,u.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},te[new t.a2(u.overscaledZ,K,y.z,H,y.y-1).key]={backfilled:!1}),y.y+1<I&&(te[new t.a2(u.overscaledZ,j,y.z,D,y.y+1).key]={backfilled:!1},te[new t.a2(u.overscaledZ,u.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},te[new t.a2(u.overscaledZ,K,y.z,H,y.y+1).key]={backfilled:!1}),te}unloadTile(u){return t._(this,void 0,void 0,(function*(){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&(yield u.actor.sendAsync({type:"RDT",data:{type:this.type,uid:u.uid,source:this.id}}))}))}}function on(V){return V.type==="GeometryCollection"?V.geometries.map((u=>u.coordinates)).flat(1/0):V.coordinates.flat(1/0)}function Hi(V){const u=new Ui;let y;switch(V.type){case"FeatureCollection":y=V.features.map((I=>on(I.geometry))).flat(1/0);break;case"Feature":y=on(V.geometry);break;default:y=on(V)}if(y.length==0)return u;for(let I=0;I<y.length-1;I+=2)u.extend([y[I],y[I+1]]);return u}class Bt extends t.E{constructor(u,y,I,D){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:y.data},this.actor=I.getActor(),this.setEventedParent(D),this._data=typeof y.data=="string"?{url:y.data}:{geojson:y.data},this._options=t.e({},y),this._collectResourceTiming=y.collectResourceTiming,y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId,y.clusterMaxZoom!==void 0&&this.maxzoom<=y.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${y.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(y.buffer!==void 0?y.buffer:128),tolerance:this._pixelsToTileUnits(y.tolerance!==void 0?y.tolerance:.375),extent:t.a5,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(y.clusterMaxZoom),minPoints:Math.max(2,y.clusterMinPoints||2),extent:t.a5,radius:this._pixelsToTileUnits(y.clusterRadius||50),log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(u){return u*(t.a5/this.tileSize)}_getClusterMaxZoom(u){const y=u?Math.round(u):this.maxzoom-1;return Number.isInteger(u)||u===void 0||t.w(`Integer expected for option 'clusterMaxZoom': provided value "${u}" rounded to "${y}"`),y}load(){return t._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(u){this.map=u,this.load()}setData(u,y){this._data=typeof u=="string"?{url:u}:{geojson:u},this._pendingWorkerUpdate={data:u};const I=this._updateWorkerData();return y?I:this}updateData(u,y){this._pendingWorkerUpdate.diff=t.a6(this._pendingWorkerUpdate.diff,u);const I=this._updateWorkerData();return y?I:this}getData(){return t._(this,void 0,void 0,(function*(){const u=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:u})}))}getBounds(){return t._(this,void 0,void 0,(function*(){return Hi(yield this.getData())}))}setClusterOptions(u){return this.workerOptions.cluster=u.cluster,u.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(u.clusterRadius)),u.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(u.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(u){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:u,source:this.id}})}getClusterChildren(u){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:u,source:this.id}})}getClusterLeaves(u,y,I){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:u,limit:y,offset:I}})}_updateWorkerData(){return t._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void t.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:u,diff:y}=this._pendingWorkerUpdate,I=t.e({type:this.type},this.workerOptions);u!==void 0?(typeof u=="string"?(I.request=this.map._requestManager.transformRequest(Y.resolveURL(u),"Source"),I.request.collectResourceTiming=this._collectResourceTiming):I.data=u,this._pendingWorkerUpdate.data=void 0):y&&(I.dataDiff=y,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new t.l("dataloading",{dataType:"source"}));try{const D=yield this.actor.sendAsync({type:"LD",data:I});if(this._isUpdatingWorker=!1,this._removed||D.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));D.data&&(this._data={geojson:D.data});const j=this._applyDiffToSource(y),H=this._getShouldReloadTileOptions(j);let K=null;D.resourceTiming&&D.resourceTiming[this.id]&&(K=D.resourceTiming[this.id].slice(0));const te={dataType:"source"};this._collectResourceTiming&&K&&K.length>0&&t.e(te,{resourceTiming:K}),this.fire(new t.l("data",Object.assign(Object.assign({},te),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},te),{sourceDataType:"content",shouldReloadTileOptions:H})))}catch(D){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(D))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(u){if(!u)return;const y=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const D=t.a7(this._data.geojson,y);if(!D)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:D}}if(!this._data.updateable)return;const I=t.a8(this._data.updateable,u,y);return u.removeAll||this._options.cluster?void 0:I}_getShouldReloadTileOptions(u){if(u)return{affectedBounds:u.filter(Boolean).map((y=>Hi(y)))}}shouldReloadTile(u,{affectedBounds:y}){if(u.state==="loading")return!0;if(u.state==="unloaded")return!1;const{buffer:I,extent:D}=this.workerOptions.geojsonVtOptions,j=(function({x:H,y:K,z:te},ge=0){const xe=t.a3((H-ge)/Math.pow(2,te)),fe=t.a4((K+1+ge)/Math.pow(2,te)),De=t.a3((H+1+ge)/Math.pow(2,te)),Ve=t.a4((K-ge)/Math.pow(2,te));return new Ui([xe,fe],[De,Ve])})(u.tileID.canonical,I/D);for(const H of y)if(j.intersects(H))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(u){return t._(this,void 0,void 0,(function*(){const y=u.actor?"RT":"LT";u.actor=this.actor;const I={type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};u.abortController=new AbortController;const D=yield this.actor.sendAsync({type:y,data:I},u.abortController);delete u.abortController,u.unloadVectorData(),u.aborted||u.loadVectorData(D,this.map.painter,y==="RT")}))}abortTile(u){return t._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.aborted=!0}))}unloadTile(u){return t._(this,void 0,void 0,(function*(){u.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Ii extends t.E{constructor(u,y,I,D){super(),this.flippedWindingOrder=!1,this.id=u,this.dispatcher=I,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(D),this.options=y}load(u){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const y=yield We.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,y&&y.data&&(this.image=y.data,u&&(this.coordinates=u),this._finishLoading())}catch(y){this._request=null,this._loaded=!0,t.Z(y)||this.fire(new t.k(y))}}))}loaded(){return this._loaded}updateImage(u){return u.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=u.url,this.load(u.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(u){this.coordinates=u;const y=u.map(t.a9.fromLngLat);var I;return this.tileID=(function(D){const j=t.aa.fromPoints(D),H=j.width(),K=j.height(),te=Math.max(H,K),ge=Math.max(0,Math.floor(-Math.log(te)/Math.LN2)),xe=Math.pow(2,ge);return new t.ac(ge,Math.floor((j.minX+j.maxX)/2*xe),Math.floor((j.minY+j.maxY)/2*xe))})(y),this.terrainTileRanges=this._getOverlappingTileRanges(y),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=y.map((D=>this.tileID.getTilePoint(D)._round())),this.flippedWindingOrder=((I=this.tileCoords)[1].x-I[0].x)*(I[2].y-I[0].y)-(I[1].y-I[0].y)*(I[2].x-I[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const u=this.map.painter.context,y=u.gl;this.texture||(this.texture=new t.T(u,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE));let I=!1;for(const D in this.tiles){const j=this.tiles[D];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,I=!0)}I&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(u){return t._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={}):u.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(u){const{minX:y,minY:I,maxX:D,maxY:j}=t.aa.fromPoints(u),H={};for(let K=0;K<=t.ab;K++){const te=Math.pow(2,K),ge=Math.floor(y*te),xe=Math.floor(I*te),fe=Math.floor(D*te),De=Math.floor(j*te);H[K]={minTileX:ge,minTileY:xe,maxTileX:fe,maxTileY:De}}return H}}class qt extends Ii{constructor(u,y,I,D){super(u,y,I,D),this.roundZoom=!0,this.type="video",this.options=y}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1;const u=this.options;this.urls=[];for(const y of u.urls)this.urls.push(this.map._requestManager.transformRequest(y,"Source").url);try{const y=yield t.ad(this.urls);if(this._loaded=!0,!y)return;this.video=y,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(y){this.fire(new t.k(y))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const y=this.video.seekable;u<y.start(0)||u>y.end(0)?this.fire(new t.k(new t.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${y.start(0)} and ${y.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,y=u.gl;this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(u,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE));let I=!1;for(const D in this.tiles){const j=this.tiles[D];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,I=!0)}I&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ne extends Ii{constructor(u,y,I,D){super(u,y,I,D),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some((j=>!Array.isArray(j)||j.length!==2||j.some((H=>typeof H!="number"))))||this.fire(new t.k(new t.ae(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.ae(`sources.${u}`,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new t.k(new t.ae(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.ae(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.ae(`sources.${u}`,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const y=this.map.painter.context,I=y.gl;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new t.T(y,this.canvas,I.RGBA,{premultiply:!0}),this.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE));let D=!1;for(const j in this.tiles){const H=this.tiles[j];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture,D=!0)}D&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}const Ge={},Ke=V=>{switch(V){case"geojson":return Bt;case"image":return Ii;case"raster":return vi;case"raster-dem":return qi;case"vector":return Ot;case"video":return qt;case"canvas":return Ne}return Ge[V]},At="RTLPluginLoaded";class jt extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nr()}_syncState(u){return this.status=u,this.dispatcher.broadcast("SRPS",{pluginStatus:u,pluginURL:this.url}).catch((y=>{throw this.status="error",y}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(u){return t._(this,arguments,void 0,(function*(y,I=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(y),!this.url)throw new Error(`requested url ${y} is invalid`);if(this.status==="unavailable"){if(!I)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return t._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(At))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let bi=null;function gi(){return bi||(bi=new jt),bi}var ii,Ci;(function(V){V[V.Base=0]="Base",V[V.Parent=1]="Parent"})(ii||(ii={})),(function(V){V[V.Departing=0]="Departing",V[V.Incoming=1]="Incoming"})(Ci||(Ci={}));class un{constructor(u,y){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=u,this.uid=t.af(),this.uses=0,this.tileSize=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(u){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(u||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:u,fadingDirection:y,fadingParentID:I,fadeEndTime:D}){this.resetFadeLogic(),this.fadingRole=u,this.fadingDirection=y,this.fadingParentID=I,this.fadeEndTime=D}setSelfFadeLogic(u){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=u}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=se(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(u){this.demTexture&&u.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(u,y,I){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData,this.latestFeatureIndex.encoding=u.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=(function(D,j){const H={};if(!j)return H;for(const K of D){const te=K.layerIds.map((ge=>j.getLayer(ge))).filter(Boolean);if(te.length!==0){K.layers=te,K.stateDependentLayerIds&&(K.stateDependentLayers=K.stateDependentLayerIds.map((ge=>te.filter((xe=>xe.id===ge))[0])));for(const ge of te)H[ge.id]=K}}return H})(u.buckets,y?.style),this.hasSymbolBuckets=!1;for(const D in this.buckets){const j=this.buckets[D];if(j instanceof t.ah){if(this.hasSymbolBuckets=!0,!I)break;j.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const D in this.buckets){const j=this.buckets[D];if(j instanceof t.ah&&j.hasRTLText){this.hasRTLText=!0,gi().lazyLoad();break}}this.queryPadding=0;for(const D in this.buckets){const j=this.buckets[D];this.queryPadding=Math.max(this.queryPadding,y.style.getLayer(D).queryRadius(j))}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage),this.dashPositions=u.dashPositions}else this.collisionBoxArray=new t.ag}unloadVectorData(){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(u){return this.buckets[u.id]}upload(u){for(const I in this.buckets){const D=this.buckets[I];D.uploadPending()&&D.upload(u)}const y=u.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new t.T(u,this.imageAtlas.image,y.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(u,this.glyphAtlasImage,y.ALPHA),this.glyphAtlasImage=null)}prepare(u){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture)}queryRenderedFeatures(u,y,I,D,j,H,K,te,ge,xe,fe){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:D,cameraQueryGeometry:j,scale:H,tileSize:this.tileSize,pixelPosMatrix:xe,transform:te,params:K,queryPadding:this.queryPadding*ge,getElevation:fe},u,y,I):{}}querySourceFeatures(u,y){const I=this.latestFeatureIndex;if(!I||!I.rawTileData)return;const D=I.loadVTLayers(),j=y&&y.sourceLayer?y.sourceLayer:"",H=D[t.ai]||D[j];if(!H)return;const K=t.aj(y?.filter,y?.globalState),{z:te,x:ge,y:xe}=this.tileID.canonical,fe={z:te,x:ge,y:xe};for(let De=0;De<H.length;De++){const Ve=H.feature(De);if(K.needGeometry){const wt=t.ak(Ve,!0);if(!K.filter(new t.H(this.tileID.overscaledZ),wt,this.tileID.canonical))continue}else if(!K.filter(new t.H(this.tileID.overscaledZ),Ve))continue;const Xe=I.getId(Ve,j),xt=new t.al(Ve,te,ge,xe,Xe);xt.tile=fe,u.push(xt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const y=this.expirationTime;if(u.cacheControl){const I=t.am(u.cacheControl);I["max-age"]&&(this.expirationTime=Date.now()+1e3*I["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const I=Date.now();let D=!1;if(this.expirationTime>I)D=!1;else if(y)if(this.expirationTime<y)D=!0;else{const j=this.expirationTime-y;j?this.expirationTime=I+Math.max(j,3e4):D=!0}else D=!0;D?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(u,y){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(u).length===0)return;const I=this.latestFeatureIndex.loadVTLayers();for(const D in this.buckets){if(!y.style.hasLayer(D))continue;const j=this.buckets[D],H=j.layers[0].sourceLayer||t.ai,K=I[H],te=u[H];if(!K||!te||Object.keys(te).length===0)continue;j.update(te,K,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const ge=y&&y.style&&y.style.getLayer(D);ge&&(this.queryPadding=Math.max(this.queryPadding,ge.queryRadius(j)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<se()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(u){this.symbolFadeHoldUntil=se()+u}setDependencies(u,y){const I={};for(const D of y)I[D]=!0;this.dependencies[u]=I}hasDependency(u,y){for(const I of u){const D=this.dependencies[I];if(D){for(const j of y)if(D[j])return!0}}return!1}}class nn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,y,I){const D=String(y);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][D]=this.stateChanges[u][D]||{},t.e(this.stateChanges[u][D],I),this.deletedStates[u]===null){this.deletedStates[u]={};for(const j in this.state[u])j!==D&&(this.deletedStates[u][j]=null)}else if(this.deletedStates[u]&&this.deletedStates[u][D]===null){this.deletedStates[u][D]={};for(const j in this.state[u][D])I[j]||(this.deletedStates[u][D][j]=null)}else for(const j in I)this.deletedStates[u]&&this.deletedStates[u][D]&&this.deletedStates[u][D][j]===null&&delete this.deletedStates[u][D][j]}removeFeatureState(u,y,I){if(this.deletedStates[u]===null)return;const D=String(y);if(this.deletedStates[u]=this.deletedStates[u]||{},I&&y!==void 0)this.deletedStates[u][D]!==null&&(this.deletedStates[u][D]=this.deletedStates[u][D]||{},this.deletedStates[u][D][I]=null);else if(y!==void 0)if(this.stateChanges[u]&&this.stateChanges[u][D])for(I in this.deletedStates[u][D]={},this.stateChanges[u][D])this.deletedStates[u][D][I]=null;else this.deletedStates[u][D]=null;else this.deletedStates[u]=null}getState(u,y){const I=String(y),D=t.e({},(this.state[u]||{})[I],(this.stateChanges[u]||{})[I]);if(this.deletedStates[u]===null)return{};if(this.deletedStates[u]){const j=this.deletedStates[u][y];if(j===null)return{};for(const H in j)delete D[H]}return D}initializeTileState(u,y){u.setFeatureState(this.state,y)}coalesceChanges(u,y){const I={};for(const D in this.stateChanges){this.state[D]=this.state[D]||{};const j={};for(const H in this.stateChanges[D])this.state[D][H]||(this.state[D][H]={}),t.e(this.state[D][H],this.stateChanges[D][H]),j[H]=this.state[D][H];I[D]=j}for(const D in this.deletedStates){this.state[D]=this.state[D]||{};const j={};if(this.deletedStates[D]===null)for(const H in this.state[D])j[H]={},this.state[D][H]={};else for(const H in this.deletedStates[D]){if(this.deletedStates[D][H]===null)this.state[D][H]={};else for(const K of Object.keys(this.deletedStates[D][H]))delete this.state[D][H][K];j[H]=this.state[D][H]}I[D]=I[D]||{},t.e(I[D],j)}this.stateChanges={},this.deletedStates={},Object.keys(I).length!==0&&u.setFeatureState(I,y)}}const Zn=89.25;function fr(V,u){const y=t.an(u.lat,-t.ao,t.ao);return new t.P(t.Y(u.lng)*V,t.X(y)*V)}function Gr(V,u){return new t.a9(u.x/V,u.y/V).toLngLat()}function xo(V){return V.cameraToCenterDistance*Math.min(.85*Math.tan(t.ap(90-V.pitch)),Math.tan(t.ap(Zn-V.pitch)))}function Js(V,u){const y=V.canonical,I=u/t.aq(y.z),D=y.x+Math.pow(2,y.z)*V.wrap,j=t.ar(new Float64Array(16));return t.O(j,j,[D*I,y.y*I,0]),t.Q(j,j,[I/t.a5,I/t.a5,1]),j}function mi(V,u,y,I,D){const j=t.a9.fromLngLat(V,u),H=D*t.as(1,V.lat),{x:K,y:te,z:ge}=bs(y,I);return new t.a9(j.x+H*-K,j.y+H*-te,j.z+H*-ge)}function bs(V,u){const y=t.ap(V),I=t.ap(u),D=Math.cos(-y),j=Math.sin(y);return{x:j*Math.sin(I),y:-j*Math.cos(I),z:D}}function al(V,u,y){const I=u.intersectsFrustum(V);if(!y||I===0)return I;const D=u.intersectsPlane(y);return D===0?0:I===2&&D===2?2:1}function is(V,u,y){let I=0;const D=(y-u)/10;for(let j=0;j<10;j++)I+=D*Math.pow(Math.cos(u+(j+.5)/10*(y-u)),V);return I}function Hs(V,u){return function(y,I,D,j,H){const K=2*((V-1)/t.at(Math.cos(t.ap(Zn-H))/Math.cos(t.ap(Zn)))-1),te=Math.acos(D/j),ge=2*is(K-1,0,t.ap(H/2)),xe=Math.min(t.ap(Zn),te+t.ap(H/2)),fe=is(K-1,Math.min(xe,te-t.ap(H/2)),xe),De=Math.atan(I/D),Ve=Math.hypot(I,D);let Xe=y;return Xe+=t.at(j/Ve/Math.max(.5,Math.cos(t.ap(H/2)))),Xe+=K*t.at(Math.cos(De))/2,Xe-=t.at(Math.max(1,fe/ge/u))/2,Xe}}const ll=Hs(9.314,3);function yi(V,u){const y=(u.roundZoom?Math.round:Math.floor)(V.zoom+t.at(V.tileSize/u.tileSize));return Math.max(0,y)}function Ao(V,u){const y=V.getCameraFrustum(),I=V.getClippingPlane(),D=V.screenPointToMercatorCoordinate(V.getCameraPoint()),j=t.a9.fromLngLat(V.center,V.elevation);D.z=j.z+Math.cos(V.pitchInRadians)*V.cameraToCenterDistance/V.worldSize;const H=V.getCoveringTilesDetailsProvider(),K=H.allowVariableZoom(V,u),te=yi(V,u),ge=u.minzoom||0,xe=u.maxzoom!==void 0?u.maxzoom:V.maxZoom,fe=Math.min(Math.max(0,te),xe),De=Math.pow(2,fe),Ve=[De*D.x,De*D.y,0],Xe=[De*j.x,De*j.y,0],xt=Math.hypot(j.x-D.x,j.y-D.y),wt=Math.abs(j.z-D.z),Tt=Math.hypot(xt,wt),Mt=Zt=>({zoom:0,x:0,y:0,wrap:Zt,fullyVisible:!1}),Yt=[],Rt=[];if(V.renderWorldCopies&&H.allowWorldCopies())for(let Zt=1;Zt<=3;Zt++)Yt.push(Mt(-Zt)),Yt.push(Mt(Zt));for(Yt.push(Mt(0));Yt.length>0;){const Zt=Yt.pop(),ei=Zt.x,Ut=Zt.y;let hi=Zt.fullyVisible;const $i={x:ei,y:Ut,z:Zt.zoom},ki=H.getTileBoundingVolume($i,Zt.wrap,V.elevation,u);if(!hi){const Nn=al(y,ki,I);if(Nn===0)continue;hi=Nn===2}const Di=H.distanceToTile2d(D.x,D.y,$i,ki);let Pi=te;K&&(Pi=(u.calculateTileZoom||ll)(V.zoom+t.at(V.tileSize/u.tileSize),Di,wt,Tt,V.fov)),Pi=(u.roundZoom?Math.round:Math.floor)(Pi),Pi=Math.max(0,Pi);const On=Math.min(Pi,xe);if(Zt.wrap=H.getWrap(j,$i,Zt.wrap),Zt.zoom>=On){if(Zt.zoom<ge)continue;const Nn=fe-Zt.zoom,bn=Ve[0]-.5-(ei<<Nn),Yn=Ve[1]-.5-(Ut<<Nn),Zr=u.reparseOverscaled?Math.max(Zt.zoom,Pi):Zt.zoom;Rt.push({tileID:new t.a2(Zt.zoom===xe?Zr:Zt.zoom,Zt.wrap,Zt.zoom,ei,Ut),distanceSq:t.au([Xe[0]-.5-ei,Xe[1]-.5-Ut]),tileDistanceToCamera:Math.sqrt(bn*bn+Yn*Yn)})}else for(let Nn=0;Nn<4;Nn++)Yt.push({zoom:Zt.zoom+1,x:(ei<<1)+Nn%2,y:(Ut<<1)+(Nn>>1),wrap:Zt.wrap,fullyVisible:hi})}return Rt.sort(((Zt,ei)=>Zt.distanceSq-ei.distanceSq)).map((Zt=>Zt.tileID))}const Bo=t.aa.fromPoints([new t.P(0,0),new t.P(t.a5,t.a5)]);function sa(V){return V==="raster"||V==="image"||V==="video"}function ns(V,u,y,I,D,j,H){if(!u.hasData())return!1;const{tileID:K,fadingRole:te,fadingDirection:ge,fadingParentID:xe}=u;if(te===ii.Base&&ge===Ci.Incoming&&xe)return y[xe.key]=xe,!0;const fe=Math.max(K.overscaledZ-D,j);for(let De=K.overscaledZ-1;De>=fe;De--){const Ve=K.scaledTo(De),Xe=V.getLoadedTile(Ve);if(Xe)return u.setCrossFadeLogic({fadingRole:ii.Base,fadingDirection:Ci.Incoming,fadingParentID:Xe.tileID,fadeEndTime:I+H}),Xe.setCrossFadeLogic({fadingRole:ii.Parent,fadingDirection:Ci.Departing,fadeEndTime:I+H}),y[Ve.key]=Ve,!0}return!1}function Ja(V,u,y,I,D,j){if(!u.hasData())return!1;const H=u.tileID.children(D);let K=Mn(V,u,H,y,I,D,j);if(K)return!0;for(const te of H)Mn(V,u,te.children(D),y,I,D,j)&&(K=!0);return K}function Mn(V,u,y,I,D,j,H){if(y[0].overscaledZ>=j)return!1;let K=!1;for(const te of y){const ge=V.getLoadedTile(te);if(!ge)continue;const{fadingRole:xe,fadingDirection:fe,fadingParentID:De}=ge;xe===ii.Base&&fe===Ci.Departing&&De||(ge.setCrossFadeLogic({fadingRole:ii.Base,fadingDirection:Ci.Departing,fadingParentID:u.tileID,fadeEndTime:D+H}),u.setCrossFadeLogic({fadingRole:ii.Parent,fadingDirection:Ci.Incoming,fadeEndTime:D+H})),I[te.key]=te,K=!0}return K}function Qa(V,u,y,I){const D=V.tileID;return!!V.selfFading||!V.hasData()&&!!u.has(D)&&(V.setSelfFadeLogic(y+I),!0)}function gl(V,u){var y;V.needsHillshadePrepare=!0,V.needsTerrainPrepare=!0;let I=u.tileID.canonical.x-V.tileID.canonical.x;const D=u.tileID.canonical.y-V.tileID.canonical.y,j=Math.pow(2,V.tileID.canonical.z),H=u.tileID.key;I===0&&D===0||Math.abs(D)>1||(Math.abs(I)>1&&(Math.abs(I+j)===1?I+=j:Math.abs(I-j)===1&&(I-=j)),u.dem&&V.dem&&(V.dem.backfillBorder(u.dem,I,D),!((y=V.neighboringTiles)===null||y===void 0)&&y[H]&&(V.neighboringTiles[H].backfilled=!0)))}class Nt{constructor(){this._tiles={}}handleWrapJump(u){const y={};for(const I in this._tiles){const D=this._tiles[I];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+u),y[D.tileID.key]=D}this._tiles=y}setFeatureState(u,y){for(const I in this._tiles)this._tiles[I].setFeatureState(u,y)}getAllTiles(){return Object.values(this._tiles)}getAllIds(u=!1){return u?Object.values(this._tiles).map((y=>y.tileID)).sort(t.aw).map((y=>y.key)):Object.keys(this._tiles)}getTileById(u){return this._tiles[u]}setTile(u,y){this._tiles[u]=y}deleteTileById(u){delete this._tiles[u]}getLoadedTile(u){const y=this.getTileById(u.key);return y?.hasData()?y:null}isIdRenderable(u,y=!1){var I;return(I=this.getTileById(u))===null||I===void 0?void 0:I.isRenderable(y)}getRenderableIds(u=0,y){const I=[];for(const D of this.getAllIds())this.isIdRenderable(D,y)&&I.push(this.getTileById(D));return y?I.sort(((D,j)=>{const H=D.tileID,K=j.tileID,te=new t.P(H.canonical.x,H.canonical.y)._rotate(-u),ge=new t.P(K.canonical.x,K.canonical.y)._rotate(-u);return H.overscaledZ-K.overscaledZ||ge.y-te.y||ge.x-te.x})).map((D=>D.tileID.key)):I.map((D=>D.tileID)).sort(t.aw).map((D=>D.key))}}class we extends t.E{constructor(u,y,I){super(),this.id=u,this.dispatcher=I,this.on("data",(D=>this._dataHandler(D))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((D,j,H,K)=>{const te=new(Ke(j.type))(D,j,H,K);if(te.id!==D)throw new Error(`Expected Source id to be ${D} instead of ${te.id}`);return te})(u,y,I,this),this._inViewTiles=new Nt,this._outOfViewCache=new t.ax(0,(D=>this._unloadTile(D))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new nn,this._didEmitContent=!1,this._updated=!1}onAdd(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._maxTileCacheZoomLevels=u?u._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(u)}onRemove(u){for(const y of this._inViewTiles.getAllTiles())y.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(u),this._inViewTiles=new Nt}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const u of this._inViewTiles.getAllTiles())if(u.state!=="loaded"&&u.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(u,y,I){return t._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(u),this._tileLoaded(u,y,I)}catch(D){u.state="errored",D.status!==404?this._source.fire(new t.k(D,{tile:u})):this.update(this.transform,this.terrain)}}))}_unloadTile(u){this._source.unloadTile&&this._source.unloadTile(u)}_abortTile(u){this._source.abortTile&&this._source.abortTile(u),this._source.fire(new t.l("dataabort",{tile:u,coord:u.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const y of this._inViewTiles.getAllTiles())y.upload(u),y.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(u){var y;return this._inViewTiles.getRenderableIds((y=this.transform)===null||y===void 0?void 0:y.bearingInRadians,u)}hasRenderableParent(u){const y=u.overscaledZ-1;if(y>=this._source.minzoom){const I=this.getLoadedTile(u.scaledTo(y));if(I)return this._inViewTiles.isIdRenderable(I.tileID.key)}return!1}reload(u,y=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const I of this._inViewTiles.getAllIds()){const D=this._inViewTiles.getTileById(I);y&&!this._source.shouldReloadTile(D,y)||(u?this._reloadTile(I,"expired"):D.state!=="errored"&&this._reloadTile(I,"reloading"))}}}_reloadTile(u,y){return t._(this,void 0,void 0,(function*(){const I=this._inViewTiles.getTileById(u);I&&(I.state!=="loading"&&(I.state=y),yield this._loadTile(I,u,y))}))}_tileLoaded(u,y,I){u.timeAdded=se(),u.selfFading&&(u.fadeEndTime=u.timeAdded+this._rasterFadeDuration),I==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(y,u),this.getSource().type==="raster-dem"&&u.dem&&(function(D,j){var H,K;const te=j.getRenderableIds();for(const ge of te){if(!D.neighboringTiles||!D.neighboringTiles[ge])continue;const xe=j.getTileById(ge);D.neighboringTiles[ge].backfilled||gl(D,xe),!((K=(H=xe.neighboringTiles)===null||H===void 0?void 0:H[D.tileID.key])===null||K===void 0)&&K.backfilled||gl(xe,D)}})(u,this._inViewTiles),this._state.initializeTileState(u,this.map?this.map.painter:null),u.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:u,coord:u.tileID}))}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._inViewTiles.getTileById(u)}_retainLoadedChildren(u,y){const I=this._getLoadedDescendents(y),D=new Set;for(const j of y){const H=I[j.key];if(!H?.length){D.add(j);continue}const K=j.overscaledZ+we.maxOverzooming,te=H.filter((fe=>fe.tileID.overscaledZ<=K));if(!te.length){D.add(j);continue}const ge=Math.min(...te.map((fe=>fe.tileID.overscaledZ))),xe=te.filter((fe=>fe.tileID.overscaledZ===ge)).map((fe=>fe.tileID));for(const fe of xe)u[fe.key]=fe;this._areDescendentsComplete(xe,ge,j.overscaledZ)||D.add(j)}return D}_getLoadedDescendents(u){var y;const I={};for(const D of this._inViewTiles.getAllTiles().filter((j=>j.hasData())))for(const j of u)D.tileID.isChildOf(j)&&(I[y=j.key]||(I[y]=[])).push(D);return I}_areDescendentsComplete(u,y,I){return u.length===1&&u[0].isOverscaled()?u[0].overscaledZ===y:Math.pow(4,y-I)===u.length}getLoadedTile(u){return this._inViewTiles.getLoadedTile(u)}updateCacheSize(u){const y=Math.ceil(u.width/this._source.tileSize)+1,I=Math.ceil(u.height/this._source.tileSize)+1,D=Math.floor(y*I*(this._maxTileCacheZoomLevels===null?t.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,D):D;this._outOfViewCache.setMaxSize(j)}handleWrapJump(u){const y=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);this._prevLng=u,y&&(this._inViewTiles.handleWrapJump(y),this._resetTileReloadTimers())}update(u,y){if(!this._sourceLoaded||this._paused)return;let I;this.transform=u,this.terrain=y,this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?I=u.getVisibleUnwrappedCoordinates(this._source.tileID).map((te=>new t.a2(te.canonical.z,te.wrap,te.canonical.z,te.canonical.x,te.canonical.y))):(I=Ao(u,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?u.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:y,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(I=I.filter((te=>this._source.hasTile(te))))):I=[],this.usedForTerrain&&(I=this._addTerrainIdealTiles(I));const D=I.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const j=yi(u,this._source),H=this._updateRetainedTiles(I,j),K=sa(this._source.type);K&&this._rasterFadeDuration>0&&!y&&(function(te,ge,xe,fe,De,Ve,Xe){const xt=se(),wt=t.av(ge);for(const Tt of ge){const Mt=te.getTileById(Tt.key);Mt.fadingDirection!==Ci.Departing&&Mt.fadeOpacity!==0||Mt.resetFadeLogic(),ns(te,Mt,xe,xt,fe,De,Xe)||Ja(te,Mt,xe,xt,Ve,Xe)||Qa(Mt,wt,xt,Xe)||Mt.resetFadeLogic()}})(this._inViewTiles,I,H,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),K?this._cleanUpRasterTiles(H):this._cleanUpVectorTiles(H)}_cleanUpRasterTiles(u){for(const y of this._inViewTiles.getAllIds())u[y]||this._removeTile(y)}_cleanUpVectorTiles(u){for(const y of this._inViewTiles.getAllIds()){const I=this._inViewTiles.getTileById(y);u[y]?I.clearSymbolFadeHold():I.hasSymbolBuckets?I.holdingForSymbolFade()?I.symbolFadeFinished()&&this._removeTile(y):I.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(y)}}_addTerrainIdealTiles(u){const y=[];for(const I of u)if(I.canonical.z>this._source.minzoom){const D=I.scaledTo(I.canonical.z-1);y.push(D);const j=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));y.push(j)}return u.concat(y)}releaseSymbolFadeTiles(){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).holdingForSymbolFade()&&this._removeTile(u)}_updateRetainedTiles(u,y){var I;const D=new Set;for(const ge of u)this._addTile(ge).hasData()||D.add(ge);const j=u.reduce(((ge,xe)=>(ge[xe.key]=xe,ge)),{}),H=this._retainLoadedChildren(j,D),K={},te=Math.max(y-we.maxUnderzooming,this._source.minzoom);for(const ge of H){let xe=this._inViewTiles.getTileById(ge.key),fe=xe?.wasRequested();for(let De=ge.overscaledZ-1;De>=te;--De){const Ve=ge.scaledTo(De);if(K[Ve.key])break;if(K[Ve.key]=!0,xe=this.getTile(Ve),!xe&&fe&&(xe=this._addTile(Ve)),xe){const Xe=xe.hasData();if((Xe||!(!((I=this.map)===null||I===void 0)&&I.cancelPendingTileRequestsWhileZooming)||fe)&&(j[Ve.key]=Ve),fe=xe.wasRequested(),Xe)break}}}return j}_addTile(u){let y=this._inViewTiles.getTileById(u.key);if(y)return y;y=this._outOfViewCache.getAndRemove(u),y&&(y.resetFadeLogic(),this._setTileReloadTimer(u.key,y),y.tileID=u,this._state.initializeTileState(y,this.map?this.map.painter:null));const I=y;return y||(y=new un(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(y,u.key,y.state)),y.uses++,this._inViewTiles.setTile(u.key,y),I||this._source.fire(new t.l("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y}_setTileReloadTimer(u,y){this._clearTileReloadTimer(u);const I=y.getExpiryTimeout();I&&(this._timers[u]=setTimeout((()=>{this._reloadTile(u,"expired"),delete this._timers[u]}),I))}_clearTileReloadTimer(u){const y=this._timers[u];y&&(clearTimeout(y),delete this._timers[u])}_resetTileReloadTimers(){for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u of this._inViewTiles.getAllIds()){const y=this._inViewTiles.getTileById(u);this._setTileReloadTimer(u,y)}}refreshTiles(u){for(const y of this._inViewTiles.getAllIds()){const I=this._inViewTiles.getTileById(y);(this._inViewTiles.isIdRenderable(y)||I.state=="errored")&&u.some((D=>D.equals(I.tileID.canonical)))&&this._reloadTile(y,"expired")}}_removeTile(u){const y=this._inViewTiles.getTileById(u);y&&(y.uses--,this._inViewTiles.deleteTileById(u),this._clearTileReloadTimer(u),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._outOfViewCache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))}_dataHandler(u){u.dataType==="source"&&(u.sourceDataType!=="metadata"?u.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(u.sourceDataChanged,u.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u of this._inViewTiles.getAllIds())this._removeTile(u);this._outOfViewCache.reset()}tilesIn(u,y,I){const D=[],j=this.transform;if(!j)return D;const H=j.getCoveringTilesDetailsProvider().allowWorldCopies(),K=I?j.getCameraQueryGeometry(u):u,te=Ve=>j.screenPointToMercatorCoordinate(Ve,this.terrain),ge=this.transformBbox(u,te,!H),xe=this.transformBbox(K,te,!H),fe=this.getIds(),De=t.aa.fromPoints(xe);for(let Ve=0;Ve<fe.length;Ve++){const Xe=this._inViewTiles.getTileById(fe[Ve]);if(Xe.holdingForSymbolFade())continue;const xt=H?[Xe.tileID]:[Xe.tileID.unwrapTo(-1),Xe.tileID.unwrapTo(0)],wt=Math.pow(2,j.zoom-Xe.tileID.overscaledZ),Tt=y*Xe.queryPadding*t.a5/Xe.tileSize/wt;for(const Mt of xt){const Yt=De.map((Rt=>Mt.getTilePoint(new t.a9(Rt.x,Rt.y))));if(Yt.expandBy(Tt),Yt.intersects(Bo)){const Rt=ge.map((ei=>Mt.getTilePoint(ei))),Zt=xe.map((ei=>Mt.getTilePoint(ei)));D.push({tile:Xe,tileID:H?Mt:Mt.unwrapTo(0),queryGeometry:Rt,cameraQueryGeometry:Zt,scale:wt})}}}return D}transformBbox(u,y,I){let D=u.map(y);if(I){const j=t.aa.fromPoints(u);j.shrinkBy(.001*Math.min(j.width(),j.height()));const H=j.map(y);t.aa.fromPoints(D).covers(H)||(D=D.map((K=>K.x>.5?new t.a9(K.x-1,K.y,K.z):K)))}return D}getVisibleCoordinates(u){const y=this.getRenderableIds(u).map((I=>this._inViewTiles.getTileById(I).tileID));return this.transform&&this.transform.populateCache(y),y}hasTransition(){return!!this._source.hasTransition()||!(!sa(this._source.type)||!(function(u,y){if(y<=0)return!1;const I=se();for(const D of u.getAllTiles())if(D.fadeEndTime>=I)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(u){this._rasterFadeDuration=u}setFeatureState(u,y,I){this._state.updateState(u=u||t.ai,y,I)}removeFeatureState(u,y,I){this._state.removeFeatureState(u=u||t.ai,y,I)}getFeatureState(u,y){return this._state.getState(u=u||t.ai,y)}setDependencies(u,y,I){const D=this._inViewTiles.getTileById(u);D&&D.setDependencies(y,I)}reloadTilesForDependencies(u,y){for(const I of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(I).hasDependency(u,y)&&this._reloadTile(I,"reloading");this._outOfViewCache.filter((I=>!I.hasDependency(u,y)))}areTilesLoaded(){for(const u of this._inViewTiles.getAllTiles())if(u.state!=="loaded"&&u.state!=="errored")return!1;return!0}}we.maxUnderzooming=10,we.maxOverzooming=3;class Ie{constructor(u,y){this.reset(u,y)}reset(u,y){this.points=u||[],this._distances=[0];for(let I=1;I<this.points.length;I++)this._distances[I]=this._distances[I-1]+this.points[I].dist(this.points[I-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(y||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=t.an(u,0,1);let y=1,I=this._distances[y];const D=u*this.paddedLength+this.padding;for(;I<D&&y<this._distances.length;)I=this._distances[++y];const j=y-1,H=this._distances[j],K=I-H,te=K>0?(D-H)/K:0;return this.points[j].mult(1-te).add(this.points[y].mult(te))}}function qe(V,u){let y=!0;return V==="always"||V!=="never"&&u!=="never"||(y=!1),y}class ot{constructor(u,y,I){const D=this.boxCells=[],j=this.circleCells=[];this.xCellCount=Math.ceil(u/I),this.yCellCount=Math.ceil(y/I);for(let H=0;H<this.xCellCount*this.yCellCount;H++)D.push([]),j.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=y,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/y,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,y,I,D,j){this._forEachCell(y,I,D,j,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(y),this.bboxes.push(I),this.bboxes.push(D),this.bboxes.push(j)}insertCircle(u,y,I,D){this._forEachCell(y-D,I-D,y+D,I+D,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(y),this.circles.push(I),this.circles.push(D)}_insertBoxCell(u,y,I,D,j,H){this.boxCells[j].push(H)}_insertCircleCell(u,y,I,D,j,H){this.circleCells[j].push(H)}_query(u,y,I,D,j,H,K){if(I<0||u>this.width||D<0||y>this.height)return[];const te=[];if(u<=0&&y<=0&&this.width<=I&&this.height<=D){if(j)return[{key:null,x1:u,y1:y,x2:I,y2:D}];for(let ge=0;ge<this.boxKeys.length;ge++)te.push({key:this.boxKeys[ge],x1:this.bboxes[4*ge],y1:this.bboxes[4*ge+1],x2:this.bboxes[4*ge+2],y2:this.bboxes[4*ge+3]});for(let ge=0;ge<this.circleKeys.length;ge++){const xe=this.circles[3*ge],fe=this.circles[3*ge+1],De=this.circles[3*ge+2];te.push({key:this.circleKeys[ge],x1:xe-De,y1:fe-De,x2:xe+De,y2:fe+De})}}else this._forEachCell(u,y,I,D,this._queryCell,te,{hitTest:j,overlapMode:H,seenUids:{box:{},circle:{}}},K);return te}query(u,y,I,D){return this._query(u,y,I,D,!1,null)}hitTest(u,y,I,D,j,H){return this._query(u,y,I,D,!0,j,H).length>0}hitTestCircle(u,y,I,D,j){const H=u-I,K=u+I,te=y-I,ge=y+I;if(K<0||H>this.width||ge<0||te>this.height)return!1;const xe=[];return this._forEachCell(H,te,K,ge,this._queryCellCircle,xe,{hitTest:!0,overlapMode:D,circle:{x:u,y,radius:I},seenUids:{box:{},circle:{}}},j),xe.length>0}_queryCell(u,y,I,D,j,H,K,te){const{seenUids:ge,hitTest:xe,overlapMode:fe}=K,De=this.boxCells[j];if(De!==null){const Xe=this.bboxes;for(const xt of De)if(!ge.box[xt]){ge.box[xt]=!0;const wt=4*xt,Tt=this.boxKeys[xt];if(u<=Xe[wt+2]&&y<=Xe[wt+3]&&I>=Xe[wt+0]&&D>=Xe[wt+1]&&(!te||te(Tt))&&(!xe||!qe(fe,Tt.overlapMode))&&(H.push({key:Tt,x1:Xe[wt],y1:Xe[wt+1],x2:Xe[wt+2],y2:Xe[wt+3]}),xe))return!0}}const Ve=this.circleCells[j];if(Ve!==null){const Xe=this.circles;for(const xt of Ve)if(!ge.circle[xt]){ge.circle[xt]=!0;const wt=3*xt,Tt=this.circleKeys[xt];if(this._circleAndRectCollide(Xe[wt],Xe[wt+1],Xe[wt+2],u,y,I,D)&&(!te||te(Tt))&&(!xe||!qe(fe,Tt.overlapMode))){const Mt=Xe[wt],Yt=Xe[wt+1],Rt=Xe[wt+2];if(H.push({key:Tt,x1:Mt-Rt,y1:Yt-Rt,x2:Mt+Rt,y2:Yt+Rt}),xe)return!0}}}return!1}_queryCellCircle(u,y,I,D,j,H,K,te){const{circle:ge,seenUids:xe,overlapMode:fe}=K,De=this.boxCells[j];if(De!==null){const Xe=this.bboxes;for(const xt of De)if(!xe.box[xt]){xe.box[xt]=!0;const wt=4*xt,Tt=this.boxKeys[xt];if(this._circleAndRectCollide(ge.x,ge.y,ge.radius,Xe[wt+0],Xe[wt+1],Xe[wt+2],Xe[wt+3])&&(!te||te(Tt))&&!qe(fe,Tt.overlapMode))return H.push(!0),!0}}const Ve=this.circleCells[j];if(Ve!==null){const Xe=this.circles;for(const xt of Ve)if(!xe.circle[xt]){xe.circle[xt]=!0;const wt=3*xt,Tt=this.circleKeys[xt];if(this._circlesCollide(Xe[wt],Xe[wt+1],Xe[wt+2],ge.x,ge.y,ge.radius)&&(!te||te(Tt))&&!qe(fe,Tt.overlapMode))return H.push(!0),!0}}}_forEachCell(u,y,I,D,j,H,K,te){const ge=this._convertToXCellCoord(u),xe=this._convertToYCellCoord(y),fe=this._convertToXCellCoord(I),De=this._convertToYCellCoord(D);for(let Ve=ge;Ve<=fe;Ve++)for(let Xe=xe;Xe<=De;Xe++)if(j.call(this,u,y,I,D,this.xCellCount*Xe+Ve,H,K,te))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,y,I,D,j,H){const K=D-u,te=j-y,ge=I+H;return ge*ge>K*K+te*te}_circleAndRectCollide(u,y,I,D,j,H,K){const te=(H-D)/2,ge=Math.abs(u-(D+te));if(ge>te+I)return!1;const xe=(K-j)/2,fe=Math.abs(y-(j+xe));if(fe>xe+I)return!1;if(ge<=te||fe<=xe)return!0;const De=ge-te,Ve=fe-xe;return De*De+Ve*Ve<=I*I}}function ft(V,u,y){const I=t.N();if(!V){const{vecSouth:fe,vecEast:De}=Jt(u),Ve=O();Ve[0]=De[0],Ve[1]=De[1],Ve[2]=fe[0],Ve[3]=fe[1],D=Ve,(xe=(H=(j=Ve)[0])*(ge=j[3])-(te=j[2])*(K=j[1]))&&(D[0]=ge*(xe=1/xe),D[1]=-K*xe,D[2]=-te*xe,D[3]=H*xe),I[0]=Ve[0],I[1]=Ve[1],I[4]=Ve[2],I[5]=Ve[3]}var D,j,H,K,te,ge,xe;return t.Q(I,I,[1/y,1/y,1]),I}function Ct(V,u,y,I){if(V){const D=t.N();if(!u){const{vecSouth:j,vecEast:H}=Jt(y);D[0]=H[0],D[1]=H[1],D[4]=j[0],D[5]=j[1]}return t.Q(D,D,[I,I,1]),D}return y.pixelsToClipSpaceMatrix}function Jt(V){const u=Math.cos(V.rollInRadians),y=Math.sin(V.rollInRadians),I=Math.cos(V.pitchInRadians),D=Math.cos(V.bearingInRadians),j=Math.sin(V.bearingInRadians),H=t.aC();H[0]=-D*I*y-j*u,H[1]=-j*I*y+D*u;const K=t.aD(H);K<1e-9?t.aE(H):t.aF(H,H,1/K);const te=t.aC();te[0]=D*I*u-j*y,te[1]=j*I*u+D*y;const ge=t.aD(te);return ge<1e-9?t.aE(te):t.aF(te,te,1/ge),{vecEast:te,vecSouth:H}}function _t(V,u,y,I){let D;I?(D=[V,u,I(V,u),1],t.aH(D,D,y)):(D=[V,u,0,1],ao(D,D,y));const j=D[3];return{point:new t.P(D[0]/j,D[1]/j),signedDistanceFromCamera:j,isOccluded:!1}}function Qt(V,u){return .5+V/u*.5}function Ri(V,u){return V.x>=-u[0]&&V.x<=u[0]&&V.y>=-u[1]&&V.y<=u[1]}function xi(V,u,y,I,D,j,H,K,te,ge,xe,fe,De){const Ve=y?V.textSizeData:V.iconSizeData,Xe=t.ay(Ve,u.transform.zoom),xt=[256/u.width*2+1,256/u.height*2+1],wt=y?V.text.dynamicLayoutVertexArray:V.icon.dynamicLayoutVertexArray;wt.clear();const Tt=V.lineVertexArray,Mt=y?V.text.placedSymbolArray:V.icon.placedSymbolArray,Yt=u.transform.width/u.transform.height;let Rt=!1;for(let Zt=0;Zt<Mt.length;Zt++){const ei=Mt.get(Zt);if(ei.hidden||ei.writingMode===t.az.vertical&&!Rt){Wr(ei.numGlyphs,wt);continue}Rt=!1;const Ut=new t.P(ei.anchorX,ei.anchorY),hi={getElevation:De,pitchedLabelPlaneMatrix:I,lineVertexArray:Tt,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:u.transform,tileAnchorPoint:Ut,unwrappedTileID:te,width:ge,height:xe,translation:fe},$i=io(ei.anchorX,ei.anchorY,hi);if(!Ri($i.point,xt)){Wr(ei.numGlyphs,wt);continue}const ki=Qt(u.transform.cameraToCenterDistance,$i.signedDistanceFromCamera),Di=t.aA(Ve,Xe,ei),Pi=j?Di*u.transform.getPitchedTextCorrection(ei.anchorX,ei.anchorY,te)/ki:Di*ki,On=mn({projectionContext:hi,pitchedLabelPlaneMatrixInverse:D,symbol:ei,fontSize:Pi,flip:!1,keepUpright:H,glyphOffsetArray:V.glyphOffsetArray,dynamicLayoutVertexArray:wt,aspectRatio:Yt,rotateToLine:K});Rt=On.useVertical,(On.notEnoughRoom||Rt||On.needsFlipping&&mn({projectionContext:hi,pitchedLabelPlaneMatrixInverse:D,symbol:ei,fontSize:Pi,flip:!0,keepUpright:H,glyphOffsetArray:V.glyphOffsetArray,dynamicLayoutVertexArray:wt,aspectRatio:Yt,rotateToLine:K}).notEnoughRoom)&&Wr(ei.numGlyphs,wt)}y?V.text.dynamicLayoutVertexBuffer.updateData(wt):V.icon.dynamicLayoutVertexBuffer.updateData(wt)}function yn(V,u,y,I,D,j,H,K){const te=j.glyphStartIndex+j.numGlyphs,ge=j.lineStartIndex,xe=j.lineStartIndex+j.lineLength,fe=u.getoffsetX(j.glyphStartIndex),De=u.getoffsetX(te-1),Ve=po(V*fe,y,I,D,j.segment,ge,xe,K,H);if(!Ve)return null;const Xe=po(V*De,y,I,D,j.segment,ge,xe,K,H);return Xe?K.projectionCache.anyProjectionOccluded?null:{first:Ve,last:Xe}:null}function $n(V,u,y,I){return V===t.az.horizontal&&Math.abs(y.y-u.y)>Math.abs(y.x-u.x)*I?{useVertical:!0}:(V===t.az.vertical?u.y<y.y:u.x>y.x)?{needsFlipping:!0}:null}function mn(V){const{projectionContext:u,pitchedLabelPlaneMatrixInverse:y,symbol:I,fontSize:D,flip:j,keepUpright:H,glyphOffsetArray:K,dynamicLayoutVertexArray:te,aspectRatio:ge,rotateToLine:xe}=V,fe=D/24,De=I.lineOffsetX*fe,Ve=I.lineOffsetY*fe;let Xe;if(I.numGlyphs>1){const xt=I.glyphStartIndex+I.numGlyphs,wt=I.lineStartIndex,Tt=I.lineStartIndex+I.lineLength,Mt=yn(fe,K,De,Ve,j,I,xe,u);if(!Mt)return{notEnoughRoom:!0};const Yt=Kr(Mt.first.point.x,Mt.first.point.y,u,y),Rt=Kr(Mt.last.point.x,Mt.last.point.y,u,y);if(H&&!j){const Zt=$n(I.writingMode,Yt,Rt,ge);if(Zt)return Zt}Xe=[Mt.first];for(let Zt=I.glyphStartIndex+1;Zt<xt-1;Zt++){const ei=po(fe*K.getoffsetX(Zt),De,Ve,j,I.segment,wt,Tt,u,xe);if(!ei)return{notEnoughRoom:!0};Xe.push(ei)}Xe.push(Mt.last)}else{if(H&&!j){const wt=jn(u.tileAnchorPoint.x,u.tileAnchorPoint.y,u).point,Tt=I.lineStartIndex+I.segment+1,Mt=new t.P(u.lineVertexArray.getx(Tt),u.lineVertexArray.gety(Tt)),Yt=jn(Mt.x,Mt.y,u),Rt=Yt.signedDistanceFromCamera>0?Yt.point:Tr(u.tileAnchorPoint,Mt,wt,1,u),Zt=Kr(wt.x,wt.y,u,y),ei=Kr(Rt.x,Rt.y,u,y),Ut=$n(I.writingMode,Zt,ei,ge);if(Ut)return Ut}const xt=po(fe*K.getoffsetX(I.glyphStartIndex),De,Ve,j,I.segment,I.lineStartIndex,I.lineStartIndex+I.lineLength,u,xe);if(!xt||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Xe=[xt]}for(const xt of Xe)t.aG(te,xt.point,xt.angle);return{}}function Tr(V,u,y,I,D){const j=V.add(V.sub(u)._unit()),H=jn(j.x,j.y,D).point,K=y.sub(H);return y.add(K._mult(I/K.mag()))}function rr(V,u,y){const I=u.projectionCache;if(I.projections[V])return I.projections[V];const D=new t.P(u.lineVertexArray.getx(V),u.lineVertexArray.gety(V)),j=jn(D.x,D.y,u);if(j.signedDistanceFromCamera>0)return I.projections[V]=j.point,I.anyProjectionOccluded=I.anyProjectionOccluded||j.isOccluded,j.point;const H=V-y.direction;return Tr(y.distanceFromAnchor===0?u.tileAnchorPoint:new t.P(u.lineVertexArray.getx(H),u.lineVertexArray.gety(H)),D,y.previousVertex,y.absOffsetX-y.distanceFromAnchor+1,u)}function jn(V,u,y){const I=V+y.translation[0],D=u+y.translation[1];let j;return y.pitchWithMap?(j=_t(I,D,y.pitchedLabelPlaneMatrix,y.getElevation),j.isOccluded=!1):(j=y.transform.projectTileCoordinates(I,D,y.unwrappedTileID,y.getElevation),j.point.x=(.5*j.point.x+.5)*y.width,j.point.y=(.5*-j.point.y+.5)*y.height),j}function Kr(V,u,y,I){if(y.pitchWithMap){const D=[V,u,0,1];return t.aH(D,D,I),y.transform.projectTileCoordinates(D[0]/D[3],D[1]/D[3],y.unwrappedTileID,y.getElevation).point}return{x:V/y.width*2-1,y:1-u/y.height*2}}function io(V,u,y){return y.transform.projectTileCoordinates(V,u,y.unwrappedTileID,y.getElevation)}function No(V,u,y){return V._unit()._perp()._mult(u*y)}function oo(V,u,y,I,D,j,H,K,te){if(K.projectionCache.offsets[V])return K.projectionCache.offsets[V];const ge=y.add(u);if(V+te.direction<I||V+te.direction>=D)return K.projectionCache.offsets[V]=ge,ge;const xe=rr(V+te.direction,K,te),fe=No(xe.sub(y),H,te.direction),De=y.add(fe),Ve=xe.add(fe);return K.projectionCache.offsets[V]=t.aI(j,ge,De,Ve)||ge,K.projectionCache.offsets[V]}function po(V,u,y,I,D,j,H,K,te){const ge=I?V-u:V+u;let xe=ge>0?1:-1,fe=0;I&&(xe*=-1,fe=Math.PI),xe<0&&(fe+=Math.PI);let De,Ve=xe>0?j+D:j+D+1;K.projectionCache.cachedAnchorPoint?De=K.projectionCache.cachedAnchorPoint:(De=jn(K.tileAnchorPoint.x,K.tileAnchorPoint.y,K).point,K.projectionCache.cachedAnchorPoint=De);let Xe,xt,wt=De,Tt=De,Mt=0,Yt=0;const Rt=Math.abs(ge),Zt=[];let ei;for(;Mt+Yt<=Rt;){if(Ve+=xe,Ve<j||Ve>=H)return null;Mt+=Yt,Tt=wt,xt=Xe;const $i={absOffsetX:Rt,direction:xe,distanceFromAnchor:Mt,previousVertex:Tt};if(wt=rr(Ve,K,$i),y===0)Zt.push(Tt),ei=wt.sub(Tt);else{let ki;const Di=wt.sub(Tt);ki=Di.mag()===0?No(rr(Ve+xe,K,$i).sub(wt),y,xe):No(Di,y,xe),xt||(xt=Tt.add(ki)),Xe=oo(Ve,ki,wt,j,H,xt,y,K,$i),Zt.push(xt),ei=Xe.sub(xt)}Yt=ei.mag()}const Ut=ei._mult((Rt-Mt)/Yt)._add(xt||Tt),hi=fe+Math.atan2(wt.y-Tt.y,wt.x-Tt.x);return Zt.push(Ut),{point:Ut,angle:te?hi:0,path:Zt}}const go=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wr(V,u){for(let y=0;y<V;y++){const I=u.length;u.resize(I+4),u.float32.set(go,3*I)}}function ao(V,u,y){const I=u[0],D=u[1];return V[0]=y[0]*I+y[4]*D+y[12],V[1]=y[1]*I+y[5]*D+y[13],V[3]=y[3]*I+y[7]*D+y[15],V}const Br=100;class qr{constructor(u,y=new ot(u.width+200,u.height+200,25),I=new ot(u.width+200,u.height+200,25)){this.transform=u,this.grid=y,this.ignoredGrid=I,this.pitchFactor=Math.cos(u.pitch*Math.PI/180)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Br,this.screenBottomBoundary=u.height+Br,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(u,y,I,D,j,H,K,te,ge,xe,fe,De){const Ve=this.projectAndGetPerspectiveRatio(u.anchorPointX+te[0],u.anchorPointY+te[1],j,xe,De),Xe=I*Ve.perspectiveRatio;let xt;if(H||K)xt=this._projectCollisionBox(u,Xe,D,j,H,K,te,Ve,xe,fe,De);else{const ei=Ve.x+(fe?fe.x*Xe:0),Ut=Ve.y+(fe?fe.y*Xe:0);xt={allPointsOccluded:!1,box:[ei+u.x1*Xe,Ut+u.y1*Xe,ei+u.x2*Xe,Ut+u.y2*Xe]}}const[wt,Tt,Mt,Yt]=xt.box,Rt=H?xt.allPointsOccluded:Ve.isOccluded;let Zt=Rt;return Zt||(Zt=Ve.perspectiveRatio<this.perspectiveRatioCutoff),Zt||(Zt=!this.isInsideGrid(wt,Tt,Mt,Yt)),Zt||y!=="always"&&this.grid.hitTest(wt,Tt,Mt,Yt,y,ge)?{box:[wt,Tt,Mt,Yt],placeable:!1,offscreen:!1,occluded:Rt}:{box:[wt,Tt,Mt,Yt],placeable:!0,offscreen:this.isOffscreen(wt,Tt,Mt,Yt),occluded:Rt}}placeCollisionCircles(u,y,I,D,j,H,K,te,ge,xe,fe,De,Ve,Xe){const xt=[],wt=new t.P(y.anchorX,y.anchorY),Tt=this.getPerspectiveRatio(wt.x,wt.y,H,Xe),Mt=(ge?j*this.transform.getPitchedTextCorrection(y.anchorX,y.anchorY,H)/Tt:j*Tt)/t.aM,Yt={getElevation:Xe,pitchedLabelPlaneMatrix:K,lineVertexArray:I,pitchWithMap:ge,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:wt,unwrappedTileID:H,width:this.transform.width,height:this.transform.height,translation:Ve},Rt=yn(Mt,D,y.lineOffsetX*Mt,y.lineOffsetY*Mt,!1,y,!1,Yt);let Zt=!1,ei=!1,Ut=!0;if(Rt){const hi=.5*fe*Tt+De,$i=new t.P(-100,-100),ki=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Di=new Ie,Pi=Rt.first,On=Rt.last;let Nn=[];for(let Zr=Pi.path.length-1;Zr>=1;Zr--)Nn.push(Pi.path[Zr]);for(let Zr=1;Zr<On.path.length;Zr++)Nn.push(On.path[Zr]);const bn=2.5*hi;if(ge){const Zr=this.projectPathToScreenSpace(Nn,Yt);Nn=Zr.some((Ps=>Ps.signedDistanceFromCamera<=0))?[]:Zr.map((Ps=>Ps.point))}let Yn=[];if(Nn.length>0){const Zr=Nn[0].clone(),Ps=Nn[0].clone();for(let ia=1;ia<Nn.length;ia++)Zr.x=Math.min(Zr.x,Nn[ia].x),Zr.y=Math.min(Zr.y,Nn[ia].y),Ps.x=Math.max(Ps.x,Nn[ia].x),Ps.y=Math.max(Ps.y,Nn[ia].y);Yn=Zr.x>=$i.x&&Ps.x<=ki.x&&Zr.y>=$i.y&&Ps.y<=ki.y?[Nn]:Ps.x<$i.x||Zr.x>ki.x||Ps.y<$i.y||Zr.y>ki.y?[]:t.aJ([Nn],$i.x,$i.y,ki.x,ki.y)}for(const Zr of Yn){Di.reset(Zr,.25*hi);let Ps=0;Ps=Di.length<=.5*hi?1:Math.ceil(Di.paddedLength/bn)+1;for(let ia=0;ia<Ps;ia++){const Eo=ia/Math.max(Ps-1,1),fa=Di.lerp(Eo),Nr=fa.x+Br,hr=fa.y+Br;xt.push(Nr,hr,hi,0);const oa=Nr-hi,pa=hr-hi,aa=Nr+hi,na=hr+hi;if(Ut=Ut&&this.isOffscreen(oa,pa,aa,na),ei=ei||this.isInsideGrid(oa,pa,aa,na),u!=="always"&&this.grid.hitTestCircle(Nr,hr,hi,u,xe)&&(Zt=!0,!te))return{circles:[],offscreen:!1,collisionDetected:Zt}}}}return{circles:!te&&Zt||!ei||Tt<this.perspectiveRatioCutoff?[]:xt,offscreen:Ut,collisionDetected:Zt}}projectPathToScreenSpace(u,y){const I=(function(D,j){const H=t.N();return t.aB(H,j.pitchedLabelPlaneMatrix),D.map((K=>{const te=_t(K.x,K.y,H,j.getElevation),ge=j.transform.projectTileCoordinates(te.point.x,te.point.y,j.unwrappedTileID,j.getElevation);return ge.point.x=(.5*ge.point.x+.5)*j.width,ge.point.y=(.5*-ge.point.y+.5)*j.height,ge}))})(u,y);return(function(D){let j=0,H=0,K=0,te=0;for(let ge=0;ge<D.length;ge++)D[ge].isOccluded?(K=ge+1,te=0):(te++,te>H&&(H=te,j=K));return D.slice(j,j+H)})(I)}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const y=[],I=new t.aa;for(const fe of u){const De=new t.P(fe.x+Br,fe.y+Br);I.extend(De),y.push(De)}const{minX:D,minY:j,maxX:H,maxY:K}=I,te=this.grid.query(D,j,H,K).concat(this.ignoredGrid.query(D,j,H,K)),ge={},xe={};for(const fe of te){const De=fe.key;if(ge[De.bucketInstanceId]===void 0&&(ge[De.bucketInstanceId]={}),ge[De.bucketInstanceId][De.featureIndex])continue;const Ve=[new t.P(fe.x1,fe.y1),new t.P(fe.x2,fe.y1),new t.P(fe.x2,fe.y2),new t.P(fe.x1,fe.y2)];t.aK(y,Ve)&&(ge[De.bucketInstanceId][De.featureIndex]=!0,xe[De.bucketInstanceId]===void 0&&(xe[De.bucketInstanceId]=[]),xe[De.bucketInstanceId].push(De.featureIndex))}return xe}insertCollisionBox(u,y,I,D,j,H){(I?this.ignoredGrid:this.grid).insert({bucketInstanceId:D,featureIndex:j,collisionGroupID:H,overlapMode:y},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,y,I,D,j,H){const K=I?this.ignoredGrid:this.grid,te={bucketInstanceId:D,featureIndex:j,collisionGroupID:H,overlapMode:y};for(let ge=0;ge<u.length;ge+=4)K.insertCircle(te,u[ge],u[ge+1],u[ge+2])}projectAndGetPerspectiveRatio(u,y,I,D,j){if(j){let H;D?(H=[u,y,D(u,y),1],t.aH(H,H,j)):(H=[u,y,0,1],ao(H,H,j));const K=H[3];return{x:(H[0]/K+1)/2*this.transform.width+Br,y:(-H[1]/K+1)/2*this.transform.height+Br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/K*.5,isOccluded:!1,signedDistanceFromCamera:K}}{const H=this.transform.projectTileCoordinates(u,y,I,D);return{x:(H.point.x+1)/2*this.transform.width+Br,y:(1-H.point.y)/2*this.transform.height+Br,perspectiveRatio:.5+this.transform.cameraToCenterDistance/H.signedDistanceFromCamera*.5,isOccluded:H.isOccluded,signedDistanceFromCamera:H.signedDistanceFromCamera}}}getPerspectiveRatio(u,y,I,D){const j=this.transform.projectTileCoordinates(u,y,I,D);return .5+this.transform.cameraToCenterDistance/j.signedDistanceFromCamera*.5}isOffscreen(u,y,I,D){return I<Br||u>=this.screenRightBoundary||D<Br||y>this.screenBottomBoundary}isInsideGrid(u,y,I,D){return I>=0&&u<this.gridRightBoundary&&D>=0&&y<this.gridBottomBoundary}getViewportMatrix(){const u=t.ar([]);return t.O(u,u,[-100,-100,0]),u}_projectCollisionBox(u,y,I,D,j,H,K,te,ge,xe,fe){let De=1,Ve=0,Xe=0,xt=1;const wt=u.anchorPointX+K[0],Tt=u.anchorPointY+K[1];if(H&&!j){const Nn=this.projectAndGetPerspectiveRatio(wt+1,Tt,D,ge,fe),bn=Nn.x-te.x,Yn=Math.atan((Nn.y-te.y)/bn)+(bn<0?Math.PI:0),Zr=Math.sin(Yn),Ps=Math.cos(Yn);De=Ps,Ve=Zr,Xe=-Zr,xt=Ps}else if(!H&&j){const Nn=Jt(this.transform);De=Nn.vecEast[0],Ve=Nn.vecEast[1],Xe=Nn.vecSouth[0],xt=Nn.vecSouth[1]}let Mt=te.x,Yt=te.y,Rt=y;j&&(Mt=wt,Yt=Tt,Rt=Math.pow(2,-(this.transform.zoom-I.overscaledZ)),Rt*=this.transform.getPitchedTextCorrection(wt,Tt,D),xe||(Rt*=t.an(.5+te.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),xe&&(Mt+=De*xe.x*Rt+Xe*xe.y*Rt,Yt+=Ve*xe.x*Rt+xt*xe.y*Rt);const Zt=u.x1*Rt,ei=u.x2*Rt,Ut=(Zt+ei)/2,hi=u.y1*Rt,$i=u.y2*Rt,ki=(hi+$i)/2,Di=[{offsetX:Zt,offsetY:hi},{offsetX:Ut,offsetY:hi},{offsetX:ei,offsetY:hi},{offsetX:ei,offsetY:ki},{offsetX:ei,offsetY:$i},{offsetX:Ut,offsetY:$i},{offsetX:Zt,offsetY:$i},{offsetX:Zt,offsetY:ki}];let Pi=[];for(const{offsetX:Nn,offsetY:bn}of Di)Pi.push(new t.P(Mt+De*Nn+Xe*bn,Yt+Ve*Nn+xt*bn));let On=!1;if(j){const Nn=Pi.map((bn=>this.projectAndGetPerspectiveRatio(bn.x,bn.y,D,ge,fe)));On=Nn.some((bn=>!bn.isOccluded)),Pi=Nn.map((bn=>new t.P(bn.x,bn.y)))}else On=!0;return{box:t.aL(Pi),allPointsOccluded:!On}}}class Po{constructor(u,y,I,D){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?y:-y))):D&&I?1:0,this.placed=I}isHidden(){return this.opacity===0&&!this.placed}}class Ra{constructor(u,y,I,D,j){this.text=new Po(u?u.text:null,y,I,j),this.icon=new Po(u?u.icon:null,y,D,j)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _l{constructor(u,y,I){this.text=u,this.icon=y,this.skipFade=I}}class Hl{constructor(u,y,I,D,j){this.bucketInstanceId=u,this.featureIndex=y,this.sourceLayerIndex=I,this.bucketIndex=D,this.tileID=j}}class dd{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const y=++this.maxGroupID;this.collisionGroups[u]={ID:y,predicate:I=>I.collisionGroupID===y}}return this.collisionGroups[u]}}function wa(V,u,y,I,D){const{horizontalAlign:j,verticalAlign:H}=t.aS(V);return new t.P(-(j-.5)*u+I[0]*D,-(H-.5)*y+I[1]*D)}class hc{constructor(u,y,I,D,j){this.transform=u.clone(),this.terrain=y,this.collisionIndex=new qr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=I,this.retainedQueryData={},this.collisionGroups=new dd(D),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=j,j&&(j.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(u){const y=this.terrain;return y?(I,D)=>y.getElevation(u,I,D):null}getBucketParts(u,y,I,D){const j=I.getBucket(y),H=I.latestFeatureIndex;if(!j||!H||y.id!==j.layerIds[0])return;const K=I.collisionBoxArray,te=j.layers[0].layout,ge=j.layers[0].paint,xe=Math.pow(2,this.transform.zoom-I.tileID.overscaledZ),fe=I.tileSize/t.a5,De=I.tileID.toUnwrapped(),Ve=te.get("text-rotation-alignment")==="map",Xe=t.aN(I,1,this.transform.zoom),xt=t.aO(this.collisionIndex.transform,I,ge.get("text-translate"),ge.get("text-translate-anchor")),wt=t.aO(this.collisionIndex.transform,I,ge.get("icon-translate"),ge.get("icon-translate-anchor")),Tt=ft(Ve,this.transform,Xe);this.retainedQueryData[j.bucketInstanceId]=new Hl(j.bucketInstanceId,H,j.sourceLayerIndex,j.index,I.tileID);const Mt={bucket:j,layout:te,translationText:xt,translationIcon:wt,unwrappedTileID:De,pitchedLabelPlaneMatrix:Tt,scale:xe,textPixelRatio:fe,holdingForFade:I.holdingForSymbolFade(),collisionBoxArray:K,partiallyEvaluatedTextSize:t.ay(j.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(j.sourceID)};if(D)for(const Yt of j.sortKeyRanges){const{sortKey:Rt,symbolInstanceStart:Zt,symbolInstanceEnd:ei}=Yt;u.push({sortKey:Rt,symbolInstanceStart:Zt,symbolInstanceEnd:ei,parameters:Mt})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:j.symbolInstances.length,parameters:Mt})}attemptAnchorPlacement(u,y,I,D,j,H,K,te,ge,xe,fe,De,Ve,Xe,xt,wt,Tt,Mt,Yt,Rt){const Zt=t.aP[u.textAnchor],ei=[u.textOffset0,u.textOffset1],Ut=wa(Zt,I,D,ei,j),hi=this.collisionIndex.placeCollisionBox(y,De,te,ge,xe,K,H,wt,fe.predicate,Yt,Ut,Rt);if((!Mt||this.collisionIndex.placeCollisionBox(Mt,De,te,ge,xe,K,H,Tt,fe.predicate,Yt,Ut,Rt).placeable)&&hi.placeable){let $i;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve.crossTileID]&&this.prevPlacement.placements[Ve.crossTileID]&&this.prevPlacement.placements[Ve.crossTileID].text&&($i=this.prevPlacement.variableOffsets[Ve.crossTileID].anchor),Ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ve.crossTileID]={textOffset:ei,width:I,height:D,anchor:Zt,textBoxScale:j,prevAnchor:$i},this.markUsedJustification(Xe,Zt,Ve,xt),Xe.allowVerticalPlacement&&(this.markUsedOrientation(Xe,xt,Ve),this.placedOrientations[Ve.crossTileID]=xt),{shift:Ut,placedGlyphBoxes:hi}}}placeLayerBucketPart(u,y,I){const{bucket:D,layout:j,translationText:H,translationIcon:K,unwrappedTileID:te,pitchedLabelPlaneMatrix:ge,textPixelRatio:xe,holdingForFade:fe,collisionBoxArray:De,partiallyEvaluatedTextSize:Ve,collisionGroup:Xe}=u.parameters,xt=j.get("text-optional"),wt=j.get("icon-optional"),Tt=t.aQ(j,"text-overlap","text-allow-overlap"),Mt=Tt==="always",Yt=t.aQ(j,"icon-overlap","icon-allow-overlap"),Rt=Yt==="always",Zt=j.get("text-rotation-alignment")==="map",ei=j.get("text-pitch-alignment")==="map",Ut=j.get("icon-text-fit")!=="none",hi=j.get("symbol-z-order")==="viewport-y",$i=Mt&&(Rt||!D.hasIconData()||wt),ki=Rt&&(Mt||!D.hasTextData()||xt);!D.collisionArrays&&De&&D.deserializeCollisionBoxes(De);const Di=this.retainedQueryData[D.bucketInstanceId].tileID,Pi=this._getTerrainElevationFunc(Di),On=this.transform.getFastPathSimpleProjectionMatrix(Di),Nn=(bn,Yn,Zr)=>{var Ps,ia;if(y[bn.crossTileID])return;if(fe)return void(this.placements[bn.crossTileID]=new _l(!1,!1,!1));let Eo=!1,fa=!1,Nr=!0,hr=null,oa={box:null,placeable:!1,offscreen:null,occluded:!1},pa={placeable:!1},aa=null,na=null,ma=null,fh=0,Vu=0,gu=0;Yn.textFeatureIndex?fh=Yn.textFeatureIndex:bn.useRuntimeCollisionCircles&&(fh=bn.featureIndex),Yn.verticalTextFeatureIndex&&(Vu=Yn.verticalTextFeatureIndex);const jl=Yn.textBox;if(jl){const mc=Uo=>{let Ws=t.az.horizontal;if(D.allowVerticalPlacement&&!Uo&&this.prevPlacement){const Ga=this.prevPlacement.placedOrientations[bn.crossTileID];Ga&&(this.placedOrientations[bn.crossTileID]=Ga,Ws=Ga,this.markUsedOrientation(D,Ws,bn))}return Ws},_u=(Uo,Ws)=>{if(D.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&Yn.verticalTextBox){for(const Ga of D.writingModes)if(Ga===t.az.vertical?(oa=Ws(),pa=oa):oa=Uo(),oa&&oa.placeable)break}else oa=Uo()},Yc=bn.textAnchorOffsetStartIndex,Ml=bn.textAnchorOffsetEndIndex;if(Ml===Yc){const Uo=(Ws,Ga)=>{const qa=this.collisionIndex.placeCollisionBox(Ws,Tt,xe,Di,te,ei,Zt,H,Xe.predicate,Pi,void 0,On);return qa&&qa.placeable&&(this.markUsedOrientation(D,Ga,bn),this.placedOrientations[bn.crossTileID]=Ga),qa};_u((()=>Uo(jl,t.az.horizontal)),(()=>{const Ws=Yn.verticalTextBox;return D.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&Ws?Uo(Ws,t.az.vertical):{box:null,offscreen:null}})),mc(oa&&oa.placeable)}else{let Uo=t.aP[(ia=(Ps=this.prevPlacement)===null||Ps===void 0?void 0:Ps.variableOffsets[bn.crossTileID])===null||ia===void 0?void 0:ia.anchor];const Ws=(qa,Yp,Qm)=>{const $o=qa.x2-qa.x1,fp=qa.y2-qa.y1,eg=bn.textBoxScale,Kp=Ut&&Yt==="never"?Yp:null;let Pc=null,ph=Tt==="never"?1:2,mh="never";Uo&&ph++;for(let zd=0;zd<ph;zd++){for(let yu=Yc;yu<Ml;yu++){const kl=D.textAnchorOffsets.get(yu);if(Uo&&kl.textAnchor!==Uo)continue;const ju=this.attemptAnchorPlacement(kl,qa,$o,fp,eg,Zt,ei,xe,Di,te,Xe,mh,bn,D,Qm,H,K,Kp,Pi);if(ju&&(Pc=ju.placedGlyphBoxes,Pc&&Pc.placeable))return Eo=!0,hr=ju.shift,Pc}Uo?Uo=null:mh=Tt}return I&&!Pc&&(Pc={box:this.collisionIndex.placeCollisionBox(jl,"always",xe,Di,te,ei,Zt,H,Xe.predicate,Pi,void 0,On).box,offscreen:!1,placeable:!1,occluded:!1}),Pc};_u((()=>Ws(jl,Yn.iconBox,t.az.horizontal)),(()=>{const qa=Yn.verticalTextBox;return D.allowVerticalPlacement&&(!oa||!oa.placeable)&&bn.numVerticalGlyphVertices>0&&qa?Ws(qa,Yn.verticalIconBox,t.az.vertical):{box:null,occluded:!0,offscreen:null}})),oa&&(Eo=oa.placeable,Nr=oa.offscreen);const Ga=mc(oa&&oa.placeable);if(!Eo&&this.prevPlacement){const qa=this.prevPlacement.variableOffsets[bn.crossTileID];qa&&(this.variableOffsets[bn.crossTileID]=qa,this.markUsedJustification(D,qa.anchor,bn,Ga))}}}if(aa=oa,Eo=aa&&aa.placeable,Nr=aa&&aa.offscreen,bn.useRuntimeCollisionCircles&&bn.centerJustifiedTextSymbolIndex>=0){const mc=D.text.placedSymbolArray.get(bn.centerJustifiedTextSymbolIndex),_u=t.aA(D.textSizeData,Ve,mc),Yc=j.get("text-padding");na=this.collisionIndex.placeCollisionCircles(Tt,mc,D.lineVertexArray,D.glyphOffsetArray,_u,te,ge,I,ei,Xe.predicate,bn.collisionCircleDiameter,Yc,H,Pi),na.circles.length&&na.collisionDetected&&!I&&t.w("Collisions detected, but collision boxes are not shown"),Eo=Mt||na.circles.length>0&&!na.collisionDetected,Nr=Nr&&na.offscreen}if(Yn.iconFeatureIndex&&(gu=Yn.iconFeatureIndex),Yn.iconBox){const mc=_u=>this.collisionIndex.placeCollisionBox(_u,Yt,xe,Di,te,ei,Zt,K,Xe.predicate,Pi,Ut&&hr?hr:void 0,On);pa&&pa.placeable&&Yn.verticalIconBox?(ma=mc(Yn.verticalIconBox),fa=ma.placeable):(ma=mc(Yn.iconBox),fa=ma.placeable),Nr=Nr&&ma.offscreen}const bl=xt||bn.numHorizontalGlyphVertices===0&&bn.numVerticalGlyphVertices===0,wl=wt||bn.numIconVertices===0;bl||wl?wl?bl||(fa=fa&&Eo):Eo=fa&&Eo:fa=Eo=fa&&Eo;const Xc=fa&&ma.placeable;if(Eo&&aa.placeable&&this.collisionIndex.insertCollisionBox(aa.box,Tt,j.get("text-ignore-placement"),D.bucketInstanceId,pa&&pa.placeable&&Vu?Vu:fh,Xe.ID),Xc&&this.collisionIndex.insertCollisionBox(ma.box,Yt,j.get("icon-ignore-placement"),D.bucketInstanceId,gu,Xe.ID),na&&Eo&&this.collisionIndex.insertCollisionCircles(na.circles,Tt,j.get("text-ignore-placement"),D.bucketInstanceId,fh,Xe.ID),I&&this.storeCollisionData(D.bucketInstanceId,Zr,Yn,aa,ma,na),bn.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(D.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[bn.crossTileID]=new _l((Eo||$i)&&!aa?.occluded,(fa||ki)&&!ma?.occluded,Nr||D.justReloaded),y[bn.crossTileID]=!0};if(hi){if(u.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const bn=D.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Yn=bn.length-1;Yn>=0;--Yn){const Zr=bn[Yn];Nn(D.symbolInstances.get(Zr),D.collisionArrays[Zr],Zr)}}else for(let bn=u.symbolInstanceStart;bn<u.symbolInstanceEnd;bn++)Nn(D.symbolInstances.get(bn),D.collisionArrays[bn],bn);D.justReloaded=!1}storeCollisionData(u,y,I,D,j,H){if(I.textBox||I.iconBox){let K,te;this.collisionBoxArrays.has(u)?K=this.collisionBoxArrays.get(u):(K=new Map,this.collisionBoxArrays.set(u,K)),K.has(y)?te=K.get(y):(te={text:null,icon:null},K.set(y,te)),I.textBox&&(te.text=D.box),I.iconBox&&(te.icon=j.box)}if(H){let K=this.collisionCircleArrays[u];K===void 0&&(K=this.collisionCircleArrays[u]=[]);for(let te=0;te<H.circles.length;te+=4)K.push(H.circles[te+0]-Br),K.push(H.circles[te+1]-Br),K.push(H.circles[te+2]),K.push(H.collisionDetected?1:0)}}markUsedJustification(u,y,I,D){let j;j=D===t.az.vertical?I.verticalPlacedTextSymbolIndex:{left:I.leftJustifiedTextSymbolIndex,center:I.centerJustifiedTextSymbolIndex,right:I.rightJustifiedTextSymbolIndex}[t.aR(y)];const H=[I.leftJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.rightJustifiedTextSymbolIndex,I.verticalPlacedTextSymbolIndex];for(const K of H)K>=0&&(u.text.placedSymbolArray.get(K).crossTileID=j>=0&&K!==j?0:I.crossTileID)}markUsedOrientation(u,y,I){const D=y===t.az.horizontal||y===t.az.horizontalOnly?y:0,j=y===t.az.vertical?y:0,H=[I.leftJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.rightJustifiedTextSymbolIndex];for(const K of H)u.text.placedSymbolArray.get(K).placedOrientation=D;I.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(I.verticalPlacedTextSymbolIndex).placedOrientation=j)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const y=this.prevPlacement;let I=!1;this.prevZoomAdjustment=y?y.zoomAdjustment(this.transform.zoom):0;const D=y?y.symbolFadeChange(u):1,j=y?y.opacities:{},H=y?y.variableOffsets:{},K=y?y.placedOrientations:{};for(const te in this.placements){const ge=this.placements[te],xe=j[te];xe?(this.opacities[te]=new Ra(xe,D,ge.text,ge.icon),I=I||ge.text!==xe.text.placed||ge.icon!==xe.icon.placed):(this.opacities[te]=new Ra(null,D,ge.text,ge.icon,ge.skipFade),I=I||ge.text||ge.icon)}for(const te in j){const ge=j[te];if(!this.opacities[te]){const xe=new Ra(ge,D,!1,!1);xe.isHidden()||(this.opacities[te]=xe,I=I||ge.text.placed||ge.icon.placed)}}for(const te in H)this.variableOffsets[te]||!this.opacities[te]||this.opacities[te].isHidden()||(this.variableOffsets[te]=H[te]);for(const te in K)this.placedOrientations[te]||!this.opacities[te]||this.opacities[te].isHidden()||(this.placedOrientations[te]=K[te]);if(y&&y.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");I?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=y?y.lastPlacementChangeTime:u)}updateLayerOpacities(u,y){const I={};for(const D of y){const j=D.getBucket(u);j&&D.latestFeatureIndex&&u.id===j.layerIds[0]&&this.updateBucketOpacities(j,D.tileID,I,D.collisionBoxArray)}}updateBucketOpacities(u,y,I,D){u.hasTextData()&&(u.text.opacityVertexArray.clear(),u.text.hasVisibleVertices=!1),u.hasIconData()&&(u.icon.opacityVertexArray.clear(),u.icon.hasVisibleVertices=!1),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const j=u.layers[0],H=j.layout,K=new Ra(null,0,!1,!1,!0),te=H.get("text-allow-overlap"),ge=H.get("icon-allow-overlap"),xe=j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=H.get("text-rotation-alignment")==="map",De=H.get("text-pitch-alignment")==="map",Ve=H.get("icon-text-fit")!=="none",Xe=new Ra(null,0,te&&(ge||!u.hasIconData()||H.get("icon-optional")),ge&&(te||!u.hasTextData()||H.get("text-optional")),!0);!u.collisionArrays&&D&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(D);const xt=(Tt,Mt,Yt)=>{for(let Rt=0;Rt<Mt/4;Rt++)Tt.opacityVertexArray.emplaceBack(Yt);Tt.hasVisibleVertices=Tt.hasVisibleVertices||Yt!==bc},wt=this.collisionBoxArrays.get(u.bucketInstanceId);for(let Tt=0;Tt<u.symbolInstances.length;Tt++){const Mt=u.symbolInstances.get(Tt),{numHorizontalGlyphVertices:Yt,numVerticalGlyphVertices:Rt,crossTileID:Zt}=Mt;let ei=this.opacities[Zt];I[Zt]?ei=K:ei||(ei=Xe,this.opacities[Zt]=ei),I[Zt]=!0;const Ut=Mt.numIconVertices>0,hi=this.placedOrientations[Mt.crossTileID],$i=hi===t.az.vertical,ki=hi===t.az.horizontal||hi===t.az.horizontalOnly;if(Yt>0||Rt>0){const Pi=Yd(ei.text);xt(u.text,Yt,$i?bc:Pi),xt(u.text,Rt,ki?bc:Pi);const On=ei.text.isHidden();[Mt.rightJustifiedTextSymbolIndex,Mt.centerJustifiedTextSymbolIndex,Mt.leftJustifiedTextSymbolIndex].forEach((Yn=>{Yn>=0&&(u.text.placedSymbolArray.get(Yn).hidden=On||$i?1:0)})),Mt.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Mt.verticalPlacedTextSymbolIndex).hidden=On||ki?1:0);const Nn=this.variableOffsets[Mt.crossTileID];Nn&&this.markUsedJustification(u,Nn.anchor,Mt,hi);const bn=this.placedOrientations[Mt.crossTileID];bn&&(this.markUsedJustification(u,"left",Mt,bn),this.markUsedOrientation(u,bn,Mt))}if(Ut){const Pi=Yd(ei.icon),On=!(Ve&&Mt.verticalPlacedIconSymbolIndex&&$i);Mt.placedIconSymbolIndex>=0&&(xt(u.icon,Mt.numIconVertices,On?Pi:bc),u.icon.placedSymbolArray.get(Mt.placedIconSymbolIndex).hidden=ei.icon.isHidden()),Mt.verticalPlacedIconSymbolIndex>=0&&(xt(u.icon,Mt.numVerticalIconVertices,On?bc:Pi),u.icon.placedSymbolArray.get(Mt.verticalPlacedIconSymbolIndex).hidden=ei.icon.isHidden())}const Di=wt&&wt.has(Tt)?wt.get(Tt):{text:null,icon:null};if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const Pi=u.collisionArrays[Tt];if(Pi){let On=new t.P(0,0);if(Pi.textBox||Pi.verticalTextBox){let Nn=!0;if(xe){const bn=this.variableOffsets[Zt];bn?(On=wa(bn.anchor,bn.width,bn.height,bn.textOffset,bn.textBoxScale),fe&&On._rotate(De?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Nn=!1}if(Pi.textBox||Pi.verticalTextBox){let bn;Pi.textBox&&(bn=$i),Pi.verticalTextBox&&(bn=ki),yl(u.textCollisionBox.collisionVertexArray,ei.text.placed,!Nn||bn,Di.text,On.x,On.y)}}if(Pi.iconBox||Pi.verticalIconBox){const Nn=!!(!ki&&Pi.verticalIconBox);let bn;Pi.iconBox&&(bn=Nn),Pi.verticalIconBox&&(bn=!Nn),yl(u.iconCollisionBox.collisionVertexArray,ei.icon.placed,bn,Di.icon,Ve?On.x:0,Ve?On.y:0)}}}}if(u.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.text.opacityVertexArray.length!==u.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${u.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${u.text.layoutVertexArray.length}) / 4`);if(u.icon.opacityVertexArray.length!==u.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${u.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${u.icon.layoutVertexArray.length}) / 4`);u.bucketInstanceId in this.collisionCircleArrays&&(u.collisionCircleArray=this.collisionCircleArrays[u.bucketInstanceId],delete this.collisionCircleArrays[u.bucketInstanceId])}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,y){const I=this.zoomAtLastRecencyCheck===y?1-this.zoomAdjustment(y):1;return this.zoomAtLastRecencyCheck=y,this.commitTime+this.fadeDuration*I>u}setStale(){this.stale=!0}}function yl(V,u,y,I,D,j){I&&I.length!==0||(I=[0,0,0,0]);const H=I[0]-Br,K=I[1]-Br,te=I[2]-Br,ge=I[3]-Br;V.emplaceBack(u?1:0,y?1:0,D||0,j||0,H,K),V.emplaceBack(u?1:0,y?1:0,D||0,j||0,te,K),V.emplaceBack(u?1:0,y?1:0,D||0,j||0,te,ge),V.emplaceBack(u?1:0,y?1:0,D||0,j||0,H,ge)}const su=Math.pow(2,25),Ta=Math.pow(2,24),Zd=Math.pow(2,17),Xu=Math.pow(2,16),Xd=Math.pow(2,9),Op=Math.pow(2,8),Dh=Math.pow(2,1);function Yd(V){if(V.opacity===0&&!V.placed)return 0;if(V.opacity===1&&V.placed)return 4294967295;const u=V.placed?1:0,y=Math.floor(127*V.opacity);return y*su+u*Ta+y*Zd+u*Xu+y*Xd+u*Op+y*Dh+u}const bc=0;class ja{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&!u.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,y,I,D,j){const H=this._bucketParts;for(;this._currentTileIndex<u.length;)if(y.getBucketParts(H,D,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,j())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,H.sort(((K,te)=>K.sortKey-te.sortKey)));this._currentPartIndex<H.length;)if(y.placeLayerBucketPart(H[this._currentPartIndex],this._seenCrossTileIDs,I),this._currentPartIndex++,j())return!0;return!1}}class Wl{constructor(u,y,I,D,j,H,K,te){this.placement=new hc(u,y,H,K,te),this._currentPlacementIndex=I.length-1,this._forceFullPlacement=D,this._showCollisionBoxes=j,this._done=!1}isDone(){return this._done}continuePlacement(u,y,I){const D=se(),j=()=>!this._forceFullPlacement&&se()-D>2;for(;this._currentPlacementIndex>=0;){const H=y[u[this._currentPlacementIndex]],K=this.placement.collisionIndex.transform.zoom;if(H.type==="symbol"&&(!H.minzoom||H.minzoom<=K)&&(!H.maxzoom||H.maxzoom>K)){if(this._inProgressLayer||(this._inProgressLayer=new ja(H)),this._inProgressLayer.continuePlacement(I[H.source],this.placement,this._showCollisionBoxes,H,j))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const as=512/t.a5/2;class wc{constructor(u,y,I){this.tileID=u,this.bucketInstanceId=I,this._symbolsByKey={};const D=new Map;for(let j=0;j<y.length;j++){const H=y.get(j),K=H.key,te=D.get(K);te?te.push(H):D.set(K,[H])}for(const[j,H]of D){const K={positions:H.map((te=>({x:Math.floor(te.anchorX*as),y:Math.floor(te.anchorY*as)}))),crossTileIDs:H.map((te=>te.crossTileID))};if(K.positions.length>128){const te=new t.aT(K.positions.length,16,Uint16Array);for(const{x:ge,y:xe}of K.positions)te.add(ge,xe);te.finish(),delete K.positions,K.index=te}this._symbolsByKey[j]=K}}getScaledCoordinates(u,y){const{x:I,y:D,z:j}=this.tileID.canonical,{x:H,y:K,z:te}=y.canonical,ge=as/Math.pow(2,te-j),xe=(K*t.a5+u.anchorY)*ge,fe=D*t.a5*as;return{x:Math.floor((H*t.a5+u.anchorX)*ge-I*t.a5*as),y:Math.floor(xe-fe)}}findMatches(u,y,I){const D=this.tileID.canonical.z<y.canonical.z?1:Math.pow(2,this.tileID.canonical.z-y.canonical.z);for(let j=0;j<u.length;j++){const H=u.get(j);if(H.crossTileID)continue;const K=this._symbolsByKey[H.key];if(!K)continue;const te=this.getScaledCoordinates(H,y);if(K.index){const ge=K.index.range(te.x-D,te.y-D,te.x+D,te.y+D).sort();for(const xe of ge){const fe=K.crossTileIDs[xe];if(!I[fe]){I[fe]=!0,H.crossTileID=fe;break}}}else if(K.positions)for(let ge=0;ge<K.positions.length;ge++){const xe=K.positions[ge],fe=K.crossTileIDs[ge];if(Math.abs(xe.x-te.x)<=D&&Math.abs(xe.y-te.y)<=D&&!I[fe]){I[fe]=!0,H.crossTileID=fe;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:u})=>u))}}class Yu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ku{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const y=Math.round((u-this.lng)/360);if(y!==0)for(const I in this.indexes){const D=this.indexes[I],j={};for(const H in D){const K=D[H];K.tileID=K.tileID.unwrapTo(K.tileID.wrap+y),j[K.tileID.key]=K}this.indexes[I]=j}this.lng=u}addBucket(u,y,I){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===y.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let j=0;j<y.symbolInstances.length;j++)y.symbolInstances.get(j).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const D=this.usedCrossTileIDs[u.overscaledZ];for(const j in this.indexes){const H=this.indexes[j];if(Number(j)>u.overscaledZ)for(const K in H){const te=H[K];te.tileID.isChildOf(u)&&te.findMatches(y.symbolInstances,u,D)}else{const K=H[u.scaledTo(Number(j)).key];K&&K.findMatches(y.symbolInstances,u,D)}}for(let j=0;j<y.symbolInstances.length;j++){const H=y.symbolInstances.get(j);H.crossTileID||(H.crossTileID=I.generate(),D[H.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new wc(u,y.symbolInstances,y.bucketInstanceId),!0}removeBucketCrossTileIDs(u,y){for(const I of y.getCrossTileIDsLists())for(const D of I)delete this.usedCrossTileIDs[u][D]}removeStaleBuckets(u){let y=!1;for(const I in this.indexes){const D=this.indexes[I];for(const j in D)u[D[j].bucketInstanceId]||(this.removeBucketCrossTileIDs(I,D[j]),delete D[j],y=!0)}return y}}class cl{constructor(){this.layerIndexes={},this.crossTileIDs=new Yu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,y,I){let D=this.layerIndexes[u.id];D===void 0&&(D=this.layerIndexes[u.id]=new Ku);let j=!1;const H={};D.handleWrapJump(I);for(const K of y){const te=K.getBucket(u);te&&u.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),D.addBucket(K.tileID,te,this.crossTileIDs)&&(j=!0),H[te.bucketInstanceId]=!0)}return D.removeStaleBuckets(H)&&(j=!0),j}pruneUnusedLayers(u){const y={};u.forEach((I=>{y[I]=!0}));for(const I in this.layerIndexes)y[I]||delete this.layerIndexes[I]}}var vl="void main() {fragColor=vec4(1.0);}";const Vo={prelude:Jr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Jr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Jr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Jr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Jr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Jr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Jr(vl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Jr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Jr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Jr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Jr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Jr(vl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Jr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Jr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Jr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Jr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Jr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Jr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Jr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Jr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Jr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Jr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Jr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Jr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Jr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Jr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Jr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Jr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Jr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Jr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Jr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Jr(V,u){const y=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,I=u.match(/in ([\w]+) ([\w]+)/g),D=V.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),j=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),H=j?j.concat(D):D,K={};return{fragmentSource:V=V.replace(y,((te,ge,xe,fe,De)=>(K[De]=!0,ge==="define"?`
#ifndef HAS_UNIFORM_u_${De}
in ${xe} ${fe} ${De};
#else
uniform ${xe} ${fe} u_${De};
#endif
`:`
#ifdef HAS_UNIFORM_u_${De}
    ${xe} ${fe} ${De} = u_${De};
#endif
`))),vertexSource:u=u.replace(y,((te,ge,xe,fe,De)=>{const Ve=fe==="float"?"vec2":"vec4",Xe=De.match(/color/)?"color":Ve;return K[De]?ge==="define"?`
#ifndef HAS_UNIFORM_u_${De}
uniform lowp float u_${De}_t;
in ${xe} ${Ve} a_${De};
out ${xe} ${fe} ${De};
#else
uniform ${xe} ${fe} u_${De};
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${De}
    ${De} = a_${De};
#else
    ${xe} ${fe} ${De} = u_${De};
#endif
`:`
#ifndef HAS_UNIFORM_u_${De}
    ${De} = unpack_mix_${Xe}(a_${De}, u_${De}_t);
#else
    ${xe} ${fe} ${De} = u_${De};
#endif
`:ge==="define"?`
#ifndef HAS_UNIFORM_u_${De}
uniform lowp float u_${De}_t;
in ${xe} ${Ve} a_${De};
#else
uniform ${xe} ${fe} u_${De};
#endif
`:Xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${De}
    ${xe} ${fe} ${De} = a_${De};
#else
    ${xe} ${fe} ${De} = u_${De};
#endif
`:`
#ifndef HAS_UNIFORM_u_${De}
    ${xe} ${fe} ${De} = unpack_mix_${Xe}(a_${De}, u_${De}_t);
#else
    ${xe} ${fe} ${De} = u_${De};
#endif
`})),staticAttributes:I,staticUniforms:H}}class Zo{constructor(u,y,I){this.vertexBuffer=u,this.indexBuffer=y,this.segments=I}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ou=t.aU([{name:"a_pos",type:"Int16",components:2}]);const Ko="#define PROJECTION_MERCATOR",Zl="mercator";class el{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Zl}get shaderDefine(){return Ko}get shaderPreludeCode(){return Vo.projectionMercator}get vertexShaderPreludeCode(){return Vo.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(u){}getMeshFromTileID(u,y,I,D,j){if(this._cachedMesh)return this._cachedMesh;const H=new t.aW;H.emplaceBack(0,0),H.emplaceBack(t.a5,0),H.emplaceBack(0,t.a5),H.emplaceBack(t.a5,t.a5);const K=u.createVertexBuffer(H,ou.members),te=t.aX.simpleSegment(0,0,4,2),ge=new t.aY;ge.emplaceBack(1,0,2),ge.emplaceBack(1,2,3);const xe=u.createIndexBuffer(ge);return this._cachedMesh=new Zo(K,xe,te),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(u){}}class Tc{constructor(u=0,y=0,I=0,D=0){if(isNaN(u)||u<0||isNaN(y)||y<0||isNaN(I)||I<0||isNaN(D)||D<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=y,this.left=I,this.right=D}interpolate(u,y,I){return y.top!=null&&u.top!=null&&(this.top=t.G.number(u.top,y.top,I)),y.bottom!=null&&u.bottom!=null&&(this.bottom=t.G.number(u.bottom,y.bottom,I)),y.left!=null&&u.left!=null&&(this.left=t.G.number(u.left,y.left,I)),y.right!=null&&u.right!=null&&(this.right=t.G.number(u.right,y.right,I)),this}getCenter(u,y){const I=t.an((this.left+u-this.right)/2,0,u),D=t.an((this.top+y-this.bottom)/2,0,y);return new t.P(I,D)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new Tc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function fd(V,u){if(!V.renderWorldCopies||V.lngRange)return;const y=u.lng-V.center.lng;u.lng+=y>180?-360:y<-180?360:0}function za(V){return Math.max(0,Math.floor(V))}class Iu{constructor(u,y){var I;this.applyConstrain=(D,j)=>this._constrainOverride!==null?this._constrainOverride(D,j):this._callbacks.defaultConstrain(D,j),this._callbacks=u,this._tileSize=512,this._renderWorldCopies=y?.renderWorldCopies===void 0||!!y?.renderWorldCopies,this._minZoom=y?.minZoom||0,this._maxZoom=y?.maxZoom||22,this._minPitch=y?.minPitch==null?0:y?.minPitch,this._maxPitch=y?.maxPitch==null?60:y?.maxPitch,this._constrainOverride=(I=y?.constrainOverride)!==null&&I!==void 0?I:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=za(this._zoom),this._scale=t.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Tc,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(u,y,I){this._constrainOverride=u.constrainOverride,this._latRange=u.latRange,this._lngRange=u.lngRange,this._width=u.width,this._height=u.height,this._center=u.center,this._elevation=u.elevation,this._minElevationForCurrentTile=u.minElevationForCurrentTile,this._zoom=u.zoom,this._tileZoom=za(this._zoom),this._scale=t.aq(this._zoom),this._bearingInRadians=u.bearingInRadians,this._fovInRadians=u.fovInRadians,this._pitchInRadians=u.pitchInRadians,this._rollInRadians=u.rollInRadians,this._unmodified=u.unmodified,this._edgeInsets=new Tc(u.padding.top,u.padding.bottom,u.padding.left,u.padding.right),this._minZoom=u.minZoom,this._maxZoom=u.maxZoom,this._minPitch=u.minPitch,this._maxPitch=u.maxPitch,this._renderWorldCopies=u.renderWorldCopies,this._cameraToCenterDistance=u.cameraToCenterDistance,this._nearZ=u.nearZ,this._farZ=u.farZ,this._autoCalculateNearFarZ=!I&&u.autoCalculateNearFarZ,y&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(u){this._minElevationForCurrentTile=u}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(u){this._minZoom!==u&&(this._minZoom=u,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(u){this._minPitch!==u&&(this._minPitch=u,this.setPitch(Math.max(this.pitch,u)))}get maxPitch(){return this._maxPitch}setMaxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.setPitch(Math.min(this.pitch,u)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get constrainOverride(){return this._constrainOverride}setConstrainOverride(u){u===void 0&&(u=null),this._constrainOverride!==u&&(this._constrainOverride=u,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(u){const y=t.W(u,-180,180)*Math.PI/180;var I,D,j,H,K,te,ge,xe,fe;this._bearingInRadians!==y&&(this._unmodified=!1,this._bearingInRadians=y,this._calcMatrices(),this._rotationMatrix=O(),I=this._rotationMatrix,j=-this._bearingInRadians,H=(D=this._rotationMatrix)[0],K=D[1],te=D[2],ge=D[3],xe=Math.sin(j),fe=Math.cos(j),I[0]=H*fe+te*xe,I[1]=K*fe+ge*xe,I[2]=H*-xe+te*fe,I[3]=K*-xe+ge*fe)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(u){const y=t.an(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==y&&(this._unmodified=!1,this._pitchInRadians=y,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(u){const y=u/180*Math.PI;this._rollInRadians!==y&&(this._unmodified=!1,this._rollInRadians=y,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aZ(this._fovInRadians)}setFov(u){u=t.an(u,.1,150),this.fov!==u&&(this._unmodified=!1,this._fovInRadians=t.ap(u),this._calcMatrices())}get zoom(){return this._zoom}setZoom(u){const y=this.applyConstrain(this._center,u).zoom;this._zoom!==y&&(this._unmodified=!1,this._zoom=y,this._tileZoom=Math.max(0,Math.floor(y)),this._scale=t.aq(y),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(u){u!==this._elevation&&(this._elevation=u,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(u,y){this._autoCalculateNearFarZ=!1,this._nearZ=u,this._farZ=y,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,y,I){this._unmodified=!1,this._edgeInsets.interpolate(u,y,I),this.constrainInternal(),this._calcMatrices()}resize(u,y,I=!0){this._width=u,this._height=y,I&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ui([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(u){u?(this._lngRange=[u.getWest(),u.getEast()],this._latRange=[u.getSouth(),u.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-t.ao,t.ao])}getCameraQueryGeometry(u,y){if(y.length===1)return[y[0],u];{const{minX:I,minY:D,maxX:j,maxY:H}=t.aa.fromPoints(y).extend(u);return[new t.P(I,D),new t.P(j,D),new t.P(j,H),new t.P(I,H),new t.P(I,D)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const u=this._unmodified,{center:y,zoom:I}=this.applyConstrain(this.center,this.zoom);this.setCenter(y),this.setZoom(I),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let u=t.ar(new Float64Array(16));t.Q(u,u,[this._width/2,-this._height/2,1]),t.O(u,u,[1,-1,0]),this._clipSpaceToPixelsMatrix=u,u=t.ar(new Float64Array(16)),t.Q(u,u,[1,-1,1]),t.O(u,u,[-1,-1,0]),t.Q(u,u,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=u,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(u,y,I,D){const j=I!==void 0?I:this.bearing,H=D=D!==void 0?D:this.pitch,{distanceToCenter:K,clampedElevation:te}=this._distanceToCenterFromAltElevationPitch(y,this.elevation,H),{x:ge,y:xe}=bs(H,j),fe=t.a9.fromLngLat(u,y);let De,Ve,Xe=t.a_(1,fe.y),xt=0;do{if(xt+=1,xt>10)break;Ve=K/Xe,De=new t.a9(fe.x+ge*Ve,fe.y+xe*Ve),Xe=1/De.meterInMercatorCoordinateUnits()}while(Math.abs(K-Ve*Xe)>1e-12);return{center:De.toLngLat(),elevation:te,zoom:t.at(this.height/2/Math.tan(this.fovInRadians/2)/Ve/this.tileSize)}}recalculateZoomAndCenter(u){if(this.elevation-u==0)return;const y=1/this.worldSize,I=t.as(1,this.center.lat)*this.worldSize,D=t.a9.fromLngLat(this.center,this.elevation),j=D.x/y,H=D.y/y,K=D.z/y,te=this.pitch,ge=this.bearing,{x:xe,y:fe,z:De}=bs(te,ge),Ve=this.cameraToCenterDistance,Xe=j+Ve*-xe,xt=H+Ve*-fe,wt=K+Ve*De,{distanceToCenter:Tt,clampedElevation:Mt}=this._distanceToCenterFromAltElevationPitch(wt/I,u,te),Yt=Tt*I,Rt=new t.a9((Xe+xe*Yt)*y,(xt+fe*Yt)*y,0).toLngLat(),Zt=t.as(1,Rt.lat),ei=t.at(this.height/2/Math.tan(this.fovInRadians/2)/Tt/Zt/this.tileSize);this._elevation=Mt,this._center=Rt,this.setZoom(ei)}_distanceToCenterFromAltElevationPitch(u,y,I){const D=-Math.cos(t.ap(I)),j=u-y;let H,K=y;return D*j>=0||Math.abs(D)<.1?(H=1e4,K=u+H*D):H=-j/D,{distanceToCenter:H,clampedElevation:K}}getCameraPoint(){const u=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(u*Math.sin(this.rollInRadians),u*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const u=t.as(1,this.center.lat)*this.worldSize;return mi(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/u).toLngLat()}getMercatorTileCoordinates(u){if(!u)return[0,0,1,1];const y=u.canonical.z>=0?1<<u.canonical.z:Math.pow(2,u.canonical.z);return[u.canonical.x/y,u.canonical.y/y,1/y/t.a5,1/y/t.a5]}}class $r{constructor(u,y){this.min=u,this.max=y,this.center=t.a$([],t.b0([],this.min,this.max),.5)}quadrant(u){const y=[u%2==0,u<2],I=t.b1(this.min),D=t.b1(this.max);for(let j=0;j<y.length;j++)I[j]=y[j]?this.min[j]:this.center[j],D[j]=y[j]?this.center[j]:this.max[j];return D[2]=this.max[2],new $r(I,D)}distanceX(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]}distanceY(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]}intersectsFrustum(u){let y=!0;for(let I=0;I<u.planes.length;I++){const D=this.intersectsPlane(u.planes[I]);if(D===0)return 0;D===1&&(y=!1)}return y?2:u.aabb.min[0]>this.max[0]||u.aabb.min[1]>this.max[1]||u.aabb.min[2]>this.max[2]||u.aabb.max[0]<this.min[0]||u.aabb.max[1]<this.min[1]||u.aabb.max[2]<this.min[2]?0:1}intersectsPlane(u){let y=u[3],I=u[3];for(let D=0;D<3;D++)u[D]>0?(y+=u[D]*this.min[D],I+=u[D]*this.max[D]):(I+=u[D]*this.min[D],y+=u[D]*this.max[D]);return y>=0?2:I<0?0:1}}class Kd{distanceToTile2d(u,y,I,D){const j=D.distanceX([u,y]),H=D.distanceY([u,y]);return Math.hypot(j,H)}getWrap(u,y,I){return I}getTileBoundingVolume(u,y,I,D){var j,H;let K=0,te=0;if(D?.terrain){const xe=new t.a2(u.z,y,u.z,u.x,u.y),fe=D.terrain.getMinMaxElevation(xe);K=(j=fe.minElevation)!==null&&j!==void 0?j:Math.min(0,I),te=(H=fe.maxElevation)!==null&&H!==void 0?H:Math.max(0,I)}const ge=1<<u.z;return new $r([y+u.x/ge,u.y/ge,K],[y+(u.x+1)/ge,(u.y+1)/ge,te])}allowVariableZoom(u,y){const I=u.fov*(Math.abs(Math.cos(u.rollInRadians))*u.height+Math.abs(Math.sin(u.rollInRadians))*u.width)/u.height,D=t.an(78.5-I/2,0,60);return!!y.terrain||u.pitch>D}allowWorldCopies(){return!0}prepareNextFrame(){}}class Xl{constructor(u,y,I){this.points=u,this.planes=y,this.aabb=I}static fromInvProjectionMatrix(u,y=1,I=0,D,j){const H=j?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],K=Math.pow(2,I),te=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((De=>(function(Ve,Xe,xt,wt){const Tt=t.aH([],Ve,Xe),Mt=1/Tt[3]/xt*wt;return t.b6(Tt,Tt,[Mt,Mt,1/Tt[3],Mt])})(De,u,y,K)));D&&(function(De,Ve,Xe,xt){const wt=xt?4:0,Tt=xt?0:4;let Mt=0;const Yt=[],Rt=[];for(let Ut=0;Ut<4;Ut++){const hi=t.b2([],De[Ut+Tt],De[Ut+wt]),$i=t.b7(hi);t.a$(hi,hi,1/$i),Yt.push($i),Rt.push(hi)}for(let Ut=0;Ut<4;Ut++){const hi=t.b8(De[Ut+wt],Rt[Ut],Xe);Mt=hi!==null&&hi>=0?Math.max(Mt,hi):Math.max(Mt,Yt[Ut])}const Zt=(function(Ut,hi){const $i=t.b2([],Ut[hi[0]],Ut[hi[1]]),ki=t.b2([],Ut[hi[2]],Ut[hi[1]]),Di=[0,0,0,0];return t.b3(Di,t.b4([],$i,ki)),Di[3]=-t.b5(Di,Ut[hi[0]]),Di})(De,Ve),ei=(function(Ut,hi){const $i=t.b9(Ut),ki=t.ba([],Ut,1/$i),Di=t.b2([],hi,t.a$([],ki,t.b5(hi,ki))),Pi=t.b9(Di);if(Pi>0){const On=Math.sqrt(1-ki[3]*ki[3]),Nn=t.a$([],ki,-ki[3]),bn=t.b0([],Nn,t.a$([],Di,On/Pi));return t.bb(hi,bn)}return null})(Xe,Zt);if(ei!==null){const Ut=ei/t.b5(Rt[0],Zt);Mt=Math.min(Mt,Ut)}for(let Ut=0;Ut<4;Ut++){const hi=Math.min(Mt,Yt[Ut]);De[Ut+Tt]=[De[Ut+wt][0]+Rt[Ut][0]*hi,De[Ut+wt][1]+Rt[Ut][1]*hi,De[Ut+wt][2]+Rt[Ut][2]*hi,1]}})(te,H[0],D,j);const ge=H.map((De=>{const Ve=t.b2([],te[De[0]],te[De[1]]),Xe=t.b2([],te[De[2]],te[De[1]]),xt=t.b3([],t.b4([],Ve,Xe)),wt=-t.b5(xt,te[De[1]]);return xt.concat(wt)})),xe=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],fe=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const De of te)for(let Ve=0;Ve<3;Ve++)xe[Ve]=Math.min(xe[Ve],De[Ve]),fe[Ve]=Math.max(fe[Ve],De[Ve]);return new Xl(te,ge,new $r(xe,fe))}}class pd{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,y,I){return this._helper.interpolatePadding(u,y,I)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,y,I=!0){this._helper.resize(u,y,I)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}setConstrainOverride(u){this._helper.setConstrainOverride(u)}overrideNearFarZ(u,y){this._helper.overrideNearFarZ(u,y)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(u,y){}constructor(u){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(y,I)=>{I=t.an(+I,this.minZoom,this.maxZoom);const D={center:new t.V(y.lng,y.lat),zoom:I};let j=this._helper._lngRange;if(!this._helper._renderWorldCopies&&j===null){const Rt=179.9999999999;j=[-Rt,Rt]}const H=this.tileSize*t.aq(D.zoom);let K=0,te=H,ge=0,xe=H,fe=0,De=0;const{x:Ve,y:Xe}=this.size;if(this._helper._latRange){const Rt=this._helper._latRange;K=t.X(Rt[1])*H,te=t.X(Rt[0])*H,te-K<Xe&&(fe=Xe/(te-K))}j&&(ge=t.W(t.Y(j[0])*H,0,H),xe=t.W(t.Y(j[1])*H,0,H),xe<ge&&(xe+=H),xe-ge<Ve&&(De=Ve/(xe-ge)));const{x:xt,y:wt}=fr(H,y);let Tt,Mt;const Yt=Math.max(De||0,fe||0);if(Yt){const Rt=new t.P(De?(xe+ge)/2:xt,fe?(te+K)/2:wt);return D.center=Gr(H,Rt).wrap(),D.zoom+=t.at(Yt),D}if(this._helper._latRange){const Rt=Xe/2;wt-Rt<K&&(Mt=K+Rt),wt+Rt>te&&(Mt=te-Rt)}if(j){const Rt=(ge+xe)/2;let Zt=xt;this._helper._renderWorldCopies&&(Zt=t.W(xt,Rt-H/2,Rt+H/2));const ei=Ve/2;Zt-ei<ge&&(Tt=ge+ei),Zt+ei>xe&&(Tt=xe-ei)}if(Tt!==void 0||Mt!==void 0){const Rt=new t.P(Tt??xt,Mt??wt);D.center=Gr(H,Rt).wrap()}return D},this.applyConstrain=(y,I)=>this._helper.applyConstrain(y,I),this._helper=new Iu({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(y,I)=>this.defaultConstrain(y,I)},u),this._coveringTilesDetailsProvider=new Kd}clone(){const u=new pd;return u.apply(this),u}apply(u,y,I){this._helper.apply(u,y,I)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(u){const y=[new t.bc(0,u)];if(this._helper._renderWorldCopies){const I=this.screenPointToMercatorCoordinate(new t.P(0,0)),D=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),j=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),H=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),K=Math.floor(Math.min(I.x,D.x,j.x,H.x)),te=Math.floor(Math.max(I.x,D.x,j.x,H.x)),ge=1;for(let xe=K-ge;xe<=te+ge;xe++)xe!==0&&y.push(new t.bc(xe,u))}return y}getCameraFrustum(){return Xl.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(u){const y=this.screenPointToLocation(this.centerPoint,u),I=u?u.getElevationForLngLatZoom(y,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(I)}setLocationAtPoint(u,y){const I=t.as(this.elevation,this.center.lat),D=this.screenPointToMercatorCoordinateAtZ(y,I),j=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,I),H=t.a9.fromLngLat(u),K=new t.a9(H.x-(D.x-j.x),H.y-(D.y-j.y));this.setCenter(K?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(u,y){return y?this.coordinatePoint(t.a9.fromLngLat(u),y.getElevationForLngLat(u,this),this._pixelMatrix3D):this.coordinatePoint(t.a9.fromLngLat(u))}screenPointToLocation(u,y){var I;return(I=this.screenPointToMercatorCoordinate(u,y))===null||I===void 0?void 0:I.toLngLat()}screenPointToMercatorCoordinate(u,y){if(y){const I=y.pointCoordinate(u);if(I!=null)return I}return this.screenPointToMercatorCoordinateAtZ(u)}screenPointToMercatorCoordinateAtZ(u,y){const I=y||0,D=[u.x,u.y,0,1],j=[u.x,u.y,1,1];t.aH(D,D,this._pixelMatrixInverse),t.aH(j,j,this._pixelMatrixInverse);const H=D[3],K=j[3],te=D[1]/H,ge=j[1]/K,xe=D[2]/H,fe=j[2]/K,De=xe===fe?0:(I-xe)/(fe-xe);return new t.a9(t.G.number(D[0]/H,j[0]/K,De)/this.worldSize,t.G.number(te,ge,De)/this.worldSize,I)}coordinatePoint(u,y=0,I=this._pixelMatrix){const D=[u.x*this.worldSize,u.y*this.worldSize,y,1];return t.aH(D,D,I),new t.P(D[0]/D[3],D[1]/D[3])}getBounds(){const u=Math.max(0,this._helper._height/2-xo(this));return new Ui().extend(this.screenPointToLocation(new t.P(0,u))).extend(this.screenPointToLocation(new t.P(this._helper._width,u))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(u,y){return y?y.pointCoordinate(u)!=null:u.y>this.height/2-xo(this)}calculatePosMatrix(u,y=!1,I){var D;const j=(D=u.key)!==null&&D!==void 0?D:t.bd(u.wrap,u.canonical.z,u.canonical.z,u.canonical.x,u.canonical.y),H=y?this._alignedPosMatrixCache:this._posMatrixCache;if(H.has(j)){const ge=H.get(j);return I?ge.f32:ge.f64}const K=Js(u,this.worldSize);t.S(K,y?this._alignedProjMatrix:this._viewProjMatrix,K);const te={f64:K,f32:new Float32Array(K)};return H.set(j,te),I?te.f32:te.f64}calculateFogMatrix(u){const y=u.key,I=this._fogMatrixCacheF32;if(I.has(y))return I.get(y);const D=Js(u,this.worldSize);return t.S(D,this._fogMatrix,D),I.set(y,new Float32Array(D)),I.get(y)}calculateCenterFromCameraLngLatAlt(u,y,I,D){return this._helper.calculateCenterFromCameraLngLatAlt(u,y,I,D)}_calculateNearFarZIfNeeded(u,y,I){if(!this._helper.autoCalculateNearFarZ)return;const D=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),j=u-D*this._helper._pixelPerMeter/Math.cos(y),H=D<0?j:u,K=Math.PI/2+this.pitchInRadians,te=t.ap(this.fov)*(Math.abs(Math.cos(t.ap(this.roll)))*this.height+Math.abs(Math.sin(t.ap(this.roll)))*this.width)/this.height*(.5+I.y/this.height),ge=Math.sin(te)*H/Math.sin(t.an(Math.PI-K-te,.01,Math.PI-.01)),xe=xo(this),fe=Math.atan(xe/this._helper.cameraToCenterDistance),De=t.ap(.75),Ve=fe>De?2*fe*(.5+I.y/(2*xe)):De,Xe=Math.sin(Ve)*H/Math.sin(t.an(Math.PI-K-Ve,.01,Math.PI-.01)),xt=Math.min(ge,Xe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-y)*xt+H),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const u=this.centerOffset,y=fr(this.worldSize,this.center),I=y.x,D=y.y;this._helper._pixelPerMeter=t.as(1,this.center.lat)*this.worldSize;const j=t.ap(Math.min(this.pitch,Zn)),H=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(j));let K;this._calculateNearFarZIfNeeded(H,j,u),K=new Float64Array(16),t.be(K,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.aB(this._invProjMatrix,K),K[8]=2*-u.x/this._helper._width,K[9]=2*u.y/this._helper._height,this._projectionMatrix=t.bf(K),t.Q(K,K,[1,-1,1]),t.O(K,K,[0,0,-this._helper.cameraToCenterDistance]),t.bg(K,K,-this.rollInRadians),t.bh(K,K,this.pitchInRadians),t.bg(K,K,-this.bearingInRadians),t.O(K,K,[-I,-D,0]),this._mercatorMatrix=t.Q([],K,[this.worldSize,this.worldSize,this.worldSize]),t.Q(K,K,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,K),t.O(K,K,[0,0,-this.elevation]),this._viewProjMatrix=K,this._invViewProjMatrix=t.aB([],K);const te=[0,0,-1,1];t.aH(te,te,this._invViewProjMatrix),this._cameraPosition=[te[0]/te[3],te[1]/te[3],te[2]/te[3]],this._fogMatrix=new Float64Array(16),t.be(this._fogMatrix,this.fovInRadians,this.width/this.height,H,this._helper._farZ),this._fogMatrix[8]=2*-u.x/this.width,this._fogMatrix[9]=2*u.y/this.height,t.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.O(this._fogMatrix,this._fogMatrix,[-I,-D,0]),t.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,K);const ge=this._helper._width%2/2,xe=this._helper._height%2/2,fe=Math.cos(this.bearingInRadians),De=Math.sin(-this.bearingInRadians),Ve=I-Math.round(I)+fe*ge+De*xe,Xe=D-Math.round(D)+fe*xe+De*ge,xt=new Float64Array(K);if(t.O(xt,xt,[Ve>.5?Ve-1:Ve,Xe>.5?Xe-1:Xe,0]),this._alignedProjMatrix=xt,K=t.aB(new Float64Array(16),this._pixelMatrix),!K)throw new Error("failed to invert matrix");this._pixelMatrixInverse=K,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const u=this.screenPointToMercatorCoordinate(new t.P(0,0)),y=[u.x*this.worldSize,u.y*this.worldSize,0,1];return t.aH(y,y,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const u=t.as(1,this.center.lat)*this.worldSize;return mi(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/u).toLngLat()}lngLatToCameraDepth(u,y){const I=t.a9.fromLngLat(u),D=[I.x*this.worldSize,I.y*this.worldSize,y,1];return t.aH(D,D,this._viewProjMatrix),D[2]/D[3]}getProjectionData(u){const{overscaledTileID:y,aligned:I,applyTerrainMatrix:D}=u,j=this._helper.getMercatorTileCoordinates(y),H=y?this.calculatePosMatrix(y,I,!0):null;let K;return K=y&&y.terrainRttPosMatrix32f&&D?y.terrainRttPosMatrix32f:H||t.bi(),{mainMatrix:K,tileMercatorCoords:j,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:K}}isLocationOccluded(u){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(u,y,I){return 1}transformLightDirection(u){return t.b1(u)}getRayDirectionFromPixel(u){throw new Error("Not implemented.")}projectTileCoordinates(u,y,I,D){const j=this.calculatePosMatrix(I);let H;D?(H=[u,y,D(u,y),1],t.aH(H,H,j)):(H=[u,y,0,1],ao(H,H,j));const K=H[3];return{point:new t.P(H[0]/K,H[1]/K),signedDistanceFromCamera:K,isOccluded:!1}}populateCache(u){for(const y of u)this.calculatePosMatrix(y)}getMatrixForModel(u,y){const I=t.a9.fromLngLat(u,y),D=I.meterInMercatorCoordinateUnits(),j=t.bj();return t.O(j,j,[I.x,I.y,I.z]),t.bg(j,j,Math.PI),t.bh(j,j,Math.PI/2),t.Q(j,j,[-D,D,D]),j}getProjectionDataForCustomLayer(u=!0){const y=new t.a2(0,0,0,0,0),I=this.getProjectionData({overscaledTileID:y,applyGlobeMatrix:u}),D=Js(y,this.worldSize);t.S(D,this._viewProjMatrix,D),I.tileMercatorCoords=[0,0,1,1];const j=[t.a5,t.a5,this.worldSize/this._helper.pixelsPerMeter],H=t.bk();return t.Q(H,D,j),I.fallbackMatrix=H,I.mainMatrix=H,I}getFastPathSimpleProjectionMatrix(u){return this.calculatePosMatrix(u)}}function Ju(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Lh(V){if(V.useSlerp)if(V.k<1){const u=t.bl(V.startEulerAngles.roll,V.startEulerAngles.pitch,V.startEulerAngles.bearing),y=t.bl(V.endEulerAngles.roll,V.endEulerAngles.pitch,V.endEulerAngles.bearing),I=new Float64Array(4);t.bm(I,u,y,V.k);const D=t.bn(I);V.tr.setRoll(D.roll),V.tr.setPitch(D.pitch),V.tr.setBearing(D.bearing)}else V.tr.setRoll(V.endEulerAngles.roll),V.tr.setPitch(V.endEulerAngles.pitch),V.tr.setBearing(V.endEulerAngles.bearing);else V.tr.setRoll(t.G.number(V.startEulerAngles.roll,V.endEulerAngles.roll,V.k)),V.tr.setPitch(t.G.number(V.startEulerAngles.pitch,V.endEulerAngles.pitch,V.k)),V.tr.setBearing(t.G.number(V.startEulerAngles.bearing,V.endEulerAngles.bearing,V.k))}function Jd(V,u,y,I,D){const j=D.padding,H=fr(D.worldSize,y.getNorthWest()),K=fr(D.worldSize,y.getNorthEast()),te=fr(D.worldSize,y.getSouthEast()),ge=fr(D.worldSize,y.getSouthWest()),xe=t.ap(-I),fe=H.rotate(xe),De=K.rotate(xe),Ve=te.rotate(xe),Xe=ge.rotate(xe),xt=new t.P(Math.max(fe.x,De.x,Xe.x,Ve.x),Math.max(fe.y,De.y,Xe.y,Ve.y)),wt=new t.P(Math.min(fe.x,De.x,Xe.x,Ve.x),Math.min(fe.y,De.y,Xe.y,Ve.y)),Tt=xt.sub(wt),Mt=(D.width-(j.left+j.right+u.left+u.right))/Tt.x,Yt=(D.height-(j.top+j.bottom+u.top+u.bottom))/Tt.y;if(Yt<0||Mt<0)return void Ju();const Rt=Math.min(t.at(D.scale*Math.min(Mt,Yt)),V.maxZoom),Zt=t.P.convert(V.offset),ei=new t.P((u.left-u.right)/2,(u.top-u.bottom)/2).rotate(t.ap(I)),Ut=Zt.add(ei).mult(D.scale/t.aq(Rt));return{center:Gr(D.worldSize,H.add(te).div(2).sub(Ut)),zoom:Rt,bearing:I}}class Cu{get useGlobeControls(){return!1}handlePanInertia(u,y){const I=u.mag(),D=Math.abs(xo(y));return{easingOffset:u.mult(Math.min(.75*D/I,1)),easingCenter:y.center}}handleMapControlsRollPitchBearingZoom(u,y){u.bearingDelta&&y.setBearing(y.bearing+u.bearingDelta),u.pitchDelta&&y.setPitch(y.pitch+u.pitchDelta),u.rollDelta&&y.setRoll(y.roll+u.rollDelta),u.zoomDelta&&y.setZoom(y.zoom+u.zoomDelta)}handleMapControlsPan(u,y,I){u.around.distSqr(y.centerPoint)<.01||y.setLocationAtPoint(I,u.around)}cameraForBoxAndBearing(u,y,I,D,j){return Jd(u,y,I,D,j)}handleJumpToCenterZoom(u,y){u.zoom!==(y.zoom!==void 0?+y.zoom:u.zoom)&&u.setZoom(+y.zoom),y.center!==void 0&&u.setCenter(t.V.convert(y.center))}handleEaseTo(u,y){const I=u.zoom,D=u.padding,j={roll:u.roll,pitch:u.pitch,bearing:u.bearing},H={roll:y.roll===void 0?u.roll:y.roll,pitch:y.pitch===void 0?u.pitch:y.pitch,bearing:y.bearing===void 0?u.bearing:y.bearing},K=y.zoom!==void 0,te=!u.isPaddingEqual(y.padding);let ge=!1;const xe=K?+y.zoom:u.zoom;let fe=u.centerPoint.add(y.offsetAsPoint);const De=u.screenPointToLocation(fe),{center:Ve,zoom:Xe}=u.applyConstrain(t.V.convert(y.center||De),xe??I);fd(u,Ve);const xt=fr(u.worldSize,De),wt=fr(u.worldSize,Ve).sub(xt),Tt=t.aq(Xe-I);return ge=Xe!==I,{easeFunc:Mt=>{if(ge&&u.setZoom(t.G.number(I,Xe,Mt)),t.bo(j,H)||Lh({startEulerAngles:j,endEulerAngles:H,tr:u,k:Mt,useSlerp:j.roll!=H.roll}),te&&(u.interpolatePadding(D,y.padding,Mt),fe=u.centerPoint.add(y.offsetAsPoint)),y.around)u.setLocationAtPoint(y.around,y.aroundPoint);else{const Yt=t.aq(u.zoom-I),Rt=Xe>I?Math.min(2,Tt):Math.max(.5,Tt),Zt=Math.pow(Rt,1-Mt),ei=Gr(u.worldSize,xt.add(wt.mult(Mt*Zt)).mult(Yt));u.setLocationAtPoint(u.renderWorldCopies?ei.wrap():ei,fe)}},isZooming:ge,elevationCenter:Ve}}handleFlyTo(u,y){const I=y.zoom!==void 0,D=u.zoom,j=u.applyConstrain(t.V.convert(y.center||y.locationAtOffset),I?+y.zoom:D),H=j.center,K=j.zoom;fd(u,H);const te=fr(u.worldSize,y.locationAtOffset),ge=fr(u.worldSize,H).sub(te),xe=ge.mag(),fe=t.aq(K-D);let De;if(y.minZoom!==void 0){const Ve=Math.min(+y.minZoom,D,K),Xe=u.applyConstrain(H,Ve).zoom;De=t.aq(Xe-D)}return{easeFunc:(Ve,Xe,xt,wt)=>{u.setZoom(Ve===1?K:D+t.at(Xe));const Tt=Ve===1?H:Gr(u.worldSize,te.add(ge.mult(xt)).mult(Xe));u.setLocationAtPoint(u.renderWorldCopies?Tt.wrap():Tt,wt)},scaleOfZoom:fe,targetCenter:H,scaleOfMinZoom:De,pixelPathLength:xe}}}class jo{constructor(u,y,I){this.blendFunction=u,this.blendColor=y,this.mask=I}}jo.Replace=[1,0],jo.disabled=new jo(jo.Replace,t.bp.transparent,[!1,!1,!1,!1]),jo.unblended=new jo(jo.Replace,t.bp.transparent,[!0,!0,!0,!0]),jo.alphaBlended=new jo([1,771],t.bp.transparent,[!0,!0,!0,!0]);const Rh=2305;class Cs{constructor(u,y,I){this.enable=u,this.mode=y,this.frontFace=I}}Cs.disabled=new Cs(!1,1029,Rh),Cs.backCCW=new Cs(!0,1029,Rh),Cs.frontCCW=new Cs(!0,1028,Rh);class ms{constructor(u,y,I){this.func=u,this.mask=y,this.range=I}}ms.ReadOnly=!1,ms.ReadWrite=!0,ms.disabled=new ms(519,ms.ReadOnly,[0,1]);const md=7680;class js{constructor(u,y,I,D,j,H){this.test=u,this.ref=y,this.mask=I,this.fail=D,this.depthFail=j,this.pass=H}}js.disabled=new js({func:519,mask:0},0,0,md,md,md);const Au=new WeakMap;function Jo(V){var u;if(Au.has(V))return Au.get(V);{const y=(u=V.getParameter(V.VERSION))===null||u===void 0?void 0:u.startsWith("WebGL 2.0");return Au.set(V,y),y}}class zh{get awaitingQuery(){return!!this._readbackQueue}constructor(u){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=u;const y=u.context,I=y.gl;this._texFormat=I.RGBA,this._texType=I.UNSIGNED_BYTE;const D=new t.aW;D.emplaceBack(-1,-1),D.emplaceBack(2,-1),D.emplaceBack(-1,2);const j=new t.aY;j.emplaceBack(0,1,2),this._fullscreenTriangle=new Zo(y.createVertexBuffer(D,ou.members),y.createIndexBuffer(j),t.aX.simpleSegment(0,0,D.length,j.length)),this._resultBuffer=new Uint8Array(4),y.activeTexture.set(I.TEXTURE1);const H=I.createTexture();I.bindTexture(I.TEXTURE_2D,H),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST),I.texImage2D(I.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=y.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(H),Jo(I)&&(this._pbo=I.createBuffer(),I.bindBuffer(I.PIXEL_PACK_BUFFER,this._pbo),I.bufferData(I.PIXEL_PACK_BUFFER,4,I.STREAM_READ),I.bindBuffer(I.PIXEL_PACK_BUFFER,null))}destroy(){const u=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),u.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(u,y){const I=this._updateCount;return this._readbackQueue?I>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():I>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(u,y),this._updateCount++,this._measuredError}_bindFramebuffer(){const u=this._cachedRenderContext.context,y=u.gl;u.activeTexture.set(y.TEXTURE1),y.bindTexture(y.TEXTURE_2D,this._fbo.colorAttachment.get()),u.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(u,y){const I=this._cachedRenderContext.context,D=I.gl;if(this._bindFramebuffer(),I.viewport.set([0,0,this._texWidth,this._texHeight]),I.clear({color:t.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(I,D.TRIANGLES,ms.disabled,js.disabled,jo.unblended,Cs.disabled,((j,H)=>({u_input:j,u_output_expected:H}))(u,y),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Jo(D)){D.bindBuffer(D.PIXEL_PACK_BUFFER,this._pbo),D.readBuffer(D.COLOR_ATTACHMENT0),D.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),D.bindBuffer(D.PIXEL_PACK_BUFFER,null);const j=D.fenceSync(D.SYNC_GPU_COMMANDS_COMPLETE,0);D.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:j}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const u=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Jo(u)){const y=u.clientWaitSync(this._readbackQueue.sync,0,0);if(y===u.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(y===u.TIMEOUT_EXPIRED)return;u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),u.bindBuffer(u.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=zh._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(u){let y=0;return y+=u[0]/256,y+=u[1]/65536,y+=u[2]/16777216,u[3]<127&&(y=-y),y/128}}const au=t.a5/128;function Uc(V,u){const y=V.granularity!==void 0?Math.max(V.granularity,1):1,I=y+(V.generateBorders?2:0),D=y+(V.extendToNorthPole||V.generateBorders?1:0)+(V.extendToSouthPole||V.generateBorders?1:0),j=I+1,H=D+1,K=V.generateBorders?-1:0,te=V.generateBorders||V.extendToNorthPole?-1:0,ge=y+(V.generateBorders?1:0),xe=y+(V.generateBorders||V.extendToSouthPole?1:0),fe=j*H,De=I*D*6,Ve=j*H>65536;if(Ve&&u==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Xe=Ve||u==="32bit",xt=new Int16Array(2*fe);let wt=0;for(let Yt=te;Yt<=xe;Yt++)for(let Rt=K;Rt<=ge;Rt++){let Zt=Rt/y*t.a5;Rt===-1&&(Zt=-au),Rt===y+1&&(Zt=t.a5+au);let ei=Yt/y*t.a5;Yt===-1&&(ei=V.extendToNorthPole?t.br:-au),Yt===y+1&&(ei=V.extendToSouthPole?t.bs:t.a5+au),xt[wt++]=Zt,xt[wt++]=ei}const Tt=Xe?new Uint32Array(De):new Uint16Array(De);let Mt=0;for(let Yt=0;Yt<D;Yt++)for(let Rt=0;Rt<I;Rt++){const Zt=Rt+1+Yt*j,ei=Rt+(Yt+1)*j,Ut=Rt+1+(Yt+1)*j;Tt[Mt++]=Rt+Yt*j,Tt[Mt++]=ei,Tt[Mt++]=Zt,Tt[Mt++]=Zt,Tt[Mt++]=ei,Tt[Mt++]=Ut}return{vertices:xt.buffer.slice(0),indices:Tt.buffer.slice(0),uses32bitIndices:Xe}}const ps=new t.aV({fill:new t.bt(128,2),line:new t.bt(512,0),tile:new t.bt(128,32),stencil:new t.bt(128,1),circle:3});class km{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Vo.projectionGlobe}get vertexShaderPreludeCode(){return Vo.projectionMercator.vertexSource}get subdivisionGranularity(){return ps}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(u){this._errorMeasurement||(this._errorMeasurement=new zh(u));const y=t.X(this._errorQueryLatitudeDegrees),I=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,D=this._errorMeasurement.updateErrorLoop(y,I),j=se();D!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=D,this._errorMeasurementLastChangeTime=j);const H=Math.min(Math.max((j-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bv(H))}_getMeshKey(u){return`${u.granularity.toString(36)}_${u.generateBorders?"b":""}${u.extendToNorthPole?"n":""}${u.extendToSouthPole?"s":""}`}getMeshFromTileID(u,y,I,D,j){const H=(j==="stencil"?ps.stencil:ps.tile).getGranularityForZoomLevel(y.z);return this._getMesh(u,{granularity:H,generateBorders:I,extendToNorthPole:y.y===0&&D,extendToSouthPole:y.y===(1<<y.z)-1&&D})}_getMesh(u,y){const I=this._getMeshKey(y);if(I in this._tileMeshCache)return this._tileMeshCache[I];const D=(function(j,H){const K=Uc(H,"16bit"),te=t.aW.deserialize({arrayBuffer:K.vertices,length:K.vertices.byteLength/2/2}),ge=t.aY.deserialize({arrayBuffer:K.indices,length:K.indices.byteLength/2/3});return new Zo(j.createVertexBuffer(te,ou.members),j.createIndexBuffer(ge),t.aX.simpleSegment(0,0,te.length,ge.length))})(u,y);return this._tileMeshCache[I]=D,D}recalculate(u){}hasTransition(){const u=se();let y=!1;return y=y||(u-this._errorMeasurementLastChangeTime)/1e3<.7,y=y||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,y}setErrorQueryLatitudeDegrees(u){this._errorQueryLatitudeDegrees=u}}const sy=new t.t({type:new t.D(t.u.projection.type)});class Fg extends t.E{constructor(u){super(),this._transitionable=new t.x(sy,void 0),this.setProjection(u),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.H(0)),this._mercatorProjection=new el,this._verticalPerspectiveProjection=new km}get transitionState(){const u=this.properties.get("type");if(typeof u=="string"&&u==="mercator")return 0;if(typeof u=="string"&&u==="vertical-perspective")return 1;if(u instanceof t.bw){if(u.from==="vertical-perspective"&&u.to==="mercator")return 1-u.transition;if(u.from==="mercator"&&u.to==="vertical-perspective")return u.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(u){this._mercatorProjection.updateGPUdependent(u),this._verticalPerspectiveProjection.updateGPUdependent(u)}getMeshFromTileID(u,y,I,D,j){return this.currentProjection.getMeshFromTileID(u,y,I,D,j)}setProjection(u){this._transitionable.setValue("type",u?.type||"mercator")}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}setErrorQueryLatitudeDegrees(u){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(u),this._mercatorProjection.setErrorQueryLatitudeDegrees(u)}}function Gn(V){const u=Al(V.worldSize,V.center.lat);return 2*Math.PI*u}function lu(V,u,y,I,D){const j=1/(1<<D),H=u/t.a5*j+I*j,K=t.by((V/t.a5*j+y*j)*Math.PI*2+Math.PI,2*Math.PI),te=2*Math.atan(Math.exp(Math.PI-H*Math.PI*2))-.5*Math.PI,ge=Math.cos(te),xe=new Float64Array(3);return xe[0]=Math.sin(K)*ge,xe[1]=Math.sin(te),xe[2]=Math.cos(K)*ge,xe}function Xo(V){return(function(u,y){const I=Math.cos(y),D=new Float64Array(3);return D[0]=Math.sin(u)*I,D[1]=Math.sin(y),D[2]=Math.cos(u)*I,D})(V.lng*Math.PI/180,V.lat*Math.PI/180)}function Al(V,u){return V/(2*Math.PI)/Math.cos(u*Math.PI/180)}function gd(V){const u=Math.asin(V[1])/Math.PI*180,y=Math.sqrt(V[0]*V[0]+V[2]*V[2]);if(y>1e-6){const I=V[0]/y,D=Math.acos(V[2]/y),j=(I>0?D:-D)/Math.PI*180;return new t.V(t.W(j,-180,180),u)}return new t.V(0,u)}function dc(V){return Math.cos(V*Math.PI/180)}function vn(V,u){const y=dc(V),I=dc(u);return t.at(I/y)}function Qr(V,u){const y=V.rotate(u.bearingInRadians),I=u.zoom+vn(u.center.lat,0),D=t.bu(1/dc(u.center.lat),1/dc(Math.min(Math.abs(u.center.lat),60)),t.bx(I,7,3,0,1)),j=360/Gn({worldSize:u.worldSize,center:{lat:u.center.lat}});return new t.V(u.center.lng-y.x*j*D,t.an(u.center.lat+y.y*j,-t.ao,t.ao))}function ws(V){const u=.5*V,y=Math.sin(u),I=Math.cos(u);return Math.log(y+I)-Math.log(I-y)}function Yl(V,u,y,I){const D=V.lat+y*I;if(Math.abs(y)>1){const j=(Math.sign(V.lat+y)!==Math.sign(V.lat)?-Math.abs(V.lat):Math.abs(V.lat))*Math.PI/180,H=Math.abs(V.lat+y)*Math.PI/180,K=ws(j+I*(H-j)),te=ws(j),ge=ws(H);return new t.V(V.lng+u*((K-te)/(ge-te)),D)}return new t.V(V.lng+u*I,D)}class Qu{constructor(u){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=u}swapBuffers(){if(!this._hadAnyChanges)return;const u=this._cachePrevious;this._cachePrevious=this._cache,this._cache=u,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(u,y,I,D){const j=`${u.z}_${u.x}_${u.y}_${D?.terrain?"t":""}`,H=this._cache.get(j);if(H)return H;const K=this._cachePrevious.get(j);if(K)return this._cache.set(j,K),K;const te=this._boundingVolumeFactory(u,y,I,D);return this._cache.set(j,te),this._hadAnyChanges=!0,te}}class hs{constructor(u,y,I,D){this.min=I,this.max=D,this.points=u,this.planes=y}static fromAabb(u,y){const I=[];for(let D=0;D<8;D++)I.push([1&~D?u[0]:y[0],(D>>1&1)==1?y[1]:u[1],(D>>2&1)==1?y[2]:u[2]]);return new hs(I,[[-1,0,0,y[0]],[1,0,0,-u[0]],[0,-1,0,y[1]],[0,1,0,-u[1]],[0,0,-1,y[2]],[0,0,1,-u[2]]],u,y)}static fromCenterSizeAngles(u,y,I){const D=t.bB([],I[0],I[1],I[2]),j=t.bC([],[y[0],0,0],D),H=t.bC([],[0,y[1],0],D),K=t.bC([],[0,0,y[2]],D),te=[...u],ge=[...u];for(let fe=0;fe<8;fe++)for(let De=0;De<3;De++){const Ve=u[De]+j[De]*(1&~fe?-1:1)+H[De]*((fe>>1&1)==1?1:-1)+K[De]*((fe>>2&1)==1?1:-1);te[De]=Math.min(te[De],Ve),ge[De]=Math.max(ge[De],Ve)}const xe=[];for(let fe=0;fe<8;fe++){const De=[...u];t.b0(De,De,t.a$([],j,1&~fe?-1:1)),t.b0(De,De,t.a$([],H,(fe>>1&1)==1?1:-1)),t.b0(De,De,t.a$([],K,(fe>>2&1)==1?1:-1)),xe.push(De)}return new hs(xe,[[...j,-t.b5(j,xe[0])],[...H,-t.b5(H,xe[0])],[...K,-t.b5(K,xe[0])],[-j[0],-j[1],-j[2],-t.b5(j,xe[7])],[-H[0],-H[1],-H[2],-t.b5(H,xe[7])],[-K[0],-K[1],-K[2],-t.b5(K,xe[7])]],te,ge)}intersectsFrustum(u){let y=!0;const I=this.points.length,D=this.planes.length,j=u.planes.length,H=u.points.length;for(let K=0;K<j;K++){const te=u.planes[K];let ge=0;for(let xe=0;xe<I;xe++){const fe=this.points[xe];te[0]*fe[0]+te[1]*fe[1]+te[2]*fe[2]+te[3]>=0&&ge++}if(ge===0)return 0;ge<I&&(y=!1)}if(y)return 2;for(let K=0;K<D;K++){const te=this.planes[K];let ge=0;for(let xe=0;xe<H;xe++){const fe=u.points[xe];te[0]*fe[0]+te[1]*fe[1]+te[2]*fe[2]+te[3]>=0&&ge++}if(ge===0)return 0}return 1}intersectsPlane(u){const y=this.points.length;let I=0;for(let D=0;D<y;D++){const j=this.points[D];u[0]*j[0]+u[1]*j[1]+u[2]*j[2]+u[3]>=0&&I++}return I===y?2:I===0?0:1}}function Qd(V,u,y){const I=V-u;return I<0?-I:Math.max(0,I-y)}function eh(V,u,y,I,D){const j=V-y;let H;return H=j<0?Math.min(-j,1+j-D):j>1?Math.min(Math.max(j-D,0),1-j):0,Math.max(H,Qd(u,I,D))}class ef{constructor(){this._boundingVolumeCache=new Qu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(u,y,I,D){const j=1<<I.z,H=1/j,K=I.x/j,te=I.y/j;let ge=2;return ge=Math.min(ge,eh(u,y,K,te,H)),ge=Math.min(ge,eh(u,y,K+.5,-te-H,H)),ge=Math.min(ge,eh(u,y,K+.5,2-te-H,H)),ge}getWrap(u,y,I){const D=1<<y.z,j=1/D,H=y.x/D,K=Qd(u.x,H,j),te=Qd(u.x,H-1,j),ge=Qd(u.x,H+1,j),xe=Math.min(K,te,ge);return xe===ge?1:xe===te?-1:0}allowVariableZoom(u,y){return yi(u,y)>4}allowWorldCopies(){return!1}getTileBoundingVolume(u,y,I,D){return this._boundingVolumeCache.getTileBoundingVolume(u,y,I,D)}_computeTileBoundingVolume(u,y,I,D){var j,H;let K=0,te=0;if(D?.terrain){const ge=new t.a2(u.z,y,u.z,u.x,u.y),xe=D.terrain.getMinMaxElevation(ge);K=(j=xe.minElevation)!==null&&j!==void 0?j:Math.min(0,I),te=(H=xe.maxElevation)!==null&&H!==void 0?H:Math.max(0,I)}if(K/=t.bE,te/=t.bE,K+=1,te+=1,u.z<=0)return hs.fromAabb([-te,-te,-te],[te,te,te]);if(u.z===1)return hs.fromAabb([u.x===0?-te:0,u.y===0?0:-te,-te],[u.x===0?0:te,u.y===0?te:0,te]);{const ge=[lu(0,0,u.x,u.y,u.z),lu(t.a5,0,u.x,u.y,u.z),lu(t.a5,t.a5,u.x,u.y,u.z),lu(0,t.a5,u.x,u.y,u.z)],xe=[];for(const Di of ge)xe.push(t.a$([],Di,te));if(te!==K)for(const Di of ge)xe.push(t.a$([],Di,K));u.y===0&&xe.push([0,1,0]),u.y===(1<<u.z)-1&&xe.push([0,-1,0]);const fe=[1,1,1],De=[-1,-1,-1];for(const Di of xe)for(let Pi=0;Pi<3;Pi++)fe[Pi]=Math.min(fe[Pi],Di[Pi]),De[Pi]=Math.max(De[Pi],Di[Pi]);const Ve=lu(t.a5/2,t.a5/2,u.x,u.y,u.z),Xe=t.b4([],[0,1,0],Ve);t.b3(Xe,Xe);const xt=t.b4([],Ve,Xe);t.b3(xt,xt);const wt=t.b4([],ge[2],ge[1]);t.b3(wt,wt);const Tt=t.b4([],ge[0],ge[3]);t.b3(Tt,Tt),xe.push(t.a$([],Ve,te)),u.y>=(1<<u.z)/2&&xe.push(t.a$([],lu(t.a5/2,0,u.x,u.y,u.z),te)),u.y<(1<<u.z)/2&&xe.push(t.a$([],lu(t.a5/2,t.a5,u.x,u.y,u.z),te));const Mt=Ua(Ve,xe),Yt=Ua(xt,xe),Rt=[-Ve[0],-Ve[1],-Ve[2],Mt.max],Zt=[Ve[0],Ve[1],Ve[2],-Mt.min],ei=[-xt[0],-xt[1],-xt[2],Yt.max],Ut=[xt[0],xt[1],xt[2],-Yt.min],hi=[...wt,0],$i=[...Tt,0],ki=[];return u.y===0?ki.push(t.bD($i,hi,Rt),t.bD($i,hi,Zt)):ki.push(t.bD(ei,hi,Rt),t.bD(ei,hi,Zt),t.bD(ei,$i,Rt),t.bD(ei,$i,Zt)),u.y===(1<<u.z)-1?ki.push(t.bD($i,hi,Rt),t.bD($i,hi,Zt)):ki.push(t.bD(Ut,hi,Rt),t.bD(Ut,hi,Zt),t.bD(Ut,$i,Rt),t.bD(Ut,$i,Zt)),new hs(ki,[Rt,Zt,ei,Ut,hi,$i],fe,De)}}}function Ua(V,u){let y=1/0,I=-1/0;for(const D of u){const j=t.b5(V,D);y=Math.min(y,j),I=Math.max(I,j)}return{min:y,max:I}}class Mo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,y,I){return this._helper.interpolatePadding(u,y,I)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,y){this._helper.resize(u,y)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}setConstrainOverride(u){this._helper.setConstrainOverride(u)}overrideNearFarZ(u,y){this._helper.overrideNearFarZ(u,y)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(u){}constructor(u){this._cachedClippingPlane=t.bF(),this._projectionMatrix=t.bj(),this._globeViewProjMatrix32f=t.bi(),this._globeViewProjMatrixNoCorrection=t.bj(),this._globeViewProjMatrixNoCorrectionInverted=t.bj(),this._globeProjMatrixInverted=t.bj(),this._cameraPosition=t.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(y,I)=>{const D=t.an(y.lat,-t.ao,t.ao),j=t.an(+I,this.minZoom+vn(0,D),this.maxZoom);return{center:new t.V(y.lng,D),zoom:j}},this.applyConstrain=(y,I)=>this._helper.applyConstrain(y,I),this._helper=new Iu({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(y,I)=>this.defaultConstrain(y,I)},u),this._coveringTilesDetailsProvider=new ef}clone(){const u=new Mo;return u.apply(this),u}apply(u,y){this._globeLatitudeErrorCorrectionRadians=y||0,this._helper.apply(u)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const u=t.bz();return u[0]=this._cameraPosition[0],u[1]=this._cameraPosition[1],u[2]=this._cameraPosition[2],u}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(u){const{overscaledTileID:y,applyGlobeMatrix:I}=u,D=this._helper.getMercatorTileCoordinates(y);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:D,clippingPlane:this._cachedClippingPlane,projectionTransition:I?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(u){const y=this.pitchInRadians,I=this.cameraToCenterDistance/u,D=Math.sin(y)*I,j=Math.cos(y)*I+1,H=1/Math.sqrt(D*D+j*j)*1;let K=-D,te=j;const ge=Math.sqrt(K*K+te*te);K/=ge,te/=ge;const xe=[0,K,te];t.bG(xe,xe,[0,0,0],-this.bearingInRadians),t.bH(xe,xe,[0,0,0],-1*this.center.lat*Math.PI/180),t.bI(xe,xe,[0,0,0],this.center.lng*Math.PI/180);const fe=1/t.b7(xe);return t.a$(xe,xe,fe),[...xe,-H*fe]}isLocationOccluded(u){return!this.isSurfacePointVisible(Xo(u))}transformLightDirection(u){const y=this._helper._center.lng*Math.PI/180,I=this._helper._center.lat*Math.PI/180,D=Math.cos(I),j=[Math.sin(y)*D,Math.sin(I),Math.cos(y)*D],H=[j[2],0,-j[0]],K=[0,0,0];t.b4(K,H,j),t.b3(H,H),t.b3(K,K);const te=[0,0,0];return t.b3(te,[H[0]*u[0]+K[0]*u[1]+j[0]*u[2],H[1]*u[0]+K[1]*u[1]+j[1]*u[2],H[2]*u[0]+K[2]*u[1]+j[2]*u[2]]),te}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(u,y,I){const D=(function(K,te,ge){const xe=1/(1<<ge.z);return new t.a9(K/t.a5*xe+ge.x*xe,te/t.a5*xe+ge.y*xe)})(u,y,I.canonical),j=(H=D.y,[t.by(D.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-H*Math.PI*2))-.5*Math.PI]);var H;return this.getCircleRadiusCorrection()/Math.cos(j[1])}projectTileCoordinates(u,y,I,D){const j=I.canonical,H=lu(u,y,j.x,j.y,j.z),K=1+(D?D(u,y):0)/t.bE,te=[H[0]*K,H[1]*K,H[2]*K,1];t.aH(te,te,this._globeViewProjMatrixNoCorrection);const ge=this._cachedClippingPlane,xe=ge[0]*H[0]+ge[1]*H[1]+ge[2]*H[2]+ge[3]<0;return{point:new t.P(te[0]/te[3],te[1]/te[3]),signedDistanceFromCamera:te[3],isOccluded:xe}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const u=Al(this.worldSize,this.center.lat),y=t.bk(),I=t.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*u),t.be(y,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const D=this.centerOffset;y[8]=2*-D.x/this._helper._width,y[9]=2*D.y/this._helper._height,this._projectionMatrix=t.bf(y),this._globeProjMatrixInverted=t.bk(),t.aB(this._globeProjMatrixInverted,y),t.O(y,y,[0,0,-this.cameraToCenterDistance]),t.bg(y,y,this.rollInRadians),t.bh(y,y,-this.pitchInRadians),t.bg(y,y,this.bearingInRadians),t.O(y,y,[0,0,-u]);const j=t.bz();j[0]=u,j[1]=u,j[2]=u,t.bh(I,y,this.center.lat*Math.PI/180),t.bJ(I,I,-this.center.lng*Math.PI/180),t.Q(I,I,j),this._globeViewProjMatrixNoCorrection=I,t.bh(y,y,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bJ(y,y,-this.center.lng*Math.PI/180),t.Q(y,y,j),this._globeViewProjMatrix32f=new Float32Array(y),this._globeViewProjMatrixNoCorrectionInverted=t.bk(),t.aB(this._globeViewProjMatrixNoCorrectionInverted,I);const H=t.bz();this._cameraPosition=t.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/u,t.bG(this._cameraPosition,this._cameraPosition,H,-this.rollInRadians),t.bH(this._cameraPosition,this._cameraPosition,H,this.pitchInRadians),t.bG(this._cameraPosition,this._cameraPosition,H,-this.bearingInRadians),t.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bH(this._cameraPosition,this._cameraPosition,H,-this.center.lat*Math.PI/180),t.bI(this._cameraPosition,this._cameraPosition,H,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(u);const K=t.bf(this._globeViewProjMatrixNoCorrectionInverted);t.Q(K,K,[1,1,-1]),this._cachedFrustum=Xl.fromInvProjectionMatrix(K,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(u){t.w("calculateFogMatrix is not supported on globe projection.");const y=t.bk();return t.ar(y),y}getVisibleUnwrappedCoordinates(u){return[new t.bc(0,u)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(u){u&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(u,y){if(!this._globeViewProjMatrixNoCorrection)return 1;const I=Xo(u);t.a$(I,I,1+y/t.bE);const D=t.bF();return t.aH(D,[I[0],I[1],I[2],1],this._globeViewProjMatrixNoCorrection),D[2]/D[3]}populateCache(u){}getBounds(){const u=.5*this.width,y=.5*this.height,I=[new t.P(0,0),new t.P(u,0),new t.P(this.width,0),new t.P(this.width,y),new t.P(this.width,this.height),new t.P(u,this.height),new t.P(0,this.height),new t.P(0,y)],D=[];for(const fe of I)D.push(this.unprojectScreenPoint(fe));let j=0,H=0,K=0,te=0;const ge=this.center;for(const fe of D){const De=t.bK(ge.lng,fe.lng),Ve=t.bK(ge.lat,fe.lat);De<H&&(H=De),De>j&&(j=De),Ve<te&&(te=Ve),Ve>K&&(K=Ve)}const xe=[ge.lng+H,ge.lat+te,ge.lng+j,ge.lat+K];return this.isSurfacePointOnScreen([0,1,0])&&(xe[3]=90,xe[0]=-180,xe[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(xe[1]=-90,xe[0]=-180,xe[2]=180),new Ui(xe)}calculateCenterFromCameraLngLatAlt(u,y,I,D){return this._helper.calculateCenterFromCameraLngLatAlt(u,y,I,D)}setLocationAtPoint(u,y){const I=Xo(this.unprojectScreenPoint(y)),D=Xo(u),j=t.bz();t.bL(j);const H=t.bz();t.bI(H,I,j,-this.center.lng*Math.PI/180),t.bH(H,H,j,this.center.lat*Math.PI/180);const K=D[0]*D[0]+D[2]*D[2],te=H[0]*H[0];if(K<te)return;const ge=Math.sqrt(K-te),xe=-ge,fe=t.bM(D[0],D[2],H[0],ge),De=t.bM(D[0],D[2],H[0],xe),Ve=t.bz();t.bI(Ve,D,j,-fe);const Xe=t.bM(Ve[1],Ve[2],H[1],H[2]),xt=t.bz();t.bI(xt,D,j,-De);const wt=t.bM(xt[1],xt[2],H[1],H[2]),Tt=.5*Math.PI,Mt=Xe>=-Tt&&Xe<=Tt,Yt=wt>=-Tt&&wt<=Tt;let Rt,Zt;if(Mt&&Yt){const $i=this.center.lng*Math.PI/180,ki=this.center.lat*Math.PI/180;t.bN(fe,$i)+t.bN(Xe,ki)<t.bN(De,$i)+t.bN(wt,ki)?(Rt=fe,Zt=Xe):(Rt=De,Zt=wt)}else if(Mt)Rt=fe,Zt=Xe;else{if(!Yt)return;Rt=De,Zt=wt}const ei=Rt/Math.PI*180,Ut=Zt/Math.PI*180,hi=this.center.lat;this.setCenter(new t.V(ei,t.an(Ut,-90,90))),this.setZoom(this.zoom+vn(hi,this.center.lat))}locationToScreenPoint(u,y){const I=Xo(u);if(y){const D=y.getElevationForLngLatZoom(u,this._helper._tileZoom);t.a$(I,I,1+D/t.bE)}return this._projectSurfacePointToScreen(I)}_projectSurfacePointToScreen(u){const y=t.bF();return t.aH(y,[...u,1],this._globeViewProjMatrixNoCorrection),y[0]/=y[3],y[1]/=y[3],new t.P((.5*y[0]+.5)*this.width,(.5*-y[1]+.5)*this.height)}screenPointToMercatorCoordinate(u,y){if(y){const I=y.pointCoordinate(u);if(I)return I}return t.a9.fromLngLat(this.unprojectScreenPoint(u))}screenPointToLocation(u,y){var I;return(I=this.screenPointToMercatorCoordinate(u,y))===null||I===void 0?void 0:I.toLngLat()}isPointOnMapSurface(u,y){const I=this._cameraPosition,D=this.getRayDirectionFromPixel(u);return!!this.rayPlanetIntersection(I,D)}getRayDirectionFromPixel(u){const y=t.bF();y[0]=u.x/this.width*2-1,y[1]=-1*(u.y/this.height*2-1),y[2]=1,y[3]=1,t.aH(y,y,this._globeViewProjMatrixNoCorrectionInverted),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3];const I=t.bz();I[0]=y[0]-this._cameraPosition[0],I[1]=y[1]-this._cameraPosition[1],I[2]=y[2]-this._cameraPosition[2];const D=t.bz();return t.b3(D,I),D}isSurfacePointVisible(u){const y=this._cachedClippingPlane;return y[0]*u[0]+y[1]*u[1]+y[2]*u[2]+y[3]>=0}isSurfacePointOnScreen(u){if(!this.isSurfacePointVisible(u))return!1;const y=t.bF();return t.aH(y,[...u,1],this._globeViewProjMatrixNoCorrection),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3],y[0]>-1&&y[0]<1&&y[1]>-1&&y[1]<1&&y[2]>-1&&y[2]<1}rayPlanetIntersection(u,y){const I=t.b5(u,y),D=t.bz(),j=t.bz();t.a$(j,y,I),t.b2(D,u,j);const H=1-t.b5(D,D);if(H<0)return null;const K=t.b5(u,u)-1,te=-I+(I<0?1:-1)*Math.sqrt(H),ge=K/te,xe=te;return{tMin:Math.min(ge,xe),tMax:Math.max(ge,xe)}}unprojectScreenPoint(u){const y=this._cameraPosition,I=this.getRayDirectionFromPixel(u),D=this.rayPlanetIntersection(y,I);if(D){const xe=t.bz();t.b0(xe,y,[I[0]*D.tMin,I[1]*D.tMin,I[2]*D.tMin]);const fe=t.bz();return t.b3(fe,xe),gd(fe)}const j=this._cachedClippingPlane,H=j[0]*I[0]+j[1]*I[1]+j[2]*I[2],K=-t.bb(j,y)/H,te=t.bz();if(K>0)t.b0(te,y,[I[0]*K,I[1]*K,I[2]*K]);else{const xe=t.bz();t.b0(xe,y,[2*I[0],2*I[1],2*I[2]]);const fe=t.bb(this._cachedClippingPlane,xe);t.b2(te,xe,[this._cachedClippingPlane[0]*fe,this._cachedClippingPlane[1]*fe,this._cachedClippingPlane[2]*fe])}const ge=(function(xe){const fe=t.bz();return fe[0]=xe[0]*-xe[3],fe[1]=xe[1]*-xe[3],fe[2]=xe[2]*-xe[3],{center:fe,radius:Math.sqrt(1-xe[3]*xe[3])}})(j);return gd((function(xe,fe,De){const Ve=t.bz();t.b2(Ve,De,xe);const Xe=t.bz();return t.bA(Xe,xe,Ve,fe/t.b9(Ve)),Xe})(ge.center,ge.radius,te))}getMatrixForModel(u,y){const I=t.V.convert(u),D=1/t.bE,j=t.bj();return t.bJ(j,j,I.lng/180*Math.PI),t.bh(j,j,-I.lat/180*Math.PI),t.O(j,j,[0,0,1+y/t.bE]),t.bh(j,j,.5*Math.PI),t.Q(j,j,[D,D,D]),j}getProjectionDataForCustomLayer(u=!0){const y=this.getProjectionData({overscaledTileID:new t.a2(0,0,0,0,0),applyGlobeMatrix:u});return y.tileMercatorCoords=[0,0,1,1],y}getFastPathSimpleProjectionMatrix(u){}}class $f{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,y,I){return this._helper.interpolatePadding(u,y,I)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,y,I=!0){this._helper.resize(u,y,I)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}setConstrainOverride(u){this._helper.setConstrainOverride(u)}overrideNearFarZ(u,y){this._helper.overrideNearFarZ(u,y)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(u,y){this._globeness=u,this._globeLatitudeErrorCorrectionRadians=y,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(u){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(y,I)=>this.currentTransform.defaultConstrain(y,I),this.applyConstrain=(y,I)=>this._helper.applyConstrain(y,I),this._helper=new Iu({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(y,I)=>this.defaultConstrain(y,I)},u),this._globeness=1,this._mercatorTransform=new pd,this._verticalPerspectiveTransform=new Mo}clone(){const u=new $f;return u._globeness=this._globeness,u._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,u.apply(this),u}apply(u){this._helper.apply(u),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(u){const y=this._mercatorTransform.getProjectionData(u),I=this._verticalPerspectiveTransform.getProjectionData(u);return{mainMatrix:this.isGlobeRendering?I.mainMatrix:y.mainMatrix,clippingPlane:I.clippingPlane,tileMercatorCoords:I.tileMercatorCoords,projectionTransition:u.applyGlobeMatrix?this._globeness:0,fallbackMatrix:y.fallbackMatrix}}isLocationOccluded(u){return this.currentTransform.isLocationOccluded(u)}transformLightDirection(u){return this.currentTransform.transformLightDirection(u)}getPixelScale(){return t.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(u,y,I){const D=this._mercatorTransform.getPitchedTextCorrection(u,y,I),j=this._verticalPerspectiveTransform.getPitchedTextCorrection(u,y,I);return t.bu(D,j,this._globeness)}projectTileCoordinates(u,y,I,D){return this.currentTransform.projectTileCoordinates(u,y,I,D)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(u){return this.currentTransform.calculateFogMatrix(u)}getVisibleUnwrappedCoordinates(u){return this.currentTransform.getVisibleUnwrappedCoordinates(u)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(u){this._mercatorTransform.recalculateZoomAndCenter(u),this._verticalPerspectiveTransform.recalculateZoomAndCenter(u)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(u,y){return this.currentTransform.lngLatToCameraDepth(u,y)}populateCache(u){this._mercatorTransform.populateCache(u),this._verticalPerspectiveTransform.populateCache(u)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(u,y,I,D){return this._helper.calculateCenterFromCameraLngLatAlt(u,y,I,D)}setLocationAtPoint(u,y){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(u,y),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(u,y),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(u,y){return this.currentTransform.locationToScreenPoint(u,y)}screenPointToMercatorCoordinate(u,y){return this.currentTransform.screenPointToMercatorCoordinate(u,y)}screenPointToLocation(u,y){return this.currentTransform.screenPointToLocation(u,y)}isPointOnMapSurface(u,y){return this.currentTransform.isPointOnMapSurface(u,y)}getRayDirectionFromPixel(u){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(u)}getMatrixForModel(u,y){return this.currentTransform.getMatrixForModel(u,y)}getProjectionDataForCustomLayer(u=!0){const y=this._mercatorTransform.getProjectionDataForCustomLayer(u);if(!this.isGlobeRendering)return y;const I=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(u);return I.fallbackMatrix=y.mainMatrix,I}getFastPathSimpleProjectionMatrix(u){return this.currentTransform.getFastPathSimpleProjectionMatrix(u)}}class ea{get useGlobeControls(){return!0}handlePanInertia(u,y){const I=Qr(u,y);return Math.abs(I.lng-y.center.lng)>180&&(I.lng=y.center.lng+179.5*Math.sign(I.lng-y.center.lng)),{easingCenter:I,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(u,y){const I=u.around,D=y.screenPointToLocation(I);u.bearingDelta&&y.setBearing(y.bearing+u.bearingDelta),u.pitchDelta&&y.setPitch(y.pitch+u.pitchDelta),u.rollDelta&&y.setRoll(y.roll+u.rollDelta);const j=y.zoom;u.zoomDelta&&y.setZoom(y.zoom+u.zoomDelta);const H=y.zoom-j;if(H===0)return;const K=t.bK(y.center.lng,D.lng),te=K/(Math.abs(K/180)+1),ge=t.bK(y.center.lat,D.lat),xe=y.getRayDirectionFromPixel(I),fe=y.cameraPosition,De=-1*t.b5(fe,xe),Ve=t.bz();t.b0(Ve,fe,[xe[0]*De,xe[1]*De,xe[2]*De]);const Xe=t.b7(Ve)-1,xt=Math.exp(.5*-Math.max(Xe-.3,0)),wt=Al(y.worldSize,y.center.lat)/Math.min(y.width,y.height),Tt=t.bx(wt,.9,.5,1,.25),Mt=(1-t.aq(-H))*Math.min(xt,Tt),Yt=y.center.lat,Rt=y.zoom,Zt=new t.V(y.center.lng+te*Mt,t.an(y.center.lat+ge*Mt,-t.ao,t.ao));y.setLocationAtPoint(D,I);const ei=y.center,Ut=t.bx(Math.abs(K),45,85,0,1),hi=t.bx(wt,.75,.35,0,1),$i=Math.pow(Math.max(Ut,hi),.25),ki=t.bK(ei.lng,Zt.lng),Di=t.bK(ei.lat,Zt.lat);y.setCenter(new t.V(ei.lng+ki*$i,ei.lat+Di*$i).wrap()),y.setZoom(Rt+vn(Yt,y.center.lat))}handleMapControlsPan(u,y,I){if(!u.panDelta)return;const D=y.center.lat,j=y.zoom;y.setCenter(Qr(u.panDelta,y).wrap()),y.setZoom(j+vn(D,y.center.lat))}cameraForBoxAndBearing(u,y,I,D,j){const H=Jd(u,y,I,D,j),K=y.left/j.width*2-1,te=(j.width-y.right)/j.width*2-1,ge=y.top/j.height*-2+1,xe=(j.height-y.bottom)/j.height*-2+1,fe=t.bK(I.getWest(),I.getEast())<0,De=fe?I.getEast():I.getWest(),Ve=fe?I.getWest():I.getEast(),Xe=Math.max(I.getNorth(),I.getSouth()),xt=Math.min(I.getNorth(),I.getSouth()),wt=De+.5*t.bK(De,Ve),Tt=Xe+.5*t.bK(Xe,xt),Mt=j.clone();Mt.setCenter(H.center),Mt.setBearing(H.bearing),Mt.setPitch(0),Mt.setRoll(0),Mt.setZoom(H.zoom);const Yt=Mt.modelViewProjectionMatrix,Rt=[Xo(I.getNorthWest()),Xo(I.getNorthEast()),Xo(I.getSouthWest()),Xo(I.getSouthEast()),Xo(new t.V(Ve,Tt)),Xo(new t.V(De,Tt)),Xo(new t.V(wt,Xe)),Xo(new t.V(wt,xt))],Zt=Xo(H.center);let ei=Number.POSITIVE_INFINITY;for(const Ut of Rt)K<0&&(ei=ea.getLesserNonNegativeNonNull(ei,ea.solveVectorScale(Ut,Zt,Yt,"x",K))),te>0&&(ei=ea.getLesserNonNegativeNonNull(ei,ea.solveVectorScale(Ut,Zt,Yt,"x",te))),ge>0&&(ei=ea.getLesserNonNegativeNonNull(ei,ea.solveVectorScale(Ut,Zt,Yt,"y",ge))),xe<0&&(ei=ea.getLesserNonNegativeNonNull(ei,ea.solveVectorScale(Ut,Zt,Yt,"y",xe)));if(Number.isFinite(ei)&&ei!==0)return H.zoom=Mt.zoom+t.at(ei),H;Ju()}handleJumpToCenterZoom(u,y){const I=u.center.lat,D=u.applyConstrain(y.center?t.V.convert(y.center):u.center,u.zoom).center;u.setCenter(D.wrap());const j=y.zoom!==void 0?+y.zoom:u.zoom+vn(I,D.lat);u.zoom!==j&&u.setZoom(j)}handleEaseTo(u,y){const I=u.zoom,D=u.center,j=u.padding,H={roll:u.roll,pitch:u.pitch,bearing:u.bearing},K={roll:y.roll===void 0?u.roll:y.roll,pitch:y.pitch===void 0?u.pitch:y.pitch,bearing:y.bearing===void 0?u.bearing:y.bearing},te=y.zoom!==void 0,ge=!u.isPaddingEqual(y.padding);let xe=!1;const fe=y.center?t.V.convert(y.center):D,De=u.applyConstrain(fe,I).center;fd(u,De);const Ve=u.clone();Ve.setCenter(De),Ve.setZoom(te?+y.zoom:I+vn(D.lat,fe.lat)),Ve.setBearing(y.bearing);const Xe=new t.P(t.an(u.centerPoint.x+y.offsetAsPoint.x,0,u.width),t.an(u.centerPoint.y+y.offsetAsPoint.y,0,u.height));Ve.setLocationAtPoint(De,Xe);const xt=(y.offset&&y.offsetAsPoint.mag())>0?Ve.center:De,wt=te?+y.zoom:I+vn(D.lat,xt.lat),Tt=I+vn(D.lat,0),Mt=wt+vn(xt.lat,0),Yt=t.bK(D.lng,xt.lng),Rt=t.bK(D.lat,xt.lat),Zt=t.aq(Mt-Tt);return xe=wt!==I,{easeFunc:ei=>{if(t.bo(H,K)||Lh({startEulerAngles:H,endEulerAngles:K,tr:u,k:ei,useSlerp:H.roll!=K.roll}),ge&&u.interpolatePadding(j,y.padding,ei),y.around)t.w("Easing around a point is not supported under globe projection."),u.setLocationAtPoint(y.around,y.aroundPoint);else{const Ut=Mt>Tt?Math.min(2,Zt):Math.max(.5,Zt),hi=Math.pow(Ut,1-ei),$i=Yl(D,Yt,Rt,ei*hi);u.setCenter($i.wrap())}if(xe){const Ut=t.G.number(Tt,Mt,ei)+vn(0,u.center.lat);u.setZoom(Ut)}},isZooming:xe,elevationCenter:xt}}handleFlyTo(u,y){const I=y.zoom!==void 0,D=u.center,j=u.zoom,H=u.padding,K=!u.isPaddingEqual(y.padding),te=u.applyConstrain(t.V.convert(y.center||y.locationAtOffset),j).center,ge=I?+y.zoom:u.zoom+vn(u.center.lat,te.lat),xe=u.clone();xe.setCenter(te),xe.setZoom(ge),xe.setBearing(y.bearing);const fe=new t.P(t.an(u.centerPoint.x+y.offsetAsPoint.x,0,u.width),t.an(u.centerPoint.y+y.offsetAsPoint.y,0,u.height));xe.setLocationAtPoint(te,fe);const De=xe.center;fd(u,De);const Ve=(function(Rt,Zt,ei){const Ut=Xo(Zt),hi=Xo(ei),$i=t.b5(Ut,hi),ki=Math.acos($i),Di=Gn(Rt);return ki/(2*Math.PI)*Di})(u,D,De),Xe=j+vn(D.lat,0),xt=ge+vn(De.lat,0),wt=t.aq(xt-Xe);let Tt;if(typeof y.minZoom=="number"){const Rt=+y.minZoom+vn(De.lat,0),Zt=Math.min(Rt,Xe,xt)+vn(0,De.lat),ei=u.applyConstrain(De,Zt).zoom+vn(De.lat,0);Tt=t.aq(ei-Xe)}const Mt=t.bK(D.lng,De.lng),Yt=t.bK(D.lat,De.lat);return{easeFunc:(Rt,Zt,ei,Ut)=>{const hi=Yl(D,Mt,Yt,ei);K&&u.interpolatePadding(H,y.padding,Rt);const $i=Rt===1?De:hi;u.setCenter($i.wrap());const ki=Xe+t.at(Zt);u.setZoom(Rt===1?ge:ki+vn(0,$i.lat))},scaleOfZoom:wt,targetCenter:De,scaleOfMinZoom:Tt,pixelPathLength:Ve}}static solveVectorScale(u,y,I,D,j){const H=D==="x"?[I[0],I[4],I[8],I[12]]:[I[1],I[5],I[9],I[13]],K=[I[3],I[7],I[11],I[15]],te=u[0]*H[0]+u[1]*H[1]+u[2]*H[2],ge=u[0]*K[0]+u[1]*K[1]+u[2]*K[2],xe=y[0]*H[0]+y[1]*H[1]+y[2]*H[2],fe=y[0]*K[0]+y[1]*K[1]+y[2]*K[2];return xe+j*ge===te+j*fe||K[3]*(te-xe)+H[3]*(fe-ge)+te*fe==xe*ge?null:(xe+H[3]-j*fe-j*K[3])/(xe-te-j*fe+j*ge)}static getLesserNonNegativeNonNull(u,y){return y!==null&&y>=0&&y<u?y:u}}class Dm{constructor(u){this._globe=u,this._mercatorCameraHelper=new Cu,this._verticalPerspectiveCameraHelper=new ea}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(u,y){return this.currentHelper.handlePanInertia(u,y)}handleMapControlsRollPitchBearingZoom(u,y){return this.currentHelper.handleMapControlsRollPitchBearingZoom(u,y)}handleMapControlsPan(u,y,I){this.currentHelper.handleMapControlsPan(u,y,I)}cameraForBoxAndBearing(u,y,I,D,j){return this.currentHelper.cameraForBoxAndBearing(u,y,I,D,j)}handleJumpToCenterZoom(u,y){this.currentHelper.handleJumpToCenterZoom(u,y)}handleEaseTo(u,y){return this.currentHelper.handleEaseTo(u,y)}handleFlyTo(u,y){return this.currentHelper.handleFlyTo(u,y)}}const th=(V,u)=>t.B(V,u&&u.filter((y=>y.identifier!=="source.canvas"))),_d=t.bO();class Oh extends t.E{constructor(u,y={}){var I,D;super(),this._rtlPluginLoaded=()=>{for(const H in this.tileManagers){const K=this.tileManagers[H].getSource().type;K!=="vector"&&K!=="geojson"||this.tileManagers[H].reload()}},this.map=u,this.dispatcher=new gn(Gi(),u._getMapId()),this.dispatcher.registerMessageHandler("GG",((H,K)=>this.getGlyphs(H,K))),this.dispatcher.registerMessageHandler("GI",((H,K)=>this.getImages(H,K))),this.dispatcher.registerMessageHandler("GDA",((H,K)=>this.getDashes(H,K))),this.imageManager=new Ht,this.imageManager.setEventedParent(this);const j=((I=u._container)===null||I===void 0?void 0:I.lang)||typeof document<"u"&&((D=document.documentElement)===null||D===void 0?void 0:D.lang)||void 0;this.glyphManager=new Ft(u._requestManager,y.localIdeographFontFamily,j),this.lineAtlas=new Fn(256,512),this.crossTileSymbolIndex=new cl,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",t.bP()),gi().on(At,this._rtlPluginLoaded),this.on("data",(H=>{if(H.dataType!=="source"||H.sourceDataType!=="metadata")return;const K=this.tileManagers[H.sourceId];if(!K)return;const te=K.getSource();if(te&&te.vectorLayerIds)for(const ge in this._layers){const xe=this._layers[ge];xe.source===te.id&&this._validateLayer(xe)}}))}_setInitialValues(){var u;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new t.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((u=this.crossTileSymbolIndex)===null||u===void 0?void 0:u.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(u,y){var I,D,j;this._checkLoaded();const H=y===null?(j=(D=(I=this.stylesheet.state)===null||I===void 0?void 0:I[u])===null||D===void 0?void 0:D.default)!==null&&j!==void 0?j:null:y;if(t.bR(H,this._globalState[u]))return this;this._globalState[u]=H,this._applyGlobalStateChanges([u])}getGlobalState(){return this._globalState}setGlobalState(u){this._checkLoaded();const y=[];for(const I in u)!t.bR(this._globalState[I],u[I].default)&&(y.push(I),this._globalState[I]=u[I].default);this._applyGlobalStateChanges(y)}_applyGlobalStateChanges(u){if(u.length===0)return;const y=new Set,I={};for(const D of u){I[D]=this._globalState[D];for(const j in this._layers){const H=this._layers[j],K=H.getLayoutAffectingGlobalStateRefs(),te=H.getPaintAffectingGlobalStateRefs(),ge=H.getVisibilityAffectingGlobalStateRefs();if(K.has(D)&&y.add(H.source),te.has(D))for(const{name:xe,value:fe}of te.get(D))this._updatePaintProperty(H,xe,fe);ge?.has(D)&&(H.recalculateVisibility(),this._updateLayer(H))}}this.dispatcher.broadcast("UGS",I);for(const D in this.tileManagers)y.has(D)&&(this._reloadSource(D),this._changed=!0)}loadURL(u,y={},I){this.fire(new t.l("dataloading",{dataType:"style"})),y.validate=typeof y.validate!="boolean"||y.validate;const D=this.map._requestManager.transformRequest(u,"Style");this._loadStyleRequest=new AbortController;const j=this._loadStyleRequest;t.j(D,this._loadStyleRequest).then((H=>{this._loadStyleRequest=null,this._load(H.data,y,I)})).catch((H=>{this._loadStyleRequest=null,H&&!j.signal.aborted&&this.fire(new t.k(H))}))}loadJSON(u,y={},I){this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,y.validate=y.validate!==!1,this._load(u,y,I)})).catch((()=>{}))}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(_d,{validate:!1})}_load(u,y,I){var D,j;let H=y.transformStyle?y.transformStyle(I,u):u;if(!y.validate||!th(this,t.C(H))){H=Object.assign({},H),this._loaded=!0,this.stylesheet=H;for(const K in H.sources)this.addSource(K,H.sources[K],{validate:!1});H.sprite?this._loadSprite(H.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(H.glyphs),this._createLayers(),this.light=new Qi(this.stylesheet.light),this._setProjectionInternal(((D=this.stylesheet.projection)===null||D===void 0?void 0:D.type)||"mercator"),this.sky=new qn(this.stylesheet.sky),this.map.setTerrain((j=this.stylesheet.terrain)!==null&&j!==void 0?j:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){var u,y,I;const D=t.bS(this.stylesheet.layers);this.setGlobalState((u=this.stylesheet.state)!==null&&u!==void 0?u:null),this.dispatcher.broadcast("SL",D),this._order=D.map((j=>j.id)),this._layers={},this._serializedLayers=null;for(const j of D){const H=t.bT(j,this._globalState);if(H.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=H,t.bU(H)&&this.tileManagers[H.source]){const K=(I=(y=j.paint)===null||y===void 0?void 0:y["raster-fade-duration"])!==null&&I!==void 0?I:H.paint.get("raster-fade-duration");this.tileManagers[H.source].setRasterFadeDuration(K)}}}_loadSprite(u,y=!1,I=void 0){this.imageManager.setLoaded(!1);const D=new AbortController;let j;this._spriteRequest=D,(function(H,K,te,ge){return t._(this,void 0,void 0,(function*(){const xe=Ye(H),fe=te>1?"@2x":"",De={},Ve={};for(const{id:Xe,url:xt}of xe){const wt=K.transformRequest(ct(xt,fe,".json"),"SpriteJSON");De[Xe]=t.j(wt,ge);const Tt=K.transformRequest(ct(xt,fe,".png"),"SpriteImage");Ve[Xe]=We.getImage(Tt,ge)}return yield Promise.all([...Object.values(De),...Object.values(Ve)]),(function(Xe,xt){return t._(this,void 0,void 0,(function*(){const wt={};for(const Tt in Xe){wt[Tt]={};const Mt=Y.getImageCanvasContext((yield xt[Tt]).data),Yt=(yield Xe[Tt]).data;for(const Rt in Yt){const{width:Zt,height:ei,x:Ut,y:hi,sdf:$i,pixelRatio:ki,stretchX:Di,stretchY:Pi,content:On,textFitWidth:Nn,textFitHeight:bn}=Yt[Rt];wt[Tt][Rt]={data:null,pixelRatio:ki,sdf:$i,stretchX:Di,stretchY:Pi,content:On,textFitWidth:Nn,textFitHeight:bn,spriteData:{width:Zt,height:ei,x:Ut,y:hi,context:Mt}}}}return wt}))})(De,Ve)}))})(u,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((H=>{if(this._spriteRequest=null,H)for(const K in H){this._spritesImagesIds[K]=[];const te=this._spritesImagesIds[K]?this._spritesImagesIds[K].filter((ge=>!(ge in H))):[];for(const ge of te)this.imageManager.removeImage(ge),this._changedImages[ge]=!0;for(const ge in H[K]){const xe=K==="default"?ge:`${K}:${ge}`;this._spritesImagesIds[K].push(xe),xe in this.imageManager.images?this.imageManager.updateImage(xe,H[K][ge],!1):this.imageManager.addImage(xe,H[K][ge]),y&&(this._changedImages[xe]=!0)}}})).catch((H=>{this._spriteRequest=null,j=H,D.signal.aborted||this.fire(new t.k(j))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),y&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),I&&I(j)}))}_unloadSprite(){for(const u of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(u),this._changedImages[u]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(u){const y=this.tileManagers[u.source];if(!y)return;const I=u.sourceLayer;if(!I)return;const D=y.getSource();(D.type==="geojson"||D.vectorLayerIds&&D.vectorLayerIds.indexOf(I)===-1)&&this.fire(new t.k(new Error(`Source layer "${I}" does not exist on source "${D.id}" as specified by style layer "${u.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this.tileManagers)if(!this.tileManagers[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(u,y=!1){const I=this._serializedAllLayers();if(!u||u.length===0)return Object.values(y?t.bV(I):I);const D=[];for(const j of u)if(I[j]){const H=y?t.bV(I[j]):I[j];D.push(H)}return D}_serializedAllLayers(){let u=this._serializedLayers;if(u)return u;u=this._serializedLayers={};const y=Object.keys(this._layers);for(const I of y){const D=this._layers[I];D.type!=="custom"&&(u[I]=D.serialize())}return u}hasTransitions(){var u,y,I;if(!((u=this.light)===null||u===void 0)&&u.hasTransition()||!((y=this.sky)===null||y===void 0)&&y.hasTransition()||!((I=this.projection)===null||I===void 0)&&I.hasTransition())return!0;for(const D in this.tileManagers)if(this.tileManagers[D].hasTransition())return!0;for(const D in this._layers)if(this._layers[D].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(u){if(!this._loaded)return;const y=this._changed;if(y){const D=Object.keys(this._updatedLayers),j=Object.keys(this._removedLayers);(D.length||j.length)&&this._updateWorkerLayers(D,j);for(const H in this._updatedSources){const K=this._updatedSources[H];if(K==="reload")this._reloadSource(H);else{if(K!=="clear")throw new Error(`Invalid action ${K}`);this._clearSource(H)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const H in this._updatedPaintProps)this._layers[H].updateTransitions(u);this.light.updateTransitions(u),this.sky.updateTransitions(u),this._resetUpdates()}const I={};for(const D in this.tileManagers){const j=this.tileManagers[D];I[D]=j.used,j.used=!1}for(const D of this._order){const j=this._layers[D];j.recalculate(u,this._availableImages),!j.isHidden(u.zoom)&&j.source&&(this.tileManagers[j.source].used=!0)}for(const D in I){const j=this.tileManagers[D];!!I[D]!=!!j.used&&j.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:D}))}this.light.recalculate(u),this.sky.recalculate(u),this.projection.recalculate(u),this.z=u.zoom,y&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const y in this.tileManagers)this.tileManagers[y].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const u in this.tileManagers)this.tileManagers[u].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(u,y){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(u,!1),removedIds:y})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(u,y={}){var I;this._checkLoaded();const D=this.serialize();if(u=y.transformStyle?y.transformStyle(D,u):u,((I=y.validate)===null||I===void 0||I)&&th(this,t.C(u)))return!1;(u=t.bV(u)).layers=t.bS(u.layers);const j=t.bW(D,u),H=this._getOperationsToPerform(j);if(H.unimplemented.length>0)throw new Error(`Unimplemented: ${H.unimplemented.join(", ")}.`);if(H.operations.length===0)return!1;for(const K of H.operations)K();return this.stylesheet=u,this._serializedLayers=null,!0}_getOperationsToPerform(u){const y=[],I=[];for(const D of u)switch(D.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":y.push((()=>this.addLayer.apply(this,D.args)));break;case"removeLayer":y.push((()=>this.removeLayer.apply(this,D.args)));break;case"setPaintProperty":y.push((()=>this.setPaintProperty.apply(this,D.args)));break;case"setLayoutProperty":y.push((()=>this.setLayoutProperty.apply(this,D.args)));break;case"setFilter":y.push((()=>this.setFilter.apply(this,D.args)));break;case"addSource":y.push((()=>this.addSource.apply(this,D.args)));break;case"removeSource":y.push((()=>this.removeSource.apply(this,D.args)));break;case"setLayerZoomRange":y.push((()=>this.setLayerZoomRange.apply(this,D.args)));break;case"setLight":y.push((()=>this.setLight.apply(this,D.args)));break;case"setGeoJSONSourceData":y.push((()=>this.setGeoJSONSourceData.apply(this,D.args)));break;case"setGlyphs":y.push((()=>this.setGlyphs.apply(this,D.args)));break;case"setSprite":y.push((()=>this.setSprite.apply(this,D.args)));break;case"setTerrain":y.push((()=>this.map.setTerrain.apply(this,D.args)));break;case"setSky":y.push((()=>this.setSky.apply(this,D.args)));break;case"setProjection":this.setProjection.apply(this,D.args);break;case"setGlobalState":y.push((()=>this.setGlobalState.apply(this,D.args)));break;case"setTransition":y.push((()=>{}));break;default:I.push(D.command)}return{operations:y,unimplemented:I}}addImage(u,y){if(this.getImage(u))return this.fire(new t.k(new Error(`An image named "${u}" already exists.`)));this.imageManager.addImage(u,y),this._afterImageUpdated(u)}updateImage(u,y){this.imageManager.updateImage(u,y)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){if(!this.getImage(u))return this.fire(new t.k(new Error(`An image named "${u}" does not exist.`)));this.imageManager.removeImage(u),this._afterImageUpdated(u)}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(u,y,I={}){if(this._checkLoaded(),this.tileManagers[u]!==void 0)throw new Error(`Source "${u}" already exists.`);if(!y.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(y).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(y.type)>=0&&this._validate(t.C.source,`sources.${u}`,y,null,I))return;this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);const D=this.tileManagers[u]=new we(u,y,this.dispatcher);D.style=this,D.setEventedParent(this,(()=>({isSourceLoaded:D.loaded(),source:D.serialize(),sourceId:u}))),D.onAdd(this.map),this._changed=!0}removeSource(u){if(this._checkLoaded(),this.tileManagers[u]===void 0)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===u)return this.fire(new t.k(new Error(`Source "${u}" cannot be removed while layer "${I}" is using it.`)));const y=this.tileManagers[u];delete this.tileManagers[u],delete this._updatedSources[u],y.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),y.setEventedParent(null),y.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(u,y){if(this._checkLoaded(),this.tileManagers[u]===void 0)throw new Error(`There is no source with this ID=${u}`);const I=this.tileManagers[u].getSource();if(I.type!=="geojson")throw new Error(`geojsonSource.type is ${I.type}, which is !== 'geojson`);I.setData(y),this._changed=!0}getSource(u){return this.tileManagers[u]&&this.tileManagers[u].getSource()}addLayer(u,y,I={}){this._checkLoaded();const D=u.id;if(this.getLayer(D))return void this.fire(new t.k(new Error(`Layer "${D}" already exists on this map.`)));let j;if(u.type==="custom"){if(th(this,t.bX(u)))return;j=t.bT(u,this._globalState)}else{if("source"in u&&typeof u.source=="object"&&(this.addSource(D,u.source),u=t.bV(u),u=t.e(u,{source:D})),this._validate(t.C.layer,`layers.${D}`,u,{arrayIndex:-1},I))return;j=t.bT(u,this._globalState),this._validateLayer(j),j.setEventedParent(this,{layer:{id:D}})}const H=y?this._order.indexOf(y):this._order.length;if(y&&H===-1)this.fire(new t.k(new Error(`Cannot add layer "${D}" before non-existing layer "${y}".`)));else{if(this._order.splice(H,0,D),this._layerOrderChanged=!0,this._layers[D]=j,this._removedLayers[D]&&j.source&&j.type!=="custom"){const K=this._removedLayers[D];delete this._removedLayers[D],K.type!==j.type?this._updatedSources[j.source]="clear":(this._updatedSources[j.source]="reload",this.tileManagers[j.source].pause())}this._updateLayer(j),j.onAdd&&j.onAdd(this.map)}}moveLayer(u,y){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new t.k(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===y)return;const I=this._order.indexOf(u);this._order.splice(I,1);const D=y?this._order.indexOf(y):this._order.length;y&&D===-1?this.fire(new t.k(new Error(`Cannot move layer "${u}" before non-existing layer "${y}".`))):(this._order.splice(D,0,u),this._layerOrderChanged=!0)}removeLayer(u){this._checkLoaded();const y=this._layers[u];if(!y)return void this.fire(new t.k(new Error(`Cannot remove non-existing layer "${u}".`)));y.setEventedParent(null);const I=this._order.indexOf(u);this._order.splice(I,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=y,delete this._layers[u],this._serializedLayers&&delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],y.onRemove&&y.onRemove(this.map)}getLayer(u){return this._layers[u]}getLayersOrder(){return[...this._order]}hasLayer(u){return u in this._layers}setLayerZoomRange(u,y,I){this._checkLoaded();const D=this.getLayer(u);D?D.minzoom===y&&D.maxzoom===I||(y!=null&&(D.minzoom=y),I!=null&&(D.maxzoom=I),this._updateLayer(D)):this.fire(new t.k(new Error(`Cannot set the zoom range of non-existing layer "${u}".`)))}setFilter(u,y,I={}){this._checkLoaded();const D=this.getLayer(u);if(D){if(!t.bR(D.filter,y))return y==null?(D.setFilter(void 0),void this._updateLayer(D)):void(this._validate(t.C.filter,`layers.${D.id}.filter`,y,null,I)||(D.setFilter(t.bV(y)),this._updateLayer(D)))}else this.fire(new t.k(new Error(`Cannot filter non-existing layer "${u}".`)))}getFilter(u){return t.bV(this.getLayer(u).filter)}setLayoutProperty(u,y,I,D={}){this._checkLoaded();const j=this.getLayer(u);j?t.bR(j.getLayoutProperty(y),I)||(j.setLayoutProperty(y,I,D),this._updateLayer(j)):this.fire(new t.k(new Error(`Cannot style non-existing layer "${u}".`)))}getLayoutProperty(u,y){const I=this.getLayer(u);if(I)return I.getLayoutProperty(y);this.fire(new t.k(new Error(`Cannot get style of non-existing layer "${u}".`)))}setPaintProperty(u,y,I,D={}){this._checkLoaded();const j=this.getLayer(u);j?t.bR(j.getPaintProperty(y),I)||this._updatePaintProperty(j,y,I,D):this.fire(new t.k(new Error(`Cannot style non-existing layer "${u}".`)))}_updatePaintProperty(u,y,I,D={}){u.setPaintProperty(y,I,D)&&this._updateLayer(u),t.bU(u)&&y==="raster-fade-duration"&&this.tileManagers[u.source].setRasterFadeDuration(I),this._changed=!0,this._updatedPaintProps[u.id]=!0,this._serializedLayers=null}getPaintProperty(u,y){return this.getLayer(u).getPaintProperty(y)}setFeatureState(u,y){this._checkLoaded();const I=u.source,D=u.sourceLayer,j=this.tileManagers[I];if(j===void 0)return void this.fire(new t.k(new Error(`The source '${I}' does not exist in the map's style.`)));const H=j.getSource().type;H==="geojson"&&D?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):H!=="vector"||D?(u.id===void 0&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),j.setFeatureState(D,u.id,y)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(u,y){this._checkLoaded();const I=u.source,D=this.tileManagers[I];if(D===void 0)return void this.fire(new t.k(new Error(`The source '${I}' does not exist in the map's style.`)));const j=D.getSource().type,H=j==="vector"?u.sourceLayer:void 0;j!=="vector"||H?y&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):D.removeFeatureState(H,u.id,y):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(u){this._checkLoaded();const y=u.source,I=u.sourceLayer,D=this.tileManagers[y];if(D!==void 0)return D.getSource().type!=="vector"||I?(u.id===void 0&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),D.getFeatureState(I,u.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error(`The source '${y}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const u=t.bY(this.tileManagers,(j=>j.serialize())),y=this._serializeByIds(this._order,!0),I=this.map.getTerrain()||void 0,D=this.stylesheet;return t.bZ({version:D.version,name:D.name,metadata:D.metadata,light:D.light,sky:D.sky,center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch,sprite:D.sprite,glyphs:D.glyphs,transition:D.transition,projection:D.projection,sources:u,layers:y,terrain:I},(j=>j!==void 0))}_updateLayer(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.tileManagers[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.tileManagers[u.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(u){const y=H=>this._layers[H].type==="fill-extrusion",I={},D=[];for(let H=this._order.length-1;H>=0;H--){const K=this._order[H];if(y(K)){I[K]=H;for(const te of u){const ge=te[K];if(ge)for(const xe of ge)D.push(xe)}}}D.sort(((H,K)=>K.intersectionZ-H.intersectionZ));const j=[];for(let H=this._order.length-1;H>=0;H--){const K=this._order[H];if(y(K))for(let te=D.length-1;te>=0;te--){const ge=D[te].feature;if(I[ge.layer.id]<H)break;j.push(ge),D.pop()}else for(const te of u){const ge=te[K];if(ge)for(const xe of ge)j.push(xe.feature)}}return j}queryRenderedFeatures(u,y,I){y&&y.filter&&this._validate(t.C.filter,"queryRenderedFeatures.filter",y.filter,null,y);const D={};if(y&&y.layers){if(!(Array.isArray(y.layers)||y.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const ge of y.layers){const xe=this._layers[ge];if(!xe)return this.fire(new t.k(new Error(`The layer '${ge}' does not exist in the map's style and cannot be queried for features.`))),[];D[xe.source]=!0}}const j=[];y.availableImages=this._availableImages;const H=this._serializedAllLayers(),K=y.layers instanceof Set?y.layers:Array.isArray(y.layers)?new Set(y.layers):null,te=Object.assign(Object.assign({},y),{layers:K,globalState:this._globalState});for(const ge in this.tileManagers)y.layers&&!D[ge]||j.push(St(this.tileManagers[ge],this._layers,H,u,te,I,this.map.terrain?(xe,fe,De)=>this.map.terrain.getElevation(xe,fe,De):void 0));return this.placement&&j.push((function(ge,xe,fe,De,Ve,Xe,xt){const wt={},Tt=Xe.queryRenderedSymbols(De),Mt=[];for(const Yt of Object.keys(Tt).map(Number))Mt.push(xt[Yt]);Mt.sort(Gt);for(const Yt of Mt){const Rt=Yt.featureIndex.lookupSymbolFeatures(Tt[Yt.bucketInstanceId],xe,Yt.bucketIndex,Yt.sourceLayerIndex,{filterSpec:Ve.filter,globalState:Ve.globalState},Ve.layers,Ve.availableImages,ge);for(const Zt in Rt){const ei=wt[Zt]=wt[Zt]||[],Ut=Rt[Zt];Ut.sort(((hi,$i)=>{const ki=Yt.featureSortOrder;if(ki){const Di=ki.indexOf(hi.featureIndex);return ki.indexOf($i.featureIndex)-Di}return $i.featureIndex-hi.featureIndex}));for(const hi of Ut)ei.push(hi)}}return(function(Yt,Rt,Zt){for(const ei in Yt)for(const Ut of Yt[ei])Ai(Ut,Zt[Rt[ei].source]);return Yt})(wt,ge,fe)})(this._layers,H,this.tileManagers,u,te,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)}querySourceFeatures(u,y){y?.filter&&this._validate(t.C.filter,"querySourceFeatures.filter",y.filter,null,y);const I=this.tileManagers[u];return I?(function(D,j){const H=D.getRenderableIds().map((ge=>D.getTileByID(ge))),K=[],te={};for(let ge=0;ge<H.length;ge++){const xe=H[ge],fe=xe.tileID.canonical.key;te[fe]||(te[fe]=!0,xe.querySourceFeatures(K,j))}return K})(I,y?Object.assign(Object.assign({},y),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(u,y={}){this._checkLoaded();const I=this.light.getLight();let D=!1;for(const H in u)if(!t.bR(u[H],I[H])){D=!0;break}if(!D)return;const j={now:se(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,y),this.light.updateTransitions(j)}getProjection(){var u;return(u=this.stylesheet)===null||u===void 0?void 0:u.projection}setProjection(u){if(this._checkLoaded(),this.projection){if(this.projection.name===u.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=u,this._setProjectionInternal(u.type)}getSky(){var u;return(u=this.stylesheet)===null||u===void 0?void 0:u.sky}setSky(u,y={}){this._checkLoaded();const I=this.getSky();let D=!1;if(!u&&!I)return;if(u&&!I)D=!0;else if(!u&&I)D=!0;else for(const H in u)if(!t.bR(u[H],I[H])){D=!0;break}if(!D)return;const j={now:se(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=u,this.sky.setSky(u,y),this.sky.updateTransitions(j)}_setProjectionInternal(u){const y=(function(I,D){const j={constrainOverride:D};if(Array.isArray(I)){const H=new Fg({type:I});return{projection:H,transform:new $f(j),cameraHelper:new Dm(H)}}switch(I){case"mercator":return{projection:new el,transform:new pd(j),cameraHelper:new Cu};case"globe":{const H=new Fg({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:H,transform:new $f(j),cameraHelper:new Dm(H)}}case"vertical-perspective":return{projection:new km,transform:new Mo(j),cameraHelper:new ea};default:return t.w(`Unknown projection name: ${I}. Falling back to mercator projection.`),{projection:new el,transform:new pd(j),cameraHelper:new Cu}}})(u,this.map.transformConstrain);this.projection=y.projection,this.map.migrateProjection(y.transform,y.cameraHelper);for(const I in this.tileManagers)this.tileManagers[I].reload()}_validate(u,y,I,D,j={}){return(!j||j.validate!==!1)&&th(this,u.call(t.C,t.e({key:y,style:this.serialize(),value:I,styleSpec:t.u},D)))}_remove(u=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),gi().off(At,this._rtlPluginLoaded);for(const y in this._layers)this._layers[y].setEventedParent(null);for(const y in this.tileManagers){const I=this.tileManagers[y];I.setEventedParent(null),I.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),u&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(u)}_clearSource(u){this.tileManagers[u].clearTiles()}_reloadSource(u){this.tileManagers[u].resume(),this.tileManagers[u].reload()}_updateSources(u){for(const y in this.tileManagers)this.tileManagers[y].update(u,this.map.terrain)}_generateCollisionBoxes(){for(const u in this.tileManagers)this._reloadSource(u)}_updatePlacement(u,y,I,D,j=!1){let H=!1,K=!1;const te={};for(const ge of this._order){const xe=this._layers[ge];if(xe.type!=="symbol")continue;if(!te[xe.source]){const De=this.tileManagers[xe.source];te[xe.source]=De.getRenderableIds(!0).map((Ve=>De.getTileByID(Ve))).sort(((Ve,Xe)=>Xe.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan(Xe.tileID)?-1:1)))}const fe=this.crossTileSymbolIndex.addLayer(xe,te[xe.source],u.center.lng);H=H||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((j=j||this._layerOrderChanged||I===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(se(),u.zoom))&&(this.pauseablePlacement=new Wl(u,this.map.terrain,this._order,j,y,I,D,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(se()),K=!0),H&&this.pauseablePlacement.placement.setStale()),K||H)for(const ge of this._order){const xe=this._layers[ge];xe.type==="symbol"&&this.placement.updateLayerOpacities(xe,te[xe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(se())}_releaseSymbolFadeTiles(){for(const u in this.tileManagers)this.tileManagers[u].releaseSymbolFadeTiles()}getImages(u,y){return t._(this,void 0,void 0,(function*(){const I=yield this.imageManager.getImages(y.icons);this._updateTilesForChangedImages();const D=this.tileManagers[y.source];return D&&D.setDependencies(y.tileID.key,y.type,y.icons),I}))}getGlyphs(u,y){return t._(this,void 0,void 0,(function*(){const I=yield this.glyphManager.getGlyphs(y.stacks),D=this.tileManagers[y.source];return D&&D.setDependencies(y.tileID.key,y.type,[""]),I}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(u,y={}){this._checkLoaded(),u&&this._validate(t.C.glyphs,"glyphs",u,null,y)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=u,this.glyphManager.entries={},this.glyphManager.setURL(u))}getDashes(u,y){return t._(this,void 0,void 0,(function*(){const I={};for(const[D,j]of Object.entries(y.dashes))I[D]=this.lineAtlas.getDash(j.dasharray,j.round);return I}))}addSprite(u,y,I={},D){this._checkLoaded();const j=[{id:u,url:y}],H=[...Ye(this.stylesheet.sprite),...j];this._validate(t.C.sprite,"sprite",H,null,I)||(this.stylesheet.sprite=H,this._loadSprite(j,!0,D))}removeSprite(u){this._checkLoaded();const y=Ye(this.stylesheet.sprite);if(y.find((I=>I.id===u))){if(this._spritesImagesIds[u])for(const I of this._spritesImagesIds[u])this.imageManager.removeImage(I),this._changedImages[I]=!0;y.splice(y.findIndex((I=>I.id===u)),1),this.stylesheet.sprite=y.length>0?y:void 0,delete this._spritesImagesIds[u],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error(`Sprite "${u}" doesn't exists on this map.`)))}getSprite(){return Ye(this.stylesheet.sprite)}setSprite(u,y={},I){this._checkLoaded(),u&&this._validate(t.C.sprite,"sprite",u,null,y)||(this.stylesheet.sprite=u,u?this._loadSprite(u,!0,I):(this._unloadSprite(),I&&I(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const u in this.tileManagers){const y=this.tileManagers[u];y.setEventedParent(null),y.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const u in this._layers){const y=this._layers[u];y.setEventedParent(null),y.onRemove&&y.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Lm=t.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class xl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(u,y,I,D,j,H,K,te,ge){this.context=u;let xe=this.boundPaintVertexBuffers.length!==D.length;for(let fe=0;!xe&&fe<D.length;fe++)this.boundPaintVertexBuffers[fe]!==D[fe]&&(xe=!0);!this.vao||this.boundProgram!==y||this.boundLayoutVertexBuffer!==I||xe||this.boundIndexBuffer!==j||this.boundVertexOffset!==H||this.boundDynamicVertexBuffer!==K||this.boundDynamicVertexBuffer2!==te||this.boundDynamicVertexBuffer3!==ge?this.freshBind(y,I,D,j,H,K,te,ge):(u.bindVertexArray.set(this.vao),K&&K.bind(),j&&j.dynamicDraw&&j.bind(),te&&te.bind(),ge&&ge.bind())}freshBind(u,y,I,D,j,H,K,te){const ge=u.numAttributes,xe=this.context,fe=xe.gl;this.vao&&this.destroy(),this.vao=xe.createVertexArray(),xe.bindVertexArray.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=y,this.boundPaintVertexBuffers=I,this.boundIndexBuffer=D,this.boundVertexOffset=j,this.boundDynamicVertexBuffer=H,this.boundDynamicVertexBuffer2=K,this.boundDynamicVertexBuffer3=te,y.enableAttributes(fe,u);for(const De of I)De.enableAttributes(fe,u);H&&H.enableAttributes(fe,u),K&&K.enableAttributes(fe,u),te&&te.enableAttributes(fe,u),y.bind(),y.setVertexAttribPointers(fe,u,j);for(const De of I)De.bind(),De.setVertexAttribPointers(fe,u,j);H&&(H.bind(),H.setVertexAttribPointers(fe,u,j)),D&&D.bind(),K&&(K.bind(),K.setVertexAttribPointers(fe,u,j)),te&&(te.bind(),te.setVertexAttribPointers(fe,u,j)),xe.currentNumAttributes=ge}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Fh=(V,u,y,I,D)=>({u_texture:0,u_ele_delta:V,u_fog_matrix:u,u_fog_color:y?y.properties.get("fog-color"):t.bp.white,u_fog_ground_blend:y?y.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:D?0:y?y.calculateFogBlendOpacity(I):0,u_horizon_color:y?y.properties.get("horizon-color"):t.bp.white,u_horizon_fog_blend:y?y.properties.get("horizon-fog-blend"):1,u_is_globe_mode:D?1:0}),tl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ih(V){const u=[];for(let y=0;y<V.length;y++){if(V[y]===null)continue;const I=V[y].split(" ");u.push(I.pop())}return u}class tf{constructor(u,y,I,D,j,H,K,te,ge=[]){const xe=u.gl;this.program=xe.createProgram();const fe=ih(y.staticAttributes),De=I?I.getBinderAttributes():[],Ve=fe.concat(De),Xe=Vo.prelude.staticUniforms?ih(Vo.prelude.staticUniforms):[],xt=K.staticUniforms?ih(K.staticUniforms):[],wt=y.staticUniforms?ih(y.staticUniforms):[],Tt=I?I.getBinderUniforms():[],Mt=Xe.concat(xt).concat(wt).concat(Tt),Yt=[];for(const ki of Mt)Yt.indexOf(ki)<0&&Yt.push(ki);const Rt=I?I.defines():[];Jo(xe)&&Rt.unshift("#version 300 es"),j&&Rt.push("#define OVERDRAW_INSPECTOR;"),H&&Rt.push("#define TERRAIN3D;"),te&&Rt.push(te),ge&&Rt.push(...ge);let Zt=Rt.concat(Vo.prelude.fragmentSource,K.fragmentSource,y.fragmentSource).join(`
`),ei=Rt.concat(Vo.prelude.vertexSource,K.vertexSource,y.vertexSource).join(`
`);Jo(xe)||(Zt=(function(ki){return ki.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Zt),ei=(function(ki){return ki.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ei));const Ut=xe.createShader(xe.FRAGMENT_SHADER);if(xe.isContextLost())return void(this.failedToCreate=!0);if(xe.shaderSource(Ut,Zt),xe.compileShader(Ut),!xe.getShaderParameter(Ut,xe.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${xe.getShaderInfoLog(Ut)}`);xe.attachShader(this.program,Ut);const hi=xe.createShader(xe.VERTEX_SHADER);if(xe.isContextLost())return void(this.failedToCreate=!0);if(xe.shaderSource(hi,ei),xe.compileShader(hi),!xe.getShaderParameter(hi,xe.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${xe.getShaderInfoLog(hi)}`);xe.attachShader(this.program,hi),this.attributes={};const $i={};this.numAttributes=Ve.length;for(let ki=0;ki<this.numAttributes;ki++)Ve[ki]&&(xe.bindAttribLocation(this.program,ki,Ve[ki]),this.attributes[Ve[ki]]=ki);if(xe.linkProgram(this.program),!xe.getProgramParameter(this.program,xe.LINK_STATUS))throw new Error(`Program failed to link: ${xe.getProgramInfoLog(this.program)}`);xe.deleteShader(hi),xe.deleteShader(Ut);for(let ki=0;ki<Yt.length;ki++){const Di=Yt[ki];if(Di&&!$i[Di]){const Pi=xe.getUniformLocation(this.program,Di);Pi&&($i[Di]=Pi)}}this.fixedUniforms=D(u,$i),this.terrainUniforms=((ki,Di)=>({u_depth:new t.b_(ki,Di.u_depth),u_terrain:new t.b_(ki,Di.u_terrain),u_terrain_dim:new t.bq(ki,Di.u_terrain_dim),u_terrain_matrix:new t.c0(ki,Di.u_terrain_matrix),u_terrain_unpack:new t.c1(ki,Di.u_terrain_unpack),u_terrain_exaggeration:new t.bq(ki,Di.u_terrain_exaggeration)}))(u,$i),this.projectionUniforms=((ki,Di)=>({u_projection_matrix:new t.c0(ki,Di.u_projection_matrix),u_projection_tile_mercator_coords:new t.c1(ki,Di.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.c1(ki,Di.u_projection_clipping_plane),u_projection_transition:new t.bq(ki,Di.u_projection_transition),u_projection_fallback_matrix:new t.c0(ki,Di.u_projection_fallback_matrix)}))(u,$i),this.binderUniforms=I?I.getUniforms(u,$i):[]}draw(u,y,I,D,j,H,K,te,ge,xe,fe,De,Ve,Xe,xt,wt,Tt,Mt,Yt){const Rt=u.gl;if(this.failedToCreate)return;if(u.program.set(this.program),u.setDepthMode(I),u.setStencilMode(D),u.setColorMode(j),u.setCullFace(H),te){u.activeTexture.set(Rt.TEXTURE2),Rt.bindTexture(Rt.TEXTURE_2D,te.depthTexture),u.activeTexture.set(Rt.TEXTURE3),Rt.bindTexture(Rt.TEXTURE_2D,te.texture);for(const ei in this.terrainUniforms)this.terrainUniforms[ei].set(te[ei])}if(ge)for(const ei in ge)this.projectionUniforms[tl[ei]].set(ge[ei]);if(K)for(const ei in this.fixedUniforms)this.fixedUniforms[ei].set(K[ei]);wt&&wt.setUniforms(u,this.binderUniforms,Xe,{zoom:xt});let Zt=0;switch(y){case Rt.LINES:Zt=2;break;case Rt.TRIANGLES:Zt=3;break;case Rt.LINE_STRIP:Zt=1}for(const ei of Ve.get()){const Ut=ei.vaos||(ei.vaos={});(Ut[xe]||(Ut[xe]=new xl)).bind(u,this,fe,wt?wt.getPaintVertexBuffers():[],De,ei.vertexOffset,Tt,Mt,Yt),Rt.drawElements(y,ei.primitiveLength*Zt,Rt.UNSIGNED_SHORT,ei.primitiveOffset*Zt*2)}}}function Oa(V,u,y){const I=1/t.aN(y,1,u.transform.tileZoom),D=Math.pow(2,y.tileID.overscaledZ),j=y.tileSize*Math.pow(2,u.transform.tileZoom)/D,H=j*(y.tileID.canonical.x+y.tileID.wrap*D),K=j*y.tileID.canonical.y;return{u_image:0,u_texsize:y.imageAtlasTexture.size,u_scale:[I,V.fromScale,V.toScale],u_fade:V.t,u_pixel_coord_upper:[H>>16,K>>16],u_pixel_coord_lower:[65535&H,65535&K]}}const Sc=(V,u,y,I)=>{const D=V.style.light,j=D.properties.get("position"),H=[j.x,j.y,j.z],K=t.c4();D.properties.get("anchor")==="viewport"&&t.c5(K,V.transform.bearingInRadians),t.c6(H,H,K);const te=V.transform.transformLightDirection(H),ge=D.properties.get("color");return{u_lightpos:H,u_lightpos_globe:te,u_lightintensity:D.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+u,u_opacity:y,u_fill_translate:I}},Pu=(V,u,y,I,D,j,H)=>t.e(Sc(V,u,y,I),Oa(j,V,H),{u_height_factor:-Math.pow(2,D.overscaledZ)/H.tileSize/8}),da=(V,u,y,I)=>t.e(Oa(u,V,y),{u_fill_translate:I}),Rm=(V,u)=>({u_world:V,u_fill_translate:u}),cu=(V,u,y,I,D)=>t.e(da(V,u,y,D),{u_world:I}),Mu=(V,u,y,I,D)=>{const j=V.transform;let H,K,te=0;if(y.paint.get("circle-pitch-alignment")==="map"){const ge=t.aN(u,1,j.zoom);H=!0,K=[ge,ge],te=ge/(t.a5*Math.pow(2,u.tileID.overscaledZ))*2*Math.PI*D}else H=!1,K=j.pixelsToGLUnits;return{u_camera_to_center_distance:j.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+H,u_device_pixel_ratio:V.pixelRatio,u_extrude_scale:K,u_globe_extrude_scale:te,u_translate:I}},yr=V=>({u_pixel_extrude_scale:[1/V.width,1/V.height]}),zn=V=>({u_viewport_size:[V.width,V.height]}),Gf=(V,u=1)=>({u_color:V,u_overlay:0,u_overlay_scale:u}),sr=(V,u,y,I)=>{const D=t.aN(V,1,u)/(t.a5*Math.pow(2,V.tileID.overscaledZ))*2*Math.PI*I;return{u_extrude_scale:t.aN(V,1,u),u_intensity:y,u_globe_extrude_scale:D}},nf=(V,u,y,I)=>{const D=t.N();t.c7(D,0,V.width,V.height,0,0,1);const j=V.context.gl;return{u_matrix:D,u_world:[j.drawingBufferWidth,j.drawingBufferHeight],u_image:y,u_color_ramp:I,u_opacity:u.paint.get("heatmap-opacity")}},rf=(V,u,y)=>{const I=y.paint.get("hillshade-accent-color");let D;switch(y.paint.get("hillshade-method")){case"basic":D=4;break;case"combined":D=1;break;case"igor":D=2;break;case"multidirectional":D=3;break;default:D=0}const j=y.getIlluminationProperties();for(let H=0;H<j.directionRadians.length;H++)y.paint.get("hillshade-illumination-anchor")==="viewport"&&(j.directionRadians[H]+=V.transform.bearingInRadians);return{u_image:0,u_latrange:nh(0,u.tileID),u_exaggeration:y.paint.get("hillshade-exaggeration"),u_altitudes:j.altitudeRadians,u_azimuths:j.directionRadians,u_accent:I,u_method:D,u_highlights:j.highlightColor,u_shadows:j.shadowColor}},pr=(V,u)=>{const y=u.stride,I=t.N();return t.c7(I,0,t.a5,-t.a5,0,0,1),t.O(I,I,[0,-t.a5,0]),{u_matrix:I,u_image:1,u_dimension:[y,y],u_zoom:V.overscaledZ,u_unpack:u.getUnpackVector()}};function nh(V,u){const y=Math.pow(2,u.canonical.z),I=u.canonical.y;return[new t.a9(0,I/y).toLngLat().lat,new t.a9(0,(I+1)/y).toLngLat().lat]}const zm=(V,u,y=0)=>({u_image:0,u_unpack:u.getUnpackVector(),u_dimension:[u.stride,u.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:y,u_opacity:V.paint.get("color-relief-opacity")}),yd=(V,u,y,I)=>{const D=V.transform;return{u_translation:Hf(V,u,y),u_ratio:I/t.aN(u,1,D.zoom),u_device_pixel_ratio:V.pixelRatio,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}},Fl=(V,u,y,I,D)=>t.e(yd(V,u,y,I),{u_image:0,u_image_height:D}),qf=(V,u,y,I,D)=>{const j=V.transform,H=il(u,j);return{u_translation:Hf(V,u,y),u_texsize:u.imageAtlasTexture.size,u_ratio:I/t.aN(u,1,j.zoom),u_device_pixel_ratio:V.pixelRatio,u_image:0,u_scale:[H,D.fromScale,D.toScale],u_fade:D.t,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]]}},$a=(V,u,y,I,D)=>{const j=il(u,V.transform);return t.e(yd(V,u,y,I),{u_tileratio:j,u_crossfade_from:D.fromScale,u_crossfade_to:D.toScale,u_image:0,u_mix:D.t,u_lineatlas_width:V.lineAtlas.width,u_lineatlas_height:V.lineAtlas.height})},sf=(V,u,y,I,D,j)=>{const H=il(u,V.transform);return t.e(yd(V,u,y,I),{u_image:0,u_image_height:j,u_tileratio:H,u_crossfade_from:D.fromScale,u_crossfade_to:D.toScale,u_image_dash:1,u_mix:D.t,u_lineatlas_width:V.lineAtlas.width,u_lineatlas_height:V.lineAtlas.height})};function il(V,u){return 1/t.aN(V,1,u.tileZoom)}function Hf(V,u,y){return t.aO(V.transform,u,y.paint.get("line-translate"),y.paint.get("line-translate-anchor"))}const rh=(V,u,y,I,D)=>{return{u_tl_parent:V,u_scale_parent:u,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(H=I.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:(j=I.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:Ec(I.paint.get("raster-hue-rotate")),u_coords_top:[D[0].x,D[0].y,D[1].x,D[1].y],u_coords_bottom:[D[3].x,D[3].y,D[2].x,D[2].y]};var j,H};function Ec(V){V*=Math.PI/180;const u=Math.sin(V),y=Math.cos(V);return[(2*y+1)/3,(-Math.sqrt(3)*u-y+1)/3,(Math.sqrt(3)*u-y+1)/3]}const of=(V,u,y,I,D,j,H,K,te,ge,xe,fe,De)=>{const Ve=H.transform;return{u_is_size_zoom_constant:+(V==="constant"||V==="source"),u_is_size_feature_constant:+(V==="constant"||V==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ve.cameraToCenterDistance,u_pitch:Ve.pitch/360*2*Math.PI,u_rotate_symbol:+y,u_aspect_ratio:Ve.width/Ve.height,u_fade_change:H.options.fadeDuration?H.symbolFadeChange:1,u_label_plane_matrix:K,u_coord_matrix:te,u_is_text:+xe,u_pitch_with_map:+I,u_is_along_line:D,u_is_variable_anchor:j,u_texsize:fe,u_texture:0,u_translation:ge,u_pitched_scale:De}},Om=(V,u,y,I,D,j,H,K,te,ge,xe,fe,De,Ve)=>{const Xe=H.transform;return t.e(of(V,u,y,I,D,j,H,K,te,ge,xe,fe,Ve),{u_gamma_scale:I?Math.cos(Xe.pitch*Math.PI/180)*Xe.cameraToCenterDistance:1,u_device_pixel_ratio:H.pixelRatio,u_is_halo:1})},uu=(V,u,y,I,D,j,H,K,te,ge,xe,fe,De)=>t.e(Om(V,u,y,I,D,j,H,K,te,ge,!0,xe,0,De),{u_texsize_icon:fe,u_texture_icon:1}),af=(V,u)=>({u_opacity:V,u_color:u}),Fp=(V,u,y,I,D)=>t.e((function(j,H,K,te){const ge=K.imageManager.getPattern(j.from.toString()),xe=K.imageManager.getPattern(j.to.toString()),{width:fe,height:De}=K.imageManager.getPixelSize(),Ve=Math.pow(2,te.tileID.overscaledZ),Xe=te.tileSize*Math.pow(2,K.transform.tileZoom)/Ve,xt=Xe*(te.tileID.canonical.x+te.tileID.wrap*Ve),wt=Xe*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ge.tl,u_pattern_br_a:ge.br,u_pattern_tl_b:xe.tl,u_pattern_br_b:xe.br,u_texsize:[fe,De],u_mix:H.t,u_pattern_size_a:ge.displaySize,u_pattern_size_b:xe.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/t.aN(te,1,K.transform.tileZoom),u_pixel_coord_upper:[xt>>16,wt>>16],u_pixel_coord_lower:[65535&xt,65535&wt]}})(y,D,u,I),{u_opacity:V}),sh=(V,u)=>{},vd={fillExtrusion:(V,u)=>({u_lightpos:new t.c2(V,u.u_lightpos),u_lightpos_globe:new t.c2(V,u.u_lightpos_globe),u_lightintensity:new t.bq(V,u.u_lightintensity),u_lightcolor:new t.c2(V,u.u_lightcolor),u_vertical_gradient:new t.bq(V,u.u_vertical_gradient),u_opacity:new t.bq(V,u.u_opacity),u_fill_translate:new t.c3(V,u.u_fill_translate)}),fillExtrusionPattern:(V,u)=>({u_lightpos:new t.c2(V,u.u_lightpos),u_lightpos_globe:new t.c2(V,u.u_lightpos_globe),u_lightintensity:new t.bq(V,u.u_lightintensity),u_lightcolor:new t.c2(V,u.u_lightcolor),u_vertical_gradient:new t.bq(V,u.u_vertical_gradient),u_height_factor:new t.bq(V,u.u_height_factor),u_opacity:new t.bq(V,u.u_opacity),u_fill_translate:new t.c3(V,u.u_fill_translate),u_image:new t.b_(V,u.u_image),u_texsize:new t.c3(V,u.u_texsize),u_pixel_coord_upper:new t.c3(V,u.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(V,u.u_pixel_coord_lower),u_scale:new t.c2(V,u.u_scale),u_fade:new t.bq(V,u.u_fade)}),fill:(V,u)=>({u_fill_translate:new t.c3(V,u.u_fill_translate)}),fillPattern:(V,u)=>({u_image:new t.b_(V,u.u_image),u_texsize:new t.c3(V,u.u_texsize),u_pixel_coord_upper:new t.c3(V,u.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(V,u.u_pixel_coord_lower),u_scale:new t.c2(V,u.u_scale),u_fade:new t.bq(V,u.u_fade),u_fill_translate:new t.c3(V,u.u_fill_translate)}),fillOutline:(V,u)=>({u_world:new t.c3(V,u.u_world),u_fill_translate:new t.c3(V,u.u_fill_translate)}),fillOutlinePattern:(V,u)=>({u_world:new t.c3(V,u.u_world),u_image:new t.b_(V,u.u_image),u_texsize:new t.c3(V,u.u_texsize),u_pixel_coord_upper:new t.c3(V,u.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(V,u.u_pixel_coord_lower),u_scale:new t.c2(V,u.u_scale),u_fade:new t.bq(V,u.u_fade),u_fill_translate:new t.c3(V,u.u_fill_translate)}),circle:(V,u)=>({u_camera_to_center_distance:new t.bq(V,u.u_camera_to_center_distance),u_scale_with_map:new t.b_(V,u.u_scale_with_map),u_pitch_with_map:new t.b_(V,u.u_pitch_with_map),u_extrude_scale:new t.c3(V,u.u_extrude_scale),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_globe_extrude_scale:new t.bq(V,u.u_globe_extrude_scale),u_translate:new t.c3(V,u.u_translate)}),collisionBox:(V,u)=>({u_pixel_extrude_scale:new t.c3(V,u.u_pixel_extrude_scale)}),collisionCircle:(V,u)=>({u_viewport_size:new t.c3(V,u.u_viewport_size)}),debug:(V,u)=>({u_color:new t.b$(V,u.u_color),u_overlay:new t.b_(V,u.u_overlay),u_overlay_scale:new t.bq(V,u.u_overlay_scale)}),depth:sh,clippingMask:sh,heatmap:(V,u)=>({u_extrude_scale:new t.bq(V,u.u_extrude_scale),u_intensity:new t.bq(V,u.u_intensity),u_globe_extrude_scale:new t.bq(V,u.u_globe_extrude_scale)}),heatmapTexture:(V,u)=>({u_matrix:new t.c0(V,u.u_matrix),u_world:new t.c3(V,u.u_world),u_image:new t.b_(V,u.u_image),u_color_ramp:new t.b_(V,u.u_color_ramp),u_opacity:new t.bq(V,u.u_opacity)}),hillshade:(V,u)=>({u_image:new t.b_(V,u.u_image),u_latrange:new t.c3(V,u.u_latrange),u_exaggeration:new t.bq(V,u.u_exaggeration),u_altitudes:new t.c9(V,u.u_altitudes),u_azimuths:new t.c9(V,u.u_azimuths),u_accent:new t.b$(V,u.u_accent),u_method:new t.b_(V,u.u_method),u_shadows:new t.c8(V,u.u_shadows),u_highlights:new t.c8(V,u.u_highlights)}),hillshadePrepare:(V,u)=>({u_matrix:new t.c0(V,u.u_matrix),u_image:new t.b_(V,u.u_image),u_dimension:new t.c3(V,u.u_dimension),u_zoom:new t.bq(V,u.u_zoom),u_unpack:new t.c1(V,u.u_unpack)}),colorRelief:(V,u)=>({u_image:new t.b_(V,u.u_image),u_unpack:new t.c1(V,u.u_unpack),u_dimension:new t.c3(V,u.u_dimension),u_elevation_stops:new t.b_(V,u.u_elevation_stops),u_color_stops:new t.b_(V,u.u_color_stops),u_color_ramp_size:new t.b_(V,u.u_color_ramp_size),u_opacity:new t.bq(V,u.u_opacity)}),line:(V,u)=>({u_translation:new t.c3(V,u.u_translation),u_ratio:new t.bq(V,u.u_ratio),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_units_to_pixels:new t.c3(V,u.u_units_to_pixels)}),lineGradient:(V,u)=>({u_translation:new t.c3(V,u.u_translation),u_ratio:new t.bq(V,u.u_ratio),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_units_to_pixels:new t.c3(V,u.u_units_to_pixels),u_image:new t.b_(V,u.u_image),u_image_height:new t.bq(V,u.u_image_height)}),linePattern:(V,u)=>({u_translation:new t.c3(V,u.u_translation),u_texsize:new t.c3(V,u.u_texsize),u_ratio:new t.bq(V,u.u_ratio),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_image:new t.b_(V,u.u_image),u_units_to_pixels:new t.c3(V,u.u_units_to_pixels),u_scale:new t.c2(V,u.u_scale),u_fade:new t.bq(V,u.u_fade)}),lineSDF:(V,u)=>({u_translation:new t.c3(V,u.u_translation),u_ratio:new t.bq(V,u.u_ratio),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_units_to_pixels:new t.c3(V,u.u_units_to_pixels),u_image:new t.b_(V,u.u_image),u_mix:new t.bq(V,u.u_mix),u_tileratio:new t.bq(V,u.u_tileratio),u_crossfade_from:new t.bq(V,u.u_crossfade_from),u_crossfade_to:new t.bq(V,u.u_crossfade_to),u_lineatlas_width:new t.bq(V,u.u_lineatlas_width),u_lineatlas_height:new t.bq(V,u.u_lineatlas_height)}),lineGradientSDF:(V,u)=>({u_translation:new t.c3(V,u.u_translation),u_ratio:new t.bq(V,u.u_ratio),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_units_to_pixels:new t.c3(V,u.u_units_to_pixels),u_image:new t.b_(V,u.u_image),u_image_height:new t.bq(V,u.u_image_height),u_tileratio:new t.bq(V,u.u_tileratio),u_crossfade_from:new t.bq(V,u.u_crossfade_from),u_crossfade_to:new t.bq(V,u.u_crossfade_to),u_image_dash:new t.b_(V,u.u_image_dash),u_mix:new t.bq(V,u.u_mix),u_lineatlas_width:new t.bq(V,u.u_lineatlas_width),u_lineatlas_height:new t.bq(V,u.u_lineatlas_height)}),raster:(V,u)=>({u_tl_parent:new t.c3(V,u.u_tl_parent),u_scale_parent:new t.bq(V,u.u_scale_parent),u_buffer_scale:new t.bq(V,u.u_buffer_scale),u_fade_t:new t.bq(V,u.u_fade_t),u_opacity:new t.bq(V,u.u_opacity),u_image0:new t.b_(V,u.u_image0),u_image1:new t.b_(V,u.u_image1),u_brightness_low:new t.bq(V,u.u_brightness_low),u_brightness_high:new t.bq(V,u.u_brightness_high),u_saturation_factor:new t.bq(V,u.u_saturation_factor),u_contrast_factor:new t.bq(V,u.u_contrast_factor),u_spin_weights:new t.c2(V,u.u_spin_weights),u_coords_top:new t.c1(V,u.u_coords_top),u_coords_bottom:new t.c1(V,u.u_coords_bottom)}),symbolIcon:(V,u)=>({u_is_size_zoom_constant:new t.b_(V,u.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(V,u.u_is_size_feature_constant),u_size_t:new t.bq(V,u.u_size_t),u_size:new t.bq(V,u.u_size),u_camera_to_center_distance:new t.bq(V,u.u_camera_to_center_distance),u_pitch:new t.bq(V,u.u_pitch),u_rotate_symbol:new t.b_(V,u.u_rotate_symbol),u_aspect_ratio:new t.bq(V,u.u_aspect_ratio),u_fade_change:new t.bq(V,u.u_fade_change),u_label_plane_matrix:new t.c0(V,u.u_label_plane_matrix),u_coord_matrix:new t.c0(V,u.u_coord_matrix),u_is_text:new t.b_(V,u.u_is_text),u_pitch_with_map:new t.b_(V,u.u_pitch_with_map),u_is_along_line:new t.b_(V,u.u_is_along_line),u_is_variable_anchor:new t.b_(V,u.u_is_variable_anchor),u_texsize:new t.c3(V,u.u_texsize),u_texture:new t.b_(V,u.u_texture),u_translation:new t.c3(V,u.u_translation),u_pitched_scale:new t.bq(V,u.u_pitched_scale)}),symbolSDF:(V,u)=>({u_is_size_zoom_constant:new t.b_(V,u.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(V,u.u_is_size_feature_constant),u_size_t:new t.bq(V,u.u_size_t),u_size:new t.bq(V,u.u_size),u_camera_to_center_distance:new t.bq(V,u.u_camera_to_center_distance),u_pitch:new t.bq(V,u.u_pitch),u_rotate_symbol:new t.b_(V,u.u_rotate_symbol),u_aspect_ratio:new t.bq(V,u.u_aspect_ratio),u_fade_change:new t.bq(V,u.u_fade_change),u_label_plane_matrix:new t.c0(V,u.u_label_plane_matrix),u_coord_matrix:new t.c0(V,u.u_coord_matrix),u_is_text:new t.b_(V,u.u_is_text),u_pitch_with_map:new t.b_(V,u.u_pitch_with_map),u_is_along_line:new t.b_(V,u.u_is_along_line),u_is_variable_anchor:new t.b_(V,u.u_is_variable_anchor),u_texsize:new t.c3(V,u.u_texsize),u_texture:new t.b_(V,u.u_texture),u_gamma_scale:new t.bq(V,u.u_gamma_scale),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_is_halo:new t.b_(V,u.u_is_halo),u_translation:new t.c3(V,u.u_translation),u_pitched_scale:new t.bq(V,u.u_pitched_scale)}),symbolTextAndIcon:(V,u)=>({u_is_size_zoom_constant:new t.b_(V,u.u_is_size_zoom_constant),u_is_size_feature_constant:new t.b_(V,u.u_is_size_feature_constant),u_size_t:new t.bq(V,u.u_size_t),u_size:new t.bq(V,u.u_size),u_camera_to_center_distance:new t.bq(V,u.u_camera_to_center_distance),u_pitch:new t.bq(V,u.u_pitch),u_rotate_symbol:new t.b_(V,u.u_rotate_symbol),u_aspect_ratio:new t.bq(V,u.u_aspect_ratio),u_fade_change:new t.bq(V,u.u_fade_change),u_label_plane_matrix:new t.c0(V,u.u_label_plane_matrix),u_coord_matrix:new t.c0(V,u.u_coord_matrix),u_is_text:new t.b_(V,u.u_is_text),u_pitch_with_map:new t.b_(V,u.u_pitch_with_map),u_is_along_line:new t.b_(V,u.u_is_along_line),u_is_variable_anchor:new t.b_(V,u.u_is_variable_anchor),u_texsize:new t.c3(V,u.u_texsize),u_texsize_icon:new t.c3(V,u.u_texsize_icon),u_texture:new t.b_(V,u.u_texture),u_texture_icon:new t.b_(V,u.u_texture_icon),u_gamma_scale:new t.bq(V,u.u_gamma_scale),u_device_pixel_ratio:new t.bq(V,u.u_device_pixel_ratio),u_is_halo:new t.b_(V,u.u_is_halo),u_translation:new t.c3(V,u.u_translation),u_pitched_scale:new t.bq(V,u.u_pitched_scale)}),background:(V,u)=>({u_opacity:new t.bq(V,u.u_opacity),u_color:new t.b$(V,u.u_color)}),backgroundPattern:(V,u)=>({u_opacity:new t.bq(V,u.u_opacity),u_image:new t.b_(V,u.u_image),u_pattern_tl_a:new t.c3(V,u.u_pattern_tl_a),u_pattern_br_a:new t.c3(V,u.u_pattern_br_a),u_pattern_tl_b:new t.c3(V,u.u_pattern_tl_b),u_pattern_br_b:new t.c3(V,u.u_pattern_br_b),u_texsize:new t.c3(V,u.u_texsize),u_mix:new t.bq(V,u.u_mix),u_pattern_size_a:new t.c3(V,u.u_pattern_size_a),u_pattern_size_b:new t.c3(V,u.u_pattern_size_b),u_scale_a:new t.bq(V,u.u_scale_a),u_scale_b:new t.bq(V,u.u_scale_b),u_pixel_coord_upper:new t.c3(V,u.u_pixel_coord_upper),u_pixel_coord_lower:new t.c3(V,u.u_pixel_coord_lower),u_tile_units_to_pixels:new t.bq(V,u.u_tile_units_to_pixels)}),terrain:(V,u)=>({u_texture:new t.b_(V,u.u_texture),u_ele_delta:new t.bq(V,u.u_ele_delta),u_fog_matrix:new t.c0(V,u.u_fog_matrix),u_fog_color:new t.b$(V,u.u_fog_color),u_fog_ground_blend:new t.bq(V,u.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.bq(V,u.u_fog_ground_blend_opacity),u_horizon_color:new t.b$(V,u.u_horizon_color),u_horizon_fog_blend:new t.bq(V,u.u_horizon_fog_blend),u_is_globe_mode:new t.bq(V,u.u_is_globe_mode)}),terrainDepth:(V,u)=>({u_ele_delta:new t.bq(V,u.u_ele_delta)}),terrainCoords:(V,u)=>({u_texture:new t.b_(V,u.u_texture),u_terrain_coords_id:new t.bq(V,u.u_terrain_coords_id),u_ele_delta:new t.bq(V,u.u_ele_delta)}),projectionErrorMeasurement:(V,u)=>({u_input:new t.bq(V,u.u_input),u_output_expected:new t.bq(V,u.u_output_expected)}),atmosphere:(V,u)=>({u_sun_pos:new t.c2(V,u.u_sun_pos),u_atmosphere_blend:new t.bq(V,u.u_atmosphere_blend),u_globe_position:new t.c2(V,u.u_globe_position),u_globe_radius:new t.bq(V,u.u_globe_radius),u_inv_proj_matrix:new t.c0(V,u.u_inv_proj_matrix)}),sky:(V,u)=>({u_sky_color:new t.b$(V,u.u_sky_color),u_horizon_color:new t.b$(V,u.u_horizon_color),u_horizon:new t.c3(V,u.u_horizon),u_horizon_normal:new t.c3(V,u.u_horizon_normal),u_sky_horizon_blend:new t.bq(V,u.u_sky_horizon_blend),u_sky_blend:new t.bq(V,u.u_sky_blend)})};class f0{constructor(u,y,I){this.context=u;const D=u.gl;this.buffer=D.createBuffer(),this.dynamicDraw=!!I,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),D.bufferData(D.ELEMENT_ARRAY_BUFFER,y.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete y.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const y=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),y.bufferSubData(y.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class p0{constructor(u,y,I,D){this.length=y.length,this.attributes=I,this.itemSize=y.bytesPerElement,this.dynamicDraw=D,this.context=u;const j=u.gl;this.buffer=j.createBuffer(),u.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,y.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||delete y.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){if(u.length!==this.length)throw new Error(`Length of new data is ${u.length}, which doesn't match current length of ${this.length}`);const y=this.context.gl;this.bind(),y.bufferSubData(y.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,y){for(let I=0;I<this.attributes.length;I++){const D=y.attributes[this.attributes[I].name];D!==void 0&&u.enableVertexAttribArray(D)}}setVertexAttribPointers(u,y,I){for(let D=0;D<this.attributes.length;D++){const j=this.attributes[D],H=y.attributes[j.name];H!==void 0&&u.vertexAttribPointer(H,j.components,u[Fm[j.type]],!1,this.itemSize,j.offset+this.itemSize*(I||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _o{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bp extends _o{getDefault(){return t.bp.transparent}set(u){const y=this.current;(u.r!==y.r||u.g!==y.g||u.b!==y.b||u.a!==y.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Wf extends _o{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class ku extends _o{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class Bm extends _o{getDefault(){return[!0,!0,!0,!0]}set(u){const y=this.current;(u[0]!==y[0]||u[1]!==y[1]||u[2]!==y[2]||u[3]!==y[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class xd extends _o{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class bd extends _o{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class $c extends _o{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const y=this.current;(u.func!==y.func||u.ref!==y.ref||u.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class Kl extends _o{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const y=this.current;(u[0]!==y[0]||u[1]!==y[1]||u[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Gc extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;u?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=u,this.dirty=!1}}class Bg extends _o{getDefault(){return[0,1]}set(u){const y=this.current;(u[0]!==y[0]||u[1]!==y[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class wd extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;u?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=u,this.dirty=!1}}class hu extends _o{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class Zf extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;u?y.enable(y.BLEND):y.disable(y.BLEND),this.current=u,this.dirty=!1}}class lf extends _o{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const y=this.current;(u[0]!==y[0]||u[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class Bl extends _o{getDefault(){return t.bp.transparent}set(u){const y=this.current;(u.r!==y.r||u.g!==y.g||u.b!==y.b||u.a!==y.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class cf extends _o{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class Ji extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;u?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=u,this.dirty=!1}}class Td extends _o{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class Bh extends _o{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class Np extends _o{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class Vp extends _o{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class As extends _o{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const y=this.current;(u[0]!==y[0]||u[1]!==y[1]||u[2]!==y[2]||u[3]!==y[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class qc extends _o{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class Ng extends _o{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Sd extends _o{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.bindTexture(y.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Du extends _o{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Ed extends _o{getDefault(){return null}set(u){const y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Nm extends _o{getDefault(){return null}set(u){var y;if(u===this.current&&!this.dirty)return;const I=this.gl;Jo(I)?I.bindVertexArray(u):(y=I.getExtension("OES_vertex_array_object"))===null||y===void 0||y.bindVertexArrayOES(u),this.current=u,this.dirty=!1}}class Vg extends _o{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class Vm extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class jg extends _o{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class uf extends _o{constructor(u,y){super(u),this.context=u,this.parent=y}getDefault(){return null}}class hf extends uf{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Lu extends uf{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class es extends uf{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,u),this.current=u,this.dirty=!1}}const Ug="Framebuffer is not complete";class jm{constructor(u,y,I,D,j){this.context=u,this.width=y,this.height=I;const H=u.gl,K=this.framebuffer=H.createFramebuffer();if(this.colorAttachment=new hf(u,K),D)this.depthAttachment=j?new es(u,K):new Lu(u,K);else if(j)throw new Error("Stencil cannot be set without depth");if(H.checkFramebufferStatus(H.FRAMEBUFFER)!==H.FRAMEBUFFER_COMPLETE)throw new Error(Ug)}destroy(){const u=this.context.gl,y=this.colorAttachment.get();if(y&&u.deleteTexture(y),this.depthAttachment){const I=this.depthAttachment.get();I&&u.deleteRenderbuffer(I)}u.deleteFramebuffer(this.framebuffer)}}class Um{constructor(u){var y,I;if(this.gl=u,this.clearColor=new Bp(this),this.clearDepth=new Wf(this),this.clearStencil=new ku(this),this.colorMask=new Bm(this),this.depthMask=new xd(this),this.stencilMask=new bd(this),this.stencilFunc=new $c(this),this.stencilOp=new Kl(this),this.stencilTest=new Gc(this),this.depthRange=new Bg(this),this.depthTest=new wd(this),this.depthFunc=new hu(this),this.blend=new Zf(this),this.blendFunc=new lf(this),this.blendColor=new Bl(this),this.blendEquation=new cf(this),this.cullFace=new Ji(this),this.cullFaceSide=new Td(this),this.frontFace=new Bh(this),this.program=new Np(this),this.activeTexture=new Vp(this),this.viewport=new As(this),this.bindFramebuffer=new qc(this),this.bindRenderbuffer=new Ng(this),this.bindTexture=new Sd(this),this.bindVertexBuffer=new Du(this),this.bindElementBuffer=new Ed(this),this.bindVertexArray=new Nm(this),this.pixelStoreUnpack=new Vg(this),this.pixelStoreUnpackPremultiplyAlpha=new Vm(this),this.pixelStoreUnpackFlipY=new jg(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),Jo(u)){this.HALF_FLOAT=u.HALF_FLOAT;const D=u.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(y=u.RGBA16F)!==null&&y!==void 0?y:D?.RGBA16F_EXT,this.RGB16F=(I=u.RGB16F)!==null&&I!==void 0?I:D?.RGB16F_EXT,u.getExtension("EXT_color_buffer_float")}else{u.getExtension("EXT_color_buffer_half_float"),u.getExtension("OES_texture_half_float_linear");const D=u.getExtension("OES_texture_half_float");this.HALF_FLOAT=D?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,y){return new f0(this,u,y)}createVertexBuffer(u,y,I){return new p0(this,u,y,I)}createRenderbuffer(u,y,I){const D=this.gl,j=D.createRenderbuffer();return this.bindRenderbuffer.set(j),D.renderbufferStorage(D.RENDERBUFFER,u,y,I),this.bindRenderbuffer.set(null),j}createFramebuffer(u,y,I,D){return new jm(this,u,y,I,D)}clear({color:u,depth:y,stencil:I}){const D=this.gl;let j=0;u&&(j|=D.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),y!==void 0&&(j|=D.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(y),this.depthMask.set(!0)),I!==void 0&&(j|=D.STENCIL_BUFFER_BIT,this.clearStencil.set(I),this.stencilMask.set(255)),D.clear(j)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){t.bR(u.blendFunction,jo.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}createVertexArray(){var u;return Jo(this.gl)?this.gl.createVertexArray():(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.createVertexArrayOES()}deleteVertexArray(u){var y;return Jo(this.gl)?this.gl.deleteVertexArray(u):(y=this.gl.getExtension("OES_vertex_array_object"))===null||y===void 0?void 0:y.deleteVertexArrayOES(u)}unbindVAO(){this.bindVertexArray.set(null)}}let oh;function df(V,u,y,I,D){const j=V.context,H=V.transform,K=j.gl,te=V.useProgram("collisionBox"),ge=[];let xe=0,fe=0;for(let Tt=0;Tt<I.length;Tt++){const Mt=I[Tt],Yt=u.getTile(Mt).getBucket(y);if(!Yt)continue;const Rt=D?Yt.textCollisionBox:Yt.iconCollisionBox,Zt=Yt.collisionCircleArray;Zt.length>0&&(ge.push({circleArray:Zt,circleOffset:fe,coord:Mt}),xe+=Zt.length/4,fe=xe),Rt&&te.draw(j,K.LINES,ms.disabled,js.disabled,V.colorModeForRenderPass(),Cs.disabled,yr(V.transform),V.style.map.terrain&&V.style.map.terrain.getTerrainData(Mt),H.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),y.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,null,V.transform.zoom,null,null,Rt.collisionVertexBuffer)}if(!D||!ge.length)return;const De=V.useProgram("collisionCircle"),Ve=new t.ca;Ve.resize(4*xe),Ve._trim();let Xe=0;for(const Tt of ge)for(let Mt=0;Mt<Tt.circleArray.length/4;Mt++){const Yt=4*Mt,Rt=Tt.circleArray[Yt+0],Zt=Tt.circleArray[Yt+1],ei=Tt.circleArray[Yt+2],Ut=Tt.circleArray[Yt+3];Ve.emplace(Xe++,Rt,Zt,ei,Ut,0),Ve.emplace(Xe++,Rt,Zt,ei,Ut,1),Ve.emplace(Xe++,Rt,Zt,ei,Ut,2),Ve.emplace(Xe++,Rt,Zt,ei,Ut,3)}(!oh||oh.length<2*xe)&&(oh=(function(Tt){const Mt=2*Tt,Yt=new t.cc;Yt.resize(Mt),Yt._trim();for(let Rt=0;Rt<Mt;Rt++){const Zt=6*Rt;Yt.uint16[Zt+0]=4*Rt+0,Yt.uint16[Zt+1]=4*Rt+1,Yt.uint16[Zt+2]=4*Rt+2,Yt.uint16[Zt+3]=4*Rt+2,Yt.uint16[Zt+4]=4*Rt+3,Yt.uint16[Zt+5]=4*Rt+0}return Yt})(xe));const xt=j.createIndexBuffer(oh,!0),wt=j.createVertexBuffer(Ve,t.cb.members,!0);for(const Tt of ge){const Mt=zn(V.transform);De.draw(j,K.TRIANGLES,ms.disabled,js.disabled,V.colorModeForRenderPass(),Cs.disabled,Mt,V.style.map.terrain&&V.style.map.terrain.getTerrainData(Tt.coord),null,y.id,wt,xt,t.aX.simpleSegment(0,2*Tt.circleOffset,Tt.circleArray.length,Tt.circleArray.length/2),null,V.transform.zoom,null,null,null)}wt.destroy(),xt.destroy()}const no=t.ar(new Float32Array(16));function m0(V,u,y,I,D,j){const{horizontalAlign:H,verticalAlign:K}=t.aS(V);return new t.P((-(H-.5)*u/D+I[0])*j,(-(K-.5)*y/D+I[1])*j)}function Xf(V,u,y,I,D,j){const H=u.tileAnchorPoint.add(new t.P(u.translation[0],u.translation[1]));if(u.pitchWithMap){let K=I.mult(j);y||(K=K.rotate(-D));const te=H.add(K);return _t(te.x,te.y,u.pitchedLabelPlaneMatrix,u.getElevation).point}if(y){const K=jn(u.tileAnchorPoint.x+1,u.tileAnchorPoint.y,u).point.sub(V),te=Math.atan(K.y/K.x)+(K.x<0?Math.PI:0);return V.add(I.rotate(te))}return V.add(I)}function $g(V,u,y,I,D,j,H,K,te,ge,xe,fe){const De=V.text.placedSymbolArray,Ve=V.text.dynamicLayoutVertexArray,Xe=V.icon.dynamicLayoutVertexArray,xt={};Ve.clear();for(let wt=0;wt<De.length;wt++){const Tt=De.get(wt),Mt=Tt.hidden||!Tt.crossTileID||V.allowVerticalPlacement&&!Tt.placedOrientation?null:I[Tt.crossTileID];if(Mt){const Yt=new t.P(Tt.anchorX,Tt.anchorY),Rt={getElevation:fe,width:D.width,height:D.height,pitchedLabelPlaneMatrix:j,pitchWithMap:y,transform:D,tileAnchorPoint:Yt,translation:ge,unwrappedTileID:xe},Zt=y?io(Yt.x,Yt.y,Rt):jn(Yt.x,Yt.y,Rt),ei=Qt(D.cameraToCenterDistance,Zt.signedDistanceFromCamera);let Ut=t.aA(V.textSizeData,K,Tt)*ei/t.aM;y&&(Ut*=V.tilePixelRatio/H);const{width:hi,height:$i,anchor:ki,textOffset:Di,textBoxScale:Pi}=Mt,On=m0(ki,hi,$i,Di,Pi,Ut),Nn=D.getPitchedTextCorrection(Yt.x+ge[0],Yt.y+ge[1],xe),bn=Xf(Zt.point,Rt,u,On,-D.bearingInRadians,Nn),Yn=V.allowVerticalPlacement&&Tt.placedOrientation===t.az.vertical?Math.PI/2:0;for(let Zr=0;Zr<Tt.numGlyphs;Zr++)t.aG(Ve,bn,Yn);te&&Tt.associatedIconIndex>=0&&(xt[Tt.associatedIconIndex]={shiftedAnchor:bn,angle:Yn})}else Wr(Tt.numGlyphs,Ve)}if(te){Xe.clear();const wt=V.icon.placedSymbolArray;for(let Tt=0;Tt<wt.length;Tt++){const Mt=wt.get(Tt);if(Mt.hidden)Wr(Mt.numGlyphs,Xe);else{const Yt=xt[Tt];if(Yt)for(let Rt=0;Rt<Mt.numGlyphs;Rt++)t.aG(Xe,Yt.shiftedAnchor,Yt.angle);else Wr(Mt.numGlyphs,Xe)}}V.icon.dynamicLayoutVertexBuffer.updateData(Xe)}V.text.dynamicLayoutVertexBuffer.updateData(Ve)}function jp(V,u,y){return y.iconsInText&&u?"symbolTextAndIcon":V?"symbolSDF":"symbolIcon"}function ff(V,u,y,I,D,j,H,K,te,ge,xe,fe,De){const Ve=V.context,Xe=Ve.gl,xt=V.transform,wt=K==="map",Tt=te==="map",Mt=K!=="viewport"&&y.layout.get("symbol-placement")!=="point",Yt=wt&&!Tt&&!Mt,Rt=!y.layout.get("symbol-sort-key").isConstant();let Zt=!1;const ei=V.getDepthModeForSublayer(0,ms.ReadOnly),Ut=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),hi=[],$i=xt.getCircleRadiusCorrection();for(const ki of I){const Di=u.getTile(ki),Pi=Di.getBucket(y);if(!Pi)continue;const On=D?Pi.text:Pi.icon;if(!On||!On.segments.get().length||!On.hasVisibleVertices)continue;const Nn=On.programConfigurations.get(y.id),bn=D||Pi.sdfIcons,Yn=D?Pi.textSizeData:Pi.iconSizeData,Zr=Tt||xt.pitch!==0,Ps=V.useProgram(jp(bn,D,Pi),Nn),ia=t.ay(Yn,xt.zoom),Eo=V.style.map.terrain&&V.style.map.terrain.getTerrainData(ki);let fa,Nr,hr,oa,pa=[0,0],aa=null;if(D)Nr=Di.glyphAtlasTexture,hr=Xe.LINEAR,fa=Di.glyphAtlasTexture.size,Pi.iconsInText&&(pa=Di.imageAtlasTexture.size,aa=Di.imageAtlasTexture,oa=Zr||V.options.rotating||V.options.zooming||Yn.kind==="composite"||Yn.kind==="camera"?Xe.LINEAR:Xe.NEAREST);else{const Uo=y.layout.get("icon-size").constantOr(0)!==1||Pi.iconsNeedLinear;Nr=Di.imageAtlasTexture,hr=bn||V.options.rotating||V.options.zooming||Uo||Zr?Xe.LINEAR:Xe.NEAREST,fa=Di.imageAtlasTexture.size}const na=t.aN(Di,1,V.transform.zoom),ma=ft(wt,V.transform,na),fh=t.N();t.aB(fh,ma);const Vu=Ct(Tt,wt,V.transform,na),gu=t.aO(xt,Di,j,H),jl=xt.getProjectionData({overscaledTileID:ki,applyGlobeMatrix:!De,applyTerrainMatrix:!0}),bl=Ut&&Pi.hasTextData(),wl=y.layout.get("icon-text-fit")!=="none"&&bl&&Pi.hasIconData();if(Mt){const Uo=V.style.map.terrain?(Ga,qa)=>V.style.map.terrain.getElevation(ki,Ga,qa):null,Ws=y.layout.get("text-rotation-alignment")==="map";xi(Pi,V,D,ma,fh,Tt,ge,Ws,ki.toUnwrapped(),xt.width,xt.height,gu,Uo)}const Xc=D&&Ut||wl,mc=Mt||Xc?no:Tt?ma:V.transform.clipSpaceToPixelsMatrix,_u=bn&&y.paint.get(D?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Yc;Yc=bn?Pi.iconsInText?uu(Yn.kind,ia,Yt,Tt,Mt,Xc,V,mc,Vu,gu,fa,pa,$i):Om(Yn.kind,ia,Yt,Tt,Mt,Xc,V,mc,Vu,gu,D,fa,0,$i):of(Yn.kind,ia,Yt,Tt,Mt,Xc,V,mc,Vu,gu,D,fa,$i);const Ml={program:Ps,buffers:On,uniformValues:Yc,projectionData:jl,atlasTexture:Nr,atlasTextureIcon:aa,atlasInterpolation:hr,atlasInterpolationIcon:oa,isSDF:bn,hasHalo:_u};if(Rt&&Pi.canOverlap){Zt=!0;const Uo=On.segments.get();for(const Ws of Uo)hi.push({segments:new t.aX([Ws]),sortKey:Ws.sortKey,state:Ml,terrainData:Eo})}else hi.push({segments:On.segments,sortKey:0,state:Ml,terrainData:Eo})}Zt&&hi.sort(((ki,Di)=>ki.sortKey-Di.sortKey));for(const ki of hi){const Di=ki.state;if(Ve.activeTexture.set(Xe.TEXTURE0),Di.atlasTexture.bind(Di.atlasInterpolation,Xe.CLAMP_TO_EDGE),Di.atlasTextureIcon&&(Ve.activeTexture.set(Xe.TEXTURE1),Di.atlasTextureIcon&&Di.atlasTextureIcon.bind(Di.atlasInterpolationIcon,Xe.CLAMP_TO_EDGE)),Di.isSDF){const Pi=Di.uniformValues;Di.hasHalo&&(Pi.u_is_halo=1,ah(Di.buffers,ki.segments,y,V,Di.program,ei,xe,fe,Pi,Di.projectionData,ki.terrainData)),Pi.u_is_halo=0}ah(Di.buffers,ki.segments,y,V,Di.program,ei,xe,fe,Di.uniformValues,Di.projectionData,ki.terrainData)}}function ah(V,u,y,I,D,j,H,K,te,ge,xe){const fe=I.context;D.draw(fe,fe.gl.TRIANGLES,j,H,K,Cs.backCCW,te,xe,ge,y.id,V.layoutVertexBuffer,V.indexBuffer,u,y.paint,I.transform.zoom,V.programConfigurations.get(y.id),V.dynamicLayoutVertexBuffer,V.opacityVertexBuffer)}function pf(V,u,y,I,D){const j=V.context,H=j.gl,K=js.disabled,te=new jo([H.ONE,H.ONE],t.bp.transparent,[!0,!0,!0,!0]),ge=u.getBucket(y);if(!ge)return;const xe=I.key;let fe=y.heatmapFbos.get(xe);fe||(fe=lh(j,u.tileSize,u.tileSize),y.heatmapFbos.set(xe,fe)),j.bindFramebuffer.set(fe.framebuffer),j.viewport.set([0,0,u.tileSize,u.tileSize]),j.clear({color:t.bp.transparent});const De=ge.programConfigurations.get(y.id),Ve=V.useProgram("heatmap",De,!D),Xe=V.transform.getProjectionData({overscaledTileID:u.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),xt=V.style.map.terrain.getTerrainData(I);Ve.draw(j,H.TRIANGLES,ms.disabled,K,te,Cs.disabled,sr(u,V.transform.zoom,y.paint.get("heatmap-intensity"),1),xt,Xe,y.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,y.paint,V.transform.zoom,De)}function Yf(V,u,y,I,D){const j=V.context,H=j.gl,K=V.transform;j.setColorMode(V.colorModeForRenderPass());const te=Up(j,u),ge=y.key,xe=u.heatmapFbos.get(ge);if(!xe)return;j.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,xe.colorAttachment.get()),j.activeTexture.set(H.TEXTURE1),te.bind(H.LINEAR,H.CLAMP_TO_EDGE);const fe=K.getProjectionData({overscaledTileID:y,applyTerrainMatrix:D,applyGlobeMatrix:!I});V.useProgram("heatmapTexture").draw(j,H.TRIANGLES,ms.disabled,js.disabled,V.colorModeForRenderPass(),Cs.disabled,nf(V,u,0,1),null,fe,u.id,V.rasterBoundsBuffer,V.quadTriangleIndexBuffer,V.rasterBoundsSegments,u.paint,K.zoom),xe.destroy(),u.heatmapFbos.delete(ge)}function lh(V,u,y){var I,D;const j=V.gl,H=j.createTexture();j.bindTexture(j.TEXTURE_2D,H),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR);const K=(I=V.HALF_FLOAT)!==null&&I!==void 0?I:j.UNSIGNED_BYTE,te=(D=V.RGBA16F)!==null&&D!==void 0?D:j.RGBA;j.texImage2D(j.TEXTURE_2D,0,te,u,y,0,j.RGBA,K,null);const ge=V.createFramebuffer(u,y,!1,!1);return ge.colorAttachment.set(H),ge}function Up(V,u){return u.colorRampTexture||(u.colorRampTexture=new t.T(V,u.colorRamp,V.gl.RGBA)),u.colorRampTexture}function $m(V,u,y,I,D,j,H,K){let te=256;if(D.stepInterpolant){const ge=u.getSource().maxzoom,xe=H.canonical.z===ge?Math.ceil(1<<V.transform.maxZoom-H.canonical.z):1;te=t.an(t.ce(j.maxLineLength/t.a5*1024*xe),256,y.maxTextureSize)}return K.gradient=t.cf({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:te,image:K.gradient||void 0,clips:j.lineClipsArray}),K.texture?K.texture.update(K.gradient):K.texture=new t.T(y,K.gradient,I.RGBA),K.version=D.gradientVersion,K.texture}function Gg(V,u,y,I,D){V.activeTexture.set(u.TEXTURE0),y.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),I.updatePaintBuffers(D)}function ta(V,u,y,I,D,j){(D||V.lineAtlas.dirty)&&(u.activeTexture.set(y.TEXTURE0),V.lineAtlas.bind(u)),I.updatePaintBuffers(j)}function ch(V,u,y,I,D,j,H){const K=j.gradients[D.id];let te=K.texture;D.gradientVersion!==K.version&&(te=$m(V,u,y,I,D,j,H,K)),y.activeTexture.set(I.TEXTURE0),te.bind(D.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}function Jl(V,u,y,I,D,j,H,K,te){const ge=j.gradients[D.id];let xe=ge.texture;D.gradientVersion!==ge.version&&(xe=$m(V,u,y,I,D,j,H,ge)),y.activeTexture.set(I.TEXTURE0),xe.bind(D.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE),y.activeTexture.set(I.TEXTURE1),V.lineAtlas.bind(y),K.updatePaintBuffers(te)}function Kf(V,u,y,I,D){if(!y||!I||!I.imageAtlas)return;const j=I.imageAtlas.patternPositions;let H=j[y.to.toString()],K=j[y.from.toString()];if(!H&&K&&(H=K),!K&&H&&(K=H),!H||!K){const te=D.getPaintProperty(u);H=j[te],K=j[te]}H&&K&&V.setConstantPatternPositions(H,K)}function Id(V,u,y,I,D,j,H,K){const te=V.context.gl,ge="fill-pattern",xe=y.paint.get(ge),fe=xe&&xe.constantOr(1),De=y.getCrossfadeParameters();let Ve,Xe,xt,wt,Tt;const Mt=V.transform,Yt=y.paint.get("fill-translate"),Rt=y.paint.get("fill-translate-anchor");H?(Xe=fe&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ve=te.LINES):(Xe=fe?"fillPattern":"fill",Ve=te.TRIANGLES);const Zt=xe.constantOr(null);for(const ei of I){const Ut=u.getTile(ei);if(fe&&!Ut.patternsLoaded())continue;const hi=Ut.getBucket(y);if(!hi)continue;const $i=hi.programConfigurations.get(y.id),ki=V.useProgram(Xe,$i),Di=V.style.map.terrain&&V.style.map.terrain.getTerrainData(ei);fe&&(V.context.activeTexture.set(te.TEXTURE0),Ut.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),$i.updatePaintBuffers(De)),Kf($i,ge,Zt,Ut,y);const Pi=Mt.getProjectionData({overscaledTileID:ei,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),On=t.aO(Mt,Ut,Yt,Rt);if(H){wt=hi.indexBuffer2,Tt=hi.segments2;const bn=[te.drawingBufferWidth,te.drawingBufferHeight];xt=Xe==="fillOutlinePattern"&&fe?cu(V,De,Ut,bn,On):Rm(bn,On)}else wt=hi.indexBuffer,Tt=hi.segments,xt=fe?da(V,De,Ut,On):{u_fill_translate:On};const Nn=V.stencilModeForClipping(ei);ki.draw(V.context,Ve,D,Nn,j,Cs.backCCW,xt,Di,Pi,y.id,hi.layoutVertexBuffer,wt,Tt,y.paint,V.transform.zoom,$i)}}function Cd(V,u,y,I,D,j,H,K){const te=V.context,ge=te.gl,xe="fill-extrusion-pattern",fe=y.paint.get(xe),De=fe.constantOr(1),Ve=y.getCrossfadeParameters(),Xe=y.paint.get("fill-extrusion-opacity"),xt=fe.constantOr(null),wt=V.transform;for(const Tt of I){const Mt=u.getTile(Tt),Yt=Mt.getBucket(y);if(!Yt)continue;const Rt=V.style.map.terrain&&V.style.map.terrain.getTerrainData(Tt),Zt=Yt.programConfigurations.get(y.id),ei=V.useProgram(De?"fillExtrusionPattern":"fillExtrusion",Zt);De&&(V.context.activeTexture.set(ge.TEXTURE0),Mt.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Ve));const Ut=wt.getProjectionData({overscaledTileID:Tt,applyGlobeMatrix:!K,applyTerrainMatrix:!0});Kf(Zt,xe,xt,Mt,y);const hi=t.aO(wt,Mt,y.paint.get("fill-extrusion-translate"),y.paint.get("fill-extrusion-translate-anchor")),$i=y.paint.get("fill-extrusion-vertical-gradient"),ki=De?Pu(V,$i,Xe,hi,Tt,Ve,Mt):Sc(V,$i,Xe,hi);ei.draw(te,te.gl.TRIANGLES,D,j,H,Cs.backCCW,ki,Rt,Ut,y.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,y.paint,V.transform.zoom,Zt,V.style.map.terrain&&Yt.centroidVertexBuffer)}}function Nh(V,u,y,I,D,j,H,K,te){var ge;const xe=V.style.projection,fe=V.context,De=V.transform,Ve=fe.gl,Xe=[`#define NUM_ILLUMINATION_SOURCES ${y.paint.get("hillshade-highlight-color").values.length}`],xt=V.useProgram("hillshade",null,!1,Xe),wt=!V.options.moving;for(const Tt of I){const Mt=u.getTile(Tt),Yt=Mt.fbo;if(!Yt)continue;const Rt=xe.getMeshFromTileID(fe,Tt.canonical,K,!0,"raster"),Zt=(ge=V.style.map.terrain)===null||ge===void 0?void 0:ge.getTerrainData(Tt);fe.activeTexture.set(Ve.TEXTURE0),Ve.bindTexture(Ve.TEXTURE_2D,Yt.colorAttachment.get());const ei=De.getProjectionData({overscaledTileID:Tt,aligned:wt,applyGlobeMatrix:!te,applyTerrainMatrix:!0});xt.draw(fe,Ve.TRIANGLES,j,D[Tt.overscaledZ],H,Cs.backCCW,rf(V,Mt,y),Zt,ei,y.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.segments)}}function Jf(V,u,y,I,D,j,H,K,te){var ge;const xe=V.style.projection,fe=V.context,De=V.transform,Ve=fe.gl,Xe=V.useProgram("colorRelief"),xt=!V.options.moving;let wt=!0,Tt=0;for(const Mt of I){const Yt=u.getTile(Mt),Rt=Yt.dem;if(wt){const ki=Ve.getParameter(Ve.MAX_TEXTURE_SIZE),{elevationTexture:Di,colorTexture:Pi}=y.getColorRampTextures(fe,ki,Rt.getUnpackVector());fe.activeTexture.set(Ve.TEXTURE1),Di.bind(Ve.NEAREST,Ve.CLAMP_TO_EDGE),fe.activeTexture.set(Ve.TEXTURE4),Pi.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),wt=!1,Tt=Di.size[0]}if(!Rt||!Rt.data)continue;const Zt=Rt.stride,ei=Rt.getPixels();if(fe.activeTexture.set(Ve.TEXTURE0),fe.pixelStoreUnpackPremultiplyAlpha.set(!1),Yt.demTexture=Yt.demTexture||V.getTileTexture(Zt),Yt.demTexture){const ki=Yt.demTexture;ki.update(ei,{premultiply:!1}),ki.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}else Yt.demTexture=new t.T(fe,ei,Ve.RGBA,{premultiply:!1}),Yt.demTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE);const Ut=xe.getMeshFromTileID(fe,Mt.canonical,K,!0,"raster"),hi=(ge=V.style.map.terrain)===null||ge===void 0?void 0:ge.getTerrainData(Mt),$i=De.getProjectionData({overscaledTileID:Mt,aligned:xt,applyGlobeMatrix:!te,applyTerrainMatrix:!0});Xe.draw(fe,Ve.TRIANGLES,j,D[Mt.overscaledZ],H,Cs.backCCW,zm(y,Yt.dem,Tt),hi,$i,y.id,Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)}}const Ad=[new t.P(0,0),new t.P(t.a5,0),new t.P(t.a5,t.a5),new t.P(0,t.a5)];function Ru(V,u,y,I,D,j,H,K,te=!1,ge=!1){const xe=I[I.length-1].overscaledZ,fe=V.context,De=fe.gl,Ve=V.useProgram("raster"),Xe=V.transform,xt=V.style.projection,wt=V.colorModeForRenderPass(),Tt=!V.options.moving,Mt=y.paint.get("raster-opacity"),Yt=y.paint.get("raster-resampling"),Rt=y.paint.get("raster-fade-duration"),Zt=!!V.style.map.terrain;for(const ei of I){const Ut=V.getDepthModeForSublayer(ei.overscaledZ-xe,Mt===1?ms.ReadWrite:ms.ReadOnly,De.LESS),hi=u.getTile(ei),$i=Yt==="nearest"?De.NEAREST:De.LINEAR;fe.activeTexture.set(De.TEXTURE0),hi.texture.bind($i,De.CLAMP_TO_EDGE,De.LINEAR_MIPMAP_NEAREST),fe.activeTexture.set(De.TEXTURE1);const{parentTile:ki,parentScaleBy:Di,parentTopLeft:Pi,fadeValues:On}=qg(hi,u,Rt,Zt);hi.fadeOpacity=On.tileOpacity,ki?(ki.fadeOpacity=On.parentTileOpacity,ki.texture.bind($i,De.CLAMP_TO_EDGE,De.LINEAR_MIPMAP_NEAREST)):hi.texture.bind($i,De.CLAMP_TO_EDGE,De.LINEAR_MIPMAP_NEAREST),hi.texture.useMipmap&&fe.extTextureFilterAnisotropic&&V.transform.pitch>20&&De.texParameterf(De.TEXTURE_2D,fe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,fe.extTextureFilterAnisotropicMax);const Nn=V.style.map.terrain&&V.style.map.terrain.getTerrainData(ei),bn=Xe.getProjectionData({overscaledTileID:ei,aligned:Tt,applyGlobeMatrix:!ge,applyTerrainMatrix:!0}),Yn=rh(Pi,Di,On.fadeMix,y,K),Zr=xt.getMeshFromTileID(fe,ei.canonical,j,H,"raster");Ve.draw(fe,De.TRIANGLES,Ut,D?D[ei.overscaledZ]:js.disabled,wt,te?Cs.frontCCW:Cs.backCCW,Yn,Nn,bn,y.id,Zr.vertexBuffer,Zr.indexBuffer,Zr.segments)}}function qg(V,u,y,I){const D={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(y===0||I)return D;if(V.fadingParentID){const j=u.getLoadedTile(V.fadingParentID);if(!j)return D;const H=Math.pow(2,j.tileID.overscaledZ-V.tileID.overscaledZ),K=[V.tileID.canonical.x*H%1,V.tileID.canonical.y*H%1],te=(function(ge,xe,fe){const De=se(),Ve=(De-xe.timeAdded)/fe,Xe=ge.fadingDirection===Ci.Incoming,xt=t.an((De-ge.timeAdded)/fe,0,1),wt=t.an(1-Ve,0,1),Tt=Xe?xt:wt;return{tileOpacity:Tt,parentTileOpacity:Xe?wt:xt,fadeMix:{opacity:1,mix:1-Tt}}})(V,j,y);return{parentTile:j,parentScaleBy:H,parentTopLeft:K,fadeValues:te}}if(V.selfFading){const j=(function(H,K){const te=(se()-H.timeAdded)/K,ge=t.an(te,0,1);return{tileOpacity:ge,fadeMix:{opacity:ge,mix:0}}})(V,y);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:j}}return D}const oy=new t.bp(1,0,0,1),ay=new t.bp(0,1,0,1),ly=new t.bp(0,0,1,1),Gm=new t.bp(1,0,1,1),uh=new t.bp(0,1,1,1);function $p(V,u,y,I){Qf(V,0,u+y/2,V.transform.width,y,I)}function Gp(V,u,y,I){Qf(V,u-y/2,0,y,V.transform.height,I)}function Qf(V,u,y,I,D,j){const H=V.context,K=H.gl;K.enable(K.SCISSOR_TEST),K.scissor(u*V.pixelRatio,y*V.pixelRatio,I*V.pixelRatio,D*V.pixelRatio),H.clear({color:j}),K.disable(K.SCISSOR_TEST)}function qp(V,u,y){const I=V.context,D=I.gl,j=V.useProgram("debug"),H=ms.disabled,K=js.disabled,te=V.colorModeForRenderPass(),ge="$debug",xe=V.style.map.terrain&&V.style.map.terrain.getTerrainData(y);I.activeTexture.set(D.TEXTURE0);const fe=u.getTileByID(y.key).latestRawTileData,De=Math.floor((fe&&fe.byteLength||0)/1024),Ve=u.getTile(y).tileSize,Xe=512/Math.min(Ve,512)*(y.overscaledZ/V.transform.zoom)*.5;let xt=y.canonical.toString();y.overscaledZ!==y.canonical.z&&(xt+=` => ${y.overscaledZ}`),(function(Tt,Mt){Tt.initDebugOverlayCanvas();const Yt=Tt.debugOverlayCanvas,Rt=Tt.context.gl,Zt=Tt.debugOverlayCanvas.getContext("2d");Zt.clearRect(0,0,Yt.width,Yt.height),Zt.shadowColor="white",Zt.shadowBlur=2,Zt.lineWidth=1.5,Zt.strokeStyle="white",Zt.textBaseline="top",Zt.font="bold 36px Open Sans, sans-serif",Zt.fillText(Mt,5,5),Zt.strokeText(Mt,5,5),Tt.debugOverlayTexture.update(Yt),Tt.debugOverlayTexture.bind(Rt.LINEAR,Rt.CLAMP_TO_EDGE)})(V,`${xt} ${De}kB`);const wt=V.transform.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!0,applyTerrainMatrix:!0});j.draw(I,D.TRIANGLES,H,K,jo.alphaBlended,Cs.disabled,Gf(t.bp.transparent,Xe),null,wt,ge,V.debugBuffer,V.quadTriangleIndexBuffer,V.debugSegments),j.draw(I,D.LINE_STRIP,H,K,te,Cs.disabled,Gf(t.bp.red),xe,wt,ge,V.debugBuffer,V.tileBorderIndexBuffer,V.debugSegments)}function ep(V,u,y,I){const{isRenderingGlobe:D}=I,j=V.context,H=j.gl,K=V.transform,te=V.colorModeForRenderPass(),ge=V.getDepthModeFor3D(),xe=V.useProgram("terrain");j.bindFramebuffer.set(null),j.viewport.set([0,0,V.width,V.height]);for(const fe of y){const De=u.getTerrainMesh(fe.tileID),Ve=V.renderToTexture.getTexture(fe),Xe=u.getTerrainData(fe.tileID);j.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Ve.texture);const xt=u.getMeshFrameDelta(K.zoom),wt=K.calculateFogMatrix(fe.tileID.toUnwrapped()),Tt=Fh(xt,wt,V.style.sky,K.pitch,D),Mt=K.getProjectionData({overscaledTileID:fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});xe.draw(j,H.TRIANGLES,ge,js.disabled,te,Cs.backCCW,Tt,Xe,Mt,"terrain",De.vertexBuffer,De.indexBuffer,De.segments)}}function Pd(V,u){if(!u.mesh){const y=new t.aW;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(1,1),y.emplaceBack(-1,1);const I=new t.aY;I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),u.mesh=new Zo(V.createVertexBuffer(y,ou.members),V.createIndexBuffer(I),t.aX.simpleSegment(0,0,y.length,I.length))}return u.mesh}class tp{constructor(u,y){this.context=new Um(u),this.transform=y,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=we.maxOverzooming+we.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new cl}resize(u,y,I){if(this.width=Math.floor(u*I),this.height=Math.floor(y*I),this.pixelRatio=I,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const D of this.style._order)this.style._layers[D].resize()}setup(){const u=this.context,y=new t.aW;y.emplaceBack(0,0),y.emplaceBack(t.a5,0),y.emplaceBack(0,t.a5),y.emplaceBack(t.a5,t.a5),this.tileExtentBuffer=u.createVertexBuffer(y,ou.members),this.tileExtentSegments=t.aX.simpleSegment(0,0,4,2);const I=new t.aW;I.emplaceBack(0,0),I.emplaceBack(t.a5,0),I.emplaceBack(0,t.a5),I.emplaceBack(t.a5,t.a5),this.debugBuffer=u.createVertexBuffer(I,ou.members),this.debugSegments=t.aX.simpleSegment(0,0,4,5);const D=new t.ch;D.emplaceBack(0,0,0,0),D.emplaceBack(t.a5,0,t.a5,0),D.emplaceBack(0,t.a5,0,t.a5),D.emplaceBack(t.a5,t.a5,t.a5,t.a5),this.rasterBoundsBuffer=u.createVertexBuffer(D,Lm.members),this.rasterBoundsSegments=t.aX.simpleSegment(0,0,4,2);const j=new t.aW;j.emplaceBack(0,0),j.emplaceBack(t.a5,0),j.emplaceBack(0,t.a5),j.emplaceBack(t.a5,t.a5),this.rasterBoundsBufferPosOnly=u.createVertexBuffer(j,ou.members),this.rasterBoundsSegmentsPosOnly=t.aX.simpleSegment(0,0,4,5);const H=new t.aW;H.emplaceBack(0,0),H.emplaceBack(1,0),H.emplaceBack(0,1),H.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(H,ou.members),this.viewportSegments=t.aX.simpleSegment(0,0,4,2);const K=new t.ci;K.emplaceBack(0),K.emplaceBack(1),K.emplaceBack(3),K.emplaceBack(2),K.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(K);const te=new t.aY;te.emplaceBack(1,0,2),te.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(te);const ge=this.context.gl;this.stencilClearMode=new js({func:ge.ALWAYS,mask:0},0,255,ge.ZERO,ge.ZERO,ge.ZERO),this.tileExtentMesh=new Zo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const u=this.context,y=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const I=t.N();t.c7(I,0,this.width,this.height,0,0,1),t.Q(I,I,[y.drawingBufferWidth,y.drawingBufferHeight,0]);const D={mainMatrix:I,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I};this.useProgram("clippingMask",null,!0).draw(u,y.TRIANGLES,ms.disabled,this.stencilClearMode,jo.disabled,Cs.disabled,null,null,D,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(u,y,I){if(this.currentStencilSource===u.source||!u.isTileClipped()||!y||!y.length)return;this.currentStencilSource=u.source,this.nextStencilID+y.length>256&&this.clearStencil();const D=this.context;D.setColorMode(jo.disabled),D.setDepthMode(ms.disabled);const j={};for(const H of y)j[H.key]=this.nextStencilID++;this._renderTileMasks(j,y,I,!0),this._renderTileMasks(j,y,I,!1),this._tileClippingMaskIDs=j}_renderTileMasks(u,y,I,D){const j=this.context,H=j.gl,K=this.style.projection,te=this.transform,ge=this.useProgram("clippingMask");for(const xe of y){const fe=u[xe.key],De=this.style.map.terrain&&this.style.map.terrain.getTerrainData(xe),Ve=K.getMeshFromTileID(this.context,xe.canonical,D,!0,"stencil"),Xe=te.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!I,applyTerrainMatrix:!0});ge.draw(j,H.TRIANGLES,ms.disabled,new js({func:H.ALWAYS,mask:0},fe,255,H.KEEP,H.KEEP,H.REPLACE),jo.disabled,I?Cs.disabled:Cs.backCCW,null,De,Xe,"$clipping",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}_renderTilesDepthBuffer(){const u=this.context,y=u.gl,I=this.style.projection,D=this.transform,j=this.useProgram("depth"),H=this.getDepthModeFor3D(),K=Ao(D,{tileSize:D.tileSize});for(const te of K){const ge=this.style.map.terrain&&this.style.map.terrain.getTerrainData(te),xe=I.getMeshFromTileID(this.context,te.canonical,!0,!0,"raster"),fe=D.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!0,applyTerrainMatrix:!0});j.draw(u,y.TRIANGLES,H,js.disabled,jo.disabled,Cs.backCCW,null,ge,fe,"$clipping",xe.vertexBuffer,xe.indexBuffer,xe.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,y=this.context.gl;return new js({func:y.NOTEQUAL,mask:255},u,255,y.KEEP,y.KEEP,y.REPLACE)}stencilModeForClipping(u){const y=this.context.gl;return new js({func:y.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,y.KEEP,y.KEEP,y.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(u){const y=this.context.gl,I=u.sort(((H,K)=>K.overscaledZ-H.overscaledZ)),D=I[I.length-1].overscaledZ,j=I[0].overscaledZ-D+1;if(j>1){this.currentStencilSource=void 0,this.nextStencilID+j>256&&this.clearStencil();const H={};for(let K=0;K<j;K++)H[K+D]=new js({func:y.GEQUAL,mask:255},K+this.nextStencilID,255,y.KEEP,y.KEEP,y.REPLACE);return this.nextStencilID+=j,[H,I]}return[{[D]:js.disabled},I]}stencilConfigForOverlapTwoPass(u){const y=this.context.gl,I=u.sort(((H,K)=>K.overscaledZ-H.overscaledZ)),D=I[I.length-1].overscaledZ,j=I[0].overscaledZ-D+1;if(this.clearStencil(),j>1){const H={},K={};for(let te=0;te<j;te++)H[te+D]=new js({func:y.GREATER,mask:255},j+1+te,255,y.KEEP,y.KEEP,y.REPLACE),K[te+D]=new js({func:y.GREATER,mask:255},1+te,255,y.KEEP,y.KEEP,y.REPLACE);return this.nextStencilID=2*j+1,[H,K,I]}return this.nextStencilID=3,[{[D]:new js({func:y.GREATER,mask:255},2,255,y.KEEP,y.KEEP,y.REPLACE)},{[D]:new js({func:y.GREATER,mask:255},1,255,y.KEEP,y.KEEP,y.REPLACE)},I]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new jo([u.CONSTANT_COLOR,u.ONE],new t.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jo.unblended:jo.alphaBlended}getDepthModeForSublayer(u,y,I){if(!this.opaquePassEnabledForLayer())return ms.disabled;const D=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new ms(I||this.context.gl.LEQUAL,y,[D,D])}getDepthModeFor3D(){return new ms(this.context.gl.LEQUAL,ms.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,y){var I,D;this.style=u,this.options=y,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(se()),this.imageManager.beginFrame();const j=this.style._order,H=this.style.tileManagers,K={},te={},ge={},xe={isRenderingToTexture:!1,isRenderingGlobe:((I=u.projection)===null||I===void 0?void 0:I.transitionState)>0};for(const De in H){const Ve=H[De];Ve.used&&Ve.prepare(this.context),K[De]=Ve.getVisibleCoordinates(!1),te[De]=K[De].slice().reverse(),ge[De]=Ve.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let De=0;De<j.length;De++)if(this.style._layers[j[De]].is3D()){this.opaquePassCutoff=De;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const De of j){const Ve=this.style._layers[De];if(!Ve.hasOffscreenPass()||Ve.isHidden(this.transform.zoom))continue;const Xe=te[Ve.source];(Ve.type==="custom"||Xe.length)&&this.renderLayer(this,H[Ve.source],Ve,Xe,xe)}if((D=this.style.projection)===null||D===void 0||D.updateGPUdependent({context:this.context,useProgram:De=>this.useProgram(De)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:y.showOverdrawInspector?t.bp.black:t.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(De,Ve){const Xe=De.context,xt=Xe.gl,wt=((ei,Ut,hi)=>{const $i=Math.cos(Ut.rollInRadians),ki=Math.sin(Ut.rollInRadians),Di=xo(Ut),Pi=Ut.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ei.properties.get("sky-color"),u_horizon_color:ei.properties.get("horizon-color"),u_horizon:[(Ut.width/2-Di*ki)*hi,(Ut.height/2+Di*$i)*hi],u_horizon_normal:[-ki,$i],u_sky_horizon_blend:ei.properties.get("sky-horizon-blend")*Ut.height/2*hi,u_sky_blend:Pi}})(Ve,De.style.map.transform,De.pixelRatio),Tt=new ms(xt.LEQUAL,ms.ReadWrite,[0,1]),Mt=js.disabled,Yt=De.colorModeForRenderPass(),Rt=De.useProgram("sky"),Zt=Pd(Xe,Ve);Rt.draw(Xe,xt.TRIANGLES,Tt,Mt,Yt,Cs.disabled,wt,null,void 0,"sky",Zt.vertexBuffer,Zt.indexBuffer,Zt.segments)})(this,this.style.sky),this._showOverdrawInspector=y.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const De=this.style._layers[j[this.currentLayer]],Ve=H[De.source],Xe=K[De.source];this._renderTileClippingMasks(De,Xe,!1),this.renderLayer(this,Ve,De,Xe,xe)}this.renderPass="translucent";let fe=!1;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const De=this.style._layers[j[this.currentLayer]],Ve=H[De.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(De,xe))continue;this.opaquePassEnabledForLayer()||fe||(fe=!0,xe.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Xe=(De.type==="symbol"?ge:te)[De.source];this._renderTileClippingMasks(De,K[De.source],!!this.renderToTexture),this.renderLayer(this,Ve,De,Xe,xe)}if(xe.isRenderingGlobe&&(function(De,Ve,Xe){const xt=De.context,wt=xt.gl,Tt=De.useProgram("atmosphere"),Mt=new ms(wt.LEQUAL,ms.ReadOnly,[0,1]),Yt=De.transform,Rt=(function(Pi,On){const Nn=Pi.properties.get("position"),bn=[-Nn.x,-Nn.y,-Nn.z],Yn=t.ar(new Float64Array(16));return Pi.properties.get("anchor")==="map"&&(t.bg(Yn,Yn,On.rollInRadians),t.bh(Yn,Yn,-On.pitchInRadians),t.bg(Yn,Yn,On.bearingInRadians),t.bh(Yn,Yn,On.center.lat*Math.PI/180),t.bJ(Yn,Yn,-On.center.lng*Math.PI/180)),t.cg(bn,bn,Yn),bn})(Xe,De.transform),Zt=Yt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ei=Ve.properties.get("atmosphere-blend")*Zt.projectionTransition;if(ei===0)return;const Ut=Al(Yt.worldSize,Yt.center.lat),hi=Yt.inverseProjectionMatrix,$i=new Float64Array(4);$i[3]=1,t.aH($i,$i,Yt.modelViewProjectionMatrix),$i[0]/=$i[3],$i[1]/=$i[3],$i[2]/=$i[3],$i[3]=1,t.aH($i,$i,hi),$i[0]/=$i[3],$i[1]/=$i[3],$i[2]/=$i[3],$i[3]=1;const ki=((Pi,On,Nn,bn,Yn)=>({u_sun_pos:Pi,u_atmosphere_blend:On,u_globe_position:Nn,u_globe_radius:bn,u_inv_proj_matrix:Yn}))(Rt,ei,[$i[0],$i[1],$i[2]],Ut,hi),Di=Pd(xt,Ve);Tt.draw(xt,wt.TRIANGLES,Mt,js.disabled,jo.alphaBlended,Cs.disabled,ki,null,null,"atmosphere",Di.vertexBuffer,Di.indexBuffer,Di.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const De=(function(Ve,Xe){let xt=null;const wt=Object.values(Ve._layers).flatMap((Rt=>Rt.source&&!Rt.isHidden(Xe)?[Ve.tileManagers[Rt.source]]:[])),Tt=wt.filter((Rt=>Rt.getSource().type==="vector")),Mt=wt.filter((Rt=>Rt.getSource().type!=="vector")),Yt=Rt=>{(!xt||xt.getSource().maxzoom<Rt.getSource().maxzoom)&&(xt=Rt)};return Tt.forEach((Rt=>Yt(Rt))),xt||Mt.forEach((Rt=>Yt(Rt))),xt})(this.style,this.transform.zoom);De&&(function(Ve,Xe,xt){for(let wt=0;wt<xt.length;wt++)qp(Ve,Xe,xt[wt])})(this,De,De.getVisibleCoordinates())}this.options.showPadding&&(function(De){const Ve=De.transform.padding;$p(De,De.transform.height-(Ve.top||0),3,oy),$p(De,Ve.bottom||0,3,ay),Gp(De,Ve.left||0,3,ly),Gp(De,De.transform.width-(Ve.right||0),3,Gm);const Xe=De.transform.centerPoint;(function(xt,wt,Tt,Mt){Qf(xt,wt-1,Tt-10,2,20,Mt),Qf(xt,wt-10,Tt-1,20,2,Mt)})(De,Xe.x,De.transform.height-Xe.y,uh)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(u){if(!this.style||!this.style.map||!this.style.map.terrain)return;const y=this.terrainFacilitator.matrix,I=this.transform.modelViewProjectionMatrix;let D=this.terrainFacilitator.dirty;D||(D=u?!t.cj(y,I):!t.ck(y,I)),D||(D=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),D&&(t.cl(y,I),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(j,H){const K=j.context,te=K.gl,ge=j.transform,xe=jo.unblended,fe=new ms(te.LEQUAL,ms.ReadWrite,[0,1]),De=H.tileManager.getRenderableTiles(),Ve=j.useProgram("terrainDepth");K.bindFramebuffer.set(H.getFramebuffer("depth").framebuffer),K.viewport.set([0,0,j.width/devicePixelRatio,j.height/devicePixelRatio]),K.clear({color:t.bp.transparent,depth:1});for(const Xe of De){const xt=H.getTerrainMesh(Xe.tileID),wt=H.getTerrainData(Xe.tileID),Tt=ge.getProjectionData({overscaledTileID:Xe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Mt={u_ele_delta:H.getMeshFrameDelta(ge.zoom)};Ve.draw(K,te.TRIANGLES,fe,js.disabled,xe,Cs.backCCW,Mt,wt,Tt,"terrain",xt.vertexBuffer,xt.indexBuffer,xt.segments)}K.bindFramebuffer.set(null),K.viewport.set([0,0,j.width,j.height])})(this,this.style.map.terrain),(function(j,H){const K=j.context,te=K.gl,ge=j.transform,xe=jo.unblended,fe=new ms(te.LEQUAL,ms.ReadWrite,[0,1]),De=H.getCoordsTexture(),Ve=H.tileManager.getRenderableTiles(),Xe=j.useProgram("terrainCoords");K.bindFramebuffer.set(H.getFramebuffer("coords").framebuffer),K.viewport.set([0,0,j.width/devicePixelRatio,j.height/devicePixelRatio]),K.clear({color:t.bp.transparent,depth:1}),H.coordsIndex=[];for(const xt of Ve){const wt=H.getTerrainMesh(xt.tileID),Tt=H.getTerrainData(xt.tileID);K.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,De.texture);const Mt={u_terrain_coords_id:(255-H.coordsIndex.length)/255,u_texture:0,u_ele_delta:H.getMeshFrameDelta(ge.zoom)},Yt=ge.getProjectionData({overscaledTileID:xt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Xe.draw(K,te.TRIANGLES,fe,js.disabled,xe,Cs.backCCW,Mt,Tt,Yt,"terrain",wt.vertexBuffer,wt.indexBuffer,wt.segments),H.coordsIndex.push(xt.tileID.key)}K.bindFramebuffer.set(null),K.viewport.set([0,0,j.width,j.height])})(this,this.style.map.terrain))}renderLayer(u,y,I,D,j){I.isHidden(this.transform.zoom)||(I.type==="background"||I.type==="custom"||(D||[]).length)&&(this.id=I.id,t.cm(I)?(function(H,K,te,ge,xe,fe){if(H.renderPass!=="translucent")return;const{isRenderingToTexture:De}=fe,Ve=js.disabled,Xe=H.colorModeForRenderPass();(te._unevaluatedLayout.hasValue("text-variable-anchor")||te._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(xt,wt,Tt,Mt,Yt,Rt,Zt,ei,Ut){const hi=wt.transform,$i=wt.style.map.terrain,ki=Yt==="map",Di=Rt==="map";for(const Pi of xt){const On=Mt.getTile(Pi),Nn=On.getBucket(Tt);if(!Nn||!Nn.text||!Nn.text.segments.get().length)continue;const bn=t.ay(Nn.textSizeData,hi.zoom),Yn=t.aN(On,1,wt.transform.zoom),Zr=ft(ki,wt.transform,Yn),Ps=Tt.layout.get("icon-text-fit")!=="none"&&Nn.hasIconData();if(bn){const ia=Math.pow(2,hi.zoom-On.tileID.overscaledZ),Eo=$i?(fa,Nr)=>$i.getElevation(Pi,fa,Nr):null;$g(Nn,ki,Di,Ut,hi,Zr,ia,bn,Ps,t.aO(hi,On,Zt,ei),Pi.toUnwrapped(),Eo)}}})(ge,H,te,K,te.layout.get("text-rotation-alignment"),te.layout.get("text-pitch-alignment"),te.paint.get("text-translate"),te.paint.get("text-translate-anchor"),xe),te.paint.get("icon-opacity").constantOr(1)!==0&&ff(H,K,te,ge,!1,te.paint.get("icon-translate"),te.paint.get("icon-translate-anchor"),te.layout.get("icon-rotation-alignment"),te.layout.get("icon-pitch-alignment"),te.layout.get("icon-keep-upright"),Ve,Xe,De),te.paint.get("text-opacity").constantOr(1)!==0&&ff(H,K,te,ge,!0,te.paint.get("text-translate"),te.paint.get("text-translate-anchor"),te.layout.get("text-rotation-alignment"),te.layout.get("text-pitch-alignment"),te.layout.get("text-keep-upright"),Ve,Xe,De),K.map.showCollisionBoxes&&(df(H,K,te,ge,!0),df(H,K,te,ge,!1))})(u,y,I,D,this.style.placement.variableOffsets,j):t.cn(I)?(function(H,K,te,ge,xe){if(H.renderPass!=="translucent")return;const{isRenderingToTexture:fe}=xe,De=te.paint.get("circle-opacity"),Ve=te.paint.get("circle-stroke-width"),Xe=te.paint.get("circle-stroke-opacity"),xt=!te.layout.get("circle-sort-key").isConstant();if(De.constantOr(1)===0&&(Ve.constantOr(1)===0||Xe.constantOr(1)===0))return;const wt=H.context,Tt=wt.gl,Mt=H.transform,Yt=H.getDepthModeForSublayer(0,ms.ReadOnly),Rt=js.disabled,Zt=H.colorModeForRenderPass(),ei=[],Ut=Mt.getCircleRadiusCorrection();for(let hi=0;hi<ge.length;hi++){const $i=ge[hi],ki=K.getTile($i),Di=ki.getBucket(te);if(!Di)continue;const Pi=te.paint.get("circle-translate"),On=te.paint.get("circle-translate-anchor"),Nn=t.aO(Mt,ki,Pi,On),bn=Di.programConfigurations.get(te.id),Yn=H.useProgram("circle",bn),Zr=Di.layoutVertexBuffer,Ps=Di.indexBuffer,ia=H.style.map.terrain&&H.style.map.terrain.getTerrainData($i),Eo={programConfiguration:bn,program:Yn,layoutVertexBuffer:Zr,indexBuffer:Ps,uniformValues:Mu(H,ki,te,Nn,Ut),terrainData:ia,projectionData:Mt.getProjectionData({overscaledTileID:$i,applyGlobeMatrix:!fe,applyTerrainMatrix:!0})};if(xt){const fa=Di.segments.get();for(const Nr of fa)ei.push({segments:new t.aX([Nr]),sortKey:Nr.sortKey,state:Eo})}else ei.push({segments:Di.segments,sortKey:0,state:Eo})}xt&&ei.sort(((hi,$i)=>hi.sortKey-$i.sortKey));for(const hi of ei){const{programConfiguration:$i,program:ki,layoutVertexBuffer:Di,indexBuffer:Pi,uniformValues:On,terrainData:Nn,projectionData:bn}=hi.state;ki.draw(wt,Tt.TRIANGLES,Yt,Rt,Zt,Cs.backCCW,On,Nn,bn,te.id,Di,Pi,hi.segments,te.paint,H.transform.zoom,$i)}})(u,y,I,D,j):t.co(I)?(function(H,K,te,ge,xe){if(te.paint.get("heatmap-opacity")===0)return;const fe=H.context,{isRenderingToTexture:De,isRenderingGlobe:Ve}=xe;if(H.style.map.terrain){for(const Xe of ge){const xt=K.getTile(Xe);K.hasRenderableParent(Xe)||(H.renderPass==="offscreen"?pf(H,xt,te,Xe,Ve):H.renderPass==="translucent"&&Yf(H,te,Xe,De,Ve))}fe.viewport.set([0,0,H.width,H.height])}else H.renderPass==="offscreen"?(function(Xe,xt,wt,Tt){const Mt=Xe.context,Yt=Mt.gl,Rt=Xe.transform,Zt=js.disabled,ei=new jo([Yt.ONE,Yt.ONE],t.bp.transparent,[!0,!0,!0,!0]);(function(Ut,hi,$i){const ki=Ut.gl;Ut.activeTexture.set(ki.TEXTURE1),Ut.viewport.set([0,0,hi.width/4,hi.height/4]);let Di=$i.heatmapFbos.get(t.cd);Di?(ki.bindTexture(ki.TEXTURE_2D,Di.colorAttachment.get()),Ut.bindFramebuffer.set(Di.framebuffer)):(Di=lh(Ut,hi.width/4,hi.height/4),$i.heatmapFbos.set(t.cd,Di))})(Mt,Xe,wt),Mt.clear({color:t.bp.transparent});for(let Ut=0;Ut<Tt.length;Ut++){const hi=Tt[Ut];if(xt.hasRenderableParent(hi))continue;const $i=xt.getTile(hi),ki=$i.getBucket(wt);if(!ki)continue;const Di=ki.programConfigurations.get(wt.id),Pi=Xe.useProgram("heatmap",Di),On=Rt.getProjectionData({overscaledTileID:hi,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Nn=Rt.getCircleRadiusCorrection();Pi.draw(Mt,Yt.TRIANGLES,ms.disabled,Zt,ei,Cs.backCCW,sr($i,Rt.zoom,wt.paint.get("heatmap-intensity"),Nn),null,On,wt.id,ki.layoutVertexBuffer,ki.indexBuffer,ki.segments,wt.paint,Rt.zoom,Di)}Mt.viewport.set([0,0,Xe.width,Xe.height])})(H,K,te,ge):H.renderPass==="translucent"&&(function(Xe,xt){const wt=Xe.context,Tt=wt.gl;wt.setColorMode(Xe.colorModeForRenderPass());const Mt=xt.heatmapFbos.get(t.cd);Mt&&(wt.activeTexture.set(Tt.TEXTURE0),Tt.bindTexture(Tt.TEXTURE_2D,Mt.colorAttachment.get()),wt.activeTexture.set(Tt.TEXTURE1),Up(wt,xt).bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),Xe.useProgram("heatmapTexture").draw(wt,Tt.TRIANGLES,ms.disabled,js.disabled,Xe.colorModeForRenderPass(),Cs.disabled,nf(Xe,xt,0,1),null,null,xt.id,Xe.viewportBuffer,Xe.quadTriangleIndexBuffer,Xe.viewportSegments,xt.paint,Xe.transform.zoom))})(H,te)})(u,y,I,D,j):t.cp(I)?(function(H,K,te,ge,xe){if(H.renderPass!=="translucent")return;const{isRenderingToTexture:fe}=xe,De=te.paint.get("line-opacity"),Ve=te.paint.get("line-width");if(De.constantOr(1)===0||Ve.constantOr(1)===0)return;const Xe=H.getDepthModeForSublayer(0,ms.ReadOnly),xt=H.colorModeForRenderPass(),wt=te.paint.get("line-dasharray"),Tt=wt.constantOr(1),Mt=te.paint.get("line-pattern"),Yt=Mt.constantOr(1),Rt=te.paint.get("line-gradient"),Zt=te.getCrossfadeParameters();let ei;ei=Yt?"linePattern":Tt&&Rt?"lineGradientSDF":Tt?"lineSDF":Rt?"lineGradient":"line";const Ut=H.context,hi=Ut.gl,$i=H.transform;let ki=!0;for(const Di of ge){const Pi=K.getTile(Di);if(Yt&&!Pi.patternsLoaded())continue;const On=Pi.getBucket(te);if(!On)continue;const Nn=On.programConfigurations.get(te.id),bn=H.context.program.get(),Yn=H.useProgram(ei,Nn),Zr=ki||Yn.program!==bn,Ps=H.style.map.terrain&&H.style.map.terrain.getTerrainData(Di),ia=Mt.constantOr(null),Eo=wt&&wt.constantOr(null);if(ia&&Pi.imageAtlas){const pa=Pi.imageAtlas,aa=pa.patternPositions[ia.to.toString()],na=pa.patternPositions[ia.from.toString()];aa&&na&&Nn.setConstantPatternPositions(aa,na)}else if(Eo){const pa=te.layout.get("line-cap")==="round",aa=H.lineAtlas.getDash(Eo.to,pa),na=H.lineAtlas.getDash(Eo.from,pa);Nn.setConstantDashPositions(aa,na)}const fa=$i.getProjectionData({overscaledTileID:Di,applyGlobeMatrix:!fe,applyTerrainMatrix:!0}),Nr=$i.getPixelScale();let hr;Yt?(hr=qf(H,Pi,te,Nr,Zt),Gg(Ut,hi,Pi,Nn,Zt)):Tt&&Rt?(hr=sf(H,Pi,te,Nr,Zt,On.lineClipsArray.length),Jl(H,K,Ut,hi,te,On,Di,Nn,Zt)):Tt?(hr=$a(H,Pi,te,Nr,Zt),ta(H,Ut,hi,Nn,Zr,Zt)):Rt?(hr=Fl(H,Pi,te,Nr,On.lineClipsArray.length),ch(H,K,Ut,hi,te,On,Di)):hr=yd(H,Pi,te,Nr);const oa=H.stencilModeForClipping(Di);Yn.draw(Ut,hi.TRIANGLES,Xe,oa,xt,Cs.disabled,hr,Ps,fa,te.id,On.layoutVertexBuffer,On.indexBuffer,On.segments,te.paint,H.transform.zoom,Nn,On.layoutVertexBuffer2),ki=!1}})(u,y,I,D,j):t.cq(I)?(function(H,K,te,ge,xe){const fe=te.paint.get("fill-color"),De=te.paint.get("fill-opacity");if(De.constantOr(1)===0)return;const{isRenderingToTexture:Ve}=xe,Xe=H.colorModeForRenderPass(),xt=te.paint.get("fill-pattern"),wt=H.opaquePassEnabledForLayer()&&!xt.constantOr(1)&&fe.constantOr(t.bp.transparent).a===1&&De.constantOr(0)===1?"opaque":"translucent";if(H.renderPass===wt){const Tt=H.getDepthModeForSublayer(1,H.renderPass==="opaque"?ms.ReadWrite:ms.ReadOnly);Id(H,K,te,ge,Tt,Xe,!1,Ve)}if(H.renderPass==="translucent"&&te.paint.get("fill-antialias")){const Tt=H.getDepthModeForSublayer(te.getPaintProperty("fill-outline-color")?2:0,ms.ReadOnly);Id(H,K,te,ge,Tt,Xe,!0,Ve)}})(u,y,I,D,j):t.cr(I)?(function(H,K,te,ge,xe){const fe=te.paint.get("fill-extrusion-opacity");if(fe===0)return;const{isRenderingToTexture:De}=xe;if(H.renderPass==="translucent"){const Ve=new ms(H.context.gl.LEQUAL,ms.ReadWrite,H.depthRangeFor3D);if(fe!==1||te.paint.get("fill-extrusion-pattern").constantOr(1))Cd(H,K,te,ge,Ve,js.disabled,jo.disabled,De),Cd(H,K,te,ge,Ve,H.stencilModeFor3D(),H.colorModeForRenderPass(),De);else{const Xe=H.colorModeForRenderPass();Cd(H,K,te,ge,Ve,js.disabled,Xe,De)}}})(u,y,I,D,j):t.cs(I)?(function(H,K,te,ge,xe){if(H.renderPass!=="offscreen"&&H.renderPass!=="translucent")return;const{isRenderingToTexture:fe}=xe,De=H.context,Ve=H.style.projection.useSubdivision,Xe=H.getDepthModeForSublayer(0,ms.ReadOnly),xt=H.colorModeForRenderPass();if(H.renderPass==="offscreen")(function(wt,Tt,Mt,Yt,Rt,Zt,ei){const Ut=wt.context,hi=Ut.gl;for(const $i of Mt){const ki=Tt.getTile($i),Di=ki.dem;if(!Di||!Di.data||!ki.needsHillshadePrepare)continue;const Pi=Di.dim,On=Di.stride,Nn=Di.getPixels();if(Ut.activeTexture.set(hi.TEXTURE1),Ut.pixelStoreUnpackPremultiplyAlpha.set(!1),ki.demTexture=ki.demTexture||wt.getTileTexture(On),ki.demTexture){const Yn=ki.demTexture;Yn.update(Nn,{premultiply:!1}),Yn.bind(hi.NEAREST,hi.CLAMP_TO_EDGE)}else ki.demTexture=new t.T(Ut,Nn,hi.RGBA,{premultiply:!1}),ki.demTexture.bind(hi.NEAREST,hi.CLAMP_TO_EDGE);Ut.activeTexture.set(hi.TEXTURE0);let bn=ki.fbo;if(!bn){const Yn=new t.T(Ut,{width:Pi,height:Pi,data:null},hi.RGBA);Yn.bind(hi.LINEAR,hi.CLAMP_TO_EDGE),bn=ki.fbo=Ut.createFramebuffer(Pi,Pi,!0,!1),bn.colorAttachment.set(Yn.texture)}Ut.bindFramebuffer.set(bn.framebuffer),Ut.viewport.set([0,0,Pi,Pi]),wt.useProgram("hillshadePrepare").draw(Ut,hi.TRIANGLES,Rt,Zt,ei,Cs.disabled,pr(ki.tileID,Di),null,null,Yt.id,wt.rasterBoundsBuffer,wt.quadTriangleIndexBuffer,wt.rasterBoundsSegments),ki.needsHillshadePrepare=!1}})(H,K,ge,te,Xe,js.disabled,xt),De.viewport.set([0,0,H.width,H.height]);else if(H.renderPass==="translucent")if(Ve){const[wt,Tt,Mt]=H.stencilConfigForOverlapTwoPass(ge);Nh(H,K,te,Mt,wt,Xe,xt,!1,fe),Nh(H,K,te,Mt,Tt,Xe,xt,!0,fe)}else{const[wt,Tt]=H.getStencilConfigForOverlapAndUpdateStencilID(ge);Nh(H,K,te,Tt,wt,Xe,xt,!1,fe)}})(u,y,I,D,j):t.ct(I)?(function(H,K,te,ge,xe){if(H.renderPass!=="translucent"||!ge.length)return;const{isRenderingToTexture:fe}=xe,De=H.style.projection.useSubdivision,Ve=H.getDepthModeForSublayer(0,ms.ReadOnly),Xe=H.colorModeForRenderPass();if(De){const[xt,wt,Tt]=H.stencilConfigForOverlapTwoPass(ge);Jf(H,K,te,Tt,xt,Ve,Xe,!1,fe),Jf(H,K,te,Tt,wt,Ve,Xe,!0,fe)}else{const[xt,wt]=H.getStencilConfigForOverlapAndUpdateStencilID(ge);Jf(H,K,te,wt,xt,Ve,Xe,!1,fe)}})(u,y,I,D,j):t.bU(I)?(function(H,K,te,ge,xe){if(H.renderPass!=="translucent"||te.paint.get("raster-opacity")===0||!ge.length)return;const{isRenderingToTexture:fe}=xe,De=K.getSource(),Ve=H.style.projection.useSubdivision;if(De instanceof Ii)Ru(H,K,te,ge,null,!1,!1,De.tileCoords,De.flippedWindingOrder,fe);else if(Ve){const[Xe,xt,wt]=H.stencilConfigForOverlapTwoPass(ge);Ru(H,K,te,wt,Xe,!1,!0,Ad,!1,fe),Ru(H,K,te,wt,xt,!0,!0,Ad,!1,fe)}else{const[Xe,xt]=H.getStencilConfigForOverlapAndUpdateStencilID(ge);Ru(H,K,te,xt,Xe,!1,!0,Ad,!1,fe)}})(u,y,I,D,j):t.cu(I)?(function(H,K,te,ge,xe){const fe=te.paint.get("background-color"),De=te.paint.get("background-opacity");if(De===0)return;const{isRenderingToTexture:Ve}=xe,Xe=H.context,xt=Xe.gl,wt=H.style.projection,Tt=H.transform,Mt=Tt.tileSize,Yt=te.paint.get("background-pattern");if(H.isPatternMissing(Yt))return;const Rt=!Yt&&fe.a===1&&De===1&&H.opaquePassEnabledForLayer()?"opaque":"translucent";if(H.renderPass!==Rt)return;const Zt=js.disabled,ei=H.getDepthModeForSublayer(0,Rt==="opaque"?ms.ReadWrite:ms.ReadOnly),Ut=H.colorModeForRenderPass(),hi=H.useProgram(Yt?"backgroundPattern":"background"),$i=ge||Ao(Tt,{tileSize:Mt,terrain:H.style.map.terrain});Yt&&(Xe.activeTexture.set(xt.TEXTURE0),H.imageManager.bind(H.context));const ki=te.getCrossfadeParameters();for(const Di of $i){const Pi=Tt.getProjectionData({overscaledTileID:Di,applyGlobeMatrix:!Ve,applyTerrainMatrix:!0}),On=Yt?Fp(De,H,Yt,{tileID:Di,tileSize:Mt},ki):af(De,fe),Nn=H.style.map.terrain&&H.style.map.terrain.getTerrainData(Di),bn=wt.getMeshFromTileID(Xe,Di.canonical,!1,!0,"raster");hi.draw(Xe,xt.TRIANGLES,ei,Zt,Ut,Cs.backCCW,On,Nn,Pi,te.id,bn.vertexBuffer,bn.indexBuffer,bn.segments)}})(u,0,I,D,j):t.cv(I)&&(function(H,K,te,ge){const{isRenderingGlobe:xe}=ge,fe=H.context,De=te.implementation,Ve=H.style.projection,Xe=H.transform,xt=Xe.getProjectionDataForCustomLayer(xe),wt={farZ:Xe.farZ,nearZ:Xe.nearZ,fov:Xe.fov*Math.PI/180,modelViewProjectionMatrix:Xe.modelViewProjectionMatrix,projectionMatrix:Xe.projectionMatrix,shaderData:{variantName:Ve.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Ve.shaderPreludeCode.vertexSource}`,define:Ve.shaderDefine},defaultProjectionData:xt},Tt=De.renderingMode?De.renderingMode:"2d";if(H.renderPass==="offscreen"){const Mt=De.prerender;Mt&&(H.setCustomLayerDefaults(),fe.setColorMode(H.colorModeForRenderPass()),Mt.call(De,fe.gl,wt),fe.setDirty(),H.setBaseState())}else if(H.renderPass==="translucent"){H.setCustomLayerDefaults(),fe.setColorMode(H.colorModeForRenderPass()),fe.setStencilMode(js.disabled);const Mt=Tt==="3d"?H.getDepthModeFor3D():H.getDepthModeForSublayer(0,ms.ReadOnly);fe.setDepthMode(Mt),De.render(fe.gl,wt),fe.setDirty(),H.setBaseState(),fe.bindFramebuffer.set(null)}})(u,0,I,j))}saveTileTexture(u){const y=this._tileTextures[u.size[0]];y?y.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const y=this._tileTextures[u];return y&&y.length>0?y.pop():null}isPatternMissing(u){if(!u)return!1;if(!u.from||!u.to)return!0;const y=this.imageManager.getPattern(u.from.toString()),I=this.imageManager.getPattern(u.to.toString());return!y||!I}useProgram(u,y,I=!1,D=[]){this.cache=this.cache||{};const j=!!this.style.map.terrain,H=this.style.projection,K=I?Vo.projectionMercator:H.shaderPreludeCode,te=I?Ko:H.shaderDefine,ge=u+(y?y.cacheKey:"")+`/${I?Zl:H.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(j?"/terrain":"")+(D?`/${D.join("/")}`:"");return this.cache[ge]||(this.cache[ge]=new tf(this.context,Vo[u],y,vd[u],this._showOverdrawInspector,j,K,te,D)),this.cache[ge]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var u,y;if(this._tileTextures){for(const I in this._tileTextures){const D=this._tileTextures[I];if(D)for(const j of D)j.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((u=this.tileExtentMesh.vertexBuffer)===null||u===void 0||u.destroy()),this.tileExtentMesh&&((y=this.tileExtentMesh.indexBuffer)===null||y===void 0||y.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const I in this.cache){const D=this.cache[I];D&&D.program&&this.context.gl.deleteProgram(D.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:u,drawingBufferHeight:y}=this.context.gl;return this.width!==u||this.height!==y}}function qm(V,u){let y,I=!1,D=null,j=null;const H=()=>{D=null,I&&(V.apply(j,y),D=setTimeout(H,u),I=!1)};return(...K)=>(I=!0,j=this,y=K,D||H(),D)}class fc{constructor(u){this._getCurrentHash=()=>{const y=window.location.hash.replace("#","");if(this._hashName){let I;return y.split("&").map((D=>D.split("="))).forEach((D=>{D[0]===this._hashName&&(I=D)})),(I&&I[1]||"").split("/")}return y.split("/")},this._onHashChange=()=>{const y=this._getCurrentHash();if(!this._isValidHash(y))return!1;const I=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:I,pitch:+(y[4]||0)}),!0},this._updateHashUnthrottled=()=>{const y=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,y)},this._removeHash=()=>{const y=this._getCurrentHash();if(y.length===0)return;const I=y.join("/");let D=I;D.split("&").length>0&&(D=D.split("&")[0]),this._hashName&&(D=`${this._hashName}=${I}`);let j=window.location.hash.replace(D,"");j.startsWith("#&")?j=j.slice(0,1)+j.slice(2):j==="#"&&(j="");let H=window.location.href.replace(/(#.+)?$/,j);H=H.replace("&&","&"),window.history.replaceState(window.history.state,null,H)},this._updateHash=qm(this._updateHashUnthrottled,300),this._hashName=u&&encodeURIComponent(u)}addTo(u){return this._map=u,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(u){const y=this._map.getCenter(),I=Math.round(100*this._map.getZoom())/100,D=Math.ceil((I*Math.LN2+Math.log(512/360/.5))/Math.LN10),j=Math.pow(10,D),H=Math.round(y.lng*j)/j,K=Math.round(y.lat*j)/j,te=this._map.getBearing(),ge=this._map.getPitch();let xe="";if(xe+=u?`/${H}/${K}/${I}`:`${I}/${K}/${H}`,(te||ge)&&(xe+="/"+Math.round(10*te)/10),ge&&(xe+=`/${Math.round(ge)}`),this._hashName){const fe=this._hashName;let De=!1;const Ve=window.location.hash.slice(1).split("&").map((Xe=>{const xt=Xe.split("=")[0];return xt===fe?(De=!0,`${xt}=${xe}`):Xe})).filter((Xe=>Xe));return De||Ve.push(`${fe}=${xe}`),`#${Ve.join("&")}`}return`#${xe}`}_isValidHash(u){if(u.length<3||u.some(isNaN))return!1;try{new t.V(+u[2],+u[1])}catch{return!1}const y=+u[0],I=+(u[3]||0),D=+(u[4]||0);return y>=this._map.getMinZoom()&&y<=this._map.getMaxZoom()&&I>=-180&&I<=180&&D>=this._map.getMinPitch()&&D<=this._map.getMaxPitch()}}const zu={linearity:.3,easing:t.cw(0,0,.3,1)},ip=t.e({deceleration:2500,maxSpeed:1400},zu),ul=t.e({deceleration:20,maxSpeed:1400},zu),Ic=t.e({deceleration:1e3,maxSpeed:360},zu),Hp=t.e({deceleration:1e3,maxSpeed:90},zu),Hc=t.e({deceleration:1e3,maxSpeed:360},zu);class np{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:se(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,y=se();for(;u.length>0&&y-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const y={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:j}of this._inertiaBuffer)y.zoom+=j.zoomDelta||0,y.bearing+=j.bearingDelta||0,y.pitch+=j.pitchDelta||0,y.roll+=j.rollDelta||0,j.panDelta&&y.pan._add(j.panDelta),j.around&&(y.around=j.around),j.pinchAround&&(y.pinchAround=j.pinchAround);const I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,D={};if(y.pan.mag()){const j=jh(y.pan.mag(),I,t.e({},ip,u||{})),H=y.pan.mult(j.amount/y.pan.mag()),K=this._map.cameraHelper.handlePanInertia(H,this._map.transform);D.center=K.easingCenter,D.offset=K.easingOffset,Vh(D,j)}if(y.zoom){const j=jh(y.zoom,I,ul);D.zoom=this._map.transform.zoom+j.amount,Vh(D,j)}if(y.bearing){const j=jh(y.bearing,I,Ic);D.bearing=this._map.transform.bearing+t.an(j.amount,-179,179),Vh(D,j)}if(y.pitch){const j=jh(y.pitch,I,Hp);D.pitch=this._map.transform.pitch+j.amount,Vh(D,j)}if(y.roll){const j=jh(y.roll,I,Hc);D.roll=this._map.transform.roll+t.an(j.amount,-179,179),Vh(D,j)}if(D.zoom||D.bearing){const j=y.pinchAround===void 0?y.around:y.pinchAround;D.around=j?this._map.unproject(j):this._map.getCenter()}return this.clear(),t.e(D,{noMoveStart:!0})}}function Vh(V,u){(!V.duration||V.duration<u.duration)&&(V.duration=u.duration,V.easing=u.easing)}function jh(V,u,y){const{maxSpeed:I,linearity:D,deceleration:j}=y,H=t.an(V*D/(u/1e3),-I,I),K=Math.abs(H)/(j*D);return{easing:y.easing,duration:1e3*K,amount:H*(K/2)}}class nl extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,y,I,D={}){I=I instanceof MouseEvent?I:new MouseEvent(u,I);const j=ie.mousePos(y.getCanvas(),I),H=y.unproject(j);super(u,t.e({point:j,lngLat:H,originalEvent:I},D)),this._defaultPrevented=!1,this.target=y}}class mf extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,y,I){const D=u==="touchend"?I.changedTouches:I.touches,j=ie.touchPos(y.getCanvasContainer(),D),H=j.map((te=>y.unproject(te))),K=j.reduce(((te,ge,xe,fe)=>te.add(ge.div(fe.length))),new t.P(0,0));super(u,{points:j,point:K,lngLats:H,lngLat:y.unproject(K),originalEvent:I}),this._defaultPrevented=!1}}class Hm extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,y,I){super(u,{originalEvent:I}),this._defaultPrevented=!1}}class Hg{constructor(u,y){this._map=u,this._clickTolerance=y.clickTolerance}reset(){delete this._mousedownPos}wheel(u){return this._firePreventable(new Hm(u.type,this._map,u))}mousedown(u,y){return this._mousedownPos=y,this._firePreventable(new nl(u.type,this._map,u))}mouseup(u){this._map.fire(new nl(u.type,this._map,u))}click(u,y){this._mousedownPos&&this._mousedownPos.dist(y)>=this._clickTolerance||this._map.fire(new nl(u.type,this._map,u))}dblclick(u){return this._firePreventable(new nl(u.type,this._map,u))}mouseover(u){this._map.fire(new nl(u.type,this._map,u))}mouseout(u){this._map.fire(new nl(u.type,this._map,u))}touchstart(u){return this._firePreventable(new mf(u.type,this._map,u))}touchmove(u){this._map.fire(new mf(u.type,this._map,u))}touchend(u){this._map.fire(new mf(u.type,this._map,u))}touchcancel(u){this._map.fire(new mf(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rp{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(u){this._map.fire(new nl(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._ignoreContextMenu||this._map.fire(new nl(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sp{constructor(u){this._map=u}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(u){return this.transform.screenPointToLocation(t.P.convert(u),this._map.terrain)}}class op{constructor(u,y){this._map=u,this._tr=new sp(u),this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=y.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,y){this.isEnabled()&&u.shiftKey&&u.button===0&&(ie.disableDrag(),this._startPos=this._lastPos=y,this._active=!0)}mousemoveWindow(u,y){if(!this._active)return;const I=y;if(this._lastPos.equals(I)||!this._box&&I.dist(this._startPos)<this._clickTolerance)return;const D=this._startPos;this._lastPos=I,this._box||(this._box=ie.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",u));const j=Math.min(D.x,I.x),H=Math.max(D.x,I.x),K=Math.min(D.y,I.y),te=Math.max(D.y,I.y);ie.setTransform(this._box,`translate(${j}px,${K}px)`),this._box.style.width=H-j+"px",this._box.style.height=te-K+"px"}mouseupWindow(u,y){if(!this._active||u.button!==0)return;const I=this._startPos,D=y;if(this.reset(),ie.suppressClick(),I.x!==D.x||I.y!==D.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:u})),{cameraAnimation:j=>j.fitScreenCoordinates(I,D,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",u)}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ie.remove(this._box),this._box=null),ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(u,y){return this._map.fire(new t.l(u,{originalEvent:y}))}}function du(V,u){if(V.length!==u.length)throw new Error(`The number of touches and points are not equal - touches ${V.length}, points ${u.length}`);const y={};for(let I=0;I<V.length;I++)y[V[I].identifier]=u[I];return y}class ur{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(u,y,I){(this.centroid||I.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=u.timeStamp),I.length===this.numTouches&&(this.centroid=(function(D){const j=new t.P(0,0);for(const H of D)j._add(H);return j.div(D.length)})(y),this.touches=du(I,y)))}touchmove(u,y,I){if(this.aborted||!this.centroid)return;const D=du(I,y);for(const j in this.touches){const H=D[j];(!H||H.dist(this.touches[j])>30)&&(this.aborted=!0)}}touchend(u,y,I){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),I.length===0){const D=!this.aborted&&this.centroid;if(this.reset(),D)return D}}}class gf{constructor(u){this.singleTap=new ur(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(u,y,I){this.singleTap.touchstart(u,y,I)}touchmove(u,y,I){this.singleTap.touchmove(u,y,I)}touchend(u,y,I){const D=this.singleTap.touchend(u,y,I);if(D){const j=u.timeStamp-this.lastTime<500,H=!this.lastTap||this.lastTap.dist(D)<30;if(j&&H||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=D,this.count===this.numTaps)return this.reset(),D}}}class Wg{constructor(u){this._tr=new sp(u),this._zoomIn=new gf({numTouches:1,numTaps:2}),this._zoomOut=new gf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,y,I){this._zoomIn.touchstart(u,y,I),this._zoomOut.touchstart(u,y,I)}touchmove(u,y,I){this._zoomIn.touchmove(u,y,I),this._zoomOut.touchmove(u,y,I)}touchend(u,y,I){const D=this._zoomIn.touchend(u,y,I),j=this._zoomOut.touchend(u,y,I),H=this._tr;return D?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:K=>K.easeTo({duration:300,zoom:H.zoom+1,around:H.unproject(D)},{originalEvent:u})}):j?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:K=>K.easeTo({duration:300,zoom:H.zoom-1,around:H.unproject(j)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(u){this._enabled=!!u.enable,this._moveStateManager=u.moveStateManager,this._clickTolerance=u.clickTolerance||1,this._moveFunction=u.move,this._activateOnStart=!!u.activateOnStart,u.assignEvents(this),this.reset()}reset(u){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(u)}_move(...u){const y=this._moveFunction(...u);if(y.bearingDelta||y.pitchDelta||y.rollDelta||y.around||y.panDelta)return this._active=!0,y}dragStart(u,y){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(u)&&(this._moveStateManager.startMove(u),this._lastPoint=Array.isArray(y)?y[0]:y,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(u,y){if(!this.isEnabled())return;const I=this._lastPoint;if(!I)return;if(u.preventDefault(),!this._moveStateManager.isValidMoveEvent(u))return void this.reset(u);const D=Array.isArray(y)?y[0]:y;return!this._moved&&D.dist(I)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=D,this._move(I,D))}dragEnd(u){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(u)&&(this._moved&&ie.suppressClick(),this.reset(u))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _f=0,ap=2,Md={[_f]:1,[ap]:2};class yf{constructor(u){this._correctEvent=u.checkCorrectEvent}startMove(u){const y=ie.mouseButton(u);this._eventButton=y}endMove(u){delete this._eventButton}isValidStartEvent(u){return this._correctEvent(u)}isValidMoveEvent(u){return!(function(y,I){const D=Md[I];return y.buttons===void 0||(y.buttons&D)!==D})(u,this._eventButton)}isValidEndEvent(u){return ie.mouseButton(u)===this._eventButton}}class Wp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(u){return u.targetTouches.length===1}_isSameTouchEvent(u){return u.targetTouches[0].identifier===this._firstTouch}startMove(u){this._firstTouch=u.targetTouches[0].identifier}endMove(u){delete this._firstTouch}isValidStartEvent(u){return this._isOneFingerTouch(u)}isValidMoveEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}isValidEndEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}}class Zg{constructor(u=new yf({checkCorrectEvent:()=>!0}),y=new Wp){this.mouseMoveStateManager=u,this.oneFingerTouchMoveStateManager=y}_executeRelevantHandler(u,y,I){return u instanceof MouseEvent?y(u):typeof TouchEvent<"u"&&u instanceof TouchEvent?I(u):void 0}startMove(u){this._executeRelevantHandler(u,(y=>this.mouseMoveStateManager.startMove(y)),(y=>this.oneFingerTouchMoveStateManager.startMove(y)))}endMove(u){this._executeRelevantHandler(u,(y=>this.mouseMoveStateManager.endMove(y)),(y=>this.oneFingerTouchMoveStateManager.endMove(y)))}isValidStartEvent(u){return this._executeRelevantHandler(u,(y=>this.mouseMoveStateManager.isValidStartEvent(y)),(y=>this.oneFingerTouchMoveStateManager.isValidStartEvent(y)))}isValidMoveEvent(u){return this._executeRelevantHandler(u,(y=>this.mouseMoveStateManager.isValidMoveEvent(y)),(y=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(y)))}isValidEndEvent(u){return this._executeRelevantHandler(u,(y=>this.mouseMoveStateManager.isValidEndEvent(y)),(y=>this.oneFingerTouchMoveStateManager.isValidEndEvent(y)))}}const kd=V=>{V.mousedown=V.dragStart,V.mousemoveWindow=V.dragMove,V.mouseup=V.dragEnd,V.contextmenu=u=>{u.preventDefault()}};class Dd{constructor(u,y){this._clickTolerance=u.clickTolerance||1,this._map=y,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(u){return u<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(u,y,I){return this._calculateTransform(u,y,I)}touchmove(u,y,I){if(this._active){if(!this._shouldBePrevented(I.length))return u.preventDefault(),this._calculateTransform(u,y,I);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",u)}}touchend(u,y,I){this._calculateTransform(u,y,I),this._active&&this._shouldBePrevented(I.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,y,I){I.length>0&&(this._active=!0);const D=du(I,y),j=new t.P(0,0),H=new t.P(0,0);let K=0;for(const ge in D){const xe=D[ge],fe=this._touches[ge];fe&&(j._add(xe),H._add(xe.sub(fe)),K++,D[ge]=xe)}if(this._touches=D,this._shouldBePrevented(K)||!H.mag())return;const te=H.div(K);return this._sum._add(te),this._sum.mag()<this._clickTolerance?void 0:{around:j.div(K),panDelta:te}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(u,y,I){this._firstTwoTouches||I.length<2||(this._firstTwoTouches=[I[0].identifier,I[1].identifier],this._start([y[0],y[1]]))}touchmove(u,y,I){if(!this._firstTwoTouches)return;u.preventDefault();const[D,j]=this._firstTwoTouches,H=vf(I,y,D),K=vf(I,y,j);if(!H||!K)return;const te=this._aroundCenter?null:H.add(K).div(2);return this._move([H,K],te,u)}touchend(u,y,I){if(!this._firstTwoTouches)return;const[D,j]=this._firstTwoTouches,H=vf(I,y,D),K=vf(I,y,j);H&&K||(this._active&&ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function vf(V,u,y){for(let I=0;I<V.length;I++)if(V[I].identifier===y)return u[I]}function Xg(V,u){return Math.log(V/u)/Math.LN2}class dh extends hh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,y){const I=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(Xg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xg(this._distance,I),pinchAround:y}}}function Wm(V,u){return 180*V.angleWith(u)/Math.PI}class xf extends hh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,y,I){const D=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wm(this._vector,D),pinchAround:y}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const y=25/(Math.PI*this._minDiameter)*360,I=Wm(u,this._startVector);return Math.abs(I)<y}}function Zm(V){return Math.abs(V.y)>Math.abs(V.x)}class Yg extends hh{constructor(u){super(),this._currentTouchCount=0,this._map=u}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(u,y,I){super.touchstart(u,y,I),this._currentTouchCount=I.length}_start(u){this._lastPoints=u,Zm(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,y,I){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const D=u[0].sub(this._lastPoints[0]),j=u[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(D,j,I.timeStamp),this._valid?(this._lastPoints=u,this._active=!0,{pitchDelta:(D.y+j.y)/2*-.5}):void 0}gestureBeginsVertically(u,y,I){if(this._valid!==void 0)return this._valid;const D=u.mag()>=2,j=y.mag()>=2;if(!D&&!j)return;if(!D||!j)return this._firstMove===void 0&&(this._firstMove=I),I-this._firstMove<100&&void 0;const H=u.y>0==y.y>0;return Zm(u)&&Zm(y)&&H}}const Ou={panStep:100,bearingStep:15,pitchStep:10};class To{constructor(u){this._tr=new sp(u);const y=Ou;this._panStep=y.panStep,this._bearingStep=y.bearingStep,this._pitchStep=y.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let y=0,I=0,D=0,j=0,H=0;switch(u.keyCode){case 61:case 107:case 171:case 187:y=1;break;case 189:case 109:case 173:y=-1;break;case 37:u.shiftKey?I=-1:(u.preventDefault(),j=-1);break;case 39:u.shiftKey?I=1:(u.preventDefault(),j=1);break;case 38:u.shiftKey?D=1:(u.preventDefault(),H=-1);break;case 40:u.shiftKey?D=-1:(u.preventDefault(),H=1);break;default:return}return this._rotationDisabled&&(I=0,D=0),{cameraAnimation:K=>{const te=this._tr;K.easeTo({duration:300,easeId:"keyboardHandler",easing:cy,zoom:y?Math.round(te.zoom)+y*(u.shiftKey?2:1):te.zoom,bearing:te.bearing+I*this._bearingStep,pitch:te.pitch+D*this._pitchStep,offset:[-j*this._panStep,-H*this._panStep],center:te.center},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cy(V){return V*(2-V)}const lp=4.000244140625,Wc=1/450;class Xm{constructor(u,y){this._onTimeout=I=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(I)},this._map=u,this._tr=new sp(u),this._triggerRenderFrame=y,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wc}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(u){return!!this._map.cooperativeGestures.isEnabled()&&!(u.ctrlKey||this._map.cooperativeGestures.isBypassed(u))}wheel(u){if(!this.isEnabled())return;if(this._shouldBePrevented(u))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",u);let y=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const I=se(),D=I-(this._lastWheelEventTime||0);this._lastWheelEventTime=I,y!==0&&y%lp==0?this._type="wheel":y!==0&&Math.abs(y)<4?this._type="trackpad":D>400?(this._type=null,this._lastValue=y,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(D*y)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,y+=this._lastValue)),u.shiftKey&&y&&(y/=4),this._type&&(this._lastWheelEvent=u,this._delta-=y,this._active||this._start(u)),u.preventDefault()}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const y=ie.mousePos(this._map.getCanvas(),u),I=this._tr;this._aroundPoint=this._aroundCenter?I.transform.locationToScreenPoint(t.V.convert(I.center)):y,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const K=u.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=K),typeof this._targetZoom=="number"&&(this._targetZoom+=K)}if(this._delta!==0){const K=this._type==="wheel"&&Math.abs(this._delta)>lp?this._wheelZoomRate:this._defaultZoomRate;let te=2/(1+Math.exp(-Math.abs(this._delta*K)));this._delta<0&&te!==0&&(te=1/te);const ge=typeof this._targetZoom!="number"?u.scale:t.aq(this._targetZoom);this._targetZoom=u.applyConstrain(u.getCameraLngLat(),t.at(ge*te)).zoom,this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom!="number"?u.zoom:this._targetZoom,I=this._startZoom,D=this._easing;let j,H=!1;if(this._type==="wheel"&&I&&D){const K=se()-this._lastWheelEventTime,te=Math.min((K+5)/200,1),ge=D(te);j=t.G.number(I,y,ge),te<1?this._frameId||(this._frameId=!0):H=!0}else j=y,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=j,{noInertia:!0,needsRenderFrame:!H,zoomDelta:j-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let y=t.cy;if(this._prevEase){const I=this._prevEase,D=(se()-I.start)/I.duration,j=I.easing(D+.01)-I.easing(D),H=.27/Math.sqrt(j*j+1e-4)*.01,K=Math.sqrt(.0729-H*H);y=t.cw(H,K,.25,1)}return this._prevEase={start:se(),duration:u,easing:y},y}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kg{constructor(u,y){this._clickZoom=u,this._tapZoom=y}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jg{constructor(u){this._tr=new sp(u),this.reset()}reset(){this._active=!1}dblclick(u,y){return u.preventDefault(),{cameraAnimation:I=>{I.easeTo({duration:300,zoom:this._tr.zoom+(u.shiftKey?-1:1),around:this._tr.unproject(y)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qg{constructor(){this._tap=new gf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(u,y,I){if(!this._swipePoint)if(this._tapTime){const D=y[0],j=u.timeStamp-this._tapTime<500,H=this._tapPoint.dist(D)<30;j&&H?I.length>0&&(this._swipePoint=D,this._swipeTouch=I[0].identifier):this.reset()}else this._tap.touchstart(u,y,I)}touchmove(u,y,I){if(this._tapTime){if(this._swipePoint){if(I[0].identifier!==this._swipeTouch)return;const D=y[0],j=D.y-this._swipePoint.y;return this._swipePoint=D,u.preventDefault(),this._active=!0,{zoomDelta:j/128}}}else this._tap.touchmove(u,y,I)}touchend(u,y,I){if(this._tapTime)this._swipePoint&&I.length===0&&this.reset();else{const D=this._tap.touchend(u,y,I);D&&(this._tapTime=u.timeStamp,this._tapPoint=D)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zp{constructor(u,y,I){this._el=u,this._mousePan=y,this._touchPan=I}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pc{constructor(u,y,I,D){this._pitchWithRotate=u.pitchWithRotate,this._rollEnabled=u.rollEnabled,this._mouseRotate=y,this._mousePitch=I,this._mouseRoll=D}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class fu{constructor(u,y,I,D){this._el=u,this._touchZoom=y,this._touchRotate=I,this._tapDragZoom=D,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vr{constructor(u,y){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=u,this._options=y,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const u=this._map.getCanvasContainer();u.classList.add("maplibregl-cooperative-gestures"),this._container=ie.create("div","maplibregl-cooperative-gesture-screen",u);let y=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(y=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const I=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),D=document.createElement("div");D.className="maplibregl-desktop-message",D.textContent=y,this._container.appendChild(D);const j=document.createElement("div");j.className="maplibregl-mobile-message",j.textContent=I,this._container.appendChild(j),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ie.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(u){return u[this._bypassKey]}notifyGestureBlocked(u,y){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:u,originalEvent:y})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Cr=V=>V.zoom||V.drag||V.roll||V.pitch||V.rotate;class bf extends t.l{}function wf(V){return V.panDelta&&V.panDelta.mag()||V.zoomDelta||V.bearingDelta||V.pitchDelta||V.rollDelta}class Cc{constructor(u,y){this.handleWindowEvent=D=>{this.handleEvent(D,`${D.type}Window`)},this.handleEvent=(D,j)=>{if(D.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const H=D.type==="renderFrame"?void 0:D,K={needsRenderFrame:!1},te={},ge={};for(const{handlerName:De,handler:Ve,allowed:Xe}of this._handlers){if(!Ve.isEnabled())continue;let xt;if(this._blockedByActive(ge,Xe,De))Ve.reset();else if(Ve[j||D.type]){if(t.cz(D,j||D.type)){const wt=ie.mousePos(this._map.getCanvas(),D);xt=Ve[j||D.type](D,wt)}else if(t.cA(D,j||D.type)){const wt=this._getMapTouches(D.touches),Tt=ie.touchPos(this._map.getCanvas(),wt);xt=Ve[j||D.type](D,Tt,wt)}else t.cB(j||D.type)||(xt=Ve[j||D.type](D));this.mergeHandlerResult(K,te,xt,De,H),xt&&xt.needsRenderFrame&&this._triggerRenderFrame()}(xt||Ve.isActive())&&(ge[De]=Ve)}const xe={};for(const De in this._previousActiveHandlers)ge[De]||(xe[De]=H);this._previousActiveHandlers=ge,(Object.keys(xe).length||wf(K))&&(this._changes.push([K,te,xe]),this._triggerRenderFrame()),(Object.keys(ge).length||wf(K))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=K;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new np(u),this._bearingSnap=y.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(y);const I=this._el;this._listeners=[[I,"touchstart",{passive:!0}],[I,"touchmove",{passive:!1}],[I,"touchend",void 0],[I,"touchcancel",void 0],[I,"mousedown",void 0],[I,"mousemove",void 0],[I,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[I,"mouseover",void 0],[I,"mouseout",void 0],[I,"dblclick",void 0],[I,"click",void 0],[I,"keydown",{capture:!1}],[I,"keyup",void 0],[I,"wheel",{passive:!1}],[I,"contextmenu",void 0],[window,"blur",void 0]];for(const[D,j,H]of this._listeners)ie.addEventListener(D,j,D===document?this.handleWindowEvent:this.handleEvent,H)}destroy(){for(const[u,y,I]of this._listeners)ie.removeEventListener(u,y,u===document?this.handleWindowEvent:this.handleEvent,I)}_addDefaultHandlers(u){const y=this._map,I=y.getCanvasContainer();this._add("mapEvent",new Hg(y,u));const D=y.boxZoom=new op(y,u);this._add("boxZoom",D),u.interactive&&u.boxZoom&&D.enable();const j=y.cooperativeGestures=new vr(y,u.cooperativeGestures);this._add("cooperativeGestures",j),u.cooperativeGestures&&j.enable();const H=new Wg(y),K=new Jg(y);y.doubleClickZoom=new Kg(K,H),this._add("tapZoom",H),this._add("clickZoom",K),u.interactive&&u.doubleClickZoom&&y.doubleClickZoom.enable();const te=new Qg;this._add("tapDragZoom",te);const ge=y.touchPitch=new Yg(y);this._add("touchPitch",ge),u.interactive&&u.touchPitch&&y.touchPitch.enable(u.touchPitch);const xe=()=>y.project(y.getCenter()),fe=(function({enable:Rt,clickTolerance:Zt,aroundCenter:ei=!0,minPixelCenterThreshold:Ut=100,rotateDegreesPerPixelMoved:hi=.8},$i){const ki=new yf({checkCorrectEvent:Di=>ie.mouseButton(Di)===0&&Di.ctrlKey||ie.mouseButton(Di)===2&&!Di.ctrlKey});return new Uh({clickTolerance:Zt,move:(Di,Pi)=>{const On=$i();if(ei&&Math.abs(On.y-Di.y)>Ut)return{bearingDelta:t.cx(new t.P(Di.x,Pi.y),Pi,On)};let Nn=(Pi.x-Di.x)*hi;return ei&&Pi.y<On.y&&(Nn=-Nn),{bearingDelta:Nn}},moveStateManager:ki,enable:Rt,assignEvents:kd})})(u,xe),De=(function({enable:Rt,clickTolerance:Zt,pitchDegreesPerPixelMoved:ei=-.5}){const Ut=new yf({checkCorrectEvent:hi=>ie.mouseButton(hi)===0&&hi.ctrlKey||ie.mouseButton(hi)===2});return new Uh({clickTolerance:Zt,move:(hi,$i)=>({pitchDelta:($i.y-hi.y)*ei}),moveStateManager:Ut,enable:Rt,assignEvents:kd})})(u),Ve=(function({enable:Rt,clickTolerance:Zt,rollDegreesPerPixelMoved:ei=.3},Ut){const hi=new yf({checkCorrectEvent:$i=>ie.mouseButton($i)===2&&$i.ctrlKey});return new Uh({clickTolerance:Zt,move:($i,ki)=>{const Di=Ut();let Pi=(ki.x-$i.x)*ei;return ki.y<Di.y&&(Pi=-Pi),{rollDelta:Pi}},moveStateManager:hi,enable:Rt,assignEvents:kd})})(u,xe);y.dragRotate=new pc(u,fe,De,Ve),this._add("mouseRotate",fe,["mousePitch"]),this._add("mousePitch",De,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Ve,["mousePitch"]),u.interactive&&u.dragRotate&&y.dragRotate.enable();const Xe=(function({enable:Rt,clickTolerance:Zt}){const ei=new yf({checkCorrectEvent:Ut=>ie.mouseButton(Ut)===0&&!Ut.ctrlKey});return new Uh({clickTolerance:Zt,move:(Ut,hi)=>({around:hi,panDelta:hi.sub(Ut)}),activateOnStart:!0,moveStateManager:ei,enable:Rt,assignEvents:kd})})(u),xt=new Dd(u,y);y.dragPan=new Zp(I,Xe,xt),this._add("mousePan",Xe),this._add("touchPan",xt,["touchZoom","touchRotate"]),u.interactive&&u.dragPan&&y.dragPan.enable(u.dragPan);const wt=new xf,Tt=new dh;y.touchZoomRotate=new fu(I,Tt,wt,te),this._add("touchRotate",wt,["touchPan","touchZoom"]),this._add("touchZoom",Tt,["touchPan","touchRotate"]),u.interactive&&u.touchZoomRotate&&y.touchZoomRotate.enable(u.touchZoomRotate),this._add("blockableMapEvent",new rp(y));const Mt=y.scrollZoom=new Xm(y,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Mt,["mousePan"]),u.interactive&&u.scrollZoom&&y.scrollZoom.enable(u.scrollZoom);const Yt=y.keyboard=new To(y);this._add("keyboard",Yt),u.interactive&&u.keyboard&&y.keyboard.enable()}_add(u,y,I){this._handlers.push({handlerName:u,handler:y,allowed:I}),this._handlersById[u]=y}stop(u){if(!this._updatingCamera){for(const{handler:y}of this._handlers)y.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cr(this._eventsInProgress)||this.isZooming()}_blockedByActive(u,y,I){for(const D in u)if(D!==I&&(!y||y.indexOf(D)<0))return!0;return!1}_getMapTouches(u){const y=[];for(const I of u)this._el.contains(I.target)&&y.push(I);return y}mergeHandlerResult(u,y,I,D,j){if(!I)return;t.e(u,I);const H={handlerName:D,originalEvent:I.originalEvent||j};I.zoomDelta!==void 0&&(y.zoom=H),I.panDelta!==void 0&&(y.drag=H),I.rollDelta!==void 0&&(y.roll=H),I.pitchDelta!==void 0&&(y.pitch=H),I.bearingDelta!==void 0&&(y.rotate=H)}_applyChanges(){const u={},y={},I={};for(const[D,j,H]of this._changes)D.panDelta&&(u.panDelta=(u.panDelta||new t.P(0,0))._add(D.panDelta)),D.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+D.zoomDelta),D.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+D.bearingDelta),D.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+D.pitchDelta),D.rollDelta&&(u.rollDelta=(u.rollDelta||0)+D.rollDelta),D.around!==void 0&&(u.around=D.around),D.pinchAround!==void 0&&(u.pinchAround=D.pinchAround),D.noInertia&&(u.noInertia=D.noInertia),t.e(y,j),t.e(I,H);this._updateMapTransform(u,y,I),this._changes=[]}_updateMapTransform(u,y,I){const D=this._map,j=D._getTransformForUpdate(),H=D.terrain;if(!(wf(u)||H&&this._terrainMovement))return this._fireEvents(y,I,!0);D._stop(!0);let{panDelta:K,zoomDelta:te,bearingDelta:ge,pitchDelta:xe,rollDelta:fe,around:De,pinchAround:Ve}=u;Ve!==void 0&&(De=Ve),De=De||D.transform.centerPoint,H&&!j.isPointOnMapSurface(De)&&(De=j.centerPoint);const Xe={panDelta:K,zoomDelta:te,rollDelta:fe,pitchDelta:xe,bearingDelta:ge,around:De};this._map.cameraHelper.useGlobeControls&&!j.isPointOnMapSurface(De)&&(De=j.centerPoint);const xt=De.distSqr(j.centerPoint)<.01?j.center:j.screenPointToLocation(K?De.sub(K):De);this._handleMapControls({terrain:H,tr:j,deltasForHelper:Xe,preZoomAroundLoc:xt,combinedEventsInProgress:y,panDelta:K}),D._applyUpdatedTransform(j),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(y,I,!0)}_handleMapControls({terrain:u,tr:y,deltasForHelper:I,preZoomAroundLoc:D,combinedEventsInProgress:j,panDelta:H}){const K=this._map.cameraHelper;if(K.handleMapControlsRollPitchBearingZoom(I,y),u)return K.useGlobeControls?(this._terrainMovement||!j.drag&&!j.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void K.handleMapControlsPan(I,y,D)):this._terrainMovement||!j.drag&&!j.zoom?void(j.drag&&this._terrainMovement&&H?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(H))):K.handleMapControlsPan(I,y,D)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void K.handleMapControlsPan(I,y,D));K.handleMapControlsPan(I,y,D)}_fireEvents(u,y,I){const D=Cr(this._eventsInProgress),j=Cr(u),H={};for(const fe in u){const{originalEvent:De}=u[fe];this._eventsInProgress[fe]||(H[`${fe}start`]=De),this._eventsInProgress[fe]=u[fe]}!D&&j&&this._fireEvent("movestart",j.originalEvent);for(const fe in H)this._fireEvent(fe,H[fe]);j&&this._fireEvent("move",j.originalEvent);for(const fe in u){const{originalEvent:De}=u[fe];this._fireEvent(fe,De)}const K={};let te;for(const fe in this._eventsInProgress){const{handlerName:De,originalEvent:Ve}=this._eventsInProgress[fe];this._handlersById[De].isActive()||(delete this._eventsInProgress[fe],te=y[De]||Ve,K[`${fe}end`]=te)}for(const fe in K)this._fireEvent(fe,K[fe]);const ge=Cr(this._eventsInProgress),xe=(D||j)&&!ge;if(xe&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const fe=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&fe.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(fe)}if(I&&xe){this._updatingCamera=!0;const fe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),De=Ve=>Ve!==0&&-this._bearingSnap<Ve&&Ve<this._bearingSnap;!fe||!fe.essential&&Y.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:te})),De(this._map.getBearing())&&this._map.resetNorth()):(De(fe.bearing||this._map.getBearing())&&(fe.bearing=0),fe.freezeElevation=!0,this._map.easeTo(fe,{originalEvent:te})),this._updatingCamera=!1}}_fireEvent(u,y){this._map.fire(new t.l(u,y?{originalEvent:y}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((u=>{delete this._frameId,this.handleEvent(new bf("renderFrame",{timeStamp:u})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Nl extends t.E{constructor(u,y,I){super(),this._renderFrameCallback=()=>{const D=Math.min((se()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(D)),D<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=I.bearingSnap,this.cameraHelper=y,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(u,y){u.apply(this.transform),this.transform=u,this.cameraHelper=y}getCenter(){return new t.V(this.transform.center.lng,this.transform.center.lat)}setCenter(u,y){return this.jumpTo({center:u},y)}getCenterElevation(){return this.transform.elevation}setCenterElevation(u,y){return this.jumpTo({elevation:u},y),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(u){this._centerClampedToGround=u}panBy(u,y,I){return u=t.P.convert(u).mult(-1),this.panTo(this.transform.center,t.e({offset:u},y),I)}panTo(u,y,I){return this.easeTo(t.e({center:u},y),I)}getZoom(){return this.transform.zoom}setZoom(u,y){return this.jumpTo({zoom:u},y),this}zoomTo(u,y,I){return this.easeTo(t.e({zoom:u},y),I)}zoomIn(u,y){return this.zoomTo(this.getZoom()+1,u,y),this}zoomOut(u,y){return this.zoomTo(this.getZoom()-1,u,y),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(u,y){return u!=this.transform.fov&&(this.transform.setFov(u),this.fire(new t.l("movestart",y)).fire(new t.l("move",y)).fire(new t.l("moveend",y))),this}getBearing(){return this.transform.bearing}setBearing(u,y){return this.jumpTo({bearing:u},y),this}getPadding(){return this.transform.padding}setPadding(u,y){return this.jumpTo({padding:u},y),this}rotateTo(u,y,I){return this.easeTo(t.e({bearing:u},y),I)}resetNorth(u,y){return this.rotateTo(0,t.e({duration:1e3},u),y),this}resetNorthPitch(u,y){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},u),y),this}snapToNorth(u,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,y):this}getPitch(){return this.transform.pitch}setPitch(u,y){return this.jumpTo({pitch:u},y),this}getRoll(){return this.transform.roll}setRoll(u,y){return this.jumpTo({roll:u},y),this}cameraForBounds(u,y){u=Ui.convert(u).adjustAntiMeridian();const I=y&&y.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),I,y)}_cameraForBoxAndBearing(u,y,I,D){const j={top:0,bottom:0,right:0,left:0};if(typeof(D=t.e({padding:j,offset:[0,0],maxZoom:this.transform.maxZoom},D)).padding=="number"){const ge=D.padding;D.padding={top:ge,bottom:ge,right:ge,left:ge}}const H=t.e(j,D.padding);D.padding=H;const K=this.transform,te=new Ui(u,y);return this.cameraHelper.cameraForBoxAndBearing(D,H,te,I,K)}fitBounds(u,y,I){return this._fitInternal(this.cameraForBounds(u,y),y,I)}fitScreenCoordinates(u,y,I,D,j){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(u)),this.transform.screenPointToLocation(t.P.convert(y)),I,D),D,j)}_fitInternal(u,y,I){return u?(delete(y=t.e(u,y)).padding,y.linear?this.easeTo(y,I):this.flyTo(y,I)):this}jumpTo(u,y){this.stop();const I=this._getTransformForUpdate();let D=!1,j=!1,H=!1;const K=I.zoom;this.cameraHelper.handleJumpToCenterZoom(I,u);const te=I.zoom!==K;return"elevation"in u&&I.elevation!==+u.elevation&&I.setElevation(+u.elevation),"bearing"in u&&I.bearing!==+u.bearing&&(D=!0,I.setBearing(+u.bearing)),"pitch"in u&&I.pitch!==+u.pitch&&(j=!0,I.setPitch(+u.pitch)),"roll"in u&&I.roll!==+u.roll&&(H=!0,I.setRoll(+u.roll)),u.padding==null||I.isPaddingEqual(u.padding)||I.setPadding(u.padding),this._applyUpdatedTransform(I),this.fire(new t.l("movestart",y)).fire(new t.l("move",y)),te&&this.fire(new t.l("zoomstart",y)).fire(new t.l("zoom",y)).fire(new t.l("zoomend",y)),D&&this.fire(new t.l("rotatestart",y)).fire(new t.l("rotate",y)).fire(new t.l("rotateend",y)),j&&this.fire(new t.l("pitchstart",y)).fire(new t.l("pitch",y)).fire(new t.l("pitchend",y)),H&&this.fire(new t.l("rollstart",y)).fire(new t.l("roll",y)).fire(new t.l("rollend",y)),this.fire(new t.l("moveend",y))}calculateCameraOptionsFromTo(u,y,I,D=0){const j=t.a9.fromLngLat(u,y),H=t.a9.fromLngLat(I,D),K=H.x-j.x,te=H.y-j.y,ge=H.z-j.z,xe=Math.hypot(K,te,ge);if(xe===0)throw new Error("Can't calculate camera options with same From and To");const fe=Math.hypot(K,te),De=t.at(this.transform.cameraToCenterDistance/xe/this.transform.tileSize),Ve=180*Math.atan2(K,-te)/Math.PI;let Xe=180*Math.acos(fe/xe)/Math.PI;return Xe=ge<0?90-Xe:90+Xe,{center:H.toLngLat(),elevation:D,zoom:De,pitch:Xe,bearing:Ve}}calculateCameraOptionsFromCameraLngLatAltRotation(u,y,I,D,j){const H=this.transform.calculateCenterFromCameraLngLatAlt(u,y,I,D);return{center:H.center,elevation:H.elevation,zoom:H.zoom,bearing:I,pitch:D,roll:j}}easeTo(u,y){this._stop(!1,u.easeId),((u=t.e({offset:[0,0],duration:500,easing:t.cy},u)).animate===!1||!u.essential&&Y.prefersReducedMotion)&&(u.duration=0);const I=this._getTransformForUpdate(),D=this.getBearing(),j=I.pitch,H=I.roll,K="bearing"in u?this._normalizeBearing(u.bearing,D):D,te="pitch"in u?+u.pitch:j,ge="roll"in u?this._normalizeBearing(u.roll,H):H,xe="padding"in u?u.padding:I.padding,fe=t.P.convert(u.offset);let De,Ve;u.around&&(De=t.V.convert(u.around),Ve=I.locationToScreenPoint(De));const Xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},xt=this.cameraHelper.handleEaseTo(I,{bearing:K,pitch:te,roll:ge,padding:xe,around:De,aroundPoint:Ve,offsetAsPoint:fe,offset:u.offset,zoom:u.zoom,center:u.center});return this._rotating=this._rotating||D!==K,this._pitching=this._pitching||te!==j,this._rolling=this._rolling||ge!==H,this._padding=!I.isPaddingEqual(xe),this._zooming=this._zooming||xt.isZooming,this._easeId=u.easeId,this._prepareEase(y,u.noMoveStart,Xe),this.terrain&&this._prepareElevation(xt.elevationCenter),this._ease((wt=>{xt.easeFunc(wt),this.terrain&&!u.freezeElevation&&this._updateElevation(wt),this._applyUpdatedTransform(I),this._fireMoveEvents(y)}),(wt=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(y,wt)}),u),this}_prepareEase(u,y,I={}){this._moving=!0,y||I.moving||this.fire(new t.l("movestart",u)),this._zooming&&!I.zooming&&this.fire(new t.l("zoomstart",u)),this._rotating&&!I.rotating&&this.fire(new t.l("rotatestart",u)),this._pitching&&!I.pitching&&this.fire(new t.l("pitchstart",u)),this._rolling&&!I.rolling&&this.fire(new t.l("rollstart",u))}_prepareElevation(u){this._elevationCenter=u,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(u){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const y=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(u<1&&y!==this._elevationTarget){const I=this._elevationTarget-this._elevationStart;this._elevationStart+=u*(I-(y-(I*u+this._elevationStart))/(1-u)),this._elevationTarget=y}this.transform.setElevation(t.G.number(this._elevationStart,this._elevationTarget,u))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(u){if(!this.terrain&&u.elevation>=0&&u.pitch<=90)return{};const y=u.getCameraLngLat(),I=u.getCameraAltitude(),D=this.terrain?this.terrain.getElevationForLngLatZoom(y,u.zoom):0;if(I<D){const j=this.calculateCameraOptionsFromTo(y,D,u.center,u.elevation);return{pitch:j.pitch,zoom:j.zoom}}return{}}_applyUpdatedTransform(u){const y=[];if(y.push((D=>this._elevateCameraIfInsideTerrain(D))),this.transformCameraUpdate&&y.push((D=>this.transformCameraUpdate(D))),!y.length)return;const I=u.clone();for(const D of y){const j=I.clone(),{center:H,zoom:K,roll:te,pitch:ge,bearing:xe,elevation:fe}=D(j);H&&j.setCenter(H),fe!==void 0&&j.setElevation(fe),K!==void 0&&j.setZoom(K),te!==void 0&&j.setRoll(te),ge!==void 0&&j.setPitch(ge),xe!==void 0&&j.setBearing(xe),I.apply(j)}this.transform.apply(I)}_fireMoveEvents(u){this.fire(new t.l("move",u)),this._zooming&&this.fire(new t.l("zoom",u)),this._rotating&&this.fire(new t.l("rotate",u)),this._pitching&&this.fire(new t.l("pitch",u)),this._rolling&&this.fire(new t.l("roll",u))}_afterEase(u,y){if(this._easeId&&y&&this._easeId===y)return;delete this._easeId;const I=this._zooming,D=this._rotating,j=this._pitching,H=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,I&&this.fire(new t.l("zoomend",u)),D&&this.fire(new t.l("rotateend",u)),j&&this.fire(new t.l("pitchend",u)),H&&this.fire(new t.l("rollend",u)),this.fire(new t.l("moveend",u))}flyTo(u,y){if(!u.essential&&Y.prefersReducedMotion){const Pi=t.U(u,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Pi,y)}this.stop(),u=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.cy},u);const I=this._getTransformForUpdate(),D=I.bearing,j=I.pitch,H=I.roll,K=I.padding,te="bearing"in u?this._normalizeBearing(u.bearing,D):D,ge="pitch"in u?+u.pitch:j,xe="roll"in u?this._normalizeBearing(u.roll,H):H,fe="padding"in u?u.padding:I.padding,De=t.P.convert(u.offset);let Ve=I.centerPoint.add(De);const Xe=I.screenPointToLocation(Ve),xt=this.cameraHelper.handleFlyTo(I,{bearing:te,pitch:ge,roll:xe,padding:fe,locationAtOffset:Xe,offsetAsPoint:De,center:u.center,minZoom:u.minZoom,zoom:u.zoom});let wt=u.curve;const Tt=Math.max(I.width,I.height),Mt=Tt/xt.scaleOfZoom,Yt=xt.pixelPathLength;typeof xt.scaleOfMinZoom=="number"&&(wt=Math.sqrt(Tt/xt.scaleOfMinZoom/Yt*2));const Rt=wt*wt;function Zt(Pi){const On=(Mt*Mt-Tt*Tt+(Pi?-1:1)*Rt*Rt*Yt*Yt)/(2*(Pi?Mt:Tt)*Rt*Yt);return Math.log(Math.sqrt(On*On+1)-On)}function ei(Pi){return(Math.exp(Pi)-Math.exp(-Pi))/2}function Ut(Pi){return(Math.exp(Pi)+Math.exp(-Pi))/2}const hi=Zt(!1);let $i=function(Pi){return Ut(hi)/Ut(hi+wt*Pi)},ki=function(Pi){return Tt*((Ut(hi)*(ei(On=hi+wt*Pi)/Ut(On))-ei(hi))/Rt)/Yt;var On},Di=(Zt(!0)-hi)/wt;if(Math.abs(Yt)<2e-6||!isFinite(Di)){if(Math.abs(Tt-Mt)<1e-6)return this.easeTo(u,y);const Pi=Mt<Tt?-1:1;Di=Math.abs(Math.log(Mt/Tt))/wt,ki=()=>0,$i=On=>Math.exp(Pi*wt*On)}return u.duration="duration"in u?+u.duration:1e3*Di/("screenSpeed"in u?+u.screenSpeed/wt:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=D!==te,this._pitching=ge!==j,this._rolling=xe!==H,this._padding=!I.isPaddingEqual(fe),this._prepareEase(y,!1),this.terrain&&this._prepareElevation(xt.targetCenter),this._ease((Pi=>{const On=Pi*Di,Nn=1/$i(On),bn=ki(On);this._rotating&&I.setBearing(t.G.number(D,te,Pi)),this._pitching&&I.setPitch(t.G.number(j,ge,Pi)),this._rolling&&I.setRoll(t.G.number(H,xe,Pi)),this._padding&&(I.interpolatePadding(K,fe,Pi),Ve=I.centerPoint.add(De)),xt.easeFunc(Pi,Nn,bn,Ve),this.terrain&&!u.freezeElevation&&this._updateElevation(Pi),this._applyUpdatedTransform(I),this._fireMoveEvents(y)}),(()=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(y)}),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,y){var I;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const D=this._onEaseEnd;delete this._onEaseEnd,D.call(this,y)}return u||(I=this.handlers)===null||I===void 0||I.stop(!1),this}_ease(u,y,I){I.animate===!1||I.duration===0?(u(1),y()):(this._easeStart=se(),this._easeOptions=I,this._onEaseFrame=u,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(u,y){u=t.W(u,-180,180);const I=Math.abs(u-y);return Math.abs(u-360-y)<I&&(u-=360),Math.abs(u+360-y)<I&&(u+=360),u}queryTerrainElevation(u){return this.terrain?this.terrain.getElevationForLngLat(t.V.convert(u),this.transform):null}}const Zc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ym{constructor(u=Zc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=y=>{!y||y.sourceDataType!=="metadata"&&y.sourceDataType!=="visibility"&&y.dataType!=="style"&&y.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=u}getDefaultPosition(){return"bottom-right"}onAdd(u){return this._map=u,this._compact=this.options.compact,this._container=ie.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ie.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(u,y){const I=this._map._getUIString(`AttributionControl.${y}`);u.title=I,u.setAttribute("aria-label",I)}_updateAttributions(){if(!this._map.style)return;let u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map((D=>typeof D!="string"?"":D))):typeof this.options.customAttribution=="string"&&u.push(this.options.customAttribution)),this._map.style.stylesheet){const D=this._map.style.stylesheet;this.styleOwner=D.owner,this.styleId=D.id}const y=this._map.style.tileManagers;for(const D in y){const j=y[D];if(j.used||j.usedForTerrain){const H=j.getSource();H.attribution&&u.indexOf(H.attribution)<0&&u.push(H.attribution)}}u=u.filter((D=>String(D).trim())),u.sort(((D,j)=>D.length-j.length)),u=u.filter(((D,j)=>{for(let H=j+1;H<u.length;H++)if(u[H].indexOf(D)>=0)return!1;return!0}));const I=u.join(" | ");I!==this._attribHTML&&(this._attribHTML=I,u.length?(this._innerContainer.innerHTML=ie.sanitize(I),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Tf{constructor(u={}){this._updateCompact=()=>{const y=this._container.children;if(y.length){const I=y[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&I.classList.add("maplibregl-compact"):I.classList.remove("maplibregl-compact")}},this.options=u}getDefaultPosition(){return"bottom-left"}onAdd(u){this._map=u,this._compact=this.options&&this.options.compact,this._container=ie.create("div","maplibregl-ctrl");const y=ie.create("a","maplibregl-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://maplibre.org/",y.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),y.setAttribute("rel","noopener nofollow"),this._container.appendChild(y),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ie.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const y=++this._id;return this._queue.push({callback:u,id:y,cancelled:!1}),y}remove(u){const y=this._currentlyRunning,I=y?this._queue.concat(y):this._queue;for(const D of I)if(D.id===u)return void(D.cancelled=!0)}run(u=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const y=this._currentlyRunning=this._queue;this._queue=[];for(const I of y)if(!I.cancelled&&(I.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cn=t.aU([{name:"a_pos3d",type:"Int16",components:3}]);class $h extends t.E{constructor(u){super(),this._lastTilesetChange=se(),this.tileManager=u,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=u._source.tileSize*2**this.deltaZoom,u.usedForTerrain=!0,u.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(u,y){this.tileManager.update(u,y),this._renderableTilesKeys=[];const I={};for(const D of Ao(u,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:y,calculateTileZoom:this.tileManager._source.calculateTileZoom}))I[D.key]=!0,this._renderableTilesKeys.push(D.key),this._tiles[D.key]||(D.terrainRttPosMatrix32f=new Float64Array(16),t.c7(D.terrainRttPosMatrix32f,0,t.a5,t.a5,0,0,1),this._tiles[D.key]=new un(D,this.tileSize),this._lastTilesetChange=se());for(const D in this._tiles)I[D]||delete this._tiles[D]}freeRtt(u){for(const y in this._tiles){const I=this._tiles[y];(!u||I.tileID.equals(u)||I.tileID.isChildOf(u)||u.isChildOf(I.tileID))&&(I.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((u=>this.getTileByID(u)))}getTileByID(u){return this._tiles[u]}getTerrainCoords(u,y){return y?this._getTerrainCoordsForTileRanges(u,y):this._getTerrainCoordsForRegularTile(u)}_getTerrainCoordsForRegularTile(u){const y={};for(const I of this._renderableTilesKeys){const D=this._tiles[I].tileID,j=u.clone(),H=t.bk();if(D.canonical.equals(u.canonical))t.c7(H,0,t.a5,t.a5,0,0,1);else if(D.canonical.isChildOf(u.canonical)){const K=D.canonical.z-u.canonical.z,te=D.canonical.x-(D.canonical.x>>K<<K),ge=D.canonical.y-(D.canonical.y>>K<<K),xe=t.a5>>K;t.c7(H,0,xe,xe,0,0,1),t.O(H,H,[-te*xe,-ge*xe,0])}else{if(!u.canonical.isChildOf(D.canonical))continue;{const K=u.canonical.z-D.canonical.z,te=u.canonical.x-(u.canonical.x>>K<<K),ge=u.canonical.y-(u.canonical.y>>K<<K),xe=t.a5>>K;t.c7(H,0,t.a5,t.a5,0,0,1),t.O(H,H,[te*xe,ge*xe,0]),t.Q(H,H,[1/2**K,1/2**K,0])}}j.terrainRttPosMatrix32f=new Float32Array(H),y[I]=j}return y}_getTerrainCoordsForTileRanges(u,y){const I={};for(const D of this._renderableTilesKeys){const j=this._tiles[D].tileID;if(!this._isWithinTileRanges(j,y))continue;const H=u.clone(),K=t.bk();if(j.canonical.z===u.canonical.z){const te=u.canonical.x-j.canonical.x,ge=u.canonical.y-j.canonical.y;t.c7(K,0,t.a5,t.a5,0,0,1),t.O(K,K,[te*t.a5,ge*t.a5,0])}else if(j.canonical.z>u.canonical.z){const te=j.canonical.z-u.canonical.z,ge=j.canonical.x-(j.canonical.x>>te<<te),xe=j.canonical.y-(j.canonical.y>>te<<te),fe=u.canonical.x-(j.canonical.x>>te),De=u.canonical.y-(j.canonical.y>>te),Ve=t.a5>>te;t.c7(K,0,Ve,Ve,0,0,1),t.O(K,K,[-ge*Ve+fe*t.a5,-xe*Ve+De*t.a5,0])}else{const te=u.canonical.z-j.canonical.z,ge=u.canonical.x-(u.canonical.x>>te<<te),xe=u.canonical.y-(u.canonical.y>>te<<te),fe=(u.canonical.x>>te)-j.canonical.x,De=(u.canonical.y>>te)-j.canonical.y,Ve=t.a5<<te;t.c7(K,0,Ve,Ve,0,0,1),t.O(K,K,[ge*t.a5+fe*Ve,xe*t.a5+De*Ve,0])}H.terrainRttPosMatrix32f=new Float32Array(K),I[D]=H}return I}getSourceTile(u,y){const I=this.tileManager._source;let D=u.overscaledZ-this.deltaZoom;if(D>I.maxzoom&&(D=I.maxzoom),D<I.minzoom)return;this._sourceTileCache[u.key]||(this._sourceTileCache[u.key]=u.scaledTo(D).key);let j=this.findTileInCaches(this._sourceTileCache[u.key]);if(!j?.dem&&y)for(;D>=I.minzoom&&!j?.dem;)j=this.findTileInCaches(u.scaledTo(D--).key);return j}findTileInCaches(u){let y=this.tileManager.getTileByID(u);return y||(y=this.tileManager._outOfViewCache.getByKey(u),y)}anyTilesAfterTime(u=Date.now()){return this._lastTilesetChange>=u}_isWithinTileRanges(u,y){return y[u.canonical.z]&&u.canonical.x>=y[u.canonical.z].minTileX&&u.canonical.x<=y[u.canonical.z].maxTileX&&u.canonical.y>=y[u.canonical.z].minTileY&&u.canonical.y<=y[u.canonical.z].maxTileY}}class So{constructor(u,y,I){this._meshCache={},this.painter=u,this.tileManager=new $h(y),this.options=I,this.exaggeration=typeof I.exaggeration=="number"?I.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(u,y,I,D=t.a5){var j;if(!(y>=0&&y<D&&I>=0&&I<D))return 0;const H=this.getTerrainData(u),K=(j=H.tile)===null||j===void 0?void 0:j.dem;if(!K)return 0;const te=t.cC([],[y/D*t.a5,I/D*t.a5],H.u_terrain_matrix),ge=[te[0]*K.dim,te[1]*K.dim],xe=Math.floor(ge[0]),fe=Math.floor(ge[1]),De=ge[0]-xe,Ve=ge[1]-fe;return K.get(xe,fe)*(1-De)*(1-Ve)+K.get(xe+1,fe)*De*(1-Ve)+K.get(xe,fe+1)*(1-De)*Ve+K.get(xe+1,fe+1)*De*Ve}getElevationForLngLatZoom(u,y){if(!t.cD(y,u.wrap()))return 0;const{tileID:I,mercatorX:D,mercatorY:j}=this._getOverscaledTileIDFromLngLatZoom(u,y);return this.getElevation(I,D%t.a5,j%t.a5,t.a5)}getElevationForLngLat(u,y){const I=Ao(y,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let D=0;for(const j of I)j.canonical.z>D&&(D=Math.min(j.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(u,D)}getElevation(u,y,I,D=t.a5){return this.getDEMElevation(u,y,I,D)*this.exaggeration}getTerrainData(u){if(!this._emptyDemTexture){const D=this.painter.context,j=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new t.T(D,j,D.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new t.T(D,new t.R({width:1,height:1}),D.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(D.gl.NEAREST,D.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ar([])}const y=this.tileManager.getSourceTile(u,!0);if(y&&y.dem&&(!y.demTexture||y.needsTerrainPrepare)){const D=this.painter.context;y.demTexture=this.painter.getTileTexture(y.dem.stride),y.demTexture?y.demTexture.update(y.dem.getPixels(),{premultiply:!1}):y.demTexture=new t.T(D,y.dem.getPixels(),D.gl.RGBA,{premultiply:!1}),y.demTexture.bind(D.gl.NEAREST,D.gl.CLAMP_TO_EDGE),y.needsTerrainPrepare=!1}const I=y&&y.toString()+y.tileID.key+u.key;if(I&&!this._demMatrixCache[I]){const D=this.tileManager.getSource().maxzoom;let j=u.canonical.z-y.tileID.canonical.z;u.overscaledZ>u.canonical.z&&(u.canonical.z>=D?j=u.canonical.z-D:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const H=u.canonical.x-(u.canonical.x>>j<<j),K=u.canonical.y-(u.canonical.y>>j<<j),te=t.cE(new Float64Array(16),[1/(t.a5<<j),1/(t.a5<<j),0]);t.O(te,te,[H*t.a5,K*t.a5,0]),this._demMatrixCache[u.key]={matrix:te,coord:u}}return{u_depth:2,u_terrain:3,u_terrain_dim:y&&y.dem&&y.dem.dim||1,u_terrain_matrix:I?this._demMatrixCache[u.key].matrix:this._emptyDemMatrix,u_terrain_unpack:y&&y.dem&&y.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(y&&y.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:y}}getFramebuffer(u){const y=this.painter,I=y.width/devicePixelRatio,D=y.height/devicePixelRatio;return!this._fbo||this._fbo.width===I&&this._fbo.height===D||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new t.T(y.context,{width:I,height:D,data:null},y.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(y.context.gl.NEAREST,y.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new t.T(y.context,{width:I,height:D,data:null},y.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(y.context.gl.NEAREST,y.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=y.context.createFramebuffer(I,D,!0,!1),this._fbo.depthAttachment.set(y.context.createRenderbuffer(y.context.gl.DEPTH_COMPONENT16,I,D))),this._fbo.colorAttachment.set(u==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const u=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const y=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let j=0,H=0;j<this._coordsTextureSize;j++)for(let K=0;K<this._coordsTextureSize;K++,H+=4)y[H+0]=255&K,y[H+1]=255&j,y[H+2]=K>>8<<4|j>>8,y[H+3]=0;const I=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(y.buffer)),D=new t.T(u,I,u.gl.RGBA,{premultiply:!1});return D.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._coordsTexture=D,D}pointCoordinate(u){this.painter.maybeDrawDepthAndCoords(!0);const y=new Uint8Array(4),I=this.painter.context,D=I.gl,j=Math.round(u.x*this.painter.pixelRatio/devicePixelRatio),H=Math.round(u.y*this.painter.pixelRatio/devicePixelRatio),K=Math.round(this.painter.height/devicePixelRatio);I.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),D.readPixels(j,K-H-1,1,1,D.RGBA,D.UNSIGNED_BYTE,y),I.bindFramebuffer.set(null);const te=y[0]+(y[2]>>4<<8),ge=y[1]+((15&y[2])<<8),xe=this.coordsIndex[255-y[3]],fe=xe&&this.tileManager.getTileByID(xe);if(!fe)return null;const De=this._coordsTextureSize,Ve=(1<<fe.tileID.canonical.z)*De;return new t.a9((fe.tileID.canonical.x*De+te)/Ve+fe.tileID.wrap,(fe.tileID.canonical.y*De+ge)/Ve,this.getElevation(fe.tileID,te,ge,De))}depthAtPoint(u){const y=new Uint8Array(4),I=this.painter.context,D=I.gl;return I.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),D.readPixels(u.x,this.painter.height/devicePixelRatio-u.y-1,1,1,D.RGBA,D.UNSIGNED_BYTE,y),I.bindFramebuffer.set(null),(y[0]/16777216+y[1]/65536+y[2]/256+y[3])/256}getTerrainMesh(u){var y;const I=((y=this.painter.style.projection)===null||y===void 0?void 0:y.transitionState)>0,D=I&&u.canonical.y===0,j=I&&u.canonical.y===(1<<u.canonical.z)-1,H=`m_${D?"n":""}_${j?"s":""}`;if(this._meshCache[H])return this._meshCache[H];const K=this.painter.context,te=new t.cF,ge=new t.aY,xe=this.meshSize,fe=t.a5/xe,De=xe*xe;for(let Ut=0;Ut<=xe;Ut++)for(let hi=0;hi<=xe;hi++)te.emplaceBack(hi*fe,Ut*fe,0);for(let Ut=0;Ut<De;Ut+=xe+1)for(let hi=0;hi<xe;hi++)ge.emplaceBack(hi+Ut,xe+hi+Ut+1,xe+hi+Ut+2),ge.emplaceBack(hi+Ut,xe+hi+Ut+2,hi+Ut+1);const Ve=te.length,Xe=Ve+(xe+1),xt=(xe+1)*xe,wt=D?t.br:0,Tt=D?0:1,Mt=j?t.bs:t.a5,Yt=j?0:1;for(let Ut=0;Ut<=xe;Ut++)te.emplaceBack(Ut*fe,wt,Tt);for(let Ut=0;Ut<=xe;Ut++)te.emplaceBack(Ut*fe,Mt,Yt);for(let Ut=0;Ut<xe;Ut++)ge.emplaceBack(xt+Ut,Xe+Ut,Xe+Ut+1),ge.emplaceBack(xt+Ut,Xe+Ut+1,xt+Ut+1),ge.emplaceBack(0+Ut,Ve+Ut+1,Ve+Ut),ge.emplaceBack(0+Ut,0+Ut+1,Ve+Ut+1);const Rt=te.length,Zt=Rt+2*(xe+1);for(const Ut of[0,1])for(let hi=0;hi<=xe;hi++)for(const $i of[0,1])te.emplaceBack(Ut*t.a5,hi*fe,$i);for(let Ut=0;Ut<2*xe;Ut+=2)ge.emplaceBack(Rt+Ut,Rt+Ut+1,Rt+Ut+3),ge.emplaceBack(Rt+Ut,Rt+Ut+3,Rt+Ut+2),ge.emplaceBack(Zt+Ut,Zt+Ut+3,Zt+Ut+1),ge.emplaceBack(Zt+Ut,Zt+Ut+2,Zt+Ut+3);const ei=new Zo(K.createVertexBuffer(te,Cn.members),K.createIndexBuffer(ge),t.aX.simpleSegment(0,0,te.length,ge.length));return this._meshCache[H]=ei,ei}getMeshFrameDelta(u){return 2*Math.PI*t.bE/Math.pow(2,Math.max(u,0))/5}getMinTileElevationForLngLatZoom(u,y){var I;if(!t.cD(y,u.wrap()))return 0;const{tileID:D}=this._getOverscaledTileIDFromLngLatZoom(u,y);return(I=this.getMinMaxElevation(D).minElevation)!==null&&I!==void 0?I:0}getMinMaxElevation(u){const y=this.getTerrainData(u).tile,I={minElevation:null,maxElevation:null};return y&&y.dem&&(I.minElevation=y.dem.min*this.exaggeration,I.maxElevation=y.dem.max*this.exaggeration),I}_getOverscaledTileIDFromLngLatZoom(u,y){const I=t.a9.fromLngLat(u.wrap()),D=(1<<y)*t.a5,j=I.x*D,H=I.y*D,K=Math.floor(j/t.a5),te=Math.floor(H/t.a5);return{tileID:new t.a2(y,0,y,K,te),mercatorX:j,mercatorY:H}}}class Yo{constructor(u,y,I){this._context=u,this._size=y,this._tileSize=I,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const u of this._objects)u.texture.destroy(),u.fbo.destroy()}_createObject(u){const y=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),I=new t.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return I.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),y.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),y.colorAttachment.set(I.texture),{id:u,fbo:y,texture:I,stamp:-1,inUse:!1}}getObjectForId(u){return this._objects[u]}useObject(u){u.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((y=>u.id!==y)),this._recentlyUsed.push(u.id)}stampObject(u){u.stamp=++this._stamp}getOrCreateFreeObject(){for(const y of this._recentlyUsed)if(!this._objects[y].inUse)return this._objects[y];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const u=this._createObject(this._objects.length);return this._objects.push(u),u}freeObject(u){u.inUse=!1}freeAllObjects(){for(const u of this._objects)this.freeObject(u)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((u=>!u.inUse))===!1}}const Hn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Gh{constructor(u,y){this.painter=u,this.terrain=y,this.pool=new Yo(u.context,30,y.tileManager.tileSize*y.qualityFactor)}destruct(){this.pool.destruct()}getTexture(u){return this.pool.getObjectForId(u.rtt[this._stacks.length-1].id).texture}prepareForRender(u,y){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=u._order.filter((I=>!u._layers[I].isHidden(y))),this._coordsAscending={};for(const I in u.tileManagers){this._coordsAscending[I]={};const D=u.tileManagers[I].getVisibleCoordinates(),j=u.tileManagers[I].getSource(),H=j instanceof Ii?j.terrainTileRanges:null;for(const K of D){const te=this.terrain.tileManager.getTerrainCoords(K,H);for(const ge in te)this._coordsAscending[I][ge]||(this._coordsAscending[I][ge]=[]),this._coordsAscending[I][ge].push(te[ge])}}this._coordsAscendingStr={};for(const I of u._order){const D=u._layers[I],j=D.source;if(Hn[D.type]&&!this._coordsAscendingStr[j]){this._coordsAscendingStr[j]={};for(const H in this._coordsAscending[j])this._coordsAscendingStr[j][H]=this._coordsAscending[j][H].map((K=>K.key)).sort().join()}}for(const I of this._renderableTiles)for(const D in this._coordsAscendingStr){const j=this._coordsAscendingStr[D][I.tileID.key];j&&j!==I.rttCoords[D]&&(I.rtt=[])}}renderLayer(u,y){if(u.isHidden(this.painter.transform.zoom))return!1;const I=Object.assign(Object.assign({},y),{isRenderingToTexture:!0}),D=u.type,j=this.painter,H=this._renderableLayerIds[this._renderableLayerIds.length-1]===u.id;if(Hn[D]&&(this._prevType&&Hn[this._prevType]||this._stacks.push([]),this._prevType=D,this._stacks[this._stacks.length-1].push(u.id),!H))return!0;if(Hn[this._prevType]||Hn[D]&&H){this._prevType=D;const K=this._stacks.length-1,te=this._stacks[K]||[];for(const ge of this._renderableTiles){if(this.pool.isFull()&&(ep(this.painter,this.terrain,this._rttTiles,I),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ge),ge.rtt[K]){const fe=this.pool.getObjectForId(ge.rtt[K].id);if(fe.stamp===ge.rtt[K].stamp){this.pool.useObject(fe);continue}}const xe=this.pool.getOrCreateFreeObject();this.pool.useObject(xe),this.pool.stampObject(xe),ge.rtt[K]={id:xe.id,stamp:xe.stamp},j.context.bindFramebuffer.set(xe.fbo.framebuffer),j.context.clear({color:t.bp.transparent,stencil:0}),j.currentStencilSource=void 0;for(let fe=0;fe<te.length;fe++){const De=j.style._layers[te[fe]],Ve=De.source?this._coordsAscending[De.source][ge.tileID.key]:[ge.tileID];j.context.viewport.set([0,0,xe.fbo.width,xe.fbo.height]),j._renderTileClippingMasks(De,Ve,!0),j.renderLayer(j,j.style.tileManagers[De.source],De,Ve,I),De.source&&(ge.rttCoords[De.source]=this._coordsAscendingStr[De.source][ge.tileID.key])}}return ep(this.painter,this.terrain,this._rttTiles,I),this._rttTiles=[],this.pool.freeAllObjects(),Hn[D]}return!1}}const cp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Km=P,Ef={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Zc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},up={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ld{constructor(u,y,I=!1){this.mousedown=j=>{this.startMove(j,ie.mousePos(this.element,j)),ie.addEventListener(window,"mousemove",this.mousemove),ie.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=j=>{this.move(j,ie.mousePos(this.element,j))},this.mouseup=j=>{this._rotatePitchHandler.dragEnd(j),this.offTemp()},this.touchstart=j=>{j.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie.touchPos(this.element,j.targetTouches)[0],this.startMove(j,this._startPos),ie.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.addEventListener(window,"touchend",this.touchend))},this.touchmove=j=>{j.targetTouches.length!==1?this.reset():(this._lastPos=ie.touchPos(this.element,j.targetTouches)[0],this.move(j,this._lastPos))},this.touchend=j=>{j.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=y;const D=new Zg;this._rotatePitchHandler=new Uh({clickTolerance:3,move:(j,H)=>{const K=y.getBoundingClientRect(),te=new t.P((K.bottom-K.top)/2,(K.right-K.left)/2);return{bearingDelta:t.cx(new t.P(j.x,H.y),H,te),pitchDelta:I?-.5*(H.y-j.y):void 0}},moveStateManager:D,enable:!0,assignEvents:()=>{}}),this.map=u,ie.addEventListener(y,"mousedown",this.mousedown),ie.addEventListener(y,"touchstart",this.touchstart,{passive:!1}),ie.addEventListener(y,"touchcancel",this.reset)}startMove(u,y){this._rotatePitchHandler.dragStart(u,y),ie.disableDrag()}move(u,y){const I=this.map,{bearingDelta:D,pitchDelta:j}=this._rotatePitchHandler.dragMove(u,y)||{};D&&I.setBearing(I.getBearing()+D),j&&I.setPitch(I.getPitch()+j)}off(){const u=this.element;ie.removeEventListener(u,"mousedown",this.mousedown),ie.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend),ie.removeEventListener(u,"touchcancel",this.reset),this.offTemp()}offTemp(){ie.enableDrag(),ie.removeEventListener(window,"mousemove",this.mousemove),ie.removeEventListener(window,"mouseup",this.mouseup),ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ie.removeEventListener(window,"touchend",this.touchend)}}let Fu;function pu(V,u,y,I=!1){if(I||!y.getCoveringTilesDetailsProvider().allowWorldCopies())return V?.wrap();const D=new t.V(V.lng,V.lat);if(V=new t.V(V.lng,V.lat),u){const j=new t.V(V.lng-360,V.lat),H=new t.V(V.lng+360,V.lat),K=y.locationToScreenPoint(V).distSqr(u);y.locationToScreenPoint(j).distSqr(u)<K?V=j:y.locationToScreenPoint(H).distSqr(u)<K&&(V=H)}for(;Math.abs(V.lng-y.center.lng)>180;){const j=y.locationToScreenPoint(V);if(j.x>=0&&j.y>=0&&j.x<=y.width&&j.y<=y.height)break;V.lng>y.center.lng?V.lng-=360:V.lng+=360}return V.lng!==D.lng&&y.isPointOnMapSurface(y.locationToScreenPoint(V))?V:D}const Xp={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vl(V,u,y){const I=V.classList;for(const D in Xp)I.remove(`maplibregl-${y}-anchor-${D}`);I.add(`maplibregl-${y}-anchor-${u}`)}class If extends t.E{constructor(u){if(super(),this._onKeyPress=y=>{const I=y.code,D=y.charCode||y.keyCode;I!=="Space"&&I!=="Enter"&&D!==32&&D!==13||this.togglePopup()},this._onMapClick=y=>{const I=y.originalEvent.target,D=this._element;this._popup&&(I===D||D.contains(I))&&this.togglePopup()},this._update=y=>{if(!this._map)return;const I=this._map.loaded()&&!this._map.isMoving();(y?.type==="terrain"||y?.type==="render"&&!I)&&this._map.once("render",this._update),this._lngLat=pu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let D="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?D=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(D=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let j="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?j="rotateX(0deg)":this._pitchAlignment==="map"&&(j=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||y&&y.type!=="moveend"||(this._pos=this._pos.round()),ie.setTransform(this._element,`${Xp[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${j} ${D}`),Y.frameAsync(new AbortController).then((()=>{this._updateOpacity(y&&y.type==="moveend")})).catch((()=>{}))},this._onMove=y=>{if(!this._isDragging){const I=this._clickTolerance||this._map._clickTolerance;this._isDragging=y.point.dist(this._pointerdownPos)>=I}this._isDragging&&(this._pos=y.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=y=>{this._element.contains(y.originalEvent.target)&&(y.preventDefault(),this._positionDelta=y.point.sub(this._pos).add(this._offset),this._pointerdownPos=y.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._subpixelPositioning=u&&u.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,this.setOpacity(u?.opacity,u?.opacityWhenCovered),u&&u.element)this._element=u.element,this._offset=t.P.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie.create("div");const y=ie.createNS("http://www.w3.org/2000/svg","svg"),I=41,D=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${I}px`),y.setAttributeNS(null,"width",`${D}px`),y.setAttributeNS(null,"viewBox",`0 0 ${D} ${I}`);const j=ie.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"stroke","none"),j.setAttributeNS(null,"stroke-width","1"),j.setAttributeNS(null,"fill","none"),j.setAttributeNS(null,"fill-rule","evenodd");const H=ie.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill-rule","nonzero");const K=ie.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(3.0, 29.0)"),K.setAttributeNS(null,"fill","#000000");const te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Tt of te){const Mt=ie.createNS("http://www.w3.org/2000/svg","ellipse");Mt.setAttributeNS(null,"opacity","0.04"),Mt.setAttributeNS(null,"cx","10.5"),Mt.setAttributeNS(null,"cy","5.80029008"),Mt.setAttributeNS(null,"rx",Tt.rx),Mt.setAttributeNS(null,"ry",Tt.ry),K.appendChild(Mt)}const ge=ie.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"fill",this._color);const xe=ie.createNS("http://www.w3.org/2000/svg","path");xe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ge.appendChild(xe);const fe=ie.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"fill","#000000");const De=ie.createNS("http://www.w3.org/2000/svg","path");De.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),fe.appendChild(De);const Ve=ie.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ve.setAttributeNS(null,"fill","#FFFFFF");const Xe=ie.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const xt=ie.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#000000"),xt.setAttributeNS(null,"opacity","0.25"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962");const wt=ie.createNS("http://www.w3.org/2000/svg","circle");wt.setAttributeNS(null,"fill","#FFFFFF"),wt.setAttributeNS(null,"cx","5.5"),wt.setAttributeNS(null,"cy","5.5"),wt.setAttributeNS(null,"r","5.4999962"),Xe.appendChild(xt),Xe.appendChild(wt),H.appendChild(K),H.appendChild(ge),H.appendChild(fe),H.appendChild(Ve),H.appendChild(Xe),y.appendChild(H),y.setAttributeNS(null,"height",I*this._scale+"px"),y.setAttributeNS(null,"width",D*this._scale+"px"),this._element.appendChild(y),this._offset=t.P.convert(u&&u.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(y=>{y.preventDefault()})),this._element.addEventListener("mousedown",(y=>{y.preventDefault()})),Vl(this._element,this._anchor,"marker"),u&&u.className)for(const y of u.className.split(" "))this._element.classList.add(y);this._popup=null}addTo(u){return this.remove(),this._map=u,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",u._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),u.on("terrain",this._update),u.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=t.V.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const D=Math.abs(13.5)/Math.SQRT2;u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[D,-1*(38.1-13.5+D)],"bottom-right":[-D,-1*(38.1-13.5+D)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(u){return this._subpixelPositioning=u,this}getPopup(){return this._popup}togglePopup(){const u=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:u?(u.isOpen()?u.remove():(u.setLngLat(this._lngLat),u.addTo(this._map)),this):this}_updateOpacity(u=!1){var y,I;const D=(y=this._map)===null||y===void 0?void 0:y.terrain,j=this._map.transform.isLocationOccluded(this._lngLat);if(!D||j){const Ve=j?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Ve&&(this._element.style.opacity=Ve))}if(u)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const H=this._map,K=H.terrain.depthAtPoint(this._pos),te=H.terrain.getElevationForLngLat(this._lngLat,H.transform);if(H.transform.lngLatToCameraDepth(this._lngLat,te)-K<.006)return void(this._element.style.opacity=this._opacity);const ge=-this._offset.y/H.transform.pixelsPerMeter,xe=Math.sin(H.getPitch()*Math.PI/180)*ge,fe=H.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),De=H.transform.lngLatToCameraDepth(this._lngLat,te+xe)-fe>.006;!((I=this._popup)===null||I===void 0)&&I.isOpen()&&De&&this._popup.remove(),this._element.style.opacity=De?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(u){return this._offset=t.P.convert(u),this._update(),this}addClassName(u){this._element.classList.add(u)}removeClassName(u){this._element.classList.remove(u)}toggleClassName(u){return this._element.classList.toggle(u)}setDraggable(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(u,y){return(this._opacity===void 0||u===void 0&&y===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),u!==void 0&&(this._opacity=u),y!==void 0&&(this._opacityWhenCovered=y),this._map&&this._updateOpacity(!0),this}}const Pl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ac=0,Bu=!1;const hp={maxWidth:100,unit:"metric"};function Rd(V,u,y){const I=y&&y.maxWidth||100,D=V._container.clientHeight/2,j=V._container.clientWidth/2,H=V.unproject([j-I/2,D]),K=V.unproject([j+I/2,D]),te=Math.round(V.project(K).x-V.project(H).x),ge=Math.min(I,te,V._container.clientWidth),xe=H.distanceTo(K);if(y&&y.unit==="imperial"){const fe=3.2808*xe;fe>5280?Nu(u,ge,fe/5280,V._getUIString("ScaleControl.Miles")):Nu(u,ge,fe,V._getUIString("ScaleControl.Feet"))}else y&&y.unit==="nautical"?Nu(u,ge,xe/1852,V._getUIString("ScaleControl.NauticalMiles")):xe>=1e3?Nu(u,ge,xe/1e3,V._getUIString("ScaleControl.Kilometers")):Nu(u,ge,xe,V._getUIString("ScaleControl.Meters"))}function Nu(V,u,y,I){const D=(function(j){const H=Math.pow(10,`${Math.floor(j)}`.length-1);let K=j/H;return K=K>=10?10:K>=5?5:K>=3?3:K>=2?2:K>=1?1:(function(te){const ge=Math.pow(10,Math.ceil(-Math.log(te)/Math.LN10));return Math.round(te*ge)/ge})(K),H*K})(y);V.style.width=u*(D/y)+"px",V.innerHTML=`${D}&nbsp;${I}`}const Jm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},mu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Us(V){if(V){if(typeof V=="number"){const u=Math.round(Math.abs(V)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,V),"top-left":new t.P(u,u),"top-right":new t.P(-u,u),bottom:new t.P(0,-V),"bottom-left":new t.P(u,-u),"bottom-right":new t.P(-u,-u),left:new t.P(V,0),right:new t.P(-V,0)}}if(V instanceof t.P||Array.isArray(V)){const u=t.P.convert(V);return{center:u,top:u,"top-left":u,"top-right":u,bottom:u,"bottom-left":u,"bottom-right":u,left:u,right:u}}return{center:t.P.convert(V.center||[0,0]),top:t.P.convert(V.top||[0,0]),"top-left":t.P.convert(V["top-left"]||[0,0]),"top-right":t.P.convert(V["top-right"]||[0,0]),bottom:t.P.convert(V.bottom||[0,0]),"bottom-left":t.P.convert(V["bottom-left"]||[0,0]),"bottom-right":t.P.convert(V["bottom-right"]||[0,0]),left:t.P.convert(V.left||[0,0]),right:t.P.convert(V.right||[0,0])}}return Us(new t.P(0,0))}const dp=P;b.AJAXError=t.cI,b.Event=t.l,b.Evented=t.E,b.LngLat=t.V,b.MercatorCoordinate=t.a9,b.Point=t.P,b.addProtocol=t.cJ,b.config=t.c,b.removeProtocol=t.cK,b.AttributionControl=Ym,b.BoxZoomHandler=op,b.CanvasSource=Ne,b.CooperativeGesturesHandler=vr,b.DoubleClickZoomHandler=Kg,b.DragPanHandler=Zp,b.DragRotateHandler=pc,b.EdgeInsets=Tc,b.FullscreenControl=class extends t.E{constructor(V={}){super(),this._onFullscreenChange=()=>{var u;let y=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((u=y?.shadowRoot)===null||u===void 0)&&u.fullscreenElement;)y=y.shadowRoot.fullscreenElement;y===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,V&&V.container&&(V.container instanceof HTMLElement?this._container=V.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(V){return this._map=V,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ie.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const V=this._fullscreenButton=ie.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ie.create("span","maplibregl-ctrl-icon",V).setAttribute("aria-hidden","true"),V.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const V=this._getTitle();this._fullscreenButton.setAttribute("aria-label",V),this._fullscreenButton.title=V}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=Bt,b.GeolocateControl=class extends t.E{constructor(V){super(),this._onSuccess=u=>{if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",u)),this._finish()}},this._updateCamera=u=>{const y=new t.V(u.coords.longitude,u.coords.latitude),I=u.coords.accuracy,D=this._map.getBearing(),j=t.e({bearing:D},this.options.fitBoundsOptions),H=Ui.fromLngLat(y,I);this._map.fitBounds(H,j,{geolocateSource:!0})},this._updateMarker=u=>{if(u){const y=new t.V(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=u.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=u=>{if(this._map){if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Bu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",u)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this._geolocateButton=ie.create("button","maplibregl-ctrl-geolocate",this._container),ie.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=u=>{if(this._map){if(u===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{const y=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new If({element:this._dotElement}),this._circleElement=ie.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new If({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(y=>{const I=y?.[0]instanceof ResizeObserverEntry;y.geolocateSource||this._watchState!=="ACTIVE_LOCK"||I||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))}))}},this.options=t.e({},Pl,V)}onAdd(V){return this._map=V,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return t._(this,arguments,void 0,(function*(u=!1){if(Fu!==void 0&&!u)return Fu;if(window.navigator.permissions===void 0)return Fu=!!window.navigator.geolocation,Fu;try{Fu=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Fu=!!window.navigator.geolocation}return Fu}))})().then((u=>this._finishSetupUI(u))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ie.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ac=0,Bu=!1}_isOutOfMapMaxBounds(V){const u=this._map.getMaxBounds(),y=V.coords;return u&&(y.longitude<u.getWest()||y.longitude>u.getEast()||y.latitude<u.getSouth()||y.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const V=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&V))return;const u=this._map.project(V),y=this._map.unproject([u.x+100,u.y]),I=V.distanceTo(y)/100,D=2*this._accuracy/I;this._circleElement.style.width=`${D.toFixed(2)}px`,this._circleElement.style.height=`${D.toFixed(2)}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ac--,Bu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let V;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ac++,Ac>1?(V={maximumAge:6e5,timeout:0},Bu=!0):(V=this.options.positionOptions,Bu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,V)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var V;const u=(V=this._map.getProjection())===null||V===void 0?void 0:V.type;this._map.setProjection(u!=="mercator"&&u?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var V;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((V=this._map.getProjection())===null||V===void 0?void 0:V.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(V){return this._map=V,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ie.create("button","maplibregl-ctrl-globe",this._container),ie.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=fc,b.ImageSource=Ii,b.KeyboardHandler=To,b.LngLatBounds=Ui,b.LogoControl=Tf,b.Map=class extends Nl{constructor(V){var u,y;t.cG.mark(t.cH.create);const I=Object.assign(Object.assign(Object.assign({},Ef),V),{canvasContextAttributes:Object.assign(Object.assign({},Ef.canvasContextAttributes),V.canvasContextAttributes)});if(I.minZoom!=null&&I.maxZoom!=null&&I.minZoom>I.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(I.minPitch!=null&&I.maxPitch!=null&&I.minPitch>I.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(I.minPitch!=null&&I.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(I.maxPitch!=null&&I.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const D=new pd,j=new Cu;if(I.minZoom!==void 0&&D.setMinZoom(I.minZoom),I.maxZoom!==void 0&&D.setMaxZoom(I.maxZoom),I.minPitch!==void 0&&D.setMinPitch(I.minPitch),I.maxPitch!==void 0&&D.setMaxPitch(I.maxPitch),I.renderWorldCopies!==void 0&&D.setRenderWorldCopies(I.renderWorldCopies),I.transformConstrain!==null&&D.setConstrainOverride(I.transformConstrain),super(D,j,{bearingSnap:I.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Sf,this._controls=[],this._mapId=t.af(),this._lostContextStyle={style:null,images:null},this._contextLost=K=>{K.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const te of Object.values(this.style._layers))if(te.type==="custom"&&console.warn(`Custom layer with id '${te.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),te._listeners)for(const[ge]of Object.entries(te._listeners))console.warn(`Custom layer with id '${te.id}' had event listeners for event '${ge}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new t.l("webglcontextlost",{originalEvent:K}))},this._contextRestored=K=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new t.l("webglcontextrestored",{originalEvent:K}))},this._onMapScroll=K=>{if(K.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=I.interactive,this._maxTileCacheSize=I.maxTileCacheSize,this._maxTileCacheZoomLevels=I.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},I.canvasContextAttributes),this._trackResize=I.trackResize===!0,this._bearingSnap=I.bearingSnap,this._centerClampedToGround=I.centerClampedToGround,this._refreshExpiredTiles=I.refreshExpiredTiles===!0,this._fadeDuration=I.fadeDuration,this._crossSourceCollisions=I.crossSourceCollisions===!0,this._collectResourceTiming=I.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},cp),I.locale),this._clickTolerance=I.clickTolerance,this._overridePixelRatio=I.pixelRatio,this._maxCanvasSize=I.maxCanvasSize,this._zoomLevelsToOverscale=I.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=I.transformCameraUpdate,this.transformConstrain=I.transformConstrain,this.cancelPendingTileRequestsWhileZooming=I.cancelPendingTileRequestsWhileZooming===!0,I.reduceMotion!==void 0&&(Y.prefersReducedMotion=I.reduceMotion),this._imageQueueHandle=We.addThrottleControl((()=>this.isMoving())),this._requestManager=new je(I.transformRequest),typeof I.container=="string"){if(this._container=document.getElementById(I.container),!this._container)throw new Error(`Container '${I.container}' not found.`)}else{if(!(I.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=I.container}if(I.maxBounds&&this.setMaxBounds(I.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let K=!1;const te=qm((ge=>{this._trackResize&&!this._removed&&(this.resize(ge),this.redraw())}),50);this._resizeObserver=new ResizeObserver((ge=>{K?te(ge):K=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Cc(this,I),this._hash=I.hash&&new fc(typeof I.hash=="string"&&I.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch,roll:I.roll}),I.bounds&&(this.resize(),this.fitBounds(I.bounds,t.e({},I.fitBoundsOptions,{duration:0}))));const H=typeof I.style=="string"||((y=(u=I.style)===null||u===void 0?void 0:u.projection)===null||y===void 0?void 0:y.type)!=="globe";this.resize(null,H),this._localIdeographFontFamily=I.localIdeographFontFamily,this._validateStyle=I.validateStyle,I.style&&this.setStyle(I.style,{localIdeographFontFamily:I.localIdeographFontFamily}),I.attributionControl&&this.addControl(new Ym(typeof I.attributionControl=="boolean"?void 0:I.attributionControl)),I.maplibreLogo&&this.addControl(new Tf,I.logoPosition),this.on("style.load",(()=>{if(H||this._resizeTransform(),this.transform.unmodified){const K=t.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(K)}})),this.on("data",(K=>{this._update(K.dataType==="style"),this.fire(new t.l(`${K.dataType}data`,K))})),this.on("dataloading",(K=>{this.fire(new t.l(`${K.dataType}dataloading`,K))})),this.on("dataabort",(K=>{this.fire(new t.l("sourcedataabort",K))}))}_getMapId(){return this._mapId}setGlobalStateProperty(V,u){return this.style.setGlobalStateProperty(V,u),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(V,u){if(u===void 0&&(u=V.getDefaultPosition?V.getDefaultPosition():"top-right"),!V||!V.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const y=V.onAdd(this);this._controls.push(V);const I=this._controlPositions[u];return u.indexOf("bottom")!==-1?I.insertBefore(y,I.firstChild):I.appendChild(y),this}removeControl(V){if(!V||!V.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(V);return u>-1&&this._controls.splice(u,1),V.onRemove(this),this}hasControl(V){return this._controls.indexOf(V)>-1}coveringTiles(V){return Ao(this.transform,V)}calculateCameraOptionsFromTo(V,u,y,I){return I==null&&this.terrain&&(I=this.terrain.getElevationForLngLat(y,this.transform)),super.calculateCameraOptionsFromTo(V,u,y,I)}resize(V,u=!0){const[y,I]=this._containerDimensions(),D=this._getClampedPixelRatio(y,I);if(this._resizeCanvas(y,I,D),this.painter.resize(y,I,D),this.painter.overLimit()){const H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];const K=this._getClampedPixelRatio(y,I);this._resizeCanvas(y,I,K),this.painter.resize(y,I,K)}this._resizeTransform(u);const j=!this._moving;return j&&(this.stop(),this.fire(new t.l("movestart",V)).fire(new t.l("move",V))),this.fire(new t.l("resize",V)),j&&this.fire(new t.l("moveend",V)),this}_resizeTransform(V=!0){var u;const[y,I]=this._containerDimensions();this.transform.resize(y,I,V),(u=this._requestedCameraState)===null||u===void 0||u.resize(y,I,V)}_getClampedPixelRatio(V,u){const{0:y,1:I}=this._maxCanvasSize,D=this.getPixelRatio(),j=V*D,H=u*D;return Math.min(j>y?y/j:1,H>I?I/H:1)*D}getPixelRatio(){var V;return(V=this._overridePixelRatio)!==null&&V!==void 0?V:devicePixelRatio}setPixelRatio(V){this._overridePixelRatio=V,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(V){return this.transform.setMaxBounds(Ui.convert(V)),this._update()}setMinZoom(V){if((V=V??-2)>=-2&&V<=this.transform.maxZoom){const u=this._getTransformForUpdate();return u.setMinZoom(V),this._applyUpdatedTransform(u),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(V){if((V=V??22)>=this.transform.minZoom){const u=this._getTransformForUpdate();return u.setMaxZoom(V),this._applyUpdatedTransform(u),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(V){if((V=V??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(V>=0&&V<=this.transform.maxPitch)return this.transform.setMinPitch(V),this._update(),this.getPitch()<V&&this.setPitch(V),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(V){if((V=V??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(V>=this.transform.minPitch)return this.transform.setMaxPitch(V),this._update(),this.getPitch()>V&&this.setPitch(V),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(V){return this.transform.setRenderWorldCopies(V),this._update()}setTransformConstrain(V){return this.transform.setConstrainOverride(V),this._update()}project(V){return this.transform.locationToScreenPoint(t.V.convert(V),this.style&&this.terrain)}unproject(V){return this.transform.screenPointToLocation(t.P.convert(V),this.terrain)}isMoving(){var V;return this._moving||((V=this.handlers)===null||V===void 0?void 0:V.isMoving())}isZooming(){var V;return this._zooming||((V=this.handlers)===null||V===void 0?void 0:V.isZooming())}isRotating(){var V;return this._rotating||((V=this.handlers)===null||V===void 0?void 0:V.isRotating())}_createDelegatedListener(V,u,y){if(V==="mouseenter"||V==="mouseover"){let I=!1;return{layers:u,listener:y,delegates:{mousemove:j=>{const H=u.filter((te=>this.getLayer(te))),K=H.length!==0?this.queryRenderedFeatures(j.point,{layers:H}):[];K.length?I||(I=!0,y.call(this,new nl(V,this,j.originalEvent,{features:K}))):I=!1},mouseout:()=>{I=!1}}}}if(V==="mouseleave"||V==="mouseout"){let I=!1;return{layers:u,listener:y,delegates:{mousemove:H=>{const K=u.filter((te=>this.getLayer(te)));(K.length!==0?this.queryRenderedFeatures(H.point,{layers:K}):[]).length?I=!0:I&&(I=!1,y.call(this,new nl(V,this,H.originalEvent)))},mouseout:H=>{I&&(I=!1,y.call(this,new nl(V,this,H.originalEvent)))}}}}{const I=D=>{const j=u.filter((K=>this.getLayer(K))),H=j.length!==0?this.queryRenderedFeatures(D.point,{layers:j}):[];H.length&&(D.features=H,y.call(this,D),delete D.features)};return{layers:u,listener:y,delegates:{[V]:I}}}}_saveDelegatedListener(V,u){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[V]=this._delegatedListeners[V]||[],this._delegatedListeners[V].push(u)}_removeDelegatedListener(V,u,y){if(!this._delegatedListeners||!this._delegatedListeners[V])return;const I=this._delegatedListeners[V];for(let D=0;D<I.length;D++){const j=I[D];if(j.listener===y&&j.layers.length===u.length&&j.layers.every((H=>u.includes(H)))){for(const H in j.delegates)this.off(H,j.delegates[H]);return void I.splice(D,1)}}}on(V,u,y){if(y===void 0)return super.on(V,u);const I=typeof u=="string"?[u]:u,D=this._createDelegatedListener(V,I,y);this._saveDelegatedListener(V,D);for(const j in D.delegates)this.on(j,D.delegates[j]);return{unsubscribe:()=>{this._removeDelegatedListener(V,I,y)}}}once(V,u,y){if(y===void 0)return super.once(V,u);const I=typeof u=="string"?[u]:u,D=this._createDelegatedListener(V,I,y);for(const j in D.delegates){const H=D.delegates[j];D.delegates[j]=(...K)=>{this._removeDelegatedListener(V,I,y),H(...K)}}this._saveDelegatedListener(V,D);for(const j in D.delegates)this.once(j,D.delegates[j]);return this}off(V,u,y){return y===void 0?super.off(V,u):(this._removeDelegatedListener(V,typeof u=="string"?[u]:u,y),this)}queryRenderedFeatures(V,u){if(!this.style)return[];let y;const I=V instanceof t.P||Array.isArray(V),D=I?V:[[0,0],[this.transform.width,this.transform.height]];if(u=u||(I?{}:V)||{},D instanceof t.P||typeof D[0]=="number")y=[t.P.convert(D)];else{const j=t.P.convert(D[0]),H=t.P.convert(D[1]);y=[j,new t.P(H.x,j.y),H,new t.P(j.x,H.y),j]}return this.style.queryRenderedFeatures(y,u,this.transform)}querySourceFeatures(V,u){return this.style.querySourceFeatures(V,u)}setStyle(V,u){return(u=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},u)).diff!==!1&&u.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&V?(this._diffStyle(V,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._updateStyle(V,u))}setTransformRequest(V){return this._requestManager.setTransformRequest(V),this}_getUIString(V){const u=this._locale[V];if(u==null)throw new Error(`Missing UI string '${V}'`);return u}_updateStyle(V,u){var y,I;if(u.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(V,u)));const D=this.style&&u.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!V)),V?(this.style=new Oh(this,u||{}),this.style.setEventedParent(this,{style:this.style}),typeof V=="string"?this.style.loadURL(V,u,D):this.style.loadJSON(V,u,D),this):((I=(y=this.style)===null||y===void 0?void 0:y.projection)===null||I===void 0||I.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Oh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(V,u){if(typeof V=="string"){const y=this._requestManager.transformRequest(V,"Style");t.j(y,new AbortController).then((I=>{this._updateDiff(I.data,u)})).catch((I=>{I&&this.fire(new t.k(I))}))}else typeof V=="object"&&this._updateDiff(V,u)}_updateDiff(V,u){try{this.style.setState(V,u)&&this._update(!0)}catch(y){t.w(`Unable to perform style diff: ${y.message||y.error||y}.  Rebuilding the style from scratch.`),this._updateStyle(V,u)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(V,u){return this._lazyInitEmptyStyle(),this.style.addSource(V,u),this._update(!0)}isSourceLoaded(V){const u=this.style&&this.style.tileManagers[V];if(u!==void 0)return u.loaded();this.fire(new t.k(new Error(`There is no tile manager with ID '${V}'`)))}setTerrain(V){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),V){const u=this.style.tileManagers[V.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${V.source}`);this.terrain===null&&u.reload();for(const y in this.style._layers){const I=this.style._layers[y];I.type==="hillshade"&&I.source===V.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),I.type==="color-relief"&&I.source===V.source&&t.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new So(this.painter,u,V),this.painter.renderToTexture=new Gh(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=y=>{var I;y.dataType==="style"?this.terrain.tileManager.freeRtt():y.dataType==="source"&&y.tile&&(y.sourceId!==V.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((I=y.source)===null||I===void 0?void 0:I.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(y.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:V})),this}getTerrain(){var V,u;return(u=(V=this.terrain)===null||V===void 0?void 0:V.options)!==null&&u!==void 0?u:null}areTilesLoaded(){const V=this.style&&this.style.tileManagers;for(const u of Object.values(V))if(!u.areTilesLoaded())return!1;return!0}removeSource(V){return this.style.removeSource(V),this._update(!0)}getSource(V){return this.style.getSource(V)}setSourceTileLodParams(V,u,y){if(y){const I=this.getSource(y);if(!I)throw new Error(`There is no source with ID "${y}", cannot set LOD parameters`);I.calculateTileZoom=Hs(Math.max(1,V),Math.max(1,u))}else for(const I in this.style.tileManagers)this.style.tileManagers[I].getSource().calculateTileZoom=Hs(Math.max(1,V),Math.max(1,u));return this._update(!0),this}refreshTiles(V,u){const y=this.style.tileManagers[V];if(!y)throw new Error(`There is no tile manager with ID "${V}", cannot refresh tile`);u===void 0?y.reload(!0):y.refreshTiles(u.map((I=>new t.ac(I.z,I.x,I.y))))}addImage(V,u,y={}){const{pixelRatio:I=1,sdf:D=!1,stretchX:j,stretchY:H,content:K,textFitWidth:te,textFitHeight:ge}=y;if(this._lazyInitEmptyStyle(),!(u instanceof HTMLImageElement||t.b(u))){if(u.width===void 0||u.height===void 0)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:xe,height:fe,data:De}=u,Ve=u;return this.style.addImage(V,{data:new t.R({width:xe,height:fe},new Uint8Array(De)),pixelRatio:I,stretchX:j,stretchY:H,content:K,textFitWidth:te,textFitHeight:ge,sdf:D,version:0,userImage:Ve}),Ve.onAdd&&Ve.onAdd(this,V),this}}{const{width:xe,height:fe,data:De}=Y.getImageData(u);this.style.addImage(V,{data:new t.R({width:xe,height:fe},De),pixelRatio:I,stretchX:j,stretchY:H,content:K,textFitWidth:te,textFitHeight:ge,sdf:D,version:0})}}updateImage(V,u){const y=this.style.getImage(V);if(!y)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const I=u instanceof HTMLImageElement||t.b(u)?Y.getImageData(u):u,{width:D,height:j,data:H}=I;if(D===void 0||j===void 0)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(D!==y.data.width||j!==y.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const K=!(u instanceof HTMLImageElement||t.b(u));return y.data.replace(H,K),this.style.updateImage(V,y),this}getImage(V){return this.style.getImage(V)}hasImage(V){return V?!!this.style.getImage(V):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(V){this.style.removeImage(V)}loadImage(V){return We.getImage(this._requestManager.transformRequest(V,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(V,u){return this._lazyInitEmptyStyle(),this.style.addLayer(V,u),this._update(!0)}moveLayer(V,u){return this.style.moveLayer(V,u),this._update(!0)}removeLayer(V){return this.style.removeLayer(V),this._update(!0)}getLayer(V){return this.style.getLayer(V)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(V,u,y){return this.style.setLayerZoomRange(V,u,y),this._update(!0)}setFilter(V,u,y={}){return this.style.setFilter(V,u,y),this._update(!0)}getFilter(V){return this.style.getFilter(V)}setPaintProperty(V,u,y,I={}){return this.style.setPaintProperty(V,u,y,I),this._update(!0)}getPaintProperty(V,u){return this.style.getPaintProperty(V,u)}setLayoutProperty(V,u,y,I={}){return this.style.setLayoutProperty(V,u,y,I),this._update(!0)}getLayoutProperty(V,u){return this.style.getLayoutProperty(V,u)}setGlyphs(V,u={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(V,u),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(V,u,y={}){return this._lazyInitEmptyStyle(),this.style.addSprite(V,u,y,(I=>{I||this._update(!0)})),this}removeSprite(V){return this._lazyInitEmptyStyle(),this.style.removeSprite(V),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(V,u={}){return this._lazyInitEmptyStyle(),this.style.setSprite(V,u,(y=>{y||this._update(!0)})),this}setLight(V,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(V,u),this._update(!0)}getLight(){return this.style.getLight()}setSky(V,u={}){return this._lazyInitEmptyStyle(),this.style.setSky(V,u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(V,u){return this.style.setFeatureState(V,u),this._update()}removeFeatureState(V,u){return this.style.removeFeatureState(V,u),this._update()}getFeatureState(V){return this.style.getFeatureState(V)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let V=0,u=0;return this._container&&(V=this._container.clientWidth||400,u=this._container.clientHeight||300),[V,u]}_setupContainer(){const V=this._container;V.classList.add("maplibregl-map");const u=this._canvasContainer=ie.create("div","maplibregl-canvas-container",V);this._interactive&&u.classList.add("maplibregl-interactive"),this._canvas=ie.create("canvas","maplibregl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const y=this._containerDimensions(),I=this._getClampedPixelRatio(y[0],y[1]);this._resizeCanvas(y[0],y[1],I);const D=this._controlContainer=ie.create("div","maplibregl-control-container",V),j=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((H=>{j[H]=ie.create("div",`maplibregl-ctrl-${H} `,D)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(V,u,y){this._canvas.width=Math.floor(y*V),this._canvas.height=Math.floor(y*u),this._canvas.style.width=`${V}px`,this._canvas.style.height=`${u}px`}_setupPainter(){const V=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let u=null;this._canvas.addEventListener("webglcontextcreationerror",(I=>{u={requestedAttributes:V},I&&(u.statusMessage=I.statusMessage,u.type=I.type)}),{once:!0});let y=null;if(y=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,V):this._canvas.getContext("webgl2",V)||this._canvas.getContext("webgl",V),!y){const I="Failed to initialize WebGL";throw u?(u.message=I,new Error(JSON.stringify(u))):new Error(I)}this.painter=new tp(y,this.transform),pe.testSupport(y)}migrateProjection(V,u){super.migrateProjection(V,u),this.painter.transform=V,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(V){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||V,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(V){return this._update(),this._renderTaskQueue.add(V)}_cancelRenderFrame(V){this._renderTaskQueue.remove(V)}_render(V){var u,y,I,D,j;const H=this._idleTriggered?this._fadeDuration:0,K=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(V),this._removed)return;let te=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const fe=this.transform.zoom,De=se();this.style.zoomHistory.update(fe,De);const Ve=new t.H(fe,{now:De,fadeDuration:H,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Xe=Ve.crossFadingFactor();Xe===1&&Xe===this._crossFadingFactor||(te=!0,this._crossFadingFactor=Xe),this.style.update(Ve)}const ge=((y=this.style.projection)===null||y===void 0?void 0:y.transitionState)>0!==K;(I=this.style.projection)===null||I===void 0||I.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((D=this.style.projection)===null||D===void 0?void 0:D.transitionState,(j=this.style.projection)===null||j===void 0?void 0:j.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||ge)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,H,this._crossSourceCollisions,ge),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:H,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cG.mark(t.cH.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||te)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||xe||(this._fullyLoaded=!0,t.cG.mark(t.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var V;this._hash&&this._hash.remove();for(const y of this._controls)y.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),We.removeThrottleControl(this._imageQueueHandle),(V=this._resizeObserver)===null||V===void 0||V.disconnect();const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u?.loseContext&&u.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ie.remove(this._canvasContainer),ie.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cG.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frame(this._frameRequest,(V=>{t.cG.frame(V),this._frameRequest=null;try{this._render(V)}catch(u){if(!t.Z(u)&&!(function(y){return y.message===Ug})(u))throw u}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(V){this._showTileBoundaries!==V&&(this._showTileBoundaries=V,this._update())}get showPadding(){return!!this._showPadding}set showPadding(V){this._showPadding!==V&&(this._showPadding=V,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(V){this._showCollisionBoxes!==V&&(this._showCollisionBoxes=V,V?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(V){this._showOverdrawInspector!==V&&(this._showOverdrawInspector=V,this._update())}get repaint(){return!!this._repaint}set repaint(V){this._repaint!==V&&(this._repaint=V,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(V){this._vertices=V,this._update()}get version(){return Km}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(V){return this._lazyInitEmptyStyle(),this.style.setProjection(V),this._update(!0)}},b.MapMouseEvent=nl,b.MapTouchEvent=mf,b.MapWheelEvent=Hm,b.Marker=If,b.NavigationControl=class{constructor(V){this._updateZoomButtons=()=>{const u=this._map.getZoom(),y=u===this._map.getMaxZoom(),I=u===this._map.getMinZoom();this._zoomInButton.disabled=y,this._zoomOutButton.disabled=I,this._zoomInButton.setAttribute("aria-disabled",y.toString()),this._zoomOutButton.setAttribute("aria-disabled",I.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(u,y)=>{const I=this._map._getUIString(`NavigationControl.${y}`);u.title=I,u.setAttribute("aria-label",I)},this.options=t.e({},up,V),this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(u=>this._map.zoomIn({},{originalEvent:u}))),ie.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(u=>this._map.zoomOut({},{originalEvent:u}))),ie.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(u=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:u}):this._map.resetNorth({},{originalEvent:u})})),this._compassIcon=ie.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(V){return this._map=V,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ld(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(V,u){const y=ie.create("button",V,this._container);return y.type="button",y.addEventListener("click",u),y}},b.Popup=class extends t.E{constructor(V){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ie.remove(this._content),this._container&&(ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=u=>{this._update(u.point)},this._onMouseMove=u=>{this._update(u.point)},this._onDrag=u=>{this._update(u.point)},this._update=u=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ie.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ie.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const H of this.options.className.split(" "))this._container.classList.add(H);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=pu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!u)return;const y=this._flatPos=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&u?u:this._map.transform.locationToScreenPoint(this._lngLat));let I=this.options.anchor;const D=Us(this.options.offset);if(!I){const H=this._container.offsetWidth,K=this._container.offsetHeight;let te;te=y.y+D.bottom.y<K?["top"]:y.y>this._map.transform.height-K?["bottom"]:[],y.x<H/2?te.push("left"):y.x>this._map.transform.width-H/2&&te.push("right"),I=te.length===0?"bottom":te.join("-")}let j=y.add(D[I]);this.options.subpixelPositioning||(j=j.round()),ie.setTransform(this._container,`${Xp[I]} translate(${j.x}px,${j.y}px)`),Vl(this._container,I,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Jm),V)}addTo(V){return this._map&&this.remove(),this._map=V,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(V){return this._lngLat=t.V.convert(V),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(V){return this.setDOMContent(document.createTextNode(V))}setHTML(V){const u=document.createDocumentFragment(),y=document.createElement("body");let I;for(y.innerHTML=V;I=y.firstChild,I;)u.appendChild(I);return this.setDOMContent(u)}getMaxWidth(){var V;return(V=this._container)===null||V===void 0?void 0:V.style.maxWidth}setMaxWidth(V){return this.options.maxWidth=V,this._update(),this}setDOMContent(V){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ie.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(V),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(V){return this._container&&this._container.classList.add(V),this}removeClassName(V){return this._container&&this._container.classList.remove(V),this}setOffset(V){return this.options.offset=V,this._update(),this}toggleClassName(V){if(this._container)return this._container.classList.toggle(V)}setSubpixelPositioning(V){this.options.subpixelPositioning=V}_createCloseButton(){this.options.closeButton&&(this._closeButton=ie.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const V=this._container.querySelector(mu);V&&V.focus()}},b.RasterDEMTileSource=qi,b.RasterTileSource=vi,b.ScaleControl=class{constructor(V){this._onMove=()=>{Rd(this._map,this._container,this.options)},this.setUnit=u=>{this.options.unit=u,Rd(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hp),V)}getDefaultPosition(){return"bottom-left"}onAdd(V){return this._map=V,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-scale",V.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Xm,b.Style=Oh,b.TerrainControl=class{constructor(V){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=V}onAdd(V){return this._map=V,this._container=ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ie.create("button","maplibregl-ctrl-terrain",this._container),ie.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ie.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=Yg,b.TwoFingersTouchRotateHandler=xf,b.TwoFingersTouchZoomHandler=dh,b.TwoFingersTouchZoomRotateHandler=fu,b.VectorTileSource=Ot,b.VideoSource=qt,b.addSourceType=(V,u)=>t._(void 0,void 0,void 0,(function*(){if(Ke(V))throw new Error(`A source type called "${V}" already exists.`);((y,I)=>{Ge[y]=I})(V,u)})),b.clearPrewarmedResources=function(){const V=ti;V&&(V.isPreloaded()&&V.numActive()===1?(V.release(mr),ti=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=Uc,b.getMaxParallelImageRequests=function(){return t.c.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return gi().getRTLTextPluginStatus()},b.getVersion=function(){return dp},b.getWorkerCount=function(){return Sr.workerCount},b.getWorkerUrl=function(){return t.c.WORKER_URL},b.importScriptInWorkers=function(V){return nr().broadcast("IS",V)},b.isTimeFrozen=function(){return ae.isFrozen()},b.now=se,b.prewarm=function(){Gi().acquire(mr)},b.restoreNow=function(){ae.restoreNow()},b.setMaxParallelImageRequests=function(V){t.c.MAX_PARALLEL_IMAGE_REQUESTS=V},b.setNow=function(V){ae.setNow(V)},b.setRTLTextPlugin=function(V,u){return gi().setRTLTextPlugin(V,u)},b.setWorkerCount=function(V){Sr.workerCount=V},b.setWorkerUrl=function(V){t.c.WORKER_URL=V}}));var _=s;return _}))})(HS)),HS.exports}var DE=Ffe();const Bfe=Symbol("map"),Aj=Bfe,Nfe=Symbol("isLoaded"),Vfe=Symbol("isInitialized"),jfe=Vfe,Ufe=Symbol("componentId"),$fe=Symbol("sourceId"),Gfe=Symbol("marker"),qfe=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function Hfe(e,i,s,l){return p=>s.emit(l,{type:p.type,map:i,component:e,event:p})}function Wfe(e,i){const s=DE.LngLat.convert(e),l=DE.LngLat.convert(i);return s.lng===l.lng&&s.lat===l.lat}var Pj=(e=>(e.TOP_LEFT="top-left",e.TOP_RIGHT="top-right",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right",e))(Pj||{});const AF=new Map,Zfe=Symbol("default");function Xfe(e,i,s=Zfe){let l=AF.get(s);return l||(l=Ol({isLoaded:!1,isMounted:!1,language:null}),AF.set(s,l)),l.isLoaded=i.value?.loaded()||!1,l.isMounted=!1,l.component=e,l.map=i.value,l}const Yfe=kr({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:e=>e in Pj},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Boolean}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup(e,i){const s=uv(ba()),l=so(),p=so(),_=an(!1),b=an(!1),t=new Map,P=Xfe(s,p,e.mapKey);Ka(Aj,p),Ka(Nfe,b),Ka(jfe,_),Ka(Ufe,s.uid),Ka($fe,""),Qn(()=>e.bearing,W=>{W&&p.value?.setBearing(W)}),Qn(()=>e.bounds,W=>{W&&p.value?.fitBounds(W,e.fitBoundsOptions)}),Qn(()=>e.center,W=>{const Y=p.value?.getCenter();W&&Y&&!Wfe(W,Y)&&p.value?.setCenter(W)}),Qn(()=>e.maxBounds,W=>{W&&p.value?.setMaxBounds(W)}),Qn(()=>e.maxPitch,W=>{W&&p.value?.setMaxPitch(W)}),Qn(()=>e.maxZoom,W=>{W&&p.value?.setMaxZoom(W)}),Qn(()=>e.minPitch,W=>{W&&p.value?.setMinPitch(W)}),Qn(()=>e.minZoom,W=>{W&&p.value?.setMinZoom(W)}),Qn(()=>e.pitch,W=>{W&&p.value?.setPitch(W)}),Qn(()=>e.renderWorldCopies,W=>{W&&p.value?.setRenderWorldCopies(W)}),Qn(()=>e.mapStyle,W=>{W&&p.value?.setStyle(W)}),Qn(()=>e.transformRequest,W=>{W&&p.value?.setTransformRequest(W)}),Qn(()=>e.zoom,W=>{W&&p.value?.setZoom(W)}),Qn(()=>e.zoom,W=>{W&&p.value?.setZoom(W)});function O(){P.isMounted=!0;const W={...e,style:e.mapStyle,container:l.value};for(const Y of Object.keys(W))W[Y]===void 0&&delete W[Y];if(p.value=uv(new DE.Map(W)),P.map=p.value,_.value=!0,t.set("__load",()=>(b.value=!0,P.isLoaded=!0)),p.value.on("load",t.get("__load")),t.set("__moveend",()=>i.emit("update:center",p.value.getCenter())),p.value.on("moveend",t.get("__moveend")),t.set("__zoomend",()=>i.emit("update:zoom",p.value.getZoom())),p.value.on("zoomend",t.get("__zoomend")),t.set("__pitchend",()=>i.emit("update:pitch",p.value.getPitch())),p.value.on("pitchend",t.get("__pitchend")),t.set("__rotateend",()=>i.emit("update:bearing",p.value.getBearing())),p.value.on("rotateend",t.get("__rotateend")),s.vnode.props){for(const Y of qfe)if(s.vnode.props["onMap:"+Y]){const ae=`map:${Y}`,se=Hfe(s,p.value,i,ae);t.set(Y,se),p.value.on(Y,se)}}p.value.getCanvas().addEventListener("webglcontextlost",$)}async function F(){P.isMounted=!1,P.isLoaded=!1,b.value=!1,p.value&&(p.value.getCanvas().removeEventListener("webglcontextlost",$),_.value=!1,t.forEach((W,Y)=>{p.value.off(Y.startsWith("__")?Y.substring(2):Y,W)}),p.value.remove())}function $(){F(),Da(O)}return La(O),Vf(F),i.expose({map:p}),()=>[Ns("div",{ref:l,style:{height:e.height,width:e.width}}),_.value&&i.slots.default?i.slots.default({}):void 0]},render(){return null}});var Mj=(e=>(e.IMPERIAL="imperial",e.METRIC="metric",e.NAUTICAL="nautical",e))(Mj||{});Object.values(Mj);const $_e=kr({name:"MglMarker",emits:["dragstart","drag","dragend","update:coordinates"],props:{coordinates:{type:[Object,Array],required:!0},className:String,offset:[Object,Array],anchor:String,color:String,draggable:Boolean,clickTolerance:Number,rotation:Number,rotationAlignment:String,pitchAlignment:String,scale:Number,opacity:String,opacityWhenCovered:String,subpixelPositioning:{type:Boolean,default:!1}},setup(e,{slots:i,emit:s}){const l=Fo(Aj),p=so(),_=an(),b=an(!1),t=new Map;function P(O,F){const $=W=>{F&&F(),s(O,W)};p.value.on(O,$),t.set(O,$)}return Ka(Gfe,p),La(()=>{const O={...e};i.marker&&(O.element=_.value),p.value=new DE.Marker(O),p.value.setLngLat(e.coordinates).addTo(l.value),P("dragstart"),P("drag",()=>{s("update:coordinates",p.value?.getLngLat())}),P("dragend",()=>{s("update:coordinates",p.value?.getLngLat())}),b.value=!0}),Qn(()=>e.coordinates,O=>p.value?.setLngLat(O),{deep:!0}),Qn(()=>e.draggable,O=>p.value?.setDraggable(O)),Qn(()=>e.offset,O=>p.value?.setOffset(O||[0,0])),Qn(()=>e.pitchAlignment,O=>p.value?.setPitchAlignment(O||"auto")),Qn(()=>e.rotation,O=>p.value?.setRotation(O)),Qn(()=>e.rotationAlignment,O=>p.value?.setRotationAlignment(O||"auto")),Qn(()=>e.opacity,O=>p.value?.setOpacity(O,e.opacityWhenCovered)),Qn(()=>e.opacityWhenCovered,O=>p.value?.setOpacity(e.opacity,O)),Qn(()=>e.subpixelPositioning,O=>p.value?.setSubpixelPositioning(O)),Qn(()=>e.className,(O,F)=>{F&&p.value?.removeClassName(F),O&&p.value?.addClassName(O)}),Vf(()=>{t.forEach((O,F)=>{p.value?.off(F,O)}),p.value?.remove()}),()=>[Ns("div",i.default&&b.value?i.default({}):void 0),Ns("div",{ref:_},i.marker?i.marker():void 0)]},render(){return null}});var WS={exports:{}},Kfe=WS.exports,PF;function Jfe(){return PF||(PF=1,(function(e,i){(function(s,l){e.exports=l()})(Kfe,(function(){var s,l,p;function _(t,P){if(!s)s=P;else if(!l)l=P;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",F={};s(F),p=P(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}_(["exports"],(function(t){var P=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;function F(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=o*w-g*d;return S?(a[0]=w*(S=1/S),a[1]=-d*S,a[2]=-g*S,a[3]=o*S,a):null}function $(){var a=new O(9);return O!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function W(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=n[4],A=n[5],L=n[6],N=n[7],q=n[8];return a[0]=S*q-A*N,a[1]=g*N-d*q,a[2]=d*A-g*S,a[3]=A*L-w*q,a[4]=o*q-g*L,a[5]=g*w-o*A,a[6]=w*N-S*L,a[7]=d*L-o*N,a[8]=o*S-d*w,a}function Y(a,n,o){var d=n[0],g=n[1],w=n[2],S=n[3],A=n[4],L=n[5],N=n[6],q=n[7],Z=n[8],Q=o[0],ne=o[1],oe=o[2],me=o[3],Se=o[4],Te=o[5],Le=o[6],Re=o[7],Ue=o[8];return a[0]=Q*d+ne*S+oe*N,a[1]=Q*g+ne*A+oe*q,a[2]=Q*w+ne*L+oe*Z,a[3]=me*d+Se*S+Te*N,a[4]=me*g+Se*A+Te*q,a[5]=me*w+Se*L+Te*Z,a[6]=Le*d+Re*S+Ue*N,a[7]=Le*g+Re*A+Ue*q,a[8]=Le*w+Re*L+Ue*Z,a}function ae(){var a=new O(16);return O!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function se(a){var n=new O(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n}function ie(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function pe(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=n[4],A=n[5],L=n[6],N=n[7],q=n[8],Z=n[9],Q=n[10],ne=n[11],oe=n[12],me=n[13],Se=n[14],Te=n[15],Le=o*A-d*S,Re=o*L-g*S,Ue=o*N-w*S,rt=d*L-g*A,Qe=d*N-w*A,ht=g*N-w*L,yt=q*me-Z*oe,Et=q*Se-Q*oe,ai=q*Te-ne*oe,kt=Z*Se-Q*me,fi=Z*Te-ne*me,Ti=Q*Te-ne*Se,Si=Le*Ti-Re*fi+Ue*kt+rt*ai-Qe*Et+ht*yt;return Si?(a[0]=(A*Ti-L*fi+N*kt)*(Si=1/Si),a[1]=(g*fi-d*Ti-w*kt)*Si,a[2]=(me*ht-Se*Qe+Te*rt)*Si,a[3]=(Q*Qe-Z*ht-ne*rt)*Si,a[4]=(L*ai-S*Ti-N*Et)*Si,a[5]=(o*Ti-g*ai+w*Et)*Si,a[6]=(Se*Ue-oe*ht-Te*Re)*Si,a[7]=(q*ht-Q*Ue+ne*Re)*Si,a[8]=(S*fi-A*ai+N*yt)*Si,a[9]=(d*ai-o*fi-w*yt)*Si,a[10]=(oe*Qe-me*Ue+Te*Le)*Si,a[11]=(Z*Ue-q*Qe-ne*Le)*Si,a[12]=(A*Et-S*kt-L*yt)*Si,a[13]=(o*kt-d*Et+g*yt)*Si,a[14]=(me*Re-oe*rt-Se*Le)*Si,a[15]=(q*rt-Z*Re+Q*Le)*Si,a):null}function ye(a,n,o){var d=n[0],g=n[1],w=n[2],S=n[3],A=n[4],L=n[5],N=n[6],q=n[7],Z=n[8],Q=n[9],ne=n[10],oe=n[11],me=n[12],Se=n[13],Te=n[14],Le=n[15],Re=o[0],Ue=o[1],rt=o[2],Qe=o[3];return a[0]=Re*d+Ue*A+rt*Z+Qe*me,a[1]=Re*g+Ue*L+rt*Q+Qe*Se,a[2]=Re*w+Ue*N+rt*ne+Qe*Te,a[3]=Re*S+Ue*q+rt*oe+Qe*Le,a[4]=(Re=o[4])*d+(Ue=o[5])*A+(rt=o[6])*Z+(Qe=o[7])*me,a[5]=Re*g+Ue*L+rt*Q+Qe*Se,a[6]=Re*w+Ue*N+rt*ne+Qe*Te,a[7]=Re*S+Ue*q+rt*oe+Qe*Le,a[8]=(Re=o[8])*d+(Ue=o[9])*A+(rt=o[10])*Z+(Qe=o[11])*me,a[9]=Re*g+Ue*L+rt*Q+Qe*Se,a[10]=Re*w+Ue*N+rt*ne+Qe*Te,a[11]=Re*S+Ue*q+rt*oe+Qe*Le,a[12]=(Re=o[12])*d+(Ue=o[13])*A+(rt=o[14])*Z+(Qe=o[15])*me,a[13]=Re*g+Ue*L+rt*Q+Qe*Se,a[14]=Re*w+Ue*N+rt*ne+Qe*Te,a[15]=Re*S+Ue*q+rt*oe+Qe*Le,a}function de(a,n,o){var d,g,w,S,A,L,N,q,Z,Q,ne,oe,me=o[0],Se=o[1],Te=o[2];return n===a?(a[12]=n[0]*me+n[4]*Se+n[8]*Te+n[12],a[13]=n[1]*me+n[5]*Se+n[9]*Te+n[13],a[14]=n[2]*me+n[6]*Se+n[10]*Te+n[14],a[15]=n[3]*me+n[7]*Se+n[11]*Te+n[15]):(g=n[1],w=n[2],S=n[3],A=n[4],L=n[5],N=n[6],q=n[7],Z=n[8],Q=n[9],ne=n[10],oe=n[11],a[0]=d=n[0],a[1]=g,a[2]=w,a[3]=S,a[4]=A,a[5]=L,a[6]=N,a[7]=q,a[8]=Z,a[9]=Q,a[10]=ne,a[11]=oe,a[12]=d*me+A*Se+Z*Te+n[12],a[13]=g*me+L*Se+Q*Te+n[13],a[14]=w*me+N*Se+ne*Te+n[14],a[15]=S*me+q*Se+oe*Te+n[15]),a}function Ee(a,n,o){var d=o[0],g=o[1],w=o[2];return a[0]=n[0]*d,a[1]=n[1]*d,a[2]=n[2]*d,a[3]=n[3]*d,a[4]=n[4]*g,a[5]=n[5]*g,a[6]=n[6]*g,a[7]=n[7]*g,a[8]=n[8]*w,a[9]=n[9]*w,a[10]=n[10]*w,a[11]=n[11]*w,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a}function Pe(a,n,o){var d=Math.sin(o),g=Math.cos(o),w=n[4],S=n[5],A=n[6],L=n[7],N=n[8],q=n[9],Z=n[10],Q=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=w*g+N*d,a[5]=S*g+q*d,a[6]=A*g+Z*d,a[7]=L*g+Q*d,a[8]=N*g-w*d,a[9]=q*g-S*d,a[10]=Z*g-A*d,a[11]=Q*g-L*d,a}function Ze(a,n,o){var d=Math.sin(o),g=Math.cos(o),w=n[0],S=n[1],A=n[2],L=n[3],N=n[8],q=n[9],Z=n[10],Q=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=w*g-N*d,a[1]=S*g-q*d,a[2]=A*g-Z*d,a[3]=L*g-Q*d,a[8]=w*d+N*g,a[9]=S*d+q*g,a[10]=A*d+Z*g,a[11]=L*d+Q*g,a}function We(a,n,o){var d=Math.sin(o),g=Math.cos(o),w=n[0],S=n[1],A=n[2],L=n[3],N=n[4],q=n[5],Z=n[6],Q=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=w*g+N*d,a[1]=S*g+q*d,a[2]=A*g+Z*d,a[3]=L*g+Q*d,a[4]=N*g-w*d,a[5]=q*g-S*d,a[6]=Z*g-A*d,a[7]=Q*g-L*d,a}function je(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ye(a,n,o){var d,g,w,S=o[0],A=o[1],L=o[2],N=Math.sqrt(S*S+A*A+L*L);return N<P?null:(S*=N=1/N,A*=N,L*=N,d=Math.sin(n),g=Math.cos(n),a[0]=S*S*(w=1-g)+g,a[1]=A*S*w+L*d,a[2]=L*S*w-A*d,a[3]=0,a[4]=S*A*w-L*d,a[5]=A*A*w+g,a[6]=L*A*w+S*d,a[7]=0,a[8]=S*L*w+A*d,a[9]=A*L*w-S*d,a[10]=L*L*w+g,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function ct(a,n){var o=n[0],d=n[1],g=n[2],w=n[4],S=n[5],A=n[6],L=n[8],N=n[9],q=n[10];return a[0]=Math.sqrt(o*o+d*d+g*g),a[1]=Math.sqrt(w*w+S*S+A*A),a[2]=Math.sqrt(L*L+N*N+q*q),a}function Lt(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=o+o,A=d+d,L=g+g,N=o*S,q=d*S,Z=d*A,Q=g*S,ne=g*A,oe=g*L,me=w*S,Se=w*A,Te=w*L;return a[0]=1-Z-oe,a[1]=q+Te,a[2]=Q-Se,a[3]=0,a[4]=q-Te,a[5]=1-N-oe,a[6]=ne+me,a[7]=0,a[8]=Q+Se,a[9]=ne-me,a[10]=1-N-Z,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Ht=ye;function ci(){var a=new O(3);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Wt(a){var n=new O(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n}function $t(a){var n=a[0],o=a[1],d=a[2];return Math.sqrt(n*n+o*o+d*d)}function Dt(a,n,o){var d=new O(3);return d[0]=a,d[1]=n,d[2]=o,d}function Ft(a,n,o,d){return a[0]=n,a[1]=o,a[2]=d,a}function vt(a,n,o){return a[0]=n[0]+o[0],a[1]=n[1]+o[1],a[2]=n[2]+o[2],a}function wi(a,n,o){return a[0]=n[0]-o[0],a[1]=n[1]-o[1],a[2]=n[2]-o[2],a}function Qi(a,n,o){return a[0]=n[0]*o[0],a[1]=n[1]*o[1],a[2]=n[2]*o[2],a}function wn(a,n,o){return a[0]=Math.min(n[0],o[0]),a[1]=Math.min(n[1],o[1]),a[2]=Math.min(n[2],o[2]),a}function qn(a,n,o){return a[0]=Math.max(n[0],o[0]),a[1]=Math.max(n[1],o[1]),a[2]=Math.max(n[2],o[2]),a}function Fn(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a[2]=n[2]*o,a}function mr(a,n,o,d){return a[0]=n[0]+o[0]*d,a[1]=n[1]+o[1]*d,a[2]=n[2]+o[2]*d,a}function Sr(a,n){var o=n[0]-a[0],d=n[1]-a[1],g=n[2]-a[2];return Math.sqrt(o*o+d*d+g*g)}function Hr(a,n){var o=n[0]-a[0],d=n[1]-a[1],g=n[2]-a[2];return o*o+d*d+g*g}function ti(a){var n=a[0],o=a[1],d=a[2];return n*n+o*o+d*d}function sn(a,n){return a[0]=-n[0],a[1]=-n[1],a[2]=-n[2],a}function Gi(a,n){var o=n[0],d=n[1],g=n[2],w=o*o+d*d+g*g;return w>0&&(w=1/Math.sqrt(w)),a[0]=n[0]*w,a[1]=n[1]*w,a[2]=n[2]*w,a}function gn(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]}function nr(a,n,o){var d=n[0],g=n[1],w=n[2],S=o[0],A=o[1],L=o[2];return a[0]=g*L-w*A,a[1]=w*S-d*L,a[2]=d*A-g*S,a}function Ur(a,n,o,d){var g=n[0],w=n[1],S=n[2];return a[0]=g+d*(o[0]-g),a[1]=w+d*(o[1]-w),a[2]=S+d*(o[2]-S),a}function St(a,n,o){var d=n[0],g=n[1],w=n[2],S=o[3]*d+o[7]*g+o[11]*w+o[15];return a[0]=(o[0]*d+o[4]*g+o[8]*w+o[12])/(S=S||1),a[1]=(o[1]*d+o[5]*g+o[9]*w+o[13])/S,a[2]=(o[2]*d+o[6]*g+o[10]*w+o[14])/S,a}function Gt(a,n,o){var d=n[0],g=n[1],w=n[2];return a[0]=d*o[0]+g*o[3]+w*o[6],a[1]=d*o[1]+g*o[4]+w*o[7],a[2]=d*o[2]+g*o[5]+w*o[8],a}function Ai(a,n,o){var d=o[0],g=o[1],w=o[2],S=o[3],A=n[0],L=n[1],N=n[2],q=g*N-w*L,Z=w*A-d*N,Q=d*L-g*A;return a[0]=A+S*(q+=q)+g*(Q+=Q)-w*(Z+=Z),a[1]=L+S*Z+w*q-d*Q,a[2]=N+S*Q+d*Z-g*q,a}function hn(a){return a[0]=0,a[1]=0,a[2]=0,a}function Ui(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]}var pt=wi,Ot=Qi,vi=$t;function qi(){var a=new O(4);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function on(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a[2]=n[2]*o,a[3]=n[3]*o,a}function Hi(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=o*o+d*d+g*g+w*w;return S>0&&(S=1/Math.sqrt(S)),a[0]=o*S,a[1]=d*S,a[2]=g*S,a[3]=w*S,a}function Bt(a,n,o){var d=n[0],g=n[1],w=n[2],S=n[3];return a[0]=o[0]*d+o[4]*g+o[8]*w+o[12]*S,a[1]=o[1]*d+o[5]*g+o[9]*w+o[13]*S,a[2]=o[2]*d+o[6]*g+o[10]*w+o[14]*S,a[3]=o[3]*d+o[7]*g+o[11]*w+o[15]*S,a}function Ii(){var a=new O(4);return O!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function qt(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Ne(a,n,o){o*=.5;var d=n[0],g=n[1],w=n[2],S=n[3],A=Math.sin(o),L=Math.cos(o);return a[0]=d*L+S*A,a[1]=g*L+w*A,a[2]=w*L-g*A,a[3]=S*L-d*A,a}function Ge(a,n,o){o*=.5;var d=n[0],g=n[1],w=n[2],S=n[3],A=Math.sin(o),L=Math.cos(o);return a[0]=d*L-w*A,a[1]=g*L+S*A,a[2]=w*L+d*A,a[3]=S*L-g*A,a}ci(),qi();var Ke,At,jt,bi=Hi,gi=(Ke=ci(),At=Dt(1,0,0),jt=Dt(0,1,0),function(a,n,o){var d=gn(n,o);return d<-.999999?(nr(Ke,At,n),vi(Ke)<1e-6&&nr(Ke,jt,n),Gi(Ke,Ke),(function(g,w,S){S*=.5;var A=Math.sin(S);g[0]=A*w[0],g[1]=A*w[1],g[2]=A*w[2],g[3]=Math.cos(S)})(a,Ke,Math.PI),a):d>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(nr(Ke,n,o),a[0]=Ke[0],a[1]=Ke[1],a[2]=Ke[2],a[3]=1+d,bi(a,a))});function ii(){var a=new O(2);return O!=Float32Array&&(a[0]=0,a[1]=0),a}function Ci(a,n){var o=new O(2);return o[0]=a,o[1]=n,o}function un(a,n,o){return a[0]=n,a[1]=o,a}function nn(a,n,o){return a[0]=n[0]+o[0],a[1]=n[1]+o[1],a}function Zn(a,n,o){return a[0]=n[0]-o[0],a[1]=n[1]-o[1],a}function fr(a,n,o){return a[0]=n[0]*o,a[1]=n[1]*o,a}function Gr(a){var n=a[0],o=a[1];return Math.sqrt(n*n+o*o)}function xo(a,n){var o=n[0],d=n[1],g=o*o+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=n[0]*g,a[1]=n[1]*g,a}function Js(a,n){return a[0]*n[0]+a[1]*n[1]}Ii(),Ii(),$();var mi,bs,al=Zn;function is(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}ii();var Hs=(function(){if(bs)return mi;function a(n,o,d,g){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(g-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=d,this.p2y=g}return bs=1,mi=a,a.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,o){if(o===void 0&&(o=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,g=0;g<8;g++){var w=this.sampleCurveX(d)-n;if(Math.abs(w)<o)return d;var S=this.sampleCurveDerivativeX(d);if(Math.abs(S)<1e-6)break;d-=w/S}var A=0,L=1;for(d=n,g=0;g<20&&(w=this.sampleCurveX(d),!(Math.abs(w-n)<o));g++)n>w?A=d:L=d,d=.5*(L-A)+A;return d},solve:function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))}},mi})(),ll=is(Hs);function yi(a,n){this.x=a,this.y=n}function Ao(a,n){if(Array.isArray(a)){if(!Array.isArray(n)||a.length!==n.length)return!1;for(let o=0;o<a.length;o++)if(!Ao(a[o],n[o]))return!1;return!0}if(typeof a=="object"&&a!==null&&n!==null){if(typeof n!="object"||Object.keys(a).length!==Object.keys(n).length)return!1;for(const o in a)if(!Ao(a[o],n[o]))return!1;return!0}return a===n}yi.prototype={clone(){return new yi(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,n){return this.clone()._rotateAround(a,n)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const n=a.x-this.x,o=a.y-this.y;return n*n+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult(a){const n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const n=Math.cos(a),o=Math.sin(a),d=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=d,this},_rotateAround(a,n){const o=Math.cos(a),d=Math.sin(a),g=n.y+d*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-d*(this.y-n.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:yi},yi.convert=function(a){if(a instanceof yi)return a;if(Array.isArray(a))return new yi(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new yi(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const Bo=Math.PI/180,sa=180/Math.PI;function ns(a){return a*Bo}function Ja(a){return a*sa}const Mn=[[0,0],[1,0],[1,1],[0,1]];function Qa(a){if(a<=0)return 0;if(a>=1)return 1;const n=a*a,o=n*a;return 4*(a<.5?o:3*(a-n)+o-.75)}function gl(a,n,o,d){const g=new ll(a,n,o,d);return function(w){return g.solve(w)}}const Nt=gl(.25,.1,.25,1);function we(a,n,o){return Math.min(o,Math.max(n,a))}function Ie(a,n,o){return(o=we((o-a)/(n-a),0,1))*o*(3-2*o)}function qe(a,n,o){const d=o-n,g=((a-n)%d+d)%d+n;return g===n?o:g}function ot(a,n,o){if(!a.length)return o(null,[]);let d=a.length;const g=new Array(a.length);let w=null;a.forEach(((S,A)=>{n(S,((L,N)=>{L&&(w=L),g[A]=N,--d==0&&o(w,g)}))}))}let ft=1;function Ct(){return ft++}function Jt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function _t(a,n){a.forEach((o=>{n[o]&&(n[o]=n[o].bind(n))}))}function Qt(a,n,o){const d={};for(const g in a)d[g]=n.call(this,a[g],g,a);return d}function Ri(a,n,o){const d={};for(const g in a)n.call(this,a[g],g,a)&&(d[g]=a[g]);return d}function xi(a){return Array.isArray(a)?a.map(xi):typeof a=="object"&&a?Qt(a,xi):a}function yn(a,n){for(let o=0;o<a.length;o++)if(n.indexOf(a[o])>=0)return!0;return!1}const $n={};function mn(a){$n[a]||(typeof console<"u"&&console.warn(a),$n[a]=!0)}function Tr(a,n,o){return(o.y-a.y)*(n.x-a.x)>(n.y-a.y)*(o.x-a.x)}function rr(a){let n=0;for(let o,d,g=0,w=a.length,S=w-1;g<w;S=g++)o=a[g],d=a[S],n+=(d.x-o.x)*(o.y+d.y);return n}function jn([a,n,o]){const d=ns(n+90),g=ns(o);return{x:a*Math.cos(d)*Math.sin(g),y:a*Math.sin(d)*Math.sin(g),z:a*Math.cos(g),azimuthal:n,polar:o}}function Kr(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function io(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,d,g,w)=>{const S=g||w;return n[d]=!S||S.toLowerCase(),""})),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let No=null;function oo(a,n){return[a[4*n],a[4*n+1],a[4*n+2],a[4*n+3]]}function po(a,n,o,d){for(;n<o;){const g=n+o>>1;a[g]<d?n=g+1:o=g}return n}function go(a,n,o,d){for(;n<o;){const g=n+o>>1;a[g]<=d?n=g+1:o=g}return n}function Wr(a){return a>0?1/(1.001-a):1+a}function ao(a){return a>0?1-1/(1.001-a):-a}function Br(a,n,o){return(a-n.min)*(o.max-o.min)/(n.max-n.min)+o.min}const qr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!qr.API_URL)return null;try{const a=new URL(qr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Po(a){return qr.API_URL_REGEX.test(a)}function Ra(a){return qr.API_SPRITE_REGEX.test(a)}let _l,Hl,dd,wa,hc,yl;function su(){return _l==null&&(_l=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),_l}const Ta={now:()=>wa!==void 0?wa:performance.now(),setNow(a){wa=a},restoreNow(){wa=void 0},frame(a){const n=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(a,n=0){const{width:o,height:d}=a;hc||(hc=document.createElement("canvas"));const g=hc.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(o>hc.width||d>hc.height)&&(hc.width=o,hc.height=d),g.clearRect(-n,-n,o+2*n,d+2*n),g.drawImage(a,0,0,o,d),g.getImageData(-n,-n,o+2*n,d+2*n)},resolveURL:a=>(Hl||(Hl=document.createElement("a")),Hl.href=a,Hl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(dd==null&&(dd=window.matchMedia("(prefers-reduced-motion: reduce)")),dd.matches)},hasCanvasFingerprintNoise(){if(yl!==void 0)return yl;if(!su())return yl=!1,!1;const a=new OffscreenCanvas(85,1),n=a.getContext("2d",{willReadFrequently:!0});let o=0;for(let g=0;g<a.width;++g)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(g,0,1,1);const d=n.getImageData(0,0,a.width,a.height);o=0;for(let g=0;g<d.data.length;++g)if(g%4!=3&&o++!==d.data[g])return yl=!0,!0;return yl=!1,!1}};function Zd(a,n){const o=a.indexOf("?");if(o<0)return`${a}?${new URLSearchParams(n).toString()}`;const d=new URLSearchParams(a.slice(o));for(const g in n)d.set(g,n[g]);return`${a.slice(0,o)}?${d.toString()}`}function Xu(a,n={persistentParams:[]}){const o=a.indexOf("?");if(o<0)return a;const d=new URLSearchParams,g=new URLSearchParams(a.slice(o));for(const S of n.persistentParams){const A=g.get(S);A&&d.set(S,A)}const w=d.toString();return`${a.slice(0,o)}${w.length>0?`?${w}`:""}`}const Xd="mapbox-tiles";let Op=500,Dh=50;const Yd=["language","worldview","jobid"];let bc,ja;function Wl(){try{return caches}catch{}}function as(){const a=Wl();a&&bc==null&&(bc=a.open(Xd))}let wc=1/0;const Yu={supported:!1,testSupport:function(a){!vl&&cl&&(Vo?Zo(a):Ku=a)}};let Ku,cl,vl=!1,Vo=!1;const Jr=typeof self<"u"?self:{};function Zo(a){const n=a.createTexture();a.bindTexture(a.TEXTURE_2D,n);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,cl),a.isContextLost())return;Yu.supported=!0}catch{}a.deleteTexture(n),vl=!0}Jr.document&&(cl=Jr.document.createElement("img"),cl.onload=function(){Ku&&Zo(Ku),Ku=null,Vo=!0},cl.onerror=function(){vl=!0,Ku=null},cl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ou={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ou);class Ko extends Error{constructor(n,o,d){o===401&&Po(d)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zl=Kr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,el=function(a,n){if(!(/^file:/.test(o=a.url)||/^file:/.test(Zl())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(d,g){const w=new AbortController,S=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Zl(),referrerPolicy:d.referrerPolicy,signal:w.signal});let A=!1,L=!1;const N=(q=S.url).indexOf("sku=")>0&&Po(q);var q;d.type==="json"&&S.headers.set("Accept","application/json");const Z=(ne,oe,me)=>{if(L)return;if(ne&&ne.message!=="SecurityError"&&mn(ne.toString()),oe&&me)return Q(oe);const Se=Date.now();fetch(S).then((Te=>{if(Te.ok){const Le=N?Te.clone():null;return Q(Te,Le,Se)}return g(new Ko(Te.statusText,Te.status,d.url))})).catch((Te=>{Te.name!=="AbortError"&&g(new Error(`${Te.message} ${d.url}`))}))},Q=(ne,oe,me)=>{(d.type==="arrayBuffer"?ne.arrayBuffer():d.type==="json"?ne.json():ne.text()).then((Se=>{L||(oe&&me&&(function(Te,Le,Re){if(as(),bc==null)return;const Ue=io(Le.headers.get("Cache-Control")||"");if(Ue["no-store"])return;const rt={status:Le.status,statusText:Le.statusText,headers:new Headers};Le.headers.forEach(((yt,Et)=>rt.headers.set(Et,yt))),Ue["max-age"]&&rt.headers.set("Expires",new Date(Re+1e3*Ue["max-age"]).toUTCString());const Qe=rt.headers.get("Expires");if(!Qe||new Date(Qe).getTime()-Re<42e4)return;let ht=Xu(Te.url,{persistentParams:Yd});if(Le.status===206){const yt=Te.headers.get("Range");if(!yt)return;rt.status=200,ht=Zd(ht,{range:yt})}(function(yt,Et){if(ja===void 0)try{new Response(new ReadableStream),ja=!0}catch{ja=!1}ja?Et(yt.body):yt.blob().then(Et).catch((ai=>mn(ai.message)))})(Le,(yt=>{const Et=new Response((ai=Le.status)!==200&&ai!==404&&[101,103,204,205,304].includes(ai)?null:yt,rt);var ai;as(),bc?.then((kt=>kt.put(ht,Et))).catch((kt=>mn(kt.message)))}))})(S,oe,me),A=!0,g(null,Se,ne.headers))})).catch((Se=>{L||g(new Error(Se.message))}))};return N?(function(ne,oe){if(as(),bc==null)return oe(null);bc.then((me=>{let Se=Xu(ne.url,{persistentParams:Yd});const Te=ne.headers.get("Range");Te&&(Se=Zd(Se,{range:Te})),me.match(Se).then((Le=>{const Re=(function(Ue){if(!Ue)return!1;const rt=new Date(Ue.headers.get("Expires")||0),Qe=io(Ue.headers.get("Cache-Control")||"");return Number(rt)>Date.now()&&!Qe["no-cache"]})(Le);me.delete(Se).catch(oe),Re&&me.put(Se,Le.clone()).catch(oe),oe(null,Le,Re)})).catch(oe)})).catch(oe)})(S,Z):Z(null,null),{cancel:()=>{L=!0,A||w.abort()}}})(a,n);if(Kr(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,n,void 0,!0)}var o;return(function(d,g){const w=new XMLHttpRequest;w.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(w.responseType="arraybuffer");for(const S in d.headers)w.setRequestHeader(S,d.headers[S]);return d.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=d.credentials==="include",w.onerror=()=>{g(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let S=w.response;if(d.type==="json")try{S=JSON.parse(w.response)}catch(L){return g(L)}const A=new Headers;w.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((L=>{const N=L.split(": "),q=N.shift(),Z=N.join(": ");A.append(q,Z)})),g(null,S,A)}else g(new Ko(w.statusText,w.status,d.url))},w.send(d.body),{cancel:()=>w.abort()}})(a,n)},Tc=function(a,n){return el(Object.assign(a,{type:"arrayBuffer"}),n)};function fd(a){const n=document.createElement("a");return n.href=a,n.protocol===location.protocol&&n.host===location.host}const za="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Iu,$r;Iu=[],$r=0;const Kd=function(a,n){if(Yu.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),$r>=qr.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:a,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Iu.push(w),w}$r++;let o=!1;const d=()=>{if(!o)for(o=!0,$r--;Iu.length&&$r<qr.MAX_PARALLEL_IMAGE_REQUESTS;){const w=Iu.shift(),{requestParameters:S,callback:A,cancelled:L}=w;L||(w.cancel=Kd(S,A).cancel)}},g=Tc(a,((w,S,A)=>{d(),w?n(w):S&&(self.createImageBitmap?(function(L,N){const q=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(q).then((Z=>{N(null,Z)})).catch((Z=>{N(new Error(`Could not load image because of ${Z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(S,((L,N)=>n(L,N,A))):(function(L,N){const q=new Image;q.onload=()=>{N(null,q),URL.revokeObjectURL(q.src),q.onload=null,requestAnimationFrame((()=>{q.src=za}))},q.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new Blob([new Uint8Array(L)],{type:"image/png"});q.src=L.byteLength?URL.createObjectURL(Z):za})(S,((L,N)=>n(L,N,A))))}));return{cancel:()=>{g.cancel(),d()}}};var Xl,pd,Ju,Lh={exports:{}},Jd={exports:{}},Cu={exports:{}},jo=(function(){if(Ju)return Lh.exports;Ju=1;var a=(Xl||(Xl=1,Jd.exports=function(o,d){var g,w,S,A,L,N,q,Z;for(w=o.length-(g=3&o.length),S=d,L=3432918353,N=461845907,Z=0;Z<w;)q=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,S=27492+(65535&(A=5*(65535&(S=(S^=q=(65535&(q=(q=(65535&q)*L+(((q>>>16)*L&65535)<<16)&4294967295)<<15|q>>>17))*N+(((q>>>16)*N&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(q=0,g){case 3:q^=(255&o.charCodeAt(Z+2))<<16;case 2:q^=(255&o.charCodeAt(Z+1))<<8;case 1:S^=q=(65535&(q=(q=(65535&(q^=255&o.charCodeAt(Z)))*L+(((q>>>16)*L&65535)<<16)&4294967295)<<15|q>>>17))*N+(((q>>>16)*N&65535)<<16)&4294967295}return S^=o.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}),Jd.exports),n=(pd||(pd=1,Cu.exports=function(o,d){for(var g,w=o.length,S=d^w,A=0;w>=4;)g=1540483477*(65535&(g=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24))+((1540483477*(g>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),w-=4,++A;switch(w){case 3:S^=(255&o.charCodeAt(A+2))<<16;case 2:S^=(255&o.charCodeAt(A+1))<<8;case 1:S=1540483477*(65535&(S^=255&o.charCodeAt(A)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}),Cu.exports);return Lh.exports=a,Lh.exports.murmur3=a,Lh.exports.murmur2=n,Lh.exports})(),Rh=is(jo);class Cs{constructor(n,...o){Object.assign(this,o[0]||{}),this.type=n}}class ms extends Cs{constructor(n,o={}){super("error",Object.assign({error:n},o))}}function md(a,n,o){o[a]&&o[a].indexOf(n)!==-1||(o[a]=o[a]||[],o[a].push(n))}function js(a,n,o){if(o&&o[a]){const d=o[a].indexOf(n);d!==-1&&o[a].splice(d,1)}}class Au{on(n,o){return this._listeners=this._listeners||{},md(n,o,this._listeners),this}off(n,o){return js(n,o,this._listeners),js(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},md(n,o,this._oneTimeListeners),this):new Promise((d=>{this.once(n,d)}))}fire(n,o){const d=typeof n=="string"?new Cs(n,o):n,g=d.type;if(this.listens(g)){d.target=this;const w=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const L of w)L.call(this,d);const S=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const L of S)js(g,L,this._oneTimeListeners),L.call(this,d);const A=this._eventedParent;if(A){const L=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(d,L),A.fire(d)}}else d instanceof ms&&console.error(d.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}class Jo{constructor(n){typeof n=="string"?this.name=n:(this.name=n.name,this.iconsetId=n.iconsetId)}static from(n){return new Jo(n)}static toString(n){return n.iconsetId?`${n.name}${n.iconsetId}`:n.name}static parse(n){const[o,d]=n.split("");return new Jo({name:o,iconsetId:d})}static isEqual(n,o){return n.name===o.name&&n.iconsetId===o.iconsetId}toString(){return Jo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var zh,au={},Uc=(function(){if(zh)return au;zh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(w){return(w=Math.round(w))<0?0:w>255?255:w}function o(w){return n(w[w.length-1]==="%"?parseFloat(w)/100*255:parseInt(w))}function d(w){return(S=w[w.length-1]==="%"?parseFloat(w)/100:parseFloat(w))<0?0:S>1?1:S;var S}function g(w,S,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?w+(S-w)*A*6:2*A<1?S:3*A<2?w+(S-w)*(2/3-A)*6:w}try{au.parseCSSColor=function(w){var S,A=w.replace(/ /g,"").toLowerCase();if(A in a)return a[A].slice();if(A[0]==="#")return A.length===4?(S=parseInt(A.substr(1),16))>=0&&S<=4095?[(3840&S)>>4|(3840&S)>>8,240&S|(240&S)>>4,15&S|(15&S)<<4,1]:null:A.length===7&&(S=parseInt(A.substr(1),16))>=0&&S<=16777215?[(16711680&S)>>16,(65280&S)>>8,255&S,1]:null;var L=A.indexOf("("),N=A.indexOf(")");if(L!==-1&&N+1===A.length){var q=A.substr(0,L),Z=A.substr(L+1,N-(L+1)).split(","),Q=1;switch(q){case"rgba":if(Z.length!==4)return null;Q=d(Z.pop());case"rgb":return Z.length!==3?null:[o(Z[0]),o(Z[1]),o(Z[2]),Q];case"hsla":if(Z.length!==4)return null;Q=d(Z.pop());case"hsl":if(Z.length!==3)return null;var ne=(parseFloat(Z[0])%360+360)%360/360,oe=d(Z[1]),me=d(Z[2]),Se=me<=.5?me*(oe+1):me+oe-me*oe,Te=2*me-Se;return[n(255*g(Te,Se,ne+1/3)),n(255*g(Te,Se,ne)),n(255*g(Te,Se,ne-1/3)),Q];default:return null}}return null}}catch{}return au})();class ps{constructor(n,o,d,g=1){this.r=n,this.g=o,this.b=d,this.a=g}static parse(n){if(!n)return;if(n instanceof ps)return n;if(typeof n!="string")return;const o=Uc.parseCSSColor(n);return o?new ps(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[n,o,d,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*o)},${Math.round(255*d)},${g})`}toNonPremultipliedRenderColor(n){const{r:o,g:d,b:g,a:w}=this;return new sy(n,o,d,g,w)}toPremultipliedRenderColor(n){const{r:o,g:d,b:g,a:w}=this;return new Fg(n,o*w,d*w,g*w,w)}clone(){return new ps(this.r,this.g,this.b,this.a)}}class km{constructor(n,o,d,g,w,S=!1){if(this.premultiplied=!1,this.premultiplied=S,n){const A=n.image.height,L=A*A;this.premultiplied?(o=w===0?0:o/w*(A-1),d=w===0?0:d/w*(A-1),g=w===0?0:g/w*(A-1)):(o*=A-1,d*=A-1,g*=A-1);const N=Math.floor(o),q=Math.floor(d),Z=Math.floor(g),Q=Math.ceil(o),ne=Math.ceil(d),oe=Math.ceil(g),me=o-N,Se=d-q,Te=g-Z,Le=n.image.data,Re=4*(N+q*L+Z*A),Ue=4*(N+q*L+oe*A),rt=4*(N+ne*L+Z*A),Qe=4*(N+ne*L+oe*A),ht=4*(Q+q*L+Z*A),yt=4*(Q+q*L+oe*A),Et=4*(Q+ne*L+Z*A),ai=4*(Q+ne*L+oe*A);if(Re<0||ai>=Le.length)throw new Error("out of range");this.r=Gn(Gn(Gn(Le[Re],Le[Ue],Te),Gn(Le[rt],Le[Qe],Te),Se),Gn(Gn(Le[ht],Le[yt],Te),Gn(Le[Et],Le[ai],Te),Se),me)/255*(this.premultiplied?w:1),this.g=Gn(Gn(Gn(Le[Re+1],Le[Ue+1],Te),Gn(Le[rt+1],Le[Qe+1],Te),Se),Gn(Gn(Le[ht+1],Le[yt+1],Te),Gn(Le[Et+1],Le[ai+1],Te),Se),me)/255*(this.premultiplied?w:1),this.b=Gn(Gn(Gn(Le[Re+2],Le[Ue+2],Te),Gn(Le[rt+2],Le[Qe+2],Te),Se),Gn(Gn(Le[ht+2],Le[yt+2],Te),Gn(Le[Et+2],Le[ai+2],Te),Se),me)/255*(this.premultiplied?w:1),this.a=w}else this.r=o,this.g=d,this.b=g,this.a=w}toArray(){const{r:n,g:o,b:d,a:g}=this;return[255*n,255*o,255*d,g]}toHslaArray(){let{r:n,g:o,b:d,a:g}=this;if(this.premultiplied){if(g===0)return[0,0,0,0];const oe=1/g;n*=oe,o*=oe,d*=oe}const w=Math.min(Math.max(n,0),1),S=Math.min(Math.max(o,0),1),A=Math.min(Math.max(d,0),1),L=Math.min(w,S,A),N=Math.max(w,S,A),q=N-L,Z=.5*(L+N);if(q===0)return[0,0,100*Z,g];const Q=Z>.5?q/(2-N-L):q/(N+L);let ne;switch(N){case w:ne=60*((S-A)/q+(S<A?6:0));break;case S:ne=60*((A-w)/q+2);break;default:ne=60*((w-S)/q+4)}return[ne,100*Q,100*Z,g]}toArray01(){const{r:n,g:o,b:d,a:g}=this;return[n,o,d,g]}toArray01Scaled(n){const{r:o,g:d,b:g}=this;return[o*n,d*n,g*n]}toArray01Linear(){const{r:n,g:o,b:d,a:g}=this;return[Math.pow(n,2.2),Math.pow(o,2.2),Math.pow(d,2.2),g]}}class sy extends km{constructor(n,o,d,g,w){super(n,o,d,g,w,!1)}}class Fg extends km{constructor(n,o,d,g,w){super(n,o,d,g,w,!0)}}function Gn(a,n,o){return a*(1-o)+n*o}function lu(a,n,o){return a.map(((d,g)=>Gn(d,n[g],o)))}ps.black=new ps(0,0,0,1),ps.white=new ps(1,1,1,1),ps.transparent=new ps(0,0,0,0),ps.red=new ps(1,0,0,1),ps.blue=new ps(0,0,1,1);var Xo=Object.freeze({__proto__:null,array:lu,color:function(a,n,o){return new ps(Gn(a.r,n.r,o),Gn(a.g,n.g,o),Gn(a.b,n.b,o),Gn(a.a,n.a,o))},number:Gn});class Al extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class gd{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[d,g]of o)this.bindings[d]=g}concat(n){return new gd(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const dc={kind:"null"},vn={kind:"number"},Qr={kind:"string"},ws={kind:"boolean"},Yl={kind:"color"},Qu={kind:"object"},hs={kind:"value"},Qd={kind:"collator"},eh={kind:"formatted"},ef={kind:"resolvedImage"};function Ua(a,n){return{kind:"array",itemType:a,N:n}}function Mo(a){if(a.kind==="array"){const n=Mo(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const $f=[dc,vn,Qr,ws,Yl,eh,Qu,Ua(hs),ef];function ea(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!ea(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const o of $f)if(!ea(o,n))return null}}return`Expected ${Mo(a)} but found ${Mo(n)} instead.`}function Dm(a,n){return n.some((o=>o.kind===a.kind))}function th(a,n){return n.some((o=>o==="null"?a===null:o==="array"?Array.isArray(a):o==="object"?a&&!Array.isArray(a)&&typeof a=="object":o===typeof a))}function _d(a,n){return a.kind==="array"&&n.kind==="array"?a.N===n.N&&_d(a.itemType,n.itemType):a.kind===n.kind}class Oh{constructor(n,o,d){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Lm{constructor(n,o,d,g,w){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=d,this.fontStack=g,this.textColor=w}}class xl{constructor(n){this.sections=n}static fromString(n){return new xl([new Lm(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((n=>n.text.length!==0||!!n.image&&n.image.hasPrimary()))}static factory(n){return n instanceof xl?n:xl.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map((n=>n.text)).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){const g=o.image.getPrimary().id.toString();n.push(["image",g]);continue}n.push(o.text);const d={};o.fontStack&&(d["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(d["font-scale"]=o.scale),o.textColor&&(d["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),n.push(d)}return n}}class Fh{constructor(n,o={}){this.id=Jo.from(n),this.params=o.params,this.sx=o.sx||1,this.sy=o.sy||1}toString(){return JSON.stringify(this)}static parse(n){let o,d,g,w;try{({id:o,params:d,sx:g,sy:w}=JSON.parse(n)||{})}catch{return null}return o?new Fh(o,{params:d,sx:g,sy:w}):null}scaleSelf(n,o=n){return this.sx*=n,this.sy*=o,this}}class tl{constructor(n,o,d,g,w=!1){this.primaryId=Jo.from(n),this.primaryOptions=o,d&&(this.secondaryId=Jo.from(d)),this.secondaryOptions=g,this.available=w}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Fh(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Fh(this.secondaryId,this.secondaryOptions):null}static from(n){return typeof n=="string"?tl.build({name:n}):n}static build(n,o,d,g){return!n||typeof n=="object"&&!("name"in n)?null:new tl(n,d,o,g)}}function ih(a,n,o,d){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,n,o,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,n,o,d]:[a,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tf(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ps||a instanceof Oh||a instanceof xl||a instanceof tl)return!0;if(Array.isArray(a)){for(const n of a)if(!tf(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!tf(a[n]))return!1;return!0}return!1}function Oa(a){if(a===null)return dc;if(typeof a=="string")return Qr;if(typeof a=="boolean")return ws;if(typeof a=="number")return vn;if(a instanceof ps)return Yl;if(a instanceof Oh)return Qd;if(a instanceof xl)return eh;if(a instanceof tl)return ef;if(Array.isArray(a)){const n=a.length;let o;for(const d of a){const g=Oa(d);if(o){if(o===g)continue;o=hs;break}o=g}return Ua(o||hs,n)}return Qu}function Sc(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof xl||a instanceof tl||a instanceof ps?a.toString():JSON.stringify(a)}class Pu{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!tf(n[1]))return o.error("invalid value");const d=n[1];let g=Oa(d);const w=o.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new Pu(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ps?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof xl?this.value.serialize():this.value}}class da{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Rm={string:Qr,number:vn,boolean:ws,object:Qu};class cu{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let d,g=1;const w=n[0];if(w==="array"){let A,L;if(n.length>2){const N=n[1];if(typeof N!="string"||!(N in Rm)||N==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);A=Rm[N],g++}else A=hs;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);L=n[2],g++}d=Ua(A,L)}else d=Rm[w];const S=[];for(;g<n.length;g++){const A=o.parse(n[g],g,hs);if(!A)return null;S.push(A)}return new cu(d,S)}evaluate(n){for(let o=0;o<this.args.length;o++){const d=this.args[o].evaluate(n);if(!ea(this.type,Oa(d)))return d;if(o===this.args.length-1)throw new da(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${Mo(Oa(d))} but was expected to be of type ${Mo(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const d=n.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){o.push(d.kind);const g=n.N;(typeof g=="number"||this.args.length>1)&&o.push(g)}}return o.concat(this.args.map((d=>d.serialize())))}}class Mu{constructor(n){this.type=eh,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return o.error("First argument must be an image or text section.");const g=[];let w=!1;for(let S=1;S<=n.length-1;++S){const A=n[S];if(w&&typeof A=="object"&&!Array.isArray(A)){w=!1;let L=null;if(A["font-scale"]&&(L=o.parseObjectValue(A["font-scale"],S,"font-scale",vn),!L))return null;let N=null;if(A["text-font"]&&(N=o.parseObjectValue(A["text-font"],S,"text-font",Ua(Qr)),!N))return null;let q=null;if(A["text-color"]&&(q=o.parseObjectValue(A["text-color"],S,"text-color",Yl),!q))return null;const Z=g[g.length-1];Z.scale=L,Z.font=N,Z.textColor=q}else{const L=o.parse(n[S],S,hs);if(!L)return null;const N=L.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:L,scale:null,font:null,textColor:null})}}return new Mu(g)}evaluate(n){return new xl(this.sections.map((o=>{const d=o.content.evaluate(n);return _d(Oa(d),ef)?new Lm("",d,null,null,null):new Lm(Sc(d),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)})))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const d={};o.scale&&(d["font-scale"]=o.scale.serialize()),o.font&&(d["text-font"]=o.font.serialize()),o.textColor&&(d["text-color"]=o.textColor.serialize()),n.push(d)}return n}}class yr{constructor(n,o,d,g){this._imageWarnHistory={},this.type=ef,this.namePrimary=n,this.nameSecondary=o,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");let d=1;const g=[];function w(){if(d<n.length){const A=o.parse(n[d],d++,Qr);return A?(g.push({image:A,options:{}}),!0):(o.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function S(){if(d<n.length){const L=n[d];if((A=L)===null||typeof A!="object"||Array.isArray(A))return!0;const N=L.params,q=L.iconset,Z=o.concat(d);if(!N&&!q)return d++,!0;if(N){if(typeof N!="object"||N.constructor!==Object)return Z.error('Image options "params" should be an object'),!1;const Q={},ne=Z.concat(void 0,"params");for(const oe in N){if(!oe)return ne.error("Image parameter name should be non-empty"),!1;const me=ne.concat(void 0,oe).parse(N[oe],void 0,Yl,void 0,{typeAnnotation:"coerce"});if(!me)return!1;Q[oe]=me}g[g.length-1].options.params=Q}if(q){if(typeof q!="object"||q.constructor!==Object)return Z.error('Image options "iconset" should be an object'),!1;if(!q.id)return Z.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=q}return d++,!0}var A;return!0}for(let A=0;A<2;A++)if(!w()||!S())return;return new yr(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(n,o){const d={};if(o){for(const g in o)if(o[g])try{d[g]=o[g].evaluate(n)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(n){const o={name:this.namePrimary.evaluate(n),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(n),iconsetId:this.iconsetIdSecondary}:void 0,g=tl.build(o,d,this.paramsPrimary?this.evaluateParams(n,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(n,this.paramsSecondary):void 0);if(g&&n.availableImages){const w=g.getPrimary().id;if(g.available=n.availableImages.some((S=>Jo.isEqual(S,w))),g.available){const S=g.getSecondary()?g.getSecondary().id:null;S&&(g.available=n.availableImages.some((A=>Jo.isEqual(A,S))))}}return g}eachChild(n){if(n(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&n(this.paramsPrimary[o]);if(this.nameSecondary&&(n(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&n(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(n,o){const d={};if(o&&(d.iconset={id:o}),n){d.params={};for(const g in n)n[g]&&(d.params[g]=n[g].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const n=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&n.push(o)}if(this.nameSecondary&&(n.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&n.push(o)}return n}}function zn(a){return sr(a)?"string":nf(a)?"number":rf(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Gf(a)?"object":typeof a}function Gf(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function sr(a){return typeof a=="string"||a instanceof String}function nf(a){return typeof a=="number"||a instanceof Number}function rf(a){return typeof a=="boolean"||a instanceof Boolean}const pr={"to-boolean":ws,"to-color":Yl,"to-number":vn,"to-string":Qr};class nh{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const d=n[0],g=[];let w=dc;if(d==="to-array"){if(!Array.isArray(n[1]))return null;const S=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);w=Ua(o.expectedType.itemType,S)}else{if(!(S>0&&tf(n[1][0])))return null;w=Ua(Oa(n[1][0]),S)}for(let A=0;A<S;A++){const L=n[1][A];let N;if(Array.isArray(L))N=o.parse(L,void 0,w.itemType);else{const q=zn(L);if(q!==w.itemType.kind)return o.error(`Expected ${w.itemType.kind} but found ${q}.`);N=o.registry.literal.parse(["literal",L===void 0?null:L],o)}if(!N)return null;g.push(N)}}else{if((d==="to-boolean"||d==="to-string")&&n.length!==2)return o.error("Expected one argument.");w=pr[d];for(let S=1;S<n.length;S++){const A=o.parse(n[S],S,hs);if(!A)return null;g.push(A)}}return new nh(w,g)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,d;for(const g of this.args){if(o=g.evaluate(n),d=null,o instanceof ps)return o;if(typeof o=="string"){const w=n.parseColor(o);if(w)return w}else if(Array.isArray(o)&&(d=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ih(o[0],o[1],o[2],o[3]),!d))return new ps(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new da(d||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const d of this.args){if(o=d.evaluate(n),o===null)return 0;const g=Number(o);if(!isNaN(g))return g}throw new da(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?xl.fromString(Sc(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?tl.build(Sc(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map((o=>o.evaluate(n))):Sc(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Mu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yr(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((o=>{n.push(o.serialize())})),n}}const zm=["Unknown","Point","LineString","Polygon"];class yd{constructor(n,o,d){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o,this.iconImageUseTheme=d}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:d,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*o-n[0])+this.featureDistanceData.bearing[1]*(g*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=ps.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class Fl{constructor(n,o,d,g,w){this.name=n,this.type=o,this._evaluate=d,this.args=g,this._overloadIndex=w}evaluate(n){if(!this._evaluate){const o=Fl.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((n=>n.serialize())))}static parse(n,o){const d=n[0],g=Fl.definitions[d];if(!g)return o.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,A=[];let L=null,N=-1;for(const[q,Z]of S){if(Array.isArray(q)&&q.length!==n.length-1)continue;A.push(q),N++,L=new Jl(o.registry,o.path,null,o.scope,void 0,o._scope,o.options,o.iconImageUseTheme);const Q=[];let ne=!1;for(let oe=1;oe<n.length;oe++){const me=n[oe],Se=Array.isArray(q)?q[oe-1]:q.type,Te=L.parse(me,1+Q.length,Se);if(!Te){ne=!0;break}Q.push(Te)}if(!ne)if(Array.isArray(q)&&q.length!==Q.length)L.error(`Expected ${q.length} arguments, but found ${Q.length} instead.`);else{for(let oe=0;oe<Q.length;oe++){const me=Array.isArray(q)?q[oe]:q.type,Se=Q[oe];L.concat(oe+1).checkSubtype(me,Se.type)}if(L.errors.length===0)return new Fl(d,w,Z,Q,N)}}if(A.length===1)o.errors.push(...L.errors);else{const q=(A.length?A:S.map((([Q])=>Q))).map(qf).join(" | "),Z=[];for(let Q=1;Q<n.length;Q++){const ne=o.parse(n[Q],1+Z.length);if(!ne)return null;Z.push(Mo(ne.type))}o.error(`Expected arguments of type ${q}, but found (${Z.join(", ")}) instead.`)}return null}static register(n,o){Fl.definitions=o;for(const d in o)n[d]=Fl}}function qf(a){return Array.isArray(a)?`(${a.map(Mo).join(", ")})`:`(${Mo(a.type)}...)`}class $a{constructor(n,o,d){this.type=Qd,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return o.error("Collator options argument must be an object.");const g=d["case-sensitive"]===void 0?o.parse(!1,1,ws):o.parseObjectValue(d["case-sensitive"],1,"case-sensitive",ws);if(!g)return null;const w=d["diacritic-sensitive"]===void 0?o.parse(!1,1,ws):o.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",ws);if(!w)return null;let S=null;return d.locale&&(S=o.parseObjectValue(d.locale,1,"locale",Qr),!S)?null:new $a(g,w,S)}evaluate(n){return new Oh(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function sf(a,n,o=0,d=a.length-1,g=Hf){for(;d>o;){if(d-o>600){const L=d-o+1,N=n-o+1,q=Math.log(L),Z=.5*Math.exp(2*q/3),Q=.5*Math.sqrt(q*Z*(L-Z)/L)*(N-L/2<0?-1:1);sf(a,n,Math.max(o,Math.floor(n-N*Z/L+Q)),Math.min(d,Math.floor(n+(L-N)*Z/L+Q)),g)}const w=a[n];let S=o,A=d;for(il(a,o,n),g(a[d],w)>0&&il(a,o,d);S<A;){for(il(a,S,A),S++,A--;g(a[S],w)<0;)S++;for(;g(a[A],w)>0;)A--}g(a[o],w)===0?il(a,o,A):(A++,il(a,A,d)),A<=n&&(o=A+1),n<=A&&(d=A-1)}}function il(a,n,o){const d=a[n];a[n]=a[o],a[o]=d}function Hf(a,n){return a<n?-1:a>n?1:0}function rh(a){let n=0;for(let o,d,g=0,w=a.length,S=w-1;g<w;S=g++)o=a[g],d=a[S],n+=(d.x-o.x)*(o.y+d.y);return n}function Ec(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function of(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function Om(a,n,o){const d=a[0]-n[0],g=a[1]-n[1],w=a[0]-o[0],S=a[1]-o[1];return d*S-w*g==0&&d*w<=0&&g*S<=0}function uu(a,n,o=!1){let d=!1;for(let A=0,L=n.length;A<L;A++){const N=n[A];for(let q=0,Z=N.length,Q=Z-1;q<Z;Q=q++){const ne=N[Q],oe=N[q];if(Om(a,ne,oe))return o;(w=ne)[1]>(g=a)[1]!=(S=oe)[1]>g[1]&&g[0]<(S[0]-w[0])*(g[1]-w[1])/(S[1]-w[1])+w[0]&&(d=!d)}}var g,w,S;return d}function af(a,n,o,d){const g=d[0]-o[0],w=d[1]-o[1],S=(a[0]-o[0])*w-g*(a[1]-o[1]),A=(n[0]-o[0])*w-g*(n[1]-o[1]);return S>0&&A<0||S<0&&A>0}function Fp(a,n,o,d){return(g=[d[0]-o[0],d[1]-o[1]])[0]*(w=[n[0]-a[0],n[1]-a[1]])[1]-g[1]*w[0]!=0&&!(!af(a,n,o,d)||!af(o,d,a,n));var g,w}function sh(a){const n=new yi(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new yi(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of a[0])n.x>d.x&&(n.x=d.x),n.y>d.y&&(n.y=d.y),o.x<d.x&&(o.x=d.x),o.y<d.y&&(o.y=d.y);return{min:n,max:o}}const vd=8192;function f0(a,n){const o=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(o*g*vd),Math.round(d*g*vd)]}function Fm(a,n){for(let o=0;o<n.length;o++)if(uu(a,n[o]))return!0;return!1}function p0(a,n,o){for(const d of o)for(let g=0,w=d.length,S=w-1;g<w;S=g++)if(Fp(a,n,d[S],d[g]))return!0;return!1}function _o(a,n){for(let o=0;o<a.length;++o)if(!uu(a[o],n))return!1;for(let o=0;o<a.length-1;++o)if(p0(a[o],a[o+1],n))return!1;return!0}function Bp(a,n){for(let o=0;o<n.length;o++)if(_o(a,n[o]))return!0;return!1}function Wf(a,n,o){const d=[];for(let g=0;g<a.length;g++){const w=[];for(let S=0;S<a[g].length;S++){const A=f0(a[g][S],o);Ec(n,A),w.push(A)}d.push(w)}return d}function ku(a,n,o){const d=[];for(let g=0;g<a.length;g++){const w=Wf(a[g],n,o);d.push(w)}return d}function Bm(a,n,o,d){if(a[0]<o[0]||a[0]>o[2]){const g=.5*d;let w=a[0]-o[0]>g?-d:o[0]-a[0]>g?d:0;w===0&&(w=a[0]-o[2]>g?-d:o[2]-a[0]>g?d:0),a[0]+=w}Ec(n,a)}function xd(a,n,o,d){const g=Math.pow(2,d.z)*vd,w=[d.x*vd,d.y*vd],S=[];if(!a)return S;for(const A of a)for(const L of A){const N=[L.x+w[0],L.y+w[1]];Bm(N,n,o,g),S.push(N)}return S}function bd(a,n,o,d){const g=Math.pow(2,d.z)*vd,w=[d.x*vd,d.y*vd],S=[];if(!a)return S;for(const L of a){const N=[];for(const q of L){const Z=[q.x+w[0],q.y+w[1]];Ec(n,Z),N.push(Z)}S.push(N)}if(n[2]-n[0]<=g/2){(A=n)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const L of S)for(const N of L)Bm(N,n,o,g)}var A;return S}class $c{constructor(n,o){this.type=ws,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(tf(n[1])){const d=n[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const w=d.features[g].geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new $c(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new $c(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new $c(d,d)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(o,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=o.canonicalID();if(!S)return!1;if(d.type==="Polygon"){const A=Wf(d.coordinates,w,S),L=xd(o.geometry(),g,w,S);if(!of(g,w))return!1;for(const N of L)if(!uu(N,A))return!1}if(d.type==="MultiPolygon"){const A=ku(d.coordinates,w,S),L=xd(o.geometry(),g,w,S);if(!of(g,w))return!1;for(const N of L)if(!Fm(N,A))return!1}return!0})(n,this.geometries);if(n.geometryType()==="LineString")return(function(o,d){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=o.canonicalID();if(!S)return!1;if(d.type==="Polygon"){const A=Wf(d.coordinates,w,S),L=bd(o.geometry(),g,w,S);if(!of(g,w))return!1;for(const N of L)if(!_o(N,A))return!1}if(d.type==="MultiPolygon"){const A=ku(d.coordinates,w,S),L=bd(o.geometry(),g,w,S);if(!of(g,w))return!1;for(const N of L)if(!Bp(N,A))return!1}return!0})(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Kl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Gc=1/298.257223563,Bg=Gc*(2-Gc),wd=Math.PI/180;class hu{static fromTile(n,o,d){const g=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),w=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/wd;return new hu(w,d)}static get units(){return Kl}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Kl[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Kl).join(", ")}`);const d=6378.137*wd*(o?Kl[o]:1),g=Math.cos(n*wd),w=1/(1-Bg*(1-g*g)),S=Math.sqrt(w);this.kx=d*S*g,this.ky=d*S*w*(1-Bg)}distance(n,o){const d=Bl(n[0]-o[0])*this.kx,g=(n[1]-o[1])*this.ky;return Math.sqrt(d*d+g*g)}bearing(n,o){const d=Bl(o[0]-n[0])*this.kx;return Math.atan2(d,(o[1]-n[1])*this.ky)/wd}destination(n,o,d){const g=d*wd;return this.offset(n,Math.sin(g)*o,Math.cos(g)*o)}offset(n,o,d){return[n[0]+o/this.kx,n[1]+d/this.ky]}lineDistance(n){let o=0;for(let d=0;d<n.length-1;d++)o+=this.distance(n[d],n[d+1]);return o}area(n){let o=0;for(let d=0;d<n.length;d++){const g=n[d];for(let w=0,S=g.length,A=S-1;w<S;A=w++)o+=Bl(g[w][0]-g[A][0])*(g[w][1]+g[A][1])*(d?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let d=0;if(o<=0)return n[0];for(let g=0;g<n.length-1;g++){const w=n[g],S=n[g+1],A=this.distance(w,S);if(d+=A,d>o)return lf(w,S,(o-(d-A))/A)}return n[n.length-1]}pointToSegmentDistance(n,o,d){let[g,w]=o,S=Bl(d[0]-g)*this.kx,A=(d[1]-w)*this.ky;if(S!==0||A!==0){const L=(Bl(n[0]-g)*this.kx*S+(n[1]-w)*this.ky*A)/(S*S+A*A);L>1?(g=d[0],w=d[1]):L>0&&(g+=S/this.kx*L,w+=A/this.ky*L)}return S=Bl(n[0]-g)*this.kx,A=(n[1]-w)*this.ky,Math.sqrt(S*S+A*A)}pointOnLine(n,o){let d=1/0,g=n[0][0],w=n[0][1],S=0,A=0;for(let L=0;L<n.length-1;L++){let N=n[L][0],q=n[L][1],Z=Bl(n[L+1][0]-N)*this.kx,Q=(n[L+1][1]-q)*this.ky,ne=0;Z===0&&Q===0||(ne=(Bl(o[0]-N)*this.kx*Z+(o[1]-q)*this.ky*Q)/(Z*Z+Q*Q),ne>1?(N=n[L+1][0],q=n[L+1][1]):ne>0&&(N+=Z/this.kx*ne,q+=Q/this.ky*ne)),Z=Bl(o[0]-N)*this.kx,Q=(o[1]-q)*this.ky;const oe=Z*Z+Q*Q;oe<d&&(d=oe,g=N,w=q,S=L,A=ne)}return{point:[g,w],index:S,t:Math.max(0,Math.min(1,A))}}lineSlice(n,o,d){let g=this.pointOnLine(d,n),w=this.pointOnLine(d,o);if(g.index>w.index||g.index===w.index&&g.t>w.t){const N=g;g=w,w=N}const S=[g.point],A=g.index+1,L=w.index;!Zf(d[A],S[0])&&A<=L&&S.push(d[A]);for(let N=A+1;N<=L;N++)S.push(d[N]);return Zf(d[L],w.point)||S.push(w.point),S}lineSliceAlong(n,o,d){let g=0;const w=[];for(let S=0;S<d.length-1;S++){const A=d[S],L=d[S+1],N=this.distance(A,L);if(g+=N,g>n&&w.length===0&&w.push(lf(A,L,(n-(g-N))/N)),g>=o)return w.push(lf(A,L,(o-(g-N))/N)),w;g>n&&w.push(L)}return w}bufferPoint(n,o){const d=o/this.ky,g=o/this.kx;return[n[0]-g,n[1]-d,n[0]+g,n[1]+d]}bufferBBox(n,o){const d=o/this.ky,g=o/this.kx;return[n[0]-g,n[1]-d,n[2]+g,n[3]+d]}insideBBox(n,o){return Bl(n[0]-o[0])>=0&&Bl(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function Zf(a,n){return a[0]===n[0]&&a[1]===n[1]}function lf(a,n,o){const d=Bl(n[0]-a[0]);return[a[0]+d*o,a[1]+(n[1]-a[1])*o]}function Bl(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class cf{constructor(n=[],o=((d,g)=>d<g?-1:d>g?1:0)){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:d}=this,g=o[n];for(;n>0;){const w=n-1>>1,S=o[w];if(d(g,S)>=0)break;o[n]=S,n=w}o[n]=g}_down(n){const{data:o,compare:d}=this,g=this.length>>1,w=o[n];for(;n<g;){let S=1+(n<<1);const A=S+1;if(A<this.length&&d(o[A],o[S])<0&&(S=A),d(o[S],w)>=0)break;o[n]=o[S],n=S}o[n]=w}}var Ji=8192;function Td(a,n){return n.dist-a.dist}const Bh=100,Np=50;function Vp(a){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==a.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==a[o])return!1;return!0}function As(a){return a[1]-a[0]+1}function qc(a,n){const o=a[1]>=a[0]&&a[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function Ng(a,n){if(a[0]>a[1])return[null,null];const o=As(a);if(n){if(o===2)return[a,null];const d=Math.floor(o/2);return[[a[0],a[0]+d],[a[0]+d,a[1]]]}{if(o===1)return[a,null];const d=Math.floor(o/2)-1;return[[a[0],a[0]+d],[a[0]+d+1,a[1]]]}}function Sd(a,n){const o=[1/0,1/0,-1/0,-1/0];if(!qc(n,a.length))return o;for(let d=n[0];d<=n[1];++d)Ec(o,a[d]);return o}function Du(a){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<a.length;++o)for(let d=0;d<a[o].length;++d)Ec(n,a[o][d]);return n}function Ed(a,n,o){if(Vp(a)||Vp(n))return NaN;let d=0,g=0;return a[2]<n[0]&&(d=n[0]-a[2]),a[0]>n[2]&&(d=a[0]-n[2]),a[1]>n[3]&&(g=a[1]-n[3]),a[3]<n[1]&&(g=n[1]-a[3]),o.distance([0,0],[d,g])}function Nm(a){return 360*a-180}function Vg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Vm(a,n){const o=Math.pow(2,n.z),d=(a.y/Ji+n.y)/o;return[Nm((a.x/Ji+n.x)/o),Vg(d)]}function jg(a,n){const o=[];for(let d=0;d<a.length;++d)o.push(Vm(a[d],n));return o}function uf(a,n,o){const d=o.pointOnLine(n,a).point;return o.distance(a,d)}function hf(a,n,o,d,g){const w=o.slice(d[0],d[1]+1);let S=1/0;for(let A=n[0];A<=n[1];++A)if((S=Math.min(S,uf(a[A],w,g)))===0)return 0;return S}function Lu(a,n,o,d,g){const w=Math.min(g.pointToSegmentDistance(a,o,d),g.pointToSegmentDistance(n,o,d)),S=Math.min(g.pointToSegmentDistance(o,a,n),g.pointToSegmentDistance(d,a,n));return Math.min(w,S)}function es(a,n,o,d,g){if(!qc(n,a.length)||!qc(d,o.length))return NaN;let w=1/0;for(let S=n[0];S<n[1];++S)for(let A=d[0];A<d[1];++A){if(Fp(a[S],a[S+1],o[A],o[A+1]))return 0;w=Math.min(w,Lu(a[S],a[S+1],o[A],o[A+1],g))}return w}function Ug(a,n,o,d,g){if(!qc(n,a.length)||!qc(d,o.length))return NaN;let w=1/0;for(let S=n[0];S<=n[1];++S)for(let A=d[0];A<=d[1];++A)if((w=Math.min(w,g.distance(a[S],o[A])))===0)return w;return w}function jm(a,n,o){if(uu(a,n,!0))return 0;let d=1/0;for(const g of n){const w=g.length;if(w<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[w-1]&&(d=Math.min(d,o.pointToSegmentDistance(a,g[w-1],g[0])))===0||(d=Math.min(d,uf(a,g,o)))===0)return d}return d}function Um(a,n,o,d){if(!qc(n,a.length))return NaN;for(let w=n[0];w<=n[1];++w)if(uu(a[w],o,!0))return 0;let g=1/0;for(let w=n[0];w<n[1];++w)for(const S of o)for(let A=0,L=S.length,N=L-1;A<L;N=A++){if(Fp(a[w],a[w+1],S[N],S[A]))return 0;g=Math.min(g,Lu(a[w],a[w+1],S[N],S[A],d))}return g}function oh(a,n){for(const o of a)for(let d=0;d<=o.length-1;++d)if(uu(o[d],n,!0))return!0;return!1}function df(a,n,o,d=1/0){const g=Du(a),w=Du(n);if(d!==1/0&&Ed(g,w,o)>=d)return d;if(of(g,w)){if(oh(a,n))return 0}else if(oh(n,a))return 0;let S=d;for(const A of a)for(let L=0,N=A.length,q=N-1;L<N;q=L++)for(const Z of n)for(let Q=0,ne=Z.length,oe=ne-1;Q<ne;oe=Q++){if(Fp(A[q],A[L],Z[oe],Z[Q]))return 0;S=Math.min(S,Lu(A[q],A[L],Z[oe],Z[Q],o))}return S}function no(a,n,o,d,g,w,S){if(w===null||S===null)return;const A=Ed(Sd(d,w),Sd(g,S),o);A<n&&a.push({dist:A,range1:w,range2:S})}function m0(a,n,o,d,g=1/0){let w=Math.min(d.distance(a[0],o[0][0]),g);if(w===0)return w;const S=new cf([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Td),A=n?Np:Bh,L=Du(o);for(;S.length;){const N=S.pop();if(N.dist>=w)continue;const q=N.range1;if(As(q)<=A){if(!qc(q,a.length))return NaN;if(n){const Z=Um(a,q,o,d);if((w=Math.min(w,Z))===0)return w}else for(let Z=q[0];Z<=q[1];++Z){const Q=jm(a[Z],o,d);if((w=Math.min(w,Q))===0)return w}}else{const Z=Ng(q,n);if(Z[0]!==null){const Q=Ed(Sd(a,Z[0]),L,d);Q<w&&S.push({dist:Q,range1:Z[0],range2:[0,0]})}if(Z[1]!==null){const Q=Ed(Sd(a,Z[1]),L,d);Q<w&&S.push({dist:Q,range1:Z[1],range2:[0,0]})}}}return w}function Xf(a,n,o,d,g,w=1/0){let S=Math.min(w,g.distance(a[0],o[0]));if(S===0)return S;const A=new cf([{dist:0,range1:[0,a.length-1],range2:[0,o.length-1]}],Td),L=n?Np:Bh,N=d?Np:Bh;for(;A.length;){const q=A.pop();if(q.dist>=S)continue;const Z=q.range1,Q=q.range2;if(As(Z)<=L&&As(Q)<=N){if(!qc(Z,a.length)||!qc(Q,o.length))return NaN;if(n&&d?S=Math.min(S,es(a,Z,o,Q,g)):n||d?n&&!d?S=Math.min(S,hf(o,Q,a,Z,g)):!n&&d&&(S=Math.min(S,hf(a,Z,o,Q,g))):S=Math.min(S,Ug(a,Z,o,Q,g)),S===0)return S}else{const ne=Ng(Z,n),oe=Ng(Q,d);no(A,S,g,a,o,ne[0],oe[0]),no(A,S,g,a,o,ne[0],oe[1]),no(A,S,g,a,o,ne[1],oe[0]),no(A,S,g,a,o,ne[1],oe[1])}}return S}function $g(a,n,o,d,g=1/0){let w=g;const S=Sd(a,[0,a.length-1]);for(const A of o)if(!(w!==1/0&&Ed(S,Sd(A,[0,A.length-1]),d)>=w)&&(w=Math.min(w,Xf(a,n,A,!0,d,w)),w===0))return w;return w}function jp(a,n,o,d,g=1/0){let w=g;const S=Sd(a,[0,a.length-1]);for(const A of o){if(w!==1/0&&Ed(S,Du(A),d)>=w)continue;const L=m0(a,n,A,d,w);if(isNaN(L))return L;if((w=Math.min(w,L))===0)return w}return w}function ff(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class ah{constructor(n,o){this.type=vn,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(tf(n[1])){const d=n[1];if(d.type==="FeatureCollection"){for(let g=0;g<d.features.length;++g)if(ff(d.features[g].geometry.type))return new ah(d,d.features[g].geometry)}else if(d.type==="Feature"){if(ff(d.geometry.type))return new ah(d,d.geometry)}else if(ff(d.type))return new ah(d,d)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),d=n.canonicalID();if(o!=null&&d!=null){if(n.geometryType()==="Point")return(function(g,w,S){const A=[];for(const N of g)for(const q of N)A.push(Vm(q,w));const L=new hu(A[0][1],"meters");return S.type==="Point"||S.type==="MultiPoint"||S.type==="LineString"?Xf(A,!1,S.type==="Point"?[S.coordinates]:S.coordinates,S.type==="LineString",L):S.type==="MultiLineString"?$g(A,!1,S.coordinates,L):S.type==="Polygon"||S.type==="MultiPolygon"?jp(A,!1,S.type==="Polygon"?[S.coordinates]:S.coordinates,L):null})(o,d,this.geometries);if(n.geometryType()==="LineString")return(function(g,w,S){const A=[];for(const N of g){const q=[];for(const Z of N)q.push(Vm(Z,w));A.push(q)}const L=new hu(A[0][0][1],"meters");if(S.type==="Point"||S.type==="MultiPoint"||S.type==="LineString")return $g(S.type==="Point"?[S.coordinates]:S.coordinates,S.type==="LineString",A,L);if(S.type==="MultiLineString"){let N=1/0;for(let q=0;q<S.coordinates.length;q++){const Z=$g(S.coordinates[q],!0,A,L,N);if(isNaN(Z))return Z;if((N=Math.min(N,Z))===0)return N}return N}if(S.type==="Polygon"||S.type==="MultiPolygon"){let N=1/0;for(let q=0;q<A.length;q++){const Z=jp(A[q],!0,S.type==="Polygon"?[S.coordinates]:S.coordinates,L,N);if(isNaN(Z))return Z;if((N=Math.min(N,Z))===0)return N}return N}return null})(o,d,this.geometries);if(n.geometryType()==="Polygon")return(function(g,w,S){const A=[];for(const N of(function(q,Z){const Q=q.length;if(Q<=1)return[q];const ne=[];let oe,me;for(let Se=0;Se<Q;Se++){const Te=rh(q[Se]);Te!==0&&(q[Se].area=Math.abs(Te),me===void 0&&(me=Te<0),me===Te<0?(oe&&ne.push(oe),oe=[q[Se]]):oe.push(q[Se]))}return oe&&ne.push(oe),ne})(g)){const q=[];for(let Z=0;Z<N.length;++Z)q.push(jg(N[Z],w));A.push(q)}const L=new hu(A[0][0][0][1],"meters");if(S.type==="Point"||S.type==="MultiPoint"||S.type==="LineString")return jp(S.type==="Point"?[S.coordinates]:S.coordinates,S.type==="LineString",A,L);if(S.type==="MultiLineString"){let N=1/0;for(let q=0;q<S.coordinates.length;q++){const Z=jp(S.coordinates[q],!0,A,L,N);if(isNaN(Z))return Z;if((N=Math.min(N,Z))===0)return N}return N}return S.type==="Polygon"||S.type==="MultiPolygon"?(function(N,q,Z){let Q=1/0;for(const ne of N)for(const oe of q){const me=df(ne,oe,Z,Q);if(isNaN(me))return me;if((Q=Math.min(Q,me))===0)return Q}return Q})(S.type==="Polygon"?[S.coordinates]:S.coordinates,A,L):null})(o,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function pf(a){if(a instanceof Fl&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof $c||a instanceof ah)return!1;if(a instanceof ta)return a.featureConstant;let n=!0;return a.eachChild((o=>{n&&!pf(o)&&(n=!1)})),n}function Yf(a){if(a instanceof Fl&&a.name==="feature-state")return!1;let n=!0;return a.eachChild((o=>{n&&!Yf(o)&&(n=!1)})),n}function lh(a,n){if(a instanceof Fl&&n.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild((d=>{o&&!lh(d,n)&&(o=!1)})),o}function Up(a,n,o){return[a,n,o].filter(Boolean).join("")}function $m(a,n){switch(a){case"string":return Sc(n);case"number":return+n;case"boolean":return!!n;case"color":return ps.parse(n);case"formatted":return xl.fromString(Sc(n));case"resolvedImage":return tl.build(Sc(n))}return n}function Gg(a,n,o,d){return d!==void 0&&(a=d*Math.round(a/d)),n!==void 0&&a<n&&(a=n),o!==void 0&&a>o&&(a=o),a}class ta{constructor(n,o,d,g=!1){this.type=n,this.key=o,this.scope=d,this.featureConstant=g}static parse(n,o){let d=o.expectedType;if(d==null&&(d=hs),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const g=o.parse(n[1],1);if(!(g instanceof Pu))return o.error("Key name of 'config' expression must be a string literal.");let w,S=!0;const A=Sc(g.value);if(n.length>=3){const L=o.parse(n[2],2);if(!(L instanceof Pu))return o.error("Scope of 'config' expression must be a string literal.");w=Sc(L.value)}if(o.options){const L=Up(A,w,o._scope),N=o.options.get(L);N&&(S=pf(N.value||N.default))}return new ta(d,A,w,S)}evaluate(n){const o=Up(this.key,this.scope,n.scope),d=n.getConfig(o);if(!d)return null;const{type:g,value:w,values:S,minValue:A,maxValue:L,stepValue:N}=d,q=d.default.evaluate(n);let Z=q;if(w){const Q=n.scope;n.scope=(Q||"").split("").slice(1).join(""),Z=w.evaluate(n),n.scope=Q}return g&&(Z=$m(g,Z)),Z===void 0||A===void 0&&L===void 0&&N===void 0||(typeof Z=="number"?Z=Gg(Z,A,L,N):Array.isArray(Z)&&(Z=Z.map((Q=>typeof Q=="number"?Gg(Q,A,L,N):Q)))),w!==void 0&&Z!==void 0&&S&&!S.includes(Z)&&(Z=q,g&&(Z=$m(g,Z))),(g&&g!==this.type||Z!==void 0&&!_d(Oa(Z),this.type))&&(Z=$m(this.type.kind,Z)),Z}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.scope),n}}class ch{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const d=n[1];return o.scope.has(d)?new ch(d,o.scope.get(d)):o.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jl{constructor(n,o=[],d,g=new gd,w=[],S,A,L){this.registry=n,this.path=o,this.key=o.map((N=>typeof N=="string"?`['${N}']`:`[${N}]`)).join(""),this.scope=g,this.errors=w,this.expectedType=d,this._scope=S,this.options=A,this.iconImageUseTheme=L}parse(n,o,d,g,w={}){return o||d?this.concat(o,null,d,g)._parse(n,w):this._parse(n,w)}parseObjectValue(n,o,d,g,w,S={}){return this.concat(o,d,g,w)._parse(n,S)}_parse(n,o){function d(g,w,S){return S==="assert"?new cu(w,[g]):S==="coerce"?new nh(w,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(g){let w=g.parse(n,this);if(!w)return null;if(this.expectedType){const S=this.expectedType,A=w.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||A.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(S,A))return null}else w=d(w,S,o.typeAnnotation||"coerce");else w=d(w,S,o.typeAnnotation||"assert")}if(!(w instanceof Pu)&&w.type.kind!=="resolvedImage"&&Kf(w)){const S=new yd(this._scope,this.options,this.iconImageUseTheme);try{w=new Pu(w.type,w.evaluate(S))}catch(A){return this.error(A.message),null}}return w}return nh.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,d,g){let w=typeof n=="number"?this.path.concat(n):this.path;w=typeof o=="string"?w.concat(o):w;const S=g?this.scope.concat(g):this.scope;return new Jl(this.registry,w,d||null,S,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(n,...o){const d=`${this.key}${o.map((g=>`[${g}]`)).join("")}`;this.errors.push(new Al(d,n))}checkSubtype(n,o){const d=ea(n,o);return d&&this.error(d),d}}function Kf(a){if(a instanceof ch)return Kf(a.boundExpression);if(a instanceof Fl&&a.name==="error"||a instanceof $a||a instanceof $c||a instanceof ah||a instanceof ta)return!1;const n=a instanceof nh||a instanceof cu;let o=!0;return a.eachChild((d=>{o=n?o&&Kf(d):o&&d instanceof Pu})),!!o&&pf(a)&&lh(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Id(a,n){const o=a.length-1;let d,g,w=0,S=o,A=0;for(;w<=S;)if(A=Math.floor((w+S)/2),d=a[A],g=a[A+1],d<=n){if(A===o||n<g)return A;w=A+1}else{if(!(d>n))throw new da("Input is not a number.");S=A-1}return 0}class Cd{constructor(n,o,d){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[g,w]of d)this.labels.push(g),this.outputs.push(w)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const d=o.parse(n[1],1,vn);if(!d)return null;const g=[];let w=null;o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let S=1;S<n.length;S+=2){const A=S===1?-1/0:n[S],L=n[S+1],N=S,q=S+1;if(typeof A!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(g.length&&g[g.length-1][0]>=A)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const Z=o.parse(L,q,w);if(!Z)return null;w=w||Z.type,g.push([A,Z])}return new Cd(w,d,g)}evaluate(n){const o=this.labels,d=this.outputs;if(o.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=o[0])return d[0].evaluate(n);const w=o.length;return g>=o[w-1]?d[w-1].evaluate(n):d[Id(o,g)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const Nh=.95047,Jf=1.08883,Ad=4/29,Ru=6/29,qg=3*Ru*Ru,oy=Ru*Ru*Ru,ay=Math.PI/180,ly=180/Math.PI;function Gm(a){return a>oy?Math.pow(a,1/3):a/qg+Ad}function uh(a){return a>Ru?a*a*a:qg*(a-Ad)}function $p(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Gp(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Qf(a){const n=Gp(a.r),o=Gp(a.g),d=Gp(a.b),g=Gm((.4124564*n+.3575761*o+.1804375*d)/Nh),w=Gm((.2126729*n+.7151522*o+.072175*d)/1);return{l:116*w-16,a:500*(g-w),b:200*(w-Gm((.0193339*n+.119192*o+.9503041*d)/Jf)),alpha:a.a}}function qp(a){let n=(a.l+16)/116,o=isNaN(a.a)?n:n+a.a/500,d=isNaN(a.b)?n:n-a.b/200;return n=1*uh(n),o=Nh*uh(o),d=Jf*uh(d),new ps($p(3.2404542*o-1.5371385*n-.4985314*d),$p(-.969266*o+1.8760108*n+.041556*d),$p(.0556434*o-.2040259*n+1.0572252*d),a.alpha)}function ep(a,n,o){const d=n-a;return a+o*(d>180||d<-180?d-360*Math.round(d/360):d)}const Pd={forward:Qf,reverse:qp,interpolate:function(a,n,o){return{l:Gn(a.l,n.l,o),a:Gn(a.a,n.a,o),b:Gn(a.b,n.b,o),alpha:Gn(a.alpha,n.alpha,o)}}},tp={forward:function(a){const{l:n,a:o,b:d}=Qf(a),g=Math.atan2(d,o)*ly;return{h:g<0?g+360:g,c:Math.sqrt(o*o+d*d),l:n,alpha:a.a}},reverse:function(a){const n=a.h*ay,o=a.c;return qp({l:a.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:a.alpha})},interpolate:function(a,n,o){return{h:ep(a.h,n.h,o),c:Gn(a.c,n.c,o),l:Gn(a.l,n.l,o),alpha:Gn(a.alpha,n.alpha,o)}}};var qm=Object.freeze({__proto__:null,hcl:tp,lab:Pd});class fc{constructor(n,o,d,g,w){this.type=n,this.operator=o,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[S,A]of w)this.labels.push(S),this.outputs.push(A)}static interpolationFactor(n,o,d,g){let w=0;if(n.name==="exponential")w=zu(o,n.base,d,g);else if(n.name==="linear")w=zu(o,1,d,g);else if(n.name==="cubic-bezier"){const S=n.controlPoints;w=new ll(S[0],S[1],S[2],S[3]).solve(zu(o,1,d,g))}return w}static parse(n,o){let[d,g,w,...S]=n;if(!Array.isArray(g)||g.length===0)return o.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const N=g[1];if(typeof N!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:N}}else{if(g[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const N=g.slice(1);if(N.length!==4||N.some((q=>typeof q!="number"||q<0||q>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:N}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(w=o.parse(w,2,vn),!w)return null;const A=[];let L=null;d==="interpolate-hcl"||d==="interpolate-lab"?L=Yl:o.expectedType&&o.expectedType.kind!=="value"&&(L=o.expectedType);for(let N=0;N<S.length;N+=2){const q=S[N],Z=S[N+1],Q=N+3,ne=N+4;if(typeof q!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(A.length&&A[A.length-1][0]>=q)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const oe=o.parse(Z,ne,L);if(!oe)return null;L=L||oe.type,A.push([q,oe])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new fc(L,d,g,w,A):o.error(`Type ${Mo(L)} is not interpolatable.`)}evaluate(n){const o=this.labels,d=this.outputs;if(o.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=o[0])return d[0].evaluate(n);const w=o.length;if(g>=o[w-1])return d[w-1].evaluate(n);const S=Id(o,g),A=fc.interpolationFactor(this.interpolation,g,o[S],o[S+1]),L=d[S].evaluate(n),N=d[S+1].evaluate(n);return this.operator==="interpolate"?Xo[this.type.kind.toLowerCase()](L,N,A):this.operator==="interpolate-hcl"?tp.reverse(tp.interpolate(tp.forward(L),tp.forward(N),A)):Pd.reverse(Pd.interpolate(Pd.forward(L),Pd.forward(N),A))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,n,this.input.serialize()];for(let d=0;d<this.labels.length;d++)o.push(this.labels[d],this.outputs[d].serialize());return o}}function zu(a,n,o,d){const g=d-o,w=a-o;return g===0?0:n===1?w/g:(Math.pow(n,w)-1)/(Math.pow(n,g)-1)}class ip{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let d=null;const g=o.expectedType;g&&g.kind!=="value"&&(d=g);const w=[];for(const A of n.slice(1)){const L=o.parse(A,1+w.length,d,void 0,{typeAnnotation:"omit"});if(!L)return null;d=d||L.type,w.push(L)}const S=g&&w.some((A=>ea(g,A.type)));return new ip(S?hs:d,w)}evaluate(n){let o,d=null,g=0;for(const w of this.args){if(g++,d=w.evaluate(n),d&&d instanceof tl&&!d.available&&(o||(o=d),d=null,g===this.args.length))return o;if(d!==null)break}return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){const n=["coalesce"];return this.eachChild((o=>{n.push(o.serialize())})),n}}class ul{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let w=1;w<n.length-1;w+=2){const S=n[w];if(typeof S!="string")return o.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return o.error("Variable names must contain only alphanumeric characters or '_'.",w);const A=o.parse(n[w+1],w+1);if(!A)return null;d.push([S,A])}const g=o.parse(n[n.length-1],n.length-1,o.expectedType,d);return g?new ul(d,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,d]of this.bindings)n.push(o,d.serialize());return n.push(this.result.serialize()),n}}class Ic{constructor(n,o,d){this.type=n,this.index=o,this.input=d}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,vn),g=o.parse(n[2],2,Ua(o.expectedType||hs));return d&&g?new Ic(g.type.itemType,d,g):null}evaluate(n){const o=this.index.evaluate(n),d=this.input.evaluate(n);if(o<0)throw new da("Array index out of bounds: negative index");if(o>=d.length)throw new da("Array index out of bounds: index exceeds array size");if(o!==Math.floor(o))throw new da("Array index must be an integer. Use at-interpolated for fractional indices");return d[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hp{constructor(n,o,d){this.type=n,this.index=o,this.input=d}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,vn),g=o.parse(n[2],2,Ua(o.expectedType||hs));return d&&g?new Hp(g.type.itemType,d,g):null}evaluate(n){const o=this.index.evaluate(n),d=this.input.evaluate(n);if(o<0)throw new da(`Array index out of bounds: ${o} < 0.`);if(o>d.length-1)throw new da(`Array index out of bounds: ${o} > ${d.length-1}.`);if(o===Math.floor(o))return d[o];const g=Math.floor(o),w=Math.ceil(o),S=d[g],A=d[w];if(typeof S!="number"||typeof A!="number")throw new da(`Cannot interpolate between non-number values at index ${o}.`);const L=o-g;return S*(1-L)+A*L}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Hc{constructor(n,o){this.type=ws,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,hs),g=o.parse(n[2],2,hs);return d&&g?Dm(d.type,[ws,Qr,vn,dc,hs])?new Hc(d,g):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mo(d.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(d==null)return!1;if(!th(o,["boolean","string","number","null"]))throw new da(`Expected first argument to be of type boolean, string, number or null, but found ${Mo(Oa(o))} instead.`);if(!th(d,["string","array"]))throw new da(`Expected second argument to be of type array or string, but found ${Mo(Oa(d))} instead.`);return d.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class np{constructor(n,o,d){this.type=vn,this.needle=n,this.haystack=o,this.fromIndex=d}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,hs),g=o.parse(n[2],2,hs);if(!d||!g)return null;if(!Dm(d.type,[ws,Qr,vn,dc,hs]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mo(d.type)} instead`);if(n.length===4){const w=o.parse(n[3],3,vn);return w?new np(d,g,w):null}return new np(d,g)}evaluate(n){const o=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!th(o,["boolean","string","number","null"]))throw new da(`Expected first argument to be of type boolean, string, number or null, but found ${Mo(Oa(o))} instead.`);if(!th(d,["string","array"]))throw new da(`Expected second argument to be of type array or string, but found ${Mo(Oa(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return d.indexOf(o,g)}return d.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Vh{constructor(n,o,d,g,w,S){this.inputType=n,this.type=o,this.input=d,this.cases=g,this.outputs=w,this.otherwise=S}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let d,g;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);const w={},S=[];for(let N=2;N<n.length-1;N+=2){let q=n[N];const Z=n[N+1];Array.isArray(q)||(q=[q]);const Q=o.concat(N);if(q.length===0)return Q.error("Expected at least one branch label.");for(const oe of q){if(typeof oe!="number"&&typeof oe!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return Q.error("Numeric branch labels must be integer values.");if(d){if(Q.checkSubtype(d,Oa(oe)))return null}else d=Oa(oe);if(w[String(oe)]!==void 0)return Q.error("Branch labels must be unique.");w[String(oe)]=S.length}const ne=o.parse(Z,N,g);if(!ne)return null;g=g||ne.type,S.push(ne)}const A=o.parse(n[1],1,hs);if(!A)return null;const L=o.parse(n[n.length-1],n.length-1,g);return L?A.type.kind!=="value"&&o.concat(1).checkSubtype(d,A.type)?null:new Vh(d,g,A,w,S,L):null}evaluate(n){const o=this.input.evaluate(n);return(_d(Oa(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),d=[],g={};for(const S of o){const A=g[this.cases[S]];A===void 0?(g[this.cases[S]]=d.length,d.push([this.cases[S],[S]])):d[A][1].push(S)}const w=S=>this.inputType.kind==="number"?Number(S):S;for(const[S,A]of d)n.push(A.length===1?w(A[0]):A.map(w)),n.push(this.outputs[S].serialize());return n.push(this.otherwise.serialize()),n}}class jh{constructor(n,o,d){this.type=n,this.branches=o,this.otherwise=d}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const g=[];for(let S=1;S<n.length-1;S+=2){const A=o.parse(n[S],S,ws);if(!A)return null;const L=o.parse(n[S+1],S+1,d);if(!L)return null;g.push([A,L]),d=d||L.type}const w=o.parse(n[n.length-1],n.length-1,d);return w?new jh(d,g,w):null}evaluate(n){for(const[o,d]of this.branches)if(o.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,d]of this.branches)n(o),n(d);n(this.otherwise)}outputDefined(){return this.branches.every((([n,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild((o=>{n.push(o.serialize())})),n}}class nl{constructor(n,o,d,g){this.type=n,this.input=o,this.beginIndex=d,this.endIndex=g}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,hs),g=o.parse(n[2],2,vn);if(!d||!g)return null;if(!Dm(d.type,[Ua(hs),Qr,hs]))return o.error(`Expected first argument to be of type array or string, but found ${Mo(d.type)} instead`);if(n.length===4){const w=o.parse(n[3],3,vn);return w?new nl(d.type,d,g,w):null}return new nl(d.type,d,g)}evaluate(n){const o=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!th(o,["string","array"]))throw new da(`Expected first argument to be of type array or string, but found ${Mo(Oa(o))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return o.slice(d,g)}return o.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class mf{constructor(n,o){this.type=Ua(Qr),this.str=n,this.delimiter=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=o.parse(n[1],1,Qr),g=o.parse(n[2],2,Qr);return d&&g?new mf(d,g):void 0}evaluate(n){const o=this.str.evaluate(n),d=this.delimiter.evaluate(n);return o.split(d)}eachChild(n){n(this.str),n(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Hm(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Hg(a,n,o,d){return d.compare(n,o)===0}function rp(a,n,o){const d=a!=="=="&&a!=="!=";return class kj{constructor(w,S,A){this.type=ws,this.lhs=w,this.rhs=S,this.collator=A,this.hasUntypedArgument=w.type.kind==="value"||S.type.kind==="value"}static parse(w,S){if(w.length!==3&&w.length!==4)return S.error("Expected two or three arguments.");const A=w[0];let L=S.parse(w[1],1,hs);if(!L)return null;if(!Hm(A,L.type))return S.concat(1).error(`"${A}" comparisons are not supported for type '${Mo(L.type)}'.`);let N=S.parse(w[2],2,hs);if(!N)return null;if(!Hm(A,N.type))return S.concat(2).error(`"${A}" comparisons are not supported for type '${Mo(N.type)}'.`);if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error(`Cannot compare types '${Mo(L.type)}' and '${Mo(N.type)}'.`);d&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new cu(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new cu(L.type,[N])));let q=null;if(w.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(q=S.parse(w[3],3,Qd),!q)return null}return new kj(L,N,q)}evaluate(w){const S=this.lhs.evaluate(w),A=this.rhs.evaluate(w);if(d&&this.hasUntypedArgument){const L=Oa(S),N=Oa(A);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new da(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${L.kind}, ${N.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const L=Oa(S),N=Oa(A);if(L.kind!=="string"||N.kind!=="string")return n(w,S,A)}return this.collator?o(w,S,A,this.collator.evaluate(w)):n(w,S,A)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}serialize(){const w=[a];return this.eachChild((S=>{w.push(S.serialize())})),w}}}const sp=rp("==",(function(a,n,o){return n===o}),Hg),op=rp("!=",(function(a,n,o){return n!==o}),(function(a,n,o,d){return!Hg(0,n,o,d)})),du=rp("<",(function(a,n,o){return n<o}),(function(a,n,o,d){return d.compare(n,o)<0})),ur=rp(">",(function(a,n,o){return n>o}),(function(a,n,o,d){return d.compare(n,o)>0})),gf=rp("<=",(function(a,n,o){return n<=o}),(function(a,n,o,d){return d.compare(n,o)<=0})),Wg=rp(">=",(function(a,n,o){return n>=o}),(function(a,n,o,d){return d.compare(n,o)>=0}));class Uh{constructor(n,o,d,g,w,S){this.type=Qr,this.number=n,this.locale=o,this.currency=d,this.unit=g,this.minFractionDigits=w,this.maxFractionDigits=S}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const d=o.parse(n[1],1,vn);if(!d)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return o.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=o.parseObjectValue(g.locale,2,"locale",Qr),!w))return null;let S=null;if(g.currency&&(S=o.parseObjectValue(g.currency,2,"currency",Qr),!S))return null;let A=null;if(g.unit&&(A=o.parseObjectValue(g.unit,2,"unit",Qr),!A))return null;let L=null;if(g["min-fraction-digits"]&&(L=o.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",vn),!L))return null;let N=null;return g["max-fraction-digits"]&&(N=o.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",vn),!N)?null:new Uh(d,w,S,A,L,N)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class _f{constructor(n){this.type=vn,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=o.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Mo(d.type)} instead.`):new _f(d):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new da(`Expected value to be of type string or array, but found ${Mo(Oa(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild((o=>{n.push(o.serialize())})),n}}function ap(a){return function(){a=1831565813+(a|=0)|0;let n=Math.imul(a^a>>>15,1|a);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Md={"==":sp,"!=":op,">":ur,"<":du,">=":Wg,"<=":gf,array:cu,at:Ic,"at-interpolated":Hp,boolean:cu,case:jh,coalesce:ip,collator:$a,format:Mu,image:yr,in:Hc,"index-of":np,interpolate:fc,"interpolate-hcl":fc,"interpolate-lab":fc,length:_f,let:ul,literal:Pu,match:Vh,number:cu,"number-format":Uh,object:cu,slice:nl,step:Cd,string:cu,"to-boolean":nh,"to-color":nh,"to-number":nh,"to-string":nh,var:ch,within:$c,distance:ah,config:ta,split:mf};function yf(a,[n,o,d,g]){n=n.evaluate(a),o=o.evaluate(a),d=d.evaluate(a);const w=g?g.evaluate(a):1,S=ih(n,o,d,w);if(S)throw new da(S);return new ps(n/255,o/255,d/255,w)}function Wp(a,[n,o,d,g]){n=n.evaluate(a),o=o.evaluate(a),d=d.evaluate(a);const w=g?g.evaluate(a):1,S=(function(N,q,Z,Q){return typeof N=="number"&&N>=0&&N<=360?typeof q=="number"&&q>=0&&q<=100&&typeof Z=="number"&&Z>=0&&Z<=100?Q===void 0||typeof Q=="number"&&Q>=0&&Q<=1?null:`Invalid hsla value [${[N,q,Z,Q].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof Q=="number"?[N,q,Z,Q]:[N,q,Z]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof Q=="number"?[N,q,Z,Q]:[N,q,Z]).join(", ")}]: 'h' must be between 0 and 360.`})(n,o,d,w);if(S)throw new da(S);const A=`hsla(${n}, ${o}%, ${d}%, ${w})`,L=ps.parse(A);if(!L)throw new da(`Failed to parse HSLA color: ${A}`);return L}function Zg(a,n){return a in n}function kd(a,n){const o=n[a];return o===void 0?null:o}function Dd(a){return{type:a}}function hh(a){if(a instanceof ta)return new Set([a.key]);let n=new Set;return a.eachChild((o=>{n=new Set([...n,...hh(o)])})),n}function vf(a){if(a instanceof Fl&&a.name==="is-active-floor")return!0;let n=!1;return a.eachChild((o=>{!n&&vf(o)&&(n=!0)})),n}function Xg(a){return{result:"success",value:a}}function dh(a){return{result:"error",value:a}}function Wm(a,n){return!!a&&!!a.parameters&&a.parameters.indexOf(n)>-1}function xf(a){return a["property-type"]==="data-driven"}function Zm(a){return Wm(a.expression,"measure-light")}function Yg(a){return Wm(a.expression,"zoom")}function Ou(a){return!!a.expression&&a.expression.interpolated}function To(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function cy(a){return a}function lp(a,n){const o=n.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",g=d||!(d||a.property!==void 0),w=a.type||(Ou(n)?"exponential":"interval");if(o&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map((N=>[N[0],ps.parse(N[1])]))),a.default=ps.parse(a.default?a.default:n.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!qm[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let S,A,L;if(w==="exponential")S=Jg;else if(w==="interval")S=Kg;else if(w==="categorical"){S=Xm,A=Object.create(null);for(const N of a.stops)A[N[0]]=N[1];L=typeof a.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);S=Qg}if(d){const N={},q=[];for(let ne=0;ne<a.stops.length;ne++){const oe=a.stops[ne],me=oe[0].zoom;N[me]===void 0&&(N[me]={zoom:me,type:a.type,property:a.property,default:a.default,stops:[]},q.push(me)),N[me].stops.push([oe[0].value,oe[1]])}const Z=[];for(const ne of q)Z.push([N[ne].zoom,lp(N[ne],n)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:fc.interpolationFactor.bind(void 0,Q),zoomStops:Z.map((ne=>ne[0])),evaluate:({zoom:ne},oe)=>Jg({stops:Z,base:a.base},n,ne).evaluate(ne,oe)}}if(g){const N=w==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:fc.interpolationFactor.bind(void 0,N),zoomStops:a.stops.map((q=>q[0])),evaluate:({zoom:q})=>S(a,n,q,A,L)}}return{kind:"source",evaluate(N,q){const Z=q&&q.properties?q.properties[a.property]:void 0;return Z===void 0?Wc(a.default,n.default):S(a,n,Z,A,L)}}}function Wc(a,n,o){return a!==void 0?a:n!==void 0?n:o!==void 0?o:void 0}function Xm(a,n,o,d,g){return Wc(typeof o===g?d[o]:void 0,a.default,n.default)}function Kg(a,n,o){if(!nf(o))return Wc(a.default,n.default);const d=a.stops.length;if(d===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[d-1][0])return a.stops[d-1][1];const g=Id(a.stops.map((w=>w[0])),o);return a.stops[g][1]}function Jg(a,n,o){const d=a.base!==void 0?a.base:1;if(!nf(o))return Wc(a.default,n.default);const g=a.stops.length;if(g===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[g-1][0])return a.stops[g-1][1];const w=Id(a.stops.map((q=>q[0])),o),S=(function(q,Z,Q,ne){const oe=ne-Q,me=q-Q;return oe===0?0:Z===1?me/oe:(Math.pow(Z,me)-1)/(Math.pow(Z,oe)-1)})(o,d,a.stops[w][0],a.stops[w+1][0]),A=a.stops[w][1],L=a.stops[w+1][1];let N=Xo[n.type]||cy;if(a.colorSpace&&a.colorSpace!=="rgb"){const q=qm[a.colorSpace];N=(Z,Q)=>q.reverse(q.interpolate(q.forward(Z),q.forward(Q),S))}return typeof A.evaluate=="function"?{evaluate(...q){const Z=A.evaluate.apply(void 0,q),Q=L.evaluate.apply(void 0,q);if(Z!==void 0&&Q!==void 0)return N(Z,Q,S)}}:N(A,L,S)}function Qg(a,n,o){return n.type==="color"?o=ps.parse(o):n.type==="formatted"?o=xl.fromString(o.toString()):n.type==="resolvedImage"?o=tl.build(o.toString()):zn(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Wc(o,a.default,n.default)}Fl.register(Md,{error:[{kind:"error"},[Qr],(a,[n])=>{throw new da(n.evaluate(a))}],typeof:[Qr,[hs],(a,[n])=>Mo(Oa(n.evaluate(a)))],"to-rgba":[Ua(vn,4),[Yl],(a,[n])=>n.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ua(vn,4),[Yl],(a,[n])=>n.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Yl,[vn,vn,vn],yf],rgba:[Yl,[vn,vn,vn,vn],yf],hsl:[Yl,[vn,vn,vn],Wp],hsla:[Yl,[vn,vn,vn,vn],Wp],has:{type:ws,overloads:[[[Qr],(a,[n])=>Zg(n.evaluate(a),a.properties())],[[Qr,Qu],(a,[n,o])=>Zg(n.evaluate(a),o.evaluate(a))]]},get:{type:hs,overloads:[[[Qr],(a,[n])=>kd(n.evaluate(a),a.properties())],[[Qr,Qu],(a,[n,o])=>kd(n.evaluate(a),o.evaluate(a))]]},"feature-state":[hs,[Qr],(a,[n])=>kd(n.evaluate(a),a.featureState||{})],properties:[Qu,[],a=>a.properties()],"geometry-type":[Qr,[],a=>a.geometryType()],worldview:[Qr,[],a=>a.globals.worldview||""],"is-active-floor":[ws,Dd(Qr),(a,n)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const o=a.globals.activeFloors;return n.some((d=>{const g=d.evaluate(a);return o.has(g)}))}],id:[hs,[],a=>a.id()],zoom:[vn,[],a=>a.globals.zoom],pitch:[vn,[],a=>a.globals.pitch||0],"distance-from-center":[vn,[],a=>a.distanceFromCenter()],"measure-light":[vn,[Qr],(a,[n])=>a.measureLight(n.evaluate(a))],"heatmap-density":[vn,[],a=>a.globals.heatmapDensity||0],"line-progress":[vn,[],a=>a.globals.lineProgress||0],"raster-value":[vn,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[vn,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[vn,[],a=>a.globals.skyRadialProgress||0],accumulated:[hs,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[vn,Dd(vn),(a,n)=>{let o=0;for(const d of n)o+=d.evaluate(a);return o}],"*":[vn,Dd(vn),(a,n)=>{let o=1;for(const d of n)o*=d.evaluate(a);return o}],"-":{type:vn,overloads:[[[vn,vn],(a,[n,o])=>n.evaluate(a)-o.evaluate(a)],[[vn],(a,[n])=>-n.evaluate(a)]]},"/":[vn,[vn,vn],(a,[n,o])=>n.evaluate(a)/o.evaluate(a)],"%":[vn,[vn,vn],(a,[n,o])=>n.evaluate(a)%o.evaluate(a)],ln2:[vn,[],()=>Math.LN2],pi:[vn,[],()=>Math.PI],e:[vn,[],()=>Math.E],"^":[vn,[vn,vn],(a,[n,o])=>Math.pow(n.evaluate(a),o.evaluate(a))],sqrt:[vn,[vn],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[vn,[vn],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[vn,[vn],(a,[n])=>Math.log(n.evaluate(a))],log2:[vn,[vn],(a,[n])=>Math.log2(n.evaluate(a))],sin:[vn,[vn],(a,[n])=>Math.sin(n.evaluate(a))],cos:[vn,[vn],(a,[n])=>Math.cos(n.evaluate(a))],tan:[vn,[vn],(a,[n])=>Math.tan(n.evaluate(a))],asin:[vn,[vn],(a,[n])=>Math.asin(n.evaluate(a))],acos:[vn,[vn],(a,[n])=>Math.acos(n.evaluate(a))],atan:[vn,[vn],(a,[n])=>Math.atan(n.evaluate(a))],min:[vn,Dd(vn),(a,n)=>Math.min(...n.map((o=>o.evaluate(a))))],max:[vn,Dd(vn),(a,n)=>Math.max(...n.map((o=>o.evaluate(a))))],abs:[vn,[vn],(a,[n])=>Math.abs(n.evaluate(a))],round:[vn,[vn],(a,[n])=>{const o=n.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[vn,[vn],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[vn,[vn],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[ws,[Qr,hs],(a,[n,o])=>a.properties()[n.value]===o.value],"filter-id-==":[ws,[hs],(a,[n])=>a.id()===n.value],"filter-type-==":[ws,[Qr],(a,[n])=>a.geometryType()===n.value],"filter-<":[ws,[Qr,hs],(a,[n,o])=>{const d=a.properties()[n.value],g=o.value;return typeof d==typeof g&&d<g}],"filter-id-<":[ws,[hs],(a,[n])=>{const o=a.id(),d=n.value;return typeof o==typeof d&&o<d}],"filter->":[ws,[Qr,hs],(a,[n,o])=>{const d=a.properties()[n.value],g=o.value;return typeof d==typeof g&&d>g}],"filter-id->":[ws,[hs],(a,[n])=>{const o=a.id(),d=n.value;return typeof o==typeof d&&o>d}],"filter-<=":[ws,[Qr,hs],(a,[n,o])=>{const d=a.properties()[n.value],g=o.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[ws,[hs],(a,[n])=>{const o=a.id(),d=n.value;return typeof o==typeof d&&o<=d}],"filter->=":[ws,[Qr,hs],(a,[n,o])=>{const d=a.properties()[n.value],g=o.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[ws,[hs],(a,[n])=>{const o=a.id(),d=n.value;return typeof o==typeof d&&o>=d}],"filter-has":[ws,[hs],(a,[n])=>n.value in a.properties()],"filter-has-id":[ws,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[ws,[Ua(Qr)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[ws,[Ua(hs)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[ws,[Qr,Ua(hs)],(a,[n,o])=>o.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[ws,[Qr,Ua(hs)],(a,[n,o])=>(function(d,g,w,S){for(;w<=S;){const A=w+S>>1;if(g[A]===d)return!0;g[A]>d?S=A-1:w=A+1}return!1})(a.properties()[n.value],o.value,0,o.value.length-1)],all:{type:ws,overloads:[[[ws,ws],(a,[n,o])=>n.evaluate(a)&&o.evaluate(a)],[Dd(ws),(a,n)=>{for(const o of n)if(!o.evaluate(a))return!1;return!0}]]},any:{type:ws,overloads:[[[ws,ws],(a,[n,o])=>n.evaluate(a)||o.evaluate(a)],[Dd(ws),(a,n)=>{for(const o of n)if(o.evaluate(a))return!0;return!1}]]},"!":[ws,[ws],(a,[n])=>!n.evaluate(a)],"is-supported-script":[ws,[Qr],(a,[n])=>{const o=a.globals&&a.globals.isSupportedScript;return!o||o(n.evaluate(a))}],upcase:[Qr,[Qr],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[Qr,[Qr],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[Qr,Dd(hs),(a,n)=>n.map((o=>Sc(o.evaluate(a)))).join("")],"resolved-locale":[Qr,[Qd],(a,[n])=>n.evaluate(a).resolvedLocale()],random:[vn,[vn,vn,hs],(a,n)=>{const[o,d,g]=n.map((S=>S.evaluate(a)));if(o>d||o===d)return o;let w;if(typeof g=="string")w=(function(S){let A=0;if(S.length===0)return A;for(let L=0;L<S.length;L++)A=(A<<5)-A+S.charCodeAt(L),A|=0;return A})(g);else{if(typeof g!="number")throw new da(`Invalid seed input: ${g}`);w=g}return o+ap(w)()*(d-o)}]});class Zp{constructor(n,o,d,g,w){this.expression=n,this._warningHistory={},this._scope=d,this._options=g,this._iconImageUseTheme=w,this._evaluator=new yd(d,g,w),this._defaultValue=o?(function(S){return S.type==="color"&&(To(S.default)||Array.isArray(S.default))?new ps(0,0,0,0):S.type==="color"?ps.parse(S.default)||null:S.default===void 0?null:S.default})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=hh(n),this.isIndoorDependent=vf(n)}evaluateWithoutErrorHandling(n,o,d,g,w,S,A,L){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=d,this._evaluator.canonical=g||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,d,g,w,S,A,L,N){this._evaluator||(this._evaluator=new yd(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=L||null,this._evaluator.iconImageUseTheme=N||null;try{const q=this.expression.evaluate(this._evaluator);if(q==null||typeof q=="number"&&q!=q)return this._defaultValue;if(this._enumValues&&!(q in this._enumValues))throw new da(`Expected value to be one of ${Object.keys(this._enumValues).map((Z=>JSON.stringify(Z))).join(", ")}, but found ${JSON.stringify(q)} instead.`);return q}catch(q){const Z=q;return this._warningHistory[Z.message]||(this._warningHistory[Z.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${Z.message}`)),this._defaultValue}}}function pc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Md}function fu(a,n,o,d,g){const w=new Jl(Md,[],n?(function(A){const L={color:Yl,string:Qr,number:vn,enum:Qr,boolean:ws,formatted:eh,resolvedImage:ef};return A.type==="array"?Ua(L[A.value]||hs,A.length):L[A.type]})(n):void 0,void 0,void 0,o,d,g),S=w.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return S?Xg(new Zp(S,n,o,d,g)):dh(w.errors)}class vr{constructor(n,o,d,g){this.kind=n,this._styleExpression=o,this.isLightConstant=d,this.isLineProgressConstant=g,this.isStateDependent=n!=="constant"&&!Yf(o.expression),this.configDependencies=hh(o.expression),this.isIndoorDependent=vf(o.expression)}evaluateWithoutErrorHandling(n,o,d,g,w,S){return this._styleExpression.evaluateWithoutErrorHandling(n,o,d,g,w,S)}evaluate(n,o,d,g,w,S,A){return this._styleExpression.evaluate(n,o,d,g,w,S,void 0,void 0,A)}}class Cr{constructor(n,o,d,g,w,S){this.kind=n,this.zoomStops=d,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Yf(o.expression),this.isIndoorDependent=vf(o.expression),this.isLightConstant=w,this.isLineProgressConstant=S,this.configDependencies=hh(o.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,o,d,g,w,S){return this._styleExpression.evaluateWithoutErrorHandling(n,o,d,g,w,S)}evaluate(n,o,d,g,w,S){return this._styleExpression.evaluate(n,o,d,g,w,S)}interpolationFactor(n,o,d){return this.interpolationType?fc.interpolationFactor(this.interpolationType,n,o,d):0}}function bf(a,n,o,d,g){if((a=fu(a,n,o,d,g)).result==="error")return a;const w=a.value.expression,S=pf(w);if(!S&&!xf(n))return dh([new Al("","data expressions not supported")]);const A=lh(w,["zoom","pitch","distance-from-center"]);if(!A&&!Yg(n))return dh([new Al("","zoom expressions not supported")]);const L=lh(w,["measure-light"]);if(!L&&!Zm(n))return dh([new Al("","measure-light expression not supported")]);const N=lh(w,["line-progress"]);if(!N&&!(function(Q){return Wm(Q.expression,"line-progress")})(n))return dh([new Al("","line-progress expression not supported")]);const q=n.expression&&n.expression.relaxZoomRestriction,Z=Cc(w);return Z||A||q?Z instanceof Al?dh([Z]):Z instanceof fc&&!Ou(n)?dh([new Al("",'"interpolate" expressions cannot be used with this property')]):Xg(Z?new Cr(S&&N?"camera":"composite",a.value,Z.labels,Z instanceof fc?Z.interpolation:void 0,L,N):new vr(S&&N?"constant":"source",a.value,L,N)):dh([new Al("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class wf{constructor(n,o){this._parameters=n,this._specification=o,Object.assign(this,lp(this._parameters,this._specification))}static deserialize(n){return new wf(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Cc(a){let n=null;if(a instanceof ul)n=Cc(a.result);else if(a instanceof ip){for(const o of a.args)if(n=Cc(o),n)break}else(a instanceof Cd||a instanceof fc)&&a.input instanceof Fl&&a.input.name==="zoom"&&(n=a);return n instanceof Al||a.eachChild((o=>{const d=Cc(o);d instanceof Al?n=d:n&&d&&n!==d&&(n=new Al("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}var Nl,Zc,Ym=(function(){if(Zc)return Nl;Zc=1,Nl=n;var a=3;function n(o,d,g){var w=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var S=new Int32Array(this.arrayBuffer);o=S[0],this.d=(d=S[1])+2*(g=S[2]);for(var A=0;A<this.d*this.d;A++){var L=S[a+A],N=S[a+A+1];w.push(L===N?null:S.subarray(L,N))}var q=S[a+w.length+1];this.keys=S.subarray(S[a+w.length],q),this.bboxes=S.subarray(q),this.insert=this._insertReadonly}else{this.d=d+2*g;for(var Z=0;Z<this.d*this.d;Z++)w.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=o,this.padding=g,this.scale=d/o,this.uid=0;var Q=g/d*o;this.min=-Q,this.max=o+Q}return n.prototype.insert=function(o,d,g,w,S){this._forEachCell(d,g,w,S,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(S)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(o,d,g,w,S,A){this.cells[S].push(A)},n.prototype.query=function(o,d,g,w,S){var A=this.min,L=this.max;if(o<=A&&d<=A&&L<=g&&L<=w&&!S)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(o,d,g,w,this._queryCell,N,{},S),N},n.prototype._queryCell=function(o,d,g,w,S,A,L,N){var q=this.cells[S];if(q!==null)for(var Z=this.keys,Q=this.bboxes,ne=0;ne<q.length;ne++){var oe=q[ne];if(L[oe]===void 0){var me=4*oe;(N?N(Q[me+0],Q[me+1],Q[me+2],Q[me+3]):o<=Q[me+2]&&d<=Q[me+3]&&g>=Q[me+0]&&w>=Q[me+1])?(L[oe]=!0,A.push(Z[oe])):L[oe]=!1}}},n.prototype._forEachCell=function(o,d,g,w,S,A,L,N){for(var q=this._convertToCellCoord(o),Z=this._convertToCellCoord(d),Q=this._convertToCellCoord(g),ne=this._convertToCellCoord(w),oe=q;oe<=Q;oe++)for(var me=Z;me<=ne;me++){var Se=this.d*me+oe;if((!N||N(this._convertFromCellCoord(oe),this._convertFromCellCoord(me),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(me+1)))&&S.call(this,o,d,g,w,Se,A,L,N))return}},n.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},n.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,d=a+this.cells.length+1+1,g=0,w=0;w<this.cells.length;w++)g+=this.cells[w].length;var S=new Int32Array(d+g+this.keys.length+this.bboxes.length);S[0]=this.extent,S[1]=this.n,S[2]=this.padding;for(var A=d,L=0;L<o.length;L++){var N=o[L];S[a+L]=A,S.set(N,A),A+=N.length}return S[a+o.length]=A,S.set(this.keys,A),S[a+o.length+1]=A+=this.keys.length,S.set(this.bboxes,A),A+=this.bboxes.length,S.buffer},Nl})(),Tf=is(Ym);const Sf={};function Cn(a,n,o={}){Object.defineProperty(a,"_classRegistryKey",{value:n,writable:!1}),Sf[n]={klass:a,omit:o.omit||[]}}Cn(Object,"Object"),Tf.serialize=function(a,n){const o=a.toArrayBuffer();return n&&n.add(o),{buffer:o}},Tf.deserialize=function(a){return new Tf(a.buffer)},Object.defineProperty(Tf,"name",{value:"Grid"}),Cn(Tf,"Grid"),delete yi.prototype.constructor,Cn(ps,"Color"),Cn(Error,"Error"),Cn(xl,"Formatted"),Cn(Lm,"FormattedSection"),Cn(Ko,"AJAXError"),Cn(tl,"ResolvedImage"),Cn(wf,"StylePropertyFunction"),Cn(Zp,"StyleExpression",{omit:["_evaluator"]}),Cn(Jo,"ImageId"),Cn(Fh,"ImageVariant"),Cn(Cr,"ZoomDependentExpression"),Cn(vr,"ZoomConstantExpression"),Cn(Fl,"CompoundExpression",{omit:["_evaluate"]});for(const a in Md)Sf[Md[a]._classRegistryKey]||Cn(Md[a],`Expression${a}`);function $h(a){return a&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function So(a,n){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if($h(a)||a instanceof ImageBitmap)return n&&n.add(a),a;if(ArrayBuffer.isView(a))return n&&n.add(a.buffer),a;if(a instanceof ImageData)return n&&n.add(a.data.buffer),a;if(Array.isArray(a)){const o=[];for(const d of a)o.push(So(d,n));return o}if(a instanceof Map){const o={$name:"Map",entries:[]};for(const[d,g]of a.entries())o.entries.push(So(d),So(g,n));return o}if(a instanceof Set){const o={$name:"Set"};let d=0;for(const g of a.values())o[++d]=So(g);return o}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const o=a.constructor,d=o._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const g=o.serialize?o.serialize(a,n):{};if(!o.serialize){for(const w in a)a.hasOwnProperty(w)&&(Sf[d].omit.indexOf(w)>=0||(g[w]=So(a[w],n)));a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof a)}function Yo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||$h(a)||a instanceof ImageBitmap||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Yo);if(typeof a=="object"){const n=a.$name||"Object";if(n==="Map"){const g=a.entries||[],w=new Map;for(let S=0;S<g.length;S+=2)w.set(Yo(g[S]),Yo(g[S+1]));return w}if(n==="Set"){const g=new Set;for(const w of Object.keys(a))w!=="$name"&&g.add(Yo(a[w]));return g}if(n==="BigInt")return BigInt(a.value);const{klass:o}=Sf[n];if(!o)throw new Error(`Can't deserialize unregistered class "${n}".`);if(o.deserialize)return o.deserialize(a);const d=Object.create(o.prototype);for(const g of Object.keys(a))g!=="$name"&&(d[g]=Yo(a[g]));return d}throw new Error("can't deserialize object of type "+typeof a)}const Hn={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Gh(a){for(const n of a)if(Ef(n.charCodeAt(0)))return!0;return!1}function cp(a){for(const n of a)if(!Km(n.charCodeAt(0)))return!1;return!0}function Km(a){return!(Hn.Arabic(a)||Hn["Arabic Supplement"](a)||Hn["Arabic Extended-A"](a)||Hn["Arabic Presentation Forms-A"](a)||Hn["Arabic Presentation Forms-B"](a))}function Ef(a){return!(a!==746&&a!==747&&(a<4352||!(Hn["Bopomofo Extended"](a)||Hn.Bopomofo(a)||Hn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Hn["CJK Compatibility Ideographs"](a)||Hn["CJK Compatibility"](a)||Hn["CJK Radicals Supplement"](a)||Hn["CJK Strokes"](a)||!(!Hn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Hn["CJK Unified Ideographs Extension A"](a)||Hn["CJK Unified Ideographs"](a)||Hn["Enclosed CJK Letters and Months"](a)||Hn["Hangul Compatibility Jamo"](a)||Hn["Hangul Jamo Extended-A"](a)||Hn["Hangul Jamo Extended-B"](a)||Hn["Hangul Jamo"](a)||Hn["Hangul Syllables"](a)||Hn.Hiragana(a)||Hn["Ideographic Description Characters"](a)||Hn.Kanbun(a)||Hn["Kangxi Radicals"](a)||Hn["Katakana Phonetic Extensions"](a)||Hn.Katakana(a)&&a!==12540||!(!Hn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Hn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Hn["Unified Canadian Aboriginal Syllabics"](a)||Hn["Unified Canadian Aboriginal Syllabics Extended"](a)||Hn["Vertical Forms"](a)||Hn["Yijing Hexagram Symbols"](a)||Hn["Yi Syllables"](a)||Hn["Yi Radicals"](a))))}function up(a){return!(Ef(a)||(function(n){return!!(Hn["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Hn["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Hn["Letterlike Symbols"](n)||Hn["Number Forms"](n)||Hn["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Hn["Control Pictures"](n)&&n!==9251||Hn["Optical Character Recognition"](n)||Hn["Enclosed Alphanumerics"](n)||Hn["Geometric Shapes"](n)||Hn["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Hn["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Hn["CJK Symbols and Punctuation"](n)||Hn.Katakana(n)||Hn["Private Use Area"](n)||Hn["CJK Compatibility Forms"](n)||Hn["Small Form Variants"](n)||Hn["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)})(a))}function Ld(a){return Hn.Arabic(a)||Hn["Arabic Supplement"](a)||Hn["Arabic Extended-A"](a)||Hn["Arabic Presentation Forms-A"](a)||Hn["Arabic Presentation Forms-B"](a)}function Fu(a){return a>=1424&&a<=2303||Hn["Arabic Presentation Forms-A"](a)||Hn["Arabic Presentation Forms-B"](a)}function pu(a,n){return!(!n&&Fu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Hn.Khmer(a))}function Xp(a){for(const n of a)if(Fu(n.charCodeAt(0)))return!0;return!1}const Vl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let If=null,Pl=Vl.unavailable,Ac=null;const Bu=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Pl=Vl.error),If&&If(a)};function hp(){Rd.fire(new Cs("pluginStateChange",{pluginStatus:Pl,pluginURL:Ac}))}const Rd=new Au,Nu=function(){return Pl},Jm=function(){if(Pl!==Vl.deferred||!Ac)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pl=Vl.loading,hp(),Ac&&Tc({url:Ac},(a=>{a?Bu(a):(Pl=Vl.loaded,hp())}))},mu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pl===Vl.loaded||mu.applyArabicShaping!=null,isLoading:()=>Pl===Vl.loading,setState(a){Pl=a.pluginStatus,Ac=a.pluginURL},isParsing:()=>Pl===Vl.parsing,isParsed:()=>Pl===Vl.parsed,getPluginURL:()=>Ac};class Us{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview,this.activeFloors=o.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return(function(o,d){for(const g of o)if(!pu(g.charCodeAt(0),d))return!1;return!0})(n,mu.isLoaded())}}class dp{constructor(n,o,d,g,w){this.property=n,this.value=o,this.expression=(function(S,A,L,N,q){if(To(S))return new wf(S,A);if(pc(S)||Array.isArray(S)&&S.length>0){const Z=bf(S,A,L,N,q);if(Z.result==="error")throw new Error(Z.value.map((Q=>`${Q.key}: ${Q.message}`)).join(", "));return Z.value}{let Z=S;return typeof S=="string"&&A.type==="color"&&(Z=ps.parse(S)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>Z}}})(o===void 0?n.specification.default:o,n.specification,d,g,w)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,d,g){return this.property.possiblyEvaluate(this,n,o,d,g)}}class V{constructor(n,o,d,g){this.property=n,this.value=new dp(n,void 0,o,d,g)}transitioned(n,o){return new y(this.property,this.value,o,Object.assign({},n.transition,this.transition),n.now)}untransitioned(){return new y(this.property,this.value,null,{},0)}}class u{constructor(n,o,d,g){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=d,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return xi(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new V(this._values[n].property,this._scope,this._options,this._iconImageUseTheme)),this._values[n].value=new dp(this._values[n].property,o===null?void 0:xi(o),this._scope,this._options,this._iconImageUseTheme),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].value.isIndoorDependent())}setTransitionOrValue(n,o){o&&(this._options=o);const d=this._properties.properties;if(n)for(const g in n){const w=n[g];if(g.endsWith("-transition")){const S=g.slice(0,-11);d[S]&&this.setTransition(S,w)}else d.hasOwnProperty(g)&&this.setValue(g,w)}}getTransition(n){return xi(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new V(this._values[n].property)),this._values[n].transition=xi(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const d=this.getValue(o);d!==void 0&&(n[o]=d);const g=this.getTransition(o);g!==void 0&&(n[`${o}-transition`]=g)}return n}transitioned(n,o){const d=new I(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(n,o._values[g]);return d}untransitioned(){const n=new I(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}isIndoorDependent(){return this._isIndoorDependent}}class y{constructor(n,o,d,g,w){const S=g.delay||0,A=g.duration||0;w=w||0,this.property=n,this.value=o,this.begin=w+S,this.end=this.begin+A,n.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(n,o,d){const g=n.now||0,w=this.value.possiblyEvaluate(n,o,d),S=this.prior;if(S){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return S.possiblyEvaluate(n,o,d);{const A=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(n,o,d),w,Qa(A))}}return w}}class I{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,d){const g=new H(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,o,d);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class D{constructor(n,o,d,g){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=d,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(n){return xi(this._values[n].value)}setValue(n,o){this._values[n]=new dp(this._values[n].property,o===null?void 0:xi(o),this._scope,this._options,this._iconImageUseTheme),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[n].isIndoorDependent())}serialize(){const n={};for(const o of Object.keys(this._values)){const d=this.getValue(o);d!==void 0&&(n[o]=d)}return n}possiblyEvaluate(n,o,d,g){const w=new H(this._properties);for(const S of Object.keys(this._values))w._values[S]=this._values[S].possiblyEvaluate(n,o,d,g);return w}isIndoorDependent(){return this._isIndoorDependent}}class j{constructor(n,o,d,g){this.property=n,this.value=o,this.parameters=d,this.iconImageUseTheme=g}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,d,g){return this.property.evaluate(this.value,this.parameters,n,o,d,g,this.iconImageUseTheme)}}class H{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class K{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,d){const g=Xo[this.specification.type];return g?g(n,o,d):n}}class te{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,d,g,w){return n.expression.kind==="constant"||n.expression.kind==="camera"?new j(this,{kind:"constant",value:n.expression.evaluate(o,null,{},d,g,void 0,w)},o):new j(this,n.expression,o,w)}interpolate(n,o,d){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new j(this,{kind:"constant",value:void 0},n.parameters);const g=Xo[this.specification.type];return g?new j(this,{kind:"constant",value:g(n.value.value,o.value.value,d)},n.parameters):n}evaluate(n,o,d,g,w,S,A){return n.kind==="constant"?n.value:n.evaluate(o,d,g,w,S,void 0,A)}}class ge{constructor(n){this.specification=n}possiblyEvaluate(n,o,d,g){return!!n.expression.evaluate(o,null,{},d,g)}interpolate(){return!1}}class xe{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Us(0,{});for(const d in n){const g=n[d];g.specification.overridable&&this.overridableProperties.push(d);const w=this.defaultPropertyValues[d]=new dp(g,void 0),S=this.defaultTransitionablePropertyValues[d]=new V(g);this.defaultTransitioningPropertyValues[d]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=w.possiblyEvaluate(o)}}}Cn(te,"DataDrivenProperty"),Cn(K,"DataConstantProperty"),Cn(ge,"ColorRampProperty");var fe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function De(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ve(a){if(Array.isArray(a))return a.map(Ve);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const o in a)n[o]=Ve(a[o]);return n}return De(a)}function Xe(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!Xe(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function xt(a,n="",o=null,d="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xe(a)||(a=ei(a));const g=a;let w=!0;try{w=(function(q){if(!Mt(q))return q;let Z=Ve(q);return Tt(Z),Z=wt(Z),Z})(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let S=null,A=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){A=fe[`filter_${d}`];const q=fu(w,A,n,o);if(q.result==="error")throw new Error(q.value.map((Z=>`${Z.key}: ${Z.message}`)).join(", "));S=(Z,Q,ne)=>q.value.evaluate(Z,Q,{},ne)}let L=null,N=null;if(w!==g){const q=fu(g,A,n,o);if(q.result==="error")throw new Error(q.value.map((Z=>`${Z.key}: ${Z.message}`)).join(", "));L=(Z,Q,ne,oe,me)=>q.value.evaluate(Z,Q,{},ne,void 0,void 0,oe,me),N=!pf(q.value.expression)}return{filter:S,dynamicFilter:L||void 0,needGeometry:Zt(w),needFeature:!!N}}function wt(a){if(!Array.isArray(a))return a;const n=(function(o){if(Yt.has(o[0])){for(let d=1;d<o.length;d++)if(Mt(o[d]))return!0}return o})(a);return n===!0?n:n.map((o=>wt(o)))}function Tt(a){let n=!1;const o=[];if(a[0]==="case"){for(let d=1;d<a.length-1;d+=2)n=n||Mt(a[d]),o.push(a[d+1]);o.push(a[a.length-1])}else if(a[0]==="match"){n=n||Mt(a[1]);for(let d=2;d<a.length-1;d+=2)o.push(a[d+1]);o.push(a[a.length-1])}else if(a[0]==="step"){n=n||Mt(a[1]);for(let d=1;d<a.length-1;d+=2)o.push(a[d+1])}n&&(a.length=0,a.push("any",...o));for(let d=1;d<a.length;d++)Tt(a[d])}function Mt(a){if(!Array.isArray(a))return!1;if((n=a[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<a.length;o++)if(Mt(a[o]))return!0;return!1}const Yt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rt(a,n){return a<n?-1:a>n?1:0}function Zt(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let n=1;n<a.length;n++)if(Zt(a[n]))return!0;return!1}function ei(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?Ut(a[1],a[2],"=="):n==="!="?ki(Ut(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ut(a[1],a[2],n):n==="any"?(o=a.slice(1),["any"].concat(o.map(ei))):n==="all"?["all"].concat(a.slice(1).map(ei)):n==="none"?["all"].concat(a.slice(1).map(ei).map(ki)):n==="in"?hi(a[1],a.slice(2)):n==="!in"?ki(hi(a[1],a.slice(2))):n==="has"?$i(a[1]):n!=="!has"||ki($i(a[1]));var o}function Ut(a,n,o){switch(a){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,a,n]}}function hi(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some((o=>typeof o!=typeof n[0]))?["filter-in-large",a,["literal",n.sort(Rt)]]:["filter-in-small",a,["literal",n]]}}function $i(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ki(a){return["!",a]}const Di="";function Pi(a,n){return n?`${a}${Di}${n}`:a}let On;const Nn=()=>On||(On=new xe({"icon-size":new te(fe.layout_symbol["icon-size"]),"icon-image":new te(fe.layout_symbol["icon-image"]),"icon-rotate":new te(fe.layout_symbol["icon-rotate"]),"icon-offset":new te(fe.layout_symbol["icon-offset"]),"text-size":new te(fe.layout_symbol["text-size"]),"text-rotate":new te(fe.layout_symbol["text-rotate"]),"text-offset":new te(fe.layout_symbol["text-offset"])}));class bn{constructor(n,o,d,g,w,S){const A=fu(n,fe.appearance.condition);if(A.result==="success"&&(this.condition=A.value),this.name=o,d){this.properties=new H(Nn()),this.unevaluatedLayout=new D(Nn(),g,w,S);for(const L in d)this.unevaluatedLayout.setValue(L,d[L])}}isActive(n){return!(this.condition||!n.isHidden||this.name!=="hidden")||this.condition.evaluate(n.globals,n.feature,n.featureState,n.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(n){return this.properties.get(n)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(n){return this.unevaluatedLayout._values[n]}recalculate(n,o,d){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(n,void 0,o,d))}serialize(){const n={};return n.condition=this.condition.expression.serialize(),this.name&&(n.name=this.name),this.unevaluatedLayout&&(n.properties=this.unevaluatedLayout.serialize()),n}hasIconProperties(){const n=this.hasProperty("icon-image"),o=this.hasProperty("icon-size"),d=this.hasProperty("icon-offset"),g=this.hasProperty("icon-rotate");return n||o||d||g}hasTextProperties(){const n=this.hasProperty("text-size"),o=this.hasProperty("text-offset"),d=this.hasProperty("text-rotate");return n||o||d}hasProperty(n){return this.getUnevaluatedProperty(n).value!==void 0}}const Yn="-transition",Zr=new Set(["fill","line","background","hillshade","raster"]);class Ps extends Au{constructor(n,o,d,g,w,S){if(super(),this.id=n.id,this.fqid=Pi(this.id,d),this.type=n.type,this.scope=d,this.lut=g,this.options=w,this.iconImageUseTheme=S,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const A=fu(this.filter,fe[`filter_${n.type}`]);A.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...A.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||A.value.isIndoorDependent)}if(n.slot&&(this.slot=n.slot),n.appearances&&this.setAppearances(n.appearances),o.layout&&(this._unevaluatedLayout=new D(o.layout,this.scope,w,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),o.paint){this._transitionablePaint=new u(o.paint,this.scope,w);for(const A in n.paint)this.setPaintProperty(A,n.paint[A]);for(const A in n.layout)this.setLayoutProperty(A,n.layout[A]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new H(o.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D(!0)&&Zr.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const d=this._unevaluatedLayout;d._properties.properties[n]&&(d.setValue(n,o),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),n==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(n){this.appearances=[],n.forEach((o=>{this.appearances.push(new bn(o.condition,o.name,o.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return n.endsWith(Yn)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}isPaintProperty(n){return!!this._transitionablePaint._properties.properties[n]}setPaintProperty(n,o){const d=this._transitionablePaint,g=d._properties.properties;if(n.endsWith(Yn)){const Z=n.slice(0,-11);return g[Z]&&d.setTransition(Z,o||void 0),!1}if(!g[n])return!1;const w=d._values[n],S=w.value.isDataDriven(),A=w.value;d.setValue(n,o),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(n);const L=d._values[n].value,N=L.isDataDriven(),q=n.endsWith("pattern")||n==="line-dasharray";return N||S||q||this._handleOverridablePaintPropertyUpdate(n,A,L)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,d){return null}_handleOverridablePaintPropertyUpdate(n,o,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(n.appearances=this.appearances.map((o=>o.serialize()))),Ri(n,((o,d)=>!(o===void 0||d==="layout"&&!Object.keys(o).length||d==="paint"&&!Object.keys(o).length)))}is3D(n){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof j&&xf(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}for(const n of this.appearances)if(!Yf(n.condition.expression))return!0;return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=xt(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(n,o,d){return{}}queryRadius(n){}queryIntersectsFeature(n,o,d,g,w,S,A,L,N){}}const ia={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eo{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const fa=new ArrayBuffer(0);class Nr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(n,o){return n._trim(),o&&n.arrayBuffer&&o.add(n.arrayBuffer),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,n.arrayBuffer?o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement:(o.capacity=0,o.arrayBuffer=fa),o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this._reallocCount++,this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}reserveForAdditional(n){this.reserve(this.length+n)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hr(a,n=1){let o=0,d=0;return{members:a.map((g=>{const w=ia[g.type].BYTES_PER_ELEMENT,S=o=oa(o,Math.max(n,w)),A=g.components||1;return d=Math.max(d,w),o+=w*A,{name:g.name,type:g.type,components:A,offset:S}})),size:oa(o,Math.max(d,n)),alignment:n}}function oa(a,n){return Math.ceil(a/n)*n}class pa extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const d=this.length;return this.resize(d+1),this.emplace(d,n,o)}emplace(n,o,d){const g=2*n;return this.int16[g+0]=o,this.int16[g+1]=d,n}}pa.prototype.bytesPerElement=4,Cn(pa,"StructArrayLayout2i4");class aa extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,d)}emplace(n,o,d,g){const w=3*n;return this.int16[w+0]=o,this.int16[w+1]=d,this.int16[w+2]=g,n}}aa.prototype.bytesPerElement=6,Cn(aa,"StructArrayLayout3i6");class na extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,d,g)}emplace(n,o,d,g,w){const S=4*n;return this.int16[S+0]=o,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=w,n}}na.prototype.bytesPerElement=8,Cn(na,"StructArrayLayout4i8");class ma extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}ma.prototype.bytesPerElement=4,Cn(ma,"StructArrayLayout1f4");class fh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,d)}emplace(n,o,d,g){const w=4*n,S=2*n;return this.int16[w+0]=o,this.int16[w+1]=d,this.float32[S+1]=g,n}}fh.prototype.bytesPerElement=8,Cn(fh,"StructArrayLayout2i1f8");class Vu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,d)}emplace(n,o,d,g){const w=4*n;return this.int16[w+0]=o,this.int16[w+1]=d,this.int16[w+2]=g,n}}Vu.prototype.bytesPerElement=8,Cn(Vu,"StructArrayLayout3i8");class gu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w){const S=this.length;return this.resize(S+1),this.emplace(S,n,o,d,g,w)}emplace(n,o,d,g,w,S){const A=5*n;return this.int16[A+0]=o,this.int16[A+1]=d,this.int16[A+2]=g,this.int16[A+3]=w,this.int16[A+4]=S,n}}gu.prototype.bytesPerElement=10,Cn(gu,"StructArrayLayout5i10");class jl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,d,g,w,S,A)}emplace(n,o,d,g,w,S,A,L){const N=6*n,q=12*n,Z=3*n;return this.int16[N+0]=o,this.int16[N+1]=d,this.uint8[q+4]=g,this.uint8[q+5]=w,this.uint8[q+6]=S,this.uint8[q+7]=A,this.float32[Z+2]=L,n}}jl.prototype.bytesPerElement=12,Cn(jl,"StructArrayLayout2i4ub1f12");class bl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,d)}emplace(n,o,d,g){const w=3*n;return this.float32[w+0]=o,this.float32[w+1]=d,this.float32[w+2]=g,n}}bl.prototype.bytesPerElement=12,Cn(bl,"StructArrayLayout3f12");class wl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w){const S=this.length;return this.resize(S+1),this.emplace(S,n,o,d,g,w)}emplace(n,o,d,g,w,S){const A=6*n,L=3*n;return this.uint16[A+0]=o,this.uint16[A+1]=d,this.uint16[A+2]=g,this.uint16[A+3]=w,this.float32[L+2]=S,n}}wl.prototype.bytesPerElement=12,Cn(wl,"StructArrayLayout4ui1f12");class Xc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,d,g)}emplace(n,o,d,g,w){const S=4*n;return this.uint16[S+0]=o,this.uint16[S+1]=d,this.uint16[S+2]=g,this.uint16[S+3]=w,n}}Xc.prototype.bytesPerElement=8,Cn(Xc,"StructArrayLayout4ui8");class mc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,d,g,w,S)}emplace(n,o,d,g,w,S,A){const L=6*n;return this.int16[L+0]=o,this.int16[L+1]=d,this.int16[L+2]=g,this.int16[L+3]=w,this.int16[L+4]=S,this.int16[L+5]=A,n}}mc.prototype.bytesPerElement=12,Cn(mc,"StructArrayLayout6i12");class _u extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,n,o,d,g,w,S,A,L,N,q,Z,Q)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q,ne){const oe=12*n;return this.int16[oe+0]=o,this.int16[oe+1]=d,this.int16[oe+2]=g,this.int16[oe+3]=w,this.uint16[oe+4]=S,this.uint16[oe+5]=A,this.uint16[oe+6]=L,this.uint16[oe+7]=N,this.int16[oe+8]=q,this.int16[oe+9]=Z,this.int16[oe+10]=Q,this.int16[oe+11]=ne,n}}_u.prototype.bytesPerElement=24,Cn(_u,"StructArrayLayout4i4ui4i24");class Yc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,d,g,w,S)}emplace(n,o,d,g,w,S,A){const L=10*n,N=5*n;return this.int16[L+0]=o,this.int16[L+1]=d,this.int16[L+2]=g,this.float32[N+2]=w,this.float32[N+3]=S,this.float32[N+4]=A,n}}Yc.prototype.bytesPerElement=20,Cn(Yc,"StructArrayLayout3i3f20");class Ml extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,d,g)}emplace(n,o,d,g,w){const S=4*n;return this.float32[S+0]=o,this.float32[S+1]=d,this.float32[S+2]=g,this.float32[S+3]=w,n}}Ml.prototype.bytesPerElement=16,Cn(Ml,"StructArrayLayout4f16");class Uo extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}Uo.prototype.bytesPerElement=4,Cn(Uo,"StructArrayLayout1ul4");class Ws extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const d=this.length;return this.resize(d+1),this.emplace(d,n,o)}emplace(n,o,d){const g=2*n;return this.uint16[g+0]=o,this.uint16[g+1]=d,n}}Ws.prototype.bytesPerElement=4,Cn(Ws,"StructArrayLayout2ui4");class Ga extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z,Q,ne){const oe=this.length;return this.resize(oe+1),this.emplace(oe,n,o,d,g,w,S,A,L,N,q,Z,Q,ne)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe){const me=20*n,Se=10*n;return this.int16[me+0]=o,this.int16[me+1]=d,this.int16[me+2]=g,this.int16[me+3]=w,this.int16[me+4]=S,this.float32[Se+3]=A,this.float32[Se+4]=L,this.float32[Se+5]=N,this.float32[Se+6]=q,this.int16[me+14]=Z,this.uint32[Se+8]=Q,this.uint16[me+18]=ne,this.uint16[me+19]=oe,n}}Ga.prototype.bytesPerElement=40,Cn(Ga,"StructArrayLayout5i4f1i1ul2ui40");class qa extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,d,g,w,S,A)}emplace(n,o,d,g,w,S,A,L){const N=8*n;return this.int16[N+0]=o,this.int16[N+1]=d,this.int16[N+2]=g,this.int16[N+4]=w,this.int16[N+5]=S,this.int16[N+6]=A,this.int16[N+7]=L,n}}qa.prototype.bytesPerElement=16,Cn(qa,"StructArrayLayout3i2i2i16");class Yp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w){const S=this.length;return this.resize(S+1),this.emplace(S,n,o,d,g,w)}emplace(n,o,d,g,w,S){const A=4*n,L=8*n;return this.float32[A+0]=o,this.float32[A+1]=d,this.float32[A+2]=g,this.int16[L+6]=w,this.int16[L+7]=S,n}}Yp.prototype.bytesPerElement=16,Cn(Yp,"StructArrayLayout2f1f2i16");class Qm extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,d,g,w,S)}emplace(n,o,d,g,w,S,A){const L=20*n,N=5*n;return this.uint8[L+0]=o,this.uint8[L+1]=d,this.float32[N+1]=g,this.float32[N+2]=w,this.float32[N+3]=S,this.float32[N+4]=A,n}}Qm.prototype.bytesPerElement=20,Cn(Qm,"StructArrayLayout2ub4f20");class $o extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,o,d)}emplace(n,o,d,g){const w=3*n;return this.uint16[w+0]=o,this.uint16[w+1]=d,this.uint16[w+2]=g,n}}$o.prototype.bytesPerElement=6,Cn($o,"StructArrayLayout3ui6");class fp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt,Qe){const ht=30*n,yt=15*n,Et=60*n;return this.int16[ht+0]=o,this.int16[ht+1]=d,this.int16[ht+2]=g,this.float32[yt+2]=w,this.float32[yt+3]=S,this.uint16[ht+8]=A,this.uint16[ht+9]=L,this.uint32[yt+5]=N,this.uint32[yt+6]=q,this.uint32[yt+7]=Z,this.uint16[ht+16]=Q,this.uint16[ht+17]=ne,this.uint16[ht+18]=oe,this.float32[yt+10]=me,this.float32[yt+11]=Se,this.uint8[Et+48]=Te,this.uint8[Et+49]=Le,this.uint8[Et+50]=Re,this.uint32[yt+13]=Ue,this.int16[ht+28]=rt,this.uint8[Et+58]=Qe,n}}fp.prototype.bytesPerElement=60,Cn(fp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class eg extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt,Qe,ht,yt,Et,ai,kt,fi,Ti,Si,Bi,ji,zi){const Oi=this.length;return this.resize(Oi+1),this.emplace(Oi,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt,Qe,ht,yt,Et,ai,kt,fi,Ti,Si,Bi,ji,zi)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt,Qe,ht,yt,Et,ai,kt,fi,Ti,Si,Bi,ji,zi,Oi){const di=20*n,ui=40*n,Fi=80*n;return this.float32[di+0]=o,this.float32[di+1]=d,this.int16[ui+4]=g,this.int16[ui+5]=w,this.int16[ui+6]=S,this.int16[ui+7]=A,this.int16[ui+8]=L,this.int16[ui+9]=N,this.int16[ui+10]=q,this.int16[ui+11]=Z,this.int16[ui+12]=Q,this.uint16[ui+13]=ne,this.uint16[ui+14]=oe,this.uint16[ui+15]=me,this.uint16[ui+16]=Se,this.uint16[ui+17]=Te,this.uint16[ui+18]=Le,this.uint16[ui+19]=Re,this.uint16[ui+20]=Ue,this.uint16[ui+21]=rt,this.uint16[ui+22]=Qe,this.uint16[ui+23]=ht,this.uint16[ui+24]=yt,this.uint16[ui+25]=Et,this.uint16[ui+26]=ai,this.uint16[ui+27]=kt,this.uint32[di+14]=fi,this.float32[di+15]=Ti,this.float32[di+16]=Si,this.float32[di+17]=Bi,this.float32[di+18]=ji,this.uint8[Fi+76]=zi,this.uint16[ui+39]=Oi,n}}eg.prototype.bytesPerElement=80,Cn(eg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Kp extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,d,g,w,S)}emplace(n,o,d,g,w,S,A){const L=6*n;return this.float32[L+0]=o,this.float32[L+1]=d,this.float32[L+2]=g,this.float32[L+3]=w,this.float32[L+4]=S,this.float32[L+5]=A,n}}Kp.prototype.bytesPerElement=24,Cn(Kp,"StructArrayLayout6f24");class Pc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w){const S=this.length;return this.resize(S+1),this.emplace(S,n,o,d,g,w)}emplace(n,o,d,g,w,S){const A=5*n;return this.float32[A+0]=o,this.float32[A+1]=d,this.float32[A+2]=g,this.float32[A+3]=w,this.float32[A+4]=S,n}}Pc.prototype.bytesPerElement=20,Cn(Pc,"StructArrayLayout5f20");class ph extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,d,g,w,S,A)}emplace(n,o,d,g,w,S,A,L){const N=7*n;return this.float32[N+0]=o,this.float32[N+1]=d,this.float32[N+2]=g,this.float32[N+3]=w,this.float32[N+4]=S,this.float32[N+5]=A,this.float32[N+6]=L,n}}ph.prototype.bytesPerElement=28,Cn(ph,"StructArrayLayout7f28");class mh extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z){const Q=this.length;return this.resize(Q+1),this.emplace(Q,n,o,d,g,w,S,A,L,N,q,Z)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q){const ne=11*n;return this.float32[ne+0]=o,this.float32[ne+1]=d,this.float32[ne+2]=g,this.float32[ne+3]=w,this.float32[ne+4]=S,this.float32[ne+5]=A,this.float32[ne+6]=L,this.float32[ne+7]=N,this.float32[ne+8]=q,this.float32[ne+9]=Z,this.float32[ne+10]=Q,n}}mh.prototype.bytesPerElement=44,Cn(mh,"StructArrayLayout11f44");class zd extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N){const q=this.length;return this.resize(q+1),this.emplace(q,n,o,d,g,w,S,A,L,N)}emplace(n,o,d,g,w,S,A,L,N,q){const Z=9*n;return this.float32[Z+0]=o,this.float32[Z+1]=d,this.float32[Z+2]=g,this.float32[Z+3]=w,this.float32[Z+4]=S,this.float32[Z+5]=A,this.float32[Z+6]=L,this.float32[Z+7]=N,this.float32[Z+8]=q,n}}zd.prototype.bytesPerElement=36,Cn(zd,"StructArrayLayout9f36");class yu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const d=this.length;return this.resize(d+1),this.emplace(d,n,o)}emplace(n,o,d){const g=2*n;return this.float32[g+0]=o,this.float32[g+1]=d,n}}yu.prototype.bytesPerElement=8,Cn(yu,"StructArrayLayout2f8");class kl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,d,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,d,g)}emplace(n,o,d,g,w){const S=6*n;return this.uint32[3*n+0]=o,this.uint16[S+2]=d,this.uint16[S+3]=g,this.uint16[S+4]=w,n}}kl.prototype.bytesPerElement=12,Cn(kl,"StructArrayLayout1ul3ui12");class ju extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}ju.prototype.bytesPerElement=2,Cn(ju,"StructArrayLayout1ui2");class tg extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se){const Te=this.length;return this.resize(Te+1),this.emplace(Te,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se)}emplace(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te){const Le=16*n;return this.float32[Le+0]=o,this.float32[Le+1]=d,this.float32[Le+2]=g,this.float32[Le+3]=w,this.float32[Le+4]=S,this.float32[Le+5]=A,this.float32[Le+6]=L,this.float32[Le+7]=N,this.float32[Le+8]=q,this.float32[Le+9]=Z,this.float32[Le+10]=Q,this.float32[Le+11]=ne,this.float32[Le+12]=oe,this.float32[Le+13]=me,this.float32[Le+14]=Se,this.float32[Le+15]=Te,n}}tg.prototype.bytesPerElement=64,Cn(tg,"StructArrayLayout16f64");class e_ extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,d,g,w,S,A){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,d,g,w,S,A)}emplace(n,o,d,g,w,S,A,L){const N=10*n,q=5*n;return this.uint16[N+0]=o,this.uint16[N+1]=d,this.uint16[N+2]=g,this.uint16[N+3]=w,this.float32[q+2]=S,this.float32[q+3]=A,this.float32[q+4]=L,n}}e_.prototype.bytesPerElement=20,Cn(e_,"StructArrayLayout4ui3f20");class g0 extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}g0.prototype.bytesPerElement=2,Cn(g0,"StructArrayLayout1i2");class ig extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}ig.prototype.bytesPerElement=1,Cn(ig,"StructArrayLayout1ub1");class uy extends Eo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}uy.prototype.size=40;class hy extends Ga{get(n){return new uy(this,n)}}Cn(hy,"CollisionBoxArray");class t_ extends Eo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}t_.prototype.size=60;class _0 extends fp{get(n){return new t_(this,n)}}Cn(_0,"PlacedSymbolArray");class Jp extends Eo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Jp.prototype.size=80;class y0 extends eg{get(n){return new Jp(this,n)}}Cn(y0,"SymbolInstanceArray");class Cf extends ma{getoffsetX(n){return this.float32[1*n+0]}}Cn(Cf,"GlyphOffsetArray");class i_ extends pa{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Cn(i_,"SymbolLineVertexArray");class ng extends Eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ng.prototype.size=12;class v0 extends kl{get(n){return new ng(this,n)}}Cn(v0,"FeatureIndexArray");class wv extends Ws{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Cn(wv,"FillExtrusionCentroidArray");class dy extends Eo{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}dy.prototype.size=6;class n_ extends aa{get(n){return new dy(this,n)}}Cn(n_,"FillExtrusionWallArray");const Tv=hr([{name:"a_pos",components:2,type:"Int16"}],4),Sv=hr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),fy=hr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bo{constructor(n=[]){this.segments=n}_prepareSegment(n,o,d,g){let w=this.segments[this.segments.length-1];return n>bo.MAX_VERTEX_ARRAY_LENGTH&&mn(`Max vertices per segment is ${bo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>bo.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:o,primitiveOffset:d,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}prepareSegment(n,o,d,g){return this._prepareSegment(n,o.length,d.length,g)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,d,g){return new bo([{vertexOffset:n,primitiveOffset:o,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function r_(a,n){return 256*(a=we(Math.floor(a),0,255))+we(Math.floor(n),0,255)}bo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cn(bo,"SegmentVector");const bb=hr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),wb=hr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Ev=hr([{name:"a_dash",components:4,type:"Uint16"}]);class rg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,d,g){this.ids.push(x0(n)),this.positions.push(o,d,g)}eachPosition(n,o){const d=x0(n);let g=0,w=this.ids.length-1;for(;g<w;){const S=g+w>>1;this.ids[S]>=d?w=S:g=S+1}for(;this.ids[g]===d;)o(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(n,o){const d=new Float64Array(n.ids),g=new Uint32Array(n.positions);return s_(d,g,0,d.length-1),o&&(o.add(d.buffer),o.add(g.buffer)),{ids:d,positions:g}}static deserialize(n){const o=new rg;let d;o.ids=n.ids,o.positions=n.positions;for(const g of o.ids)g!==d&&o.uniqueIds.push(g),d=g;return o.indexed=!0,o}}function x0(a){const n=+a;return Number.isSafeInteger(n)?n:Rh(String(a))}function s_(a,n,o,d){for(;o<d;){const g=a[o+d>>1];let w=o-1,S=d+1;for(;;){do w++;while(a[w]<g);do S--;while(a[S]>g);if(w>=S)break;o_(a,w,S),o_(n,3*w,3*S),o_(n,3*w+1,3*S+1),o_(n,3*w+2,3*S+2)}S-o<d-S?(s_(a,n,o,S),o=S+1):(s_(a,n,S+1,d),d=S)}}function o_(a,n,o){const d=a[n];a[n]=a[o],a[o]=d}Cn(rg,"FeaturePositionMap");class qh{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class pp extends qh{constructor(n){super(n),this.current=0}set(n,o,d){this.fetchUniformLocation(n,o)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class lo extends qh{constructor(n){super(n),this.current=0}set(n,o,d){this.fetchUniformLocation(n,o)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Hh extends qh{constructor(n){super(n),this.current=[0,0]}set(n,o,d){this.fetchUniformLocation(n,o)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Qp extends qh{constructor(n){super(n),this.current=[0,0,0]}set(n,o,d){this.fetchUniformLocation(n,o)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class py extends qh{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,d){this.fetchUniformLocation(n,o)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class sg extends qh{constructor(n){super(n),this.current=ps.transparent.toPremultipliedRenderColor(null)}set(n,o,d){this.fetchUniformLocation(n,o)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const Tb=new Float32Array(16);class a_ extends qh{constructor(n){super(n),this.current=Tb}set(n,o,d){if(this.fetchUniformLocation(n,o)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let g=1;g<16;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const l_=new Float32Array(9),Sb=new Float32Array(4);class og extends qh{constructor(n){super(n),this.current=Sb}set(n,o,d){if(this.fetchUniformLocation(n,o)){for(let g=0;g<4;g++)if(d[g]!==this.current[g]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function my(a){return[r_(255*a.r,255*a.g),r_(255*a.b,255*a.a)]}function ag(a,n,o,d,g,w,S,A){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new Us(0,{brightness:w,worldview:A}),n,o,g,d,S)==="none":a.value==="none")}class c_{constructor(n,o,d,g){this.value=n,this.uniformNames=o.map((w=>`u_${w}`)),this.type=d,this.context=g}setUniform(n,o,d,g,w){const S=g.constantOr(this.value);o.set(n,w,S instanceof ps?S.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):S)}getBinding(n,o){return this.type==="color"?new sg(n):new lo(n)}}class lg{constructor(n,o){this.uniformNames=o.map((d=>`u_${d}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(n,o){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(n,o,d,g,w){let S=null;w!=="u_pattern"&&w!=="u_dash"||(S=this.pattern),w==="u_pattern_b"&&(S=this.patternTransition),w==="u_pixel_ratio"&&(S=this.pixelRatio),S&&o.set(n,w,S)}getBinding(n,o){return o==="u_pattern"||o==="u_pattern_b"||o==="u_dash"?new py(n):new lo(n)}}class Af{constructor(n,o,d,g){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=o.map((w=>({name:`a_${w}`,type:"Float32",components:d==="color"?2:1,offset:0}))),this.paintVertexArray=new g}populatePaintArray(n,o,d,g,w,S,A,L){const N=this.paintVertexArray.length,q=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Us(0,{brightness:S,worldview:L}),o,{},w,g,A):this.expression.kind==="constant"&&this.expression.value,Z=ag(this.lutExpression,o,{},g,w,S,A,L);this.paintVertexArray.resize(n),this._setPaintValue(N,n,q,Z?null:this.context.lut)}updatePaintArray(n,o,d,g,w,S,A,L){const N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:A,worldview:L},d,g,void 0,w):this.expression.kind==="constant"&&this.expression.value,q=ag(this.lutExpression,d,g,w,void 0,A,void 0,L);this._setPaintValue(n,o,N,q?null:this.context.lut)}_setPaintValue(n,o,d,g){if(this.type==="color"){const w=my(d.toPremultipliedRenderColor(g));for(let S=n;S<o;S++)this.paintVertexArray.emplace(S,w[0],w[1])}else{for(let w=n;w<o;w++)this.paintVertexArray.emplace(w,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gh{constructor(n,o,d,g,w,S){this.expression=n,this.uniformNames=o.map((A=>`u_${A}_t`)),this.type=d,this.useIntegerZoom=g,this.context=w,this.maxValue=0,this.paintVertexAttributes=o.map((A=>({name:`a_${A}`,type:"Float32",components:d==="color"?4:2,offset:0}))),this.paintVertexArray=new S}populatePaintArray(n,o,d,g,w,S,A,L){const N=this.expression.evaluate(new Us(this.context.zoom,{brightness:S,worldview:L}),o,{},w,g,A),q=this.expression.evaluate(new Us(this.context.zoom+1,{brightness:S,worldview:L}),o,{},w,g,A),Z=ag(this.lutExpression,o,{},g,w,S,A,L),Q=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(Q,n,N,q,Z?null:this.context.lut)}updatePaintArray(n,o,d,g,w,S,A,L){const N=this.expression.evaluate({zoom:this.context.zoom,brightness:A,worldview:L},d,g,void 0,w),q=this.expression.evaluate({zoom:this.context.zoom+1,brightness:A,worldview:L},d,g,void 0,w),Z=ag(this.lutExpression,d,g,w,void 0,A,void 0,L);this._setPaintValue(n,o,N,q,Z?null:this.context.lut)}_setPaintValue(n,o,d,g,w){if(this.type==="color"){const S=my(d.toPremultipliedRenderColor(w)),A=my(d.toPremultipliedRenderColor(w));for(let L=n;L<o;L++)this.paintVertexArray.emplace(L,S[0],S[1],A[0],A[1])}else{for(let S=n;S<o;S++)this.paintVertexArray.emplace(S,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,d,g,w){const S=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,A=we(this.expression.interpolationFactor(S,this.context.zoom,this.context.zoom+1),0,1);o.set(n,w,A)}getBinding(n,o){return new lo(n)}}class Wh{constructor(n,o,d,g,w){this.expression=n,this.layerId=w,this.paintVertexAttributes=(d==="array"?Ev:bb).members;for(let S=0;S<o.length;++S);this.paintVertexArray=new g,this.paintTransitionVertexArray=new Xc}populatePaintArray(n,o,d,g){const w=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(w,n,o.patterns&&o.patterns[this.layerId],d)}updatePaintArray(n,o,d,g,w,S,A){this._setPaintValues(n,o,d.patterns&&d.patterns[this.layerId],S)}_setPaintValues(n,o,d,g){if(!g||!d)return;const w=g[d[0]],S=g[d[1]];if(w){if(w){const{tl:A,br:L,pixelRatio:N}=w;for(let q=n;q<o;q++)this.paintVertexArray.emplace(q,A[0],A[1],L[0],L[1],N)}if(S){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:A,br:L}=S;for(let N=n;N<o;N++)this.paintTransitionVertexArray.emplace(N,A[0],A[1],L[0],L[1])}}}upload(n){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=n.createVertexBuffer(this.paintTransitionVertexArray,wb.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Pf{constructor(n,o,d=(()=>!0)){this.binders={},this._buffers=[],this.context=o;const g=[];for(const w in n.paint._values){const S=n.paint.get(w);if(w.endsWith("-use-theme")||!d(w)||!(S instanceof j&&xf(S.property.specification)))continue;const A=Eb(w,n.type),L=S.value,N=S.property.specification.type,q=!!S.property.useIntegerZoom,Z=w==="line-dasharray"||w.endsWith("pattern"),Q=n.paint.get(`${w}-use-theme`),ne=w==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||Q&&Q.value.kind!=="constant";if(L.kind!=="constant"||ne)if(L.kind==="source"||ne||Z){const oe=b0(w,N,"source");this.binders[w]=Z?new Wh(L,A,N,oe,n.id):new Af(L,A,N,oe),g.push(`/a_${w}`)}else{const oe=b0(w,N,"composite");this.binders[w]=new gh(L,A,N,q,o,oe),g.push(`/z_${w}`)}else this.binders[w]=Z?new lg(L.value,A):new c_(L.value,A,N,o),g.push(`/u_${w}`);Q&&(this.binders[w].lutExpression=Q.value)}this.cacheKey=g.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof Af||o instanceof gh?o.maxValue:0}populatePaintArrays(n,o,d,g,w,S,A,L){for(const N in this.binders){const q=this.binders[N];q.context=this.context,(q instanceof Af||q instanceof gh||q instanceof Wh)&&q.populatePaintArray(n,o,d,g,w,S,A,L)}}setConstantPatternPositions(n,o){for(const d in this.binders){const g=this.binders[d];g instanceof lg&&g.setConstantPatternPositions(n,o)}}getPatternTransitionVertexBuffer(n){const o=this.binders[n];return o instanceof Wh?o.paintTransitionVertexBuffer:null}updatePaintArrays(n,o,d,g,w,S,A,L,N,q){let Z=!1;const Q=Object.keys(n),ne=Q.length!==0&&!L,oe=ne?Q:o.uniqueIds;this.context.lut=w.lut;for(const me in this.binders){const Se=this.binders[me];if(Se.context=this.context,(Se instanceof Af||Se instanceof gh||Se instanceof Wh)&&Se.expression&&Se.expression.kind&&Se.expression.kind!=="constant"&&(Se.expression.isStateDependent===!0||Se.expression.isLightConstant===!1)){const Te=w.paint.get(me);Se.expression=Te.value;for(const Le of oe){const Re=n[Le.toString()];o.eachPosition(Le,((Ue,rt,Qe)=>{const ht=g.feature(Ue);Se.updatePaintArray(rt,Qe,ht,Re,S,A,N,q)}))}if(!ne)for(const Le of d.uniqueIds){const Re=n[Le.toString()];d.eachPosition(Le,((Ue,rt,Qe)=>{const ht=g.feature(Ue);Se.updatePaintArray(rt,Qe,ht,Re,S,A,N,q)}))}Z=!0}}return Z}defines(){const n=[];for(const o in this.binders){const d=this.binders[o];(d instanceof c_||d instanceof lg)&&n.push(...d.uniformNames.map((g=>`#define HAS_UNIFORM_${g}`)))}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof c_||g instanceof lg||g instanceof gh)for(const w of g.uniformNames)o.push({name:w,property:d,binding:g.getBinding(n,w)})}return o}setUniforms(n,o,d,g,w){for(const{name:S,property:A,binding:L}of d)this.binders[A].setUniform(n,L,w,g.get(A),S)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Af||o instanceof gh||o instanceof Wh)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof Wh&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(n){for(const o in this.binders){const d=this.binders[o];(d instanceof Af||d instanceof gh||d instanceof Wh)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof Af||o instanceof gh||o instanceof Wh)&&o.destroy()}}}class gc{constructor(n,o,d=(()=>!0)){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new Pf(g,o,d);this.needsUpload=!1,this._featureMap=new rg,this._featureMapWithoutIds=new rg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,d,g,w,S,A,L,N){for(const q in this.programConfigurations)this.programConfigurations[q].populatePaintArrays(n,o,g,w,S,A,L,N);o.id!==void 0?this._featureMap.add(o.id,d,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,d,g,w,S,A,L){for(const N of d)this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,N,g,w,S,A||0,L)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const u_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Eb(a,n){return u_[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}const Ib={"line-pattern":{source:wl,composite:wl},"fill-pattern":{source:wl,composite:wl},"fill-extrusion-pattern":{source:wl,composite:wl},"line-dasharray":{source:Xc,composite:Xc}},Cb={color:{source:yu,composite:Ml},number:{source:ma,composite:yu}};function b0(a,n,o){const d=Ib[a];return d&&d[o]||Cb[n][o]}Cn(c_,"ConstantBinder"),Cn(lg,"PatternConstantBinder"),Cn(Af,"SourceExpressionBinder"),Cn(Wh,"PatternCompositeBinder"),Cn(gh,"CompositeExpressionBinder"),Cn(Pf,"ProgramConfiguration",{omit:["_buffers"]}),Cn(gc,"ProgramConfigurationSet");const Ql=Ji/Math.PI/2,_h=5,gy=6,w0=16383,cg=64,_y=[cg,32,16],Mc=-Ql,yh=Ql;function ra(a,n,o,d=Ql){return o=ns(o),[a*Math.sin(o)*d,-n*d,a*Math.cos(o)*d]}function Zh(a,n,o){return ra(Math.cos(ns(a)),Math.sin(ns(a)),n,o)}const v=63710088e-1,r=2*Math.PI*v;class h{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new h(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,d=this.lat*o,g=n.lat*o,w=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((n.lng-this.lng)*o);return v*Math.acos(Math.min(w,1))}toBounds(n=0){const o=360*n/40075017,d=o/Math.cos(Math.PI/180*this.lat);return new x({lng:this.lng-d,lat:this.lat-o},{lng:this.lng+d,lat:this.lat+o})}toEcef(n){return Zh(this.lat,this.lng,Ql+n*Ql/v)}static convert(n){if(n instanceof h)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new h(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new h(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class x{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):Array.isArray(n)&&n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof h?new h(n.lng,n.lat):h.convert(n),this}setSouthWest(n){return this._sw=n instanceof h?new h(n.lng,n.lat):h.convert(n),this}extend(n){const o=this._sw,d=this._ne;let g,w;if(n instanceof h)g=n,w=n;else{if(!(n instanceof x))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(x.convert(n)):this.extend(h.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(h.convert(n)):this;if(g=n._sw,w=n._ne,!g||!w)return this}return o||d?(o.lng=Math.min(g.lng,o.lng),o.lat=Math.min(g.lat,o.lat),d.lng=Math.max(w.lng,d.lng),d.lat=Math.max(w.lat,d.lat)):(this._sw=new h(g.lng,g.lat),this._ne=new h(w.lng,w.lat)),this}getCenter(){return new h((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h(this.getWest(),this.getNorth())}getSouthEast(){return new h(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:d}=h.convert(n);let g=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(n){if(n)return n instanceof x?n:new x(n)}}const E=0,M=25.5;function k(a){return r*Math.cos(a*Math.PI/180)}function B(a){return(180+a)/360}function G(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function J(a,n){return a/k(n)}function ee(a){return 360*a-180}function ce(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function le(a,n){return a*k(ce(n))}const he=85.051129;function be(a){return Math.cos(ns(we(a,-he,he)))}function _e(a,n){const o=we(n,E,M),d=Math.pow(2,o);return be(a)*r/(512*d)}function ke(a){return 1/Math.cos(a*Math.PI/180)}function Ae(a,n=0){const o=Math.exp(Math.PI*(1-(a.y+n/Ji)/(1<<a.z)*2));return 80150034*o/(o*o+1)/Ji/(1<<a.z)}class Oe{constructor(n,o,d=0){this.x=+n,this.y=+o,this.z=+d}static fromLngLat(n,o=0){const d=h.convert(n);return new Oe(B(d.lng),G(d.lat),J(o,d.lat))}toLngLat(){return new h(ee(this.x),ce(this.y))}toAltitude(){return le(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/r*ke(ce(this.y))}}function He(a,n,o,d,g,w,S,A,L){const N=(n+d)/2,q=(o+g)/2,Z=new yi(N,q);A(Z),(function(Q,ne,oe,me,Se,Te){const Le=oe-Se,Re=me-Te;return Math.abs((me-ne)*Le-(oe-Q)*Re)/Math.hypot(Le,Re)})(Z.x,Z.y,w.x,w.y,S.x,S.y)>=L?(He(a,n,o,N,q,w,Z,A,L),He(a,N,q,d,g,Z,S,A,L)):a.push(S)}function Be(a,n,o){let d=a[0],g=d.x,w=d.y;n(d);const S=[d];for(let A=1;A<a.length;A++){const L=a[A],{x:N,y:q}=L;n(L),He(S,g,w,N,q,d,L,n,o),g=N,w=q,d=L}return S}function dt(a,n,o,d){if(d(n,o)){const g=n.add(o)._mult(.5);dt(a,n,g,d),dt(a,g,o,d)}else a.push(o)}function nt(a,n){let o=a[0];const d=[o];for(let g=1;g<a.length;g++){const w=a[g];dt(d,o,w,n),o=w}return d}const at=Math.pow(2,14)-1,tt=-at-1;function Je(a,n){const o=Math.round(a.x*n),d=Math.round(a.y*n);return a.x=we(o,tt,at),a.y=we(d,tt,at),(o<a.x||o>a.x+1||d<a.y||d>a.y+1)&&mn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function mt(a,n,o){const d=a.loadGeometry(),g=a.extent,w=Ji/g;if(n&&o&&o.projection.isReprojectedInTileSpace){const S=1<<n.z,{scale:A,x:L,y:N,projection:q}=o,Z=Q=>{const ne=ee((n.x+Q.x/g)/S),oe=ce((n.y+Q.y/g)/S),me=q.project(ne,oe);Q.x=(me.x*A-L)*g,Q.y=(me.y*A-N)*g};for(let Q=0;Q<d.length;Q++)if(a.type!==1)d[Q]=Be(d[Q],Z,1);else{const ne=[];for(const oe of d[Q])oe.x<0||oe.x>=g||oe.y<0||oe.y>=g||(Z(oe),ne.push(oe));d[Q]=ne}}for(const S of d)for(const A of S)Je(A,w);return d}function Pt(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?mt(a):[]}}class It{constructor(n,o,d,g,w){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=g,this._values=w,n.readFields(ri,this,o)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const o=n.readVarint()+n.pos,d=[];let g,w=1,S=0,A=0,L=0;for(;n.pos<o;){if(S<=0){const N=n.readVarint();w=7&N,S=N>>3}if(S--,w===1||w===2)A+=n.readSVarint(),L+=n.readSVarint(),w===1&&(g&&d.push(g),g=[]),g&&g.push(new yi(A,L));else{if(w!==7)throw new Error(`unknown command ${w}`);g&&g.push(g[0].clone())}}return g&&d.push(g),d}bbox(){const n=this._pbf;n.pos=this._geometry;const o=n.readVarint()+n.pos;let d=1,g=0,w=0,S=0,A=1/0,L=-1/0,N=1/0,q=-1/0;for(;n.pos<o;){if(g<=0){const Z=n.readVarint();d=7&Z,g=Z>>3}if(g--,d===1||d===2)w+=n.readSVarint(),S+=n.readSVarint(),w<A&&(A=w),w>L&&(L=w),S<N&&(N=S),S>q&&(q=S);else if(d!==7)throw new Error(`unknown command ${d}`)}return[A,N,L,q]}toGeoJSON(n,o,d){const g=this.extent*Math.pow(2,d),w=this.extent*n,S=this.extent*o,A=this.loadGeometry();function L(Q){return[360*(Q.x+w)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(Q.y+S)/g)*Math.PI))-90]}function N(Q){return Q.map(L)}let q;if(this.type===1){const Q=[];for(const oe of A)Q.push(oe[0]);const ne=N(Q);q=Q.length===1?{type:"Point",coordinates:ne[0]}:{type:"MultiPoint",coordinates:ne}}else if(this.type===2){const Q=A.map(N);q=Q.length===1?{type:"LineString",coordinates:Q[0]}:{type:"MultiLineString",coordinates:Q}}else{if(this.type!==3)throw new Error("unknown feature type");{const Q=(function(oe){const me=oe.length;if(me<=1)return[oe];const Se=[];let Te,Le;for(let Re=0;Re<me;Re++){const Ue=si(oe[Re]);Ue!==0&&(Le===void 0&&(Le=Ue<0),Le===Ue<0?(Te&&Se.push(Te),Te=[oe[Re]]):Te&&Te.push(oe[Re]))}return Te&&Se.push(Te),Se})(A),ne=[];for(const oe of Q)ne.push(oe.map(N));q=ne.length===1?{type:"Polygon",coordinates:ne[0]}:{type:"MultiPolygon",coordinates:ne}}}const Z={type:"Feature",geometry:q,properties:this.properties};return this.id!=null&&(Z.id=this.id),Z}}function ri(a,n,o){a===1?n.id=o.readVarint():a===2?(function(d,g){const w=d.readVarint()+d.pos;for(;d.pos<w;){const S=g._keys[d.readVarint()],A=g._values[d.readVarint()];g.properties[S]=A}})(o,n):a===3?n.type=o.readVarint():a===4&&(n._geometry=o.pos)}function si(a){let n=0;for(let o,d,g=0,w=a.length,S=w-1;g<w;S=g++)o=a[g],d=a[S],n+=(d.x-o.x)*(o.y+d.y);return n}It.types=["Unknown","Point","LineString","Polygon"];class _i{constructor(n,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Vi,this,o),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const o=this._pbf.readVarint()+this._pbf.pos;return new It(this._pbf,o,this.extent,this._keys,this._values)}}function Vi(a,n,o){a===15?n.version=o.readVarint():a===1?n.name=o.readString():a===5?n.extent=o.readVarint():a===2?n._features.push(o.pos):a===3?n._keys.push(o.readString()):a===4&&n._values.push((function(d){let g=null;const w=d.readVarint()+d.pos;for(;d.pos<w;){const S=d.readVarint()>>3;g=S===1?d.readString():S===2?d.readFloat():S===3?d.readDouble():S===4?d.readVarint64():S===5?d.readVarint():S===6?d.readSVarint():S===7?d.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g})(o))}class Kt{constructor(n,o){this.layers=n.readFields(bt,{},o)}}function bt(a,n,o){if(a===3){const d=new _i(o,o.readVarint()+o.pos);d.length&&(n[d.name]=d)}}const oi="3d_elevation_id",ni="level";class Li{constructor(){this._valid=!1}reset(n){return this.feature=n,this._valid=!0,this._geometry=n.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(n,o){return this._valid&&n(o(this._geometry)),this}require(n,o,d){return this.get(n,!0,o,d)}optional(n,o,d){return this.get(n,!1,o,d)}success(){return this._valid}get(n,o,d,g){const w=this.feature.properties.hasOwnProperty(n)?+this.feature.properties[n]:void 0;return this._valid&&w!==void 0&&!Number.isNaN(w)?d(g?g(w):w):o&&(this._valid=!1),this}}class en{constructor(n,o){this.featureFunc=n,this.vertexFunc=o}parseFeature(n,o,d){return this.featureFunc(n,o,d)}parseVertex(n,o,d){return this.vertexFunc(n,o,d)}}const xn=new en(((a,n,o)=>a.reset(n).require(oi,(d=>{o.id=d})).optional("fixed_height_relative",(d=>{o.constantHeight=d}),Wi.decodeRelativeHeight).geometry((d=>{o.bounds=d}),sh).success()),((a,n,o)=>a.reset(n).require(oi,(d=>{o.id=d})).require("elevation_idx",(d=>{o.idx=d})).require("extent",(d=>{o.extent=d})).require("height_relative",(d=>{o.height=d}),Wi.decodeRelativeHeight).geometry((d=>{o.position=d}),Wi.getPoint).success())),Yi=new en(((a,n,o)=>a.reset(n).require(oi,(d=>{o.id=d})).optional("fixed_height",(d=>{o.constantHeight=d}),Wi.decodeMetricHeight).geometry((d=>{o.bounds=d}),sh).success()),((a,n,o)=>a.reset(n).require(oi,(d=>{o.id=d})).require("elevation_idx",(d=>{o.idx=d})).require("extent",(d=>{o.extent=d})).require("height",(d=>{o.height=d}),Wi.decodeMetricHeight).geometry((d=>{o.position=d}),Wi.getPoint).success()));class Wi{static getPoint(n){return Ci(n[0][0].x,n[0][0].y)}static decodeRelativeHeight(n){return 1e-4*n*5}static decodeMetricHeight(n){return 1e-4*n}static getVersionSchema(n){return n?n==="1.0.1"?Yi:void 0:xn}static parse(n){const o=[],d=[],g=n.length,w=new Li;for(let S=0;S<g;S++){const A=n.feature(S),L=A.properties.version,N=Wi.getVersionSchema(L);if(N===void 0){mn(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const q=A.properties.type;if(!q)continue;const Z=It.types[A.type];if(Z==="Point"&&q==="curve_point"){const Q={};N.parseVertex(w,A,Q)&&o.push(Q)}else if(Z==="Polygon"&&q==="curve_meta"){const Q={};N.parseFeature(w,A,Q)&&d.push(Q)}}return{vertices:o,features:d}}}class kn{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,d){const g=Js(o,this.dir);if(Math.abs(g)<1e-6)return!1;const w=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1])/g;return d[0]=this.pos[0]+this.dir[0]*w,d[1]=this.pos[1]+this.dir[1]*w,!0}}class Pn{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,d){const g=gn(o,this.dir);if(Math.abs(g)<1e-6)return!1;const w=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/g;return d[0]=this.pos[0]+this.dir[0]*w,d[1]=this.pos[1]+this.dir[1]*w,d[2]=this.pos[2]+this.dir[2]*w,!0}closestPointOnSphere(n,o,d){if((function(ne,oe){var me=ne[0],Se=ne[1],Te=ne[2],Le=oe[0],Re=oe[1],Ue=oe[2];return Math.abs(me-Le)<=P*Math.max(1,Math.abs(me),Math.abs(Le))&&Math.abs(Se-Re)<=P*Math.max(1,Math.abs(Se),Math.abs(Re))&&Math.abs(Te-Ue)<=P*Math.max(1,Math.abs(Te),Math.abs(Ue))})(this.pos,n)||o===0)return d[0]=d[1]=d[2]=0,!1;const[g,w,S]=this.dir,A=this.pos[0]-n[0],L=this.pos[1]-n[1],N=this.pos[2]-n[2],q=g*g+w*w+S*S,Z=2*(A*g+L*w+N*S),Q=Z*Z-4*q*(A*A+L*L+N*N-o*o);if(Q<0){const ne=Math.max(-Z/2,0),oe=A+g*ne,me=L+w*ne,Se=N+S*ne,Te=Math.hypot(oe,me,Se);return d[0]=oe*o/Te,d[1]=me*o/Te,d[2]=Se*o/Te,!1}{const ne=(-Z-Math.sqrt(Q))/(2*q);if(ne<0){const oe=Math.hypot(A,L,N);return d[0]=A*o/oe,d[1]=L*o/oe,d[2]=N*o/oe,!1}return d[0]=A+g*ne,d[1]=L+w*ne,d[2]=N+S*ne,!0}}}class pn{constructor(n,o,d,g,w){this.TL=n,this.TR=o,this.BR=d,this.BL=g,this.horizon=w}static fromInvProjectionMatrix(n,o,d){const g=[-1,1,1],w=[1,1,1],S=[1,-1,1],A=[-1,-1,1],L=St(g,g,n),N=St(w,w,n),q=St(S,S,n),Z=St(A,A,n);return new pn(L,N,q,Z,o/d)}}function Tn(a,n,o){let d=1/0,g=-1/0;const w=[];for(const S of a){pt(w,S,n);const A=gn(w,o);d=Math.min(d,A),g=Math.max(g,A)}return[d,g]}function Kn(a,n){let o=!0;for(let d=0;d<a.planes.length;d++){const g=a.planes[d];let w=0;for(let S=0;S<n.length;S++)w+=+(gn(g,n[S])+g[3]>=0);if(w===0)return 0;w!==n.length&&(o=!1)}return o?2:1}function Er(a,n){for(const o of a.projections){const d=Tn(n,a.points[0],o.axis);if(o.projection[1]<d[0]||o.projection[0]>d[1])return 0}return 1}function ts(a,n){let o=0;const d=[0,0,0,0];for(let S=0;S<a.length;S++)d[0]=a[S][0],d[1]=a[S][1],d[2]=a[S][2],d[3]=1,(g=d)[0]*(w=n)[0]+g[1]*w[1]+g[2]*w[2]+g[3]*w[3]>=0&&o++;var g,w;return o}class ys{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Ln.fromPoints(this.points),this.projections=[],this.frustumEdges=[pt([],this.points[2],this.points[3]),pt([],this.points[0],this.points[3]),pt([],this.points[4],this.points[0]),pt([],this.points[5],this.points[1]),pt([],this.points[6],this.points[2]),pt([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const g=[0,-d[2],d[1]],w=[d[2],0,-d[0]];this.projections.push({axis:g,projection:Tn(this.points,this.points[0],g)}),this.projections.push({axis:w,projection:Tn(this.points,this.points[0],w)})}}static fromInvProjectionMatrix(n,o,d,g){const w=Math.pow(2,d),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((N=>{const q=Bt([],N,n),Z=1/q[3]/o*w;return(Q=q)[0]=(ne=q)[0]*(oe=[Z,Z,g?1/q[3]:Z,Z])[0],Q[1]=ne[1]*oe[1],Q[2]=ne[2]*oe[2],Q[3]=ne[3]*oe[3],Q;var Q,ne,oe})),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((N=>{const q=Gi([],nr([],pt([],S[N[0]],S[N[1]]),pt([],S[N[2]],S[N[1]]))),Z=-gn(q,S[N[1]]);return q.concat(Z)})),L=[];for(let N=0;N<S.length;N++)L.push([S[N][0],S[N][1],S[N][2]]);return new ys(L,A)}intersectsPrecise(n,o,d){for(let g=0;g<o.length;g++)if(!ts(n,o[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!ts(n,this.planes[g]))return 0;for(const g of d)for(const w of this.frustumEdges){const S=nr([],g,w),A=$t(S);if(A===0)continue;Fn(S,S,1/A);const L=Tn(this.points,this.points[0],S),N=Tn(n,this.points[0],S);if(L[0]>N[1]||N[0]>L[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const d=o[3];if(gn([o[0],o[1],o[2]],n)+d<0)return!1}return!0}}class Ln{static fromPoints(n){const o=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const g of n)wn(o,o,g),qn(d,d,g);return new Ln(o,d)}static fromTileIdAndHeight(n,o,d){const g=1<<n.canonical.z,w=n.canonical.x,S=n.canonical.y;return new Ln([w/g,S/g,o],[(w+1)/g,(S+1)/g,d])}static applyTransform(n,o){const d=n.getCorners();for(let g=0;g<d.length;++g)St(d[g],d[g],o);return Ln.fromPoints(d)}static applyTransformFast(n,o){const d=[o[12],o[13],o[14]],g=[...d];for(let w=0;w<3;w++)for(let S=0;S<3;S++){const A=o[4*S+w],L=A*n.min[S],N=A*n.max[S];d[w]+=Math.min(L,N),g[w]+=Math.max(L,N)}return new Ln(d,g)}static projectAabbCorners(n,o){const d=n.getCorners();for(let g=0;g<d.length;++g)St(d[g],d[g],o);return d}constructor(n,o){this.min=n,this.max=o,this.center=Fn([],vt([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],d=Wt(this.min),g=Wt(this.max);for(let w=0;w<o.length;w++)d[w]=o[w]?this.min[w]:this.center[w],g[w]=o[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Ln(d,g)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Kn(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Kn(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?Er(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?Er(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Cn(Ln,"Aabb");class fs{constructor(n,o){this.feature=n,this.metersToTile=o,this.index=0}get(){const n=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,d=o[1],g=-o[0],w=(n.extent+1)*this.metersToTile;return[new yi(Math.trunc(n.position[0]+d*w),Math.trunc(n.position[1]+g*w)),new yi(Math.trunc(n.position[0]-d*w),Math.trunc(n.position[1]-g*w))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class br{constructor(n,o,d,g,w,S){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[ii(),ii(),ii(),ii(),ii(),ii(),ii()],this.id=n,this.heightRange={min:d,max:d},this.safeArea=o,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||g.length!==0)){this.vertices=g,this.edges=w,this.edges=this.edges.filter((A=>{return A.a<this.vertices.length&&A.b<this.vertices.length&&!((L=this.vertices[A.a].position)[0]===(N=this.vertices[A.b].position)[0]&&L[1]===N[1]);var L,N})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const A of this.vertices)this.vertexProps.push({dir:Ci(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,A.height),this.heightRange.max=Math.max(this.heightRange.max,A.height);for(const A of this.edges){const L=this.vertices[A.a].position,N=this.vertices[A.b].position,q=Zn(ii(),N,L),Z=Gr(q),Q=fr(ii(),q,1/Z);this.edgeProps.push({vec:q,dir:Q,len:Z});const ne=this.vertexProps[A.a].dir,oe=this.vertexProps[A.b].dir;nn(ne,ne,Q),nn(oe,oe,Q)}for(const A of this.vertexProps)A.dir[0]===0&&A.dir[1]===0||xo(A.dir,A.dir);this.tessellate(S)}}pointElevation(n){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(n);if(o==null)return 0;const[d,g]=o;return Gn(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,g)}computeSlopeNormal(n,o){const d=this.getClosestEdge(n);if(!d)return Dt(0,0,1);const g=d[0],w=this.edges[g],S=this.edgeProps[g].vec,A=Dt(S[0],S[1],(this.vertices[w.b].height-this.vertices[w.a].height)*o),L=Dt(A[1],-A[0],0);nr(L,L,A);const N=$t(L);return N>0?Fn(L,L,1/N):Ft(L,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(n){if(this.edges.length===0)return;let o=0,d=Number.POSITIVE_INFINITY,g=0;const[w,S,A,L,N,q,Z]=this._tmpVec2;un(Z,n.x,n.y);const Q=new kn(Z,null);for(let ne=0;ne<this.edges.length;ne++){const oe=this.edges[ne],me=this.edgeProps[ne].dir;Q.dir=me;const Se=this.vertices[oe.a].position,Te=this.vertices[oe.b].position,Le=Q.intersectsPlane(Se,this.vertexProps[oe.a].dir,w),Re=Q.intersectsPlane(Te,this.vertexProps[oe.b].dir,S);if(!Le||!Re)continue;Zn(A,S,w),Zn(L,Z,w);const Ue=Js(A,A),rt=Ue>0?Js(L,A)/Ue:0,Qe=we(rt,0,1),ht=Math.abs((rt-Qe)*this.edgeProps[ne].len);Zn(N,Z,Se),un(q,me[1],-me[0]);const yt=ht+Math.abs(Js(N,q));yt<d&&(o=ne,d=yt,g=Qe)}return[o,g]}tessellate(n){const o=ci(),d=ci(),g=ci(),w=ci();for(let S=this.edges.length-1;S>=0;--S){const A=this.edges[S].a,L=this.edges[S].b,{position:N,height:q,extent:Z}=this.vertices[A],{position:Q,height:ne,extent:oe}=this.vertices[L],me=this.vertexProps[A].dir,Se=this.vertexProps[L].dir;if(Ft(o,N[0]/n,N[1]/n,q),Ft(d,Q[0]/n,Q[1]/n,ne),Ft(g,me[1],-me[0],0),Fn(g,g,Z),Ft(w,Se[1],-Se[0],0),Fn(w,w,oe),this.distSqLines(Dt(o[0]+.5*g[0],o[1]+.5*g[1],o[2]+.5*g[2]),Dt(d[0]-.5*w[0],d[1]-.5*w[1],d[2]-.5*w[2]),Dt(o[0]-.5*g[0],o[1]-.5*g[1],o[2]-.5*g[2]),Dt(d[0]+.5*w[0],d[1]+.5*w[1],d[2]+.5*w[2]))<=.0025000000000000005)continue;const Te=this.vertices.length,Le=nn(ii(),N,Q);this.vertices.push({position:fr(Le,Le,.5),height:.5*(q+ne),extent:.5*(Z+oe)});const Re=nn(ii(),me,Se);this.vertexProps.push({dir:xo(Re,Re)}),this.edges.splice(S,1),this.edgeProps.splice(S,1),this.edges.push({a:A,b:Te}),this.edges.push({a:Te,b:L});const Ue=Zn(ii(),this.vertices[Te].position,N),rt=Gr(Ue),Qe={vec:Ue,dir:fr(ii(),Ue,1/rt),len:rt};this.edgeProps.push(Qe),this.edgeProps.push(Qe)}}distSqLines(n,o,d,g){const w=wi(ci(),o,n),S=wi(ci(),g,d),A=wi(ci(),n,d),L=gn(w,w),N=gn(w,S),q=gn(w,A),Z=gn(S,S),Q=gn(S,A),ne=L*Z-N*N;if(ne===0)return Hr(Ur(w,d,g,gn(A,S)/gn(S,S)),n);const oe=(L*Q-N*q)/ne;return Hr(Ur(w,n,o,(N*Q-q*Z)/ne),Ur(S,d,g,oe))}}class Ts{static parseFrom(n,o){const d=Wi.parse(n);if(!d)return[];let{vertices:g,features:w}=d;const S=1/Ae(o);w.sort(((q,Z)=>q.id-Z.id)),g.sort(((q,Z)=>q.id-Z.id||q.idx-Z.idx)),g=g.filter(((q,Z,Q)=>Z===Q.findIndex((ne=>ne.id===q.id&&ne.idx===q.idx))));const A=new Array;let L=0;const N=g.length;for(const q of w){if(q.constantHeight){A.push(new br(q.id,q.bounds,q.constantHeight));continue}for(;L!==N&&g[L].id<q.id;)L++;if(L===N||g[L].id!==q.id)continue;const Z=new Array,Q=new Array,ne=L;for(;L!==N&&g[L].id===q.id;){const oe=g[L];if(Z.push({position:oe.position,height:oe.height,extent:oe.extent}),L!==ne&&g[L-1].idx===oe.idx-1){const me=L-ne;Q.push({a:me-1,b:me})}L++}A.push(new br(q.id,q.bounds,void 0,Z,Q,S))}return A}static getElevationFeature(n,o){if(!o)return;const d=+n.properties[oi];return Number.isNaN(d)?void 0:o.find((g=>g.id===d))}}class zs{constructor(n,o){this.zScale=1,this.xOffset=0,this.yOffset=0,n.equals(o)||(this.zScale=Math.pow(2,o.z-n.z),this.xOffset=(n.x*this.zScale-o.x)*Ji,this.yOffset=(n.y*this.zScale-o.y)*Ji)}constantElevation(n,o){if(n.constantHeight!=null)return this.computeBiasedHeight(n.constantHeight,o)}pointElevation(n,o,d){const g=this.constantElevation(o,d);return g??(n.x=n.x*this.zScale+this.xOffset,n.y=n.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(n),d))}computeBiasedHeight(n,o){return o<=0?n:n+o*Ie(0,o,n>=0?n:Math.abs(.5*n))}}Cn(br,"ElevationFeature");class Os{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new pa,this.indexArray=new $o,this.segments=new bo,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ma),this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,d,g){}populate(n,o,d,g){const w=this.layers[0],S=[];let A=null;w.type==="circle"&&(A=w.layout.get("circle-sort-key"));for(const{feature:N,id:q,index:Z,sourceLayerIndex:Q}of n){const ne=this.layers[0]._featureFilter.needGeometry,oe=Pt(N,ne);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),oe,d))continue;const me=A?A.evaluate(oe,{},d):void 0,Se={id:q,properties:N.properties,type:N.type,sourceLayerIndex:Q,index:Z,geometry:ne?oe.geometry:mt(N,d,g),patterns:{},sortKey:me};S.push(Se)}A&&S.sort(((N,q)=>N.sortKey-q.sortKey));let L=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new mc,L=g.projection);for(const N of S){const{geometry:q,index:Z,sourceLayerIndex:Q}=N,ne=n[Z].feature;this.addFeature(N,q,Z,o.availableImages,d,L,o.brightness,o.elevationFeatures),o.featureIndex.insert(ne,q,Z,Q,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(n,o,d,g,w,S,A){this.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Tv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,fy.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,Sv.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(n,o,d,g,w,S,A,L){let N;this.elevationMode!=="none"&&(N=Ts.getElevationFeature(n,L));for(const q of o)for(const Z of q){const Q=Z.x,ne=Z.y;if(Q<0||Q>=Ji||ne<0||ne>=Ji)continue;if(S){const Se=S.projectTilePoint(Q,ne,w),Te=S.upVector(w,Q,ne);this.addGlobeExtVertex(Se,Te),this.addGlobeExtVertex(Se,Te),this.addGlobeExtVertex(Se,Te),this.addGlobeExtVertex(Se,Te)}const oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),me=oe.vertexLength;if(this.addCircleVertex(Q,ne,-1,-1),this.addCircleVertex(Q,ne,1,-1),this.addCircleVertex(Q,ne,1,1),this.addCircleVertex(Q,ne,-1,1),this.elevationMode!=="none"){const Se=N?N.pointElevation(new yi(Q,ne)):0;this.hasElevation=this.hasElevation||Se!==0;for(let Te=0;Te<4;Te++)this.elevatedLayoutVertexArray.emplaceBack(Se)}this.indexArray.emplaceBack(me,me+1,me+2),this.indexArray.emplaceBack(me,me+2,me+3),oe.vertexLength+=4,oe.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},g,w,A,void 0,this.worldview)}addCircleVertex(n,o,d,g){this.layoutVertexArray.emplaceBack(2*n+(d+1)/2,2*o+(g+1)/2)}addGlobeExtVertex(n,o){this.globeExtVertexArray.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}}function ls(a,n){for(let o=0;o<a.length;o++)if(Zs(n,a[o]))return!0;for(let o=0;o<n.length;o++)if(Zs(a,n[o]))return!0;return!!yo(a,n)}function Ar(a,n,o){return!!Zs(a,n)||!!co(n,a,o)}function vs(a,n){if(a.length===1)return uo(n,a[0]);for(let o=0;o<n.length;o++){const d=n[o];for(let g=0;g<d.length;g++)if(Zs(a,d[g]))return!0}for(let o=0;o<a.length;o++)if(uo(n,a[o]))return!0;for(let o=0;o<n.length;o++)if(yo(a,n[o]))return!0;return!1}function ko(a,n,o){if(a.length>1){if(yo(a,n))return!0;for(let d=0;d<n.length;d++)if(co(n[d],a,o))return!0}for(let d=0;d<a.length;d++)if(co(a[d],n,o))return!0;return!1}function yo(a,n){if(a.length===0||n.length===0)return!1;for(let o=0;o<a.length-1;o++){const d=a[o],g=a[o+1];for(let w=0;w<n.length-1;w++)if(Ms(d,g,n[w],n[w+1]))return!0}return!1}function Ms(a,n,o,d){return Tr(a,o,d)!==Tr(n,o,d)&&Tr(a,n,o)!==Tr(a,n,d)}function cs(a,n,o){return(a.x-o.x)*(n.y-o.y)-(a.y-o.y)*(n.x-o.x)}function Pr(a,n,o,d){const g=cs(a,n,d),w=cs(a,n,o);if(Math.sign(g)===Math.sign(w))return;const S=cs(o,d,a),A=S+w-g;return Math.sign(S)!==Math.sign(A)?[S/(S-A),w/(w-g)]:void 0}function co(a,n,o){const d=o*o;if(n.length===1)return a.distSqr(n[0])<d;for(let g=1;g<n.length;g++)if(Ss(a,n[g-1],n[g])<d)return!0;return!1}function Ss(a,n,o){const d=n.distSqr(o);if(d===0)return a.distSqr(n);const g=((a.x-n.x)*(o.x-n.x)+(a.y-n.y)*(o.y-n.y))/d;return a.distSqr(g<0?n:g>1?o:o.sub(n)._mult(g)._add(n))}function uo(a,n){let o,d,g,w=!1;for(let S=0;S<a.length;S++){o=a[S];for(let A=0,L=o.length-1;A<o.length;L=A++)d=o[A],g=o[L],d.y>n.y!=g.y>n.y&&n.x<(g.x-d.x)*(n.y-d.y)/(g.y-d.y)+d.x&&(w=!w)}return w}function Zs(a,n){let o=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const w=a[d],S=a[g];w.y>n.y!=S.y>n.y&&n.x<(S.x-w.x)*(n.y-w.y)/(S.y-w.y)+w.x&&(o=!o)}return o}function kc(a,n,o,d,g){for(const S of a)if(n<=S.x&&o<=S.y&&d>=S.x&&g>=S.y)return!0;const w=[new yi(n,o),new yi(n,g),new yi(d,g),new yi(d,o)];if(a.length>2){for(const S of w)if(Zs(a,S))return!0}for(let S=0;S<a.length-1;S++)if(Dl(a[S],a[S+1],w))return!0;return!1}function Dl(a,n,o){const d=o[0],g=o[2];if(a.x<d.x&&n.x<d.x||a.x>g.x&&n.x>g.x||a.y<d.y&&n.y<d.y||a.y>g.y&&n.y>g.y)return!1;const w=Tr(a,n,o[0]);return w!==Tr(a,n,o[1])||w!==Tr(a,n,o[2])||w!==Tr(a,n,o[3])}function Fa(a,n,o,d,g,w){let S=n.y-a.y,A=a.x-n.x;if(w=w||0){const L=S*S+A*A;if(L===0)return!0;const N=Math.sqrt(L);S/=N,A/=N}return!((o.x-a.x)*S+(o.y-a.y)*A-w<0||(d.x-a.x)*S+(d.y-a.y)*A-w<0||(g.x-a.x)*S+(g.y-a.y)*A-w<0)}function ec(a,n,o,d,g,w,S){return!(Fa(a,n,d,g,w,S)||Fa(n,o,d,g,w,S)||Fa(o,a,d,g,w,S)||Fa(d,g,a,n,o,S)||Fa(g,w,a,n,o,S)||Fa(w,d,a,n,o,S))}function Ul(a,n,o){const d=n.paint.get(a).value;return d.kind==="constant"?d.value:o.programConfigurations.get(n.id).getMaxValue(a)}function Tl(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function tc(a,n,o,d,g){if(!n[0]&&!n[1])return a;const w=yi.convert(n)._mult(g);o==="viewport"&&w._rotate(-d);const S=[];for(let A=0;A<a.length;A++)S.push(a[A].sub(w));return S}function vu(a,n,o,d){const g=yi.convert(a)._mult(d);return n==="viewport"&&g._rotate(-o),g}let Dc,Do;function Go(a,n,o){var d=2*Math.PI*6378137/256/Math.pow(2,o);return[a*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}Cn(Os,"CircleBucket",{omit:["layers"]});class Ds{constructor(n,o,d){this.z=n,this.x=o,this.y=d,this.key=Io(0,n,n,o,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}isChildOf(n){const o=this.z-n.z;return n.z===0||n.z<this.z&&n.x===this.x>>o&&n.y===this.y>>o}url(n,o){const d=(function(w,S,A){var L=Go(256*w,256*(S=Math.pow(2,A)-S-1),A),N=Go(256*(w+1),256*(S+1),A);return L[0]+","+L[1]+","+N[0]+","+N[1]})(this.x,this.y,this.z),g=(function(w,S,A){let L,N="";for(let q=w;q>0;q--)L=1<<q-1,N+=(S&L?1:0)+(A&L?2:0);return N})(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class la{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Io(n,o.z,o.z,o.x,o.y)}}class Lo{constructor(n,o,d,g,w){this.overscaledZ=n,this.wrap=o,this.canonical=new Ds(d,+g,+w),this.key=o===0&&n===d?this.canonical.key:Io(o,n,d,g,w)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new Lo(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lo(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Io(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-n;return Io(this.wrap*+o,n,n,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new Lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Lo(o,this.wrap,o,d,g),new Lo(o,this.wrap,o,d+1,g),new Lo(o,this.wrap,o,d,g+1),new Lo(o,this.wrap,o,d+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Lo(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new la(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Io(a,n,o,d,g){const w=1<<Math.min(o,22);let S=w*(g%w)+d%w;return a&&o<22&&(S+=w*w*((a<0?-2*a-1:2*a)%(1<<2*(22-o)))),16*(32*S+o)+(n-o)}const vh=[a=>{let n=a.canonical.x-1,o=a.wrap;return n<0&&(n=(1<<a.canonical.z)-1,o--),new Lo(a.overscaledZ,o,a.canonical.z,n,a.canonical.y)},a=>{let n=a.canonical.x+1,o=a.wrap;return n===1<<a.canonical.z&&(n=0,o++),new Lo(a.overscaledZ,o,a.canonical.z,n,a.canonical.y)},a=>new Lo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Lo(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Cn(Ds,"CanonicalTileID"),Cn(Lo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const h_=hr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xh}=h_,d_=hr([{name:"a_pos_3",components:3,type:"Int16"}]);var ug=hr([{name:"a_pos",type:"Int16",components:2}]);function Od(a){return a*Ql/v}const Mf=[new Ln([Mc,Mc,Mc],[yh,yh,yh]),new Ln([Mc,Mc,Mc],[0,0,yh]),new Ln([0,Mc,Mc],[yh,0,yh]),new Ln([Mc,0,Mc],[0,yh,yh]),new Ln([0,0,Mc],[yh,yh,yh])];function hg(a,n,o,d=!0){const g=Fn([],a._camera.position,a.worldSize),w=[n,o,1,1];Bt(w,w,a.pixelMatrixInverse),on(w,w,1/w[3]);const S=Gi([],pt([],w,g)),A=a.globeMatrix,L=[A[12],A[13],A[14]],N=pt([],L,g),q=$t(N),Z=Gi([],N),Q=a.worldSize/(2*Math.PI),ne=gn(Z,S),oe=Math.asin(Q/q);if(oe<Math.acos(ne)){if(!d)return null;const ai=[],kt=[];Fn(ai,S,q/ne),Gi(kt,pt(kt,ai,N)),Gi(S,vt(S,N,Fn(S,kt,Math.tan(oe)*q)))}const me=[];new Pn(g,S).closestPointOnSphere(L,Q,me);const Se=Gi([],oo(A,0)),Te=Gi([],oo(A,1)),Le=Gi([],oo(A,2)),Re=gn(Se,me),Ue=gn(Te,me),rt=gn(Le,me),Qe=Ja(Math.asin(-Ue/Q));let ht=Ja(Math.atan2(Re,rt));ht=a.center.lng+(function(ai,kt){const fi=(kt-ai+180)%360-180;return fi<-180?fi+360:fi})(a.center.lng,ht);const yt=B(ht),Et=we(G(Qe),0,1);return new Oe(yt,Et)}class mp{constructor(n,o,d){this.a=pt([],n,d),this.b=pt([],o,d),this.center=d;const g=Gi([],this.a),w=Gi([],this.b);this.angle=Math.acos(gn(g,w))}}function kf(a,n){if(a.angle===0)return null;let o;return o=a.a[n]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[n]/a.a[n]/Math.sin(a.angle)-1/Math.tan(a.angle)),o<0||o>1?null:(function(d,g,w,S){const A=Math.sin(w);return d*(Math.sin((1-S)*w)/A)+g*(Math.sin(S*w)/A)})(a.a[n],a.b[n],a.angle,we(o,0,1))+a.center[n]}function xh(a){if(a.z<=1)return Mf[a.z+2*a.y+a.x];const n=T0(f_(a));return Ln.fromPoints(n)}function Yh(a,n,o){return Fn(a,a,1-o),mr(a,a,n,o)}function Ab(a,n,o){for(const d of a)St(d,d,n),Fn(d,d,o)}function em(a,n,o,d){const g=n/a.worldSize,w=a.globeMatrix;if(o.z<=1){const Et=xh(o).getCorners();return Ab(Et,w,g),Ln.fromPoints(Et)}const S=f_(o,d),A=T0(S,Ql+Od(a._tileCoverLift));Ab(A,w,g);const L=Number.MAX_VALUE,N=[-L,-L,-L],q=[L,L,L];if(S.contains(a.center)){for(const kt of A)wn(q,q,kt),qn(N,N,kt);N[2]=0;const Et=a.point,ai=[Et.x*g,Et.y*g,0];return wn(q,q,ai),qn(N,N,ai),new Ln(q,N)}if(a._tileCoverLift>0){for(const Et of A)wn(q,q,Et),qn(N,N,Et);return new Ln(q,N)}const Z=[w[12]*g,w[13]*g,w[14]*g],Q=S.getCenter(),ne=we(a.center.lat,-he,he),oe=we(Q.lat,-he,he),me=B(a.center.lng),Se=G(ne);let Te=me-B(Q.lng);const Le=Se-G(oe);Te>.5?Te-=1:Te<-.5&&(Te+=1);let Re=0;Math.abs(Te)>Math.abs(Le)?Re=Te>=0?1:3:(Re=Le>=0?0:2,mr(Z,Z,[w[4]*g,w[5]*g,w[6]*g],-Math.sin(ns(Le>=0?S.getSouth():S.getNorth()))*Ql));const Ue=A[Re],rt=A[(Re+1)%4],Qe=new mp(Ue,rt,Z),ht=[kf(Qe,0)||Ue[0],kf(Qe,1)||Ue[1],kf(Qe,2)||Ue[2]],yt=tm(a.zoom);if(yt>0){const Et=(function({x:kt,y:fi,z:Ti},Si,Bi,ji,zi){const Oi=1/(1<<Ti);let di=kt*Oi,ui=di+Oi,Fi=fi*Oi,tn=Fi+Oi,Xi=0;const Vn=(di+ui)/2-ji;return Vn>.5?Xi=-1:Vn<-.5&&(Xi=1),di=((di+Xi)*Si-(ji*=Si))*Bi+ji,ui=((ui+Xi)*Si-ji)*Bi+ji,Fi=(Fi*Si-(zi*=Si))*Bi+zi,tn=(tn*Si-zi)*Bi+zi,[[di,tn,0],[ui,tn,0],[ui,Fi,0],[di,Fi,0]]})(o,n,a._pixelsPerMercatorPixel,me,Se);for(let kt=0;kt<A.length;kt++)Yh(A[kt],Et[kt],yt);const ai=vt([],Et[Re],Et[(Re+1)%4]);Fn(ai,ai,.5),Yh(ht,ai,yt)}for(const Et of A)wn(q,q,Et),qn(N,N,Et);return q[2]=Math.min(Ue[2],rt[2]),wn(q,q,ht),qn(N,N,ht),new Ln(q,N)}function f_({x:a,y:n,z:o},d=!1){const g=1/(1<<o),w=new h(ee(a*g),n===(1<<o)-1&&d?-90:ce((n+1)*g)),S=new h(ee((a+1)*g),n===0&&d?90:ce(n*g));return new x(w,S)}function T0(a,n=Ql){const o=ns(a.getNorth()),d=ns(a.getSouth()),g=Math.cos(o),w=Math.cos(d),S=Math.sin(o),A=Math.sin(d),L=a.getWest(),N=a.getEast();return[ra(w,A,L,n),ra(w,A,N,n),ra(g,S,N,n),ra(g,S,L,n)]}function S0(a,n,o,d){const g=1<<o.z,w=(a/Ji+o.x)/g;return Zh(ce((n/Ji+o.y)/g),ee(w),d)}function E0({min:a,max:n}){return w0/Math.max(n[0]-a[0],n[1]-a[1],n[2]-a[2])}const c2=new Float64Array(16);function Iv(a){const n=E0(a),o=je(c2,[n,n,n]);return de(o,o,sn([],a.min))}function Pb(a){const n=(d=a.min,(o=c2)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=d[0],o[13]=d[1],o[14]=d[2],o[15]=1,o);var o,d;const g=1/E0(a);return Ee(n,n,[g,g,g])}function Mb(a){const n=Ji/(2*Math.PI);return a/(2*Math.PI)/n}function u2(a,n){return Ji/(512*Math.pow(2,a))*E0(xh(n))}function kb(a,n,o,d,g){const w=Mb(o),S=[a,n,-o/(2*Math.PI)],A=ie(new Float64Array(16));return de(A,A,S),Ee(A,A,[w,w,w]),Pe(A,A,ns(-g)),Ze(A,A,ns(-d)),A}function tm(a){return Ie(_h,gy,a)}function gp(a,n){const o=Zh(n.lat,n.lng),d=(function(oe){const me=Zh(oe._center.lat,oe._center.lng);let Se=nr([],Dt(0,1,0),me);const Te=Ye([],-oe.angle,me);Se=St(Se,Se,Te),Ye(Te,-oe._pitch,Se);const Le=Gi([],me);return Fn(Le,Le,Od(oe.cameraToCenterDistance/oe.pixelsPerMeter)),St(Le,Le,Te),vt([],me,Le)})(a);return S=(g=wi([],d,o))[0],A=g[1],L=g[2],N=(w=o)[0],q=w[1],Z=w[2],ne=(Q=Math.sqrt((S*S+A*A+L*L)*(N*N+q*q+Z*Z)))&&gn(g,w)/Q,Math.acos(Math.min(Math.max(ne,-1),1));var g,w,S,A,L,N,q,Z,Q,ne}function _p(a,n){return gp(a,n)>Math.PI/2*1.01}const Db=ns(85),Lb=Math.cos(Db),gI=Math.sin(Db),Cv=ae(),Av=a=>{const n=[];return a.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function h2(a,n,o,d,g,w,S,A,L){if(w&&a.queryGeometry.isAboveHorizon)return!1;w&&(L*=a.pixelToTileUnitsFactor);const N=a.tileID.canonical,q=o.projection.upVectorScale(N,o.center.lat,o.worldSize).metersToTile;for(const Z of n)for(const Q of Z){const ne=Q.add(A),oe=g&&o.elevation?o.elevation.exaggeration()*g.getElevationAt(ne.x,ne.y,!0):0,me=o.projection.projectTilePoint(ne.x,ne.y,N);if(oe>0){const Re=o.projection.upVector(N,ne.x,ne.y);me.x+=Re[0]*q*oe,me.y+=Re[1]*q*oe,me.z+=Re[2]*q*oe}const Se=w?ne:Rb(me.x,me.y,me.z,d),Te=w?a.tilespaceRays.map((Re=>d2(Re,oe))):a.queryGeometry.screenGeometry,Le=Bt([],[me.x,me.y,me.z,1],d);if(!S&&w?L*=Le[3]/o.cameraToCenterDistance:S&&!w&&(L*=o.cameraToCenterDistance/Le[3]),w){const Re=ce((Q.y/Ji+N.y)/(1<<N.z));L/=o.projection.pixelsPerMeter(Re,1)/J(1,Re)}if(Ar(Te,Se,L))return!0}return!1}function Rb(a,n,o,d){const g=Bt([],[a,n,o,1],d);return new yi(g[0]/g[3],g[1]/g[3])}const Pv=Dt(0,0,0),yy=Dt(0,0,1);function d2(a,n){const o=ci();return Pv[2]=n,a.intersectsPlane(Pv,yy,o),new yi(o[0],o[1])}class zb extends Os{}let Mv,Ob,I0,Fb;function f2(a,{width:n,height:o},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*o*d)throw new RangeError("mismatched image size")}else g=new Uint8Array(n*o*d);return a.width=n,a.height=o,a.data=g,a}function p2(a,n,o){const{width:d,height:g}=n;d===a.width&&g===a.height||(Bb(a,n,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,g)},o,null),a.width=d,a.height=g,a.data=n.data)}function Bb(a,n,o,d,g,w,S,A){if(g.width===0||g.height===0)return n;if(g.width>a.width||g.height>a.height||o.x>a.width-g.width||o.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||d.x>n.width-g.width||d.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const L=a.data,N=n.data,q=w===4&&A;for(let Z=0;Z<g.height;Z++){const Q=((o.y+Z)*a.width+o.x)*w,ne=((d.y+Z)*n.width+d.x)*w;if(q)for(let oe=0;oe<g.width;oe++){const me=Q+oe*w+3,Se=ne+oe*w;N[Se+0]=255,N[Se+1]=255,N[Se+2]=255,N[Se+3]=L[me]}else if(S)for(let oe=0;oe<g.width;oe++){const me=Q+oe*w,Se=ne+oe*w,Te=new ps(L[me+0]/255,L[me+1]/255,L[me+2]/255,L[me+3]).toNonPremultipliedRenderColor(S).toArray();N[Se+0]=Te[0],N[Se+1]=Te[1],N[Se+2]=Te[2],N[Se+3]=Te[3]}else for(let oe=0;oe<g.width*w;oe++)N[ne+oe]=L[Q+oe]}return n}Cn(zb,"HeatmapBucket",{omit:["layers"]});class dg{constructor(n,o){f2(this,n,1,o)}resize(n){p2(this,new dg(n),1)}clone(){return new dg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,d,g,w){Bb(n,o,d,g,w,1,null)}}class ic{constructor(n,o){f2(this,n,4,o)}resize(n){p2(this,new ic(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,d,g,w,S,A){Bb(n,o,d,g,w,4,S,A)}}class kv{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function Fd(a){const n={},o=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new ic({width:o,height:d}),w=(S,A,L)=>{n[a.evaluationKey]=L;const N=a.expression.evaluate(n),q=N?N.toNonPremultipliedRenderColor(null):null;q&&(g.data[S+A+0]=Math.floor(255*q.r),g.data[S+A+1]=Math.floor(255*q.g),g.data[S+A+2]=Math.floor(255*q.b),g.data[S+A+3]=Math.floor(255*q.a))};if(a.clips)for(let S=0,A=0;S<d;++S,A+=4*o)for(let L=0,N=0;L<o;L++,N+=4){const q=L/(o-1),{start:Z,end:Q}=a.clips[S];w(A,N,Z*(1-q)+Q*q)}else for(let S=0,A=0;S<o;S++,A+=4)w(0,A,S/(o-1));return g}Cn(dg,"AlphaImage"),Cn(ic,"RGBAImage");const m2=hr([{name:"a_pos",components:2,type:"Int16"}],4),g2=hr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),_2=hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),y2=hr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function p_(a,n,o=2){const d=n&&n.length,g=d?n[0]*o:a.length;let w=Nb(a,0,g,o,!0);const S=[];if(!w||w.next===w.prev)return S;let A,L,N;if(d&&(w=(function(q,Z,Q,ne){const oe=[];for(let me=0,Se=Z.length;me<Se;me++){const Te=Nb(q,Z[me]*ne,me<Se-1?Z[me+1]*ne:q.length,ne,!1);Te===Te.next&&(Te.steiner=!0),oe.push(b2(Te))}oe.sort(Kh);for(let me=0;me<oe.length;me++)Q=xy(oe[me],Q);return Q})(a,n,w,o)),a.length>80*o){A=a[0],L=a[1];let q=A,Z=L;for(let Q=o;Q<g;Q+=o){const ne=a[Q],oe=a[Q+1];ne<A&&(A=ne),oe<L&&(L=oe),ne>q&&(q=ne),oe>Z&&(Z=oe)}N=Math.max(q-A,Z-L),N=N!==0?32767/N:0}return vy(w,S,o,A,L,N,0),S}function Nb(a,n,o,d,g){let w;if(g===(function(S,A,L,N){let q=0;for(let Z=A,Q=L-N;Z<L;Z+=N)q+=(S[Q]-S[Z])*(S[Z+1]+S[Q+1]),Q=Z;return q})(a,n,o,d)>0)for(let S=n;S<o;S+=d)w=T2(S/d|0,a[S],a[S+1],w);else for(let S=o-d;S>=n;S-=d)w=T2(S/d|0,a[S],a[S+1],w);return w&&im(w,w.next)&&(P0(w),w=w.next),w}function yp(a,n){if(!a)return a;n||(n=a);let o,d=a;do if(o=!1,d.steiner||!im(d,d.next)&&Sa(d.prev,d,d.next)!==0)d=d.next;else{if(P0(d),d=n=d.prev,d===d.next)break;o=!0}while(o||d!==n);return n}function vy(a,n,o,d,g,w,S){if(!a)return;!S&&w&&(function(L,N,q,Z){let Q=L;do Q.z===0&&(Q.z=Ub(Q.x,Q.y,N,q,Z)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==L);Q.prevZ.nextZ=null,Q.prevZ=null,(function(ne){let oe,me=1;do{let Se,Te=ne;ne=null;let Le=null;for(oe=0;Te;){oe++;let Re=Te,Ue=0;for(let Qe=0;Qe<me&&(Ue++,Re=Re.nextZ,Re);Qe++);let rt=me;for(;Ue>0||rt>0&&Re;)Ue!==0&&(rt===0||!Re||Te.z<=Re.z)?(Se=Te,Te=Te.nextZ,Ue--):(Se=Re,Re=Re.nextZ,rt--),Le?Le.nextZ=Se:ne=Se,Se.prevZ=Le,Le=Se;Te=Re}Le.nextZ=null,me*=2}while(oe>1)})(Q)})(a,d,g,w);let A=a;for(;a.prev!==a.next;){const L=a.prev,N=a.next;if(w?v2(a,d,g,w):C0(a))n.push(L.i,a.i,N.i),P0(a),a=N.next,A=N.next;else if((a=N)===A){S?S===1?vy(a=Vb(yp(a),n),n,o,d,g,w,2):S===2&&x2(a,n,o,d,g,w):vy(yp(a),n,o,d,g,w,1);break}}}function C0(a){const n=a.prev,o=a,d=a.next;if(Sa(n,o,d)>=0)return!1;const g=n.x,w=o.x,S=d.x,A=n.y,L=o.y,N=d.y,q=Math.min(g,w,S),Z=Math.min(A,L,N),Q=Math.max(g,w,S),ne=Math.max(A,L,N);let oe=d.next;for(;oe!==n;){if(oe.x>=q&&oe.x<=Q&&oe.y>=Z&&oe.y<=ne&&by(g,A,w,L,S,N,oe.x,oe.y)&&Sa(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function v2(a,n,o,d){const g=a.prev,w=a,S=a.next;if(Sa(g,w,S)>=0)return!1;const A=g.x,L=w.x,N=S.x,q=g.y,Z=w.y,Q=S.y,ne=Math.min(A,L,N),oe=Math.min(q,Z,Q),me=Math.max(A,L,N),Se=Math.max(q,Z,Q),Te=Ub(ne,oe,n,o,d),Le=Ub(me,Se,n,o,d);let Re=a.prevZ,Ue=a.nextZ;for(;Re&&Re.z>=Te&&Ue&&Ue.z<=Le;){if(Re.x>=ne&&Re.x<=me&&Re.y>=oe&&Re.y<=Se&&Re!==g&&Re!==S&&by(A,q,L,Z,N,Q,Re.x,Re.y)&&Sa(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,Ue.x>=ne&&Ue.x<=me&&Ue.y>=oe&&Ue.y<=Se&&Ue!==g&&Ue!==S&&by(A,q,L,Z,N,Q,Ue.x,Ue.y)&&Sa(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Re&&Re.z>=Te;){if(Re.x>=ne&&Re.x<=me&&Re.y>=oe&&Re.y<=Se&&Re!==g&&Re!==S&&by(A,q,L,Z,N,Q,Re.x,Re.y)&&Sa(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;Ue&&Ue.z<=Le;){if(Ue.x>=ne&&Ue.x<=me&&Ue.y>=oe&&Ue.y<=Se&&Ue!==g&&Ue!==S&&by(A,q,L,Z,N,Q,Ue.x,Ue.y)&&Sa(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function Vb(a,n){let o=a;do{const d=o.prev,g=o.next.next;!im(d,g)&&Dv(d,o,o.next,g)&&m_(d,g)&&m_(g,d)&&(n.push(d.i,o.i,g.i),P0(o),P0(o.next),o=a=g),o=o.next}while(o!==a);return yp(o)}function x2(a,n,o,d,g,w){let S=a;do{let A=S.next.next;for(;A!==S.prev;){if(S.i!==A.i&&w2(S,A)){let L=Lv(S,A);return S=yp(S,S.next),L=yp(L,L.next),vy(S,n,o,d,g,w,0),void vy(L,n,o,d,g,w,0)}A=A.next}S=S.next}while(S!==a)}function Kh(a,n){let o=a.x-n.x;return o===0&&(o=a.y-n.y,o===0)&&(o=(a.next.y-a.y)/(a.next.x-a.x)-(n.next.y-n.y)/(n.next.x-n.x)),o}function xy(a,n){const o=(function(g,w){let S=w;const A=g.x,L=g.y;let N,q=-1/0;if(im(g,S))return S;do{if(im(g,S.next))return S.next;if(L<=S.y&&L>=S.next.y&&S.next.y!==S.y){const me=S.x+(L-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(me<=A&&me>q&&(q=me,N=S.x<S.next.x?S:S.next,me===A))return N}S=S.next}while(S!==w);if(!N)return null;const Z=N,Q=N.x,ne=N.y;let oe=1/0;S=N;do{if(A>=S.x&&S.x>=Q&&A!==S.x&&fg(L<ne?A:q,L,Q,ne,L<ne?q:A,L,S.x,S.y)){const me=Math.abs(L-S.y)/(A-S.x);m_(S,g)&&(me<oe||me===oe&&(S.x>N.x||S.x===N.x&&jb(N,S)))&&(N=S,oe=me)}S=S.next}while(S!==Z);return N})(a,n);if(!o)return n;const d=Lv(o,a);return yp(d,d.next),yp(o,o.next)}function jb(a,n){return Sa(a.prev,a,n.prev)<0&&Sa(n.next,a,a.next)<0}function Ub(a,n,o,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function b2(a){let n=a,o=a;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==a);return o}function fg(a,n,o,d,g,w,S,A){return(g-S)*(n-A)>=(a-S)*(w-A)&&(a-S)*(d-A)>=(o-S)*(n-A)&&(o-S)*(w-A)>=(g-S)*(d-A)}function by(a,n,o,d,g,w,S,A){return!(a===S&&n===A)&&fg(a,n,o,d,g,w,S,A)}function w2(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!(function(o,d){let g=o;do{if(g.i!==o.i&&g.next.i!==o.i&&g.i!==d.i&&g.next.i!==d.i&&Dv(g,g.next,o,d))return!0;g=g.next}while(g!==o);return!1})(a,n)&&(m_(a,n)&&m_(n,a)&&(function(o,d){let g=o,w=!1;const S=(o.x+d.x)/2,A=(o.y+d.y)/2;do g.y>A!=g.next.y>A&&g.next.y!==g.y&&S<(g.next.x-g.x)*(A-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==o);return w})(a,n)&&(Sa(a.prev,a,n.prev)||Sa(a,n.prev,n))||im(a,n)&&Sa(a.prev,a,a.next)>0&&Sa(n.prev,n,n.next)>0)}function Sa(a,n,o){return(n.y-a.y)*(o.x-n.x)-(n.x-a.x)*(o.y-n.y)}function im(a,n){return a.x===n.x&&a.y===n.y}function Dv(a,n,o,d){const g=A0(Sa(a,n,o)),w=A0(Sa(a,n,d)),S=A0(Sa(o,d,a)),A=A0(Sa(o,d,n));return g!==w&&S!==A||!(g!==0||!wy(a,o,n))||!(w!==0||!wy(a,d,n))||!(S!==0||!wy(o,a,d))||!(A!==0||!wy(o,n,d))}function wy(a,n,o){return n.x<=Math.max(a.x,o.x)&&n.x>=Math.min(a.x,o.x)&&n.y<=Math.max(a.y,o.y)&&n.y>=Math.min(a.y,o.y)}function A0(a){return a>0?1:a<0?-1:0}function m_(a,n){return Sa(a.prev,a,a.next)<0?Sa(a,n,a.next)>=0&&Sa(a,a.prev,n)>=0:Sa(a,n,a.prev)<0||Sa(a,a.next,n)<0}function Lv(a,n){const o=Xs(a.i,a.x,a.y),d=Xs(n.i,n.x,n.y),g=a.next,w=n.prev;return a.next=n,n.prev=a,o.next=g,g.prev=o,d.next=o,o.prev=d,w.next=d,d.prev=w,d}function T2(a,n,o,d){const g=Xs(a,n,o);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function P0(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Xs(a,n,o){return{i:a,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jh(a,n){const o=a.length;if(o<=1)return[a];const d=[];let g,w;for(let S=0;S<o;S++){const A=rr(a[S]);A!==0&&(a[S].area=Math.abs(A),w===void 0&&(w=A<0),w===A<0?(g&&d.push(g),g=[a[S]]):g.push(a[S]))}if(g&&d.push(g),n>1)for(let S=0;S<d.length;S++)d[S].length<=n||(sf(d[S],n,1,d[S].length-1,Lc),d[S]=d[S].slice(0,n));return d}function Lc(a,n){return n.area-a.area}function Bd(a,n,o=1){if(!a)return null;const d=typeof a=="string"?tl.from(a).getPrimary():a.getPrimary(),g=typeof a=="string"?null:a.getSecondary();for(const w of[d,g]){if(!w)continue;const S=w.id.toString();n.has(S)||n.set(S,[]),w.scaleSelf(o),n.get(S).push(w)}return{primary:d.toString(),secondary:g?g.toString():null}}function nm(a,n,o,d){const g=d.patternDependencies;let w=!1;for(const S of n){const A=S.paint.get(`${a}-pattern`);A.isConstant()||(w=!0),Bd(A.constantOr(null),g,o)&&(w=!0)}return w}function xu(a,n,o,d,g,w){const S=w.patternDependencies;for(const A of n){const L=A.paint.get(`${a}-pattern`).value;if(L.kind!=="constant"){let N=L.evaluate({zoom:d},o,{},w.availableImages);N=N&&N.name?N.name:N;const q=Bd(N,S,g);if(!q)continue;const{primary:Z,secondary:Q}=q;Z&&(o.patterns[A.id]=[Z,Q].filter(Boolean))}}return o}class $l{constructor(){this.polygons=new Map}add(n,...o){const d=this.polygons.get(n);d?d.push(...o):this.polygons.set(n,o)}merge(n){for(const[o,d]of n.polygons)this.add(o,...d)}}class Ea{constructor(){this.portals=[]}static isOnBorder(n,o){return n<=0&&o<=0||n>=Ji&&o>=Ji}static evaluate(n){if(n.length===0)return new Ea;let o=[];for(const L of n)o.push(...L.portals);if(o.length===0)return new Ea;for(const L of o){const N=L.va,q=L.vb;(Ea.isOnBorder(N.x,q.x)||Ea.isOnBorder(N.y,q.y))&&(L.type="border")}const d=o.filter((L=>L.type!=="unevaluated")),g=o.filter((L=>L.type==="unevaluated"));if(g.length===0)return new Ea;g.sort(((L,N)=>L.hash===N.hash?L.isTunnel===N.isTunnel?0:L.isTunnel?-1:1:L.hash<N.hash?1:-1)),o=d.concat(g);let w=d.length,S=w,A=w;do if(S++,S===o.length||o[w].hash!==o[S].hash){if(S-w==2){A<w&&(o[A]=o[w],o[w]=null);const L=o[A],N=o[S-1];L.type=L.isTunnel!==N.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:N.connection.a},A++}w=S}while(w!==o.length);return o.splice(A),o.sort(((L,N)=>L.hash<N.hash?1:-1)),{portals:o}}}Cn(Ea,"ElevationPortalGraph"),Cn($l,"ElevationPolygons");class S2{constructor(n,o,d){this.outPositions=n,this.outNormals=o,this.outIndices=d,this.vertexLookup=new Map}addVertex(n,o,d){let g=n[2];d!=null&&(g*=d);const w=`${n[0]},${n[1]},${n[2]},${o[0]},${o[1]},${o[2]}`,S=this.vertexLookup.get(w);if(S!=null)return S;const A=this.outPositions.length;this.vertexLookup.set(w,A);const L=Math.trunc(16384*o[0]),N=Math.trunc(16384*o[1]),q=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(n[0],n[1],g),this.outNormals.emplaceBack(L,N,q),A}addTriangle(n,o,d){this.outIndices.emplaceBack(n,o,d)}addTriangles(n,o,d){if(n.length===0)return;const g=d.length===1,w=ci(),S=ci();for(let A=0;A<n.length;A+=3){const L=o[n[A+0]],N=o[n[A+1]],q=o[n[A+2]],Z=g?d[0]:d[n[A+1]],Q=g?d[0]:d[n[A+2]];Ft(w,L.x,L.y,g?d[0]:d[n[A+0]]);const ne=this.addVertex(w,S);Ft(w,N.x,N.y,Z);const oe=this.addVertex(w,S);Ft(w,q.x,q.y,Q);const me=this.addVertex(w,S);this.outIndices.emplaceBack(ne,oe,me)}}addQuad(n,o,d,g,w,S){const A=this.addVertex(n,w,S),L=this.addVertex(o,w,S),N=this.addVertex(d,w,S),q=this.addVertex(g,w,S);this.addTriangle(A,L,N),this.addTriangle(N,q,A)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ba{constructor(n,o,d,g){this.unevaluatedPortals=new Ea,this.portalPolygons=new $l,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new fh,this.vertexNormals=new Vu,this.indexArray=new $o,this.tileToMeters=Ae(n),this.bridgeProgramConfigurations=new gc(o,{zoom:d,lut:g},(w=>w!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new gc(o,{zoom:d,lut:g},(w=>w!=="fill-bridge-guard-rail-color"))}addVertices(n,o){const d=this.unevalVertices.length;for(let g=0;g<n.length;g++)this.unevalVertices.push(n[g]),this.unevalHeights.push(o[g]);return d}addTriangles(n,o,d){const g=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const w of n)g.push(w+o)}addRenderableRing(n,o,d,g,w,S){const A=[new yi(w.min.x,w.min.y),new yi(w.max.x,w.min.y),new yi(w.max.x,w.max.y),new yi(w.min.x,w.max.y)];for(let L=0;L<d-1;L++){const N=o+L,q=N+1,Z=this.unevalVertices[N],Q=this.unevalVertices[q];if(!(Z.x>=w.min.x&&Z.x<=w.max.x&&Z.y>=w.min.y&&Z.y<=w.max.y||Q.x>=w.min.x&&Q.x<=w.max.x&&Q.y>=w.min.y&&Q.y<=w.max.y||Dl(Z,Q,A))||this.isOnBorder(Z.x,Q.x)||this.isOnBorder(Z.y,Q.y))continue;const ne=Ba.computeEdgeHash(this.unevalVertices[N],this.unevalVertices[q]);let oe,me=this.vertexHashLookup.get(Ba.computePosHash(Z));me!=null?oe=me.next:(me=this.vertexHashLookup.get(Ba.computePosHash(Q)),oe=me!=null?me.prev:ne),this.unevalEdges.push({polygonIdx:n,a:N,b:q,hash:ne,portalHash:oe,isTunnel:g,type:"unevaluated",featureInfo:S})}}addPortalCandidates(n,o,d,g,w){if(o.length===0)return;this.portalPolygons.add(n,{geometry:o,zLevel:w});const S=o[0];this.vertexHashLookup.clear();let A=Ba.computeEdgeHash(S[S.length-2],S[S.length-1]);for(let L=0;L<S.length-1;L++){const N=S[L+0],q=S[L+1],Z=Ci(q.x-N.x,q.y-N.y),Q=Gr(Z);if(Q===0)continue;let ne="unevaluated";const oe=g.pointElevation(N),me=g.pointElevation(q);Math.abs(oe)<.01&&Math.abs(me)<.01?ne="entrance":(this.isOnBorder(N.x,q.x)||this.isOnBorder(N.y,q.y))&&(ne="border");const Se=Ba.computeEdgeHash(N,q);this.unevaluatedPortals.portals.push({connection:{a:n,b:void 0},va:N,vb:q,vab:Z,length:Q,hash:Se,isTunnel:d,type:ne});const Te=Ba.computePosHash(N);this.vertexHashLookup.set(Te,{prev:A,next:Se}),A=Se}}construct(n){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=Q=>{Q.primitiveLength=this.indexArray.length-Q.primitiveOffset},g=new S2(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(n.portals,this.unevalEdges);const w=o(),S=o(),A=o(),L=(Q,ne)=>{Q.sort(((me,Se)=>me.type===ne&&Se.type!==ne?-1:me.type!==ne&&Se.type===ne?1:0));const oe=Q.findIndex((me=>me.type!==ne));return oe>=0?oe:Q.length};let N=0;this.unevalEdges.length>0&&(N=L(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},this.tileToMeters)),d(A);const q=o(),Z=o();if(this.unevalEdges.length>0){const Q=this.unevalEdges.splice(N),ne=L(Q,"tunnel")+N;this.unevalEdges.push(...Q),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:N},{min:N,max:ne})}d(q),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(Z),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(S),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(w),this.maskSegments=bo.simpleSegment(0,Z.primitiveOffset,0,Z.primitiveLength),this.depthSegments=bo.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableBridgeSegments=bo.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.renderableTunnelSegments=bo.simpleSegment(0,q.primitiveOffset,0,q.primitiveLength),this.shadowCasterSegments=bo.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength)}update(n,o,d,g,w,S,A,L){this.bridgeProgramConfigurations.updatePaintArrays(n,o,w,d,g,S,A,L),this.tunnelProgramConfigurations.updatePaintArrays(n,o,w,d,g,S,A,L)}upload(n){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=n.createVertexBuffer(this.vertexPositions,_2.members),this.vertexBufferNormal=n.createVertexBuffer(this.vertexNormals,y2.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(n),this.tunnelProgramConfigurations.upload(n))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(n,o,d,g,w){const S=(A,L)=>{for(let N=0;N<L.length-1;N++){const q=L[N].featureIndex,Z=L[N+1].vertexStart,Q=n.feature(q);A.populatePaintArrays(Z,Q,q,{},d,o,g,void 0,w)}};S(this.bridgeProgramConfigurations,this.bridgeFeatureSections),S(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(n,o,d,g,w){const S=new Map;for(let A=g;A<w;A++){const L=d[A],N=L.a,q=L.b,Z=Ba.computePosHash(n[N]),Q=Ba.computePosHash(n[q]);let ne=S.get(Z);ne||(ne={},S.set(Z,ne));let oe=S.get(Q);oe||(oe={},S.set(Q,oe)),o[N]<=0&&o[q]<=0||(ne.to=q,oe.from=N)}return S}isTerminalVertex(n,o){const d=Ba.computePosHash(this.unevalVertices[n]),g=o.get(d);return!g||!g.from||!g.to}constructBridgeStructures(n,o,d,g,w,S){n.clearVertexLookup();const A=this.computeVertexConnections(o,d,g,w.min,w.max),L=1/S,N=.5*L,q=(Bi,ji)=>Ft(Bi,o[ji].x,o[ji].y,d[ji]*L),Z=ci(),Q=ci(),ne=ci(),oe=ci(),me=ci(),Se=(Bi,ji)=>{const zi=A.get(Ba.computePosHash(o[ji])),Oi=zi.from,di=zi.to;if(!Oi||!di)return;q(Z,Oi),q(Q,ji),q(ne,di),hn(oe),Ui(Z,Q)||(pt(me,Q,Z),Gi(oe,me)),Ui(ne,Q)||(pt(me,ne,Q),vt(oe,oe,Gi(me,me)));const ui=vi(oe);return ui>0?Fn(Bi,oe,1/ui):void 0};let Te=Number.POSITIVE_INFINITY;this.sortSubarray(g,w.min,w.max,((Bi,ji)=>Bi.featureInfo.featureIndex-ji.featureInfo.featureIndex));const Le=ci(),Re=ci(),Ue=ci(),rt=ci(),Qe=ci(),ht=ci(),yt=ci(),Et=ci(),ai=ci(),kt=[ci(),ci(),ci(),ci()],fi=[ci(),ci(),ci(),ci()],Ti=[{coord:new yi(0,0),height:0},{coord:new yi(0,0),height:0}],Si=(Bi,ji)=>Bi>ji;for(let Bi=w.min;Bi<w.max;Bi++){const ji=g[Bi];if(!ji.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ti,o,d,ji,Si))continue;const[zi,Oi]=Ti;if(Ft(Le,zi.coord.x,zi.coord.y,L*zi.height),Ft(Re,Oi.coord.x,Oi.coord.y,L*Oi.height),Ui(Le,Re))continue;pt(Ue,Re,Le),Gi(Ue,Ue);const di=Se(Et,ji.a)||Ue,ui=Se(ai,ji.b)||Ue;Ft(rt,di[1],-di[0],0),Gi(rt,rt),Ft(Qe,ui[1],-ui[0],0),Gi(Qe,Qe),nr(Et,rt,di),Gi(ht,Et),nr(Et,Qe,ui),Gi(yt,Et),vt(kt[0],Le,Fn(Et,pt(Et,rt,ht),N)),vt(kt[1],Le,Fn(Et,vt(Et,rt,ht),N)),vt(kt[2],Le,Fn(Et,ht,N)),kt[3]=Le,vt(fi[0],Re,Fn(Et,pt(Et,Qe,yt),N)),vt(fi[1],Re,Fn(Et,vt(Et,Qe,yt),N)),vt(fi[2],Re,Fn(Et,yt,N)),fi[3]=Re,Te=this.addFeatureSection(ji.featureInfo.featureIndex,Te,this.bridgeFeatureSections,n);const Fi=n.addVertex(kt[0],rt,S),tn=n.addVertex(kt[1],rt,S),Xi=n.addVertex(fi[0],Qe,S),Vn=n.addVertex(fi[1],Qe,S);n.addTriangle(Fi,tn,Xi),n.addTriangle(tn,Vn,Xi);const _n=n.addVertex(kt[1],ht,S),In=n.addVertex(kt[2],ht,S),Dn=n.addVertex(fi[1],yt,S),jr=n.addVertex(fi[2],yt,S);n.addTriangle(_n,In,Dn),n.addTriangle(In,jr,Dn),sn(rt,rt),sn(Qe,Qe);const Ki=n.addVertex(kt[2],rt,S),Rn=n.addVertex(kt[3],rt,S),wr=n.addVertex(fi[2],Qe,S),os=n.addVertex(fi[3],Qe,S);n.addTriangle(Ki,Rn,wr),n.addTriangle(Rn,os,wr);const ds=this.isTerminalVertex(ji.a,A),Mr=this.isTerminalVertex(ji.b,A);zi.height<.01&&ds&&n.addQuad(kt[3],kt[2],kt[1],kt[0],sn(di,di),S),Oi.height<.01&&Mr&&n.addQuad(fi[0],fi[1],fi[2],fi[3],ui,S)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}constructTunnelStructures(n,o,d,g,w,S){n.clearVertexLookup();let A=Number.POSITIVE_INFINITY;const L=(Te,Le)=>Te.featureInfo.featureIndex-Le.featureInfo.featureIndex;this.sortSubarray(g,w.min,w.max,L),this.sortSubarray(g,S.min,S.max,L);const N=Te=>Gi(Te,Te),q=[{coord:new yi(0,0),height:0},{coord:new yi(0,0),height:0}],Z=(Te,Le)=>Te<Le,Q=ci(),ne=ci(),oe=ci(),me=ci(),Se=ci();for(let Te=w.min;Te<w.max;Te++){if(!this.prepareEdgePoints(q,o,d,g[Te],Z))continue;const[Le,Re]=q,Ue=N(Ft(Se,-(Re.coord.y-Le.coord.y),Re.coord.x-Le.coord.x,0));A=this.addFeatureSection(g[Te].featureInfo.featureIndex,A,this.tunnelFeatureSections,n),n.addQuad(Ft(Q,Le.coord.x,Le.coord.y,Le.height),Ft(ne,Re.coord.x,Re.coord.y,Re.height),Ft(oe,Re.coord.x,Re.coord.y,g[Te].isTunnel?-.1:0),Ft(me,Le.coord.x,Le.coord.y,g[Te].isTunnel?-.1:0),Ue)}for(let Te=S.min;Te<S.max;Te++){const Le=g[Te];Le.isTunnel&&([Le.a,Le.b]=[Le.b,Le.a]);const Re=o[Le.a],Ue=o[Le.b],rt=N(Ft(Se,-(Ue.y-Re.y),Ue.x-Re.x,0));A=this.addFeatureSection(Le.featureInfo.featureIndex,A,this.tunnelFeatureSections,n),n.addQuad(Ft(Q,Ue.x,Ue.y,0),Ft(ne,Re.x,Re.y,0),Ft(oe,Re.x,Re.y,d[Le.a]+4),Ft(me,Ue.x,Ue.y,d[Le.b]+4),rt),n.addQuad(Ft(Q,Re.x,Re.y,0),Ft(ne,Ue.x,Ue.y,0),Ft(oe,Ue.x,Ue.y,d[Le.b]+4),Ft(me,Re.x,Re.y,d[Le.a]+4),rt)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}setElevatedPoint(n,o,d,g){n.coord.x=o,n.coord.y=d,n.height=g}prepareEdgePoints(n,o,d,g,w){let S=o[g.a].x,A=o[g.a].y,L=o[g.b].x,N=o[g.b].y,q=d[g.a],Z=d[g.b];const Q=w(q,0),ne=w(Z,0);if(Q&&ne)return this.setElevatedPoint(n[0],S,A,q),this.setElevatedPoint(n[1],L,N,Z),!0;if(!Q&&!ne)return!1;if(Q){if(!ne){const oe=Z/(Z-q);L=Gn(L,S,oe),N=Gn(N,A,oe),Z=Gn(Z,q,oe)}}else{const oe=q/(q-Z);S=Gn(S,L,oe),A=Gn(A,N,oe),q=Gn(q,Z,oe)}return this.setElevatedPoint(n[0],S,A,q),this.setElevatedPoint(n[1],L,N,Z),!0}prepareEdges(n,o){if(o.length===0)return;o.sort(((A,L)=>A.hash===L.hash?L.polygonIdx-A.polygonIdx:L.hash>A.hash?1:-1));let d=0,g=0,w=0,S=o[d].polygonIdx;do g++,(g===o.length||o[d].hash!==o[g].hash)&&((g-d==1||o[g-1].polygonIdx!==S)&&(w<d&&(o[w]=o[d],o[d]=null),o[w].type="none",w++),d=g,d!==o.length&&(S=o[d].polygonIdx));while(d!==o.length);if(o.splice(w),o.length!==0&&n.length!==0){o.sort(((N,q)=>N.portalHash<q.portalHash?1:-1));let A=0,L=0;for(;A!==o.length&&L!==n.length;){const N=o[A],q=n[L];N.portalHash>q.hash?A++:q.hash>N.portalHash?L++:(N.type=q.type,A++)}}}isOnBorder(n,o){return n<=0&&o<=0||n>=Ji&&o>=Ji}addFeatureSection(n,o,d,g){return n!==o&&(o=n,d.push({featureIndex:n,vertexStart:g.getVertexCount()}),g.clearVertexLookup()),o}sortSubarray(n,o,d,g){const w=n.slice(o,d);w.sort(g),n.splice(o,w.length,...w)}static computeEdgeHash(n,o){return(n.y===o.y&&n.x>o.x||n.y>o.y)&&([n,o]=[o,n]),BigInt(Ba.computePosHash(n))<<32n|BigInt(Ba.computePosHash(o))}static computePosHash(n){return((65535&n.x)<<16|65535&n.y)>>>0}}var nc,M0={exports:{}},E2=(nc||(nc=1,(function(a){function n(et,st){return et>st?1:et<st?-1:0}var o=function(et,st){et===void 0&&(et=n),st===void 0&&(st=!1),this._compare=et,this._root=null,this._size=0,this._noDuplicates=!!st},d={size:{configurable:!0}};function g(et,st,pi,Ni,dn){var fn=dn-Ni;if(fn>0){var Un=Ni+Math.floor(fn/2),Wn={key:st[Un],data:pi[Un],parent:et};return Wn.left=g(Wn,st,pi,Ni,Un),Wn.right=g(Wn,st,pi,Un+1,dn),Wn}return null}function w(et,st,pi,Ni,dn){if(!(pi>=Ni)){for(var fn=et[pi+Ni>>1],Un=pi-1,Wn=Ni+1;;){do Un++;while(dn(et[Un],fn)<0);do Wn--;while(dn(et[Wn],fn)>0);if(Un>=Wn)break;var Ir=et[Un];et[Un]=et[Wn],et[Wn]=Ir,Ir=st[Un],st[Un]=st[Wn],st[Wn]=Ir}w(et,st,pi,Wn,dn),w(et,st,Wn+1,Ni,dn)}}o.prototype.rotateLeft=function(et){var st=et.right;st&&(et.right=st.left,st.left&&(st.left.parent=et),st.parent=et.parent),et.parent?et===et.parent.left?et.parent.left=st:et.parent.right=st:this._root=st,st&&(st.left=et),et.parent=st},o.prototype.rotateRight=function(et){var st=et.left;st&&(et.left=st.right,st.right&&(st.right.parent=et),st.parent=et.parent),et.parent?et===et.parent.left?et.parent.left=st:et.parent.right=st:this._root=st,st&&(st.right=et),et.parent=st},o.prototype._splay=function(et){for(;et.parent;){var st=et.parent;st.parent?st.left===et&&st.parent.left===st?(this.rotateRight(st.parent),this.rotateRight(st)):st.right===et&&st.parent.right===st?(this.rotateLeft(st.parent),this.rotateLeft(st)):st.left===et&&st.parent.right===st?(this.rotateRight(st),this.rotateLeft(st)):(this.rotateLeft(st),this.rotateRight(st)):st.left===et?this.rotateRight(st):this.rotateLeft(st)}},o.prototype.splay=function(et){for(var st,pi,Ni,dn,fn;et.parent;)(pi=(st=et.parent).parent)&&pi.parent?((Ni=pi.parent).left===pi?Ni.left=et:Ni.right=et,et.parent=Ni):(et.parent=null,this._root=et),dn=et.left,fn=et.right,et===st.left?(pi&&(pi.left===st?(st.right?(pi.left=st.right,pi.left.parent=pi):pi.left=null,st.right=pi,pi.parent=st):(dn?(pi.right=dn,dn.parent=pi):pi.right=null,et.left=pi,pi.parent=et)),fn?(st.left=fn,fn.parent=st):st.left=null,et.right=st,st.parent=et):(pi&&(pi.right===st?(st.left?(pi.right=st.left,pi.right.parent=pi):pi.right=null,st.left=pi,pi.parent=st):(fn?(pi.left=fn,fn.parent=pi):pi.left=null,et.right=pi,pi.parent=et)),dn?(st.right=dn,dn.parent=st):st.right=null,et.left=st,st.parent=et)},o.prototype.replace=function(et,st){et.parent?et===et.parent.left?et.parent.left=st:et.parent.right=st:this._root=st,st&&(st.parent=et.parent)},o.prototype.minNode=function(et){if(et===void 0&&(et=this._root),et)for(;et.left;)et=et.left;return et},o.prototype.maxNode=function(et){if(et===void 0&&(et=this._root),et)for(;et.right;)et=et.right;return et},o.prototype.insert=function(et,st){var pi=this._root,Ni=null,dn=this._compare;if(this._noDuplicates)for(;pi;){if(Ni=pi,dn(pi.key,et)===0)return;pi=dn(pi.key,et)<0?pi.right:pi.left}else for(;pi;)Ni=pi,pi=dn(pi.key,et)<0?pi.right:pi.left;return pi={key:et,data:st,left:null,right:null,parent:Ni},Ni?dn(Ni.key,pi.key)<0?Ni.right=pi:Ni.left=pi:this._root=pi,this.splay(pi),this._size++,pi},o.prototype.find=function(et){for(var st=this._root,pi=this._compare;st;){var Ni=pi(st.key,et);if(Ni<0)st=st.right;else{if(!(Ni>0))return st;st=st.left}}return null},o.prototype.contains=function(et){for(var st=this._root,pi=this._compare;st;){var Ni=pi(et,st.key);if(Ni===0)return!0;st=Ni<0?st.left:st.right}return!1},o.prototype.remove=function(et){var st=this.find(et);if(!st)return!1;if(this.splay(st),st.left)if(st.right){var pi=this.minNode(st.right);pi.parent!==st&&(this.replace(pi,pi.right),pi.right=st.right,pi.right.parent=pi),this.replace(st,pi),pi.left=st.left,pi.left.parent=pi}else this.replace(st,st.left);else this.replace(st,st.right);return this._size--,!0},o.prototype.removeNode=function(et){if(!et)return!1;if(this.splay(et),et.left)if(et.right){var st=this.minNode(et.right);st.parent!==et&&(this.replace(st,st.right),st.right=et.right,st.right.parent=st),this.replace(et,st),st.left=et.left,st.left.parent=st}else this.replace(et,et.left);else this.replace(et,et.right);return this._size--,!0},o.prototype.erase=function(et){var st=this.find(et);if(st){this.splay(st);var pi=st.left,Ni=st.right,dn=null;pi&&(pi.parent=null,dn=this.maxNode(pi),this.splay(dn),this._root=dn),Ni&&(pi?dn.right=Ni:this._root=Ni,Ni.parent=dn),this._size--}},o.prototype.pop=function(){var et=this._root,st=null;if(et){for(;et.left;)et=et.left;st={key:et.key,data:et.data},this.remove(et.key)}return st},o.prototype.next=function(et){var st=et;if(st)if(st.right)for(st=st.right;st&&st.left;)st=st.left;else for(st=et.parent;st&&st.right===et;)et=st,st=st.parent;return st},o.prototype.prev=function(et){var st=et;if(st)if(st.left)for(st=st.left;st&&st.right;)st=st.right;else for(st=et.parent;st&&st.left===et;)et=st,st=st.parent;return st},o.prototype.forEach=function(et){for(var st=this._root,pi=[],Ni=!1,dn=0;!Ni;)st?(pi.push(st),st=st.left):pi.length>0?(et(st=pi.pop(),dn++),st=st.right):Ni=!0;return this},o.prototype.range=function(et,st,pi,Ni){for(var dn=[],fn=this._compare,Un=this._root;dn.length!==0||Un;)if(Un)dn.push(Un),Un=Un.left;else{if(fn((Un=dn.pop()).key,st)>0)break;if(fn(Un.key,et)>=0&&pi.call(Ni,Un))return this;Un=Un.right}return this},o.prototype.keys=function(){for(var et=this._root,st=[],pi=[],Ni=!1;!Ni;)et?(st.push(et),et=et.left):st.length>0?(et=st.pop(),pi.push(et.key),et=et.right):Ni=!0;return pi},o.prototype.values=function(){for(var et=this._root,st=[],pi=[],Ni=!1;!Ni;)et?(st.push(et),et=et.left):st.length>0?(et=st.pop(),pi.push(et.data),et=et.right):Ni=!0;return pi},o.prototype.at=function(et){for(var st=this._root,pi=[],Ni=!1,dn=0;!Ni;)if(st)pi.push(st),st=st.left;else if(pi.length>0){if(st=pi.pop(),dn===et)return st;dn++,st=st.right}else Ni=!0;return null},o.prototype.load=function(et,st,pi){if(et===void 0&&(et=[]),st===void 0&&(st=[]),pi===void 0&&(pi=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ni=et.length;return pi&&w(et,st,0,Ni-1,this._compare),this._root=g(null,et,st,0,Ni),this._size=Ni,this},o.prototype.min=function(){var et=this.minNode(this._root);return et?et.key:null},o.prototype.max=function(){var et=this.maxNode(this._root);return et?et.key:null},o.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},o.createTree=function(et,st,pi,Ni,dn){return new o(pi,dn).load(et,st,Ni)},Object.defineProperties(o.prototype,d);var S=0,A=1,L=2,N=3,q=0,Z=1,Q=2,ne=3;function oe(et,st,pi){st===null?(et.inOut=!1,et.otherInOut=!0):(et.isSubject===st.isSubject?(et.inOut=!st.inOut,et.otherInOut=st.otherInOut):(et.inOut=!st.otherInOut,et.otherInOut=st.isVertical()?!st.inOut:st.inOut),st&&(et.prevInResult=!me(st,pi)||st.isVertical()?st.prevInResult:st));var Ni=me(et,pi);et.resultTransition=Ni?(function(dn,fn){var Un,Wn=!dn.inOut,Ir=!dn.otherInOut;switch(fn){case q:Un=Wn&&Ir;break;case Z:Un=Wn||Ir;break;case ne:Un=Wn^Ir;break;case Q:Un=dn.isSubject?Wn&&!Ir:Ir&&!Wn}return Un?1:-1})(et,pi):0}function me(et,st){switch(et.type){case S:switch(st){case q:return!et.otherInOut;case Z:return et.otherInOut;case Q:return et.isSubject&&et.otherInOut||!et.isSubject&&!et.otherInOut;case ne:return!0}break;case L:return st===q||st===Z;case N:return st===Q;case A:return!1}return!1}var Se=function(et,st,pi,Ni,dn){this.left=st,this.point=et,this.otherEvent=pi,this.isSubject=Ni,this.type=dn||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Te={inResult:{configurable:!0}};function Le(et,st){return et[0]===st[0]&&et[1]===st[1]}Se.prototype.isBelow=function(et){var st=this.point,pi=this.otherEvent.point;return this.left?(st[0]-et[0])*(pi[1]-et[1])-(pi[0]-et[0])*(st[1]-et[1])>0:(pi[0]-et[0])*(st[1]-et[1])-(st[0]-et[0])*(pi[1]-et[1])>0},Se.prototype.isAbove=function(et){return!this.isBelow(et)},Se.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Te.inResult.get=function(){return this.resultTransition!==0},Se.prototype.clone=function(){var et=new Se(this.point,this.left,this.otherEvent,this.isSubject,this.type);return et.contourId=this.contourId,et.resultTransition=this.resultTransition,et.prevInResult=this.prevInResult,et.isExteriorRing=this.isExteriorRing,et.inOut=this.inOut,et.otherInOut=this.otherInOut,et},Object.defineProperties(Se.prototype,Te);var Re=11102230246251565e-32,Ue=134217729,rt=(3+8*Re)*Re;function Qe(et,st,pi,Ni,dn){var fn,Un,Wn,Ir,zr=st[0],Vr=Ni[0],rs=0,cr=0;Vr>zr==Vr>-zr?(fn=zr,zr=st[++rs]):(fn=Vr,Vr=Ni[++cr]);var xr=0;if(rs<et&&cr<pi)for(Vr>zr==Vr>-zr?(Wn=fn-((Un=zr+fn)-zr),zr=st[++rs]):(Wn=fn-((Un=Vr+fn)-Vr),Vr=Ni[++cr]),fn=Un,Wn!==0&&(dn[xr++]=Wn);rs<et&&cr<pi;)Vr>zr==Vr>-zr?(Wn=fn-((Un=fn+zr)-(Ir=Un-fn))+(zr-Ir),zr=st[++rs]):(Wn=fn-((Un=fn+Vr)-(Ir=Un-fn))+(Vr-Ir),Vr=Ni[++cr]),fn=Un,Wn!==0&&(dn[xr++]=Wn);for(;rs<et;)Wn=fn-((Un=fn+zr)-(Ir=Un-fn))+(zr-Ir),zr=st[++rs],fn=Un,Wn!==0&&(dn[xr++]=Wn);for(;cr<pi;)Wn=fn-((Un=fn+Vr)-(Ir=Un-fn))+(Vr-Ir),Vr=Ni[++cr],fn=Un,Wn!==0&&(dn[xr++]=Wn);return fn===0&&xr!==0||(dn[xr++]=fn),xr}function ht(et){return new Float64Array(et)}var yt=33306690738754716e-32,Et=22204460492503146e-32,ai=11093356479670487e-47,kt=ht(4),fi=ht(8),Ti=ht(12),Si=ht(16),Bi=ht(4);function ji(et,st,pi){var Ni=(function(dn,fn,Un,Wn,Ir,zr){var Vr=(fn-zr)*(Un-Ir),rs=(dn-Ir)*(Wn-zr),cr=Vr-rs;if(Vr===0||rs===0||Vr>0!=rs>0)return cr;var xr=Math.abs(Vr+rs);return Math.abs(cr)>=yt*xr?cr:-(function(gs,Es,Is,$s,to,Ks,ks){var Fs,Or,us,Ro,ar,ss,eo,ro,mo,_a,ho,lr,Ho,Gs,Co,hl,Rl,Xa,Ya=gs-to,Il=Is-to,$u=Es-Ks,fo=$s-Ks;kt[0]=(Co=(ro=Ya-(eo=(ss=Ue*Ya)-(ss-Ya)))*(_a=fo-(mo=(ss=Ue*fo)-(ss-fo)))-((Gs=Ya*fo)-eo*mo-ro*mo-eo*_a))-((ho=Co-(Rl=(ro=$u-(eo=(ss=Ue*$u)-(ss-$u)))*(_a=Il-(mo=(ss=Ue*Il)-(ss-Il)))-((hl=$u*Il)-eo*mo-ro*mo-eo*_a)))+(ar=Co-ho))+(ar-Rl),kt[1]=(Ho=Gs-((lr=Gs+ho)-(ar=lr-Gs))+(ho-ar))-((ho=Ho-hl)+(ar=Ho-ho))+(ar-hl),kt[2]=lr-((Xa=lr+ho)-(ar=Xa-lr))+(ho-ar),kt[3]=Xa;var ua=(function(_g,_c){for(var bu=_c[0],id=1;id<4;id++)bu+=_c[id];return bu})(0,kt),ya=Et*ks;if(ua>=ya||-ua>=ya||(Fs=gs-(Ya+(ar=gs-Ya))+(ar-to),us=Is-(Il+(ar=Is-Il))+(ar-to),Or=Es-($u+(ar=Es-$u))+(ar-Ks),Ro=$s-(fo+(ar=$s-fo))+(ar-Ks),Fs===0&&Or===0&&us===0&&Ro===0)||(ya=ai*ks+rt*Math.abs(ua),(ua+=Ya*Ro+fo*Fs-($u*us+Il*Or))>=ya||-ua>=ya))return ua;Bi[0]=(Co=(ro=Fs-(eo=(ss=Ue*Fs)-(ss-Fs)))*(_a=fo-(mo=(ss=Ue*fo)-(ss-fo)))-((Gs=Fs*fo)-eo*mo-ro*mo-eo*_a))-((ho=Co-(Rl=(ro=Or-(eo=(ss=Ue*Or)-(ss-Or)))*(_a=Il-(mo=(ss=Ue*Il)-(ss-Il)))-((hl=Or*Il)-eo*mo-ro*mo-eo*_a)))+(ar=Co-ho))+(ar-Rl),Bi[1]=(Ho=Gs-((lr=Gs+ho)-(ar=lr-Gs))+(ho-ar))-((ho=Ho-hl)+(ar=Ho-ho))+(ar-hl),Bi[2]=lr-((Xa=lr+ho)-(ar=Xa-lr))+(ho-ar),Bi[3]=Xa;var Sh=Qe(4,kt,4,Bi,fi);Bi[0]=(Co=(ro=Ya-(eo=(ss=Ue*Ya)-(ss-Ya)))*(_a=Ro-(mo=(ss=Ue*Ro)-(ss-Ro)))-((Gs=Ya*Ro)-eo*mo-ro*mo-eo*_a))-((ho=Co-(Rl=(ro=$u-(eo=(ss=Ue*$u)-(ss-$u)))*(_a=us-(mo=(ss=Ue*us)-(ss-us)))-((hl=$u*us)-eo*mo-ro*mo-eo*_a)))+(ar=Co-ho))+(ar-Rl),Bi[1]=(Ho=Gs-((lr=Gs+ho)-(ar=lr-Gs))+(ho-ar))-((ho=Ho-hl)+(ar=Ho-ho))+(ar-hl),Bi[2]=lr-((Xa=lr+ho)-(ar=Xa-lr))+(ho-ar),Bi[3]=Xa;var dl=Qe(Sh,fi,4,Bi,Ti);Bi[0]=(Co=(ro=Fs-(eo=(ss=Ue*Fs)-(ss-Fs)))*(_a=Ro-(mo=(ss=Ue*Ro)-(ss-Ro)))-((Gs=Fs*Ro)-eo*mo-ro*mo-eo*_a))-((ho=Co-(Rl=(ro=Or-(eo=(ss=Ue*Or)-(ss-Or)))*(_a=us-(mo=(ss=Ue*us)-(ss-us)))-((hl=Or*us)-eo*mo-ro*mo-eo*_a)))+(ar=Co-ho))+(ar-Rl),Bi[1]=(Ho=Gs-((lr=Gs+ho)-(ar=lr-Gs))+(ho-ar))-((ho=Ho-hl)+(ar=Ho-ho))+(ar-hl),Bi[2]=lr-((Xa=lr+ho)-(ar=Xa-lr))+(ho-ar),Bi[3]=Xa;var wp=Qe(dl,Ti,4,Bi,Si);return Si[wp-1]})(dn,fn,Un,Wn,Ir,zr,xr)})(et[0],et[1],st[0],st[1],pi[0],pi[1]);return Ni>0?-1:Ni<0?1:0}function zi(et,st){var pi=et.point,Ni=st.point;return pi[0]>Ni[0]?1:pi[0]<Ni[0]?-1:pi[1]!==Ni[1]?pi[1]>Ni[1]?1:-1:(function(dn,fn,Un,Wn){return dn.left!==fn.left?dn.left?1:-1:ji(Un,dn.otherEvent.point,fn.otherEvent.point)!==0?dn.isBelow(fn.otherEvent.point)?-1:1:!dn.isSubject&&fn.isSubject?1:-1})(et,st,pi)}function Oi(et,st,pi){var Ni=new Se(st,!1,et,et.isSubject),dn=new Se(st,!0,et.otherEvent,et.isSubject);return Le(et.point,et.otherEvent.point)&&console.warn("what is that, a collapsed segment?",et),Ni.contourId=dn.contourId=et.contourId,zi(dn,et.otherEvent)>0&&(et.otherEvent.left=!0,dn.left=!1),et.otherEvent.otherEvent=dn,et.otherEvent=Ni,pi.push(dn),pi.push(Ni),pi}function di(et,st){return et[0]*st[1]-et[1]*st[0]}function ui(et,st){return et[0]*st[0]+et[1]*st[1]}function Fi(et,st,pi){var Ni=(function(Ir,zr,Vr,rs,cr){var xr=[zr[0]-Ir[0],zr[1]-Ir[1]],gs=[rs[0]-Vr[0],rs[1]-Vr[1]];function Es(ss,eo,ro){return[ss[0]+eo*ro[0],ss[1]+eo*ro[1]]}var Is=[Vr[0]-Ir[0],Vr[1]-Ir[1]],$s=di(xr,gs),to=$s*$s,Ks=ui(xr,xr);if(to>0){var ks=di(Is,gs)/$s;if(ks<0||ks>1)return null;var Fs=di(Is,xr)/$s;return Fs<0||Fs>1?null:ks===0||ks===1?[Es(Ir,ks,xr)]:Fs===0||Fs===1?[Es(Vr,Fs,gs)]:[Es(Ir,ks,xr)]}if((to=($s=di(Is,xr))*$s)>0)return null;var Or=ui(xr,Is)/Ks,us=Or+ui(xr,gs)/Ks,Ro=Math.min(Or,us),ar=Math.max(Or,us);return Ro<=1&&ar>=0?Ro===1?[Es(Ir,Ro>0?Ro:0,xr)]:ar===0?[Es(Ir,ar<1?ar:1,xr)]:[Es(Ir,Ro>0?Ro:0,xr),Es(Ir,ar<1?ar:1,xr)]:null})(et.point,et.otherEvent.point,st.point,st.otherEvent.point),dn=Ni?Ni.length:0;if(dn===0||dn===1&&(Le(et.point,st.point)||Le(et.otherEvent.point,st.otherEvent.point))||dn===2&&et.isSubject===st.isSubject)return 0;if(dn===1)return Le(et.point,Ni[0])||Le(et.otherEvent.point,Ni[0])||Oi(et,Ni[0],pi),Le(st.point,Ni[0])||Le(st.otherEvent.point,Ni[0])||Oi(st,Ni[0],pi),1;var fn=[],Un=!1,Wn=!1;return Le(et.point,st.point)?Un=!0:zi(et,st)===1?fn.push(st,et):fn.push(et,st),Le(et.otherEvent.point,st.otherEvent.point)?Wn=!0:zi(et.otherEvent,st.otherEvent)===1?fn.push(st.otherEvent,et.otherEvent):fn.push(et.otherEvent,st.otherEvent),Un&&Wn||Un?(st.type=A,et.type=st.inOut===et.inOut?L:N,Un&&!Wn&&Oi(fn[1].otherEvent,fn[0].point,pi),2):Wn?(Oi(fn[0],fn[1].point,pi),3):fn[0]!==fn[3].otherEvent?(Oi(fn[0],fn[1].point,pi),Oi(fn[1],fn[2].point,pi),3):(Oi(fn[0],fn[1].point,pi),Oi(fn[3].otherEvent,fn[2].point,pi),3)}function tn(et,st){if(et===st)return 0;if(ji(et.point,et.otherEvent.point,st.point)!==0||ji(et.point,et.otherEvent.point,st.otherEvent.point)!==0)return Le(et.point,st.point)?et.isBelow(st.otherEvent.point)?-1:1:et.point[0]===st.point[0]?et.point[1]<st.point[1]?-1:1:zi(et,st)===1?st.isAbove(et.point)?-1:1:et.isBelow(st.point)?-1:1;if(et.isSubject!==st.isSubject)return et.isSubject?-1:1;var pi=et.point,Ni=st.point;return pi[0]===Ni[0]&&pi[1]===Ni[1]?(pi=et.otherEvent.point)[0]===(Ni=st.otherEvent.point)[0]&&pi[1]===Ni[1]?0:et.contourId>st.contourId?1:-1:zi(et,st)===1?1:-1}var Xi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Vn(et,st,pi,Ni){var dn,fn=et+1,Un=st[et].point,Wn=st.length;for(fn<Wn&&(dn=st[fn].point);fn<Wn&&dn[0]===Un[0]&&dn[1]===Un[1];){if(!pi[fn])return fn;++fn<Wn&&(dn=st[fn].point)}for(fn=et-1;pi[fn]&&fn>Ni;)fn--;return fn}Xi.prototype.isExterior=function(){return this.holeOf==null};var _n=Dn,In=Dn;function Dn(et,st){if(!(this instanceof Dn))return new Dn(et,st);if(this.data=et||[],this.length=this.data.length,this.compare=st||jr,this.length>0)for(var pi=(this.length>>1)-1;pi>=0;pi--)this._down(pi)}function jr(et,st){return et<st?-1:et>st?1:0}Dn.prototype={push:function(et){this.data.push(et),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var et=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),et}},peek:function(){return this.data[0]},_up:function(et){for(var st=this.data,pi=this.compare,Ni=st[et];et>0;){var dn=et-1>>1,fn=st[dn];if(pi(Ni,fn)>=0)break;st[et]=fn,et=dn}st[et]=Ni},_down:function(et){for(var st=this.data,pi=this.compare,Ni=this.length>>1,dn=st[et];et<Ni;){var fn=1+(et<<1),Un=fn+1,Wn=st[fn];if(Un<this.length&&pi(st[Un],Wn)<0&&(fn=Un,Wn=st[Un]),pi(Wn,dn)>=0)break;st[et]=Wn,et=fn}st[et]=dn}},_n.default=In;var Ki=Math.max,Rn=Math.min,wr=0;function os(et,st,pi,Ni,dn,fn){var Un,Wn,Ir,zr,Vr,rs;for(Un=0,Wn=et.length-1;Un<Wn;Un++)if(zr=et[Un+1],Vr=new Se(Ir=et[Un],!1,void 0,st),rs=new Se(zr,!1,Vr,st),Vr.otherEvent=rs,Ir[0]!==zr[0]||Ir[1]!==zr[1]){Vr.contourId=rs.contourId=pi,fn||(Vr.isExteriorRing=!1,rs.isExteriorRing=!1),zi(Vr,rs)>0?rs.left=!0:Vr.left=!0;var cr=Ir[0],xr=Ir[1];dn[0]=Rn(dn[0],cr),dn[1]=Rn(dn[1],xr),dn[2]=Ki(dn[2],cr),dn[3]=Ki(dn[3],xr),Ni.push(Vr),Ni.push(rs)}}var ds=[];function Mr(et,st,pi){typeof et[0][0][0]=="number"&&(et=[et]),typeof st[0][0][0]=="number"&&(st=[st]);var Ni=(function(xr,gs,Es){var Is=null;return xr.length*gs.length==0&&(Es===q?Is=ds:Es===Q?Is=xr:Es!==Z&&Es!==ne||(Is=xr.length===0?gs:xr)),Is})(et,st,pi);if(Ni)return Ni===ds?null:Ni;var dn=[1/0,1/0,-1/0,-1/0],fn=[1/0,1/0,-1/0,-1/0],Un=(function(xr,gs,Es,Is,$s){var to,Ks,ks,Fs,Or,us,Ro=new _n(null,zi);for(ks=0,Fs=xr.length;ks<Fs;ks++)for(Or=0,us=(to=xr[ks]).length;Or<us;Or++)(Ks=Or===0)&&wr++,os(to[Or],!0,wr,Ro,Es,Ks);for(ks=0,Fs=gs.length;ks<Fs;ks++)for(Or=0,us=(to=gs[ks]).length;Or<us;Or++)Ks=Or===0,$s===Q&&(Ks=!1),Ks&&wr++,os(to[Or],!1,wr,Ro,Is,Ks);return Ro})(et,st,dn,fn,pi);if(Ni=(function(xr,gs,Es,Is,$s){var to=null;return(Es[0]>Is[2]||Is[0]>Es[2]||Es[1]>Is[3]||Is[1]>Es[3])&&($s===q?to=ds:$s===Q?to=xr:$s!==Z&&$s!==ne||(to=xr.concat(gs))),to})(et,st,dn,fn,pi))return Ni===ds?null:Ni;for(var Wn=(function(xr){var gs,Es,Is=(function(ks){var Fs,Or,us,Ro,ar=[];for(Or=0,us=ks.length;Or<us;Or++)((Fs=ks[Or]).left&&Fs.inResult||!Fs.left&&Fs.otherEvent.inResult)&&ar.push(Fs);for(var ss=!1;!ss;)for(ss=!0,Or=0,us=ar.length;Or<us;Or++)Or+1<us&&zi(ar[Or],ar[Or+1])===1&&(Ro=ar[Or],ar[Or]=ar[Or+1],ar[Or+1]=Ro,ss=!1);for(Or=0,us=ar.length;Or<us;Or++)(Fs=ar[Or]).otherPos=Or;for(Or=0,us=ar.length;Or<us;Or++)(Fs=ar[Or]).left||(Ro=Fs.otherPos,Fs.otherPos=Fs.otherEvent.otherPos,Fs.otherEvent.otherPos=Ro);return ar})(xr),$s={},to=[],Ks=function(){if(!$s[gs]){var ks=to.length,Fs=(function(ar,ss,eo){var ro=new Xi;if(ar.prevInResult!=null){var mo=ar.prevInResult,_a=mo.outputContourId;if(mo.resultTransition>0){var ho=ss[_a];if(ho.holeOf!=null){var lr=ho.holeOf;ss[lr].holeIds.push(eo),ro.holeOf=lr,ro.depth=ss[_a].depth}else ss[_a].holeIds.push(eo),ro.holeOf=_a,ro.depth=ss[_a].depth+1}else ro.holeOf=null,ro.depth=ss[_a].depth}else ro.holeOf=null,ro.depth=0;return ro})(Is[gs],to,ks),Or=function(ar){$s[ar]=!0,ar<Is.length&&Is[ar]&&(Is[ar].outputContourId=ks)},us=gs,Ro=gs;for(Fs.points.push(Is[gs].point);Or(us),Or(us=Is[us].otherPos),Fs.points.push(Is[us].point),!((us=Vn(us,Is,$s,Ro))==Ro||us>=Is.length)&&Is[us];);to.push(Fs)}};for(gs=0,Es=Is.length;gs<Es;gs++)Ks();return to})((function(xr,gs,Es,Is,$s,to){for(var Ks,ks,Fs,Or=new o(tn),us=[],Ro=Math.min(Is[2],$s[2]);xr.length!==0;){var ar=xr.pop();if(us.push(ar),to===q&&ar.point[0]>Ro||to===Q&&ar.point[0]>Is[2])break;if(ar.left){ks=Ks=Or.insert(ar),Ks=Ks!==(Fs=Or.minNode())?Or.prev(Ks):null,ks=Or.next(ks);var ss=Ks?Ks.key:null;if(oe(ar,ss,to),ks&&Fi(ar,ks.key,xr)===2&&(oe(ar,ss,to),oe(ks.key,ar,to)),Ks&&Fi(Ks.key,ar,xr)===2){var eo=Ks;oe(ss,(eo=eo!==Fs?Or.prev(eo):null)?eo.key:null,to),oe(ar,ss,to)}}else ks=Ks=Or.find(ar=ar.otherEvent),Ks&&ks&&(Ks=Ks!==Fs?Or.prev(Ks):null,ks=Or.next(ks),Or.remove(ar),ks&&Ks&&Fi(Ks.key,ks.key,xr))}return us})(Un,0,0,dn,fn,pi)),Ir=[],zr=0;zr<Wn.length;zr++){var Vr=Wn[zr];if(Vr.isExterior()){for(var rs=[Vr.points],cr=0;cr<Vr.holeIds.length;cr++)rs.push(Wn[Vr.holeIds[cr]].points);Ir.push(rs)}}return Ir}var Ys={UNION:Z,DIFFERENCE:Q,INTERSECTION:q,XOR:ne};a.diff=function(et,st){return Mr(et,st,Q)},a.intersection=function(et,st){return Mr(et,st,q)},a.operations=Ys,a.union=function(et,st){return Mr(et,st,Z)},a.xor=function(et,st){return Mr(et,st,ne)},Object.defineProperty(a,"__esModule",{value:!0})})(M0.exports)),M0.exports);function k0(a,n,o,d){const g=[],w=d===0?(S,A,L,N,q,Z)=>{S.push(new yi(Z,L+(Z-A)/(N-A)*(q-L)))}:(S,A,L,N,q,Z)=>{S.push(new yi(A+(Z-L)/(q-L)*(N-A),Z))};for(const S of a){const A=[];for(const L of S){if(L.length<=2)continue;const N=[];for(let Q=0;Q<L.length-1;Q++){const ne=L[Q].x,oe=L[Q].y,me=L[Q+1].x,Se=L[Q+1].y,Te=d===0?ne:oe,Le=d===0?me:Se;Te<n?Le>n&&w(N,ne,oe,me,Se,n):Te>o?Le<o&&w(N,ne,oe,me,Se,o):N.push(L[Q]),Le<n&&Te>=n&&w(N,ne,oe,me,Se,n),Le>o&&Te<=o&&w(N,ne,oe,me,Se,o)}let q=L[L.length-1];const Z=d===0?q.x:q.y;Z>=n&&Z<=o&&N.push(q),N.length&&(q=N[N.length-1],N[0].x===q.x&&N[0].y===q.y||N.push(N[0]),A.push(N))}A.length&&g.push(A)}return g}function g_(a,n){const o=$b(a),d=$b([n]),g=E2.intersection(o,d);return g==null?[]:Gb(g)}function Ty(a,n){let d=$b(a,65536);const g=[];for(;n.valid();n.next()){const[w,S]=n.get(),A=w.x*65536,L=w.y*65536,N=S.x*65536,q=S.y*65536,Z=N-A,Q=q-L,ne=Math.hypot(Z,Q);if(ne===0)continue;const oe=Math.trunc(Q/ne*3),me=-Math.trunc(Z/ne*3);g.push([[[A,L],[N,q],[N+oe,q+me],[A+oe,L+me],[A,L]]])}return g.length>0&&(d=E2.diff(d,g)),Gb(d,1/65536)}function $b(a,n=1){return[a.map((o=>o.map((d=>[d.x*n,d.y*n]))))]}function Gb(a,n=1){return a.map((o=>o.map(((d,g)=>{const w=d.map((S=>new yi(S[0]*n,S[1]*n).round()));return g>0&&w.reverse(),w}))))}class Rv{constructor(n,o){this.layoutVertexArray=new pa,this.indexArray=new $o,this.lineIndexArray=new Ws,this.triangleSegments=new bo,this.lineSegments=new bo,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new ma)}update(n,o,d,g,w,S,A,L){this.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,L)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,m2.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.lineIndexBuffer=n.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,g2.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(n,o,d,g,w,S,A){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,o,d,g,w,S,void 0,A)}}class zv{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=n.lut,this.bufferData=new Rv(n,!1),this.elevationBufferData=new Rv(n,!0),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.projection=n.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=n.sourceLayerIndex,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,d,g){}populate(n,o,d,g){this.hasPattern=nm("fill",this.layers,this.pixelRatio,o);const w=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:A,id:L,index:N,sourceLayerIndex:q}of n){const Z=this.layers[0]._featureFilter.needGeometry,Q=Pt(A,Z);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Q,d))continue;const ne=w?w.evaluate(Q,{},d,o.availableImages):void 0,oe={id:L,properties:A.properties,type:A.type,sourceLayerIndex:q,index:N,geometry:Z?Q.geometry:mt(A,d,g),patterns:{},sortKey:ne};S.push(oe)}w&&S.sort(((A,L)=>A.sortKey-L.sortKey));for(const A of S){const{geometry:L,index:N,sourceLayerIndex:q}=A;if(this.hasPattern){const Z=xu("fill",this.layers,A,this.zoom,this.pixelRatio,o);this.patternFeatures.push(Z)}else this.addFeature(A,L,N,d,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(n[N].feature,L,N,q,this.index)}}update(n,o,d,g,w,S,A){this.bufferData.update(n,o,d,g,w,S,A,this.worldview),this.elevationBufferData.update(n,o,d,g,w,S,A,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(n,o,d,g,w,S,A,this.worldview)}addFeatures(n,o,d,g,w,S){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,o,d,g,S,n.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(n){this.bufferData.upload(n),this.elevationBufferData.upload(n),this.elevatedStructures&&this.elevatedStructures.upload(n)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(n,o,d,g,w,S=[],A,L){const N=Jh(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(n,N,g,d,L):this.addGeometry(N,this.bufferData),this.bufferData.populatePaintArrays(n,d,w,S,g,A,this.worldview),this.elevationBufferData.populatePaintArrays(n,d,w,S,g,A,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(n,o,d,g,w){this.elevatedStructures&&(this.elevatedStructures.construct(n),this.elevatedStructures.populatePaintArrays(o,d,g,w,this.worldview))}addElevatedRoadFeature(n,o,d,g,w){const S=new Array,A=Ts.getElevationFeature(n,w);if(!A)return void this.addGeometry(o,this.bufferData);{const N=this.clipPolygonsToTile(o,1);N.length>0&&S.push({polygons:N,elevationFeature:A,elevationTileID:d})}const L={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(n,{},d),featureIndex:g};for(const N of S)if(N.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ba(N.elevationTileID,this.layers,this.zoom,this.lut));const Z=N.elevationFeature.isTunnel();let Q=0;n.properties.hasOwnProperty(ni)&&(Q=+n.properties[ni]);for(const ne of N.polygons)this.elevatedStructures.addPortalCandidates(N.elevationFeature.id,ne,Z,N.elevationFeature,Q)}N.elevationFeature.constantHeight==null&&(N.polygons=this.prepareElevatedPolygons(N.polygons,N.elevationFeature,N.elevationTileID));const q=new zs(d,N.elevationTileID);this.addElevatedGeometry(N.polygons,q,N.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,g,L)}}addElevatedGeometry(n,o,d,g,w,S){const A={elevation:d,elevationSampler:o,bias:g,index:w,featureInfo:S},[L,N]=this.addGeometry(n,this.elevationBufferData,A);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:L,max:N}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,L),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,N))}addGeometry(n,o,d){let g=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,S=null;d&&(S=d.elevationSampler.constantElevation(d.elevation,d.bias),S!=null&&(g=S,w=S));const A=(L,N,q)=>{if(d!=null)if(N.push(L),S!=null)o.elevatedLayoutVertexArray.emplaceBack(S),q.push(S);else{const Z=d.elevationSampler.pointElevation(L,d.elevation,d.bias);o.elevatedLayoutVertexArray.emplaceBack(Z),q.push(Z),g=Math.min(g,Z),w=Math.max(w,Z)}};for(const L of n){let N=0;for(const Re of L)N+=Re.length;const q=o.triangleSegments.prepareSegment(N,o.layoutVertexArray,o.indexArray),Z=q.vertexLength,Q=[],ne=[],oe=[],me=[],Se=[],Te=o.layoutVertexArray.length;for(const Re of L){if(Re.length===0)continue;Re!==L[0]&&ne.push(Q.length/2);const Ue=o.lineSegments.prepareSegment(Re.length,o.layoutVertexArray,o.lineIndexArray),rt=Ue.vertexLength;d&&Se.push(o.layoutVertexArray.length-Te),A(Re[0],oe,me),o.layoutVertexArray.emplaceBack(Re[0].x,Re[0].y),o.lineIndexArray.emplaceBack(rt+Re.length-1,rt),Q.push(Re[0].x),Q.push(Re[0].y);for(let Qe=1;Qe<Re.length;Qe++)A(Re[Qe],oe,me),o.layoutVertexArray.emplaceBack(Re[Qe].x,Re[Qe].y),o.lineIndexArray.emplaceBack(rt+Qe-1,rt+Qe),Q.push(Re[Qe].x),Q.push(Re[Qe].y);Ue.vertexLength+=Re.length,Ue.primitiveLength+=Re.length}const Le=p_(Q,ne);for(let Re=0;Re<Le.length;Re+=3)o.indexArray.emplaceBack(Z+Le[Re],Z+Le[Re+1],Z+Le[Re+2]);if(Le.length>0&&d&&this.elevationMode==="hd-road-base"){const Re=d.elevation.isTunnel(),Ue=d.elevation.safeArea,rt=this.elevatedStructures.addVertices(oe,me);this.elevatedStructures.addTriangles(Le,rt,Re);const Qe=Se.length;if(Qe>0){for(let ht=0;ht<Qe-1;ht++)this.elevatedStructures.addRenderableRing(d.index,Se[ht]+rt,Se[ht+1]-Se[ht],Re,Ue,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,Se[Qe-1]+rt,oe.length-Se[Qe-1],Re,Ue,d.featureInfo)}}q.vertexLength+=N,q.primitiveLength+=Le.length/3}return[g,w]}prepareElevatedPolygons(n,o,d){const g=1/Ae(d),w=[];for(const S of n){const A=Ty(S,new fs(o,g));w.push(...A)}return w}clipPolygonsToTile(n,o){const d=-o,g=-o,w=Ji+o,S=Ji+o;let A=0;const L=[],N=[];for(;A<n.length;A++){const Q=n[A],ne=sh(Q);(ne.min.x>=d&&ne.max.x<=w&&ne.min.y>=g&&ne.max.y<=S?L:N).push(Q)}if(L.length===n.length)return n;const q=[new yi(d,g),new yi(w,g),new yi(w,S),new yi(d,S),new yi(d,g)],Z=L;for(const Q of N)Z.push(...g_(Q,q));return Z}}let Ov,qb,Fv,Kc;Cn(zv,"FillBucket",{omit:["layers","patternFeatures"]}),Cn(Rv,"FillBufferData"),Cn(Ba,"ElevatedStructures");class bh{constructor(n,o,d,g){if(this.triangleCount=o.length/3,this.min=new yi(0,0),this.max=new yi(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[w,S]=[n[0].clone(),n[0].clone()];for(let Z=1;Z<n.length;++Z){const Q=n[Z];w.x=Math.min(w.x,Q.x),w.y=Math.min(w.y,Q.y),S.x=Math.max(S.x,Q.x),S.y=Math.max(S.y,Q.y)}if(g){const Z=Math.ceil(Math.max(S.x-w.x,S.y-w.y)/g);d=Math.max(d,Z)}if(d===0)return;this.min=w,this.max=S;const A=this.max.sub(this.min);A.x=Math.max(A.x,1),A.y=Math.max(A.y,1);const L=Math.max(A.x,A.y)/d;this.cellsX=Math.max(1,Math.ceil(A.x/L)),this.cellsY=Math.max(1,Math.ceil(A.y/L)),this.xScale=1/L,this.yScale=1/L;const N=[];for(let Z=0;Z<this.triangleCount;Z++){const Q=n[o[3*Z+0]].sub(this.min),ne=n[o[3*Z+1]].sub(this.min),oe=n[o[3*Z+2]].sub(this.min),me=rl(Math.floor(Math.min(Q.x,ne.x,oe.x)),this.xScale,this.cellsX),Se=rl(Math.floor(Math.max(Q.x,ne.x,oe.x)),this.xScale,this.cellsX),Te=rl(Math.floor(Math.min(Q.y,ne.y,oe.y)),this.yScale,this.cellsY),Le=rl(Math.floor(Math.max(Q.y,ne.y,oe.y)),this.yScale,this.cellsY),Re=new yi(0,0),Ue=new yi(0,0),rt=new yi(0,0),Qe=new yi(0,0);for(let ht=Te;ht<=Le;++ht){Re.y=Ue.y=ht*L,rt.y=Qe.y=(ht+1)*L;for(let yt=me;yt<=Se;++yt)Re.x=rt.x=yt*L,Ue.x=Qe.x=(yt+1)*L,(ec(Q,ne,oe,Re,Ue,Qe)||ec(Q,ne,oe,Re,Qe,rt))&&N.push({cellIdx:ht*this.cellsX+yt,triIdx:Z})}}if(N.length===0)return;N.sort(((Z,Q)=>Z.cellIdx-Q.cellIdx||Z.triIdx-Q.triIdx));let q=0;for(;q<N.length;){const Z=N[q].cellIdx,Q={start:this.payload.length,len:0};for(;q<N.length&&N[q].cellIdx===Z;)++Q.len,this.payload.push(N[q++].triIdx);this.cells[Z]=Q}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const d=rl(n.x-this.min.x,this.xScale,this.cellsX),g=rl(n.y-this.min.y,this.yScale,this.cellsY),w=this.cells[g*this.cellsX+d];if(w){this._lazyInitLookup();for(let S=0;S<w.len;S++){const A=this.payload[w.start+S],L=Math.floor(A/8),N=1<<A%8;if(!(this.lookup[L]&N)&&(this.lookup[L]|=N,o.push(A),o.length===this.triangleCount))return}}}query(n,o,d){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const g=rl(n.x-this.min.x,this.xScale,this.cellsX),w=rl(o.x-this.min.x,this.xScale,this.cellsX),S=rl(n.y-this.min.y,this.yScale,this.cellsY),A=rl(o.y-this.min.y,this.yScale,this.cellsY);for(let L=S;L<=A;L++)for(let N=g;N<=w;N++){const q=this.cells[L*this.cellsX+N];if(q)for(let Z=0;Z<q.len;Z++){const Q=this.payload[q.start+Z],ne=Math.floor(Q/8),oe=1<<Q%8;if(!(this.lookup[ne]&oe)&&(this.lookup[ne]|=oe,d.push(Q),d.length===this.triangleCount))return}}}}function rl(a,n,o){return Math.max(0,Math.min(o-1,Math.floor(a*n)))}Cn(bh,"TriangleGridIndex");class rm{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.footprints=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){for(const d of this.footprints)o.push({footprint:d,id:n})}updateAppearances(n,o,d,g){}populate(n,o,d,g){const w=[];for(const{feature:S,id:A,index:L,sourceLayerIndex:N}of n){const q=this.layers[0]._featureFilter.needGeometry,Z=Pt(S,q);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Z,d))continue;const Q={id:A,properties:S.properties,type:S.type,sourceLayerIndex:N,index:L,geometry:q?Z.geometry:mt(S,d,g),patterns:{}};w.push(Q)}for(const S of w){const{geometry:A,index:L,sourceLayerIndex:N}=S;this.addFeature(S,A,L,d,{},o.availableImages,o.brightness),o.featureIndex.insert(n[L].feature,A,L,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,d,g,w,S,A){}destroy(){}addFeature(n,o,d,g,w,S=[],A){for(const L of Jh(o,2)){const N=[],q=[],Z=[],Q=new yi(1/0,1/0),ne=new yi(-1/0,-1/0);for(const Se of L)if(Se.length!==0){Se!==L[0]&&Z.push(q.length/2);for(let Te=0;Te<Se.length;Te++)q.push(Se[Te].x),q.push(Se[Te].y),N.push(Se[Te]),Q.x=Math.min(Q.x,Se[Te].x),Q.y=Math.min(Q.y,Se[Te].y),ne.x=Math.max(ne.x,Se[Te].x),ne.y=Math.max(ne.y,Se[Te].y)}const oe=p_(q,Z),me=new bh(N,oe,8,256);this.footprints.push({vertices:N,indices:oe,grid:me,min:Q,max:ne})}}}Cn(rm,"ClipBucket",{omit:["layers"]});const Bv=hr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Hb=hr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),I2=hr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),C2=hr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),A2=hr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),P2=hr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Wb=hr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Nv}=Bv,Sy=Number.MAX_SAFE_INTEGER,Zb=Sy-1;function __(a,n,o,d){return a.order<n||a.order===Sy||!(a.clipMask&o)||(function(g,w){return w.length!==0&&w.find((S=>S===g))===void 0})(d,a.clipScope)}function Ey(a,n){return a.x-n.x||a.y-n.y}function Xb(a,n){return Ey(a.min,n.min)===0&&Ey(a.max,n.max)===0}function Yb(a,n){return!(a.min.x>n.max.x||a.max.x<n.min.x||a.min.y>n.max.y||a.max.y<n.min.y)}function D0(a,n){if(a.length!==n.length)return!1;for(let o=0;o<a.length;o++)if(a[o].sourceId!==n[o].sourceId||!Xb(a[o],n[o])||a[o].order!==n[o].order||a[o].clipMask!==n[o].clipMask||!Ao(a[o].clipScope,n[o].clipScope))return!1;return!0}function L0(a,n,o){const d=1/Ji,g=1/(1<<o.canonical.z),w=(n.x*d+o.canonical.x)*g+o.wrap,S=(n.y*d+o.canonical.y)*g;return{min:new yi((a.x*d+o.canonical.x)*g+o.wrap,(a.y*d+o.canonical.y)*g),max:new yi(w,S)}}function Vv(a,n,o){const d=1<<o.canonical.z,g=((n.x-o.wrap)*d-o.canonical.x)*Ji,w=(n.y*d-o.canonical.y)*Ji;return{min:new yi(((a.x-o.wrap)*d-o.canonical.x)*Ji,(a.y*d-o.canonical.y)*Ji),max:new yi(g,w)}}function Iy(a,n,o,d,g,w,S){const A=a.indices,L=a.vertices,N=[];for(let q=d;q<d+g;q+=3){const Z=n[o[q+0]+w],Q=n[o[q+1]+w],ne=n[o[q+2]+w],oe=Math.min(Z.x,Q.x,ne.x),me=Math.max(Z.x,Q.x,ne.x),Se=Math.min(Z.y,Q.y,ne.y),Te=Math.max(Z.y,Q.y,ne.y);N.length=0,a.grid.query(new yi(oe,Se),new yi(me,Te),N);for(let Le=0;Le<N.length;Le++){const Re=N[Le];if(ec(L[A[3*Re+0]],L[A[3*Re+1]],L[A[3*Re+2]],Z,Q,ne,S))return!0}}return!1}function jv(a,n,o,d){if(!a||!o)return!1;let g=a.vertices;if(!n.canonical.equals(d.canonical)||n.wrap!==d.wrap){if(o.vertices.length<a.vertices.length)return jv(o,d,a,n);const w=n.canonical,S=d.canonical,A=Math.pow(2,S.z-w.z);g=a.vertices.map((L=>new yi((L.x+w.x*Ji)*A-S.x*Ji,(L.y+w.y*Ji)*A-S.y*Ji)))}return Iy(o,g,a.indices,0,a.indices.length,0,0)}function Uv(a,n,o,d){const g=Math.pow(2,d.z-o.z);return new yi((a+o.x*Ji)*g-d.x*Ji,(n+o.y*Ji)*g-d.y*Ji)}function $v(a,n){const o=[];n.grid.queryPoint(a,o);const d=n.indices,g=n.vertices;for(let w=0;w<o.length;w++){const S=o[w];if(Zs([g[d[3*S+0]],g[d[3*S+1]],g[d[3*S+2]]],a))return!0}return!1}const Gv=[new yi(0,0),new yi(Ji,0),new yi(Ji,Ji),new yi(0,Ji)];function Kb(a,n){const o=[];let d=[];if(!n||a.length<2)return[a];if(a.length===2)return Dl(a[0],a[1],Gv)?[a]:[];for(let g=0;g<a.length+2;g++){const w=a[g%a.length],S=a[(g+1)%a.length],A=Dl(g===0?a[a.length-1]:a[(g-1)%a.length],w,Gv),L=Dl(w,S,Gv),N=A||L;N&&d.push(w),N&&L||d.length>0&&(d.length>1&&o.push(d),d=[])}return d.length>1&&o.push(d),o}const qv=It.types,M2=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],k2=["fill-extrusion-flood-light-ground-radius"],_I=Math.pow(2,13),D2=Math.pow(2,15)-1,L2=new yi(0,1),sm=2147483648,Hv=7,Jb=450;function R0(a,n,o,d,g,w,S,A){a.emplaceBack((n<<1)+S,(o<<1)+w,(Math.floor(d*_I)<<1)+g,Math.round(A))}function z0(a,n,o){a.emplaceBack(n.x*Ji,n.y*Ji,o?1:0)}function O0(a,n,o,d,g,w){a.emplaceBack(n.x,n.y,(o.x<<1)+d,(o.y<<1)+g,w)}function om(a,n,o){a.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Qb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class R2{constructor(){this.centroidXY=new yi(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new yi(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new yi(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new yi(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wv{constructor(){this.acc=new yi(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,d){this.accCount++,this.acc._add(o);let g=!!this.borders;o.x<n.min.x?(n.min.x=o.x,g=!0):o.x>n.max.x&&(n.max.x=o.x,g=!0),o.y<n.min.y?(n.min.y=o.y,g=!0):o.y>n.max.y&&(n.max.y=o.y,g=!0),((o.x===0||o.x===Ji)&&o.x===d.x)!=((o.y===0||o.y===Ji)&&o.y===d.y)&&this.processBorderOverlap(o,d),g&&this.checkBorderIntersection(o,d)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,Gn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>Ji!=n.x>Ji&&this.addBorderIntersection(1,Gn(o.y,n.y,(Ji-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Gn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>Ji!=n.y>Ji&&this.addBorderIntersection(3,Gn(o.x,n.x,(Ji-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[n];o<d[0]&&(d[0]=o),o>d[1]&&(d[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const d=n.x===0?0:1;this.addBorderIntersection(d,o.y),this.addBorderIntersection(d,n.y)}else{const d=n.y===0?2:3;this.addBorderIntersection(d,o.x),this.addBorderIntersection(d,n.x)}}centroid(){return this.accCount===0?new yi(0,0):new yi(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((n,o)=>n+ +(o[0]!==Number.MAX_VALUE)),0):0}}function Zv(a,n){const o=a.add(n)._unit(),d=we(a.x*o.x+a.y*o.y,-1,1);var g,w,S;return g=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(g)))/4*D2*((w=a).x*(S=n).y-w.y*S.x<0?-1:1)}const z2=[a=>a.x<0,a=>a.x>Ji,a=>a.y<0,a=>a.y>Ji];function Cy(a,n,o,d){const g=[4];if(d===0)return g;o._mult(d);const w=a.sub(o),S=n.sub(o),A=[a,n,w,S];for(let L=0;L<4;L++)for(const N of A)if(z2[L](N)){g.push(L);break}return g}class Xv{constructor(n){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new gu,this.indexArray=new $o,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut},(o=>k2.includes(o))),this._segments=new bo,this.hiddenByLandmarkVertexArray=new ig,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new bo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,d,g=!1){const w=n.length;if(w>2){let S=Math.max(0,this._segments.get().length-1);const A=this._segments._prepareSegment(4*w,this.vertexArray.length,2*this._segmentToGroundQuads[S].length);let L;S!==this._segments.get().length-1&&(S++,this._segmentToGroundQuads[S]=[],this._segmentToRegionTriCounts[S]=[0,0,0,0,0]);{const N=n[0],q=n[1];L=Zv(N.sub(n[w-1])._perp()._unit(),q.sub(N)._perp()._unit())}for(let N=0;N<w;N++){const q=N===w-1?0:N+1,Z=n[N],Q=n[q],ne=n[q===w-1?0:q+1],oe=Q.sub(Z)._perp()._unit(),me=Zv(oe,ne.sub(Q)._perp()._unit()),Se=L,Te=me;if(Kv(Z,Q,o)||g&&e1(Z,o)&&e1(Q,o)){L=me;continue}const Le=A.vertexLength;O0(this.vertexArray,Z,Q,1,1,Se),O0(this.vertexArray,Z,Q,1,0,Se),O0(this.vertexArray,Z,Q,0,1,Te),O0(this.vertexArray,Z,Q,0,0,Te),A.vertexLength+=4;const Re=Cy(Z,Q,oe,d);for(const Ue of Re)this._segmentToGroundQuads[S].push({id:Le,region:Ue}),this._segmentToRegionTriCounts[S][Ue]+=2,A.primitiveLength+=2;L=me}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let d=0;d<o;d++)this._segmentToGroundQuads[d].sort(((g,w)=>g.region-w.region));for(let d=0;d<o;d++){const g=this._segmentToGroundQuads[d],w=n[d],S=this._segmentToRegionTriCounts[d];S.reduce(((L,N)=>L+N),0);let A=0;for(let L=0;L<=4;L++){const N=S[L];if(N!==0){let q=this.regionSegments[L];q||(q=this.regionSegments[L]=new bo);const Z={vertexOffset:w.vertexOffset,primitiveOffset:w.primitiveOffset+A,vertexLength:w.vertexLength,primitiveLength:N};q.get().push(Z)}A+=N}for(let L=0;L<g.length;L++){const N=g[L].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,d,g,w,S,A){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,d,g,w,S,void 0,A)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Hb.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=n.createVertexBuffer(this.groundRadiusArray,I2.members)))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,d,g,w,S,A,L){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,d,g,w,S,A,L)}updateHiddenByLandmark(n){this.updateHiddenByLandmarkRange(n.groundVertexArrayOffset,n.groundVertexCount,!!(n.flags&sm))}updateHiddenByLandmarkRange(n,o,d){if(!this.hasData())return;const g=o+n;if(o!==0){for(let w=n;w<g;++w)this.hiddenByLandmarkVertexArray.emplace(w,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,P2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class Yv{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new $o,this.footprintVertices=new pa,this.footprintSegments=[],this.layoutVertexArray=new na,this.centroidVertexArray=new wv,this.wallVertexArray=new n_,this.indexArray=new $o,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut},(o=>M2.includes(o))),this.segments=new bo,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.groundEffect=new Xv(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,d,g){}populate(n,o,d,g){this.features=[],this.hasPattern=nm("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ae(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:w,id:S,index:A,sourceLayerIndex:L}of n){const N=this.layers[0]._featureFilter.needGeometry,q=Pt(w,N);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),q,d))continue;const Z={id:S,sourceLayerIndex:L,index:A,geometry:N?q.geometry:mt(w,d,g),properties:w.properties,type:w.type,patterns:{}},Q=this.layoutVertexArray.length,ne=qv[Z.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:w.id,feature:xu("fill-extrusion",this.layers,Z,this.zoom,this.pixelRatio,o)});else if(this.wallMode)for(const oe of Z.geometry)for(const me of Kb(oe,ne))this.addFeature(w.id,Z,[me],A,d,{},o.availableImages,g,o.brightness);else this.addFeature(w.id,Z,Z.geometry,A,d,{},o.availableImages,g,o.brightness);o.featureIndex.insert(w,Z.geometry,A,L,this.index,Q)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,d,g,w,S){for(const{featureId:A,feature:L}of this.features){const N=qv[L.type]==="Polygon",{geometry:q}=L;if(this.wallMode)for(const Z of q)for(const Q of Kb(Z,N))this.addFeature(A,L,[Q],L.index,o,d,g,w,S);else this.addFeature(A,L,q,L.index,o,d,g,w,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,d,g,w,S,A){this.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,this.worldview),this.groundEffect.update(n,o,w,d,g,S,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Nv),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,A2.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,Wb.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,C2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,d,g,w,S,A,L,N){const q=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,Z=[new yi(0,0),new yi(Ji,Ji)],Q=L.projection,ne=Q.name==="globe",oe=this.wallMode||qv[o.type]==="Polygon",me=new Wv;me.centroidDataIndex=this.centroidData.length;const Se=new R2;Se.buildingId=n,o.properties&&o.properties.hasOwnProperty("building_id")&&(Se.buildingId=o.properties.building_id);const Te=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},w)<=0,Le=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},w);let Re;if(Se.height=Le,Se.vertexArrayOffset=this.layoutVertexArray.length,Se.groundVertexArrayOffset=this.groundEffect.vertexArray.length,ne&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new mc),this.wallMode){if(ne)return void mn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;Re=(function(kt){const fi=kt[0].x===kt[kt.length-1].x&&kt[0].y===kt[kt.length-1].y;(function(In){let Dn=0;const jr=In.length;for(let Ki=0;Ki<jr;Ki++)Dn+=(In[(Ki+1)%jr].x-In[Ki].x)*(In[(Ki+1)%jr].y+In[Ki].y);return Dn>=0})(kt)||(kt=kt.reverse());const Si={geometry:[],joinNormals:[],indices:[]},Bi=[],ji=[],zi=[];let Oi=kt.length;for(;Oi>=2&&kt[Oi-1].equals(kt[Oi-2]);)Oi--;if(Oi<(fi?3:2))return Si;let di,ui,Fi,tn,Xi,Vn=0;for(;Vn<Oi-1&&kt[Vn].equals(kt[Vn+1]);)Vn++;fi&&(di=kt[Oi-2],Xi=kt[Vn].sub(di)._unit()._perp());for(let In=Vn;In<Oi;In++){if(Fi=In===Oi-1?fi?kt[Vn+1]:void 0:kt[In+1],Fi&&kt[In].equals(Fi))continue;Xi&&(tn=Xi),di&&(ui=di),di=kt[In],Xi=Fi?Fi.sub(di)._unit()._perp():tn,tn=tn||Xi;let Dn=tn.add(Xi);Dn.x===0&&Dn.y===0||Dn._unit();const jr=Dn.x*Xi.x+Dn.y*Xi.y,Ki=jr!==0?1/jr:1/0,Rn=tn.x*Xi.y-tn.y*Xi.x>0;let wr="miter";const os=2;wr==="miter"&&Ki>os&&(wr="bevel"),wr==="bevel"&&(Ki>100&&(wr="flipbevel"),Ki<os&&(wr="miter"));const ds=(Mr,Ys,et,st)=>{const pi=new yi(Mr.x,Mr.y),Ni=new yi(Mr.x,Mr.y);pi.x+=Ys.x*st,pi.y+=Ys.y*st,Ni.x-=Ys.x*Math.max(et,1),Ni.y-=Ys.y*Math.max(et,1),zi.push(Ys),Bi.push(pi),ji.push(Ni)};if(wr==="miter")Dn._mult(Ki),ds(di,Dn,0,0);else if(wr==="flipbevel")Dn=Xi.mult(-1),ds(di,Dn,0,0),ds(di,Dn.mult(-1),0,0);else{const Mr=-Math.sqrt(Ki*Ki-1),Ys=Rn?Mr:0,et=Rn?0:Mr;ui&&ds(di,tn,Ys,et),Fi&&ds(di,Xi,Ys,et)}}Si.geometry=[...Bi,...ji.reverse(),Bi[0]],Si.joinNormals=[...zi,...zi.reverse(),zi[zi.length-1]];const _n=Si.geometry.length-1;for(let In=0;In<_n/2;In++)if(In+1<_n/2){let Dn=In,jr=In+1,Ki=_n-1-In,Rn=_n-2-In;Dn=Dn===0?_n-1:Dn-1,jr=jr===0?_n-1:jr-1,Ki=Ki===0?_n-1:Ki-1,Rn=Rn===0?_n-1:Rn-1,Si.indices.push(Ki),Si.indices.push(jr),Si.indices.push(Dn),Si.indices.push(Ki),Si.indices.push(Rn),Si.indices.push(jr)}return Si})(d[0]),d=[Re.geometry]}const Ue=(kt,fi)=>kt<(fi.length-1)/2||kt===fi.length-1,rt=this.wallMode?[d]:Jh(d,500);for(let kt=rt.length-1;kt>=0;kt--){const fi=rt[kt];(fi.length===0||(Qe=fi[0]).every((Ti=>Ti.x<=0))||Qe.every((Ti=>Ti.x>=Ji))||Qe.every((Ti=>Ti.y<=0))||Qe.every((Ti=>Ti.y>=Ji)))&&rt.splice(kt,1)}var Qe;let ht;if(ne)ht=V2(rt,Z,w);else{ht=[];for(const kt of rt)ht.push({polygon:kt,bounds:Z})}const yt=oe?this.edgeRadius:0,Et=yt>0&&this.zoom<17,ai=(kt,fi)=>{if(kt.length===0)return!1;const Ti=kt[kt.length-1];return fi.x===Ti.x&&fi.y===Ti.y};for(const{polygon:kt,bounds:fi}of ht){let Ti=0,Si=0;for(const Oi of kt)oe&&!Oi[0].equals(Oi[Oi.length-1])&&Oi.push(Oi[0]),Si+=oe?Oi.length-1:Oi.length;const Bi=this.segments.prepareSegment((oe?5:4)*Si,this.layoutVertexArray,this.indexArray);Se.footprintSegIdx<0&&(Se.footprintSegIdx=this.footprintSegments.length),Se.polygonSegIdx<0&&(Se.polygonSegIdx=this.polygonSegments.length);const ji={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},zi=new Qb;if(zi.vertexOffset=this.footprintVertices.length,zi.indexOffset=3*this.footprintIndices.length,zi.ringIndices=[],oe){const Oi=[],di=[];Ti=Bi.vertexLength;for(let Fi=0;Fi<kt.length;Fi++){const tn=kt[Fi];tn.length&&Fi!==0&&di.push(Oi.length/2);const Xi=[];let Vn,_n;Vn=tn[1].sub(tn[0])._perp()._unit(),zi.ringIndices.push(tn.length-1);for(let In=1;In<tn.length;In++){const Dn=tn[In],jr=tn[In===tn.length-1?1:In+1],Ki=Dn.clone();if(yt){_n=jr.sub(Dn)._perp()._unit();const Rn=Vn.add(_n)._unit(),wr=yt*Math.min(4,1/(Vn.x*Rn.x+Vn.y*Rn.y));Ki.x+=wr*Rn.x,Ki.y+=wr*Rn.y,Ki.x=Math.round(Ki.x),Ki.y=Math.round(Ki.y),Vn=_n}if(!Te||yt!==0&&!Et||ai(Xi,Ki)||Xi.push(Ki),R0(this.layoutVertexArray,Ki.x,Ki.y,0,0,1,1,0),this.wallMode){const Rn=Ue(In,tn);z0(this.wallVertexArray,Re.joinNormals[In],!Rn)}Bi.vertexLength++,this.footprintVertices.emplaceBack(Dn.x,Dn.y),Oi.push(Dn.x,Dn.y),ne&&om(this.layoutVertexExtArray,Q.projectTilePoint(Ki.x,Ki.y,w),Q.upVector(w,Ki.x,Ki.y))}Te&&(yt===0||Et)&&(Xi.length!==0&&ai(Xi,Xi[0])&&Xi.pop(),this.groundEffect.addData(Xi,fi,q))}const ui=this.wallMode?Re.indices:p_(Oi,di);for(let Fi=0;Fi<ui.length;Fi+=3)this.footprintIndices.emplaceBack(zi.vertexOffset+ui[Fi+0],zi.vertexOffset+ui[Fi+1],zi.vertexOffset+ui[Fi+2]),this.indexArray.emplaceBack(Ti+ui[Fi],Ti+ui[Fi+2],Ti+ui[Fi+1]),Bi.primitiveLength++;zi.indexCount+=ui.length,zi.vertexCount+=this.footprintVertices.length-zi.vertexOffset}for(let Oi=0;Oi<kt.length;Oi++){const di=kt[Oi];me.startRing(Se,di[0]);let ui=di.length>4&&F2(di[di.length-2],di[0],di[1]),Fi=yt?yI(di[di.length-2],di[0],di[1],yt):0;const tn=[];let Xi,Vn,_n;Vn=di[1].sub(di[0])._perp()._unit();let In=!0;for(let Dn=1,jr=0;Dn<di.length;Dn++){let Ki=di[Dn-1],Rn=di[Dn];const wr=di[Dn===di.length-1?1:Dn+1];if(me.appendEdge(Se,Rn,Ki),Kv(Rn,Ki,fi)){yt&&(Vn=wr.sub(Rn)._perp()._unit(),In=!In);continue}const os=Rn.sub(Ki)._perp(),ds=os.x/(Math.abs(os.x)+Math.abs(os.y)),Mr=os.y>0?1:0,Ys=Ki.dist(Rn);if(jr+Ys>32768&&(jr=0),yt){_n=wr.sub(Rn)._perp()._unit();let Ni=O2(Ki,Rn,wr,Ay(Vn,_n),yt);isNaN(Ni)&&(Ni=0);const dn=Rn.sub(Ki)._unit();Ki=Ki.add(dn.mult(Fi))._round(),Rn=Rn.add(dn.mult(-Ni))._round(),Fi=Ni,Vn=_n,Te&&this.zoom>=17&&(ai(tn,Ki)||tn.push(Ki),ai(tn,Rn)||tn.push(Rn))}const et=Bi.vertexLength,st=di.length>4&&F2(Ki,Rn,wr);let pi=B2(jr,ui,In);if(R0(this.layoutVertexArray,Ki.x,Ki.y,ds,Mr,0,0,pi),R0(this.layoutVertexArray,Ki.x,Ki.y,ds,Mr,0,1,pi),this.wallMode){const Ni=Ue(Dn-1,di),dn=Re.joinNormals[Dn-1];z0(this.wallVertexArray,dn,Ni),z0(this.wallVertexArray,dn,Ni)}if(jr+=Ys,pi=B2(jr,st,!In),ui=st,R0(this.layoutVertexArray,Rn.x,Rn.y,ds,Mr,0,0,pi),R0(this.layoutVertexArray,Rn.x,Rn.y,ds,Mr,0,1,pi),this.wallMode){const Ni=Ue(Dn,di),dn=Re.joinNormals[Dn];z0(this.wallVertexArray,dn,Ni),z0(this.wallVertexArray,dn,Ni)}if(Bi.vertexLength+=4,this.indexArray.emplaceBack(et+0,et+1,et+2),this.indexArray.emplaceBack(et+1,et+3,et+2),Bi.primitiveLength+=2,yt){const Ni=Ti+(Dn===1?di.length-2:Dn-2),dn=Dn===1?Ti:Ni+1;if(this.indexArray.emplaceBack(et+1,Ni,et+3),this.indexArray.emplaceBack(Ni,dn,et+3),Bi.primitiveLength+=2,Xi===void 0&&(Xi=et),!Kv(wr,di[Dn],fi)){const fn=Dn===di.length-1?Xi:Bi.vertexLength;this.indexArray.emplaceBack(et+2,et+3,fn),this.indexArray.emplaceBack(et+3,fn+1,fn),this.indexArray.emplaceBack(et+3,dn,fn+1),Bi.primitiveLength+=3}In=!In}if(ne){const Ni=this.layoutVertexExtArray,dn=Q.projectTilePoint(Ki.x,Ki.y,w),fn=Q.projectTilePoint(Rn.x,Rn.y,w),Un=Q.upVector(w,Ki.x,Ki.y),Wn=Q.upVector(w,Rn.x,Rn.y);om(Ni,dn,Un),om(Ni,dn,Un),om(Ni,fn,Wn),om(Ni,fn,Wn)}}oe&&(Ti+=di.length-1),Te&&yt&&this.zoom>=17&&(tn.length!==0&&ai(tn,tn[0])&&tn.pop(),this.groundEffect.addData(tn,fi,q,yt>0))}this.footprintSegments.push(zi),ji.triangleCount=this.indexArray.length-ji.triangleArrayOffset,this.polygonSegments.push(ji),++Se.footprintSegLen,++Se.polygonSegLen}if(Se.vertexCount=this.layoutVertexArray.length-Se.vertexArrayOffset,Se.groundVertexCount=this.groundEffect.vertexArray.length-Se.groundVertexArrayOffset,Se.vertexCount!==0){if(Se.centroidXY=me.borders?L2:this.encodeCentroid(me,Se),this.centroidData.push(Se),me.borders){this.featuresOnBorder.push(me);const kt=this.featuresOnBorder.length-1;for(let fi=0;fi<me.borders.length;fi++)me.borders[fi][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[fi].push(kt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,g,S,A,w,N,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(o,g,S,A,w,N,this.worldview),this.maxHeight=Math.max(this.maxHeight,Le)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort(((o,d)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[d].borders[n][0]))}splitToSubtiles(){const n=[];for(let A=0;A<this.centroidData.length;A++){const L=this.centroidData[A],N=+(L.min.y+L.max.y>Ji),q=2*N+(+(L.min.x+L.max.x>Ji)^N);for(let Z=0;Z<L.polygonSegLen;Z++){const Q=L.polygonSegIdx+Z;n.push({centroidIdx:A,subtile:q,polygonSegmentIdx:Q,triangleSegmentIdx:this.polygonSegments[Q].triangleSegIdx})}}const o=new $o;n.sort(((A,L)=>A.triangleSegmentIdx===L.triangleSegmentIdx?A.subtile-L.subtile:A.triangleSegmentIdx-L.triangleSegmentIdx));let d=0,g=0,w=0;for(const A of n){if(A.triangleSegmentIdx!==d)break;w++}const S=n.length;for(;g!==n.length;){d=n[g].triangleSegmentIdx;let A=0,L=g,N=g;for(let q=L;q<w&&n[q].subtile===A;q++)N++;for(;L!==w;){const q=n[L];A=q.subtile;const Z=this.centroidData[q.centroidIdx].min.clone(),Q=this.centroidData[q.centroidIdx].max.clone(),ne={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let oe=L;oe<N;oe++){const me=n[oe],Se=this.polygonSegments[me.polygonSegmentIdx],Te=this.centroidData[me.centroidIdx].min,Le=this.centroidData[me.centroidIdx].max,Re=this.indexArray.uint16;for(let Ue=Se.triangleArrayOffset;Ue<Se.triangleArrayOffset+Se.triangleCount;Ue++)o.emplaceBack(Re[3*Ue],Re[3*Ue+1],Re[3*Ue+2]);ne.primitiveLength+=Se.triangleCount,Z.x=Math.min(Z.x,Te.x),Z.y=Math.min(Z.y,Te.y),Q.x=Math.max(Q.x,Le.x),Q.y=Math.max(Q.y,Le.y)}ne.primitiveLength>0&&this.triangleSubSegments.push({segment:ne,min:Z,max:Q}),L=N;for(let oe=L;oe<w&&n[oe].subtile===n[L].subtile;oe++)N++}g=w;for(let q=g;q<S&&n[q].triangleSegmentIdx===n[g].triangleSegmentIdx;q++)w++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,d){const g=new bo;if(this.wallMode){for(const me of this.triangleSubSegments)g.segments.push(me.segment);return g}let w=0,S=0;const A=1<<n.canonical.z;if(o){const me=o.getMinMaxForTile(n);me&&(w=me.min,S=me.max)}S+=this.maxHeight;const L=n.toUnwrapped();let N;const q=[L.canonical.x/A+L.wrap,L.canonical.y/A],Z=[(L.canonical.x+1)/A+L.wrap,(L.canonical.y+1)/A],Q=(me,Se,Te)=>[me[0]*(1-Te[0])+Se[0]*Te[0],me[1]*(1-Te[1])+Se[1]*Te[1]],ne=[],oe=[];for(const me of this.triangleSubSegments){ne[0]=me.min.x/Ji,ne[1]=me.min.y/Ji,oe[0]=me.max.x/Ji,oe[1]=me.max.y/Ji;const Se=Q(q,Z,ne),Te=Q(q,Z,oe);if(new Ln([Se[0],Se[1],w],[Te[0],Te[1],S]).intersectsPrecise(d)===0){N&&(g.segments.push(N),N=void 0);continue}const Le=me.segment;N&&N.vertexOffset!==Le.vertexOffset&&(g.segments.push(N),N=void 0),N?(N.vertexLength+=Le.vertexLength,N.primitiveLength+=Le.primitiveLength):N={vertexOffset:Le.vertexOffset,primitiveLength:Le.primitiveLength,vertexLength:Le.vertexLength,primitiveOffset:Le.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&g.segments.push(N),g}encodeCentroid(n,o){const d=n.centroid(),g=o.span(),w=Math.min(7,Math.round(g.x*this.tileToMeter/10)),S=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new yi(we(d.x,1,Ji-1)<<3|w,we(d.y,1,Ji-1)<<3|S)}encodeBorderCentroid(n){if(!n.borders)return new yi(0,0);const o=n.borders,d=Number.MAX_VALUE;if(o[0][0]!==d||o[1][0]!==d){const g=o[0][0]!==d?0:1;return new yi(6|(o[0][0]!==d?0:65528),(o[g][0]+o[g][1])/2<<3|6)}{const g=o[2][0]!==d?2:3;return new yi((o[g][0]+o[g][1])/2<<3|6,6|(o[2][0]!==d?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=2147483647,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,d=n.vertexCount+n.vertexArrayOffset,g=n.flags&sm?L2:n.centroidXY,w=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==g.y||w!==g.x){for(let S=o;S<d;++S)this.centroidVertexArray.emplace(S,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,d){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const g=o.getReplacementRegionsForTile(n.toUnwrapped());if(D0(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const S of this.centroidData)S.flags&=2147483647;const w=[];for(const S of this.activeReplacements){if(S.order<d)continue;const A=Math.max(1,Math.pow(2,S.footprintTileId.canonical.z-n.canonical.z));if(S.footprint.buildingIds)for(const L of this.centroidData)L.flags&sm||S.min.x>L.max.x||L.min.x>S.max.x||S.min.y>L.max.y||L.min.y>S.max.y||S.footprint.buildingIds.has(L.buildingId)&&(L.flags|=sm);else for(const L of this.centroidData)if(!(L.flags&sm||S.min.x>L.max.x||L.min.x>S.max.x||S.min.y>L.max.y||L.min.y>S.max.y))for(let N=0;N<L.footprintSegLen;N++){const q=this.footprintSegments[L.footprintSegIdx+N];if(w.length=0,vI(this.footprintVertices,q.vertexOffset,q.vertexCount,S.footprintTileId.canonical,n.canonical,w),Iy(S.footprint,w,this.footprintIndices.uint16,q.indexOffset,q.indexCount,-q.vertexOffset,-A)){L.flags|=sm;break}}}for(const S of this.centroidData)this.writeCentroidToBuffer(S);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,d){let g=!1;for(let w=0;w<d.footprintSegLen;w++){const S=this.footprintSegments[d.footprintSegIdx+w];let A=0;for(const L of S.ringIndices){for(let N=A,q=L+A-1;N<L+A;q=N++){const Z=this.footprintVertices.int16[2*(N+S.vertexOffset)+0],Q=this.footprintVertices.int16[2*(N+S.vertexOffset)+1],ne=this.footprintVertices.int16[2*(q+S.vertexOffset)+1];Q>o!=ne>o&&n<(this.footprintVertices.int16[2*(q+S.vertexOffset)+0]-Z)*(o-Q)/(ne-Q)+Z&&(g=!g)}A=L}}return g}getHeightAtTileCoord(n,o){let d=Number.NEGATIVE_INFINITY,g=!0;const w=4*(n+Ji)*Ji+(o+Ji);if(this.partLookup.hasOwnProperty(w)){const S=this.partLookup[w];return S?{height:S.height,hidden:!!(S.flags&sm)}:void 0}for(const S of this.centroidData)n>S.max.x||S.min.x>n||o>S.max.y||S.min.y>o||S.height<=d||this.footprintContainsPoint(n,o,S)&&(d=S.height,this.partLookup[w]=S,g=!!(S.flags&sm));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:g};this.partLookup[w]=void 0}}function Ay(a,n){const o=a.add(n)._unit();return a.x*o.x+a.y*o.y}function yI(a,n,o,d){const g=n.sub(a)._perp()._unit(),w=o.sub(n)._perp()._unit();return O2(a,n,o,Ay(g,w),d)}function O2(a,n,o,d,g){const w=Math.sqrt(1-d*d);return Math.min(a.dist(n)/3,n.dist(o)/3,g*w/d)}function Kv(a,n,o){return a.x<o[0].x&&n.x<o[0].x||a.x>o[1].x&&n.x>o[1].x||a.y<o[0].y&&n.y<o[0].y||a.y>o[1].y&&n.y>o[1].y}function e1(a,n){return a.x<n[0].x||a.x>n[1].x||a.y<n[0].y||a.y>n[1].y}function F2(a,n,o){if(a.x<0||a.x>=Ji||n.x<0||n.x>=Ji||o.x<0||o.x>=Ji)return!1;const d=o.sub(n),g=d.perp(),w=a.sub(n);return(d.x*w.x+d.y*w.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(w.x*w.x+w.y*w.y))>-.866&&g.x*w.x+g.y*w.y<0}function B2(a,n,o){const d=n?2|a:-3&a;return o?1|d:-2&d}function N2(){const a=Math.PI/32,n=Math.tan(a),o=v;return o*Math.sqrt(1+2*n*n)-o}function V2(a,n,o){const d=1<<o.z,g=ee(o.x/d),w=ee((o.x+1)/d),S=ce(o.y/d),A=ce((o.y+1)/d);return(function(L,N,q,Z,Q=0,ne){const oe=[];if(!L.length||!q||!Z)return oe;const me=(Qe,ht)=>{for(const yt of Qe)oe.push({polygon:yt,bounds:ht})},Se=Math.ceil(Math.log2(q)),Te=Math.ceil(Math.log2(Z)),Le=Se-Te,Re=[];for(let Qe=0;Qe<Math.abs(Le);Qe++)Re.push(Le>0?0:1);for(let Qe=0;Qe<Math.min(Se,Te);Qe++)Re.push(0),Re.push(1);let Ue=L;if(Ue=k0(Ue,N[0].y-Q,N[1].y+Q,1),Ue=k0(Ue,N[0].x-Q,N[1].x+Q,0),!Ue.length)return oe;const rt=[];for(Re.length?rt.push({polygons:Ue,bounds:N,depth:0}):me(Ue,N);rt.length;){const Qe=rt.pop(),ht=Qe.depth,yt=Re[ht],Et=Qe.bounds[0],ai=Qe.bounds[1],kt=yt===0?Et.x:Et.y,fi=yt===0?ai.x:ai.y,Ti=ne?ne(yt,kt,fi):.5*(kt+fi),Si=k0(Qe.polygons,kt-Q,Ti+Q,yt),Bi=k0(Qe.polygons,Ti-Q,fi+Q,yt);if(Si.length){const ji=[Et,new yi(yt===0?Ti:ai.x,yt===1?Ti:ai.y)];Re.length>ht+1?rt.push({polygons:Si,bounds:ji,depth:ht+1}):me(Si,ji)}if(Bi.length){const ji=[new yi(yt===0?Ti:Et.x,yt===1?Ti:Et.y),ai];Re.length>ht+1?rt.push({polygons:Bi,bounds:ji,depth:ht+1}):me(Bi,ji)}}return oe})(a,n,Math.ceil((w-g)/11.25),Math.ceil((S-A)/11.25),1,((L,N,q)=>{if(L===0)return .5*(N+q);{const Z=ce((o.y+N/Ji)/d);return(G(.5*(ce((o.y+q/Ji)/d)+Z))*d-o.y)*Ji}}))}function vI(a,n,o,d,g,w){const S=Math.pow(2,d.z-g.z);for(let A=0;A<o;A++){let L=a.int16[2*(A+n)+0],N=a.int16[2*(A+n)+1];L=(L+g.x*Ji)*S-d.x*Ji,N=(N+g.y*Ji)*S-d.y*Ji,w.push(new yi(L,N))}}let t1,j2;Cn(Yv,"FillExtrusionBucket",{omit:["layers","features"]}),Cn(R2,"PartData"),Cn(Qb,"FootprintSegment"),Cn(Wv,"BorderCentroidData"),Cn(Xv,"GroundEffect");class Df extends yi{constructor(n,o,d){super(n,o),this.z=d}}class U2 extends Df{constructor(n,o,d,g){super(n,o,d),this.w=g}}function $2(a,n,o,d){const g=o==="x"?"y":"x",w=(d-a[o])/(n[o]-a[o]);a[g]=Math.round(a[g]+(n[g]-a[g])*w),a[o]=d,a.hasOwnProperty("z")&&(a.z=Gn(a.z,n.z,w)),a.hasOwnProperty("w")&&(a.w=Gn(a.w,n.w,w))}function G2(a,n,o,d){const g=o,w=d;for(const S of["x","y"]){let A=a,L=n;A[S]>=L[S]&&(A=n,L=a),A[S]<g&&L[S]>g&&$2(A,L,S,g),A[S]<w&&L[S]>w&&$2(L,A,S,w)}}function Py(a,n,o,d,g,w){const S=[];for(let A=0;A<a.length;A++){const L=a[A];let N;const q=S.length;let Z=0;for(let Q=0;Q<L.length-1;Q++){let ne=L[Q],oe=L[Q+1],me=0;const Se=Z;let Te,Le;w&&(me=Math.hypot(oe.x-ne.x,oe.y-ne.y),Z+=me,Te=ne,Le=oe),ne.x<n&&oe.x<n||(ne.x<n?ne=new yi(n,ne.y+(n-ne.x)/(oe.x-ne.x)*(oe.y-ne.y))._round():oe.x<n&&(oe=new yi(n,ne.y+(n-ne.x)/(oe.x-ne.x)*(oe.y-ne.y))._round()),ne.y<o&&oe.y<o||(ne.y<o?ne=new yi(ne.x+(o-ne.y)/(oe.y-ne.y)*(oe.x-ne.x),o)._round():oe.y<o&&(oe=new yi(ne.x+(o-ne.y)/(oe.y-ne.y)*(oe.x-ne.x),o)._round()),ne.x>=d&&oe.x>=d||(ne.x>=d?ne=new yi(d,ne.y+(d-ne.x)/(oe.x-ne.x)*(oe.y-ne.y))._round():oe.x>=d&&(oe=new yi(d,ne.y+(d-ne.x)/(oe.x-ne.x)*(oe.y-ne.y))._round()),ne.y>=g&&oe.y>=g||(ne.y>=g?ne=new yi(ne.x+(g-ne.y)/(oe.y-ne.y)*(oe.x-ne.x),g)._round():oe.y>=g&&(oe=new yi(ne.x+(g-ne.y)/(oe.y-ne.y)*(oe.x-ne.x),g)._round()),N&&ne.equals(N[N.length-1])||(N=[ne],S.push(N),w&&w.push({progress:{min:Se+H2(Te,Le,ne)*me,max:1},parentIndex:A,prevPoint:Te,nextPoint:Le})),N.push(oe),w&&(w[w.length-1].progress.max=Se+H2(Te,Le,oe)*me,w[w.length-1].nextPoint=Le)))))}if(w&&Z>0)for(let Q=q;Q<S.length;Q++)w[Q].progress.min/=Z,w[Q].progress.max/=Z}return S}function q2(a,n,o,d,g){if(a.length<2)return void d.push(a);const w=[];for(;n.valid();){const[N,q]=n.get();for(let Z=0;Z<a.length-1;Z++){const Q=a[Z],ne=a[Z+1],oe=Pr(Q,ne,N,q);if(oe){const[me]=oe,Se=new yi(Gn(Q.x,ne.x,me),Gn(Q.y,ne.y,me));w.push({t:Z+me,distance:0,point:Se})}}n.next()}if(w.length===0)return void d.push(a);w.sort(((N,q)=>N.t-q.t));let S=0,A=0,L=[];for(d.push(L);S!==a.length;){if(A===w.length){for(;S!==a.length;)L.length!==0&&L[L.length-1].equals(a[S])||L.push(a[S]),S++;break}w[A].t<=S?(L.length!==0&&L[L.length-1].equals(w[A].point)||L.push(w[A].point),Math.trunc(w[A].t),A++):(L.length!==0&&L[L.length-1].equals(a[S])||L.push(a[S]),S++)}}function H2(a,n,o){return a.x!==n.x?(o.x-a.x)/(n.x-a.x):a.y!==n.y?(o.y-a.y)/(n.y-a.y):0}function F0(a,n){return a.x*n.x+a.y*n.y}function i1(a,n){if(a.length===1){let o=0;const d=n[o++];let g;for(;!g||d.equals(g);)if(g=n[o++],!g)return 1/0;for(;o<n.length;o++){const w=n[o],S=a[0],A=g.sub(d),L=w.sub(d),N=S.sub(d),q=F0(A,A),Z=F0(A,L),Q=F0(L,L),ne=F0(N,A),oe=F0(N,L),me=q*Q-Z*Z,Se=(Q*ne-Z*oe)/me,Te=(q*oe-Z*ne)/me,Le=d.z*(1-Se-Te)+g.z*Se+w.z*Te;if(isFinite(Le))return Le}return 1/0}{let o=1/0;for(const d of n)o=Math.min(o,d.z);return o}}function n1(a,n,o){let d=1/0;vs(o,n)&&(d=i1(o,n[0]));for(let g=0;g<n.length;g++){const w=n[g],S=a[g];for(let A=0;A<w.length-1;A++){const L=w[A],N=[L,w[A+1],S[A+1],S[A],L];ls(o,N)&&(d=Math.min(d,i1(o,N)))}}return d!==1/0&&d}function W2(a,n,o,d,g,w,S,A,L,N,q){return a.projection.name==="globe"?(function(Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt){const Qe=[],ht=[],yt=Z.projection.upVectorScale(rt,Z.center.lat,Z.worldSize).metersToTile,Et=[0,0,0,1],ai=[0,0,0,1],kt=(Ti,Si,Bi,ji)=>{Ti[0]=Si,Ti[1]=Bi,Ti[2]=ji,Ti[3]=1},fi=N2();ne>0&&(ne+=fi),oe+=fi;for(const Ti of Q){const Si=[],Bi=[];for(const ji of Ti){const zi=ji.x+me.x,Oi=ji.y+me.y,di=Z.projection.projectTilePoint(zi,Oi,rt),ui=Z.projection.upVector(rt,ji.x,ji.y);let Fi=ne,tn=oe;if(Te){const Xi=r1(zi,Oi,ne,oe,Te,Le,Re,Ue);Fi+=Xi.base,tn+=Xi.top}ne!==0?kt(Et,di.x+ui[0]*yt*Fi,di.y+ui[1]*yt*Fi,di.z+ui[2]*yt*Fi):kt(Et,di.x,di.y,di.z),kt(ai,di.x+ui[0]*yt*tn,di.y+ui[1]*yt*tn,di.z+ui[2]*yt*tn),St(Et,Et,Se),St(ai,ai,Se),Si.push(new Df(Et[0],Et[1],Et[2])),Bi.push(new Df(ai[0],ai[1],ai[2]))}Qe.push(Si),ht.push(Bi)}return[Qe,ht]})(a,n,o,d,g,w,S,A,L,N,q):S?(function(Z,Q,ne,oe,me,Se,Te,Le,Re){const Ue=[],rt=[],Qe=[0,0,0,1];for(const ht of Z){const yt=[],Et=[];for(const ai of ht){const kt=ai.x+oe.x,fi=ai.y+oe.y,Ti=r1(kt,fi,Q,ne,Se,Te,Le,Re);Qe[0]=kt,Qe[1]=fi,Qe[2]=Ti.base,Qe[3]=1,Bt(Qe,Qe,me),Qe[3]=Math.max(Qe[3],1e-5);const Si=new Df(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);Qe[0]=kt,Qe[1]=fi,Qe[2]=Ti.top,Qe[3]=1,Bt(Qe,Qe,me),Qe[3]=Math.max(Qe[3],1e-5);const Bi=new Df(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);yt.push(Si),Et.push(Bi)}Ue.push(yt),rt.push(Et)}return[Ue,rt]})(n,o,d,g,w,S,A,L,N):(function(Z,Q,ne,oe,me){const Se=[],Te=[],Le=me[8]*Q,Re=me[9]*Q,Ue=me[10]*Q,rt=me[11]*Q,Qe=me[8]*ne,ht=me[9]*ne,yt=me[10]*ne,Et=me[11]*ne;for(const ai of Z){const kt=[],fi=[];for(const Ti of ai){const Si=Ti.x+oe.x,Bi=Ti.y+oe.y,ji=me[0]*Si+me[4]*Bi+me[12],zi=me[1]*Si+me[5]*Bi+me[13],Oi=me[2]*Si+me[6]*Bi+me[14],di=me[3]*Si+me[7]*Bi+me[15],ui=ji+Le,Fi=zi+Re,tn=Oi+Ue,Xi=Math.max(di+rt,1e-5),Vn=ji+Qe,_n=zi+ht,In=Oi+yt,Dn=Math.max(di+Et,1e-5);kt.push(new Df(ui/Xi,Fi/Xi,tn/Xi)),fi.push(new Df(Vn/Dn,_n/Dn,In/Dn))}Se.push(kt),Te.push(fi)}return[Se,Te]})(n,o,d,g,w)}function r1(a,n,o,d,g,w,S,A){const L=S*g.getElevationAt(a,n,!0,!0),N=w[0]!==0,q=N?w[1]===0?S*(w[0]/Hv-Jb):S*(function(Z,Q,ne){const oe=Math.floor(Q[0]/8),me=Math.floor(Q[1]/8),Se=10*(Q[0]-8*oe),Te=10*(Q[1]-8*me),Le=Z.getElevationAt(oe,me,!0,!0),Re=Z.getMeterToDEM(ne),Ue=Math.floor(.5*(Se*Re-1)),rt=Math.floor(.5*(Te*Re-1)),Qe=Z.tileCoordToPixel(oe,me),ht=2*Ue+1,yt=2*rt+1,Et=(function(Bi,ji,zi,Oi,di){return[Bi.getElevationAtPixel(ji,zi,!0),Bi.getElevationAtPixel(ji+di,zi,!0),Bi.getElevationAtPixel(ji,zi+di,!0),Bi.getElevationAtPixel(ji+Oi,zi+di,!0)]})(Z,Qe.x-Ue,Qe.y-rt,ht,yt),ai=Math.abs(Et[0]-Et[1]),kt=Math.abs(Et[2]-Et[3]),fi=Math.abs(Et[0]-Et[2])+Math.abs(Et[1]-Et[3]),Ti=Math.min(.25,.5*Re*(ai+kt)/ht),Si=Math.min(.25,.5*Re*fi/yt);return Le+Math.max(Ti*Se,Si*Te)})(g,w,A):L;return{base:L+(o===0?-1:o),top:N?Math.max(q+d,L+o+2):L+d}}class Z2{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xI{constructor(){this.tasks={},this.taskQueue=[],_t(["process"],this),this.invoker=new Z2(this.process),this.nextId=0}add(n,o){const d=this.nextId++,g=(function({type:w,isSymbolTile:S,zoom:A}){return A=A||0,w==="message"?0:w!=="maybePrepare"||S?w!=="parseTile"||S?w==="parseTile"&&S?300-A:w==="maybePrepare"&&S?400-A:500:200-A:100-A})(o);return g===0?(n(),null):(this.tasks[d]={fn:n,metadata:o,priority:g,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}})}process(){{if(this.taskQueue=this.taskQueue.filter((d=>!!this.tasks[d])),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}}pick(){let n=null,o=1/0;for(let g=0;g<this.taskQueue.length;g++){const w=this.tasks[this.taskQueue[g]];w.priority<o&&(o=w.priority,n=g)}if(n===null)return null;const d=this.taskQueue[n];return this.taskQueue.splice(n,1),d}remove(){this.invoker.remove()}}class s1{constructor(n,o,d){this.target=n,this.parent=o,this.mapId=d,this.callbacks={},this.cancelCallbacks={},_t(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new xI}send(n,o,d,g,w=!1,S){const A=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=S,this.callbacks[A]=d);const L=new Set;return this.target.postMessage({id:A,type:n,hasCallback:!!d,targetMapId:g,mustQueue:w,sourceMapId:this.mapId,data:So(o,L)},L),{cancel:()=>{d&&delete this.callbacks[A],this.target.postMessage({id:A,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(n){const o=n.data;if(!o)return;const d=o.id;if(d&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const g=this.cancelCallbacks[d];delete this.cancelCallbacks[d],g&&g.cancel()}else if(o.mustQueue||Kr(self)){const g=this.callbacks[d],w=this.scheduler.add((()=>this.processTask(d,o)),g&&g.metadata||{type:"message"});w&&(this.cancelCallbacks[d]=w)}else this.processTask(d,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const d=this.callbacks[n];delete this.callbacks[n],d&&(o.error?d(Yo(o.error)):d(null,Yo(o.data)))}else{const d=new Set,g=o.hasCallback?(S,A)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:S?So(S):null,data:So(A,d)},d)}:()=>{},w=Yo(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,w,g);else if(this.parent.getWorkerSource){const S=o.type.split("."),{source:A,scope:L}=w;this.parent.getWorkerSource(o.sourceMapId,S[0],A,L)[S[1]](w,g)}else g(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var B0={workerUrl:"",workerClass:null,workerParams:void 0};const o1="mapboxgl_preloaded_worker_pool";class wh{constructor(n){this.active={},this.name=n}acquire(n,o=wh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;){const g=(d=`${this.name||""}WorkerPool: ${n}-${this.workers.length}`,B0.workerClass!=null?new B0.workerClass:new self.Worker(B0.workerUrl,Object.assign({name:d},B0.workerParams)));this.workers.push(g)}var d;return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[o1]}numActive(){return Object.keys(this.active).length}}wh.workerCount=2;class y_{constructor(n,o,d="Worker",g=wh.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ct();const w=this.workerPool.acquire(this.id,g);for(let S=0;S<w.length;S++){const A=new y_.Actor(w[S],o,this.id);A.name=`${d} ${S}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(n,o,d){ot(this.actors,((g,w)=>{g.send(n,o,w)}),d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((n=>{n.remove()})),this.actors=[],this.workerPool.release(this.id)}}let My,Jv;function N0(){return My||(My=new wh),My}y_.Actor=s1;const a1=4096;class bI{constructor(n){this.module=n,this.memoryStack=this.module.malloc(a1),this.memoryStackNextFree=this.memoryStack}createIntArray(n){const o=this.memoryStackNextFree;return this.memoryStackNextFree+=n.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>a1?-1:(new Int32Array(this.module.heap32.buffer,o,n.length).set(n),o)}createFloatArray(n){const o=this.memoryStackNextFree;return this.memoryStackNextFree+=n.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>a1?-1:(new Float32Array(this.module.heapF32.buffer,o,n.length).set(n),o)}readStringBuffer(n){let o="";for(;this.module.heapU8[n]!==0;)o+=String.fromCharCode(this.module.heapU8[n]),++n;return o}setStyle(n){const o=n.normalScale;this.module.setStyle(o[0],o[1],o[2],n.tileToMeters)}setAOOptions(n,o){this.module.setAOOptions(n?1:0,o)}setMetricOptions(n,o){this.module.setMetricOptions(n?1:0,o)}setStructuralOptions(n){this.module.setStructuralOptions(n?1:0)}setFacadeOptions(n,o){this.module.setFacadeOptions(n,o?1:0)}setFauxFacadeOptions(n,o,d){this.module.setFauxFacadeOptions(n?1:0,o?1:0,d)}setFacadeClassifierOptions(n){this.module.setFacadeClassifierOptions(n)}generateMesh(n,o){this.memoryStackNextFree=this.memoryStack;for(const A of n){const L=this.createIntArray(A.ringIndices),N=this.createFloatArray(A.coordinates);if(L===-1||N===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(A.id,A.sourceId,A.minHeight,A.height,A.roofType,N,L,A.ringIndices.length-1)}for(const A of o){let L;L=A.entrances?JSON.parse(A.entrances):[];const N=this.createFloatArray(L),q=this.createFloatArray(A.coordinates);if(N===-1||q===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(A.sourceId,A.crossPerc,A.distanceToRoad,N,L.length,q,A.coordinates.length)}if(!this.module.generateMesh()){const A=this.module.getLastError();return this.readStringBuffer(A)}const d=this.module.getMeshCount(),g=new Array(d);for(let A=0;A<d;A++){const L=this.module.getPositionsPtr(A),N=this.module.getPositionsLength(A),q=new Float32Array(this.module.heapF32.buffer,L,N),Z=this.module.getNormalsPtr(A),Q=this.module.getNormalsLength(A),ne=new Float32Array(this.module.heapF32.buffer,Z,Q),oe=this.module.getAOPtr(A),me=this.module.getAOLength(A),Se=new Float32Array(this.module.heapF32.buffer,oe,me),Te=this.module.getUVPtr(A),Le=this.module.getUVLength(A),Re=new Float32Array(this.module.heapF32.buffer,Te,Le),Ue=this.module.getFauxFacadePtr(A),rt=this.module.getFauxFacadeLength(A),Qe=new Uint8Array(this.module.heapU8.buffer,Ue,rt),ht=this.module.getIndicesPtr(A),yt=this.module.getIndicesLength(A),Et=new Int16Array(this.module.heap16.buffer,ht,yt),ai=this.module.getBuildingPart(A);g[A]={positions:q,normals:ne,ao:Se,uv:Re,isFauxFacade:Qe,indices:Et,buildingPart:ai}}const w=this.module.getRingCount(),S=[];for(let A=0;A<w;A++){const L=this.module.getRingPtr(A),N=this.module.getRingLength(A),q=new Float32Array(this.module.heapF32.buffer,L,N);S.push(q)}return{meshes:g,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:S}}}let ky,Qv,Th,v_,Dy,am=null,lm=null,X2=null,ex=null;function Y2(){return Kr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Qv||qr.DRACO_URL}function x_(){if(Kr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(v_)return v_;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return v_=WebAssembly.validate(a)?qr.MESHOPT_SIMD_URL:qr.MESHOPT_URL,v_}function Rc(){return ex}const Ly={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K2={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ry={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tx(a,n,o){const d=o.json.bufferViews.length,g=o.buffers.length;n.bufferView=d,o.json.bufferViews[d]={buffer:g,byteLength:a.byteLength},o.buffers[g]=a}const l1="KHR_draco_mesh_compression";function J2(a,n){const o=a.extensions&&a.extensions[l1];if(!o)return;const d=new Th.Decoder,g=zy(n,o.bufferView),w=new Th.Mesh;if(!d.DecodeArrayToMesh(g,g.byteLength,w))throw new Error("Failed to decode Draco mesh");const S=n.json.accessors[a.indices],A=Ly[S.componentType],L=S.count*A.BYTES_PER_ELEMENT,N=Th._malloc(L);A===Uint16Array?d.GetTrianglesUInt16Array(w,L,N):d.GetTrianglesUInt32Array(w,L,N),tx(Th.memory.buffer.slice(N,N+L),S,n),Th._free(N);for(const q of Object.keys(o.attributes)){const Z=d.GetAttributeByUniqueId(w,o.attributes[q]),Q=n.json.accessors[a.attributes[q]],ne=K2[Q.componentType],oe=Q.count*Ry[Q.type]*Ly[Q.componentType].BYTES_PER_ELEMENT,me=Th._malloc(oe);d.GetAttributeDataArrayForAllPoints(w,Z,Th[ne],oe,me),tx(Th.memory.buffer.slice(me,me+oe),Q,n),Th._free(me)}d.destroy(),w.destroy(),delete a.extensions[l1]}const V0="EXT_meshopt_compression";function wI(a,n){if(!a.extensions||!a.extensions[V0])return;const o=a.extensions[V0],d=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),g=new Uint8Array(o.count*o.byteStride);Dy.decodeGltfBuffer(g,o.count,o.byteStride,d,o.mode,o.filter),a.buffer=n.buffers.length,a.byteOffset=0,n.buffers[a.buffer]=g.buffer,delete a.extensions[V0]}const c1=1179937895,ix=new TextDecoder("utf8");function nx(a,n){return new URL(a,n).href}function Q2(a,n,o,d){return fetch(nx(a.uri,d)).then((g=>g.arrayBuffer())).then((g=>{n.buffers[o]=g}))}function zy(a,n){const o=a.json.bufferViews[n];return new Uint8Array(a.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function u1(a,n,o,d){if(a.uri){const g=nx(a.uri,d);return fetch(g).then((w=>w.blob())).then((w=>createImageBitmap(w))).then((w=>{n.images[o]=w}))}if(a.bufferView!==void 0){const g=zy(n,a.bufferView),w=new Blob([g],{type:a.mimeType});return createImageBitmap(w).then((S=>{n.images[o]=S}))}}function h1(a,n=0,o){const d={json:null,images:[],buffers:[]};if(new Uint32Array(a,n,1)[0]===c1){const q=new Uint32Array(a,n);let Z=2;const Q=(q[Z++]>>2)-3,ne=q[Z++]>>2;if(Z++,d.json=JSON.parse(ix.decode(q.subarray(Z,Z+ne))),Z+=ne,Z<Q){const oe=q[Z++];Z++;const me=n+(Z<<2);d.buffers[0]=a.slice(me,me+oe)}}else d.json=JSON.parse(ix.decode(new Uint8Array(a,n)));const{buffers:g,images:w,meshes:S,extensionsUsed:A,bufferViews:L}=d.json;let N=Promise.resolve();if(g){const q=[];for(let Z=0;Z<g.length;Z++){const Q=g[Z];Q.uri?q.push(Q2(Q,d,Z,o)):d.buffers[Z]||(d.buffers[Z]=null)}N=Promise.all(q)}return N.then((()=>{const q=[],Z=A&&A.includes(l1),Q=A&&A.includes(V0);if(Z&&q.push((function(){if(!Th)return ky??(ky=(function(ne){let oe,me=null;function Se(){oe=new Uint8Array(me.buffer)}function Te(){throw new Error("Unexpected Draco error.")}const Le={a:{a:Te,d:function(Re,Ue,rt){return oe.copyWithin(Re,Ue,Ue+rt)},c:function(Re){const Ue=oe.length,rt=Math.max(Re>>>0,Math.ceil(1.2*Ue)),Qe=Math.ceil((rt-Ue)/65536);try{return me.grow(Qe),Se(),!0}catch{return!1}},b:Te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(ne,Le):ne.then((Re=>Re.arrayBuffer())).then((Re=>WebAssembly.instantiate(Re,Le)))).then((Re=>{const{Rb:Ue,Qb:rt,P:Qe,T:ht,X:yt,Ja:Et,La:ai,Qa:kt,Va:fi,Wa:Ti,eb:Si,jb:Bi,f:ji,e:zi,yb:Oi,zb:di,Ab:ui,Bb:Fi,Db:tn,Gb:Xi}=Re.instance.exports;me=zi;const Vn=(()=>{let _n=0,In=0,Dn=0,jr=0;return Ki=>{Dn&&(Ue(jr),Ue(_n),In+=Dn,Dn=_n=0),_n||(In+=128,_n=rt(In));const Rn=Ki.length+7&-8;let wr=_n;Rn>=In&&(Dn=Rn,wr=jr=rt(Rn));for(let os=0;os<Ki.length;os++)oe[wr+os]=Ki[os];return wr}})();return Se(),ji(),{memory:zi,_free:Ue,_malloc:rt,Mesh:class{constructor(){this.ptr=Qe()}destroy(){ht(this.ptr)}},Decoder:class{constructor(){this.ptr=Et()}destroy(){Bi(this.ptr)}DecodeArrayToMesh(_n,In,Dn){const jr=Vn(_n),Ki=ai(this.ptr,jr,In,Dn.ptr);return!!yt(Ki)}GetAttributeByUniqueId(_n,In){return{ptr:kt(this.ptr,_n.ptr,In)}}GetTrianglesUInt16Array(_n,In,Dn){fi(this.ptr,_n.ptr,In,Dn)}GetTrianglesUInt32Array(_n,In,Dn){Ti(this.ptr,_n.ptr,In,Dn)}GetAttributeDataArrayForAllPoints(_n,In,Dn,jr,Ki){Si(this.ptr,_n.ptr,In.ptr,Dn,jr,Ki)}},DT_INT8:Oi(),DT_UINT8:di(),DT_INT16:ui(),DT_UINT16:Fi(),DT_UINT32:tn(),DT_FLOAT32:Xi()}}))})(fetch(Y2())),ky.then((ne=>{Th=ne,ky=void 0})))})()),Q&&q.push((function(){if(Dy)return;const ne=(function(oe){let me;const Se=WebAssembly.instantiateStreaming(oe,{}).then((Re=>{me=Re.instance,me.exports.__wasm_call_ctors()})),Te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Se,supported:!0,decodeGltfBuffer(Re,Ue,rt,Qe,ht,yt){(function(Et,ai,kt,fi,Ti,Si,Bi){const ji=Et.exports.sbrk,zi=fi+3&-4,Oi=ji(zi*Ti),di=ji(Si.length),ui=new Uint8Array(Et.exports.memory.buffer);ui.set(Si,di);const Fi=ai(Oi,fi,Ti,di,Si.length);if(Fi===0&&Bi&&Bi(Oi,zi,Ti),kt.set(ui.subarray(Oi,Oi+fi*Ti)),ji(Oi-ji(0)),Fi!==0)throw new Error(`Malformed buffer data: ${Fi}`)})(me,me.exports[Le[ht]],Re,Ue,rt,Qe,me.exports[Te[yt]])}}})(fetch(x_()));return ne.ready.then((()=>{Dy=ne}))})()),w)for(let ne=0;ne<w.length;ne++)q.push(u1(w[ne],d,ne,o));return(q.length?Promise.all(q):Promise.resolve()).then((()=>{if(Z&&S)for(const{primitives:ne}of S)for(const oe of ne)J2(oe,d);if(Q&&S&&L)for(const ne of L)wI(ne,d);return d}))}))}function rx(a){return fetch(a).then((n=>n.arrayBuffer())).then((n=>h1(n,0,a)))}function Oy(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function b_(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class j0{constructor(n,o,d,g){this.context=n,this.format=d,this.useMipmap=g&&g.useMipmap,this.texture=n.gl.createTexture(),this.update(o,{premultiply:g&&g.premultiply})}update(n,o){const d=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,g=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:w}=this,{gl:S}=w,{x:A,y:L}=o&&o.position?o.position:{x:0,y:0},N=A+d,q=L+g;!this.size||this.size[0]===N&&this.size[1]===q||(S.bindTexture(S.TEXTURE_2D,null),S.deleteTexture(this.texture),this.texture=S.createTexture(),this.size=null),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA8&&(!o||o.premultiply!==!1));const Z=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&N>0&&q>0){const Q=this.useMipmap?Math.floor(Math.log2(Math.max(N,q)))+1:1;S.texStorage2D(S.TEXTURE_2D,Q,this.format,N,q),this.size=[N,q]}this.size&&(Z?S.texSubImage2D(S.TEXTURE_2D,0,A,L,Oy(this.format),b_(this.format),n):"data"in n&&n.data&&S.texSubImage2D(S.TEXTURE_2D,0,A,L,d,g,Oy(this.format),b_(this.format),n.data)),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(n,o,d=!1){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),n!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,n),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap&&!d?n===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,o),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,d,g,w){const{context:S}=this,{gl:A}=S;A.bindTexture(A.TEXTURE_2D,this.texture),o!==this.magFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?n===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),d!==this.wrapS&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,d),this.wrapS=d),g!==this.wrapT&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,g),this.wrapT=g),w!==this.compareMode&&(w?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,w)):A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.NONE),this.compareMode=w)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class w_{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrapS=o)}}const d1=hr([{name:"a_pos_3f",components:3,type:"Float32"}]),TI=hr([{name:"a_color_3f",components:3,type:"Float32"}]),m=hr([{name:"a_color_4f",components:4,type:"Float32"}]),c=hr([{name:"a_uv_2f",components:2,type:"Float32"}]),f=hr([{name:"a_normal_3f",components:3,type:"Float32"}]),T=hr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),C=hr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function R(a,n){const o=U(a.projection,a.zoom,a.width,a.height),d=(function(w,S,A,L,N){const q=new h(A.lng-180*X,A.lat),Z=new h(A.lng+180*X,A.lat),Q=w.project(q.lng,q.lat),ne=w.project(Z.lng,Z.lat),oe=-Math.atan2(ne.y-Q.y,ne.x-Q.x),me=Oe.fromLngLat(A);me.y=we(me.y,-1+X,1-X);const Se=me.toLngLat(),Te=w.project(Se.lng,Se.lat),Le=Oe.fromLngLat(Se);Le.x+=X;const Re=Le.toLngLat(),Ue=w.project(Re.lng,Re.lat),rt=ue(Ue.x-Te.x,Ue.y-Te.y,oe),Qe=Oe.fromLngLat(Se);Qe.y+=X;const ht=Qe.toLngLat(),yt=w.project(ht.lng,ht.lat),Et=ue(yt.x-Te.x,yt.y-Te.y,oe),ai=Math.abs(rt.x)/Math.abs(Et.y),kt=ie([]);We(kt,kt,-oe*(1-(N?0:L)));const fi=ie([]);return Ee(fi,fi,[1,1-(1-ai)*L,1]),fi[4]=-Et.x/Et.y*L,We(fi,fi,oe),ye(fi,kt,fi),fi})(a.projection,0,a.center,o,n),g=z(a);return Ee(d,d,[g,g,1]),d}function z(a){const n=a.projection,o=U(a.projection,a.zoom,a.width,a.height),d=re(n,a.center),g=re(n,h.convert(n.center));return Math.pow(2,d*o+(1-o)*g)}function U(a,n,o,d,g=1/0){const w=a.range;if(!w)return 0;const S=Math.min(g,Math.max(o,d)),A=Math.log2(S/1024);return Ie(w[0]+A,w[1]+A,n)}const X=1/4e4;function re(a,n){const o=we(n.lat,-he,he),d=new h(n.lng-180*X,o),g=new h(n.lng+180*X,o),w=a.project(d.lng,o),S=a.project(g.lng,o),A=Oe.fromLngLat(d),L=Oe.fromLngLat(g),N=S.x-w.x,q=S.y-w.y,Z=L.x-A.x,Q=L.y-A.y,ne=Math.sqrt((Z*Z+Q*Q)/(N*N+q*q));return Math.log2(ne)}function ue(a,n,o){const d=Math.cos(o),g=Math.sin(o);return{x:a*d-n*g,y:a*g+n*d}}function ve(a,n,o){ie(a),We(a,a,ns(n[2])),Pe(a,a,ns(n[0])),Ze(a,a,ns(n[1])),Ee(a,a,o),ye(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ce(a,n,o,d,g,w,S,A){const L=[o[0]-n[0],o[1]-n[1],0],N=[d[0]-n[0],d[1]-n[1],0];if($t(L)<1e-12||$t(N)<1e-12)return qt(a);const q=nr([],L,N);Gi(q,q),wi(N,d,n),L[2]=(w-g)*A,N[2]=(S-g)*A;const Z=L;return nr(Z,L,N),Gi(Z,Z),gi(a,q,Z)}function Me(a,n,o=!1){const d=tm(n.zoom),g=(function(w,S,A){const L=S.worldSize,N=[w[12],w[13],w[14]],q=ce(N[1]/L),Z=ee(N[0]/L),Q=ie([]),ne=J(1,q)*L,oe=J(1,0)*L*_e(q,S.zoom),me=1/Mb(L);let Se=oe*me;if(A){const Ue=U(S.projection,S.zoom,S.width,S.height,1024);Se=me*S.projection.pixelSpaceConversion(S.center.lat,L,Ue)}const Te=Zh(q,Z);vt(Te,Te,Fn([],Gi([],Te),ne*Se*N[2]));const Le=(function(Ue){const rt=[Ue[0],Ue[1],Ue[2]];let Qe=[0,1,0];const ht=nr([],Qe,rt);return nr(Qe,rt,ht),ti(Qe)===0&&(Qe=[0,1,0],nr(ht,rt,Qe)),Gi(ht,ht),Gi(Qe,Qe),Gi(rt,rt),[ht[0],ht[1],ht[2],0,Qe[0],Qe[1],Qe[2],0,rt[0],rt[1],rt[2],0,Ue[0],Ue[1],Ue[2],1]})(Te);Ee(Q,Q,[Se,Se,Se*ne]),de(Q,Q,[-N[0],-N[1],-N[2]]);const Re=ye([],S.globeMatrix,Le);return ye(Re,Re,Q),ye(Re,Re,w),Re})(a,n,o);if(d>0){const w=(function(S,A){const L=A.worldSize,N=J(1,0)*L*_e(A.center.lat,A.zoom)/Mb(L),q=J(1,A.center.lat)*L,Z=ie([]);Ze(Z,Z,ns(A.center.lng)),Pe(Z,Z,ns(A.center.lat)),de(Z,Z,[0,0,Ql]),Ee(Z,Z,[N,N,N*q]);const Q=A.point;return de(Z,Z,[-Q.x,-Q.y,0]),ye(Z,Z,S),ye(Z,A.globeMatrix,Z)})(a,n);return(function(S,A,L){const N=(oe,me,Se)=>{const Te=$t(oe),Le=$t(me),Re=Yh(oe,me,Se);return Fn(Re,Re,1/$t(Re)*Gn(Te,Le,Se))},q=N([S[0],S[1],S[2]],[A[0],A[1],A[2]],L),Z=N([S[4],S[5],S[6]],[A[4],A[5],A[6]],L),Q=N([S[8],S[9],S[10]],[A[8],A[9],A[10]],L),ne=Yh([S[12],S[13],S[14]],[A[12],A[13],A[14]],L);return[q[0],q[1],q[2],0,Z[0],Z[1],Z[2],0,Q[0],Q[1],Q[2],0,ne[0],ne[1],ne[2],1]})(g,w,d)}return g}function ze(a,n,o,d){const g=Ln.projectAabbCorners(d,o);let w=Number.MAX_VALUE;for(let A=0;A<g.length;++A){const L=g[A];L[0]=(.5*L[0]+.5)*n.width,L[1]=(.5-.5*L[1])*n.height,L[2]<w&&(w=L[2])}const S=(function(A){const L=[];let N=0;for(let ne=1;ne<A.length;ne++)(A[ne][0]<A[N][0]||A[ne][0]===A[N][0]&&A[ne][1]<A[N][1])&&(N=ne);let q,Z=N;const Q=new Uint8Array(A.length);do{if(Q[Z])break;L.push(new yi(A[Z][0],A[Z][1])),Q[Z]=1,q=(Z+1)%A.length;for(let ne=0;ne<A.length;ne++){if(A[ne][0]===A[q][0]&&A[ne][1]===A[q][1]||A[ne][0]===A[Z][0]&&A[ne][1]===A[Z][1])continue;const oe=[A[ne][0]-A[Z][0],A[ne][1]-A[Z][1]],me=[A[q][0]-A[Z][0],A[q][1]-A[Z][1]],Se=oe[0]*me[1]-oe[1]*me[0];(Se>0||Se===0&&oe[0]*me[0]+oe[1]*me[1]>=0&&oe[0]*oe[0]+oe[1]*oe[1]>me[0]*me[0]+me[1]*me[1])&&(q=ne)}Z=q}while(Z!==N);return L.length>0&&L.push(L[0]),L})(g);if(ls(a,S))return w}const Fe=64,$e={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function it(a,n,o,d,g,w,S,A,L,N=!1){const q=o.zoom,Z=o.project(d),Q=_e(d.lat,q),ne=1/Q;ie(a),de(a,a,[Z.x+S[0]*ne,Z.y+S[1]*ne,S[2]]);let oe=1,me=1;const Se=o.worldSize;if(N){if(o.projection.name==="mercator"){let Ue=0;o.elevation&&(Ue=o.elevation.getAtPointOrZero(new Oe(Z.x/Se,Z.y/Se),0));const rt=Bt([],[Z.x,Z.y,Ue,1],o.projMatrix)[3]/o.cameraToCenterDistance;oe=rt,me=rt*_e(o.center.lat,q)}else if(o.projection.name==="globe"){const Ue=Me(a,o),rt=[0,0,0,1];Bt(rt,rt,ye([],o.projMatrix,Ue));const Qe=rt[3]/o.cameraToCenterDistance,ht=tm(q),yt=o.projection.pixelsPerMeter(d.lat,Se)*_e(d.lat,q),Et=o.projection.pixelsPerMeter(o.center.lat,Se)*_e(o.center.lat,q);oe=Qe/Gn(yt,be(o.center.lat),ht),me=Qe*Q/yt,oe*=Et,me*=Et}}else oe=ne;Ee(a,a,[oe,oe,me]);const Te=[...a],Le=n.orientation,Re=[];if(ve(Re,[Le[0]+(g?g[0]:0),Le[1]+(g?g[1]:0),Le[2]+(g?g[2]:0)],w),ye(a,Te,Re),A&&o.elevation){let Ue=0;const rt=[];if(L&&o.elevation){Ue=(function(ht,yt,Et,ai,kt){const fi=yt.elevation;if(!fi)return 0;const Ti=Ln.projectAabbCorners(Et,ai),Si=J(1,kt.lat)*yt.worldSize,Bi=(function(In,Dn){const jr=[0,0,1],Ki=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Rn of Ki){const wr=In[Rn.corners[0]],os=In[Rn.corners[1]],ds=In[Rn.corners[2]],Mr=[os[0]-wr[0],os[1]-wr[1],Dn*(os[2]-wr[2])],Ys=nr(Mr,Mr,[ds[0]-wr[0],ds[1]-wr[1],Dn*(ds[2]-wr[2])]);Gi(Ys,Ys),Rn.dotProductWithUp=gn(Ys,jr)}return Ki.sort(((Rn,wr)=>Rn.dotProductWithUp-wr.dotProductWithUp)),Ki[0].corners})(Ti,Si),ji=Ti[Bi[0]],zi=Ti[Bi[1]],Oi=Ti[Bi[2]],di=Ti[Bi[3]],ui=fi.getAtPointOrZero(new Oe(ji[0]/yt.worldSize,ji[1]/yt.worldSize),0),Fi=fi.getAtPointOrZero(new Oe(zi[0]/yt.worldSize,zi[1]/yt.worldSize),0),tn=fi.getAtPointOrZero(new Oe(Oi[0]/yt.worldSize,Oi[1]/yt.worldSize),0),Xi=fi.getAtPointOrZero(new Oe(di[0]/yt.worldSize,di[1]/yt.worldSize),0),Vn=(ui+Xi)/2,_n=(Fi+tn)/2;return Vn>_n?Fi<tn?Ce(ht,zi,di,ji,Fi,Xi,ui,Si):Ce(ht,Oi,ji,di,tn,ui,Xi,Si):ui<Xi?Ce(ht,ji,zi,Oi,ui,Fi,tn,Si):Ce(ht,di,Oi,zi,Xi,tn,Fi,Si),Math.max(Vn,_n)})(rt,o,n.aabb,a,d);const Qe=ye([],Lt([],rt),Re);ye(a,Te,Qe)}else Ue=o.elevation.getAtPointOrZero(new Oe(Z.x/Se,Z.y/Se),0);Ue!==0&&(a[14]+=Ue)}}class zt{constructor(n,o,d,g,w){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=n,this.uri=o,this.position=d!=null?new h(d[0],d[1]):new h(0,0),this.orientation=g??[0,0,0],this.nodes=w,this.uploaded=!1,this.aabb=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,o){ye(n.globalMatrix,o,n.localMatrix);const d=this.nodeOverrides.get(n.name);if(d!==void 0){const S=[];w=d.orientation,ie(g=S),Ze(g,g,ns(w[1])),We(g,g,ns(w[2])),Pe(g,g,ns(w[0])),ye(n.globalMatrix,n.globalMatrix,S)}var g,w;if(n.meshes)for(const S of n.meshes){const A=Ln.applyTransformFast(S.aabb,n.globalMatrix);this.aabb.encapsulate(A)}if(n.children)for(const S of n.children)this._applyTransformations(S,n.globalMatrix)}computeBoundsAndApplyParent(){const n=ie([]);this.aabb=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.nodes)this._applyTransformations(o,n)}computeModelMatrix(n,o,d,g,w,S,A=!1){it(this.matrix,this,n.transform,this.position,o,d,g,w,S,A)}upload(n){if(!this.uploaded){for(const o of this.nodes)Vt(o,n);for(const o of this.nodes)Xt(o);this.uploaded=!0}}destroy(){for(const n of this.nodes)Mi(n)}}function lt(a,n,o=!1){a.uploaded||(a.gfxTexture=new j0(n,a.image,o?n.gl.R8:n.gl.RGBA8,{useMipmap:a.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function gt(a,n,o){a.indexBuffer=n.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=n.createVertexBuffer(a.vertexArray,d1.members,!1,!0),a.normalArray&&(a.normalBuffer=n.createVertexBuffer(a.normalArray,f.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=n.createVertexBuffer(a.texcoordArray,c.members,!1,!0)),a.colorArray&&(a.colorBuffer=n.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?TI:m).members,!1,!0)),a.featureArray&&(a.pbrBuffer=n.createVertexBuffer(a.featureArray,C.members,!0)),a.segments=bo.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const d=a.material;d.pbrMetallicRoughness.baseColorTexture&&lt(d.pbrMetallicRoughness.baseColorTexture,n),d.pbrMetallicRoughness.metallicRoughnessTexture&&lt(d.pbrMetallicRoughness.metallicRoughnessTexture,n),d.normalTexture&&lt(d.normalTexture,n),d.occlusionTexture&&lt(d.occlusionTexture,n,o),d.emissionTexture&&lt(d.emissionTexture,n)}function Vt(a,n,o){if(a.meshes)for(const d of a.meshes)gt(d,n,o);if(a.children)for(const d of a.children)Vt(d,n,o)}function Xt(a){if(a.meshes)for(const n of a.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(a.children)for(const n of a.children)Xt(n)}function Mi(a){if(a.meshes)for(const o of a.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(a.children)for(const o of a.children)Mi(o)}function ln(a,n){const o=a.json.bufferViews[n.bufferView],d=Ly[n.componentType];return new d(a.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==Ry[n.type]*d.BYTES_PER_ELEMENT?o.byteStride/d.BYTES_PER_ELEMENT:Ry[n.type]))}function rn(a,n,o,d){const g=Ly[n.componentType],w=(function(q){switch(q){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(g),S=a.json.bufferViews[n.bufferView],A=S.byteStride?S.byteStride/g.BYTES_PER_ELEMENT:Ry[n.type],L=o.float32,N=L.length/o.capacity;for(let q=0,Z=0;q<n.count*A;q+=A,Z+=N)for(let Q=0;Q<N;Q++)L[Z+Q]=d[q+Q]*w;o._trim()}function Sn(a,n,o){const d=a.indices,g=a.attributes,w={};w.indexArray=new $o;const S=n.json.accessors[d],A=S.count/3;w.indexArray.reserve(A);const L=ln(n,S);for(let Q=0;Q<A;Q++)w.indexArray.emplaceBack(L[3*Q],L[3*Q+1],L[3*Q+2]);w.indexArray._trim(),w.vertexArray=new bl;const N=n.json.accessors[g.POSITION];w.vertexArray.reserve(N.count);const q=ln(n,N);for(let Q=0;Q<N.count;Q++)w.vertexArray.emplaceBack(q[3*Q],q[3*Q+1],q[3*Q+2]);if(w.vertexArray._trim(),w.aabb=new Ln(N.min,N.max),w.centroid=(function(Q,ne){const oe=[0,0,0],me=Q.length;if(me>0){for(let Se=0;Se<me;Se++){const Te=3*Q[Se];oe[0]+=ne[Te],oe[1]+=ne[Te+1],oe[2]+=ne[Te+2]}oe[0]/=me,oe[1]/=me,oe[2]/=me}return oe})(L,q),g.COLOR_0!==void 0){const Q=n.json.accessors[g.COLOR_0],ne=Ry[Q.type],oe=ln(n,Q);w.colorArray=ne===3?new bl:new Ml,w.colorArray.resize(Q.count),rn(n,Q,w.colorArray,oe)}if(g.NORMAL!==void 0){w.normalArray=new bl;const Q=n.json.accessors[g.NORMAL];w.normalArray.resize(Q.count);const ne=ln(n,Q);rn(n,Q,w.normalArray,ne)}if(g.TEXCOORD_0!==void 0&&o.length>0){w.texcoordArray=new yu;const Q=n.json.accessors[g.TEXCOORD_0];w.texcoordArray.resize(Q.count);const ne=ln(n,Q);rn(n,Q,w.texcoordArray,ne)}if(g._FEATURE_ID_RGBA4444!==void 0){const Q=n.json.accessors[g._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(w.featureData=ln(n,Q))}g._FEATURE_RGBA4444!==void 0&&(w.featureData=new Uint32Array(ln(n,n.json.accessors[g._FEATURE_RGBA4444]).buffer));const Z=a.material;return w.material=(function(Q,ne){const{emissiveFactor:oe=[0,0,0],alphaMode:me="OPAQUE",alphaCutoff:Se=.5,normalTexture:Te,occlusionTexture:Le,emissiveTexture:Re,doubleSided:Ue,name:rt}=Q,{baseColorFactor:Qe=[1,1,1,1],metallicFactor:ht=1,roughnessFactor:yt=1,baseColorTexture:Et,metallicRoughnessTexture:ai}=Q.pbrMetallicRoughness||{},kt=Le?ne[Le.index]:void 0;if(Le&&Le.extensions&&Le.extensions.KHR_texture_transform&&kt){const fi=Le.extensions.KHR_texture_transform;kt.offsetScale=[fi.offset[0],fi.offset[1],fi.scale[0],fi.scale[1]]}return{name:rt,pbrMetallicRoughness:{baseColorFactor:new ps(...Qe),metallicFactor:ht,roughnessFactor:yt,baseColorTexture:Et?ne[Et.index]:void 0,metallicRoughnessTexture:ai?ne[ai.index]:void 0},doubleSided:Ue,emissiveFactor:new ps(...oe),alphaMode:me,alphaCutoff:Se,normalTexture:Te?ne[Te.index]:void 0,occlusionTexture:kt,emissionTexture:Re?ne[Re.index]:void 0,defined:Q.defined===void 0}})(Z!==void 0?n.json.materials[Z]:{defined:!1},o),w}function Xn(a,n,o){const{matrix:d,rotation:g,translation:w,scale:S,mesh:A,extras:L,children:N,name:q}=a,Z={};if(Z.name=q,Z.localMatrix=d||(function(Q,ne,oe,me){var Se=ne[0],Te=ne[1],Le=ne[2],Re=ne[3],Ue=Se+Se,rt=Te+Te,Qe=Le+Le,ht=Se*Ue,yt=Se*rt,Et=Se*Qe,ai=Te*rt,kt=Te*Qe,fi=Le*Qe,Ti=Re*Ue,Si=Re*rt,Bi=Re*Qe,ji=me[0],zi=me[1],Oi=me[2];return Q[0]=(1-(ai+fi))*ji,Q[1]=(yt+Bi)*ji,Q[2]=(Et-Si)*ji,Q[3]=0,Q[4]=(yt-Bi)*zi,Q[5]=(1-(ht+fi))*zi,Q[6]=(kt+Ti)*zi,Q[7]=0,Q[8]=(Et+Si)*Oi,Q[9]=(kt-Ti)*Oi,Q[10]=(1-(ht+ai))*Oi,Q[11]=0,Q[12]=oe[0],Q[13]=oe[1],Q[14]=oe[2],Q[15]=1,Q})([],g||[0,0,0,1],w||[0,0,0],S||[1,1,1]),Z.globalMatrix=se(Z.localMatrix),A!==void 0){Z.meshes=o[A];const Q=Z.anchor=[0,0];for(const ne of Z.meshes){const{min:oe,max:me}=ne.aabb;Q[0]+=oe[0]+me[0],Q[1]+=oe[1]+me[1]}Q[0]=Math.floor(Q[0]/Z.meshes.length/2),Q[1]=Math.floor(Q[1]/Z.meshes.length/2)}if(L&&(L.id&&(Z.id=L.id),L.lights&&(Z.lights=(function(Q){if(!Q.length)return[];const ne=(function(Le){const Re=atob(Le),Ue=new Uint8Array(Re.length);for(let rt=0;rt<Re.length;rt++)Ue[rt]=Re.codePointAt(rt);return Ue})(Q),oe=[],me=ne.length/24,Se=new Uint16Array(ne.buffer),Te=new Float32Array(ne.buffer);for(let Le=0;Le<me;Le++){const Re=Se[2*Le*6]/30,Ue=Se[2*Le*6+1]/30,rt=Se[2*Le*6+10]/100,Qe=Te[6*Le+1],ht=Te[6*Le+2],yt=Te[6*Le+3],Et=Te[6*Le+4],ai=yt-Qe,kt=Et-ht,fi=Math.hypot(ai,kt);oe.push({pos:[Qe+.5*ai,ht+.5*kt,Ue],normal:[kt/fi,-ai/fi,0],width:fi,height:Re,depth:rt,points:[Qe,ht,yt,Et]})}return oe})(L.lights)),L.MAPBOX_geometry_bloom&&(Z.isGeometryBloom=L.MAPBOX_geometry_bloom)),N){const Q=[];for(const ne of N)Q.push(Xn(n.json.nodes[ne],n,o));Z.children=Q}return Z}function An(a){if(a.vertices.length===0||a.indices.length===0)return null;const n=new bh(a.vertices,a.indices,8,256),[o,d]=[n.min.clone(),n.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:n,min:o,max:d}}function cn(a){if(!a.extras||!a.extras.ground)return null;const n=a.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const d=[];for(const S of o){if(!Array.isArray(S)||S.length!==2)continue;const A=S[0],L=S[1];typeof A=="number"&&typeof L=="number"&&d.push(new yi(A,L))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let g=0;for(let S=0;S<d.length;S++){const A=d[S],L=d[(S+1)%d.length],N=d[(S+2)%d.length];g+=(A.x-L.x)*(N.y-L.y)-(N.x-L.x)*(A.y-L.y)}g>0&&d.reverse();const w=p_(d.flatMap((S=>[S.x,S.y])),[]);return w.length===0?null:{vertices:d,indices:w}}function Zi(a,n){const o=[],d=[];let g=0;const w=[];for(const S of a){g=o.length;const A=S.vertexArray.float32,L=S.indexArray.uint16;for(let N=0;N<S.vertexArray.length;N++)w[0]=A[3*N+0],w[1]=A[3*N+1],w[2]=A[3*N+2],St(w,w,n),o.push(new yi(w[0],w[1]));for(let N=0;N<3*S.indexArray.length;N++)d.push(L[N]+g)}if(d.length%3!=0)return null;for(let S=0;S<d.length;S+=3){const A=o[d[S+0]],L=o[d[S+1]],N=o[d[S+2]];(A.x-L.x)*(N.y-L.y)-(N.x-L.x)*(A.y-L.y)>0&&([d[S+1],d[S+2]]=[d[S+2],d[S+1]])}return{vertices:o,indices:d}}function dr(a){const n=(function(L,N){const q=[],Z=WebGL2RenderingContext;if(L.json.textures)for(const Q of L.json.textures){const ne={magFilter:Z.LINEAR,minFilter:Z.NEAREST,wrapS:Z.REPEAT,wrapT:Z.REPEAT};Q.sampler!==void 0&&Object.assign(ne,L.json.samplers[Q.sampler]),q.push({image:N[Q.source],sampler:ne,uploaded:!1})}return q})(a,a.images),o=(function(L,N){const q=[];for(const Z of L.json.meshes){const Q=[];for(const ne of Z.primitives)Q.push(Sn(ne,L,N));q.push(Q)}return q})(a,n),{scenes:d,scene:g,nodes:w}=a.json,S=d?d[g||0].nodes:[...w.keys()],A=[];for(const L of S)A.push(Xn(w[L],a,o));return(function(L,N,q){const Z={},Q=new Set;for(let ne=0;ne<L.length;ne++){const oe=q[N[ne]];if(!oe.extras)continue;const me=oe.extras["mapbox:footprint:version"],Se=oe.extras["mapbox:footprint:id"];(me||Se)&&Q.add(ne),me==="1.0.0"&&Se&&(Z[Se]=ne)}for(let ne=0;ne<L.length;ne++){if(Q.has(ne))continue;const oe=L[ne],me=q[N[ne]];if(!me.extras)continue;let Se=null;oe.id in Z&&(Se=Zi(L[Z[oe.id]].meshes,oe.localMatrix)),Se||(Se=cn(me)),Se&&(oe.footprint=An(Se))}if(Q.size>0){const ne=Array.from(Q.values()).sort(((oe,me)=>oe-me));for(let oe=ne.length-1;oe>=0;oe--)L.splice(ne[oe],1)}})(A,S,a.json.nodes),A}function or(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const n=a.vertexArray.float32,o=a.aabb.min[0]-1,d=a.aabb.min[1]-1,g=Fe/(a.aabb.max[0]-o+2),w=Fe/(a.aabb.max[1]-d+2);for(let S=0;S<n.length;S+=3){const A=n[S+2],L=(n[S+0]-o)*g|0,N=(n[S+1]-d)*w|0;A>a.heightmap[N*Fe+L]&&(a.heightmap[N*Fe+L]=A)}}function _r(a,n,o,d,g){o.reserve(o.length+4*a.length),d.reserve(d.length+10*a.length),g.reserve(g.length+10*a.length);let w=d.length;for(const S of a){const A=Math.min(10,Math.max(4,1.3*S.height))*n,L=[-S.normal[1],S.normal[0],0],N=Math.min(.29,.1*S.width/S.depth),q=S.width-2*S.depth*n*(N+.01),Z=mr([],S.pos,L,q/2),Q=mr([],S.pos,L,-q/2),ne=[Z[0],Z[1],Z[2]+S.height],oe=[Q[0],Q[1],Q[2]+S.height],me=mr([],S.normal,L,N);Fn(me,me,A);const Se=mr([],S.normal,L,-N);Fn(Se,Se,A),vt(me,Z,me),vt(Se,Q,Se),Z[2]+=.1,Q[2]+=.1,d.emplaceBack(me[0],me[1],me[2]),d.emplaceBack(Se[0],Se[1],Se[2]),d.emplaceBack(Z[0],Z[1],Z[2]),d.emplaceBack(Q[0],Q[1],Q[2]),d.emplaceBack(ne[0],ne[1],ne[2]),d.emplaceBack(oe[0],oe[1],oe[2]),d.emplaceBack(Z[0],Z[1],Z[2]),d.emplaceBack(Q[0],Q[1],Q[2]),d.emplaceBack(me[0],me[1],me[2]),d.emplaceBack(Se[0],Se[1],Se[2]);const Te=q/A/2;g.emplaceBack(-Te-N,-1,Te,.8),g.emplaceBack(Te+N,-1,Te,.8),g.emplaceBack(-Te,0,Te,1.3),g.emplaceBack(Te,0,Te,1.3),g.emplaceBack(Te+N,-.8,Te,.7),g.emplaceBack(Te+N,-.8,Te,.7),g.emplaceBack(0,0,Te,1.3),g.emplaceBack(0,0,Te,1.3),g.emplaceBack(Te+N,-1.2,Te,.8),g.emplaceBack(Te+N,-1.2,Te,.8),o.emplaceBack(6+w,4+w,8+w),o.emplaceBack(7+w,9+w,5+w),o.emplaceBack(0+w,1+w,2+w),o.emplaceBack(1+w,3+w,2+w),w+=10}}function er(a,n){const o={};o.indexArray=new $o,o.vertexArray=new bl,o.colorArray=new Ml,_r(a,n,o.indexArray,o.vertexArray,o.colorArray);const d={defined:!0};d.emissiveFactor=ps.black;const g={};return g.baseColorFactor=ps.white,d.pbrMetallicRoughness=g,o.material=d,o.aabb=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const Dr=hr([{name:"a_pos_3f",components:3,type:"Float32"}]),vo=hr([{name:"a_normal_3",components:3,type:"Int16"}]),Qs=hr([{name:"a_centroid_3",components:3,type:"Int16"}]),Ia=hr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),zc=hr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Ll=hr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Na=hr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Ca=hr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qo=hr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Ha=It.types,Va=32767;function ga(a,n){const o=Ji+n;for(const d of a)for(const g of d)if(g.x<-n||g.x>o||g.y<-n||g.y>o)return!1;return!0}function Uu(a){switch(a){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${a}`)}}class rc{constructor(){this.layoutVertexArray=new bl,this.layoutAttenuationArray=new Ml,this.layoutColorArray=new Ws,this.indexArray=new $o,this.indexArrayForConflation=new $o,this.segmentsBucket=new bo}}class Jc{constructor(n){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new bo,this.entranceBloom=new rc;const o=66560;this.layoutVertexArray=new bl,this.layoutVertexArray.reserve(o),this.layoutNormalArray=new aa,this.layoutNormalArray.reserve(o),this.layoutCentroidArray=new aa,this.layoutCentroidArray.reserve(o),this.layoutColorArray=new Ws,this.layoutColorArray.reserve(o),this.layoutFloodLightDataArray=new ju,this.layoutFloodLightDataArray.reserve(o),this.layoutAOArray=new ig,this.layoutAOArray.reserve(o),this.indexArray=new $o,this.indexArray.reserve(66560),this.indexArrayForConflation=new $o,this.segmentsBucket=new bo,this.entranceBloom=new rc,n&&(this.layoutFacadePaintArray=new Ws,this.layoutFacadeDataArray=new Xc,this.layoutFacadeVerticalRangeArray=new Ws)}reserve(n,o,d){this.layoutVertexArray.reserveForAdditional(n),this.layoutCentroidArray.reserveForAdditional(n),this.layoutFloodLightDataArray.reserveForAdditional(n),this.layoutNormalArray.reserveForAdditional(n),this.layoutAOArray.reserveForAdditional(n),this.layoutColorArray.reserveForAdditional(n),this.indexArray.reserveForAdditional(o),d&&(this.layoutFacadePaintArray.reserveForAdditional(n),this.layoutFacadeDataArray.reserveForAdditional(n),this.layoutFacadeVerticalRangeArray.reserveForAdditional(n))}}class Qh{constructor(n){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new yu,this.footprintsIndices=new ju,this.footprintsMin=new yi(1/0,1/0),this.footprintsMax=new yi(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new Jc(!1),this.buildingWithFacade=new Jc(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.hasPattern=!1,this.worldview=n.worldview,this.lut=n.lut,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.projection=n.projection,this.groundEffect=new Xv(n),this.groundEffect.groundRadiusArray=new ma,this.hasAppearances=null}updateFootprints(n,o){const d=new bh([],[],1),g={vertices:[],indices:new Uint32Array(0),grid:d,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};o.push({footprint:g,id:n})}updateAppearances(n,o,d,g){}prepare(){return(function(){if(ex!=null||X2!=null)return null;if(lm!=null)return lm;const n=fetch(qr.BUILDING_GEN_URL);return lm=(function(o){let d,g,w,S,A;function L(){d=new Uint8Array(A.buffer),g=new Int16Array(A.buffer),w=new Int32Array(A.buffer),S=new Float32Array(A.buffer)}function N(){throw new Error("Unexpected BuildingGen error.")}const q=()=>{},Z={a:{a:N,f:function(Q){const ne=d.length,oe=Math.max(Q>>>0,Math.ceil(1.2*ne)),me=Math.ceil((oe-ne)/65536);try{return A.grow(me),L(),!0}catch{return!1}},g:N,b:q,c:q,d:q,e:q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,Z):o.then((Q=>Q.arrayBuffer())).then((Q=>WebAssembly.instantiate(Q,Z)))).then((Q=>{const ne=Q.instance.exports;return(0,ne.g)(),A=ne.f,L(),new bI({setStyle:ne.h,setAOOptions:ne.i,setMetricOptions:ne.j,setStructuralOptions:ne.k,setFacadeOptions:ne.l,setFauxFacadeOptions:ne.m,setFacadeClassifierOptions:ne.n,addFeature:ne.o,addFacade:ne.p,generateMesh:ne.q,getLastError:ne.r,getOuterRingLength:ne.s,getMeshCount:ne.t,getPositionsPtr:ne.u,getPositionsLength:ne.v,getNormalsPtr:ne.w,getNormalsLength:ne.x,getAOPtr:ne.y,getAOLength:ne.z,getUVPtr:ne.A,getUVLength:ne.B,getFauxFacadePtr:ne.C,getFauxFacadeLength:ne.D,getIndicesPtr:ne.E,getIndicesLength:ne.F,getBuildingPart:ne.G,getRingCount:ne.H,getRingPtr:ne.I,getRingLength:ne.J,malloc:ne.K,free:ne.L,heapU8:d,heap16:g,heap32:w,heapF32:S})}))})(n).then((o=>(lm=null,ex=o,ex))).catch((o=>{mn("Could not load building-gen"),lm=null,X2=o})),lm})()}populate(n,o,d,g){const w=Rc();if(!w)return;const S=Ae(d);this.tileToMeter=S,this.brightness=o.brightness,w.setStyle({normalScale:[1,-1,S],tileToMeters:S}),w.setAOOptions(!1,.3),w.setMetricOptions(!1,16),w.setStructuralOptions(!0),w.setFacadeClassifierOptions(3);const A=new Map,L=new Map;let N=0;for(const{feature:Te}of n){if(Ha[Te.type]!=="LineString"){A.set(Te.id,Te.properties.source_id);continue}const Le=this.layers[0]._featureFilter.needGeometry;if(Le&&!this.layers[0]._featureFilter.filter(new Us(this.zoom),Te,d))continue;const Re=Pt(Te,Le);if(!Le&&!this.layers[0]._featureFilter.filter(new Us(this.zoom),Re,d))continue;const Ue=Le?Re.geometry:mt(Te,d,g),rt=[];for(const Et of Ue)for(const ai of Et)rt.push(ai.x),rt.push(ai.y);const Qe={coordinates:rt,crossPerc:Te.properties.cross_perc,distanceToRoad:Te.properties.distance_to_road,entrances:Te.properties.entrances,sourceId:0},ht=Te.properties.source_id;let yt=L.get(ht);yt||(yt=[],L.set(ht,yt)),yt.push(Qe),++N}this.maxHeight=0;const q=new Array,Z=new Set,Q=Te=>{Te!=null&&Z.add(Te)},ne=(Te,Le)=>{Te!=null&&q.push({buildingId:Te,footprintIndex:Le})},oe=64*(n.length-N),me=oe/2;this.buildingWithFacade.reserve(oe,me,!0),this.buildingWithoutFacade.reserve(2*oe,2*me,!1),this.footprintsIndices.reserve(16*(n.length-N)),this.footprintsVertices.reserve(8*(n.length-N));for(const{feature:Te,id:Le,index:Re,sourceLayerIndex:Ue}of n){if(Ha[Te.type]==="LineString")continue;const rt=this.layers[0]._featureFilter.needGeometry;if(rt&&!this.layers[0]._featureFilter.filter(new Us(this.zoom),Te,d))continue;let Qe=null;if(Te.properties&&Te.properties.hasOwnProperty("building_id")&&(Qe=Te.properties.building_id,Z.has(Qe)))continue;const ht=Pt(Te,rt);if(!rt&&!this.layers[0]._featureFilter.filter(new Us(this.zoom),ht,d))continue;const yt=rt?ht.geometry:mt(Te,d,g),Et=Jh(yt,500);let ai=!1;for(const lr of Et)if(lr.length!==1){ai=!0;break}if(ai){Q(Qe);continue}if(!ga(yt,163)){Q(Qe);continue}const kt=this.layers[0],fi=Uu(kt.layout.get("building-roof-shape").evaluate(Te,{},d)),Ti=kt.layout.get("building-base").evaluate(Te,{},d),Si=kt.layout.get("building-height").evaluate(Te,{},d),Bi=kt.layout.get("building-flood-light-ground-radius").evaluate(Te,{},d),ji=kt.paint.get("building-ambient-occlusion-intensity"),zi=Bi/this.tileToMeter;Te.properties["building-part"]="roof";const Oi=kt.paint.get("building-color").evaluate(Te,{},this.canonical).toPremultipliedRenderColor(this.lut),di=kt.paint.get("building-emissive-strength").evaluate(Te,{},this.canonical);Te.properties["building-part"]="wall";const ui=kt.paint.get("building-color").evaluate(Te,{},this.canonical).toPremultipliedRenderColor(this.lut),Fi=kt.paint.get("building-emissive-strength").evaluate(Te,{},this.canonical);Te.properties["building-part"]="window";const tn=kt.paint.get("building-color").evaluate(Te,{},this.canonical).toPremultipliedRenderColor(this.lut),Xi=kt.paint.get("building-emissive-strength").evaluate(Te,{},this.canonical);Te.properties["building-part"]="door";const Vn=kt.paint.get("building-color").evaluate(Te,{},this.canonical).toPremultipliedRenderColor(this.lut),_n=kt.paint.get("building-emissive-strength").evaluate(Te,{},this.canonical);let In=kt.layout.get("building-flood-light-wall-radius").evaluate(Te,{},d);In=we(In,0,2048);const Dn=In/2048*Va,jr=A.get(Le),Ki=L.get(jr)||[],Rn=Ki.length!==0&&kt.layout.get("building-facade").evaluate(Te,{},d);w.setFacadeOptions(4,!0),w.setFauxFacadeOptions(Rn,!1,1);let wr=0,os=0,ds=0,Mr=0,Ys=0,et=0,st=0,pi=0,Ni=0,dn=0,fn=0;if(Rn){let lr=Math.round(kt.layout.get("building-facade-floors").evaluate(Te,{},d));if(Ti===0){lr=Math.max(1,lr-(Ki.length>0?1:0));let Gs=4;if(Si>100){const Co=[10,13,15];Gs=Co[Te.id?Te.id%Co.length:0]}else Si<=10&&(Gs=3);w.setFacadeOptions(Gs,!0),Ys=(Si<15?1.3:1.61803)*Gs/S}else Ys=Ti/S;et=Si/S,Ys=Math.min(Ys,et),ds=kt.layout.get("building-facade-unit-width").evaluate(Te,{},d)/S,Mr=(et-Ys)/lr,w.setFauxFacadeOptions(!0,!0,ds);const Ho=kt.layout.get("building-facade-window").evaluate(Te,{},d);wr=Ho[0],os=Ho[1],st=Math.floor(65535*Math.min(1,Ys/Ji)),pi=Math.floor(65535*Math.min(1,et/Ji)),Ni=Math.floor(255*wr)<<8|Math.floor(255*os),dn=Math.floor(65535*Math.min(1,ds/Ji)),fn=Math.floor(65535*Math.min(1,Mr/Ji))}const Un=Array(Et.length),Wn={x:1/0,y:1/0},Ir={x:-1/0,y:-1/0},zr={x:0,y:0};let Vr=0;for(let lr=0;lr<Et.length;lr++){const Ho=Et[lr];if(Ho.length>0){const Gs=[],Co=Array(Ho.length+1);Co[0]=0;for(let hl=0;hl<Ho.length;hl++){const Rl=Ho[hl];for(let Xa=0;Xa<Rl.length;Xa++){const Ya=Rl[Rl.length-Xa-1];Wn.x=Math.min(Wn.x,Ya.x),Wn.y=Math.min(Wn.y,Ya.y),Ir.x=Math.max(Ir.x,Ya.x),Ir.y=Math.max(Ir.y,Ya.y),zr.x+=Ya.x,zr.y+=Ya.y,Vr++,Gs.push(Ya.x),Gs.push(Ya.y)}Co[hl+1]=Gs.length}Un[lr]={id:Te.id?Te.id:0,height:Si,minHeight:Ti,sourceId:0,roofType:fi,coordinates:Gs,ringIndices:Co}}}zr.x/=Vr||1,zr.y/=Vr||1;const rs=w.generateMesh(Un,Ki);if(typeof rs=="string"){mn(`Unable to generate building ${Te.id}: ${rs}`),Q(Qe);continue}if(rs.meshes.length===0||rs.modifiedPolygonRings.length===0){Q(Qe);continue}const cr=Rn?this.buildingWithFacade:this.buildingWithoutFacade;let xr=0;for(const lr of rs.meshes)xr+=lr.positions.length/3;const gs=cr.segmentsBucket.prepareSegment(xr,cr.layoutVertexArray,cr.indexArray),Es=[];let Is=null,$s=0,to=-1;const Ks=cr.layoutVertexArray.length,ks=Ks+xr;cr.layoutVertexArray.resize(ks),cr.layoutCentroidArray.resize(ks),cr.layoutNormalArray.resize(ks),cr.layoutAOArray.resize(ks),cr.layoutColorArray.resize(ks),cr.layoutFloodLightDataArray.resize(ks),Rn&&(cr.layoutFacadePaintArray.resize(ks),cr.layoutFacadeDataArray.resize(ks),cr.layoutFacadeVerticalRangeArray.resize(ks));const Fs=cr.indexArray.length;let Or=0,us=Ks;for(const lr of rs.meshes){let Ho,Gs;if(lr.buildingPart===1)Ho=Oi,Gs=di;else if(lr.buildingPart===0)Ho=ui,Gs=Fi;else if(lr.buildingPart===2)Ho=tn,Gs=Xi;else{if(lr.buildingPart!==3)continue;Ho=Vn,Gs=_n}if(Gs=we(Gs,0,1),lr.buildingPart===3){const fo=new Array;for(let dl=0;dl<lr.positions.length;dl+=12){const wp=lr.positions[dl+0],_g=lr.positions[dl+1],_c=lr.positions[dl+3],bu=lr.positions[dl+4],id=lr.positions[dl+2],Uy=lr.positions[dl+8]-id,wx=1,pm=_c-wp,mm=bu-_g,B1=Math.hypot(pm,mm);fo.push({pos:[wp+.5*pm,_g+.5*mm,id],normal:[mm/B1,-pm/B1,0],width:B1,height:Uy,depth:wx,points:[wp,_g,_c,bu]})}const ua=cr.entranceBloom.segmentsBucket.prepareSegment(10*fo.length,cr.entranceBloom.layoutVertexArray,cr.entranceBloom.indexArray),ya=cr.entranceBloom.layoutVertexArray.length;$s=cr.entranceBloom.indexArray.length,_r(fo,.5/this.tileToMeter,cr.entranceBloom.indexArray,cr.entranceBloom.layoutVertexArray,cr.entranceBloom.layoutAttenuationArray);const Sh=cr.entranceBloom.layoutVertexArray.length-ya;to=cr.entranceBloom.indexArray.length-$s;for(let dl=0;dl<Sh;dl++)cr.entranceBloom.layoutColorArray.emplaceBack(255*Vn.r<<8|255*Vn.g,255*Vn.b<<8|51*_n);ua.vertexLength+=Sh,ua.primitiveLength+=to,Is={part:lr.buildingPart,vertexOffset:ya,vertexLength:Sh}}cr.layoutVertexArray.float32.set(lr.positions,3*us);const Co=lr.positions.length/3;for(let fo=0;fo<Co;++fo){const ua=3*fo;Or=Math.max(Or,lr.positions[ua+2]);const ya=lr.normals[ua+1]*Va,Sh=lr.normals[ua+2]*Va,dl=3*(us+fo);cr.layoutNormalArray.int16[dl]=lr.normals[ua]*Va,cr.layoutNormalArray.int16[dl+1]=ya,cr.layoutNormalArray.int16[dl+2]=Sh;const wp=lr.ao[fo];cr.layoutAOArray.uint8[us+fo]=255*wp;const _g=1+(wp-1)*ji,_c=255*Ho.b*_g<<8|255*Gs;cr.layoutColorArray.uint16[2*(us+fo)]=255*Ho.r*_g<<8|255*Ho.g*_g,cr.layoutColorArray.uint16[2*(us+fo)+1]=_c}const hl=Math.floor(zr.x),Rl=Math.floor(zr.y),Xa=Math.floor(Si);for(let fo=0;fo<Co;++fo){const ua=3*(us+fo);cr.layoutCentroidArray.int16[ua]=hl,cr.layoutCentroidArray.int16[ua+1]=Rl,cr.layoutCentroidArray.int16[ua+2]=Xa}if(cr.layoutFloodLightDataArray.uint16.fill(lr.buildingPart===0?Dn:0,us,us+Co),Rn){const fo=255*tn.r<<8|255*tn.g,ua=255*tn.b<<8|255*Xi;for(let ya=0;ya<Co;++ya){const Sh=2*(us+ya);cr.layoutFacadePaintArray.uint16[Sh]=fo,cr.layoutFacadePaintArray.uint16[Sh+1]=ua}for(let ya=0;ya<Co;++ya)if(lr.isFauxFacade[ya]){const Sh=Math.min(65535,Math.floor(lr.uv[2*ya]*rs.outerRingLength));cr.layoutFacadeDataArray.emplace(us+ya,1|Sh,Ni,dn,fn),cr.layoutFacadeVerticalRangeArray.emplace(us+ya,st,pi)}else cr.layoutFacadeDataArray.emplace(us+ya,0,0,0,0),cr.layoutFacadeVerticalRangeArray.emplace(us+ya,0,0)}const Ya=gs.vertexLength,Il=lr.indices.length/3,$u=cr.indexArray.length;cr.indexArray.resize($u+Il);for(let fo=0;fo<Il;++fo){const ua=3*fo,ya=3*$u+ua;cr.indexArray.uint16[ya]=Ya+lr.indices[ua],cr.indexArray.uint16[ya+1]=Ya+lr.indices[ua+1],cr.indexArray.uint16[ya+2]=Ya+lr.indices[ua+2]}lr.buildingPart!==1&&lr.buildingPart!==0&&lr.buildingPart!==2&&lr.buildingPart!==3||Es.push({part:lr.buildingPart,vertexOffset:us,vertexLength:lr.positions.length/3}),us+=Co,gs.vertexLength+=Co,gs.primitiveLength+=lr.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Or);const Ro=cr.indexArray.length-Fs,ar=this.footprintsIndices.length,ss=this.footprintsVertices.length,eo=[],ro=new yi(1/0,1/0),mo=new yi(-1/0,-1/0),_a=this.groundEffect.vertexArray.length;for(const lr of rs.modifiedPolygonRings){const Ho=[],Gs=new yi(1/0,1/0),Co=new yi(-1/0,-1/0);for(let hl=0;hl<lr.length;hl+=2){const Rl=lr.length-hl-2;Gs.x=Math.min(Gs.x,lr[Rl]),Gs.y=Math.min(Gs.y,lr[Rl+1]),Co.x=Math.max(Co.x,lr[Rl]),Co.y=Math.max(Co.y,lr[Rl+1]);const Xa=new yi(lr[Rl],lr[Rl+1]);Ho.push(Xa),eo.push(Xa.x,Xa.y),this.footprintsVertices.emplaceBack(Xa.x,Xa.y)}ro.x=Math.min(ro.x,Gs.x),ro.y=Math.min(ro.y,Gs.y),mo.x=Math.max(mo.x,Co.x),mo.y=Math.max(mo.y,Co.y),this.groundEffect.addData(Ho,[Gs,Co],zi)}const ho=this.groundEffect.vertexArray.length-_a;this.groundEffect.groundRadiusArray.reserveForAdditional(ho);for(let lr=0;lr<ho;lr++)this.groundEffect.groundRadiusArray.emplaceBack(Bi);(Wn.x<0||Ir.x>Ji||Wn.y<0||Ir.y>Ji)&&this.featuresOnBorder.push({featureId:Te.id,footprintIndex:this.footprints.length});{const lr=p_(eo,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+lr.length),this.footprintsIndices.uint16.set(lr,ar),this.buildingIds.add(Qe??Te.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,ro.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,ro.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,mo.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,mo.y);const Ho={footprintVertexOffset:ss,footprintVertexLength:this.footprintsVertices.length-ss,footprintIndexOffset:ar,footprintIndexLength:this.footprintsIndices.length-ar,min:ro,max:mo,hiddenFlags:0,indicesOffset:Fs,indicesLength:Ro,bloomIndicesOffset:$s,bloomIndicesLength:to,groundEffectVertexOffset:_a,groundEffectVertexLength:ho,hasFauxFacade:Rn,height:Or,promoteId:Le,feature:ht,parts:Es,buildingBloom:Is},Gs=this.footprints.length;Te.id!==void 0&&this.featureFootprintLookup.set(Te.id,Gs),ne(Qe,Gs),this.footprints.push(Ho)}this.programConfigurations.populatePaintArrays(cr.layoutVertexArray.length,Te,Re,{},o.availableImages,d,o.brightness),this.groundEffect.addPaintPropertiesData(Te,Re,{},o.availableImages,d,o.brightness),o.featureIndex.insert(Te,yt,Re,Ue,this.index,Ks)}q.forEach((({buildingId:Te,footprintIndex:Le})=>{Z.has(Te)&&(this.footprints[Le].hiddenFlags|=4)}));const Se=new Set;this.buildingIds.forEach(((Te,Le,Re)=>{Z.has(Te)||Se.add(Te)})),this.buildingIds=Se,this.groundEffect.prepareBorderSegments()}update(n,o,d,g,w,S,A){this.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A),this.groundEffect.update(n,o,w,d,g,S,A),this.evaluate(this.layers[0],n),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){const o=d=>{d.layoutVertexBuffer=n.createVertexBuffer(d.layoutVertexArray,Dr.members),d.layoutNormalBuffer=n.createVertexBuffer(d.layoutNormalArray,vo.members),d.layoutCentroidBuffer=n.createVertexBuffer(d.layoutCentroidArray,Qs.members),d.layoutFloodLightDataBuffer=n.createVertexBuffer(d.layoutFloodLightDataArray,qo.members),d.layoutFacadeDataArray&&d.layoutFacadeDataArray.length&&(d.layoutFacadeDataBuffer=n.createVertexBuffer(d.layoutFacadeDataArray,Ll.members)),d.layoutFacadeVerticalRangeArray&&d.layoutFacadeVerticalRangeArray.length&&(d.layoutFacadeVerticalRangeBuffer=n.createVertexBuffer(d.layoutFacadeVerticalRangeArray,Na.members)),d.entranceBloom.layoutVertexArray.length&&(d.entranceBloom.layoutVertexBuffer=n.createVertexBuffer(d.entranceBloom.layoutVertexArray,Dr.members),d.entranceBloom.layoutAttenuationBuffer=n.createVertexBuffer(d.entranceBloom.layoutAttenuationArray,Ca.members)),this.uploadUpdatedColorBuffer(n),this.uploadUpdatedIndexBuffer(n)};this.uploaded||(o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){const n=o=>{o.layoutVertexBuffer&&(o.layoutVertexBuffer.destroy(),o.layoutNormalBuffer.destroy(),o.layoutColorBuffer.destroy(),o.segmentsBucket.destroy(),o.indexBuffer&&o.indexBuffer.destroy(),o.entranceBloom.layoutVertexBuffer&&(o.entranceBloom.layoutVertexBuffer.destroy(),o.entranceBloom.layoutColorBuffer.destroy(),o.entranceBloom.layoutAttenuationBuffer.destroy(),o.entranceBloom.indexBuffer.destroy(),o.entranceBloom.segmentsBucket.destroy()))};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(n,o,d=!0){let g=!1;const w=d?o:0,S=0|(d?-1:~o);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const A of n){const L=this.footprints[A],N=L.hiddenFlags&S|w;L.hiddenFlags!==N&&(L.hiddenFlags=N,g=!0,this.groundEffect.updateHiddenByLandmarkRange(L.groundEffectVertexOffset,L.groundEffectVertexLength,L.hiddenFlags!==0))}return g&&(this.indexArrayForConflationUploaded=!1),g}uploadUpdatedIndexBuffer(n){if(this.groundEffect.uploadHiddenByLandmark(n),this.indexArrayForConflationUploaded)return;const o=g=>{g.indexArray.length!==0&&(g.indexArrayForConflation.resize(g.indexArray.length),g.indexArrayForConflation.uint16.set(g.indexArray.uint16),g.entranceBloom.indexArrayForConflation.resize(g.entranceBloom.indexArray.length),g.entranceBloom.indexArrayForConflation.uint16.set(g.entranceBloom.indexArray.uint16))};o(this.buildingWithoutFacade),o(this.buildingWithFacade);for(const g of this.footprints){const w=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,S=g.indicesOffset+g.indicesLength;if(g.hiddenFlags!==0){for(let L=g.indicesOffset;L<S;L++)w.indexArrayForConflation.uint16[3*L+0]=0,w.indexArrayForConflation.uint16[3*L+1]=0,w.indexArrayForConflation.uint16[3*L+2]=0;const A=g.bloomIndicesOffset+g.bloomIndicesLength;for(let L=g.bloomIndicesOffset;L<A;L++)w.entranceBloom.indexArrayForConflation.uint16[3*L+0]=0,w.entranceBloom.indexArrayForConflation.uint16[3*L+1]=0,w.entranceBloom.indexArrayForConflation.uint16[3*L+2]=0}}const d=g=>{g.indexArray.length!==0&&(g.indexBuffer?g.indexBuffer.updateData(g.indexArrayForConflation):g.indexBuffer=n.createIndexBuffer(g.indexArrayForConflation,!0),g.entranceBloom.indexBuffer?g.entranceBloom.indexBuffer.updateData(g.entranceBloom.indexArrayForConflation):g.entranceBloom.indexBuffer=n.createIndexBuffer(g.entranceBloom.indexArrayForConflation,!0))};d(this.buildingWithoutFacade),d(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(n){const o=d=>{d.layoutColorBuffer?d.layoutColorBuffer.updateData(d.layoutColorArray):d.layoutColorBuffer=n.createVertexBuffer(d.layoutColorArray,Ia.members,!0),d.layoutFacadePaintArray&&(d.layoutFacadePaintBuffer?d.layoutFacadePaintBuffer.updateData(d.layoutFacadePaintArray):d.layoutFacadePaintBuffer=n.createVertexBuffer(d.layoutFacadePaintArray,zc.members,!0)),d.entranceBloom.layoutColorBuffer?d.entranceBloom.layoutColorBuffer.updateData(d.entranceBloom.layoutColorArray):d.entranceBloom.layoutColorBuffer=n.createVertexBuffer(d.entranceBloom.layoutColorArray,Ia.members,!0)};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(n,o){const d=n.paint.get("building-ambient-occlusion-intensity");for(const g of this.footprints){if(4&g.hiddenFlags)continue;const w=o[g.promoteId],S=g.feature;S.properties["building-part"]="roof";const A=n.paint.get("building-color").evaluate(S,w,this.canonical).toPremultipliedRenderColor(this.lut),L=n.paint.get("building-emissive-strength").evaluate(S,w,this.canonical);S.properties["building-part"]="wall";const N=n.paint.get("building-color").evaluate(S,w,this.canonical).toPremultipliedRenderColor(this.lut),q=n.paint.get("building-emissive-strength").evaluate(S,w,this.canonical);S.properties["building-part"]="window";const Z=n.paint.get("building-color").evaluate(S,w,this.canonical).toPremultipliedRenderColor(this.lut),Q=n.paint.get("building-emissive-strength").evaluate(S,w,this.canonical);S.properties["building-part"]="door";const ne=n.paint.get("building-color").evaluate(S,w,this.canonical).toPremultipliedRenderColor(this.lut),oe=n.paint.get("building-emissive-strength").evaluate(S,w,this.canonical),me=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Te of g.parts){let Le,Re=A;Te.part===1?(Re=A,Le=L):Te.part===0?(Re=N,Le=q):Te.part===2?(Re=Z,Le=Q):Te.part===3&&(Re=ne,Le=oe),Le=we(Le,0,1);for(let Ue=0;Ue<Te.vertexLength;Ue++){const rt=Te.vertexOffset+Ue,Qe=1+(me.layoutAOArray.uint8[rt]/255-1)*d;me.layoutColorArray.emplace(rt,Re.r*Qe*255<<8|Re.g*Qe*255,Re.b*Qe*255<<8|255*Le),g.hasFauxFacade&&me.layoutFacadePaintArray.emplace(rt,255*Z.r<<8|255*Z.g,255*Z.b<<8|255*Q)}}const Se=g.buildingBloom;if(Se)for(let Te=0;Te<Se.vertexLength;Te++)me.entranceBloom.layoutColorArray.emplace(Se.vertexOffset+Te,255*ne.r<<8|255*ne.g,255*ne.b<<8|51*oe)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(n,o,d){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const g=o.getReplacementRegionsForTile(n.toUnwrapped());if(D0(this.activeReplacements,g))return;this.activeReplacements=g;for(const S of this.footprints)S.hiddenFlags&=-2;const w=[];for(const S of this.activeReplacements){if(S.order<=Zb)continue;const A=Math.max(1,Math.pow(2,S.footprintTileId.canonical.z-n.canonical.z));for(const L of this.footprints)L.min.x>S.max.x||L.max.x<S.min.x||L.min.y>S.max.y||L.max.y<S.min.y||(w.length=0,Wa(this.footprintsVertices,L.footprintVertexOffset,L.footprintVertexLength,S.footprintTileId.canonical,n.canonical,w),Iy(S.footprint,w,this.footprintsIndices.uint16,L.footprintIndexOffset,L.footprintIndexLength,0,-A)&&(L.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(n){if(n.id!==void 0){const o=this.featureFootprintLookup.get(n.id);return this.footprints[o]}return null}getHeightAtTileCoord(n,o){let d=Number.NEGATIVE_INFINITY,g=!0;const w=4*(n+Ji)*Ji+(o+Ji);if(this.footprintLookup.hasOwnProperty(w)){const A=this.footprintLookup[w];return A?{height:A.height,hidden:A.hiddenFlags!==0}:void 0}const S=new yi(n,o);for(const A of this.footprints)n>A.max.x||A.min.x>n||o>A.max.y||A.min.y>o||A.height<=d||sc(S,this.footprintsVertices.float32.subarray(2*A.footprintVertexOffset,2*(A.footprintVertexOffset+A.footprintVertexLength)),this.footprintsIndices.uint16.subarray(A.footprintIndexOffset,A.footprintIndexOffset+A.footprintIndexLength))&&(d=A.height,this.footprintLookup[w]=A,g=A.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:g};this.footprintLookup[w]=void 0}}function sc(a,n,o){for(let d=0;d<o.length;d+=3){const g=o[d],w=o[d+1],S=o[d+2],A=n[2*g+0],L=n[2*g+1],N=n[2*w+0],q=n[2*w+1],Z=n[2*S+0],Q=n[2*S+1],ne=(A-Z)*(a.y-Q)-(L-Q)*(a.x-Z),oe=(N-A)*(a.y-L)-(q-L)*(a.x-A);if(ne<0!=oe<0&&ne!==0&&oe!==0)continue;const me=(Z-N)*(a.y-q)-(Q-q)*(a.x-N);if(me===0||me<0==ne+oe<=0)return!0}return!1}function Wa(a,n,o,d,g,w){const S=Math.pow(2,d.z-g.z);for(let A=0;A<o;A++){let L=a.float32[2*(A+n)+0],N=a.float32[2*(A+n)+1];L=(L+g.x*Ji)*S-d.x*Ji,N=(N+g.y*Ji)*S-d.y*Ji,w.push(new yi(L,N))}}let Sl,Za;Cn(Qh,"BuildingBucket",{omit:["layers"]}),Cn(Jc,"BuildingGeometry"),Cn(rc,"BuildingBloomGeometry");const oc=hr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),cm=hr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Lf}=oc,U0=hr([{name:"a_packed",components:3,type:"Float32"}]),{members:pg}=U0,T_=hr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Fy}=T_;class S_{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new dg({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const d=this.getKey(n,o);return this.positions[d]}trim(){const n=this.width,o=this.height=Jt(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,d){const g=[];let w=n.length%2==1?-n[n.length-1]*d:0,S=n[0]*d,A=!0;g.push({left:w,right:S,isDash:A,zeroLength:n[0]===0});let L=n[0];for(let N=1;N<n.length;N++){A=!A;const q=n[N];w=L*d,L+=q,S=L*d,g.push({left:w,right:S,isDash:A,zeroLength:q===0})}return g}addRoundDash(n,o,d){const g=o/2;for(let w=-d;w<=d;w++){const S=this.width*(this.nextRow+d+w);let A=0,L=n[A];for(let N=0;N<this.width;N++){N/L.right>1&&(L=n[++A]);const q=Math.abs(N-L.left),Z=Math.abs(N-L.right),Q=Math.min(q,Z);let ne;const oe=w/d*(g+1);if(L.isDash){const me=g-Math.abs(oe);ne=Math.sqrt(Q*Q+me*me)}else ne=g-Math.sqrt(Q*Q+oe*oe);this.image.data[S+N]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(n,o){for(let L=n.length-1;L>=0;--L){const N=n[L],q=n[L+1];N.zeroLength?n.splice(L,1):q&&q.isDash===N.isDash&&(q.left=N.left,n.splice(L,1))}const d=n[0],g=n[n.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const w=this.width*this.nextRow;let S=0,A=n[S];for(let L=0;L<this.width;L++){L/A.right>1&&(A=n[++S]);const N=Math.abs(L-A.left),q=Math.abs(L-A.right),Z=Math.min(N,q);this.image.data[w+L]=Math.max(0,Math.min(255,(A.isDash?Z:-Z)+o+128))}}addDash(n,o){const d=this.getKey(n,o);if(this.positions[d])return this.positions[d];const g=o==="round",w=g?7:0,S=2*w+1;if(this.nextRow+S>this.height)return mn("LineAtlas out of space"),null;n.length===0&&n.push(1);let A=0;for(let q=0;q<n.length;q++)n[q]<0&&(mn("Negative value is found in line dasharray, replacing values with 0"),n[q]=0),A+=n[q];if(A!==0){const q=this.width/A,Z=this.getDashRanges(n,this.width,q);g?this.addRoundDash(Z,q,w):this.addRegularDash(Z,o==="square"?.5*q:0)}const L=this.nextRow+w;this.nextRow+=S;const N={tl:[L,w],br:[A,0]};return this.positions[d]=N,N}}Cn(S_,"LineAtlas");const By=It.types,eT=Math.cos(Math.PI/180*37.5),tT=Math.cos(Math.PI/180*5);class sx{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new jl,this.layoutVertexArray2=new bl,this.patternVertexArray=new bl,this.indexArray=new $o,this.programConfigurations=new gc(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new bo,this.maxLineLength=0,this.zOffsetVertexArray=new bl,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.tessellationStep=n.tessellationStep?n.tessellationStep:Ji/64,this.worldview=n.worldview,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,d,g){}populate(n,o,d,g){this.hasPattern=nm("line",this.layers,this.pixelRatio,o);const w=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ae(d);const S=this.layers[0].layout.get("line-elevation-reference");if(S==="hd-road-markup")this.elevationType="road";else{const Q=this.layers[0].layout.get("line-z-offset"),ne=Q.isConstant()&&!Q.constantOr(0);this.elevationType=S!=="sea"&&S!=="ground"&&ne?"none":"offset",this.elevationType==="offset"&&S==="none"&&mn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&A!==void 0;const L=[];for(const{feature:Q,id:ne,index:oe,sourceLayerIndex:me}of n){const Se=this.layers[0]._featureFilter.needGeometry,Te=Pt(Q,Se);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Te,d))continue;const Le=w?w.evaluate(Te,{},d):void 0,Re={id:ne,properties:Q.properties,type:Q.type,sourceLayerIndex:me,index:oe,geometry:Se?Te.geometry:mt(Q,d,g),patterns:{},sortKey:Le};L.push(Re)}w&&L.sort(((Q,ne)=>Q.sortKey-ne.sortKey));const{lineAtlas:N,featureIndex:q}=o,Z=this.addConstantDashes(N);for(const Q of L){const{geometry:ne,index:oe,sourceLayerIndex:me}=Q;if(Z&&this.addFeatureDashes(Q,N),this.hasPattern){const Se=xu("line",this.layers,Q,this.zoom,this.pixelRatio,o);this.patternFeatures.push(Se)}else this.addFeature(Q,ne,oe,d,N.positions,o.availableImages,o.brightness,o.elevationFeatures);q.insert(n[oe].feature,ne,oe,me,this.index)}}addConstantDashes(n){let o=!1;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,w=d.layout.get("line-cap").value;if(g.kind!=="constant"||w.kind!=="constant")o=!0;else{const S=w.value,A=g.value;if(!A)continue;n.addDash(A,S)}}return o}addFeatureDashes(n,o){const d=this.zoom;for(const g of this.layers){const w=g.paint.get("line-dasharray").value,S=g.layout.get("line-cap").value;if(w.kind==="constant"&&S.kind==="constant")continue;let A,L;if(w.kind==="constant"){if(A=w.value,!A)continue}else A=w.evaluate({zoom:d},n);L=S.kind==="constant"?S.value:S.evaluate({zoom:d},n),o.addDash(A,L),n.patterns[g.id]=[o.getKey(A,L)]}}update(n,o,d,g,w,S,A,L){this.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,L)}addFeatures(n,o,d,g,w,S){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,o,d,g,S,n.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,pg)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,Fy)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,cm.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Lf),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n,o){let d,g;if(o&&o>0?(d=`mapbox_clip_start_${o}`,g=`mapbox_clip_end_${o}`):(d="mapbox_clip_start",g="mapbox_clip_end"),n.properties&&n.properties.hasOwnProperty(d)&&n.properties.hasOwnProperty(g))return{start:+n.properties[d],end:+n.properties[g]}}addFeature(n,o,d,g,w,S,A,L){const N=this.layers[0].layout,q=N.get("line-join").evaluate(n,{}),Z=N.get("line-cap").evaluate(n,{}),Q=N.get("line-miter-limit"),ne=N.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n;const oe=!(!n.properties||!n.properties.hasOwnProperty("mapbox_line_metrics"))&&n.properties.mapbox_line_metrics;this.zOffsetValue=N.get("line-z-offset").value;const me=this.layers[0].paint.get("line-width").value;if(me.kind!=="constant"&&me.isLineProgressConstant===!1&&(this.variableWidthValue=me),this.elevationType==="road"){const Se=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(n,o,g,L,q,Z,Q,ne)){const[Te,Le]=this.clipRuntimeLinesToTile(o,1);for(let Re=0;Re<Te.length;Re++){const Ue=Te[Re],rt=Le[Re],Qe={progress:{min:rt.progress.min,max:rt.progress.max},nextDir:this.computeSegNextDir(rt,Ue),prevDir:this.computeSegPrevDir(rt,Ue)};this.addLine(Ue,n,g,q,Z,Q,ne,Qe,oe&&rt.parentIndex>0?rt.parentIndex:null)}this.fillNonElevatedRoadSegment(Se)}}else for(let Se=0;Se<o.length;Se++)this.addLine(o[Se],n,g,q,Z,Q,ne,void 0,oe&&Se>0?Se:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,w,S,g,A,void 0,this.worldview)}computeSegNextDir(n,o){return n.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(n,o){return o[1].sub(n.prevPoint).unit()}clipLinesToTile(n,o){return Py(n,-o,-o,Ji+o,Ji+o)}clipRuntimeLinesToTile(n,o){const d=[];return[Py(n,-o,-o,Ji+o,Ji+o,d),d]}addElevatedRoadFeature(n,o,d,g,w,S,A,L){const N=[],q=Ts.getElevationFeature(n,g);if(q){const Z=this.clipLinesToTile(o,1),Q=this.prepareElevatedLines(Z,q,d);for(const ne of Q)N.push({geometry:ne,elevation:q,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(N.length===0)return!1;for(const Z of N){const Q=this.layoutVertexArray.length;this.addLine(Z.geometry,n,d,w,S,A,L);const ne=new zs(d,Z.elevationTileID);if(Z.elevation)for(let oe=Q;oe<this.layoutVertexArray.length;oe++){const me=new yi(this.layoutVertexArray.int16[6*oe]>>1,this.layoutVertexArray.int16[6*oe+1]>>1),Se=ne.pointElevation(me,Z.elevation,.05);this.updateHeightRange(Se),this.zOffsetVertexArray.emplaceBack(Se,0,0)}else this.fillNonElevatedRoadSegment(Q)}return!0}prepareElevatedLines(n,o,d){if(o.constantHeight!=null)return n;const g=[],w=1/Ae(d);for(const S of n)q2(S,new fs(o,w),0,g);return g}fillNonElevatedRoadSegment(n){for(let o=n;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(n){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,n),this.heightRange.max=Math.max(this.heightRange.max,n)):this.heightRange={min:n,max:n}}addLine(n,o,d,g,w,S,A,L,N){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=N?this.lineFeatureClips(o,N):this.lineClips;const q=g==="none";this.patternJoinNone=this.hasPattern&&q,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const Z=L&&L.progress.min>0,Q=L&&L.progress.max<1;if(this.lineClips){let Et={min:this.lineClips.start,max:this.lineClips.end},ai=1;if(L){const Ti=this.lineClips.end-this.lineClips.start;Et=(function(Si,Bi,ji){return{min:Br(Si.min,Bi,ji),max:Br(Si.max,Bi,ji)}})(L.progress,{min:0,max:1},Et),Ti>0&&(ai=(Et.max-Et.min)/Ti)}const kt=+o.properties.mapbox_clip_feature_len,fi=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(kt)||Number.isNaN(fi)){for(let Si=0;Si<n.length-1;Si++)this.totalDistance+=n[Si].dist(n[Si+1]);const Ti=this.totalDistance/(Et.max-Et.min);this.totalFeatureLength=Number.isFinite(Ti)?Ti:0,this.lineClips.start=Et.min,this.lineClips.end=Et.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=kt,this.distance=fi*ai,this.lineClips.start=Et.min,this.lineClips.end=Et.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const ne=By[o.type]==="Polygon";let oe=n.length;for(;oe>=2&&n[oe-1].equals(n[oe-2]);)oe--;let me=0;for(;me<oe-1&&n[me].equals(n[me+1]);)me++;if(oe<(ne?3:2))return;g==="bevel"&&(S=1.05);const Se=this.segments.prepareSegment(10*oe,this.layoutVertexArray,this.indexArray);let Te,Le,Re,Ue,rt,Qe,ht,yt;L&&L.prevDir&&(Qe=L.prevDir.perp()),L&&L.nextDir&&(ht=L.nextDir.perp()),this.e1=this.e2=-1,ne&&(Te=n[oe-2],rt=n[me].sub(Te)._unit()._perp());for(let Et=me;Et<oe;Et++){if(Re=Et===oe-1?ne?n[me+1]:void 0:n[Et+1],Re&&n[Et].equals(Re))continue;rt&&(Ue=rt),Te&&(Le=Te),Te=n[Et],yt=this.evaluateLineProgressFeatures(Le?Le.dist(Te):0),rt=Re?Re.sub(Te)._unit()._perp():Ue,Ue=Ue||rt;const ai=Le&&Re;let kt=ai?g:ne||q?"butt":w;const fi=Ue.x*rt.x+Ue.y*rt.y;if(q){const ui=function(Fi){if(Fi.patternJoinNone){const tn=Fi.segmentPoints.length/2,Xi=Fi.lineSoFar-Fi.segmentStart;for(let Vn=0;Vn<tn;++Vn){const _n=Fi.segmentPoints[2*Vn+1],In=Math.round(Fi.segmentPoints[2*Vn])+.5+.25*_n;Fi.patternVertexArray.emplaceBack(In,Xi,Fi.segmentStart),Fi.patternVertexArray.emplaceBack(In,Xi,Fi.segmentStart)}Fi.segmentPoints.length=0}Fi.e1=Fi.e2=-1};if(ai&&fi<tT){this.updateDistance(Le,Te),this.addCurrentVertex(Te,Ue,1,1,Se,yt),ui(this),this.addCurrentVertex(Te,rt,-1,-1,Se,yt);continue}if(Le){if(!Re){this.updateDistance(Le,Te),this.addCurrentVertex(Te,Ue,1,1,Se,yt),ui(this);continue}kt="miter"}}let Ti=Ue.add(rt);Ti.x===0&&Ti.y===0||Ti._unit();const Si=Ti.x*rt.x+Ti.y*rt.y,Bi=Si!==0?1/Si:1/0,ji=2*Math.sqrt(2-2*Si),zi=Si<eT&&Le&&Re,Oi=Ue.x*rt.y-Ue.y*rt.x>0,di=this.overscaling<=16?15*Ji/(512*this.overscaling):0;if(ai&&kt==="round"){if(Bi<A)kt="miter";else if(Bi<=2){const ui=ox(Te,-10,Ji+10);kt=this.elevationType==="offset"&&(ui||this.hasCrossSlope)?"miter":"fakeround"}}if(kt==="miter"&&Bi>S&&(kt="bevel"),kt==="bevel"&&(Bi>2&&(kt="flipbevel"),Bi<S&&(kt="miter")),Le&&!(kt==="miter"&&zi)&&this.updateDistance(Le,Te),kt==="miter")if(zi){const ui=Te.dist(Le);if(ui>2*di){const tn=Te.sub(Te.sub(Le)._mult(di/ui)._round());this.updateDistance(Le,tn),this.addCurrentVertex(tn,Ue,0,0,Se,yt),Le=tn}this.updateDistance(Le,Te),Ti._mult(Bi),this.addCurrentVertex(Te,Ti,0,0,Se,yt);const Fi=Te.dist(Re);if(Fi>2*di){const tn=Te.add(Re.sub(Te)._mult(di/Fi)._round());this.updateDistance(Te,tn),this.addCurrentVertex(tn,rt,0,0,Se,yt),Te=tn}}else Ti._mult(Bi),this.addCurrentVertex(Te,Ti,0,0,Se,yt);else if(kt==="flipbevel"){if(Bi>100)Ti=rt.mult(-1);else{const ui=Bi*Ue.add(rt).mag()/Ue.sub(rt).mag();Ti._perp()._mult(ui*(Oi?-1:1))}this.addCurrentVertex(Te,Ti,0,0,Se,yt),this.addCurrentVertex(Te,Ti.mult(-1),0,0,Se,yt)}else if(kt==="bevel"||kt==="fakeround"){yt!=null&&Le&&this.addCurrentVertex(Te,ht||Ue,-1,-1,Se,yt);const ui=Te.dist(Le)<=2*di&&kt!=="bevel",Fi=Ti.mult(Oi?1:-1);Fi._mult(Bi);const tn=rt.mult(Oi?-1:1),Xi=Ue.mult(Oi?-1:1),Vn=this.evaluateLineProgressFeatures(this.distance);if(yt==null&&(this.addHalfVertex(Te,Fi.x,Fi.y,!1,!Oi,0,Se,Vn),ui||this.addHalfVertex(Te,Fi.x+2*Xi.x,Fi.y+2*Xi.y,!1,Oi,0,Se,Vn)),kt==="fakeround"){const _n=Math.round(180*ji/Math.PI/20);this.addHalfVertex(Te,Xi.x,Xi.y,!1,Oi,0,Se,Vn);for(let In=0;In<_n;In++){let Dn=In/_n;if(Dn!==.5){const Ki=Dn-.5;Dn+=Dn*Ki*(Dn-1)*((1.0904+fi*(fi*(3.55645-1.43519*fi)-3.2452))*Ki*Ki+(.848013+fi*(.215638*fi-1.06021)))}const jr=tn.sub(Xi)._mult(Dn)._add(Xi)._unit();this.addHalfVertex(Te,jr.x,jr.y,!1,Oi,0,Se,Vn)}this.addHalfVertex(Te,tn.x,tn.y,!1,Oi,0,Se,Vn)}ui||yt!=null||this.addHalfVertex(Te,Fi.x+2*tn.x,Fi.y+2*tn.y,!1,Oi,0,Se,Vn),yt!=null&&Re&&this.addCurrentVertex(Te,Qe||rt,1,1,Se,yt)}else if(kt==="butt")this.addCurrentVertex(Te,Ti,0,0,Se,yt);else if(kt==="square"){if(!Le){const ui=Z?0:-1;this.addCurrentVertex(Te,Ti,ui,ui,Se,yt)}if(this.addCurrentVertex(Te,Ti,0,0,Se,yt),Le){const ui=Q?0:1;this.addCurrentVertex(Te,Ti,ui,ui,Se,yt)}}else if(kt==="round"){if(Le){const ui=!ai&&ht?ht:Ue;this.addCurrentVertex(Te,ui,0,0,Se,yt),!ai&&Q||this.addCurrentVertex(Te,ui,1,1,Se,yt,!0)}if(Re){const ui=!ai&&Qe?Qe:rt;!ai&&Z||this.addCurrentVertex(Te,ui,-1,-1,Se,yt,!0),this.addCurrentVertex(Te,ui,0,0,Se,yt)}}}}addVerticesTo(n,o,d,g,w,S,A,L,N,q){const Z=(o.w-n.w)/this.tessellationStep|0;let Q=0;const ne=this.scaledDistance;if(Z>1){this.lineSoFar=n.w;const me=(o.x-n.x)/Z,Se=(o.y-n.y)/Z,Te=(o.z-n.z)/Z,Le=(o.w-n.w)/Z;for(let Re=1;Re<Z;++Re){n.x+=me,n.y+=Se,n.z+=Te,this.lineSoFar+=Le,Q+=Le;const Ue=this.evaluateLineProgressFeatures(this.prevDistance+Q);this.scaledDistance=(this.prevDistance+Q)/this.totalDistance,this.addHalfVertex(n,d,g,q,!1,A,N,Ue),this.addHalfVertex(n,w,S,q,!0,-L,N,Ue)}}this.lineSoFar=o.w,this.scaledDistance=ne;const oe=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,d,g,q,!1,A,N,oe),this.addHalfVertex(o,w,S,q,!0,-L,N,oe)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):mn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:o}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(n,o,d,g,w,S,A=!1){const L=o.x+o.y*d,N=o.y-o.x*d,q=o.y*g-o.x,Z=-o.y-o.x*g;if(S!=null){const Q=this.elevationType==="offset",ne=-10,oe=Ji+10,me=S.zOffset,Se=new U2(n.x,n.y,me,this.lineSoFar),Te=!!Q&&ox(n,ne,oe),Le=this.lineSoFar,Re=this.distance;if(this.currentVertex)if(Te){const Ue=this.currentVertexIsOutside,rt=this.currentVertex,Qe=new U2(n.x,n.y,me,this.lineSoFar);if(G2(rt,Qe,ne,oe),!ox(Qe,ne,oe)){if(Ue){this.e1=this.e2=-1,this.distance-=rt.dist(Se),this.lineSoFar=rt.w;const ht=this.evaluateLineProgressFeatures(rt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(rt,L,N,A,!1,d,w,ht),this.addHalfVertex(rt,q,Z,A,!0,-g,w,ht),this.prevDistance=this.distance}this.distance=this.prevDistance+rt.dist(Qe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(rt,Qe,L,N,q,Z,d,g,w,A),this.distance=Re,this.scaledDistance=this.distance/this.totalDistance}}else{const Ue=this.currentVertex;if(this.currentVertexIsOutside){G2(Ue,Se,ne,oe),this.e1=this.e2=-1,this.distance-=Ue.dist(Se),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ue.w;const rt=this.evaluateLineProgressFeatures(Ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ue,L,N,A,!1,d,w,rt),this.addHalfVertex(Ue,q,Z,A,!0,-g,w,rt),this.prevDistance=this.distance,this.distance=Re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ue,Se,L,N,q,Z,d,g,w,A)}else Te||(this.addHalfVertex(n,L,N,A,!1,d,w,S),this.addHalfVertex(n,q,Z,A,!0,-g,w,S));this.currentVertex=Se,this.currentVertexIsOutside=Te,this.lineSoFar=Le}else this.addHalfVertex(n,L,N,A,!1,d,w,S),this.addHalfVertex(n,q,Z,A,!0,-g,w,S)}addHalfVertex({x:n,y:o},d,g,w,S,A,L,N){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),S||this.segmentPoints.push(this.lineSoFar-this.segmentStart,A)),this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(o<<1)+(S?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const Z=Gn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,Z)}const q=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),L.primitiveLength++),S?this.e2=q:this.e1=q,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,o){this.prevDistance=this.distance,this.distance+=n.dist(o),this.updateScaledDistance()}}function ox(a,n,o){return a.x<n||a.x>o||a.y<n||a.y>o}let ax,lx;function vp(a,n,o){return n*(Ji/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}Cn(sx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const f1=(a,n,o)=>(1-o)*a+o*n;function p1(a,n){return 1/vp(a,1,n.tileZoom)}function iT(a,n,o,d){return a.translatePosMatrix(d||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const nT=a=>{const n=[];rT(a)&&n.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=a.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const d=a.layout.get("line-join").constantOr("miter")==="none",g=!!a.paint.get("line-pattern").constantOr(1);return d&&g&&n.push("LINE_JOIN_NONE"),n};function rT(a){const n=a.paint.get("line-dasharray").value;return n.kind!=="constant"||n.value}let m1;const sT=()=>m1||(m1={layout:ax||(ax=new xe({"line-cap":new te(fe.layout_line["line-cap"]),"line-join":new te(fe.layout_line["line-join"]),"line-miter-limit":new K(fe.layout_line["line-miter-limit"]),"line-round-limit":new K(fe.layout_line["line-round-limit"]),"line-sort-key":new te(fe.layout_line["line-sort-key"]),"line-z-offset":new te(fe.layout_line["line-z-offset"]),"line-elevation-reference":new K(fe.layout_line["line-elevation-reference"]),"line-cross-slope":new K(fe.layout_line["line-cross-slope"]),visibility:new K(fe.layout_line.visibility),"line-width-unit":new K(fe.layout_line["line-width-unit"])})),paint:lx||(lx=new xe({"line-opacity":new te(fe.paint_line["line-opacity"]),"line-color":new te(fe.paint_line["line-color"]),"line-translate":new K(fe.paint_line["line-translate"]),"line-translate-anchor":new K(fe.paint_line["line-translate-anchor"]),"line-width":new te(fe.paint_line["line-width"]),"line-gap-width":new te(fe.paint_line["line-gap-width"]),"line-offset":new te(fe.paint_line["line-offset"]),"line-blur":new te(fe.paint_line["line-blur"]),"line-dasharray":new te(fe.paint_line["line-dasharray"]),"line-pattern":new te(fe.paint_line["line-pattern"]),"line-pattern-cross-fade":new K(fe.paint_line["line-pattern-cross-fade"]),"line-gradient":new ge(fe.paint_line["line-gradient"]),"line-trim-offset":new K(fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new K(fe.paint_line["line-trim-fade-range"]),"line-trim-color":new K(fe.paint_line["line-trim-color"]),"line-emissive-strength":new te(fe.paint_line["line-emissive-strength"]),"line-border-width":new te(fe.paint_line["line-border-width"]),"line-border-color":new te(fe.paint_line["line-border-color"]),"line-occlusion-opacity":new K(fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},m1);class SI extends te{possiblyEvaluate(n,o){return o=new Us(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(n,o)}evaluate(n,o,d,g){return o=Object.assign({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,d,g)}}let $0;function oT(a,n){return n>0?n+2*a:a}const Rf=hr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cx=hr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aT=hr([{name:"a_projected_pos",components:4,type:"Float32"}],4);hr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const EI=hr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),II=hr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),CI=hr([{name:"a_texb",components:2,type:"Uint16"}]),Qc=hr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ed=hr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);hr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mg=hr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zf=hr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hr([{name:"triangle",components:3,type:"Uint16"}]),hr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),hr([{type:"Float32",name:"offsetX"}]),hr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ca=24;function xp(a,n,o){return a.sections.forEach((d=>{d.text=(function(g,w,S){const A=w.layout.get("text-transform").evaluate(S,{});return A==="uppercase"?g=g.toLocaleUpperCase():A==="lowercase"&&(g=g.toLocaleLowerCase()),mu.applyArabicShaping&&(g=mu.applyArabicShaping(g)),g})(d.text,n,o)})),a}const g1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Bj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function Nj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const AI=4294967296,xk=1/AI,bk=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let lT=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,n,o=this.length){for(;this.pos<o;){const d=this.readVarint(),g=d>>3,w=this.pos;this.type=7&d,a(g,n,this),this.pos===w&&this.skip(d)}return n}readMessage(a,n){return this.readFields(a,n,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*AI;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*AI;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const n=this.buf;let o,d;return d=n[this.pos++],o=127&d,d<128?o:(d=n[this.pos++],o|=(127&d)<<7,d<128?o:(d=n[this.pos++],o|=(127&d)<<14,d<128?o:(d=n[this.pos++],o|=(127&d)<<21,d<128?o:(d=n[this.pos],o|=(15&d)<<28,(function(g,w,S){const A=S.buf;let L,N;if(N=A[S.pos++],L=(112&N)>>4,N<128||(N=A[S.pos++],L|=(127&N)<<3,N<128)||(N=A[S.pos++],L|=(127&N)<<10,N<128)||(N=A[S.pos++],L|=(127&N)<<17,N<128)||(N=A[S.pos++],L|=(127&N)<<24,N<128)||(N=A[S.pos++],L|=(1&N)<<31,N<128))return ux(g,L,w);throw new Error("Expected varint not more than 10 bytes")})(o,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,n=this.pos;return this.pos=a,a-n>=12&&bk?bk.decode(this.buf.subarray(n,a)):(function(o,d,g){let w="",S=d;for(;S<g;){const A=o[S];let L,N,q,Z=null,Q=A>239?4:A>223?3:A>191?2:1;if(S+Q>g)break;Q===1?A<128&&(Z=A):Q===2?(L=o[S+1],(192&L)==128&&(Z=(31&A)<<6|63&L,Z<=127&&(Z=null))):Q===3?(L=o[S+1],N=o[S+2],(192&L)==128&&(192&N)==128&&(Z=(15&A)<<12|(63&L)<<6|63&N,(Z<=2047||Z>=55296&&Z<=57343)&&(Z=null))):Q===4&&(L=o[S+1],N=o[S+2],q=o[S+3],(192&L)==128&&(192&N)==128&&(192&q)==128&&(Z=(15&A)<<18|(63&L)<<12|(63&N)<<6|63&q,(Z<=65535||Z>=1114112)&&(Z=null))),Z===null?(Z=65533,Q=1):Z>65535&&(Z-=65536,w+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),w+=String.fromCharCode(Z),S+=Q}return w})(this.buf,n,a)}readBytes(){const a=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,a);return this.pos=a,n}readPackedVarint(a=[],n){const o=this.readPackedEnd();for(;this.pos<o;)a.push(this.readVarint(n));return a}readPackedSVarint(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const n=this.readPackedEnd();for(;this.pos<n;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const n=7&a;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(a,n){this.writeVarint(a<<3|n)}realloc(a){let n=this.length||16;for(;n<this.pos+a;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*xk),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*xk),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(n,o){let d,g;if(n>=0?(d=n%4294967296|0,g=n/4294967296|0):(d=~(-n%4294967296),g=~(-n/4294967296),4294967295^d?d=d+1|0:(d=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(w,S,A){A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,A.buf[A.pos]=127&(w>>>=7)})(d,0,o),(function(w,S){const A=(7&w)<<4;S.buf[S.pos++]|=A|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))})(g,o)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const n=this.pos;this.pos=(function(d,g,w){for(let S,A,L=0;L<g.length;L++){if(S=g.charCodeAt(L),S>55295&&S<57344){if(!A){S>56319||L+1===g.length?(d[w++]=239,d[w++]=191,d[w++]=189):A=S;continue}if(S<56320){d[w++]=239,d[w++]=191,d[w++]=189,A=S;continue}S=A-55296<<10|S-56320|65536,A=null}else A&&(d[w++]=239,d[w++]=191,d[w++]=189,A=null);S<128?d[w++]=S:(S<2048?d[w++]=S>>6|192:(S<65536?d[w++]=S>>12|224:(d[w++]=S>>18|240,d[w++]=S>>12&63|128),d[w++]=S>>6&63|128),d[w++]=63&S|128)}return w})(this.buf,a,this.pos);const o=this.pos-n;o>=128&&wk(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const n=a.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=a[o]}writeRawMessage(a,n){this.pos++;const o=this.pos;a(n,this);const d=this.pos-o;d>=128&&wk(o,d,this),this.pos=o-1,this.writeVarint(d),this.pos+=d}writeMessage(a,n,o){this.writeTag(a,2),this.writeRawMessage(n,o)}writePackedVarint(a,n){n.length&&this.writeMessage(a,Vj,n)}writePackedSVarint(a,n){n.length&&this.writeMessage(a,jj,n)}writePackedBoolean(a,n){n.length&&this.writeMessage(a,Gj,n)}writePackedFloat(a,n){n.length&&this.writeMessage(a,Uj,n)}writePackedDouble(a,n){n.length&&this.writeMessage(a,$j,n)}writePackedFixed32(a,n){n.length&&this.writeMessage(a,qj,n)}writePackedSFixed32(a,n){n.length&&this.writeMessage(a,Hj,n)}writePackedFixed64(a,n){n.length&&this.writeMessage(a,Wj,n)}writePackedSFixed64(a,n){n.length&&this.writeMessage(a,Zj,n)}writeBytesField(a,n){this.writeTag(a,2),this.writeBytes(n)}writeFixed32Field(a,n){this.writeTag(a,5),this.writeFixed32(n)}writeSFixed32Field(a,n){this.writeTag(a,5),this.writeSFixed32(n)}writeFixed64Field(a,n){this.writeTag(a,1),this.writeFixed64(n)}writeSFixed64Field(a,n){this.writeTag(a,1),this.writeSFixed64(n)}writeVarintField(a,n){this.writeTag(a,0),this.writeVarint(n)}writeSVarintField(a,n){this.writeTag(a,0),this.writeSVarint(n)}writeStringField(a,n){this.writeTag(a,2),this.writeString(n)}writeFloatField(a,n){this.writeTag(a,5),this.writeFloat(n)}writeDoubleField(a,n){this.writeTag(a,1),this.writeDouble(n)}writeBooleanField(a,n){this.writeVarintField(a,+n)}};function ux(a,n,o){return o?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function wk(a,n,o){const d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(d);for(let g=o.pos-1;g>=a;g--)o.buf[g+d]=o.buf[g]}function Vj(a,n){for(let o=0;o<a.length;o++)n.writeVarint(a[o])}function jj(a,n){for(let o=0;o<a.length;o++)n.writeSVarint(a[o])}function Uj(a,n){for(let o=0;o<a.length;o++)n.writeFloat(a[o])}function $j(a,n){for(let o=0;o<a.length;o++)n.writeDouble(a[o])}function Gj(a,n){for(let o=0;o<a.length;o++)n.writeBoolean(a[o])}function qj(a,n){for(let o=0;o<a.length;o++)n.writeFixed32(a[o])}function Hj(a,n){for(let o=0;o<a.length;o++)n.writeSFixed32(a[o])}function Wj(a,n){for(let o=0;o<a.length;o++)n.writeFixed64(a[o])}function Zj(a,n){for(let o=0;o<a.length;o++)n.writeSFixed64(a[o])}const PI=3;function Xj(a,n,o){n.glyphs=[],a===1&&o.readMessage(Yj,n)}function Yj(a,n,o){if(a===3){const{id:d,bitmap:g,width:w,height:S,left:A,top:L,advance:N}=o.readMessage(Kj,{});n.glyphs.push({id:d,bitmap:new dg({width:w+2*PI,height:S+2*PI},g),metrics:{width:w,height:S,left:A,top:L,advance:N}})}else a===4?n.ascender=o.readSVarint():a===5&&(n.descender=o.readSVarint())}function Kj(a,n,o){a===1?n.id=o.readVarint():a===2?n.bitmap=o.readBytes():a===3?n.width=o.readVarint():a===4?n.height=o.readVarint():a===5?n.left=o.readSVarint():a===6?n.top=o.readSVarint():a===7&&(n.advance=o.readVarint())}const Tk=PI,td={horizontal:1,vertical:2,horizontalOnly:3};class _1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,o){const d=new _1;return d.scale=n||1,d.fontStack=o,d}static forImage(n){const o=new _1;return o.image=n,o}}class hx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o,d){const g=new hx;for(let w=0;w<n.sections.length;w++){const S=n.sections[w];S.image?g.addImageSection(S,d):g.addTextSection(S,o)}return g}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=(function(o,d){let g="";for(let w=0;w<o.length;w++){const S=o.charCodeAt(w+1)||null,A=o.charCodeAt(w-1)||null;g+=!d&&(S&&up(S)&&!g1[o[w+1]]||A&&up(A)&&!g1[o[w-1]])||!g1[o[w]]?o[w]:g1[o[w]]}return g})(this.text,n)}trim(){let n=0;for(let d=0;d<this.text.length&&cT[this.text.charCodeAt(d)];d++)n++;let o=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&cT[this.text.charCodeAt(d)];d--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const d=new hx;return d.text=this.text.substring(n,o),d.sectionIndex=this.sectionIndex.slice(n,o),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((n,o)=>Math.max(n,this.sections[o].scale)),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(_1.forText(n.scale,n.fontStack||o));const d=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(d)}addImageSection(n,o){const d=n.image?n.image.getPrimary():null;if(!d)return void mn("Can't add FormattedSection with an empty image.");d.scaleSelf(o);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(_1.forImage(d)),this.sectionIndex.push(this.sections.length-1)):mn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function MI(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me=1){const Se=hx.fromFeature(a,g,me);Z===td.vertical&&Se.verticalizePunctuation(Q);let Te=[];const Le=(function(ht,yt,Et,ai,kt,fi){if(!ht)return[];const Ti=[],Si=(function(Oi,di,ui,Fi,tn,Xi){let Vn=0;for(let _n=0;_n<Oi.length();_n++){const In=Oi.getSection(_n);Vn+=Sk(Oi.getCodePoint(_n),In,Fi,tn,di,Xi)}return Vn/Math.max(1,Math.ceil(Vn/ui))})(ht,yt,Et,ai,kt,fi),Bi=ht.text.indexOf("")>=0;let ji=0;for(let Oi=0;Oi<ht.length();Oi++){const di=ht.getSection(Oi),ui=ht.getCodePoint(Oi);if(cT[ui]||(ji+=Sk(ui,di,ai,kt,yt,fi)),Oi<ht.length()-1){const Fi=!((zi=ui)<11904||!(Hn["Bopomofo Extended"](zi)||Hn.Bopomofo(zi)||Hn["CJK Compatibility Forms"](zi)||Hn["CJK Compatibility Ideographs"](zi)||Hn["CJK Compatibility"](zi)||Hn["CJK Radicals Supplement"](zi)||Hn["CJK Strokes"](zi)||Hn["CJK Symbols and Punctuation"](zi)||Hn["CJK Unified Ideographs Extension A"](zi)||Hn["CJK Unified Ideographs"](zi)||Hn["Enclosed CJK Letters and Months"](zi)||Hn["Halfwidth and Fullwidth Forms"](zi)||Hn.Hiragana(zi)||Hn["Ideographic Description Characters"](zi)||Hn["Kangxi Radicals"](zi)||Hn["Katakana Phonetic Extensions"](zi)||Hn.Katakana(zi)||Hn["Vertical Forms"](zi)||Hn["Yi Radicals"](zi)||Hn["Yi Syllables"](zi)));(Jj[ui]||Fi||di.image)&&Ti.push(Ik(Oi+1,ji,Si,Ti,Qj(ui,ht.getCodePoint(Oi+1),Fi&&Bi),!1))}}var zi;return Ck(Ik(ht.length(),ji,Si,Ti,0,!0))})(Se,N,w,n,d,ne),{processBidirectionalText:Re,processStyledBidirectionalText:Ue}=mu;if(Re&&Se.sections.length===1){const ht=Re(Se.toString(),Le);for(const yt of ht){const Et=new hx;Et.text=yt,Et.sections=Se.sections;for(let ai=0;ai<yt.length;ai++)Et.sectionIndex.push(0);Te.push(Et)}}else if(Ue){const ht=Ue(Se.text,Se.sectionIndex,Le);for(const yt of ht){const Et=new hx;Et.text=yt[0],Et.sectionIndex=yt[1],Et.sections=Se.sections,Te.push(Et)}}else Te=(function(ht,yt){const Et=[],ai=ht.text;let kt=0;for(const fi of yt)Et.push(ht.substring(kt,fi)),kt=fi;return kt<ai.length&&Et.push(ht.substring(kt,ai.length)),Et})(Se,Le);const rt=[],Qe={positionedLines:rt,text:Se.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:Z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(ht,yt,Et,ai,kt,fi,Ti,Si,Bi,ji,zi,Oi){let di=0,ui=0,Fi=0;const tn=Si==="right"?1:Si==="left"?0:.5;let Xi=!1;for(const Ki of kt){const Rn=Ki.getSections();for(const wr of Rn){if(wr.image)continue;const os=yt[wr.fontStack];if(os&&(Xi=os.ascender!==void 0&&os.descender!==void 0,!Xi))break}if(!Xi)break}let Vn=0;for(const Ki of kt){Ki.trim();const Rn=Ki.getMaxScale(),wr=(Rn-1)*ca,os={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Vn]=os;const ds=os.positionedGlyphs;let Mr=0;if(!Ki.length()){ui+=fi,++Vn;continue}let Ys=0,et=0;for(let pi=0;pi<Ki.length();pi++){const Ni=Ki.getSection(pi),dn=Ki.getSectionIndex(pi),fn=Ki.getCodePoint(pi);let Un=Ni.scale,Wn=null,Ir=null,zr=null,Vr=ca,rs=0,cr=Bi;cr===td.vertical&&((_n=fn)===12312||_n===12313||_n===12316||_n===12540||_n===12448)&&(cr=td.horizontal);const xr=!(cr===td.horizontal||!zi&&!Ef(fn)||zi&&(cT[fn]||Ld(fn)));if(Ni.image){const gs=ai.get(Ni.image.toString());if(!gs)continue;zr=Ni.image,ht.iconsInText=ht.iconsInText||!0,Ir=gs.paddedRect;const Es=gs.displaySize;Un=Un*ca/Oi,Wn={width:Es[0],height:Es[1],left:0,top:-Tk,advance:xr?Es[1]:Es[0],localGlyph:!1},rs=Xi?-Wn.height*Un:Rn*ca-17-Es[1]*Un,Vr=Wn.advance;const Is=(xr?Es[0]:Es[1])*Un-ca*Rn;Is>0&&Is>Mr&&(Mr=Is)}else{const gs=Et[Ni.fontStack];if(!gs)continue;gs[fn]&&(Ir=gs[fn]);const Es=yt[Ni.fontStack];if(!Es)continue;const Is=Es.glyphs[fn];if(!Is)continue;if(Wn=Is.metrics,Vr=fn!==8203?ca:0,Xi){const $s=Es.ascender!==void 0?Math.abs(Es.ascender):0,to=Es.descender!==void 0?Math.abs(Es.descender):0,Ks=($s+to)*Un;Ys<Ks&&(Ys=Ks,et=($s-to)/2*Un),rs=-$s*Un}else rs=(Rn-Un)*ca-17}xr?(ht.verticalizable=!0,ds.push({glyph:fn,image:zr,x:di,y:ui+rs,vertical:xr,scale:Un,localGlyph:Wn.localGlyph,fontStack:Ni.fontStack,sectionIndex:dn,metrics:Wn,rect:Ir}),di+=Vr*Un+ji):(ds.push({glyph:fn,image:zr,x:di,y:ui+rs,vertical:xr,scale:Un,localGlyph:Wn.localGlyph,fontStack:Ni.fontStack,sectionIndex:dn,metrics:Wn,rect:Ir}),di+=Wn.advance*Un+ji)}ds.length!==0&&(Fi=Math.max(di-ji,Fi),Xi?Ak(ds,tn,Mr,et,fi*Rn/2):Ak(ds,tn,Mr,0,fi/2)),di=0;const st=fi*Rn+Mr;os.lineOffset=Math.max(Mr,wr),ui+=st,++Vn}var _n;const In=ui,{horizontalAlign:Dn,verticalAlign:jr}=kI(Ti);(function(Ki,Rn,wr,os,ds,Mr){const Ys=(Rn-wr)*ds,et=-Mr*os;for(const st of Ki)for(const pi of st.positionedGlyphs)pi.x+=Ys,pi.y+=et})(ht.positionedLines,tn,Dn,jr,Fi,In),ht.top+=-jr*In,ht.bottom=ht.top+In,ht.left+=-Dn*Fi,ht.right=ht.left+Fi,ht.hasBaseline=Xi})(Qe,n,o,d,Te,S,A,L,Z,N,Q,oe),!(function(ht){for(const yt of ht)if(yt.positionedGlyphs.length!==0)return!1;return!0})(rt))return Qe}const cT={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jj={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sk(a,n,o,d,g,w){if(n.image){const S=d.get(n.image.toString());return S?S.displaySize[0]*n.scale*ca/w+g:0}{const S=o[n.fontStack],A=S&&S.glyphs[a];return A?A.metrics.advance*n.scale+g:0}}function Ek(a,n,o,d){const g=Math.pow(a-n,2);return d?a<n?g/2:2*g:g+Math.abs(o)*o}function Qj(a,n,o){let d=0;return a===10&&(d-=1e4),o&&(d+=150),a!==40&&a!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function Ik(a,n,o,d,g,w){let S=null,A=Ek(n,o,g,w);for(const L of d){const N=Ek(n-L.x,o,g,w)+L.badness;N<=A&&(S=L,A=N)}return{index:a,x:n,priorBreak:S,badness:A}}function Ck(a){return a?Ck(a.priorBreak).concat(a.index):[]}function kI(a){let n=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function Ak(a,n,o,d,g){if(!(n||o||d||g))return;const w=a.length-1,S=a[w],A=(S.x+S.metrics.advance*S.scale)*n;for(let L=0;L<=w;L++)a[L].x-=A,a[L].y+=o+d+g}function DI(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function uT(a,n,o,d){const{horizontalAlign:g,verticalAlign:w}=kI(d),S=o[0]-a.displaySize[0]*g,A=o[1]-a.displaySize[1]*w;return{imagePrimary:a,imageSecondary:n,top:A,bottom:A+a.displaySize[1],left:S,right:S+a.displaySize[0]}}function LI(a,n,o,d,g,w){const S=a.imagePrimary;let A;if(S.content){const Se=S.content,Te=S.pixelRatio||1;A=[Se[0]/Te,Se[1]/Te,S.displaySize[0]-Se[2]/Te,S.displaySize[1]-Se[3]/Te]}const L=n.left*w,N=n.right*w;let q,Z,Q,ne;o==="width"||o==="both"?(ne=g[0]+L-d[3],Z=g[0]+N+d[1]):(ne=g[0]+(L+N-S.displaySize[0])/2,Z=ne+S.displaySize[0]);const oe=n.top*w,me=n.bottom*w;return o==="height"||o==="both"?(q=g[1]+oe-d[0],Q=g[1]+me+d[2]):(q=g[1]+(oe+me-S.displaySize[1])/2,Q=q+S.displaySize[1]),{imagePrimary:S,imageSecondary:void 0,top:q,right:Z,bottom:Q,left:ne,collisionPadding:A}}function Pk(a){return!a.imagePrimary.stretchX}function Mk(a){return!a.imagePrimary.stretchY}function kk(a){return{width:a.right-a.left,height:a.bottom-a.top}}const um=128;function dx(a,n,o){const{expression:d}=n;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Us(a+1,{worldview:o}))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:w}=d;let S=0;for(;S<g.length&&g[S]<=a;)S++;S=Math.max(0,S-1);let A=S;for(;A<g.length&&g[A]<a+1;)A++;A=Math.min(g.length-1,A);const L=g[S],N=g[A];return d.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:N,interpolationType:w}:{kind:"camera",minZoom:L,maxZoom:N,minSize:d.evaluate(new Us(L,{worldview:o})),maxSize:d.evaluate(new Us(N,{worldview:o})),interpolationType:w}}}function RI(a,{uSize:n,uSizeT:o},{lowerSize:d,upperSize:g}){return a.kind==="source"?d/um:a.kind==="composite"?Gn(d/um,g/um,o):n}function fx(a,n,o=1){let d=0,g=0;if(a.kind==="constant")g=a.layoutSize*o;else if(a.kind!=="source"){const{interpolationType:w,minZoom:S,maxZoom:A}=a,L=w?we(fc.interpolationFactor(w,n,S,A),0,1):0;a.kind==="camera"?g=Gn(a.minSize,a.maxSize,L)*o:d=L*o}return{uSizeT:d,uSize:g}}class E_ extends yi{constructor(n,o,d,g,w){super(n,o),this.angle=g,this.z=d,w!==void 0&&(this.segment=w)}clone(){return new E_(this.x,this.y,this.z,this.angle,this.segment)}}function Dk(a,n,o,d,g){if(n.segment===void 0)return!0;let w=n,S=n.segment+1,A=0;for(;A>-o/2;){if(S--,S<0)return!1;A-=a[S].dist(w),w=a[S]}A+=a[S].dist(a[S+1]),S++;const L=[];let N=0;for(;A<o/2;){const q=a[S],Z=a[S+1];if(!Z)return!1;let Q=a[S-1].angleTo(q)-q.angleTo(Z);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:A,angleDelta:Q}),N+=Q;A-L[0].distance>d;)N-=L.shift().angleDelta;if(N>g)return!1;S++,A+=q.dist(Z)}return!0}function Lk(a){let n=0;for(let o=0;o<a.length-1;o++)n+=a[o].dist(a[o+1]);return n}function Rk(a,n,o){return a?.6*n*o:0}function zk(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function e8(a,n,o,d,g,w){const S=Rk(o,g,w),A=zk(o,d)*w;let L=0;const N=Lk(a)/2;for(let q=0;q<a.length-1;q++){const Z=a[q],Q=a[q+1],ne=Z.dist(Q);if(L+ne>N){const oe=(N-L)/ne,me=Gn(Z.x,Q.x,oe),Se=Gn(Z.y,Q.y,oe),Te=new E_(me,Se,0,Q.angleTo(Z),q);return!S||Dk(a,Te,A,S,n)?Te:void 0}L+=ne}}function t8(a,n,o,d,g,w,S,A,L){const N=Rk(d,w,S),q=zk(d,g),Z=q*S,Q=a[0].x===0||a[0].x===L||a[0].y===0||a[0].y===L;return n-Z<n/4&&(n=Z+n/4),Ok(a,Q?n/2*A%n:(q/2+2*w)*S*A%n,n,N,o,Z,Q,!1,L)}function Ok(a,n,o,d,g,w,S,A,L){const N=w/2,q=Lk(a);let Z=0,Q=n-o,ne=[];for(let oe=0;oe<a.length-1;oe++){const me=a[oe],Se=a[oe+1],Te=me.dist(Se),Le=Se.angleTo(me);for(;Q+o<Z+Te;){Q+=o;const Re=(Q-Z)/Te,Ue=Gn(me.x,Se.x,Re),rt=Gn(me.y,Se.y,Re);if(Ue>=0&&Ue<L&&rt>=0&&rt<L&&Q-N>=0&&Q+N<=q){const Qe=new E_(Ue,rt,0,Le,oe);d&&!Dk(a,Qe,w,d,g)||ne.push(Qe)}}Z+=Te}return A||ne.length||S||(ne=Ok(a,Z/2,o,d,g,w,S,!0,L)),ne}function Fk(a){let n=0,o=0;for(const S of a)n+=S.w*S.h,o=Math.max(o,S.w);a.sort(((S,A)=>A.h-S.h));const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let g=0,w=0;for(const S of a)for(let A=d.length-1;A>=0;A--){const L=d[A];if(!(S.w>L.w||S.h>L.h)){if(S.x=L.x,S.y=L.y,w=Math.max(w,S.y+S.h),g=Math.max(g,S.x+S.w),S.w===L.w&&S.h===L.h){const N=d.pop();N&&A<d.length&&(d[A]=N)}else S.h===L.h?(L.x+=S.w,L.w-=S.w):S.w===L.w?(L.y+=S.h,L.h-=S.h):(d.push({x:L.x+S.w,y:L.y,w:L.w-S.w,h:S.h}),L.y+=S.h,L.h-=S.h);break}}return{w:g,h:w,fill:n/(g*w)||0}}Cn(E_,"Anchor");const G0=1;class y1{static getImagePositionScale(n,o,d){if(o&&n){const{sx:g,sy:w}=n;return{x:g,y:w}}return{x:d,y:d}}constructor(n,o,d,g){this.paddedRect=n;const{pixelRatio:w,version:S,stretchX:A,stretchY:L,content:N,sdf:q,usvg:Z}=o;this.pixelRatio=w,this.stretchX=A,this.stretchY=L,this.content=N,this.version=S,this.padding=d,this.sdf=q,this.usvg=Z,this.scale=y1.getImagePositionScale(g,Z,w)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function zI(a,n,o){const d=Fh.parse(a),g=(function(w,S,A=[1,1]){return{x:0,y:0,w:(w.data?w.data.width:w.width*A[0])+2*S,h:(w.data?w.data.height:w.height*A[1])+2*S}})(n,o,[d.sx,d.sy]);return{bin:g,imagePosition:new y1(g,n,o,d),imageVariant:d}}class Bk{constructor(n,o,d){const g=new Map,w=new Map;this.haveRenderCallbacks=[];const S=[];this.addImages(n,g,G0,S),this.addImages(o,w,2,S);const{w:A,h:L}=Fk(S),N=new ic({width:A||1,height:L||1});for(const[q,Z]of n.entries()){const Q=g.get(q).paddedRect;ic.copy(Z.data,N,{x:0,y:0},{x:Q.x+G0,y:Q.y+G0},Z.data,null,Z.sdf)}for(const[q,Z]of o.entries()){const Q=w.get(q),ne=Q.paddedRect;let oe=Q.padding;const me=ne.x+oe,Se=ne.y+oe,Te=Z.data.width,Le=Z.data.height;oe=oe>1?oe-1:oe,ic.copy(Z.data,N,{x:0,y:0},{x:me,y:Se},Z.data,d),ic.copy(Z.data,N,{x:0,y:Le-oe},{x:me,y:Se-oe},{width:Te,height:oe},d),ic.copy(Z.data,N,{x:0,y:0},{x:me,y:Se+Le},{width:Te,height:oe},d),ic.copy(Z.data,N,{x:Te-oe,y:0},{x:me-oe,y:Se},{width:oe,height:Le},d),ic.copy(Z.data,N,{x:0,y:0},{x:me+Te,y:Se},{width:oe,height:Le},d),ic.copy(Z.data,N,{x:Te-oe,y:Le-oe},{x:me-oe,y:Se-oe},{width:oe,height:oe},d),ic.copy(Z.data,N,{x:0,y:Le-oe},{x:me+Te,y:Se-oe},{width:oe,height:oe},d),ic.copy(Z.data,N,{x:0,y:0},{x:me+Te,y:Se+Le},{width:oe,height:oe},d),ic.copy(Z.data,N,{x:Te-oe,y:0},{x:me-oe,y:Se+Le},{width:oe,height:oe},d)}this.lut=d,this.image=N,this.iconPositions=g,this.patternPositions=w}addImages(n,o,d,g){for(const[w,S]of n.entries()){const{bin:A,imagePosition:L,imageVariant:N}=zI(w,S,d);o.set(w,L),g.push(A),S.hasRenderCallback&&this.haveRenderCallbacks.push(N.id)}}patchUpdatedImages(n,o,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((g=>n.hasImage(g,d))),n.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const g of n.getUpdatedImages(d)){for(const w of this.iconPositions.keys()){const S=Fh.parse(w);if(Jo.isEqual(S.id,g)){const A=n.getImage(g,d);this.patchUpdatedImage(this.iconPositions.get(w),A,o,null)}}for(const w of this.patternPositions.keys()){const S=Fh.parse(w);if(Jo.isEqual(S.id,g)){const A=n.getImage(g,d);this.patchUpdatedImage(this.patternPositions.get(w),A,o,this.lut)}}}}patchUpdatedImage(n,o,d,g=null){if(!n||!o||n.version===o.version)return;n.version=o.version;const[w,S]=n.tl,A=n.sdf;if(this.lut||A){const L={width:o.data.width,height:o.data.height},N=new ic(L);ic.copy(o.data,N,{x:0,y:0},{x:0,y:0},L,g,A),d.update(N,{position:{x:w,y:S}})}else d.update(o.data,{position:{x:w,y:S}})}}Cn(y1,"ImagePosition"),Cn(Bk,"ImageAtlas");const v1=1e20;function Nk(a,n,o,d,g,w,S,A,L){for(let N=n;N<n+d;N++)Vk(a,o*w+N,w,g,S,A,L);for(let N=o;N<o+g;N++)Vk(a,N*w+n,1,d,S,A,L)}function Vk(a,n,o,d,g,w,S){w[0]=0,S[0]=-v1,S[1]=v1,g[0]=a[n];for(let A=1,L=0,N=0;A<d;A++){g[A]=a[n+A*o];const q=A*A;do{const Z=w[L];N=(g[A]-g[Z]+q-Z*Z)/(A-Z)/2}while(N<=S[L]&&--L>-1);L++,w[L]=A,S[L]=N,S[L+1]=v1}for(let A=0,L=0;A<d;A++){for(;S[L+1]<A;)L++;const N=w[L],q=A-N;a[n+A*o]=g[N]+q*q}}const hm=2,OI={none:0,ideographs:1,all:2};class px{constructor(n,o,d){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,o){const d=[],g=this.url||qr.GLYPHS_URL;for(const w in n)for(const S of n[w])d.push({stack:w,id:S});ot(d,(({stack:w,id:S},A)=>{let L=this.entries[w];L||(L=this.entries[w]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=L.glyphs[S];if(N!==void 0)return void A(null,{stack:w,id:S,glyph:N});if(N=this._tinySDF(L,w,S),N)return L.glyphs[S]=N,void A(null,{stack:w,id:S,glyph:N});const q=Math.floor(S/256);if(256*q>65535)return mn("glyphs > 65535 not supported"),void A(null,{stack:w,id:S,glyph:N});if(L.ranges[q])return void A(null,{stack:w,id:S,glyph:N});let Z=L.requests[q];Z||(Z=L.requests[q]=[],px.loadGlyphRange(w,q,g,this.requestManager,((Q,ne)=>{if(ne){L.ascender=ne.ascender,L.descender=ne.descender;for(const oe in ne.glyphs)this._doesCharSupportLocalGlyph(+oe)||(L.glyphs[+oe]=ne.glyphs[+oe]);L.ranges[q]=!0}for(const oe of Z)oe(Q,ne);delete L.requests[q]}))),Z.push(((Q,ne)=>{Q?A(Q):ne&&A(null,{stack:w,id:S,glyph:ne.glyphs[S]||null})}))}),((w,S)=>{if(w)o(w);else if(S){const A={};for(const{stack:L,id:N,glyph:q}of S)A[L]===void 0&&(A[L]={}),A[L].glyphs===void 0&&(A[L].glyphs={}),A[L].glyphs[N]=q&&{id:q.id,bitmap:q.bitmap.clone(),metrics:q.metrics},A[L].ascender=this.entries[L].ascender,A[L].descender=this.entries[L].descender;o(null,A)}}))}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==OI.none&&(this.localGlyphMode===OI.all?!!this.localFontFamily:!!this.localFontFamily&&(Hn["CJK Unified Ideographs"](n)||Hn["Hangul Syllables"](n)||Hn.Hiragana(n)||Hn.Katakana(n)||Hn["CJK Symbols and Punctuation"](n)||Hn["CJK Unified Ideographs Extension A"](n)||Hn["CJK Unified Ideographs Extension B"](n)||Hn.Osage(n)))}_tinySDF(n,o,d){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let w=n.tinySDF;if(!w){let me="400";/bold/i.test(o)?me="900":/medium/i.test(o)?me="500":/light/i.test(o)&&(me="200"),w=n.tinySDF=new px.TinySDF({fontFamily:g,fontWeight:me,fontSize:24*hm,buffer:3*hm,radius:8*hm}),w.fontWeight=me}if(this.localGlyphs[w.fontWeight][d])return this.localGlyphs[w.fontWeight][d];const S=String.fromCodePoint(d),{data:A,width:L,height:N,glyphWidth:q,glyphHeight:Z,glyphLeft:Q,glyphTop:ne,glyphAdvance:oe}=w.draw(S);return this.localGlyphs[w.fontWeight][d]={id:d,bitmap:new dg({width:L,height:N},A),metrics:{width:q/hm,height:Z/hm,left:Q/hm,top:ne/hm-27,advance:oe/hm,localGlyph:!0}}}}px.loadGlyphRange=function(a,n,o,d,g){const w=256*n,S=w+255,A=d.transformRequest(d.normalizeGlyphsURL(o).replace("{fontstack}",a).replace("{range}",`${w}-${S}`),ou.Glyphs);Tc(A,((L,N)=>{if(L)g(L);else if(N){const q={},Z=(function(Q){return new lT(Q).readFields(Xj,{})})(N);for(const Q of Z.glyphs)q[Q.id]=Q;g(null,{glyphs:q,ascender:Z.ascender,descender:Z.descender})}}))},px.TinySDF=class{constructor({fontSize:a=24,buffer:n=3,radius:o=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:w="normal",fontStyle:S="normal",lang:A=null}={}){this.buffer=n,this.cutoff=d,this.radius=o,this.lang=A;const L=this.size=a+4*n,N=this._createCanvas(L),q=this.ctx=N.getContext("2d",{willReadFrequently:!0});q.font=`${S} ${w} ${a}px ${g}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(a){const n=document.createElement("canvas");return n.width=n.height=a,n}draw(a){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:w}=this.ctx.measureText(a),S=Math.ceil(o),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-g))),L=Math.min(this.size-this.buffer,S+Math.ceil(d)),N=A+2*this.buffer,q=L+2*this.buffer,Z=Math.max(N*q,0),Q=new Uint8ClampedArray(Z),ne={data:Q,width:N,height:q,glyphWidth:A,glyphHeight:L,glyphTop:S,glyphLeft:0,glyphAdvance:n};if(A===0||L===0)return ne;const{ctx:oe,buffer:me,gridInner:Se,gridOuter:Te}=this;this.lang&&(oe.lang=this.lang),oe.clearRect(me,me,A,L),oe.fillText(a,me,me+S);const Le=oe.getImageData(me,me,A,L);Te.fill(v1,0,Z),Se.fill(0,0,Z);for(let Re=0;Re<L;Re++)for(let Ue=0;Ue<A;Ue++){const rt=Le.data[4*(Re*A+Ue)+3]/255;if(rt===0)continue;const Qe=(Re+me)*N+Ue+me;if(rt===1)Te[Qe]=0,Se[Qe]=v1;else{const ht=.5-rt;Te[Qe]=ht>0?ht*ht:0,Se[Qe]=ht<0?ht*ht:0}}Nk(Te,0,0,N,q,N,this.f,this.v,this.z),Nk(Se,me,me,A,L,N,this.f,this.v,this.z);for(let Re=0;Re<Z;Re++){const Ue=Math.sqrt(Te[Re])-Math.sqrt(Se[Re]);Q[Re]=Math.round(255-255*(Ue/this.radius+this.cutoff))}return ne}};const gg=G0;function jk(a,n){return a+n[1]-n[0]}function FI(a,n,o,d,g=1){const w=[],S=a.imagePrimary,A=S.pixelRatio,L=S.paddedRect.w-2*gg,N=S.paddedRect.h-2*gg,q=(a.right-a.left)*g,Z=(a.bottom-a.top)*g,Q=S.stretchX||[[0,L]],ne=S.stretchY||[[0,N]],oe=Q.reduce(jk,0),me=ne.reduce(jk,0),Se=L-oe,Te=N-me;let Le=0,Re=oe,Ue=0,rt=me,Qe=0,ht=Se,yt=0,Et=Te;if(S.content&&d){const kt=S.content;Le=hT(Q,0,kt[0]),Ue=hT(ne,0,kt[1]),Re=hT(Q,kt[0],kt[2]),rt=hT(ne,kt[1],kt[3]),Qe=kt[0]-Le,yt=kt[1]-Ue,ht=kt[2]-kt[0]-Re,Et=kt[3]-kt[1]-rt}const ai=(kt,fi,Ti,Si)=>{const Bi=dT(kt.stretch-Le,Re,q,a.left*g),ji=fT(kt.fixed-Qe,ht,kt.stretch,oe),zi=dT(fi.stretch-Ue,rt,Z,a.top*g),Oi=fT(fi.fixed-yt,Et,fi.stretch,me),di=dT(Ti.stretch-Le,Re,q,a.left*g),ui=fT(Ti.fixed-Qe,ht,Ti.stretch,oe),Fi=dT(Si.stretch-Ue,rt,Z,a.top*g),tn=fT(Si.fixed-yt,Et,Si.stretch,me),Xi=new yi(Bi,zi),Vn=new yi(di,zi),_n=new yi(di,Fi),In=new yi(Bi,Fi),Dn=new yi(ji/A,Oi/A),jr=new yi(ui/A,tn/A),Ki=n*Math.PI/180;if(Ki){const Ys=Math.sin(Ki),et=Math.cos(Ki),st=[et,-Ys,Ys,et];Xi._matMult(st),Vn._matMult(st),In._matMult(st),_n._matMult(st)}const Rn=kt.stretch+kt.fixed,wr=Ti.stretch+Ti.fixed,os=fi.stretch+fi.fixed,ds=Si.stretch+Si.fixed,Mr=a.imageSecondary;return{tl:Xi,tr:Vn,bl:In,br:_n,texPrimary:{x:S.paddedRect.x+gg+Rn,y:S.paddedRect.y+gg+os,w:wr-Rn,h:ds-os},texSecondary:Mr?{x:Mr.paddedRect.x+gg+Rn,y:Mr.paddedRect.y+gg+os,w:wr-Rn,h:ds-os}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dn,pixelOffsetBR:jr,minFontScaleX:ht/A/q,minFontScaleY:Et/A/Z,isSDF:o}};if(d&&(S.stretchX||S.stretchY)){const kt=Uk(Q,Se,oe),fi=Uk(ne,Te,me);for(let Ti=0;Ti<kt.length-1;Ti++){const Si=kt[Ti],Bi=kt[Ti+1];for(let ji=0;ji<fi.length-1;ji++)w.push(ai(Si,fi[ji],Bi,fi[ji+1]))}}else w.push(ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:N+1}));return w}function i8(a,n){const o=a.stretchY||[[0,a.paddedRect.h-2*gg]];return n&&(a.stretchX||a.stretchY)?$k(a.stretchX||[[0,a.paddedRect.w-2*gg]])*$k(o):1}function hT(a,n,o){let d=0;for(const g of a)d+=Math.max(n,Math.min(o,g[1]))-Math.max(n,Math.min(o,g[0]));return d}function Uk(a,n,o){const d=[{fixed:-gg,stretch:0}];for(const[g,w]of a){const S=d[d.length-1];d.push({fixed:g-S.stretch,stretch:S.stretch}),d.push({fixed:g-S.stretch,stretch:S.stretch+(w-g)})}return d.push({fixed:n+gg,stretch:o}),d}function $k(a){return 2*a.length+1}function dT(a,n,o,d){return a/n*o+d}function fT(a,n,o,d){return a-n*o/d}function n8(a,n,o,d){const g=n+a.positionedLines[d].lineOffset;return d===0?o+g/2:o+(g+(n+a.positionedLines[d-1].lineOffset))/2}function r8(a,n=1,o=!1){let d=1/0,g=1/0,w=-1/0,S=-1/0;const A=a[0];for(let ne=0;ne<A.length;ne++){const oe=A[ne];(!ne||oe.x<d)&&(d=oe.x),(!ne||oe.y<g)&&(g=oe.y),(!ne||oe.x>w)&&(w=oe.x),(!ne||oe.y>S)&&(S=oe.y)}const L=Math.min(w-d,S-g);let N=L/2;const q=new cf([],s8);if(L===0)return new yi(d,g);for(let ne=d;ne<w;ne+=L)for(let oe=g;oe<S;oe+=L)q.push(new mx(ne+N,oe+N,N,a));let Z=(function(ne){let oe=0,me=0,Se=0;const Te=ne[0];for(let Le=0,Re=Te.length,Ue=Re-1;Le<Re;Ue=Le++){const rt=Te[Le],Qe=Te[Ue],ht=rt.x*Qe.y-Qe.x*rt.y;me+=(rt.x+Qe.x)*ht,Se+=(rt.y+Qe.y)*ht,oe+=3*ht}return new mx(me/oe,Se/oe,0,ne)})(a),Q=q.length;for(;q.length;){const ne=q.pop();(ne.d>Z.d||!Z.d)&&(Z=ne,o&&console.log("found best %d after %d probes",Math.round(1e4*ne.d)/1e4,Q)),ne.max-Z.d<=n||(N=ne.h/2,q.push(new mx(ne.p.x-N,ne.p.y-N,N,a)),q.push(new mx(ne.p.x+N,ne.p.y-N,N,a)),q.push(new mx(ne.p.x-N,ne.p.y+N,N,a)),q.push(new mx(ne.p.x+N,ne.p.y+N,N,a)),Q+=4)}return o&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${Z.d}`)),Z.p}function s8(a,n){return n.max-a.max}class mx{constructor(n,o,d,g){this.p=new yi(n,o),this.h=d,this.d=(function(w,S){let A=!1,L=1/0;for(let N=0;N<S.length;N++){const q=S[N];for(let Z=0,Q=q.length,ne=Q-1;Z<Q;ne=Z++){const oe=q[Z],me=q[ne];oe.y>w.y!=me.y>w.y&&w.x<(me.x-oe.x)*(w.y-oe.y)/(me.y-oe.y)+oe.x&&(A=!A),L=Math.min(L,Ss(w,oe,me))}}return(A?1:-1)*Math.sqrt(L)})(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const o8=Object.keys,BI=Number.POSITIVE_INFINITY,a8=Math.sqrt(2);function Ny(a,n,o,d,g){const w=DI(a)&&a.collisionPadding?a.collisionPadding:[0,0,0,0],S={top:a.top-w[1],bottom:a.bottom+w[3],left:a.left-w[0],right:a.right+w[2],scaled:!1};return d!==void 0&&(function(A,L){A.top*=L,A.bottom*=L,A.left*=L,A.right*=L,A.scaled=!0})(S,d),o&&(function(A,L){if(!L)return;const N=ns(L),q=new yi(A.left,A.top),Z=new yi(A.right,A.top),Q=new yi(A.left,A.bottom),ne=new yi(A.right,A.bottom),oe=new yi(0,0);q._rotateAround(N,oe),Z._rotateAround(N,oe),Q._rotateAround(N,oe),ne._rotateAround(N,oe),A.left=Math.min(q.x,Z.x,Q.x,ne.x),A.right=Math.max(q.x,Z.x,Q.x,ne.x),A.top=Math.min(q.y,Z.y,Q.y,ne.y),A.bottom=Math.max(q.y,Z.y,Q.y,ne.y)})(S,o),g&&(S.left+=g[0],S.right+=g[0],S.top+=g[1],S.bottom+=g[1]),n?{top:Math.min(n.top,S.top),bottom:Math.max(n.bottom,S.bottom),left:Math.min(n.left,S.left),right:Math.max(n.right,S.right),scaled:n.scaled||S.scaled}:S}function Gk(a,[n,o]){let d=0,g=0;if(o===BI){n<0&&(n=0);const w=n/a8;switch(a){case"top-right":case"top-left":g=w-7;break;case"bottom-right":case"bottom-left":g=7-w;break;case"bottom":g=7-n;break;case"top":g=n-7}switch(a){case"top-right":case"bottom-right":d=-w;break;case"top-left":case"bottom-left":d=w;break;case"left":d=n;break;case"right":d=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),a){case"top-right":case"top-left":case"top":g=o-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-o}switch(a){case"top-right":case"bottom-right":case"right":d=-n;break;case"top-left":case"bottom-left":case"left":d=n}}return[d,g]}function l8(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne){const oe=a.layers[0],me=oe.appearances;if(me.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const Se={iconBBox:null,iconVerticalBBox:null},Te={textBBox:null,textVerticalBBox:null},{baseIconRotate:Le,baseTextRotate:Re,iconScaleFactor:Ue}=(function(Qe,ht,yt){const Et=Qe.get("icon-rotate").evaluate(ht,{},yt),ai=Qe.get("text-rotate").evaluate(ht,{},yt),[kt,fi]=Qe.get("icon-size-scale-range");return{baseIconRotate:Et,baseTextRotate:ai,iconScaleFactor:we(1,kt,fi)}})(d,g,w);n&&(Se.iconBBox=Ny(n,Se.iconBBox,Le,S),o)&&(Se.iconVerticalBBox=Ny(o,Se.iconVerticalBBox,Le+90,S));const rt=mT(Z.horizontal);rt&&(Te.textBBox=Ny(rt,Te.textBBox,Re,1,ne)),Z.vertical&&(Te.textVerticalBBox=Ny(Z.vertical,Te.textVerticalBBox,Re+90,1,ne));for(const Qe of me)Qe.hasIconProperties()&&c8(Se,a,oe,Qe,g,w,A,Le,S,L,n,N,Ue,q),Qe.hasTextProperties()&&u8(Te,oe,Qe,g,w,ne,Re,Q,rt,Z.vertical);return{iconBBox:Se.iconBBox,iconVerticalBBox:Se.iconVerticalBBox,textBBox:Te.textBBox,textVerticalBBox:Te.textVerticalBBox}}function c8(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne){const{appearanceIconOffset:oe,appearanceIconRotate:me,appearanceIconSize:Se}=(function(Ue,rt,Qe,ht,yt,Et,ai,kt){const fi=Ue.hasProperty("icon-offset")?rt.getAppearanceValueAndResolveTokens(Ue,"icon-offset",Qe,ht,[]):null,Ti=fi&&Array.isArray(fi)?fi:yt,Si=Ue.hasProperty("icon-rotate")?rt.getAppearanceValueAndResolveTokens(Ue,"icon-rotate",Qe,ht,[]):null,Bi=typeof Si=="number"?Si:Et,ji=Ue.hasProperty("icon-size")?rt.getAppearanceValueAndResolveTokens(Ue,"icon-size",Qe,ht,[]):null;return{appearanceIconOffset:Ti,appearanceIconRotate:Bi,appearanceIconSize:typeof ji=="number"?ji*kt.iconScaleFactor:ai}})(d,o,g,w,S,A,L,N);let Te=null,Le=null,Re=null;d.hasProperty("icon-image")?Re=(function(Ue,rt,Qe,ht,yt,Et,ai){let kt=null;const fi=rt.getAppearanceValueAndResolveTokens(Qe,"icon-image",ht,yt,[]);if(fi){const Ti=Ue.getResolvedImageFromTokens(fi),Si=Qe.getUnevaluatedProperty("icon-size"),Bi=x1(Ti,dx(Ue.zoom,Si,Ue.worldview),Si,yt,Ue.zoom,ht,Ue.pixelRatio,ai,Ue.worldview);kt=Et.get(Bi.iconPrimary.toString())}return kt})(n,o,d,g,w,Z,Q):q&&(Re=q.imagePrimary),Re&&(Te=uT(Re,null,oe,ne),n.allowVerticalPlacement&&(Le=uT(Re,null,oe,ne))),Te&&(a.iconBBox=Ny(Te,a.iconBBox,me,Se)),Le&&(a.iconVerticalBBox=Ny(Le,a.iconVerticalBBox,me+90,Se))}function u8(a,n,o,d,g,w,S,A,L,N){const{appearanceTextOffset:q,appearanceTextRotate:Z,appearanceTextSize:Q}=(function(oe,me,Se,Te,Le,Re,Ue){const rt=oe.hasProperty("text-offset")?me.getAppearanceValueAndResolveTokens(oe,"text-offset",Se,Te,[]):null,Qe=rt&&Array.isArray(rt)?[rt[0]*ca,rt[1]*ca]:Le,ht=oe.hasProperty("text-rotate")?me.getAppearanceValueAndResolveTokens(oe,"text-rotate",Se,Te,[]):null,yt=typeof ht=="number"?ht:Re,Et=oe.hasProperty("text-size")?me.getAppearanceValueAndResolveTokens(oe,"text-size",Se,Te,[]):null;return{appearanceTextOffset:Qe,appearanceTextRotate:yt,appearanceTextSize:typeof Et=="number"?Et:Ue}})(o,n,d,g,w,S,A),ne=Q/A;L&&(a.textBBox=Ny(L,a.textBBox,Z,ne,q)),N&&(a.textVerticalBBox=Ny(N,a.textVerticalBBox,Z+90,ne,q))}function pT(a,n,o,d,g,w,S,A,L){if(!n||!n.usvg)return;const N=kk(d),q=kk(g),Z=w!=="both"&&w!=="width"||!Pk(d)?1:q.width/N.width,Q=w!=="both"&&w!=="height"||!Mk(d)?1:q.height/N.height;o.scaleSelf(Z,Q);const ne=o.toString();S.set(ne,o),A.set(ne,n);const{imagePosition:oe}=zI(ne,n,G0);L.set(ne,oe)}function qk(a,n,o,d,g,w,S,A,L){if(!a)return;const N=(function(q,Z,Q,ne,oe,me){if(q.kind==="camera")return q.maxSize;if(q.kind==="composite"){const Se=Z.possiblyEvaluate(new Us(q.maxZoom,{worldview:me}),Q).evaluate(oe,{},Q),Te=Z.possiblyEvaluate(new Us(q.minZoom,{worldview:me}),Q).evaluate(oe,{},Q);return Math.max(Se,Te)}return Z.possiblyEvaluate(new Us(ne,{worldview:me})).evaluate(oe,{},Q)})(n,o,d,g,w,L);return a.scaleSelf(N*A*S)}function x1(a,n,o,d,g,w,S,A,L){return{iconPrimary:qk(a.getPrimary(),n,o,d,g,w,S,A,L),iconSecondary:qk(a.getSecondary(),n,o,d,g,w,S,A,L)}}function h8(a,n,o){if(!n)return;const d=o.get(a.toString()),g=o.get(n.toString());d&&g&&(d.paddedRect.w===g.paddedRect.w&&d.paddedRect.h===g.paddedRect.h||mn(`Mismatch in icon variant sizes: ${a.toString()} and ${n.toString()}`),d.usvg!==g.usvg&&mn(`Mismatch in icon variant image types: ${a.id} and ${n.id}`))}function Hk(a,n,o,d){if(!a)return;const g=n.get(o.toString());if(a.imagePrimary=g,d){const w=n.get(d.toString());a.imageSecondary=w}}function d8(a,n){for(const o in a.horizontal)Wk(a.horizontal[o],n);Wk(a.vertical,n)}function Wk(a,n){if(a){for(const o of a.positionedLines)for(const d of o.positionedGlyphs)if(d.image!==null){const g=d.image.toString();d.rect=n.get(g).paddedRect}}}function NI(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function f8(a,n,o,d,g,w,S,A,L){const N=mT(w.horizontal)||w.vertical,q=o.get("icon-text-fit-padding").evaluate(d,{},g);let Z,Q=n;return n&&L!=="none"&&(a.allowVerticalPlacement&&w.vertical&&(Z=LI(n,w.vertical,L,q,A,S)),N&&(Q=LI(n,N,L,q,A,S))),{defaultShapedIcon:Q,verticallyShapedIcon:Z}}function p8(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le,Re,Ue,rt,Qe,ht){let yt=S.textMaxSize.evaluate(n,{},Q);yt===void 0?yt=A*S.textScaleFactor:yt*=S.textScaleFactor;const Et=a.layers[0].layout,ai=ca,kt=A*S.textScaleFactor/ai,fi=mT(o.horizontal)||o.vertical;if(Se!=="none"&&a.appearanceFeatureData&&n.index<a.appearanceFeatureData.length){const _n=a.appearanceFeatureData[n.index];_n&&(_n.textShaping=fi,_n.iconTextFitPadding=Et.get("icon-text-fit-padding").evaluate(n,{},Q),_n.fontScale=kt)}const Ti=ne.name==="globe",Si=a.tilePixelRatio*yt/ai,Bi=(Fi=a.overscaling,a.zoom>18&&Fi>2&&(Fi>>=1),Math.max(Ji/(512*Fi),1)*Et.get("symbol-spacing")),ji=Et.get("text-padding")*a.tilePixelRatio,zi=Et.get("icon-padding")*a.tilePixelRatio,Oi=ns(Et.get("text-max-angle")),di=Et.get("icon-rotation-alignment")==="map"&&Re!=="point",ui=Bi/2;var Fi;a.hasAnyIconTextFit===!1&&Se!=="none"&&(a.hasAnyIconTextFit=!0);const tn=n.properties?+n.properties[oi]:null,Xi=tn&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(tn):65535,Vn=(_n,In,Dn)=>{if(In.x<0||In.x>=Ji||In.y<0||In.y>=Ji)return;let jr=null;if(Ti){const{x:Ki,y:Rn,z:wr}=ne.projectTilePoint(In.x,In.y,Dn);jr={anchor:new E_(Ki,Rn,wr,0,void 0),up:ne.upVector(Dn,In.x,In.y)}}(function(Ki,Rn,wr,os,ds,Mr,Ys,et,st,pi,Ni,dn,fn,Un,Wn,Ir,zr,Vr,rs,cr,xr,gs,Es,Is,$s,to,Ks,ks,Fs,Or,us,Ro,ar){const ss=Ki.addToLineVertexArray(Rn,os);let eo,ro,mo,_a,ho,lr,Ho,Gs=0,Co=0,hl=0,Rl=0,Xa=-1,Ya=-1;const Il={};let $u=Rh("");const fo=wr?wr.anchor:Rn,ua=ks!=="none";let ya=0,Sh=0;if(st._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _c=st.layout.get("text-offset").evaluate(xr,{},$s);ya=_c[0]*ca,Sh=_c[1]*ca}else ya=st.layout.get("text-radial-offset").evaluate(xr,{},$s)*ca,Sh=BI;if(Ki.allowVerticalPlacement&&ds.vertical){const _c=ds.vertical;if(Wn)lr=VI(_c),et&&(Ho=VI(et));else{const bu=st.layout.get("text-rotate").evaluate(xr,{},$s)+90;mo=gT(pi,fo,Rn,Ni,dn,fn,_c,Un,bu,Ir,Ro),et&&(_a=gT(pi,fo,Rn,Ni,dn,fn,et,Vr,bu,null,us))}}if(Mr){const _c=Ki.iconSizeData,bu=st.layout.get("icon-rotate").evaluate(xr,{},$s),id=FI(Mr,bu,Es,ua,gs.iconScaleFactor),Uy=et?FI(et,bu,Es,ua,gs.iconScaleFactor):void 0;ro=gT(pi,fo,Rn,Ni,dn,fn,Mr,Vr,bu,null,Or);const wx=(function(mm,B1,dL,IU,fL,pL,CU,AU){const mL=mm.layers[0],gL=mL.appearances;let Tx=B1.length;if(dL&&(Tx=Math.max(Tx,dL.length)),gL.length===0)return Tx;const[PU,MU]=IU.get("icon-size-scale-range"),kU=we(1,PU,MU);for(const _L of gL){const yL=_L.getUnevaluatedProperties();if(yL._values["icon-image"].value!==void 0){const vL=mL.getAppearanceValueAndResolveTokens(_L,"icon-image",fL,pL,[]);if(vL){const xL=mm.getResolvedImageFromTokens(vL);if(xL){const bL=yL._values["icon-size"],DU=x1(xL,dx(mm.zoom,bL,mm.worldview),bL,pL,mm.zoom,fL,mm.pixelRatio,kU,mm.worldview),LU=CU.get(DU.iconPrimary.toString());Tx=Math.max(Tx,i8(LU,AU))}}}}return Tx})(Ki,id,Uy,st.layout,xr,$s,Ki.iconAtlasPositions,ua);Gs=4*wx;let pm=null;_c.kind==="source"?(pm=[um*st.layout.get("icon-size").evaluate(xr,{},$s)*gs.iconScaleFactor],pm[0]>I_&&mn(`${Ki.layerIds[0]}: Value for "icon-size" is >= ${b1}. Reduce your "icon-size".`)):_c.kind==="composite"&&(pm=[um*gs.compositeIconSizes[0].evaluate(xr,{},$s)*gs.iconScaleFactor,um*gs.compositeIconSizes[1].evaluate(xr,{},$s)*gs.iconScaleFactor],(pm[0]>I_||pm[1]>I_)&&mn(`${Ki.layerIds[0]}: Value for "icon-size" is >= ${b1}. Reduce your "icon-size".`)),Ki.addSymbols(Ki.icon,id,pm,cr,rs,xr,void 0,wr,Rn,ss.lineStartIndex,ss.lineLength,-1,Is,$s,to,Ks,Ki.symbolInstances.length,wx),Xa=Ki.icon.placedSymbolArray.length-1,Uy&&(Co=4*wx,Ki.addSymbols(Ki.icon,Uy,pm,cr,rs,xr,td.vertical,wr,Rn,ss.lineStartIndex,ss.lineLength,-1,Is,$s,to,Ks,Ki.symbolInstances.length,wx),Ya=Ki.icon.placedSymbolArray.length-1)}for(const _c in ds.horizontal){const bu=_c,id=ds.horizontal[bu];eo||($u=Rh(id.text),Wn?ho=VI(id):eo=gT(pi,fo,Rn,Ni,dn,fn,id,Un,st.layout.get("text-rotate").evaluate(xr,{},$s),Ir,Ro));const Uy=id.positionedLines.length===1;if(hl+=Zk(Ki,wr,Rn,id,Ys,st,Wn,xr,Ir,ss,ds.vertical?td.horizontal:td.horizontalOnly,Uy?o8(ds.horizontal):[bu],Il,Xa,gs,Is,$s,Ki.symbolInstances.length,to),Uy)break}ds.vertical&&(Rl+=Zk(Ki,wr,Rn,ds.vertical,Ys,st,Wn,xr,Ir,ss,td.vertical,["vertical"],Il,Ya,gs,Is,$s,Ki.symbolInstances.length,to));let dl=-1;const wp=(_c,bu)=>_c?Math.max(_c,bu):bu;dl=wp(ho,dl),dl=wp(lr,dl),dl=wp(Ho,dl);const _g=dl>-1?1:0;Ki.glyphOffsetArray.length>=65535&&mn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&Ki.addToSortKeyRanges(Ki.symbolInstances.length,xr.sortKey),Ki.symbolInstances.emplaceBack(Rn.x,Rn.y,fo.x,fo.y,fo.z,Il.right>=0?Il.right:-1,Il.center>=0?Il.center:-1,Il.left>=0?Il.left:-1,Il.vertical>=0?Il.vertical:-1,Xa,Ya,$u,eo!==void 0?eo:Ki.collisionBoxArray.length,eo!==void 0?eo+1:Ki.collisionBoxArray.length,mo!==void 0?mo:Ki.collisionBoxArray.length,mo!==void 0?mo+1:Ki.collisionBoxArray.length,ro!==void 0?ro:Ki.collisionBoxArray.length,ro!==void 0?ro+1:Ki.collisionBoxArray.length,_a||Ki.collisionBoxArray.length,_a?_a+1:Ki.collisionBoxArray.length,Ni,hl,Rl,Gs,Co,_g,0,ya,Sh,dl,0,ua?1:0,Fs)})(a,In,jr,_n,o,d,w,g,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,ji,Le,N,0,zi,di,Te,n,S,q,Z,Q,oe,me,Se,Xi,Ue,rt,Qe)};if(Re==="line")for(const _n of Py(n.geometry,0,0,Ji,Ji)){const In=t8(_n,Bi,Oi,o.vertical||fi,d,ai,Si,a.overscaling,Ji);for(const Dn of In)fi&&m8(a,fi.text,ui,Dn)||Vn(_n,Dn,Q)}else if(Re==="line-center"){for(const _n of n.geometry)if(_n.length>1){const In=e8(_n,Oi,o.vertical||fi,d,ai,Si);In&&Vn(_n,In,Q)}}else if(n.type==="Polygon")for(const _n of Jh(n.geometry,0)){const In=r8(_n,16);Vn(_n[0],new E_(In.x,In.y,0,0,void 0),Q)}else if(n.type==="LineString")for(const _n of n.geometry)Vn(_n,new E_(_n[0].x,_n[0].y,0,0,void 0),Q);else if(n.type==="Point")for(const _n of n.geometry)for(const In of _n)Vn([In],new E_(In.x,In.y,0,0,void 0),Q)}const b1=255,I_=b1*um;function Zk(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le){const Re=(function(Qe,ht,yt,Et,ai,kt,fi,Ti){const Si=[];if(ht.positionedLines.length===0)return Si;const Bi=Et.layout.get("text-rotate").evaluate(kt,{})*Math.PI/180,ji=(function(Fi){const tn=Fi[0],Xi=Fi[1],Vn=tn*Xi;return Vn>0?[tn,-Xi]:Vn<0?[-tn,Xi]:tn===0?[Xi,tn]:[Xi,-tn]})(yt);let zi=Math.abs(ht.top-ht.bottom);for(const Fi of ht.positionedLines)zi-=Fi.lineOffset;const Oi=ht.positionedLines.length,di=zi/Oi;let ui=ht.top-yt[1];for(let Fi=0;Fi<Oi;++Fi){const tn=ht.positionedLines[Fi];ui=n8(ht,di,ui,Fi);for(const Xi of tn.positionedGlyphs){if(!Xi.rect)continue;const Vn=Xi.rect||{};let _n=Tk+1,In=!0,Dn=1,jr=0;if(Xi.image){const zr=fi.get(Xi.image.toString());if(!zr)continue;if(zr.sdf){mn("SDF images are not supported in formatted text and will be ignored.");continue}In=!1,Dn=zr.pixelRatio,_n=G0/Dn}const Ki=(ai||Ti)&&Xi.vertical,Rn=Xi.metrics.advance*Xi.scale/2,wr=Xi.metrics,os=Xi.rect;if(os===null)continue;Ti&&ht.verticalizable&&(jr=Xi.image?Rn-Xi.metrics.width*Xi.scale/2:0);const ds=ai?[Xi.x+Rn,Xi.y]:[0,0];let Mr=[0,0],Ys=[0,0],et=!1;ai||(Ki?(Ys=[Xi.x+Rn+ji[0],Xi.y+ji[1]-jr],et=!0):Mr=[Xi.x+Rn+yt[0],Xi.y+yt[1]-jr]);const st=os.w*Xi.scale/(Dn*(Xi.localGlyph?hm:1)),pi=os.h*Xi.scale/(Dn*(Xi.localGlyph?hm:1));let Ni,dn,fn,Un;if(Ki){const zr=Xi.y-ui,Vr=new yi(-Rn,Rn-zr),rs=-Math.PI/2,cr=new yi(...Ys);Ni=new yi(-Rn+Mr[0],Mr[1]),Ni._rotateAround(rs,Vr)._add(cr),Ni.x+=-zr+Rn,Ni.y-=(wr.left-_n)*Xi.scale;const xr=Xi.image?wr.advance*Xi.scale:ca*Xi.scale,gs=String.fromCodePoint(Xi.glyph);Bj(gs)?Ni.x+=(1-_n)*Xi.scale:Nj(gs)?Ni.x+=xr-wr.height*Xi.scale+(-_n-1)*Xi.scale:Ni.x+=Xi.image||wr.width+2*_n===os.w&&wr.height+2*_n===os.h?(xr-pi)/2:(xr-(wr.height+2*_n)*Xi.scale)/2,dn=new yi(Ni.x,Ni.y-st),fn=new yi(Ni.x+pi,Ni.y),Un=new yi(Ni.x+pi,Ni.y-st)}else{const zr=(wr.left-_n)*Xi.scale-Rn+Mr[0],Vr=(-wr.top-_n)*Xi.scale+Mr[1],rs=zr+st,cr=Vr+pi;Ni=new yi(zr,Vr),dn=new yi(rs,Vr),fn=new yi(zr,cr),Un=new yi(rs,cr)}if(Bi){let zr;zr=ai?new yi(0,0):et?new yi(ji[0],ji[1]):new yi(yt[0],yt[1]),Ni._rotateAround(Bi,zr),dn._rotateAround(Bi,zr),fn._rotateAround(Bi,zr),Un._rotateAround(Bi,zr)}const Wn=new yi(0,0),Ir=new yi(0,0);Si.push({tl:Ni,tr:dn,bl:fn,br:Un,texPrimary:Vn,texSecondary:void 0,writingMode:ht.writingMode,glyphOffset:ds,sectionIndex:Xi.sectionIndex,isSDF:In,pixelOffsetTL:Wn,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}}return Si})(0,d,L,w,S,A,g,a.allowVerticalPlacement),Ue=a.textSizeData;let rt=null;Ue.kind==="source"?(rt=[um*w.layout.get("text-size").evaluate(A,{},Se)*oe.textScaleFactor],rt[0]>I_&&mn(`${a.layerIds[0]}: Value for "text-size" is >= ${b1}. Reduce your "text-size".`)):Ue.kind==="composite"&&(rt=[um*oe.compositeTextSizes[0].evaluate(A,{},Se)*oe.textScaleFactor,um*oe.compositeTextSizes[1].evaluate(A,{},Se)*oe.textScaleFactor],(rt[0]>I_||rt[1]>I_)&&mn(`${a.layerIds[0]}: Value for "text-size" is >= ${b1}. Reduce your "text-size".`)),a.addSymbols(a.text,Re,rt,L,S,A,q,n,o,N.lineStartIndex,N.lineLength,ne,me,Se,Le,!1,Te,Re.length);for(const Qe of Z)Q[Qe]=a.text.placedSymbolArray.length-1;return 4*Re.length}function mT(a){for(const n in a)return a[n];return null}function gT(a,n,o,d,g,w,S,A,L,N,q){let Z,Q,ne,oe;if(Z=q?q.top:S.top,Q=q?q.bottom:S.bottom,ne=q?q.left:S.left,oe=q?q.right:S.right,DI(S)&&S.collisionPadding){const me=S.collisionPadding;ne-=me[0],Z-=me[1],oe+=me[2],Q+=me[3]}if(L){const me=new yi(ne,Z),Se=new yi(oe,Z),Te=new yi(ne,Q),Le=new yi(oe,Q),Re=ns(L);let Ue=new yi(0,0);N&&(Ue=new yi(N[0],N[1])),me._rotateAround(Re,Ue),Se._rotateAround(Re,Ue),Te._rotateAround(Re,Ue),Le._rotateAround(Re,Ue),ne=Math.min(me.x,Se.x,Te.x,Le.x),oe=Math.max(me.x,Se.x,Te.x,Le.x),Z=Math.min(me.y,Se.y,Te.y,Le.y),Q=Math.max(me.y,Se.y,Te.y,Le.y)}return a.emplaceBack(n.x,n.y,n.z,o.x,o.y,ne,Z,oe,Q,A,d,g,w),a.length-1}function VI(a){DI(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const n=a.bottom-a.top;return n>0?Math.max(10,n):null}function m8(a,n,o,d){const g=a.compareText;if(n in g){const w=g[n];for(let S=w.length-1;S>=0;S--)if(d.dist(w[S])<o)return!0}else g[n]=[];return g[n].push(d),!1}function Xk(a,n){const o=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*n:0,g=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),w=Math.sin(o)*g/Math.sin(Math.max(Math.PI/2-a._pitch-o,.01));let S=Math.sin(a._pitch)*w+g;const A=g*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let L=Math.max(a.zoom-17,0);a.isOrthographic&&(L/=10),S*=1+L}return Math.min(1.01*S,A)}function w1(a,n){if(!n.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:n};const o=Math.pow(2,-a.z),d=a.x*o,g=(a.x+1)*o,w=a.y*o,S=(a.y+1)*o,A=ee(d),L=ee(g),N=ce(w),q=ce(S),Z=n.project(A,N),Q=n.project(L,N),ne=n.project(L,q),oe=n.project(A,q);let me=Math.min(Z.x,Q.x,ne.x,oe.x),Se=Math.min(Z.y,Q.y,ne.y,oe.y),Te=Math.max(Z.x,Q.x,ne.x,oe.x),Le=Math.max(Z.y,Q.y,ne.y,oe.y);const Re=o/16;function Ue(Qe,ht,yt,Et,ai,kt){const fi=(yt+ai)/2,Ti=(Et+kt)/2,Si=n.project(ee(fi),ce(Ti)),Bi=Math.max(0,me-Si.x,Se-Si.y,Si.x-Te,Si.y-Le);me=Math.min(me,Si.x),Te=Math.max(Te,Si.x),Se=Math.min(Se,Si.y),Le=Math.max(Le,Si.y),Bi>Re&&(Ue(Qe,Si,yt,Et,fi,Ti),Ue(Si,ht,fi,Ti,ai,kt))}Ue(Z,Q,d,w,g,w),Ue(Q,ne,g,w,g,S),Ue(ne,oe,g,S,d,S),Ue(oe,Z,d,S,d,w),me-=Re,Se-=Re,Te+=Re,Le+=Re;const rt=1/Math.max(Te-me,Le-Se);return{scale:rt,x:me*rt,y:Se*rt,x2:Te*rt,y2:Le*rt,projection:n}}function Yk(a,{x:n,y:o},d=0){return new yi(((n-d)*a.scale-a.x)*Ji,(o*a.scale-a.y)*Ji)}const g8=ie(new Float32Array(16));class Vy{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new h(0,0)}projectTilePoint(n,o,d){return{x:n,y:o,z:0}}locationPoint(n,o,d,g=!0){return n._coordinatePoint(n.locationCoordinate(o,d),g)}pixelsPerMeter(n,o){return J(1,n)*o}pixelSpaceConversion(n,o,d){return 1}farthestPixelDistance(n){return Xk(n,n.pixelsPerMeter)}pointCoordinate(n,o,d,g){const w=n.horizonLineFromTop(!1),S=new yi(o,Math.max(w,d));return n.rayIntersectionCoordinate(n.pointRayIntersection(S,g))}pointCoordinate3D(n,o,d){const g=new yi(o,d);if(n.elevation)return n.elevation.pointCoordinate(g);{const w=this.pointCoordinate(n,g.x,g.y,0);return[w.x,w.y,w.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const d=n.horizonLineFromTop();return o.y<d}createInversionMatrix(n,o){return g8}createTileMatrix(n,o,d){let g,w,S;const A=d.canonical,L=ie(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=w1(A,this);g=1,w=N.x+d.wrap*N.scale,S=N.y,Ee(L,L,[g/N.scale,g/N.scale,n.pixelsPerMeter/o])}else g=o/n.zoomScale(A.z),w=(A.x+Math.pow(2,A.z)*d.wrap)*g,S=A.y*g;return de(L,L,[w,S,0]),Ee(L,L,[g/Ji,g/Ji,1]),L}upVector(n,o,d){return[0,0,1]}upVectorScale(n,o,d){return{metersToTile:1}}}class _8 extends Vy{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,d]=this.parallels=n.parallels||[29.5,45.5],g=Math.sin(ns(o));this.n=(g+Math.sin(ns(d)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:d,c:g,r0:w}=this,S=ns(n-this.center[0]),A=ns(o),L=Math.sqrt(g-2*d*Math.sin(A))/d;return{x:L*Math.sin(S*d),y:L*Math.cos(S*d)-w,z:0}}unproject(n,o){const{n:d,c:g,r0:w}=this,S=w+o;let A=Math.atan2(n,Math.abs(S))*Math.sign(S);S*d<0&&(A-=Math.PI*Math.sign(n)*Math.sign(S));const L=ns(this.center[0])*d;A=qe(A,-Math.PI-L,Math.PI-L);const N=we(Ja(A/d)+this.center[0],-180,180),q=Math.asin(we((g-(n*n+S*S)*d*d)/(2*d),-1,1)),Z=we(Ja(q),-he,he);return new h(N,Z)}}const T1=1.340264,S1=-.081106,E1=893e-6,I1=.003796,_T=Math.sqrt(3)/2;class y8 extends Vy{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const d=Math.asin(_T*Math.sin(o)),g=d*d,w=g*g*g;return{x:.5*(n*Math.cos(d)/(_T*(T1+3*S1*g+w*(7*E1+9*I1*g)))/Math.PI+.5),y:1-.5*(d*(T1+S1*g+w*(E1+I1*g))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let d=o=(2*(1-o)-1)*Math.PI,g=d*d,w=g*g*g;for(let q,Z,Q,ne=0;ne<12&&(Z=d*(T1+S1*g+w*(E1+I1*g))-o,Q=T1+3*S1*g+w*(7*E1+9*I1*g),q=Z/Q,d=we(d-q,-Math.PI/3,Math.PI/3),g=d*d,w=g*g*g,!(Math.abs(q)<1e-12));++ne);const S=_T*n*(T1+3*S1*g+w*(7*E1+9*I1*g))/Math.cos(d),A=Math.asin(Math.sin(d)/_T),L=we(180*S/Math.PI,-180,180),N=we(180*A/Math.PI,-he,he);return new h(L,N)}}class v8 extends Vy{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const d=360*(n-.5),g=we(360*(.5-o),-he,he);return new h(d,g)}}const gx=Math.PI/2;function yT(a){return Math.tan((gx+a)/2)}class x8 extends Vy{constructor(n){super(n),this.center=n.center||[0,30];const[o,d]=this.parallels=n.parallels||[30,30];let g=ns(o),w=ns(d);this.southernCenter=g+w<0,this.southernCenter&&(g=-g,w=-w);const S=Math.cos(g),A=yT(g);this.n=g===w?Math.sin(g):Math.log(S/Math.cos(w))/Math.log(yT(w)/A),this.f=S*Math.pow(yT(g),this.n)/this.n}project(n,o){o=ns(o),this.southernCenter&&(o=-o),n=ns(n-this.center[0]);const d=1e-6,{n:g,f:w}=this;w>0?o<-gx+d&&(o=-gx+d):o>gx-d&&(o=gx-d);const S=w/Math.pow(yT(o),g);let A=S*Math.sin(g*n),L=w-S*Math.cos(g*n);return A=.5*(A/Math.PI+.5),L=.5*(L/Math.PI+.5),{x:A,y:this.southernCenter?L:1-L,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:d,f:g}=this,w=g-o,S=Math.sign(w),A=Math.sign(d)*Math.sqrt(n*n+w*w);let L=Math.atan2(n,Math.abs(w))*S;w*d<0&&(L-=Math.PI*Math.sign(n)*S);const N=we(Ja(L/d)+this.center[0],-180,180),q=we(Ja(2*Math.atan(Math.pow(g/A,1/d))-gx),-he,he);return new h(N,this.southernCenter?-q:q)}}class Kk extends Vy{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:B(n),y:G(o),z:0}}unproject(n,o){const d=ee(n),g=ce(o);return new h(d,g)}}const Jk=ns(he);class b8 extends Vy{project(n,o){const d=(o=ns(o))*o,g=d*d;return{x:.5*((n=ns(n))*(.8707-.131979*d+g*(g*(.003971*d-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+d*(.015085+g*(.028874*d-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let d=o=(2*(1-o)-1)*Math.PI,g=25,w=0,S=d*d;do{S=d*d;const N=S*S;w=(d*(1.007226+S*(.015085+N*(.028874*S-.044475-.005916*N)))-o)/(1.007226+S*(.045255+N*(.259866*S-.311325-.005916*11*N))),d=we(d-w,-Jk,Jk)}while(Math.abs(w)>1e-6&&--g>0);S=d*d;const A=we(Ja(n/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),L=Ja(d);return new h(A,L)}}const Qk=ns(he);class w8 extends Vy{project(n,o){o=ns(o),n=ns(n);const d=Math.cos(o),g=2/Math.PI,w=Math.acos(d*Math.cos(n/2)),S=Math.sin(w)/w,A=.5*(n*g+2*d*Math.sin(n/2)/S)||0,L=.5*(o+Math.sin(o)/S)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(n,o){let d=n=(2*n-.5)*Math.PI,g=o=(2*(1-o)-1)*Math.PI,w=25;const S=1e-6;let A=0,L=0;do{const N=Math.cos(g),q=Math.sin(g),Z=2*q*N,Q=q*q,ne=N*N,oe=Math.cos(d/2),me=Math.sin(d/2),Se=2*oe*me,Te=me*me,Le=1-ne*oe*oe,Re=Le?1/Le:0,Ue=Le?Math.acos(N*oe)*Math.sqrt(1/Le):0,rt=.5*(2*Ue*N*me+2*d/Math.PI)-n,Qe=.5*(Ue*q+g)-o,ht=.5*Re*(ne*Te+Ue*N*oe*Q)+1/Math.PI,yt=Re*(Se*Z/4-Ue*q*me),Et=.125*Re*(Z*me-Ue*q*ne*Se),ai=.5*Re*(Q*oe+Ue*Te*N)+.5,kt=yt*Et-ai*ht;A=(Qe*yt-rt*ai)/kt,L=(rt*Et-Qe*ht)/kt,d=we(d-A,-Math.PI,Math.PI),g=we(g-L,-Qk,Qk)}while((Math.abs(A)>S||Math.abs(L)>S)&&--w>0);return new h(Ja(d),Ja(g))}}class eD extends Vy{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ns(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:d,cosPhi:g}=this;return{x:ns(n)*g*d+.5,y:-Math.sin(ns(o))/g*d+.5,z:0}}unproject(n,o){const{scale:d,cosPhi:g}=this,w=-(o-.5)/d,S=we(Ja((n-.5)/d)/g,-180,180),A=Math.asin(we(w*g,-1,1)),L=we(Ja(A),-he,he);return new h(S,L)}}class T8 extends Kk{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,d){const g=S0(n,o,d);return St(g,g,Iv(xh(d))),{x:g[0],y:g[1],z:g[2]}}locationPoint(n,o,d){const g=Zh(o.lat,o.lng),w=Gi([],g),S=d?n._centerAltitude+d:n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude;mr(g,g,w,J(1,0)*Ji*S);const A=ie(new Float64Array(16));return ye(A,n.pixelMatrix,n.globeMatrix),St(g,g,A),new yi(g[0],g[1])}pixelsPerMeter(n,o){return J(1,0)*o}pixelSpaceConversion(n,o,d){const g=J(1,n)*o,w=Gn(J(1,45)*o,g,d);return this.pixelsPerMeter(n,o)/w}createTileMatrix(n,o,d){const g=Pb(xh(d.canonical));return ye(new Float64Array(16),n.globeMatrix,g)}createInversionMatrix(n,o){const{center:d}=n,g=Iv(xh(o));return Ze(g,g,ns(d.lng)),Pe(g,g,ns(d.lat)),Ee(g,g,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(n,o,d,g){return hg(n,o,d,!0)||new Oe(0,0)}pointCoordinate3D(n,o,d){const g=this.pointCoordinate(n,o,d,0);return[g.x,g.y,g.z]}isPointAboveHorizon(n,o){return!hg(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=(function(g,w){const S=g.cameraToCenterDistance,A=g._centerAltitude*w,L=g._camera,N=g._camera.forward(),q=vt([],Fn([],N,-S),[0,0,A]),Z=g.worldSize/(2*Math.PI),Q=[0,0,-Z],ne=g.width/g.height,oe=Math.tan(g.fovAboveCenter),me=Fn([],L.up(),oe),Se=Fn([],L.right(),oe*ne),Te=Gi([],vt([],vt([],N,me),Se)),Le=[];let Re;if(new Pn(q,Te).closestPointOnSphere(Q,Z,Le)){const Ue=vt([],Le,Q),rt=pt([],Ue,q);Re=Math.cos(g.fovAboveCenter)*$t(rt)}else{const Ue=pt([],q,Q),rt=pt([],Q,q);Gi(rt,rt);const Qe=$t(Ue)-Z;Re=Math.sqrt(Qe*(Qe+2*Z));const ht=Math.acos(Re/(Z+Qe))-Math.acos(gn(N,rt));Re*=Math.cos(ht)}return 1.01*Re})(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),d=tm(n.zoom);if(d>0){const g=Xk(n,J(1,n.center.lat)*n.worldSize),w=n.worldSize/(2*Math.PI),S=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Gn(o,g+w*(1-Math.cos(S)),Math.pow(d,10))}return o}upVector(n,o,d){return S0(o,d,n,1)}upVectorScale(n){return{metersToTile:Od(E0(xh(n)))}}}function tD(a){const n=a.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(a.name){case"mercator":return new Kk(a);case"equirectangular":return new v8(a);case"naturalEarth":return new b8(a);case"equalEarth":return new y8(a);case"winkelTripel":return new w8(a);case"albers":return o?new eD(a):new _8(a);case"lambertConformalConic":return o?new eD(a):new x8(a);case"globe":return new T8(a)}throw new Error(`Invalid projection name: ${a.name}`)}const S8=It.types,E8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function C1(a,n,o,d,g,w,S,A,L,N,q,Z,Q){const ne=A?Math.min(I_,Math.round(A[0])):0,oe=A?Math.min(I_,Math.round(A[1])):0;a.emplaceBack(n,o,Math.round(32*d),Math.round(32*g),w,S,(ne<<1)+(L?1:0),0+(oe<<1),16*N,16*q,256*Z,256*Q)}function A1(a,n,o){a.emplaceBack(n,o)}function P1(a,n,o,d,g,w,S){a.emplaceBack(n,o,d,g,w,S)}const vT=(a,n,o,d)=>{for(let g=0;g<n;g++)a.emplaceBack(o[0],o[1],o[2],d[0],d[1],d[2])};function _x(a,n,o,d,g){a.emplaceBack(n,o,d,g),a.emplaceBack(n,o,d,g),a.emplaceBack(n,o,d,g),a.emplaceBack(n,o,d,g)}function I8(a){for(const n of a.sections)if(Xp(n.text))return!0;return!1}class jI{constructor(n){this.layoutVertexArray=new _u,this.indexArray=new $o,this.programConfigurations=n,this.segments=new bo,this.dynamicLayoutVertexArray=new Ml,this.opacityVertexArray=new Uo,this.placedSymbolArray=new _0,this.iconTransitioningVertexArray=new Ws,this.globeExtVertexArray=new Yc,this.zOffsetVertexArray=new ma,this.orientationVertexArray=new Kp,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(n,o){const d=[],g=this.layoutVertexArray.uint16;for(let w=0;w<o;++w){const S=12*(n+w);d.push(...g.slice(S,S+12))}return d}updateIconVertexData(n,o,d,g,w,S,A,L,N,q,Z,Q,ne){const oe=this.layoutVertexArray.uint16,me=12*n;oe[me]=o,oe[me+1]=d,oe[me+2]=g,oe[me+3]=w,oe[me+4]=S,oe[me+5]=A,oe[me+6]=L,oe[me+7]=N,oe[me+8]=q,oe[me+9]=Z,oe[me+10]=Q,oe[me+11]=ne}upload(n,o,d,g,w,S){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Rf.members,!!S),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,aT.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,E8,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,CI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,cx.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||w)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,EI.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=n.createVertexBuffer(this.orientationVertexArray,II.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Cn(jI,"SymbolBuffers");class UI{constructor(n,o,d){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new d,this.segments=new bo,this.collisionVertexArray=new Qm,this.collisionVertexArrayExt=new Ml}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Qc.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,ed.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Cn(UI,"CollisionBuffers");class xT{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((S=>S.fqid)),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ie([]),this.placementViewportMatrix=ie([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=n.worldview,this.localizable=n.localizable,this.textSizeData=dx(this.zoom,o["text-size"],this.worldview),this.iconSizeData=dx(this.zoom,o["icon-size"],this.worldview);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),w=d.get("symbol-z-order");this.lut=n.lut,this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map((S=>td[S])),this.stateDependentLayerIds=this.layers.filter((S=>S.isStateDependent())).map((S=>S.id)),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(n){const o=this.layers[0].getAppearances();return!(!o||o.length===0)&&o.some((d=>d.getProperty(n)!=null))}createArrays(){this.text=new jI(new gc(this.layers,{zoom:this.zoom,lut:this.lut},(n=>n.startsWith("text")||n.startsWith("symbol")))),this.icon=new jI(new gc(this.layers,{zoom:this.zoom,lut:this.lut},(n=>n.startsWith("icon")||n.startsWith("symbol")))),this.glyphOffsetArray=new Cf,this.lineVertexArray=new i_,this.symbolInstances=new y0}calculateGlyphDependencies(n,o,d,g,w){for(const S of n){const A=S.codePointAt(0);if(A===void 0)break;if(o[A]=!0,g&&w&&A<=65535){const L=g1[S];L&&(o[L.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(n,o,d,g,w,S){let A=1;const L=n.getUnevaluatedProperties()._values["icon-size"],N=dx(this.zoom,L,this.worldview),q=fx(N,o);if(N.kind!=="constant"&&N.kind!=="camera"||(A=q.uSize),N.kind==="composite"){const{minZoom:Z,maxZoom:Q}=N,ne=L.possiblyEvaluate(new Us(Z,{worldview:this.worldview}),g),oe=L.possiblyEvaluate(new Us(Q,{worldview:this.worldview}),g),me=ne.evaluate(d,{},g,w);A=me+(oe.evaluate(d,{},g,w)-me)*q.uSizeT}return N.kind==="source"&&(A=L.possiblyEvaluate(new Us(this.zoom,{worldview:this.worldview}),g).evaluate(d,{},g,w)),A*S}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!D0(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}getResolvedImageFromTokens(n){return typeof n=="string"?tl.build(n):n}populate(n,o,d,g){const w=this.layers[0],S=w.layout,A=this.projection.name==="globe",L=S.get("text-font"),N=S.get("text-field"),q=S.get("icon-image"),[Z,Q]=S.get("icon-size-scale-range"),ne=we(o.scaleFactor||1,Z,Q),oe=(N.value.kind!=="constant"||N.value.value instanceof xl&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),me=q.value.kind!=="constant"||!!q.value.value||Object.keys(q.parameters).length>0,Se=this.hasAnyAppearanceProperty("icon-image"),Te=S.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!oe&&!me&&!Se)return;const Le=o.iconDependencies,Re=o.glyphDependencies,Ue=o.availableImages,rt=new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Qe=ht=>{const yt=ht.id.toString();Le.has(yt)?Le.get(yt).push(ht):Le.set(yt,[ht])};for(const ht of n){const{feature:yt,id:Et,index:ai,sourceLayerIndex:kt}=ht,fi=w._featureFilter.needGeometry,Ti=Pt(yt,fi);if(!w._featureFilter.filter(rt,Ti,d))continue;if(fi||(Ti.geometry=mt(yt,d,g)),A&&yt.type!==1&&d.z<=5){const Fi=Ti.geometry,tn=.98078528056,Xi=(Vn,_n)=>gn(S0(Vn.x,Vn.y,d,1),S0(_n.x,_n.y,d,1))<tn;for(let Vn=0;Vn<Fi.length;Vn++)Fi[Vn]=nt(Fi[Vn],Xi)}let Si,Bi;if(oe){const Fi=w.getValueAndResolveTokens("text-field",Ti,d,Ue),tn=xl.factory(Fi);I8(tn)&&(this.hasRTLText=!0),(!this.hasRTLText||Nu()==="unavailable"||this.hasRTLText&&mu.isParsed())&&(Si=xp(tn,w,Ti))}if(me){const Fi=w.getValueAndResolveTokens("icon-image",Ti,d,Ue);Bi=this.getResolvedImageFromTokens(Fi)}const ji=this.layers[0];let zi=!1;if(!Bi&&Se){const Fi=ji.getAppearances();for(const tn of Fi)if(tn.getProperty("icon-image")){const Xi=ji.getAppearanceValueAndResolveTokens(tn,"icon-image",Ti,d,Ue);if(Xi){Bi=this.getResolvedImageFromTokens(Xi),zi=!0;break}}}if(!Si&&!Bi)continue;const Oi=this.sortFeaturesByKey?Te.evaluate(Ti,{},d):void 0,di={id:Et,text:Si,icon:Bi,index:ai,sourceLayerIndex:kt,geometry:Ti.geometry,properties:yt.properties,type:S8[yt.type],sortKey:Oi};if(this.features.push(di),this.featureToAppearanceIndex[ai]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Et,properties:yt.properties,usesAppearanceIconAsPlaceholder:zi,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Bi){const Fi=ji._unevaluatedLayout._values,{iconPrimary:tn,iconSecondary:Xi}=x1(Bi,this.iconSizeData,Fi["icon-size"],d,this.zoom,di,this.pixelRatio,ne,this.worldview);Qe(tn),Xi&&(this.hasAnySecondaryIcon=!0,Qe(Xi))}const ui=ji.getAppearances();if(ui.length!==0&&ui.forEach((Fi=>{if(!Fi.getProperty("icon-image"))return;const tn=this.getCombinedIconPrimary(Fi,ji,Ti,d,Ue,di,ne);tn&&Qe(tn)})),Si){const Fi=L.evaluate(Ti,{},d).join(","),tn=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(td.vertical)>=0;for(const Xi of Si.sections)if(Xi.image){const Vn=Xi.image.getPrimary().scaleSelf(this.pixelRatio),_n=Vn.id.toString(),In=Le.get(_n)||[];In.push(Vn),Le.set(_n,In)}else{const Vn=Gh(Si.toString()),_n=Xi.fontStack||Fi,In=Re[_n]=Re[_n]||{};this.calculateGlyphDependencies(Xi.text,In,tn,this.allowVerticalPlacement,Vn)}}}if(S.get("symbol-placement")==="line"&&(this.features=(function(ht){const yt={},Et={},ai=[];let kt=0;function fi(ji){ai.push(ht[ji]),kt++}function Ti(ji,zi,Oi){const di=Et[ji];return delete Et[ji],Et[zi]=di,ai[di].geometry[0].pop(),ai[di].geometry[0]=ai[di].geometry[0].concat(Oi[0]),di}function Si(ji,zi,Oi){const di=yt[zi];return delete yt[zi],yt[ji]=di,ai[di].geometry[0].shift(),ai[di].geometry[0]=Oi[0].concat(ai[di].geometry[0]),di}function Bi(ji,zi,Oi){const di=Oi?zi[0][zi[0].length-1]:zi[0][0];return`${ji}:${di.x}:${di.y}`}for(let ji=0;ji<ht.length;ji++){const zi=ht[ji],Oi=zi.geometry,di=zi.text?zi.text.toString():null;if(!di){fi(ji);continue}const ui=Bi(di,Oi),Fi=Bi(di,Oi,!0);if(ui in Et&&Fi in yt&&Et[ui]!==yt[Fi]){const tn=Si(ui,Fi,Oi),Xi=Ti(ui,Fi,ai[tn].geometry);delete yt[ui],delete Et[Fi],Et[Bi(di,ai[Xi].geometry,!0)]=Xi,ai[tn].geometry=null}else ui in Et?Ti(ui,Fi,Oi):Fi in yt?Si(ui,Fi,Oi):(fi(ji),yt[ui]=kt-1,Et[Fi]=kt-1)}return ai.filter((ji=>ji.geometry))})(this.features)),S.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ht of o.elevationFeatures)this.elevationFeatureIdToIndex.set(ht.id,this.elevationFeatures.length),this.elevationFeatures.push(ht)}}else S.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((ht,yt)=>ht.sortKey-yt.sortKey))}getCombinedIconPrimary(n,o,d,g,w,S,A){let L,N;const q=n.getUnevaluatedProperties();if(q._values["icon-image"].value!==void 0){const Z=o.getAppearanceValueAndResolveTokens(n,"icon-image",d,g,w);L=this.getResolvedImageFromTokens(Z)}else{const Z=o.getValueAndResolveTokens("icon-image",d,g,w);L=this.getResolvedImageFromTokens(Z)}if(L){const Z=q._values["icon-size"]||o._unevaluatedLayout._values["icon-size"];N=x1(L,dx(this.zoom,Z,this.worldview),Z,g,this.zoom,S,this.pixelRatio,A,this.worldview).iconPrimary}return N}updateAppearanceBasedIconTextures(n,o,d,g){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const w=this.layers[0];let S=!1,A=0;const L=w.layout,[N,q]=L.get("icon-size-scale-range"),Z=we(1,N,q);for(let Q=0;Q<this.symbolInstances.length;Q++){const ne=this.symbolInstances.get(Q),oe=this.featureToAppearanceIndex[ne.featureIndex],me=oe!==void 0?this.appearanceFeatureData[oe]:void 0;if(me&&ne.placedIconSymbolIndex>=0){const Se=me.id,Te=o&&Se!==void 0?o[String(Se)]:void 0,Le={type:"Point",id:me.id,properties:me.properties,geometry:[]},Re=this.layers[0].appearances&&this.layers[0].appearances.find((Ue=>Ue.isActive({globals:g,feature:Le,canonical:n,featureState:Te})));if(me.activeAppearance===Re){A+=ne.numIconVertices;continue}if(Re){me.activeAppearance=Re;const Ue=this.getCombinedIconPrimary(Re,w,Le,n,d,{sortKey:void 0,text:void 0,icon:null,index:ne.featureIndex,sourceLayerIndex:ne.featureIndex,geometry:[],properties:me.properties,type:"Point",id:me.id},Z);if(!Ue)continue;const rt=Ue.toString(),Qe=this.iconAtlasPositions&&this.iconAtlasPositions.get(rt);if(Qe){const ht=w.getAppearanceValueAndResolveTokens(Re,"icon-offset",Le,n,d),yt=ht&&Array.isArray(ht)?ht:[0,0];let Et=uT(Qe,void 0,yt,w.layout.get("icon-anchor").evaluate(Le,{},n));const ai=w.getAppearanceValueAndResolveTokens(Re,"icon-rotate",Le,n,d),kt=typeof ai=="number"?ai:0,fi=Qe.sdf,Ti=w.layout.get("icon-text-fit").constantOr("none");Ti!=="none"&&me.textShaping&&me.iconTextFitPadding&&me.fontScale&&(Et=LI(Et,me.textShaping,Ti,me.iconTextFitPadding,yt,me.fontScale));const Si=this.calculateEffectiveAppearanceIconSize(Re,g.zoom,Le,n,d,Z),Bi=0,ji=1+(Math.min(I_,Math.round(Si*um))<<1),zi=FI(Et,kt,fi,Ti!=="none",Z);me.isUsingAppearanceVertexData||(me.isUsingAppearanceVertexData=!0,me.layoutBasedVertexData=this.icon.getIconVertexData(A,ne.numIconVertices));for(let di=0;di<zi.length;++di){const ui=zi[di],Fi=me.layoutBasedVertexData[0]||ne.tileAnchorX,tn=me.layoutBasedVertexData[1]||ne.tileAnchorY,Xi=16*ui.pixelOffsetTL.x,Vn=16*ui.pixelOffsetTL.y,_n=16*ui.pixelOffsetBR.x,In=16*ui.pixelOffsetBR.y,Dn=16*ui.minFontScaleX,jr=16*ui.minFontScaleY;this.icon.updateIconVertexData(A,Fi,tn,Math.round(32*ui.tl.x),Math.round(32*ui.tl.y),ui.texPrimary.x,ui.texPrimary.y,Bi,ji,Xi,Vn,Dn,jr),this.icon.updateIconVertexData(A+1,Fi,tn,Math.round(32*ui.tr.x),Math.round(32*ui.tr.y),ui.texPrimary.x+ui.texPrimary.w,ui.texPrimary.y,Bi,ji,_n,Vn,Dn,jr),this.icon.updateIconVertexData(A+2,Fi,tn,Math.round(32*ui.bl.x),Math.round(32*ui.bl.y),ui.texPrimary.x,ui.texPrimary.y+ui.texPrimary.h,Bi,ji,Xi,In,Dn,jr),this.icon.updateIconVertexData(A+3,Fi,tn,Math.round(32*ui.br.x),Math.round(32*ui.br.y),ui.texPrimary.x+ui.texPrimary.w,ui.texPrimary.y+ui.texPrimary.h,Bi,ji,_n,In,Dn,jr),A+=4}const Oi=ne.numIconVertices-4*zi.length;for(let di=0;di<Oi;++di)this.icon.updateIconVertexData(A+di,0,0,0,0,0,0,0,0,0,0,0,0);S=!0}else A+=ne.numIconVertices}else if(me.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(A,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+3,0,0,0,0,0,0,0,0,0,0,0,0),S=!0),A+=ne.numIconVertices,me.activeAppearance=null;else if(me.isUsingAppearanceVertexData){const rt=me.layoutBasedVertexData.length/12;for(let Qe=0;Qe<rt;++Qe){const ht=Qe*12;this.icon.updateIconVertexData(A+Qe,me.layoutBasedVertexData[ht+0],me.layoutBasedVertexData[ht+1],me.layoutBasedVertexData[ht+2],me.layoutBasedVertexData[ht+3],me.layoutBasedVertexData[ht+4],me.layoutBasedVertexData[ht+5],me.layoutBasedVertexData[ht+6],me.layoutBasedVertexData[ht+7],me.layoutBasedVertexData[ht+8],me.layoutBasedVertexData[ht+9],me.layoutBasedVertexData[ht+10],me.layoutBasedVertexData[ht+11])}A+=rt,me.isUsingAppearanceVertexData=!1,me.activeAppearance=null,S=!0}else A+=ne.numIconVertices,me.activeAppearance=null}}return S}update(n,o,d,g,w,S,A){this.text.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,this.worldview),this.icon.programConfigurations.updatePaintArrays(n,o,w,d,g,S,A,this.worldview)}updateRoadElevation(n){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const d=Ae(n),g=1/d;let w=!1,S=!1;for(let A=0;A<this.symbolInstances.length;A++){const L=this.symbolInstances.get(A),N=Dt(1,0,0),q=Dt(0,1,0),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:Q,numIconVertices:ne,numVerticalIconVertices:oe}=L,me=Z>0||Q>0,Se=ne>0,Te=this.elevationFeatures[L.elevationFeatureIndex];if(Te){const Le=new yi(L.tileAnchorX,L.tileAnchorY),Re=.075+Te.pointElevation(Le);L.zOffset!==Re&&(o=!0,L.zOffset=Re),Re!==0&&(this.hasAnyZOffset=!0);const Ue=Te.computeSlopeNormal(Le,g),rt=gi(Ii(),Dt(0,0,1),Ue);Ai(N,N,rt),Ai(q,q,rt),N[2]*=d,q[2]*=d,N[0]===1&&N[1]===0&&N[2]===0&&q[0]===0&&q[1]===1&&q[2]===0||(w=w||me,S=S||Se)}if(me&&(vT(this.text.orientationVertexArray,Z,N,q),vT(this.text.orientationVertexArray,Q,N,q)),Se){const{placedIconSymbolIndex:Le,verticalPlacedIconSymbolIndex:Re}=L;Le>=0&&vT(this.icon.orientationVertexArray,ne,N,q),Re>=0&&vT(this.icon.orientationVertexArray,oe,N,q)}}w||(this.text.orientationVertexArray=void 0),S||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const n=(w,S,A)=>{d+=S,d>w.length&&w.resize(d);for(let L=-S;L<0;L++)w.emplace(L+d,A)},o=(w,S,A)=>{g+=S,g>w.length&&w.resize(g);for(let L=-S;L<0;L++)w.emplace(L+g,A)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,g=0;for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:L,numIconVertices:N}=S,q=S.zOffset,Z=N>0;if((A>0||L>0)&&(n(this.text.zOffsetVertexArray,A,q),n(this.text.zOffsetVertexArray,L,q)),Z){const{placedIconSymbolIndex:Q,verticalPlacedIconSymbolIndex:ne}=S;Q>=0&&o(this.icon.zOffsetVertexArray,N,q),ne>=0&&o(this.icon.zOffsetVertexArray,S.numVerticalIconVertices,q)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n,o,d,g,w){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((S=>S.appearances&&S.appearances.length>0))),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(n,o,d,g){return!!(n&&o&&d)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(n,o,d,g)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const d=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:g,y:w}of o)this.lineVertexArray.emplaceBack(g,w);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me,Se,Te,Le){const Re=n.indexArray,Ue=n.layoutVertexArray,rt=n.globeExtVertexArray,Qe=n.segments.prepareSegment(4*Le,Ue,Re,this.canOverlap?S.sortKey:void 0),ht=this.glyphOffsetArray.length,yt=Qe.vertexLength,Et=this.allowVerticalPlacement&&A===td.vertical?Math.PI/2:0,ai=S.text&&S.text.sections;for(let Ti=0;Ti<o.length;Ti++){const{tl:Si,tr:Bi,bl:ji,br:zi,texPrimary:Oi,texSecondary:di,pixelOffsetTL:ui,pixelOffsetBR:Fi,minFontScaleX:tn,minFontScaleY:Xi,glyphOffset:Vn,isSDF:_n,sectionIndex:In}=o[Ti],Dn=Qe.vertexLength,jr=Vn[1];if(C1(Ue,N.x,N.y,Si.x,jr+Si.y,Oi.x,Oi.y,d,_n,ui.x,ui.y,tn,Xi),C1(Ue,N.x,N.y,Bi.x,jr+Bi.y,Oi.x+Oi.w,Oi.y,d,_n,Fi.x,ui.y,tn,Xi),C1(Ue,N.x,N.y,ji.x,jr+ji.y,Oi.x,Oi.y+Oi.h,d,_n,ui.x,Fi.y,tn,Xi),C1(Ue,N.x,N.y,zi.x,jr+zi.y,Oi.x+Oi.w,Oi.y+Oi.h,d,_n,Fi.x,Fi.y,tn,Xi),L){const{x:Ki,y:Rn,z:wr}=L.anchor,[os,ds,Mr]=L.up;P1(rt,Ki,Rn,wr,os,ds,Mr),P1(rt,Ki,Rn,wr,os,ds,Mr),P1(rt,Ki,Rn,wr,os,ds,Mr),P1(rt,Ki,Rn,wr,os,ds,Mr),_x(n.dynamicLayoutVertexArray,Ki,Rn,wr,Et)}else _x(n.dynamicLayoutVertexArray,N.x,N.y,N.z,Et);if(Se){const Ki=di||Oi;A1(n.iconTransitioningVertexArray,Ki.x,Ki.y),A1(n.iconTransitioningVertexArray,Ki.x+Ki.w,Ki.y),A1(n.iconTransitioningVertexArray,Ki.x,Ki.y+Ki.h),A1(n.iconTransitioningVertexArray,Ki.x+Ki.w,Ki.y+Ki.h)}Re.emplaceBack(Dn,Dn+1,Dn+2),Re.emplaceBack(Dn+1,Dn+2,Dn+3),Qe.vertexLength+=4,Qe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vn[0]),Ti!==o.length-1&&In===o[Ti+1].sectionIndex||n.programConfigurations.populatePaintArrays(Ue.length,S,S.index,{},ne,oe,me,ai&&ai[In],this.worldview)}const kt=Le-o.length;kt!==0&&this._addNullVertices(kt,Ue,d,L,rt,n,Se,Qe,Re);const fi=L?L.anchor:N;n.placedSymbolArray.emplaceBack(fi.x,fi.y,fi.z,N.x,N.y,ht,this.glyphOffsetArray.length-ht,yt,q,Z,N.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],A,0,0,0,Q,0),n.symbolInstanceIndices.push(Te)}_addNullVertices(n,o,d,g,w,S,A,L,N){for(let q=0;q<n;q++){for(let Q=0;Q<4;Q++)C1(o,0,0,0,0,0,0,d,!1,0,0,0,0),g&&P1(w,0,0,0,0,0,0),_x(S.dynamicLayoutVertexArray,0,0,0,0),A&&A1(S.iconTransitioningVertexArray,0,0);const Z=L.vertexLength;N.emplaceBack(Z,Z+1,Z+2),N.emplaceBack(Z+1,Z+2,Z+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(n,o,d,g,w,S,A){n.emplaceBack(o,d,g,w,S,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(n,o,d,g,w,S,A){const L=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),N=L.vertexLength,q=A.tileAnchorX,Z=A.tileAnchorY;for(let ne=0;ne<4;ne++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,o,n.padding,A.zOffset),this._commitLayoutVertex(d.layoutVertexArray,g,w,S,q,Z,new yi(n.x1,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,w,S,q,Z,new yi(n.x2,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,w,S,q,Z,new yi(n.x2,n.y2)),this._commitLayoutVertex(d.layoutVertexArray,g,w,S,q,Z,new yi(n.x1,n.y2)),L.vertexLength+=4;const Q=d.indexArray;Q.emplaceBack(N,N+1),Q.emplaceBack(N+1,N+2),Q.emplaceBack(N+2,N+3),Q.emplaceBack(N+3,N),L.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,d,g,w,S){for(let A=g;A<w;A++){const L=d.get(A),N=this.getSymbolInstanceTextSize(n,S,o,A);this._addCollisionDebugVertices(L,N,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(n,o,d,g,w,S){for(let A=g;A<w;A++){const L=d.get(A),N=this.getSymbolInstanceIconSize(n,o,S.placedIconSymbolIndex);this._addCollisionDebugVertices(L,N,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,S)}}generateCollisionDebugBuffers(n,o,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new UI(qa,mg.members,Ws),this.iconCollisionBox=new UI(qa,mg.members,Ws);const g=fx(this.iconSizeData,n),w=fx(this.textSizeData,n,d);for(let S=0;S<this.symbolInstances.length;S++){const A=this.symbolInstances.get(S);this._addTextDebugCollisionBoxes(w,n,o,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(w,n,o,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(g,n,o,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(g,n,o,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(n,o,d,g){const w=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:g),S=RI(this.textSizeData,n,w)/ca;return this.tilePixelRatio*S}getSymbolInstanceIconSize(n,o,d){const g=this.icon.placedSymbolArray.get(d),w=RI(this.iconSizeData,n,g);return this.tilePixelRatio*w}_commitDebugCollisionVertexUpdate(n,o,d,g){n.emplaceBack(o,-d,-d,g),n.emplaceBack(o,d,-d,g),n.emplaceBack(o,d,d,g),n.emplaceBack(o,-d,d,g)}_updateTextDebugCollisionBoxes(n,o,d,g,w,S,A){for(let L=g;L<w;L++){const N=d.get(L),q=this.getSymbolInstanceTextSize(n,S,o,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,q,N.padding,S.zOffset)}}_updateIconDebugCollisionBoxes(n,o,d,g,w,S,A){for(let L=g;L<w;L++){const N=d.get(L),q=this.getSymbolInstanceIconSize(n,o,S.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,q,N.padding,S.zOffset)}}updateCollisionDebugBuffers(n,o,d,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const w=fx(this.iconSizeData,n,g),S=fx(this.textSizeData,n,d);for(let A=0;A<this.symbolInstances.length;A++){const L=this.symbolInstances.get(A);this._updateTextDebugCollisionBoxes(S,n,o,L.textBoxStartIndex,L.textBoxEndIndex,L,d),this._updateTextDebugCollisionBoxes(S,n,o,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,d),this._updateIconDebugCollisionBoxes(w,n,o,L.iconBoxStartIndex,L.iconBoxEndIndex,L,g),this._updateIconDebugCollisionBoxes(w,n,o,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,d,g,w,S,A,L,N){const q={};if(o<d){const{x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue,featureIndex:rt}=n.get(o);q.textBox={x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue},q.textFeatureIndex=rt}if(g<w){const{x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue,featureIndex:rt}=n.get(g);q.verticalTextBox={x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue},q.verticalTextFeatureIndex=rt}if(S<A){const{x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue,featureIndex:rt}=n.get(S);q.iconBox={x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue},q.iconFeatureIndex=rt}if(L<N){const{x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue,featureIndex:rt}=n.get(L);q.verticalIconBox={x1:Z,y1:Q,x2:ne,y2:oe,padding:me,projectedAnchorX:Se,projectedAnchorY:Te,projectedAnchorZ:Le,tileAnchorX:Re,tileAnchorY:Ue},q.verticalIconFeatureIndex=rt}return q}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const d=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const d=n.placedSymbolArray.get(o),g=d.vertexStartIndex+4*d.numGlyphs;for(let w=d.vertexStartIndex;w<g;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),d=Math.cos(n),g=[],w=[],S=[];for(let A=0;A<this.symbolInstances.length;++A){S.push(A);const L=this.symbolInstances.get(A);g.push(0|Math.round(o*L.tileAnchorX+d*L.tileAnchorY)),w.push(L.featureIndex)}return S.sort(((A,L)=>g[A]-g[L]||w[L]-w[A])),S}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset))}addToSortKeyRanges(n,o){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===o?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const d=this.symbolInstances.get(o);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:w,leftJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:N}=d;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&w!==g&&this.addIndicesForPlacedSymbol(this.text,w),S>=0&&S!==w&&S!==g&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(n){const o=this.symbolInstances.get(this.text.symbolInstanceIndices[n]).elevationFeatureIndex;let d;return this.elevationFeatures&&o<this.elevationFeatures.length&&(d=this.elevationFeatures[o]),d}}function iD(a,n){return n.replace(/{([^{}]+)}/g,((o,d)=>d in a?String(a[d]):""))}let nD,rD,$I;Cn(xT,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),xT.addDynamicAttributes=_x;class sD{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:dc,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Cn(sD,"FormatSectionOverride",{omit:["defaultValue"]});const GI=()=>$I||($I={layout:nD||(nD=new xe({"symbol-placement":new K(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new K(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new K(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new K(fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new K(fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new K(fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new K(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new K(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new K(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new K(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(fe.layout_symbol["icon-size"]),"icon-size-scale-range":new K(fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new te(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new te(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(fe.layout_symbol["icon-image"]),"icon-image-use-theme":new K({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new te(fe.layout_symbol["icon-rotate"]),"icon-padding":new K(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new K(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new te(fe.layout_symbol["icon-offset"]),"icon-anchor":new te(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new K(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new K(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new K(fe.layout_symbol["text-rotation-alignment"]),"text-field":new te(fe.layout_symbol["text-field"]),"text-font":new te(fe.layout_symbol["text-font"]),"text-size":new te(fe.layout_symbol["text-size"]),"text-size-scale-range":new K(fe.layout_symbol["text-size-scale-range"]),"text-max-width":new te(fe.layout_symbol["text-max-width"]),"text-line-height":new te(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new te(fe.layout_symbol["text-letter-spacing"]),"text-justify":new te(fe.layout_symbol["text-justify"]),"text-radial-offset":new te(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new K(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new te(fe.layout_symbol["text-anchor"]),"text-max-angle":new K(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new K(fe.layout_symbol["text-writing-mode"]),"text-rotate":new te(fe.layout_symbol["text-rotate"]),"text-padding":new K(fe.layout_symbol["text-padding"]),"text-keep-upright":new K(fe.layout_symbol["text-keep-upright"]),"text-transform":new te(fe.layout_symbol["text-transform"]),"text-offset":new te(fe.layout_symbol["text-offset"]),"text-allow-overlap":new K(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new K(fe.layout_symbol["text-ignore-placement"]),"text-optional":new K(fe.layout_symbol["text-optional"]),visibility:new K(fe.layout_symbol.visibility)})),paint:rD||(rD=new xe({"icon-opacity":new te(fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new te(fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new te(fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new te(fe.paint_symbol["text-emissive-strength"]),"icon-color":new te(fe.paint_symbol["icon-color"]),"icon-halo-color":new te(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new K(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new K(fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new K(fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new te(fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new te(fe.paint_symbol["text-occlusion-opacity"]),"text-color":new te(fe.paint_symbol["text-color"],{runtimeType:Yl,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new te(fe.paint_symbol["text-halo-color"]),"text-halo-width":new te(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new te(fe.paint_symbol["text-halo-blur"]),"text-translate":new K(fe.paint_symbol["text-translate"]),"text-translate-anchor":new K(fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new K(fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new K(fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new K(fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new K(fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new te(fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},$I);class bT extends Ps{constructor(n,o,d,g){super(n,GI(),o,d,g,n.layout?n.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ie([]),this.hasOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}_handleSpecialPaintPropertyUpdate(n){n!=="icon-occlusion-opacity"&&n!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(n,o){super.recalculate(n,o),this.appearances&&this.appearances.forEach((g=>{g.recalculate(n,o,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const w of d)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,d,g){return this._saturation===n&&this._contrast===o&&this._brightnessMin===d&&this._brightnessMax===g||(this._colorAdjustmentMatrix=(function(w,S,A,L){w=ao(w),S=Wr(S);const N=ae(),q=w/3,Z=1-2*q,Q=[Z,q,q,0,q,Z,q,0,q,q,Z,0,0,0,0,1],ne=.5-.5*S,oe=L-A;return ye(N,[oe,0,0,0,0,oe,0,0,0,0,oe,0,A,A,A,1],[S,0,0,0,0,S,0,0,0,0,S,0,ne,ne,ne,1]),ye(N,N,Q),N})(n,o,d,g),this._saturation=n,this._contrast=o,this._brightnessMin=d,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,d,g){const w=this.layout.get(n).evaluate(o,{},d,g),S=this._unevaluatedLayout._values[n];return S.isDataDriven()||pc(S.value)||!w?w:iD(o.properties,w)}getAppearanceValueAndResolveTokens(n,o,d,g,w){const S=n.getProperty(o);if(!S)return;const A=S.evaluate(d,{},g,w),L=n.getUnevaluatedProperties()._values[o];return L.isDataDriven()||pc(L.value)||!A||typeof A!="string"?A:iD(d.properties,A)}createBucket(n){return new xT(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of GI().paint.overridableProperties){if(!bT.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),d=new sD(o),g=new Zp(d,o.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let w=null;w=o.value.kind==="constant"||o.value.kind==="source"?new vr("source",g):new Cr("composite",g,o.value.zoomStops,o.value.interpolationType),this.paint._values[n]=new j(o.property,w,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,d){return!(!this.layout||o.isDataDriven()||d.isDataDriven())&&bT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const d=n.get("text-field"),g=GI().paint.properties[o];let w=!1;const S=A=>{for(const L of A)if(g.overrides&&g.overrides.hasOverride(L))return void(w=!0)};if(d.value.kind==="constant"&&d.value.value instanceof xl)S(d.value.value.sections);else if(d.value.kind==="source"){const A=N=>{w||(N instanceof Pu&&Oa(N.value)===eh?S(N.value.sections):N instanceof Mu?S(N.sections):N.eachChild(A))},L=d.value;L._styleExpression&&A(L._styleExpression.expression)}return w}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,o,d){return{config:new Pf(this,{zoom:o,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let oD,aD,lD,cD;var qI=hr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function wT(a,n,o,d,g,w,S,A){const L=[a,n,1,o,d,1,g,w,1],N=[S,A,1],q=W([],L),[Z,Q,ne]=Gt(N,N,q);return Y(L,L,[Z,0,0,0,Q,0,0,0,ne])}function uD(a,n,o,d,g,w,S,A){const L=(function(N,q,Z,Q,ne,oe,me,Se){const Te=wT(0,0,1,0,1,1,0,1),Le=wT(N,q,Z,Q,ne,oe,me,Se);return Y(Le,Le,W([],Te))})(a,n,o,d,g,w,S,A);return[L[2]/L[8]/Ji,L[5]/L[8]/Ji]}function TT(a){return[a[0],Math.min(Math.max(a[1],-he),he)]}class hD extends Au{constructor(n,o,d,g){super(),this.id=n,this.dispatcher=d,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Cs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Kd(this.map._requestManager.transformRequest(this.url,ou.Image),((d,g)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new ms(d)):g&&(this.image=g instanceof HTMLImageElement?Ta.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())}))}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new w_(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Cs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof w_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],d=n[0][1];for(const w of n)w[1]>d&&(d=w[1]),w[1]<o&&(o=w[1]);const g=(d+o)/2;if(g>he?this.onNorthPole=!0:g<-he&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const w=n.map(Oe.fromLngLat);this.tileID=(function(S){let A=1/0,L=1/0,N=-1/0,q=-1/0;for(const me of S)A=Math.min(A,me.x),L=Math.min(L,me.y),N=Math.max(N,me.x),q=Math.max(q,me.y);const Z=Math.max(N-A,q-L),Q=Math.max(0,Math.floor(-Math.log2(Z))),ne=Math.pow(2,Q);let oe=Math.floor((A+N)/2*ne);return oe>1&&(oe-=1),new Ds(Q,oe,Math.floor((L+q)/2*ne))})(w),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Cs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof w_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const Te in this.tiles){const Le=this.tiles[Te];Le.state!=="loaded"&&(Le.state="loaded",Le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=w1(new Ds(0,0,0),this.map.transform.projection),d=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(Te){const Le=Te[1].x-Te[0].x,Re=Te[1].y-Te[0].y,Ue=Te[2].x-Te[1].x,rt=Te[2].y-Te[1].y,Qe=Te[3].x-Te[2].x,ht=Te[3].y-Te[2].y,yt=Te[0].x-Te[3].x,Et=Te[0].y-Te[3].y,ai=Le*rt-Ue*Re,kt=Ue*ht-Qe*rt,fi=Qe*Et-yt*ht,Ti=yt*Re-Le*Et;return ai>0&&kt>0&&fi>0&&Ti>0||ai<0&&kt<0&&fi<0&&Ti<0})(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=w1(this.tileID,this.map.transform.projection),[w,S,A,L]=this.coordinates.map((Te=>{const Le=g.projection.project(Te[0],Te[1]);return Yk(g,Le)._round()}));this.perspectiveTransform=uD(w.x,w.y,S.x,S.y,A.x,A.y,L.x,L.y);const N=this._boundsArray=new na;N.emplaceBack(w.x,w.y,0,0),N.emplaceBack(S.x,S.y,Ji,0),N.emplaceBack(L.x,L.y,0,Ji),N.emplaceBack(A.x,A.y,Ji,Ji),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(N,qI.members),this.boundsSegments=bo.simpleSegment(0,0,4,2);const q=[],Z=[TT((Q=this.coordinates)[0]),TT(Q[1]),TT(Q[2]),TT(Q[3])];var Q;const[ne,oe,me,Se]=(function(Te){let Le=Te[0][0],Re=Le,Ue=Te[0][1],rt=Ue;for(let Qe=1;Qe<Te.length;Qe++)Te[Qe][0]<Le?Le=Te[Qe][0]:Te[Qe][0]>Re&&(Re=Te[Qe][0]),Te[Qe][1]<Ue?Ue=Te[Qe][1]:Te[Qe][1]>rt&&(rt=Te[Qe][1]);return[Le,Ue,Re-Le,rt-Ue]})(Z);{const Te=new na,[Le,Re,Ue,rt]=(function(zi){let Oi=zi[0].x,di=Oi,ui=zi[0].y,Fi=ui;for(let tn=1;tn<zi.length;tn++)zi[tn].x<Oi?Oi=zi[tn].x:zi[tn].x>di&&(di=zi[tn].x),zi[tn].y<ui?ui=zi[tn].y:zi[tn].y>Fi&&(Fi=zi[tn].y);return[Oi,ui,di-Oi,Fi-ui]})(d),Qe=zi=>[(zi.x-Le)/Ue,(zi.y-Re)/rt],[ht,yt,Et,ai]=d.map(Qe),kt=(function(zi,Oi,di,ui,Fi,tn,Xi,Vn){const _n=wT(0,0,1,0,1,1,0,1);return Y(_n,_n,W([],wT(zi,Oi,di,ui,Fi,tn,Xi,Vn)))})(ht[0],ht[1],yt[0],yt[1],Et[0],Et[1],ai[0],ai[1]);this.elevatedGlobePerspectiveTransform=uD(ht[0],ht[1],yt[0],yt[1],Et[0],Et[1],ai[0],ai[1]);const fi=(zi,Oi)=>{q.push(zi.lng);const di=Math.round((zi.lng-ne)/me*Ji),ui=Math.round((zi.lat-oe)/Se*Ji),Fi=Qe(Oi),tn=Gt([],[Fi[0],Fi[1],1],kt),Xi=Math.round(tn[0]/tn[2]*Ji),Vn=Math.round(tn[1]/tn[2]*Ji);Te.emplaceBack(di,ui,Xi,Vn)},Ti=d[3].x-d[0].x,Si=d[3].y-d[0].y,Bi=d[2].x-d[1].x,ji=d[2].y-d[1].y;for(let zi=0;zi<65;zi++){const Oi=zi/64,di=[d[0].x+Oi*Ti,d[0].y+Oi*Si],ui=[d[1].x+Oi*Bi,d[1].y+Oi*ji],Fi=ui[0]-di[0],tn=ui[1]-di[1];for(let Xi=0;Xi<65;Xi++){const Vn=Xi/64,_n={x:di[0]+Fi*Vn,y:di[1]+tn*Vn};fi(o.projection.unproject(_n.x,_n.y),_n)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(Te,qI.members)}{this.maxLongitudeTriangleSize=0;let Te=[],Le=new $o;const Re=(Ue,rt,Qe)=>{Le.emplaceBack(Ue,rt,Qe);const ht=q[Ue],yt=q[rt],Et=q[Qe],ai=Math.min(Math.min(ht,yt),Et),kt=Math.max(Math.max(ht,yt),Et)-ai;kt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=kt),Te.push(ai+kt/2)};for(let Ue=0;Ue<64;Ue++)for(let rt=0;rt<64;rt++){const Qe=65*Ue+rt,ht=Qe+1,yt=Qe+65,Et=yt+1;Re(Qe,yt,ht),Re(ht,yt,Et)}[Te,Le]=(function(Ue,rt){const Qe=Array.from({length:Ue.length},((Et,ai)=>ai));Qe.sort(((Et,ai)=>Ue[Et]-Ue[ai]));const ht=[],yt=new $o;for(let Et=0;Et<Qe.length;Et++){const ai=Qe[Et];ht.push(Ue[ai]);const kt=3*ai,fi=kt+1;yt.emplaceBack(rt.uint16[kt],rt.uint16[fi],rt.uint16[fi+1])}return[ht,yt]})(Te,Le),this.elevatedGlobeTrianglesCenterLongitudes=Te,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(Le)}this.elevatedGlobeSegments=bo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,me/Ji,0,Se/Ji,0,0,oe,ne,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,d=o.gl;!this._dirty||this.texture instanceof w_||(this.texture?this.texture.update(this.image):(this.texture=new j0(o,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let g=(w=n+180)+360*Math.round((d[0]-w)/360);var w;const S=new bo,A=(Z,Q)=>{S.segments.push({vertexOffset:0,primitiveOffset:Z,vertexLength:o.segments[0].vertexLength,primitiveLength:Q,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-g)<=L){const Z=go(d,0,d.length,g+L);return Z===d.length||A(Z,po(d,Z+1,d.length,g+360-L)-Z),S}g<d[0]&&(g+=360);const N=po(d,0,d.length,g-L);if(N===d.length)return A(0,d.length),S;A(0,N-0);const q=go(d,N+1,d.length,g+L);return q!==d.length&&A(q,d.length-q),S}}const C8=(Math.pow(256,2)-1)/16907520;class dD extends Ps{constructor(n,o,d,g){super(n,{layout:lD||(lD=new xe({visibility:new K(fe.layout_raster.visibility)})),paint:cD||(cD=new xe({"raster-opacity":new K(fe.paint_raster["raster-opacity"]),"raster-color":new ge(fe.paint_raster["raster-color"]),"raster-color-mix":new K(fe.paint_raster["raster-color-mix"]),"raster-color-range":new K(fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new K(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new K(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new K(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new K(fe.paint_raster["raster-saturation"]),"raster-contrast":new K(fe.paint_raster["raster-contrast"]),"raster-resampling":new K(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new K(fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new K(fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new K(fe.paint_raster["raster-array-band"]),"raster-elevation":new K(fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},o,d,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof hD&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[d,g]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(g)||d===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=Fd({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,g])}}let fD,pD,mD,gD,_D;class yD extends Ps{constructor(n,o,d,g){super(n,{layout:fD||(fD=new xe({visibility:new K(fe["layout_raster-particle"].visibility)})),paint:pD||(pD=new xe({"raster-particle-array-band":new K(fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new K(fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ge(fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new K(fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new K(fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new K(fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new K(fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new K(fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},o,d,g),this._updateColorRamp(),this.lastInvalidatedAt=Ta.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Fd({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ta.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class A8 extends Ps{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(n){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function HI(a,n,o){const d=[0,0,1],g=qt([]);return Ge(g,g,o?-ns(a)+Math.PI:ns(a)),Ne(g,g,-ns(n)),Ai(d,d,g),Gi(d,d)}const vD={None:0,Model:1,Symbol:2,FillExtrusion:4};class ST{constructor(n,o,d,g){this.message=(n?`${n}: `:"")+d,g&&(this.identifier=g),o!=null&&o.__line__&&(this.line=o.__line__)}}function WI(a,n){const o=a.indexOf("://")===-1;try{return new URL(a,o&&n?"http://example.com":void 0),!0}catch{return!1}}class xD{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class bD{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new tg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(n){const o=16*n,d=this.instancedDataArray.float32;let g=Math.floor(d[o+2]);const w=1.05*(d[o+2]-g);return g/=100,[d[o]%1*1.05,d[o+1]%1*1.05,w,g]}tileCoordinatesForInstance(n){const o=16*n,d=this.instancedDataArray.float32;let g=d[o+0];return g=g>Ji?g-Ji:g,new yi(Math.trunc(g),Math.trunc(d[o+1]))}translationForInstance(n){const o=16*n,d=this.instancedDataArray.float32;return[d[o+4],d[o+5],d[o+6]]}rotationScaleForInstance(n){const o=16*n,d=this.instancedDataArray.float32;return[d[o+7],d[o+8],d[o+9],d[o+10],d[o+11],d[o+12],d[o+13],d[o+14],d[o+15]]}transformForInstance(n){const o=16*n,d=this.instancedDataArray.float32;return[d[o+7],d[o+8],d[o+9],d[o+4],d[o+10],d[o+11],d[o+12],d[o+5],d[o+13],d[o+14],d[o+15],d[o+6],0,0,0,1]}}class ZI{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaledZ=this.canonical.z+Math.log2(n.overscaling),this.layers=n.layers,this.layerIds=this.layers.map((o=>o.fqid)),this.projection=n.projection,this.index=n.index,this.worldview=n.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=n.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(n,o){}updateAppearances(n,o,d,g){}populate(n,o,d,g){this.tileToMeter=Ae(d);const w=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:S,id:A,index:L,sourceLayerIndex:N}of n){const q=A??(S.properties&&S.properties.hasOwnProperty("id")?S.properties.id:void 0),Z=Pt(S,w);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom,{worldview:this.worldview,activeFloors:o.activeFloors}),Z,d))continue;const Q={id:q,sourceLayerIndex:N,index:L,geometry:w?Z.geometry:mt(S,d,g),properties:S.properties,type:S.type,patterns:{}},ne=this.addFeature(Q,Q.geometry,Z);ne&&o.featureIndex.insert(S,Q.geometry,L,N,this.index,this.instancesPerModel[ne].instancedDataArray.length,Ji/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const n=this.layers[0].modelManager,o=this.layers[0].scope;let d=0;for(const g of this.modelUris){const w=n.getModel(g,o);if(!w)continue;const S=this.instancesPerModel[g];if(S){const A=.5*Sr(w.aabb.max,w.aabb.min)*S.maxScale+S.maxXYTranslationDistance,L=Math.min(Ji,Math.max(A/this.tileToMeter,Ji/32));d=Math.max(L,d)}}return d}update(n,o,d,g){for(const w in this.instancesPerModel){const S=this.instancesPerModel[w];for(const A in n)S.idToFeaturesIndex.hasOwnProperty(A)&&(this.evaluate(S.features[S.idToFeaturesIndex[A]],n[A],S,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const d=this.instancesPerModel[o];for(const g of d.features){const w=this.layers[0],S=g.feature,A=this.canonical,L=w.paint.get("model-rotation").evaluate(S,{},A),N=w.paint.get("model-scale").evaluate(S,{},A),q=w.paint.get("model-translation").evaluate(S,{},A);Ui(g.rotation,L)&&Ui(g.scale,N)&&Ui(g.translation,q)||(this.evaluate(g,g.featureStates,d,!0),n=!0)}}return n}updateReplacement(n,o,d,g){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const w=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(D0(this.activeReplacements,w))return!1;this.activeReplacements=w;let S=!1;for(const A in this.instancesPerModel){const L=this.instancesPerModel[A],N=L.instancedDataArray;for(const q of L.features){const Z=q.instancedDataOffset,Q=q.instancedDataCount;for(let ne=0;ne<Q;ne++){const oe=16*(ne+Z);let me=N.float32[oe+0];const Se=me>Ji;me=Se?me-Ji:me;const Te=Math.floor(me),Le=Math.floor(N.float32[oe+1]);let Re=!1;for(const Ue of this.activeReplacements)if(!__(Ue,d,vD.Model,g)&&!(Ue.min.x>Te||Te>Ue.max.x||Ue.min.y>Le||Le>Ue.max.y)&&(Re=$v(Uv(Te,Le,n.canonical,Ue.footprintTileId.canonical),Ue.footprint),Re))break;N.float32[oe]=Re?me+Ji:me,S=S||Re!==Se}}}return S}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const d=this.instancesPerModel[o];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=n.createVertexBuffer(d.instancedDataArray,T.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(n){for(const d in this.instancesPerModel){const g=this.instancesPerModel[d];g.instancedDataArray.length!==0&&g.instancedDataBuffer&&g.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(n&&o&&this.modelUris&&this.modelsRequested)for(const d of this.modelUris)o.removeModel(d,"",!0)}addFeature(n,o,d){const g=this.layers[0],w=g.layout.get("model-id").evaluate(d,{},this.canonical);if(!w)return mn(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),w;(WI(w,!1)||this.styleDefinedModelURLs[w]!==void 0)&&(this.modelUris.includes(w)||this.modelUris.push(w)),this.instancesPerModel[w]||(this.instancesPerModel[w]=new bD);const S=this.instancesPerModel[w],A=S.instancedDataArray,L=new xD(d,A.length);for(const N of o)for(const q of N){if(q.x<0||q.x>=Ji||q.y<0||q.y>=Ji)continue;if(this.lookupDim!==0){const Q=(this.lookupDim-1)/Ji,ne=this.lookupDim*(q.y*Q|0)+q.x*Q|0;if(this.lookup){if(this.lookup[ne]!==0)continue;this.lookup[ne]=1}}this.instanceCount++;const Z=A.length;A.resize(Z+1),S.instancesEvaluatedElevation.push(0),A.float32[16*Z]=q.x,A.float32[16*Z+1]=q.y}return L.instancedDataCount=S.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(n.id&&(S.idToFeaturesIndex[n.id]=S.features.length),S.features.push(L),this.evaluate(L,{},S,!1)),w}getModelUris(){return this.modelUris}evaluate(n,o,d,g){const w=this.layers[0],S=n.feature,A=this.canonical,L=n.rotation=w.paint.get("model-rotation").evaluate(S,o,A),N=n.scale=w.paint.get("model-scale").evaluate(S,o,A),q=n.translation=w.paint.get("model-translation").evaluate(S,o,A),Z=Object.assign({},w.paint.get("model-color").evaluate(S,o,A));Z.a=w.paint.get("model-color-mix-intensity").evaluate(S,o,A);const Q=[];this.maxVerticalOffset<q[2]&&(this.maxVerticalOffset=q[2]);const ne=q[0]*q[0]+q[1]*q[1],oe=ne>0?Math.sqrt(ne):0;d.maxScale=Math.max(Math.max(d.maxScale,N[0]),Math.max(N[1],N[2])),d.maxXYTranslationDistance=Math.max(d.maxXYTranslationDistance,oe),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),ve(Q,L,N);const me=Math.round(100*Z.a)+Z.b/1.05;for(let Se=0;Se<n.instancedDataCount;++Se){const Te=n.instancedDataOffset+Se,Le=16*Te,Re=d.instancedDataArray.float32;let Ue=0;g&&(Ue=Re[Le+6]-d.instancesEvaluatedElevation[Te]);const rt=0|Re[Le+1];Re[Le]=(0|Re[Le])+Z.r/1.05,Re[Le+1]=rt+Z.g/1.05,Re[Le+2]=me,Re[Le+3]=1/(A.z>10?this.tileToMeter:Ae(A,rt)),Re[Le+4]=q[0],Re[Le+5]=q[1],Re[Le+6]=q[2]+Ue,Re[Le+7]=Q[0],Re[Le+8]=Q[1],Re[Le+9]=Q[2],Re[Le+10]=Q[4],Re[Le+11]=Q[5],Re[Le+12]=Q[6],Re[Le+13]=Q[8],Re[Le+14]=Q[9],Re[Le+15]=Q[10],d.instancesEvaluatedElevation[Te]=q[2]}}}let wD,TD;Cn(ZI,"ModelBucket",{omit:["layers"]}),Cn(bD,"PerModelAttributes"),Cn(xD,"ModelFeature");class yx{constructor(n,o,d){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=d}static create(n,o,d){const g=d||n.findDEMTileFor(o);if(!g||!g.dem)return;const w=g.dem,S=g.tileID,A=1<<o.canonical.z-S.canonical.z;return new yx(g,w.dim/Ji/A,[(o.canonical.x/A-S.canonical.x)*w.dim,(o.canonical.y/A-S.canonical.y)*w.dim])}tileCoordToPixel(n,o){const d=o*this._scale+this._offset[1];return new yi(Math.floor(n*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(n,o,d,g){const w=n*this._scale+this._offset[0],S=o*this._scale+this._offset[1],A=Math.floor(w),L=Math.floor(S),N=this._dem;return g=!!g,d?Gn(Gn(N.get(A,L,g),N.get(A,L+1,g),S-L),Gn(N.get(A+1,L,g),N.get(A+1,L+1,g),S-L),w-A):N.get(A,L,g)}getElevationAtPixel(n,o,d){return this._dem.get(n,o,!!d)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*J(1,n)*this._dem.stride}}const XI=new Float32Array(262144),q0=new Uint8Array(262144);function SD(a){let n=0;if(a.meshes)for(const o of a.meshes)n=Math.max(n,o.aabb.max[2]);if(a.children)for(const o of a.children)n=Math.max(n,SD(o));return n}function ED(a,n,o){if(a.meshes)for(const d of a.meshes){if(d.aabb.min[0]===1/0)continue;const g=Ln.applyTransform(d.aabb,a.globalMatrix);o.insert(n,g.min[0],g.min[1],g.max[0],g.max[1])}if(a.children)for(const d of a.children)ED(d,n,o)}const ID=["","wall","door","roof","window","lamp","logo"];class CD{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:SD(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new Ln([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==n&&(d.transformedAabb=Ln.applyTransformFast(d.aabb,this.node.globalMatrix),o.encapsulate(d.transformedAabb)),n++;this.aabb=o}return this.aabb}}class ET{constructor(n,o,d,g,w,S,A,L){this.id=d,this.layers=n,this.layerIds=this.layers.map((N=>N.fqid)),this.stateDependentLayerIds=this.layers.filter((N=>N.isStateDependent())).map((N=>N.id)),this.modelTraits|=$e.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=$e.HasMapboxMeshFeatures),w&&(this.modelTraits|=$e.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=S,this.worldview=L,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const N of o)this.nodesInfo.push(new CD(N)),ED(N,A.featureIndexArray.length,A.grid),A.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,A.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(n,o){for(const d of this.getNodesInfo()){const g=d.node;g.footprint&&o.push({footprint:g.footprint,id:n})}}updateAppearances(n,o,d,g){}update(n){const o=Object.keys(n).length!==0;if(o&&!this.stateDependentLayers.length)return;const d=o?this.stateDependentLayers:this.layers;if(!Ao(n,this.states))for(const g of d)this.evaluate(g,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const d of o){const g=d.node;this.uploaded?this.updatePbrBuffer(g):Vt(g,n,!0)}for(const d of o)Xt(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const d of n.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),o=!0);return o}needsReEvaluation(n,o,d){const g=n.transform.projectionOptions,w=n.style.getBrightness(),S=this.brightness!==w;if(!this.uploaded||this.dirty||g.name!==this.projection.name||M1(d.paint.get("model-color").value,S)||M1(d.paint.get("model-color-mix-intensity").value,S)||M1(d.paint.get("model-roughness").value,S)||M1(d.paint.get("model-emissive-strength").value,S)||M1(d.paint.get("model-height-based-emissive-strength-multiplier").value,S)){this.projection=g,this.brightness=w;const A=this.getNodesInfo();for(const L of A)L.state=null;return!0}return!1}evaluateTransform(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const d=this.getNodesInfo(),g=this.id.canonical;for(const w of d){const S=w.feature;w.evaluatedTranslation=o.paint.get("model-translation").evaluate(S,{},g),w.evaluatedScale=o.paint.get("model-scale").evaluate(S,{},g)}}evaluate(n,o){const d=this.getNodesInfo();for(const g of d){if(!g.node.meshes)continue;const w=g.feature,S=o&&o[w.id];if(Ao(S,g.state))continue;g.state=structuredClone(S);const A=g.node.meshes&&g.node.meshes[0].featureData,L=g.evaluatedColor[2],N=g.evaluatedRMEA[2],q=this.id.canonical;if(g.hasTranslucentParts=!1,A){for(let Z=0;Z<ID.length;Z++){const Q=ID[Z];Q.length&&(w.properties.part=Q);const ne=n.paint.get("model-color").evaluate(w,S,q).toPremultipliedRenderColor(null),oe=n.paint.get("model-color-mix-intensity").evaluate(w,S,q);g.evaluatedColor[Z]=[ne.r,ne.g,ne.b,oe],g.evaluatedRMEA[Z][0]=n.paint.get("model-roughness").evaluate(w,S,q),g.evaluatedRMEA[Z][2]=n.paint.get("model-emissive-strength").evaluate(w,S,q),g.evaluatedRMEA[Z][3]=ne.a,g.emissionHeightBasedParams[Z]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(w,S,q),!g.hasTranslucentParts&&ne.a<1&&(g.hasTranslucentParts=!0)}delete w.properties.part,M8(g,L!==g.evaluatedColor[2]||N!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(w,S,q);g.evaluatedTranslation=n.paint.get("model-translation").evaluate(w,S,q),g.evaluatedScale=n.paint.get("model-scale").evaluate(w,S,q),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,d,g){const w=n.findDEMTileFor(d);if(w&&(w.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(w.dem&&w.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=w.tileID.overscaledZ;const S=yx.create(n,d,w);if(!S)return;this.modelTraits&$e.HasMapboxMeshFeatures&&this.updateDEM(n,S,d,g);for(const A of this.getNodesInfo()){const L=A.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const N=L.footprint.vertices;let q=S.getElevationAt(N[0].x,N[0].y,!0,!0);for(let Z=1;Z<N.length;Z++)q=Math.min(q,S.getElevationAt(N[Z].x,N[Z].y,!0,!0));L.elevation=q}}this.terrainTile=w.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,d,g){let w=o._dem._modifiedForSources[g];if(w===void 0&&(o._dem._modifiedForSources[g]=[],w=o._dem._modifiedForSources[g]),w.includes(d.canonical))return;const S=o._dem.dim;w.push(d.canonical);let A=!1;for(const L of this.getNodesInfo()){const N=L.node;if(!N.footprint||!N.footprint.grid)continue;const q=N.footprint.grid,Z=o.tileCoordToPixel(q.min.x,q.min.y),Q=o.tileCoordToPixel(q.max.x,q.max.y),ne=Math.min(Math.min(S-Q.y,Z.x),Math.min(Z.y,S-Q.x));if(ne<0)continue;const oe=we(ne,2,5);let me=Math.max(0,Z.x-oe),Se=Math.max(0,Z.y-oe),Te=Math.min(Q.x+oe,S-1),Le=Math.min(Q.y+oe,S-1);for(let Qe=Se;Qe<=Le;++Qe)for(let ht=me;ht<=Te;++ht)q0[Qe*S+ht]=255;let Re=0,Ue=0;for(let Qe=0;Qe<q.cellsY;++Qe)for(let ht=0;ht<q.cellsX;++ht){if(!q.cells[Qe*q.cellsX+ht])continue;const yt=o.tileCoordToPixel(q.min.x+ht/q.xScale,q.min.y+Qe/q.yScale),Et=o.tileCoordToPixel(q.min.x+(ht+1)/q.xScale,q.min.y+(Qe+1)/q.yScale);for(let ai=yt.y;ai<=Math.min(Et.y+1,S-1);++ai)for(let kt=yt.x;kt<=Math.min(Et.x+1,S-1);++kt)q0[ai*S+kt]===255&&(q0[ai*S+kt]=0,Re+=o.getElevationAtPixel(kt,ai),Ue++)}const rt=Re/Ue;me=Math.max(1,Z.x-oe),Se=Math.max(1,Z.y-oe),Te=Math.min(Q.x+oe,S-2),Le=Math.min(Q.y+oe,S-2),A=!0;for(let Qe=Se;Qe<=Le;++Qe)for(let ht=me;ht<=Te;++ht)q0[Qe*S+ht]===0&&(XI[Qe*S+ht]=o._dem.set(ht,Qe,rt));for(let Qe=1;Qe<oe;++Qe){me=Math.max(1,Z.x-Qe),Se=Math.max(1,Z.y-Qe),Te=Math.min(Q.x+Qe,S-2),Le=Math.min(Q.y+Qe,S-2);for(let ht=Se;ht<=Le;++ht)for(let yt=me;yt<=Te;++yt){const Et=ht*S+yt;if(q0[Et]===255){let ai=0,kt=0,fi=-1,Ti=-1;for(let Si=-1;Si<=1;++Si)for(let Bi=-1;Bi<=1;++Bi){const ji=(ht+Si)*S+yt+Bi;if(q0[ji]>=Qe)continue;const zi=XI[ji],Oi=Math.abs(zi);Oi>kt&&(ai=zi,kt=Oi,fi=Bi,Ti=Si)}if(kt>.1){const Si=1-(Qe+.5*Math.abs(fi*Ti))/oe;let Bi=o._dem.get(yt,ht)+ai*Si;const ji=o._dem.get(yt+fi,ht+Ti),zi=o._dem.get(yt-fi,ht-Ti,!0);(Bi-ji)*(Bi-zi)>0&&(Bi=(ji+zi)/2),XI[Et]=o._dem.set(yt,ht,Bi),q0[Et]=Qe}}}}}A&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Ta.now())}setFilter(n){this.filter=n?xt(n):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((n=>this.filter.filter(new Us(this.id.overscaledZ,{worldview:this.worldview}),n.feature,this.id.canonical))):this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)Xt(o.node),Mi(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(n.toUnwrapped());for(const g of this.getNodesInfo()){const w=g.node.footprint;g.hiddenByReplacement=!!w&&!d.find((S=>S.footprint===w))}}getHeightAtTileCoord(n,o){const d=[],g=[0,0,0],w=ie([]);for(const S of this.getNodesInfo()){const A=S.node.meshes[0],L=A.transformedAabb;if(n<L.min[0]||o<L.min[1]||n>L.max[0]||o>L.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};pe(w,S.node.globalMatrix),g[0]=n,g[1]=o,St(g,g,w);const N=(g[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*Fe|0,q=Math.min(63,(g[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*Fe|0)*Fe+Math.min(63,N),Z=A.heightmap[q];if(!(Z<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:Z,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new yi(n,o),new yi(n,o),d),d.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function M1(a,n){return a instanceof vr&&!a.isLightConstant&&n}function P8(a,n,o,d,g,w,S,A){let L=(61440&n|(61440&n)>>4)>>8,N=(3840&n|(3840&n)>>4)>>4,q=240&n|(240&n)>>4;o[3]>0&&(L=Gn(L,255*o[0],o[3]),N=Gn(N,255*o[1],o[3]),q=Gn(q,255*o[2],o[3]));const Z=L<<8|N,Q=q<<8|Math.floor(255*d[3]),ne=(function(Qe){const ht=we(Qe,0,2);return Math.min(Math.round(.5*ht*255),255)})(d[2])<<8|15*d[0]<<4|15*d[1],oe=we(g[0],0,1),me=we(g[1],0,1),Se=we(g[2],0,1),Te=we(g[3],0,1);let Le,Re,Ue,rt;if(oe!==me&&S!==w&&me!==oe){const Qe=S-w;Re=1/(Qe*(me-oe)),Ue=-(w+Qe*oe)/(Qe*(me-oe));const ht=we(g[4],-1,1);rt=Math.pow(10,ht),Le=255*Se<<8|255*Te}else Le=65535,Re=0,Ue=1,rt=1;if(a.emplaceBack(Z,Q,ne,Le,Re,Ue,rt),A){const Qe=A.length;A.clear();for(let ht=0;ht<Qe;ht++)A.emplaceBack(Z,Q,ne,Le,Re,Ue,rt)}}function M8(a,n,o){const d=a.node;let g=0;const w=o&$e.HasMeshoptCompression;for(const S of d.meshes){if(d.lights&&d.lightMeshIndex===g||!S.featureData)continue;S.featureArray=new e_,S.featureArray.reserve(S.featureData.length);let A=n;for(const L of S.featureData){const N=w?65535&L:L>>16&65535,q=w?L>>16&65535:65535&L,Z=(15&q)<8?15&q:0,Q=a.evaluatedRMEA[Z],ne=a.evaluatedColor[Z],oe=a.emissionHeightBasedParams[Z];let me;if(A&&Z===2&&d.lights&&(me=new e_,me.resize(10*d.lights.length)),P8(S.featureArray,N,ne,Q,oe,S.aabb.min[2],S.aabb.max[2],me),me&&A){A=!1;const Se=d.meshes[d.lightMeshIndex];Se.featureArray=me,Se.featureArray._trim()}}S.featureArray._trim(),g++}}Cn(ET,"Tiled3dModelBucket",{omit:["layers"]}),Cn(CD,"Tiled3dModelFeature");const k8=["id","tile","layer","source","sourceLayer","state"];class H0{constructor(n,o,d,g,w){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=d,this._y=g,this.properties=n?n.properties:{},this.id=w}clone(){const n=new H0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of k8)this[o]!==void 0&&(n[o]=this[o]);return n}}class W0 extends Au{constructor(n,o,d,g){super(),this.id=n,this.type="model",this.models=[],this._loaded=!1,this._options=o,this._modelsInfo=new Map}load(){const n=[];for(const o in this._options.models){const d=this._options.models[o],g=this._modelsInfo.get(o);if(g){const w=g.model;w.position=d.position!=null?new h(d.position[0],d.position[1]):new h(0,0),w.orientation=d.orientation!=null?d.orientation:[0,0,0],g.modelSpec=d,W0.applyModelSpecification(w,d),w.computeBoundsAndApplyParent(),this.models.push(w)}else{const w=rx(this.map._requestManager.transformRequest(d.uri,ou.Model).url).then((S=>{if(!S)return;const A=dr(S),L=new zt(o,d.uri,d.position,d.orientation,A);W0.applyModelSpecification(L,d),L.computeBoundsAndApplyParent(),this.models.push(L),this._modelsInfo.set(o,{modelSpec:d,model:L})})).catch((S=>{this.fire(new ms(new Error(`Could not load model ${o} from ${d.uri}: ${S.message}`)))}));n.push(w)}}Promise.allSettled(n).then((()=>{this._loaded=!0,this.fire(new Cs("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((o=>{this._loaded=!0,this.fire(new ms(new Error(`Could not load models: ${o.message}`)))}))}static applyModelSpecification(n,o){o.nodeOverrides&&W0.convertNodeOverrides(n,o.nodeOverrides),o.materialOverrides&&W0.convertMaterialOverrides(n,o.materialOverrides),o.nodeOverrideNames&&(n.nodeOverrideNames=[...o.nodeOverrideNames]),o.materialOverrideNames&&(n.materialOverrideNames=[...o.materialOverrideNames]),o.featureProperties&&(n.featureProperties=o.featureProperties)}static convertNodeOverrides(n,o){if(Array.isArray(o)&&o.every((d=>typeof d=="string"))){n.nodeOverrideNames=[];for(const d of o)n.nodeOverrideNames.push(d)}else Object.entries(o).forEach((([d,g])=>{const w={orientation:[0,0,0]};if(g.hasOwnProperty("orientation")){const S=g.orientation;S&&(w.orientation=S)}n.nodeOverrides.set(d,w)}))}static convertMaterialOverrides(n,o){if(Array.isArray(o)&&o.every((d=>typeof d=="string"))){n.materialOverrideNames=[];for(const d of o)n.materialOverrideNames.push(d)}else Object.entries(o).forEach((([d,g])=>{const w={color:new ps(1,1,1),colorMix:0,emissionStrength:0,opacity:1},S=g["model-color"];S!==void 0&&(w.color.r=S[0],w.color.g=S[1],w.color.b=S[2]);const A=g["model-color-mix-intensity"];A!==void 0&&(w.colorMix=A);const L=g["model-emissive-strength"];L!==void 0&&(w.emissionStrength=L);const N=g["model-opacity"];N!==void 0&&(w.opacity=N),n.materialOverrides.set(d,w)}))}onAdd(n){this.map=n,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(n,o){}serialize(){return this._options}setProperty(n,o){return!1}reload(){const n=Pi(this.id,this.scope);this.map.style.clearSource(n),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(n){this.models=[];const o=new Map;for(const d in n){const g=n[d];if(this._modelsInfo.has(d)){const w=this._modelsInfo.get(d);w&&w.modelSpec.uri===g.uri&&o.set(d,w)}}this._modelsInfo=o,this._options.models=n,this._loaded=!1,this.load()}}function YI(a,n,o,d){const g=1<<a.z;n.lat=ce((d/Ji+a.y)/g),n.lng=ee((o/Ji+a.x)/g)}function D8(a,n,o,d){const g=a.getNodesInfo()[n];if(!g||g.hiddenByReplacement||!g.node.meshes)return;let w=Number.MAX_VALUE;const S=g.node,A=o.tile,L=d.calculatePosMatrix(A.tileID.toUnwrapped(),d.worldSize),N=g.evaluatedScale;let q=0;d.elevation&&S.elevation&&(q=S.elevation*d.elevation.exaggeration()),de(L,L,[(S.anchor?S.anchor[0]:0)*(N[0]-1),(S.anchor?S.anchor[1]:0)*(N[1]-1),q]),Ee(L,L,N);const Z=o.queryGeometry,Q=Z.isPointQuery()?Z.screenBounds:Z.screenGeometry,ne=function(me){const Se=ye([],L,me.globalMatrix);ye(Se,d.expandedFarZProjMatrix,Se);for(let Te=0;Te<me.meshes.length;++Te){const Le=me.meshes[Te];if(Te===me.lightMeshIndex)continue;const Re=ze(Q,d,Se,Le.aabb);Re!=null&&(w=Math.min(Re,w))}if(me.children)for(const Te of me.children)ne(Te)};if(ne(S),w===Number.MAX_VALUE)return;const oe=new h(0,0);return YI(A.tileID.canonical,oe,g.node.anchor[0],g.node.anchor[1]),{intersectionZ:w,position:oe,feature:g.feature}}const L8={circle:class extends Ps{constructor(a,n,o,d){super(a,{layout:Dc||(Dc=new xe({"circle-sort-key":new te(fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new K(fe.layout_circle["circle-elevation-reference"]),visibility:new K(fe.layout_circle.visibility)})),paint:Do||(Do=new xe({"circle-radius":new te(fe.paint_circle["circle-radius"]),"circle-color":new te(fe.paint_circle["circle-color"]),"circle-blur":new te(fe.paint_circle["circle-blur"]),"circle-opacity":new te(fe.paint_circle["circle-opacity"]),"circle-translate":new K(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new K(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new K(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new K(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new K(fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d)}createBucket(a){return new Os(a)}queryRadius(a){const n=a;return Ul("circle-radius",this,n)+Ul("circle-stroke-width",this,n)+Tl(this.paint.get("circle-translate"))}queryIntersectsFeature(a,n,o,d,g,w,S,A){const L=vu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,a.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return h2(a,d,w,S,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,n,o){const d=Av(this);return{config:new Pf(this,{zoom:n,lut:o}),defines:d,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ps{createBucket(a){return new zb(a)}constructor(a,n,o,d){super(a,{layout:Mv||(Mv=new xe({visibility:new K(fe.layout_heatmap.visibility)})),paint:Ob||(Ob=new xe({"heatmap-radius":new te(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new K(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ge(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new K(fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return Ul("heatmap-radius",this,a)}queryIntersectsFeature(a,n,o,d,g,w,S,A){const L=this.paint.get("heatmap-radius").evaluate(n,o);return h2(a,d,w,S,A,!0,!0,new yi(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,n,o){return a==="heatmap"?{config:new Pf(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends Ps{constructor(a,n,o,d){super(a,{layout:I0||(I0=new xe({visibility:new K(fe.layout_hillshade.visibility)})),paint:Fb||(Fb=new xe({"hillshade-illumination-direction":new K(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new K(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new K(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new K(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new K(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new K(fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new K(fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,n,o){return{overrideFog:!1}}},fill:class extends Ps{constructor(a,n,o,d){super(a,{layout:Ov||(Ov=new xe({"fill-sort-key":new te(fe.layout_fill["fill-sort-key"]),visibility:new K(fe.layout_fill.visibility),"fill-elevation-reference":new K(fe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new te(fe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:qb||(qb=new xe({"fill-antialias":new K(fe.paint_fill["fill-antialias"]),"fill-opacity":new te(fe.paint_fill["fill-opacity"]),"fill-color":new te(fe.paint_fill["fill-color"]),"fill-outline-color":new te(fe.paint_fill["fill-outline-color"]),"fill-translate":new K(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new K(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new te(fe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new K(fe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new K(fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new te(fe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new te(fe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new te(fe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d)}getProgramIds(){const a=this.paint.get("fill-pattern"),n=a&&a.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(a,n,o){return{config:new Pf(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(a,n){super.recalculate(a,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zv(a)}queryRadius(){return Tl(this.paint.get("fill-translate"))}queryIntersectsFeature(a,n,o,d,g,w){return!a.queryGeometry.isAboveHorizon&&vs(tc(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const n=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?n&&!a:n}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ps{constructor(a,n,o,d){super(a,{layout:t1||(t1=new xe({visibility:new K(fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new K(fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:j2||(j2=new xe({"fill-extrusion-opacity":new K(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new K(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new K(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new te(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new K(fe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new te(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new K(fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new K(fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new K(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new K(fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new K(fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new K(fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new K(fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new K(fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new K(fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new K(fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new te(fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new te(fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new K(fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new K(fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new K(fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new K(fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new te(fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new te(fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new K(fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Yv(a)}queryRadius(){return Tl(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,n,o,d,g,w,S,A,L){const N=vu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,a.pixelToTileUnitsFactor),q=this.paint.get("fill-extrusion-height").evaluate(n,o),Z=this.paint.get("fill-extrusion-base").evaluate(n,o),Q=[0,0],ne=A&&w.elevation,oe=w.elevation?w.elevation.exaggeration():1,me=a.tile.getBucket(this);if(ne&&me instanceof Yv){const Ue=me.centroidVertexArray,rt=L+1;rt<Ue.length&&(Q[0]=Ue.geta_centroid_pos0(rt),Q[1]=Ue.geta_centroid_pos1(rt))}if(Q[0]===0&&Q[1]===1)return!1;w.projection.name==="globe"&&(d=V2([d],[new yi(0,0),new yi(Ji,Ji)],a.tileID.canonical).map((Ue=>Ue.polygon)).flat());const Se=ne?A:null,[Te,Le]=W2(w,d,Z,q,N,S,Se,Q,oe,w.center.lat,a.tileID.canonical),Re=a.queryGeometry;return n1(Te,Le,Re.isPointQuery()?Re.screenBounds:Re.screenGeometry)}},building:class extends Ps{constructor(a,n,o,d){super(a,{layout:Sl||(Sl=new xe({visibility:new K(fe.layout_building.visibility),"building-facade":new te(fe.layout_building["building-facade"]),"building-facade-floors":new te(fe.layout_building["building-facade-floors"]),"building-facade-unit-width":new te(fe.layout_building["building-facade-unit-width"]),"building-facade-window":new te(fe.layout_building["building-facade-window"]),"building-roof-shape":new te(fe.layout_building["building-roof-shape"]),"building-height":new te(fe.layout_building["building-height"]),"building-base":new te(fe.layout_building["building-base"]),"building-flood-light-wall-radius":new te(fe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new te(fe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new te(fe.layout_building["building-flip-roof-orientation"])})),paint:Za||(Za=new xe({"building-opacity":new K(fe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new K(fe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new K(fe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new K(fe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new K(fe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new K(fe.paint_building["building-vertical-scale"]),"building-cast-shadows":new K(fe.paint_building["building-cast-shadows"]),"building-color":new te(fe.paint_building["building-color"]),"building-emissive-strength":new te(fe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new K(fe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new K(fe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new K(fe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new K(fe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new K(fe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Qh(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,n,o,d,g,w,S,A,L){let N=this.layout.get("building-height").evaluate(n,o);const q=this.layout.get("building-base").evaluate(n,o),Z=a.tile.getBucket(this).getFootprint(n);if(Z){if(Z.hiddenFlags!==0)return!1;N=Z.height}const[Q,ne]=W2(w,d,q,N,new yi(0,0),S,null,[0,0],1,w.center.lat,a.tileID.canonical),oe=a.queryGeometry;return n1(Q,ne,oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Ps{constructor(a,n,o,d){const g=sT();super(a,g,n,o,d),g.layout&&(this.layout=new H(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Cd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(a,n){super.recalculate(a,n),this.paint._values["line-floorwidth"]=(()=>{if($0)return $0;const o=sT();return $0=new SI(o.paint.properties["line-width"].specification),$0.useIntegerZoom=!0,$0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new sx(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,n,o){const d=nT(this);return{config:new Pf(this,{zoom:n,lut:o}),defines:d,overrideFog:!1}}queryRadius(a){const n=a,o=oT(Ul("line-width",this,n),Ul("line-gap-width",this,n)),d=Ul("line-offset",this,n);return o/2+Math.abs(d)+Tl(this.paint.get("line-translate"))}queryIntersectsFeature(a,n,o,d,g,w){if(a.queryGeometry.isAboveHorizon)return!1;const S=tc(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,a.pixelToTileUnitsFactor),A=a.pixelToTileUnitsFactor/2*oT(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),L=this.paint.get("line-offset").evaluate(n,o);return L&&(d=(function(N,q){const Z=[],Q=new yi(0,0);for(let ne=0;ne<N.length;ne++){const oe=N[ne],me=[];for(let Se=0;Se<oe.length;Se++){const Te=oe[Se],Le=oe[Se+1],Re=Se===0?Q:Te.sub(oe[Se-1])._unit()._perp(),Ue=Se===oe.length-1?Q:Le.sub(Te)._unit()._perp(),rt=Re._add(Ue)._unit();rt._mult(1/(rt.x*Ue.x+rt.y*Ue.y)),me.push(rt._mult(q)._add(Te))}Z.push(me)}return Z})(d,L*a.pixelToTileUnitsFactor)),(function(N,q,Z){for(let Q=0;Q<q.length;Q++){const ne=q[Q];if(N.length>=3){for(let oe=0;oe<ne.length;oe++)if(Zs(N,ne[oe]))return!0}if(ko(N,ne,Z))return!0}return!1})(S,d,A)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:bT,background:class extends Ps{constructor(a,n,o,d){super(a,{layout:oD||(oD=new xe({visibility:new K(fe.layout_background.visibility)})),paint:aD||(aD=new xe({"background-pitch-alignment":new K(fe.paint_background["background-pitch-alignment"]),"background-color":new K(fe.paint_background["background-color"]),"background-pattern":new K(fe.paint_background["background-pattern"]),"background-opacity":new K(fe.paint_background["background-opacity"]),"background-emissive-strength":new K(fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,n,o){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:dD,"raster-particle":yD,sky:class extends Ps{constructor(a,n,o,d){super(a,{layout:mD||(mD=new xe({visibility:new K(fe.layout_sky.visibility)})),paint:gD||(gD=new xe({"sky-type":new K(fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new K(fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new K(fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new K(fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new K(fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ge(fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new K(fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new K(fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new K(fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(a,n){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),g=!d,w=a.style.light,S=w.properties.get("position");return g&&w.properties.get("anchor")==="viewport"&&mn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?HI(S.azimuthal,90-S.polar,n):HI(d[0],90-d[1],n)}const o=this.paint.get("sky-gradient-center");return HI(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Ps{constructor(a,n,o,d){super(a,{paint:_D||(_D=new xe({}))},n,null)}},model:class extends Ps{constructor(a,n,o,d){super(a,{layout:wD||(wD=new xe({visibility:new K(fe.layout_model.visibility),"model-id":new te(fe.layout_model["model-id"])})),paint:TD||(TD=new xe({"model-opacity":new te(fe.paint_model["model-opacity"]),"model-rotation":new te(fe.paint_model["model-rotation"]),"model-scale":new te(fe.paint_model["model-scale"]),"model-translation":new te(fe.paint_model["model-translation"]),"model-color":new te(fe.paint_model["model-color"]),"model-color-mix-intensity":new te(fe.paint_model["model-color-mix-intensity"]),"model-type":new K(fe.paint_model["model-type"]),"model-cast-shadows":new K(fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new K(fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new K(fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new te(fe.paint_model["model-emissive-strength"]),"model-roughness":new te(fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new te(fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new K(fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new K(fe.paint_model["model-front-cutoff"]),"model-elevation-reference":new K(fe.paint_model["model-elevation-reference"]),"model-color-use-theme":new te({type:"string",default:"default","property-type":"data-driven"})}))},n,o,d),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new ZI(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof ET?Ji-1:0}queryRenderedFeatures(a,n,o){const d=n.getSource();if(!(d&&d instanceof W0))return{};const g=d,w={};w[this.id]=[];const S=w[this.id];let A=0;for(const L of g.models){const N=n.getFeatureState(this.sourceLayer,L.id),q={type:"Unknown",id:L.id,properties:L.featureProperties},Z=this.paint.get("model-rotation").evaluate(q,N),Q=this.paint.get("model-scale").evaluate(q,N),ne=this.paint.get("model-translation").evaluate(q,N),oe=this.paint.get("model-elevation-reference");let me=[];it(me,L,o,L.position,Z,Q,ne,oe==="ground",oe==="ground",!1),o.projection.name==="globe"&&(me=Me(me,o));const Se=ye([],o.projMatrix,me),Te=ze(a.isPointQuery()?a.screenBounds:a.screenGeometry,o,Se,L.aabb);if(Te!=null){const Le=new H0(void 0,0,0,0,L.id);Le.layer=this.layer,Le.properties=structuredClone(L.featureProperties),Le.properties.layer=this.id,Le.properties.uri=L.uri,Le.properties.orientation=L.orientation,Le.sourceLayer=this.sourceLayer,Le.geometry={type:"Point",coordinates:[L.position.lng,L.position.lat]},Le.state=N,Le.source=this.source,S.push({featureIndex:A,feature:Le,intersectionZ:Te})}++A}return w}queryIntersectsFeature(a,n,o,d,g,w){if(!this.modelManager)return!1;const S=this.modelManager,A=a.tile.getBucket(this);if(!(A&&A instanceof ZI))return!1;for(const L in A.instancesPerModel){const N=A.instancesPerModel[L],q=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(q)){const Z=N.features[N.idToFeaturesIndex[q]],Q=S.getModel(L,this.scope);if(!Q)return!1;let ne=[];const oe=new h(0,0),me=A.canonical;let Se=Number.MAX_VALUE;for(let Te=0;Te<Z.instancedDataCount;++Te){const Le=16*(Z.instancedDataOffset+Te),Re=N.instancedDataArray.float32,Ue=[Re[Le+4],Re[Le+5],Re[Le+6]];YI(me,oe,Math.floor(Re[Le]),Math.floor(Re[Le+1])),it(ne,Q,w,oe,Z.rotation,Z.scale,Ue,!1,!1,!1),w.projection.name==="globe"&&(ne=Me(ne,w));const rt=ye([],w.projMatrix,ne),Qe=a.queryGeometry,ht=ze(Qe.isPointQuery()?Qe.screenBounds:Qe.screenGeometry,w,rt,Q.aabb);ht!=null&&(Se=Math.min(ht,Se))}return Se!==Number.MAX_VALUE&&Se}}return!1}_handleOverridablePaintPropertyUpdate(a,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const n=this._transitionablePaint._values[a];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Cr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ps{constructor(a,n,o,d){super(a,{layout:Fv||(Fv=new xe({"clip-layer-types":new K(fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new K(fe.layout_clip["clip-layer-scope"])})),paint:Kc||(Kc=new xe({}))},n,o,d)}recalculate(a,n){super.recalculate(a,n)}createBucket(a){return new rm(a)}is3D(a){return!0}}},KI=new ps(0,0,0),JI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},QI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},IT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},R8={PAINT_ORDER_FILL_AND_STROKE:1},k1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},AD={MASK_TYPE_LUMINANCE:1};function z8(a,n,o){a===1&&n.icons.push((function(d,g){return(function(w){if(w.usvg_tree.height||(w.usvg_tree.height=w.usvg_tree.width),!w.metadata)return w;const{metadata:S}=w;if(S.content_area){const{content_area:A}=S;A.left==null&&(A.left=0),A.top==null&&(A.top=A.left),A.width==null&&(A.width=w.usvg_tree.width),A.height==null&&(A.height=A.width)}if(S.text_placeholder){const{text_placeholder:A}=S;A.top==null&&(A.top=A.left),A.height==null&&(A.height=A.width)}return S.stretch_x&&S.stretch_x.length&&PD(S,"x"),S.stretch_y&&S.stretch_y.length&&PD(S,"y"),w})(d.readFields(O8,{name:void 0},g))})(o,o.readVarint()+o.pos))}function PD(a,n){const o=[],d=a[`stretch_${n}`];let g=null;for(let w=0;w<d.length;w++)g===null?g=o.length===0?d[0]:o[o.length-1][1]+d[w]:(o.push([g,g+d[w]]),g=null);a[`stretch_${n}_areas`]=o}function O8(a,n,o){a===1?n.name=o.readString():a===2?n.metadata=(function(d,g){return d.readFields(F8,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)})(o,o.readVarint()+o.pos):a===3&&(n.usvg_tree=(function(d,g){return d.readFields(V8,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)})(o,o.readVarint()+o.pos),n.data="usvg_tree")}function F8(a,n,o){a===1?n.stretch_x=o.readPackedVarint():a===2?n.stretch_y=o.readPackedVarint():a===3?n.content_area=MD(o,o.readVarint()+o.pos):a===4?n.variables.push((function(d,g){return d.readFields(N8,{name:void 0},g)})(o,o.readVarint()+o.pos)):a===5&&(n.text_placeholder=MD(o,o.readVarint()+o.pos))}function MD(a,n){return a.readFields(B8,{},n)}function B8(a,n,o){a===1?n.left=o.readVarint():a===2?n.width=o.readVarint():a===3?n.top=o.readVarint():a===4&&(n.height=o.readVarint())}function N8(a,n,o){a===1?n.name=o.readString():a===2&&(n.rgb_color=PT(o.readVarint()),n.value="rgb_color")}function V8(a,n,o){a===1?n.width=n.height=o.readVarint():a===2?n.height=o.readVarint():a===3?n.children.push(CT(o,o.readVarint()+o.pos)):a===4?n.linear_gradients.push((function(d,g){return d.readFields(W8,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)})(o,o.readVarint()+o.pos)):a===5?n.radial_gradients.push((function(d,g){return d.readFields(X8,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)})(o,o.readVarint()+o.pos)):a===7?n.clip_paths.push((function(d,g){return d.readFields(Y8,{children:[]},g)})(o,o.readVarint()+o.pos)):a===8&&n.masks.push((function(d,g){const w=d.readFields(K8,{left:0,width:20,mask_type:AD.MASK_TYPE_LUMINANCE,children:[]},g);return w.height==null&&(w.height=w.width),w.top==null&&(w.top=w.left),w})(o,o.readVarint()+o.pos))}function CT(a,n){return a.readFields(j8,{},n)}function j8(a,n,o){a===1?(n.group=(function(d,g){return d.readFields(U8,{opacity:255,children:[]},g)})(o,o.readVarint()+o.pos),n.node="group"):a===2&&(n.path=(function(d,g){return d.readFields(G8,{paint_order:1,commands:[],step:1,diffs:[],rule:JI.PATH_RULE_NON_ZERO},g)})(o,o.readVarint()+o.pos),n.node="path")}function U8(a,n,o){a===1?n.transform=AT(o,o.readVarint()+o.pos):a===2?n.opacity=o.readVarint():a===5?n.clip_path_idx=o.readVarint():a===6?n.mask_idx=o.readVarint():a===7&&n.children.push(CT(o,o.readVarint()+o.pos))}function AT(a,n){return a.readFields($8,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function $8(a,n,o){a===1?n.sx=o.readFloat():a===2?n.ky=o.readFloat():a===3?n.kx=o.readFloat():a===4?n.sy=o.readFloat():a===5?n.tx=o.readFloat():a===6&&(n.ty=o.readFloat())}function G8(a,n,o){a===1?n.fill=(function(d,g){return d.readFields(q8,{rgb_color:KI,paint:"rgb_color",opacity:255},g)})(o,o.readVarint()+o.pos):a===2?n.stroke=(function(d,g){return d.readFields(H8,{rgb_color:KI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)})(o,o.readVarint()+o.pos):a===3?n.paint_order=o.readVarint():a===5?o.readPackedVarint(n.commands):a===6?n.step=o.readFloat():a===7?o.readPackedSVarint(n.diffs):a===8&&(n.rule=o.readVarint())}function q8(a,n,o){a===1?(n.rgb_color=PT(o.readVarint()),n.paint="rgb_color"):a===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):a===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):a===5&&(n.opacity=o.readVarint())}function PT(a){return new ps((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function H8(a,n,o){a===1?(n.rgb_color=PT(o.readVarint()),n.paint="rgb_color"):a===2?(n.linear_gradient_idx=o.readVarint(),n.paint="linear_gradient_idx"):a===3?(n.radial_gradient_idx=o.readVarint(),n.paint="radial_gradient_idx"):a===5?o.readPackedFloat(n.dasharray):a===6?n.dashoffset=o.readFloat():a===7?n.miterlimit=o.readFloat():a===8?n.opacity=o.readVarint():a===9?n.width=o.readFloat():a===10?n.linecap=o.readVarint():a===11&&(n.linejoin=o.readVarint())}function W8(a,n,o){a===1?n.transform=AT(o,o.readVarint()+o.pos):a===2?n.spread_method=o.readVarint():a===3?n.stops.push(kD(o,o.readVarint()+o.pos)):a===4?n.x1=o.readFloat():a===5?n.y1=o.readFloat():a===6?n.x2=o.readFloat():a===7&&(n.y2=o.readFloat())}function kD(a,n){return a.readFields(Z8,{offset:0,opacity:255,rgb_color:KI},n)}function Z8(a,n,o){a===1?n.offset=o.readFloat():a===2?n.opacity=o.readVarint():a===3&&(n.rgb_color=PT(o.readVarint()))}function X8(a,n,o){a===1?n.transform=AT(o,o.readVarint()+o.pos):a===2?n.spread_method=o.readVarint():a===3?n.stops.push(kD(o,o.readVarint()+o.pos)):a===4?n.cx=o.readFloat():a===5?n.cy=o.readFloat():a===6?n.r=o.readFloat():a===7?n.fx=o.readFloat():a===8?n.fy=o.readFloat():a===9&&(n.fr=o.readFloat())}function Y8(a,n,o){a===1?n.transform=AT(o,o.readVarint()+o.pos):a===2?n.clip_path_idx=o.readVarint():a===3&&n.children.push(CT(o,o.readVarint()+o.pos))}function K8(a,n,o){a===1?n.left=n.top=o.readFloat():a===2?n.width=n.height=o.readFloat():a===3?n.top=o.readFloat():a===4?n.height=o.readFloat():a===5?n.mask_type=o.readVarint():a===6?n.mask_idx=o.readVarint():a===7&&n.children.push(CT(o,o.readVarint()+o.pos))}class J8{static calculate(n={},o=[]){const d=new Map,g=new Map;if(Object.keys(n).length===0)return d;o.forEach((w=>{g.set(w.name,w.rgb_color||new ps(0,0,0))}));for(const[w,S]of Object.entries(n))g.has(w)?d.set(g.get(w).toString(),S):console.warn(`Ignoring unknown image variable "${w}"`);return d}}function vx(a,n=255,o){const d=n/255,g=a.toString(),w=o.has(g)?o.get(g).clone():a.clone();return w.a*=d,w.toString()}function D1(a,n){if(!su()){const o=document.createElement("canvas");return o.width=a,o.height=n,o}return new OffscreenCanvas(a,n)}let eC,L1=null;function tC(a,n,o,d,g){for(const w of d.children)DD(a,n,o,w,g)}function DD(a,n,o,d,g){d.group?(a.save(),(function(w,S,A,L,N){const q=L.mask_idx!=null?A.masks[L.mask_idx]:null,Z=L.clip_path_idx!=null?A.clip_paths[L.clip_path_idx]:null;if(L.transform&&(S=xx(L.transform).preMultiplySelf(S)),!(function(oe,me,Se){return oe.opacity!==255||me||Se})(L,Z!=null,q!=null))return void tC(w,S,A,L,N);const Q=D1(w.canvas.width,w.canvas.height),ne=Q.getContext("2d");tC(ne,S,A,L,N),Z&&ND(ne,S,A,Z),q&&VD(ne,S,A,q,N),w.globalAlpha=L.opacity/255,w.drawImage(Q,0,0)})(a,n,o,d.group,g),a.restore()):d.path&&(a.save(),(function(w,S,A,L,N){w.setTransform(S),L.paint_order===R8.PAINT_ORDER_FILL_AND_STROKE?(LD(w,A,L,N),zD(w,A,L,N)):(zD(w,A,L,N),LD(w,A,L,N))})(a,n,o,d.path,g),a.restore())}function LD(a,n,o,d){const g=o.fill;if(!g)return;const w=g.opacity/255;switch(a.save(),a.beginPath(),jD(o,a),g.paint){case"rgb_color":a.fillStyle=vx(g.rgb_color,g.opacity,d);break;case"linear_gradient_idx":{const S=n.linear_gradients[g.linear_gradient_idx];S.transform&&a.setTransform(xx(S.transform).preMultiplySelf(a.getTransform())),a.fillStyle=OD(a,S,w,d);break}case"radial_gradient_idx":{const S=n.radial_gradients[g.radial_gradient_idx];S.transform&&a.setTransform(xx(S.transform).preMultiplySelf(a.getTransform())),a.fillStyle=FD(a,S,w,d)}}a.fill(RD(o)),a.restore()}function RD(a){return a.rule===JI.PATH_RULE_NON_ZERO?"nonzero":a.rule===JI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function zD(a,n,o,d){const g=o.stroke;if(!g)return;const w=UD(o);a.lineWidth=g.width,a.miterLimit=g.miterlimit,a.setLineDash(g.dasharray),a.lineDashOffset=g.dashoffset;const S=g.opacity/255;switch(g.paint){case"rgb_color":a.strokeStyle=vx(g.rgb_color,g.opacity,d);break;case"linear_gradient_idx":a.strokeStyle=OD(a,n.linear_gradients[g.linear_gradient_idx],S,d,!0);break;case"radial_gradient_idx":a.strokeStyle=FD(a,n.radial_gradients[g.radial_gradient_idx],S,d,!0)}switch(g.linejoin){case IT.LINE_JOIN_MITER_CLIP:case IT.LINE_JOIN_MITER:a.lineJoin="miter";break;case IT.LINE_JOIN_ROUND:a.lineJoin="round";break;case IT.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(g.linecap){case QI.LINE_CAP_BUTT:a.lineCap="butt";break;case QI.LINE_CAP_ROUND:a.lineCap="round";break;case QI.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(w)}function OD(a,n,o,d,g=!1){if(n.stops.length===1){const Q=n.stops[0];return vx(Q.rgb_color,Q.opacity*o,d)}const{x1:w,y1:S,x2:A,y2:L}=n;let N=new DOMPoint(w,S),q=new DOMPoint(A,L);if(g){const Q=xx(n.transform);N=Q.transformPoint(N),q=Q.transformPoint(q)}const Z=a.createLinearGradient(N.x,N.y,q.x,q.y);for(const Q of n.stops)Z.addColorStop(Q.offset,vx(Q.rgb_color,Q.opacity*o,d));return Z}function FD(a,n,o,d,g=!1){if(n.stops.length===1){const Te=n.stops[0];return vx(Te.rgb_color,Te.opacity*o,d)}const w=xx(n.transform),{fx:S,fy:A,fr:L,cx:N,cy:q,r:Z}=n;let Q=new DOMPoint(S,A),ne=new DOMPoint(N,q),oe=L,me=Z;if(g){Q=w.transformPoint(Q),ne=w.transformPoint(ne);const Te=(w.a+w.d)/2;oe=L*Te,me=n.r*Te}const Se=a.createRadialGradient(Q.x,Q.y,oe,ne.x,ne.y,me);for(const Te of n.stops)Se.addColorStop(Te.offset,vx(Te.rgb_color,Te.opacity*o,d));return Se}function BD(a,n,o,d){const g=d.transform?xx(d.transform).preMultiplySelf(n):n,w=D1(a.canvas.width,a.canvas.height),S=w.getContext("2d");for(const L of d.children)if(L.group)BD(S,g,o,L.group);else if(L.path){const N=L.path,q=new Path2D;q.addPath(UD(N),g),S.fill(q,RD(N))}const A=d.clip_path_idx!=null?o.clip_paths[d.clip_path_idx]:null;A&&ND(S,g,o,A),a.globalCompositeOperation="source-over",a.drawImage(w,0,0)}function ND(a,n,o,d){const g=D1(a.canvas.width,a.canvas.height);BD(g.getContext("2d"),n,o,d),a.globalCompositeOperation="destination-in",a.drawImage(g,0,0)}function VD(a,n,o,d,g){if(d.children.length===0)return;const w=d.mask_idx!=null?o.masks[d.mask_idx]:null;w&&VD(a,n,o,w,g);const S=a.canvas.width,A=a.canvas.height,L=D1(S,A),N=L.getContext("2d"),q=d.width,Z=d.height,Q=d.left,ne=d.top,oe=new Path2D,me=new Path2D;me.rect(Q,ne,q,Z),oe.addPath(me,n),N.clip(oe);for(const Le of d.children)DD(N,n,o,Le,g);const Se=N.getImageData(0,0,S,A),Te=Se.data;if(d.mask_type===AD.MASK_TYPE_LUMINANCE)for(let Le=0;Le<Te.length;Le+=4)Te[Le+3]=Te[Le+3]/255*(.2126*Te[Le]+.7152*Te[Le+1]+.0722*Te[Le+2]);N.putImageData(Se,0,0),a.globalCompositeOperation="destination-in",a.drawImage(L,0,0)}function xx(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function jD(a,n){const o=a.step;let d=a.diffs[0]*o,g=a.diffs[1]*o;n.moveTo(d,g);for(let w=0,S=2;w<a.commands.length;w++)switch(a.commands[w]){case k1.PATH_COMMAND_MOVE:d+=a.diffs[S++]*o,g+=a.diffs[S++]*o,n.moveTo(d,g);break;case k1.PATH_COMMAND_LINE:d+=a.diffs[S++]*o,g+=a.diffs[S++]*o,n.lineTo(d,g);break;case k1.PATH_COMMAND_QUAD:{const A=d+a.diffs[S++]*o,L=g+a.diffs[S++]*o;d=A+a.diffs[S++]*o,g=L+a.diffs[S++]*o,n.quadraticCurveTo(A,L,d,g);break}case k1.PATH_COMMAND_CUBIC:{const A=d+a.diffs[S++]*o,L=g+a.diffs[S++]*o,N=A+a.diffs[S++]*o,q=L+a.diffs[S++]*o;d=N+a.diffs[S++]*o,g=q+a.diffs[S++]*o,n.bezierCurveTo(A,L,N,q,d,g);break}case k1.PATH_COMMAND_CLOSE:n.closePath()}return n}function UD(a){return jD(a,new Path2D)}class MT{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}delete(n){this.cache.delete(n)}}Cn(MT,"LRUCache");class iC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new ic(n,n.data)}getFromCache(n,o,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new MT(150)),this.cacheMap.get(d).get(Pi(n.toString(),o))}setInCache(n,o,d,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new MT(150));const w=this.cacheDependenciesMap.get(g),S=Pi(n.id.toString(),d);w.get(S)||w.set(S,new Set);const A=this.cacheMap.get(g),L=n.toString();w.get(S).add(L),A.put(Pi(n.toString(),d),o)}removeImagesFromCacheByIds(n,o,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const g=this.cacheMap.get(d),w=this.cacheDependenciesMap.get(d);for(const S of n){const A=Pi(S.toString(),o);if(w.has(A)){for(const L of w.get(A))g.delete(L);w.delete(A)}}}rasterize(n,o,d,g){const w=this.getFromCache(n,d,g);if(w)return w.clone();const S=(function(L,N){const q=J8.calculate(N.params,L.metadata?L.metadata.variables:[]),Z=L.usvg_tree,Q=Z.width,ne=Z.height,oe=Math.max(1,Math.round(Q*N.sx)),me=Math.max(1,Math.round(ne*N.sy)),Se=new DOMMatrix([oe/Q,0,0,me/ne,0,0]);return L1===null&&(L1=D1(10,10),eC=L1.getContext("2d",{willReadFrequently:!0})),L1.width=oe,L1.height=me,tC(eC,Se,Z,Z,q),eC.getImageData(0,0,oe,me)})(o.icon,n),A=iC._getImage(S);return this.setInCache(n,A,d,g),A.clone()}}class $D{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const d=this.toIdx(n,o);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function GD(a,n,o,d){let g=0,w=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(d[S])<1e-15){if(o[S]<a[S]||o[S]>n[S])return null}else{const A=1/d[S];let L=(a[S]-o[S])*A,N=(n[S]-o[S])*A;if(L>N){const q=L;L=N,N=q}if(L>g&&(g=L),N<w&&(w=N),g>w)return null}return g}function qD(a,n,o,d,g,w,S,A,L,N,q){const Z=d-a,Q=g-n,ne=w-o,oe=S-a,me=A-n,Se=L-o,Te=q[1]*Se-q[2]*me,Le=q[2]*oe-q[0]*Se,Re=q[0]*me-q[1]*oe,Ue=Z*Te+Q*Le+ne*Re;if(Math.abs(Ue)<1e-15)return null;const rt=1/Ue,Qe=N[0]-a,ht=N[1]-n,yt=N[2]-o,Et=(Qe*Te+ht*Le+yt*Re)*rt;if(Et<0||Et>1)return null;const ai=ht*ne-yt*Q,kt=yt*Z-Qe*ne,fi=Qe*Q-ht*Z,Ti=(q[0]*ai+q[1]*kt+q[2]*fi)*rt;return Ti<0||Et+Ti>1?null:(oe*ai+me*kt+Se*fi)*rt}function HD(a,n,o){return(a-n)/(o-n)}function WD(a,n,o,d,g,w,S,A,L){const N=1<<o,q=w-d,Z=S-g,Q=(a+1)/N*q+d,ne=(n+0)/N*Z+g,oe=(n+1)/N*Z+g;A[0]=(a+0)/N*q+d,A[1]=ne,L[0]=Q,L[1]=oe}class ZD{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=(function(w){const S=Math.ceil(Math.log2(w.dim/8)),A=[];let L=Math.ceil(Math.pow(2,S));const N=1/L,q=(ne,oe,me,Se,Te)=>{const Le=Se?1:0,Re=(ne+1)*me-Le,Ue=oe*me,rt=(oe+1)*me-Le;Te[0]=ne*me,Te[1]=Ue,Te[2]=Re,Te[3]=rt};let Z=new $D(L);const Q=[];for(let ne=0;ne<L*L;ne++){q(ne%L,Math.floor(ne/L),N,!1,Q);const oe=jy(Q[0],Q[1],w),me=jy(Q[2],Q[1],w),Se=jy(Q[2],Q[3],w),Te=jy(Q[0],Q[3],w);Z.minimums.push(Math.min(oe,me,Se,Te)),Z.maximums.push(Math.max(oe,me,Se,Te)),Z.leaves.push(1)}for(A.push(Z),L/=2;L>=1;L/=2){const ne=A[A.length-1];Z=new $D(L);for(let oe=0;oe<L*L;oe++){q(oe%L,Math.floor(oe/L),2,!0,Q);const me=ne.getElevation(Q[0],Q[1]),Se=ne.getElevation(Q[2],Q[1]),Te=ne.getElevation(Q[2],Q[3]),Le=ne.getElevation(Q[0],Q[3]),Re=ne.isLeaf(Q[0],Q[1]),Ue=ne.isLeaf(Q[2],Q[1]),rt=ne.isLeaf(Q[2],Q[3]),Qe=ne.isLeaf(Q[0],Q[3]),ht=Math.min(me.min,Se.min,Te.min,Le.min),yt=Math.max(me.max,Se.max,Te.max,Le.max),Et=Re&&Ue&&rt&&Qe;Z.maximums.push(yt),Z.minimums.push(ht),Z.leaves.push(yt-ht<=5&&Et?1:0)}A.push(Z)}return A})(this.dem),d=o.length-1,g=o[d];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(o,0,0,d,0)}raycastRoot(n,o,d,g,w,S,A=1){return GD([n,o,-100],[d,g,this.maximums[0]*A],w,S)}raycast(n,o,d,g,w,S,A=1){if(!this.nodeCount)return null;const L=this.raycastRoot(n,o,d,g,w,S,A);if(L==null)return null;const N=[],q=[],Z=[],Q=[],ne=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;ne.length>0;){const{idx:oe,t:me,nodex:Se,nodey:Te,depth:Le}=ne.pop();if(this.leaves[oe]){WD(Se,Te,Le,n,o,d,g,Z,Q);const Ue=1<<Le,rt=(Se+0)/Ue,Qe=(Se+1)/Ue,ht=(Te+0)/Ue,yt=(Te+1)/Ue,Et=jy(rt,ht,this.dem)*A,ai=jy(Qe,ht,this.dem)*A,kt=jy(Qe,yt,this.dem)*A,fi=jy(rt,yt,this.dem)*A,Ti=qD(Z[0],Z[1],Et,Q[0],Z[1],ai,Q[0],Q[1],kt,w,S),Si=qD(Q[0],Q[1],kt,Z[0],Q[1],fi,Z[0],Z[1],Et,w,S),Bi=Math.min(Ti!==null?Ti:Number.MAX_VALUE,Si!==null?Si:Number.MAX_VALUE);if(Bi!==Number.MAX_VALUE)return Bi;{const ji=mr([],w,S,me);if(XD(Et,ai,fi,kt,HD(ji[0],Z[0],Q[0]),HD(ji[1],Z[1],Q[1]))>=ji[2])return me}continue}let Re=0;for(let Ue=0;Ue<this._siblingOffset.length;Ue++){WD((Se<<1)+this._siblingOffset[Ue][0],(Te<<1)+this._siblingOffset[Ue][1],Le+1,n,o,d,g,Z,Q),Z[2]=-100,Q[2]=this.maximums[this.childOffsets[oe]+Ue]*A;const rt=GD(Z,Q,w,S);if(rt!=null){const Qe=rt;N[Ue]=Qe;let ht=!1;for(let yt=0;yt<Re&&!ht;yt++)Qe>=N[q[yt]]&&(q.splice(yt,0,Ue),ht=!0);ht||(q[Re]=Ue),Re++}}for(let Ue=0;Ue<Re;Ue++){const rt=q[Ue];ne.push({idx:this.childOffsets[oe]+rt,t:N[rt],nodex:(Se<<1)+this._siblingOffset[rt][0],nodey:(Te<<1)+this._siblingOffset[rt][1],depth:Le+1})}}return null}_addNode(n,o,d){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,d,g,w){if(n[g].isLeaf(o,d)===1)return;this.childOffsets[w]||(this.childOffsets[w]=this.nodeCount);const S=g-1,A=n[S];let L=0,N=0;for(let q=0;q<this._siblingOffset.length;q++){const Z=2*o+this._siblingOffset[q][0],Q=2*d+this._siblingOffset[q][1],ne=A.getElevation(Z,Q),oe=A.isLeaf(Z,Q),me=this._addNode(ne.min,ne.max,oe);oe&&(L|=1<<q),N||(N=me)}for(let q=0;q<this._siblingOffset.length;q++)L&1<<q||this._construct(n,2*o+this._siblingOffset[q][0],2*d+this._siblingOffset[q][1],S,N+q)}}function XD(a,n,o,d,g,w){return Gn(Gn(a,o,w),Gn(n,d,w),g)}function jy(a,n,o){const d=o.dim,g=we(a*d-.5,0,d-1),w=we(n*d-.5,0,d-1),S=Math.floor(g),A=Math.floor(w),L=Math.min(S+1,d-1),N=Math.min(A+1,d-1);return XD(o.get(S,A),o.get(L,A),o.get(S,N),o.get(L,N),g-S,w-A)}const Q8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eU(a,n,o){return(256*a*256+256*n+o)/10-1e4}function tU(a,n,o){return 256*a+n+o/256-32768}class kT{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,d,g=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void mn(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const w=this.dim=o.height-2,S=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let L=0;L<w;L++)S[this._idx(-1,L)]=S[this._idx(0,L)],S[this._idx(w,L)]=S[this._idx(w-1,L)],S[this._idx(L,-1)]=S[this._idx(L,0)],S[this._idx(L,w)]=S[this._idx(L,w-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(w,-1)]=S[this._idx(w-1,0)],S[this._idx(-1,w)]=S[this._idx(0,w-1)],S[this._idx(w,w)]=S[this._idx(w-1,w-1)]}const A=d==="terrarium"?tU:eU;for(let L=0;L<S.length;++L){const N=4*L;this.floatView[L]=A(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=Ta.now()}_buildQuadTree(){this._tree=new ZD(this)}get(n,o,d=!1){d&&(n=we(n,-1,this.dim),o=we(o,-1,this.dim));const g=this._idx(n,o);return this.floatView[g]}set(n,o,d){const g=this._idx(n,o),w=this.floatView[g];return this.floatView[g]=d,d-w}static getUnpackVector(n){return Q8[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const d=[0,0,0,0],g=kT.getUnpackVector(o);let w=Math.floor((n+g[3])/g[2]);return d[2]=w%256,w=Math.floor(w/256),d[1]=w%256,w=Math.floor(w/256),d[0]=w,d}getPixels(){return new kv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=o*this.dim,w=o*this.dim+this.dim,S=d*this.dim,A=d*this.dim+this.dim;switch(o){case-1:g=w-1;break;case 1:w=g+1}switch(d){case-1:S=A-1;break;case 1:A=S+1}const L=-o*this.dim,N=-d*this.dim;for(let q=S;q<A;q++)for(let Z=g;Z<w;Z++){const Q=4*this._idx(Z,q),ne=4*this._idx(Z+L,q+N);this.pixels[Q+0]=n.pixels[ne+0],this.pixels[Q+1]=n.pixels[ne+1],this.pixels[Q+2]=n.pixels[ne+2],this.pixels[Q+3]=n.pixels[ne+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function iU(a,n,o){a===1?n.headerLength=o.readFixed32():a===2?n.x=o.readVarint():a===3?n.y=o.readVarint():a===4?n.z=o.readVarint():a===5&&n.layers.push((function(d,g){return d.readFields(aU,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)})(o,o.readVarint()+o.pos))}function nU(a,n,o){a===1?(n.delta_filter=(function(d,g){return d.readFields(rU,{blockSize:0},g)})(o,o.readVarint()+o.pos),n.filter="delta_filter"):a===2?(o.readVarint(),n.filter="zigzag_filter"):a===3?(o.readVarint(),n.filter="bitshuffle_filter"):a===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function rU(a,n,o){a===1&&(n.blockSize=o.readVarint())}function sU(a,n,o){a===1?(o.readVarint(),n.codec="gzip_data"):a===2?(o.readVarint(),n.codec="jpeg_image"):a===3?(o.readVarint(),n.codec="webp_image"):a===4&&(o.readVarint(),n.codec="png_image")}function oU(a,n,o){let d=0,g=0;a===1?n.firstByte=o.readFixed64():a===2?n.lastByte=o.readFixed64():a===3?n.filters.push((function(w,S){return w.readFields(nU,{},S)})(o,o.readVarint()+o.pos)):a===4?n.codec=(function(w,S){return w.readFields(sU,{},S)})(o,o.readVarint()+o.pos):a===5?g=o.readFloat():a===6?d=o.readFloat():a===7?n.bands.push(o.readString()):a===8?n.offset=o.readDouble():a===9&&(n.scale=o.readDouble()),n.offset===0&&(n.offset=g),n.scale===0&&(n.scale=d)}function aU(a,n,o){a===1?n.version=o.readVarint():a===2?n.name=o.readString():a===3?n.units=o.readString():a===4?n.tileSize=o.readVarint():a===5?n.buffer=o.readVarint():a===6?n.pixelFormat=o.readVarint():a===7&&n.dataIndex.push((function(d,g){return d.readFields(oU,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)})(o,o.readVarint()+o.pos))}function lU(a,n,o){if(a===2)(function(d,g,w){d.readFields(cU,w,g)})(o,o.readVarint()+o.pos,n);else if(a===3)throw new Error("Not implemented")}function cU(a,n,o){if(a===1){let d=0;const g=o.readVarint()+o.pos;for(;o.pos<g;)n[d++]=o.readVarint()}}function uU(a,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let d=2;d>=1;d--){const g=d===1?1:0,w=d===2?1:0;for(let S=0;S<n[0];S++){const A=n[1]*S;for(let L=g;L<n[1];L++){const N=n[2]*(L+A);for(let q=w;q<n[2];q++){const Z=n[3]*(q+N);for(let Q=0;Q<n[3];Q++){const ne=Z+Q;a[ne]+=a[ne-o]}}}}o*=n[d]}return a}function hU(a){for(let n=0,o=a.length;n<o;n++)a[n]=a[n]>>>1^-(1&a[n]);return a}function dU(a,n){switch(n){case"uint32":return a;case"uint16":for(let o=0;o<a.length;o+=2){const d=a[o],g=a[o+1];a[o]=(240&d)>>4|(61440&d)>>8|(240&g)<<4|61440&g,a[o+1]=15&d|(3840&d)>>4|(15&g)<<8|(3840&g)<<4}return a;case"uint8":for(let o=0;o<a.length;o+=4){const d=a[o],g=a[o+1],w=a[o+2],S=a[o+3];a[o+0]=(192&d)>>6|(192&g)>>4|(192&w)>>2|192&S,a[o+1]=(48&d)>>4|(48&g)>>2|48&w|(48&S)<<2,a[o+2]=(12&d)>>2|12&g|(12&w)<<2|(12&S)<<4,a[o+3]=3&d|(3&g)<<2|(3&w)<<4|(3&S)<<6}return a;default:throw new Error(`Invalid pixel format, "${n}"`)}}Cn(kT,"DEMData"),Cn(ZD,"DemMinMaxQuadTree",{omit:["dem"]});var Of=Uint8Array,R1=Uint16Array,fU=Int32Array,YD=new Of([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),KD=new Of([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pU=new Of([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),JD=function(a,n){for(var o=new R1(31),d=0;d<31;++d)o[d]=n+=1<<a[d-1];var g=new fU(o[30]);for(d=1;d<30;++d)for(var w=o[d];w<o[d+1];++w)g[w]=w-o[d]<<5|d;return{b:o,r:g}},QD=JD(YD,2),eL=QD.b,mU=QD.r;eL[28]=258,mU[258]=28;for(var gU=JD(KD,0).b,tL=new R1(32768),El=0;El<32768;++El){var bx=(43690&El)>>1|(21845&El)<<1;tL[El]=((65280&(bx=(61680&(bx=(52428&bx)>>2|(13107&bx)<<2))>>4|(3855&bx)<<4))>>8|(255&bx)<<8)>>1}var z1=function(a,n,o){for(var d=a.length,g=0,w=new R1(n);g<d;++g)a[g]&&++w[a[g]-1];var S,A=new R1(n);for(g=1;g<n;++g)A[g]=A[g-1]+w[g-1]<<1;S=new R1(1<<n);var L=15-n;for(g=0;g<d;++g)if(a[g])for(var N=g<<4|a[g],q=n-a[g],Z=A[a[g]-1]++<<q,Q=Z|(1<<q)-1;Z<=Q;++Z)S[tL[Z]>>L]=N;return S},O1=new Of(288);for(El=0;El<144;++El)O1[El]=8;for(El=144;El<256;++El)O1[El]=9;for(El=256;El<280;++El)O1[El]=7;for(El=280;El<288;++El)O1[El]=8;var iL=new Of(32);for(El=0;El<32;++El)iL[El]=5;var _U=z1(O1,9),yU=z1(iL,5),nC=function(a){for(var n=a[0],o=1;o<a.length;++o)a[o]>n&&(n=a[o]);return n},dm=function(a,n,o){var d=n/8|0;return(a[d]|a[d+1]<<8)>>(7&n)&o},rC=function(a,n){var o=n/8|0;return(a[o]|a[o+1]<<8|a[o+2]<<16)>>(7&n)},vU=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fm=function(a,n,o){var d=new Error(n||vU[a]);if(d.code=a,Error.captureStackTrace&&Error.captureStackTrace(d,fm),!o)throw d;return d},xU=new Of(0),bU=typeof TextDecoder<"u"&&new TextDecoder;try{bU.decode(xU,{stream:!0})}catch{}const wU={gzip_data:"gzip"};class bp extends Error{constructor(n){super(n),this.name="MRTError"}}const TU={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},nL={uint32:1,uint16:2,uint8:4},SU={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let sC;class DT{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new bp(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),d=new DataView(n);if(o[0]!==13)throw new bp("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),d=this.getHeaderLength(n);if(o.length<d)throw new bp(`Expected header with length >= ${d} but got buffer of length ${o.length}`);const g=new sC(o.subarray(0,d)).readFields(iU,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new bp(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const w of g.layers)this.layers[w.name]=new rL(w,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],d=this.getLayer(n.layerName);for(let g of n.blockIndices){const w=d.dataIndex[g],S=w.firstByte-n.firstByte,A=w.lastByte-n.firstByte;if(d._blocksInProgress.has(g))continue;const L={layerName:d.name,firstByte:S,lastByte:A,pixelFormat:d.pixelFormat,blockIndex:g,blockShape:[w.bands.length].concat(d.bandShape),buffer:d.buffer,codec:w.codec.codec,filters:w.filters.map((N=>N.filter))};d._blocksInProgress.add(g),o.push(L)}return new sL(o,(()=>{o.forEach((g=>d._blocksInProgress.delete(g.blockIndex)))}),((g,w)=>{if(o.forEach((S=>d._blocksInProgress.delete(S.blockIndex))),g)throw g;w.forEach((S=>{this.getLayer(S.layerName).processDecodedData(S)}))}))}}class rL{constructor({version:n,name:o,units:d,tileSize:g,pixelFormat:w,buffer:S,dataIndex:A},L){if(this.version=n,this.version!==1)throw new bp(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=d,this.tileSize=g,this.buffer=S,this.pixelFormat=TU[w],this.dataIndex=A,this.bandShape=[g+2*S,g+2*S,nL[this.pixelFormat]],this._decodedBlocks=new MT(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return nL[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:n})=>n)).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[d,g]of this.dataIndex.entries()){for(const[w,S]of g.bands.entries())if(S===n)return{bandIndex:o+w,blockIndex:d,blockBandIndex:w};o+=g.bands.length}break;case"number":for(const[d,g]of this.dataIndex.entries()){if(n>=o&&n<o+g.bands.length)return{bandIndex:n,blockIndex:d,blockBandIndex:n-o};o+=g.bands.length}break;default:throw new bp(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(n){let o=1/0,d=-1/0;const g=[],w=new Set;for(const S of n){const{blockIndex:A}=this.getBlockForBand(S);if(A<0)throw new bp(`Invalid band: ${JSON.stringify(S)}`);const L=this.dataIndex[A];g.includes(A)||g.push(A),w.add(A),o=Math.min(o,L.firstByte),d=Math.max(d,L.lastByte)}if(w.size>this.cacheSize)throw new bp(`Number of blocks to decode (${w.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:d,blockIndices:g}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:d}=this.getBlockForBand(n);if(o<0)throw new bp(`Band not found: ${JSON.stringify(n)}`);const g=this._decodedBlocks.get(o.toString());if(!g)throw new bp(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const w=this.dataIndex[o],S=this.bandShape.reduce(((N,q)=>N*q),1),A=d*S,L=g.subarray(A,A+S);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:w.offset,scale:w.scale}}}DT.setPbf=function(a){sC=a};class sL{constructor(n,o,d){this.tasks=n,this._onCancel=o,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}DT.performDecoding=function(a,n){const o=new Uint8Array(a);return Promise.all(n.tasks.map((d=>{const{layerName:g,firstByte:w,lastByte:S,pixelFormat:A,blockShape:L,blockIndex:N,filters:q,codec:Z}=d,Q=o.subarray(w,S+1),ne=new Uint32Array(L[0]*L[1]*L[2]);let oe;if(Z!=="gzip_data")throw new bp(`Unhandled codec: ${Z}`);return oe=(function(me,Se){if(!globalThis.DecompressionStream&&Se==="gzip_data")return Promise.resolve(((Ue=(function(ht){ht[0]==31&&ht[1]==139&&ht[2]==8||fm(6,"invalid gzip data");var yt=ht[3],Et=10;4&yt&&(Et+=2+(ht[10]|ht[11]<<8));for(var ai=(yt>>3&1)+(yt>>4&1);ai>0;ai-=!ht[Et++]);return Et+(2&yt)})(Re=me))+8>Re.length&&fm(6,"invalid gzip data"),(function(ht,yt,Et,ai){var kt=ht.length;if(!kt||yt.f&&!yt.l)return Et||new Of(0);var fi=!Et,Ti=fi||yt.i!=2,Si=yt.i;fi&&(Et=new Of(3*kt));var Bi,ji,zi=function(Ks){var ks=Et.length;if(Ks>ks){var Fs=new Of(Math.max(2*ks,Ks));Fs.set(Et),Et=Fs}},Oi=yt.f||0,di=yt.p||0,ui=yt.b||0,Fi=yt.l,tn=yt.d,Xi=yt.m,Vn=yt.n,_n=8*kt;do{if(!Fi){Oi=dm(ht,di,1);var In=dm(ht,di+1,3);if(di+=3,!In){var Dn=ht[(pi=4+((di+7)/8|0))-4]|ht[pi-3]<<8,jr=pi+Dn;if(jr>kt){Si&&fm(0);break}Ti&&zi(ui+Dn),Et.set(ht.subarray(pi,jr),ui),yt.b=ui+=Dn,yt.p=di=8*jr,yt.f=Oi;continue}if(In==1)Fi=_U,tn=yU,Xi=9,Vn=5;else if(In==2){var Ki=dm(ht,di,31)+257,Rn=dm(ht,di+10,15)+4,wr=Ki+dm(ht,di+5,31)+1;di+=14;for(var os=new Of(wr),ds=new Of(19),Mr=0;Mr<Rn;++Mr)ds[pU[Mr]]=dm(ht,di+3*Mr,7);di+=3*Rn;var Ys=nC(ds),et=(1<<Ys)-1,st=z1(ds,Ys);for(Mr=0;Mr<wr;){var pi,Ni=st[dm(ht,di,et)];if(di+=15&Ni,(pi=Ni>>4)<16)os[Mr++]=pi;else{var dn=0,fn=0;for(pi==16?(fn=3+dm(ht,di,3),di+=2,dn=os[Mr-1]):pi==17?(fn=3+dm(ht,di,7),di+=3):pi==18&&(fn=11+dm(ht,di,127),di+=7);fn--;)os[Mr++]=dn}}var Un=os.subarray(0,Ki),Wn=os.subarray(Ki);Xi=nC(Un),Vn=nC(Wn),Fi=z1(Un,Xi),tn=z1(Wn,Vn)}else fm(1);if(di>_n){Si&&fm(0);break}}Ti&&zi(ui+131072);for(var Ir=(1<<Xi)-1,zr=(1<<Vn)-1,Vr=di;;Vr=di){var rs=(dn=Fi[rC(ht,di)&Ir])>>4;if((di+=15&dn)>_n){Si&&fm(0);break}if(dn||fm(2),rs<256)Et[ui++]=rs;else{if(rs==256){Vr=di,Fi=null;break}var cr=rs-254;rs>264&&(cr=dm(ht,di,(1<<(Es=YD[Mr=rs-257]))-1)+eL[Mr],di+=Es);var xr=tn[rC(ht,di)&zr],gs=xr>>4;if(xr||fm(3),di+=15&xr,Wn=gU[gs],gs>3){var Es=KD[gs];Wn+=rC(ht,di)&(1<<Es)-1,di+=Es}if(di>_n){Si&&fm(0);break}Ti&&zi(ui+131072);var Is=ui+cr;if(ui<Wn){var $s=0-Wn,to=Math.min(Wn,Is);for($s+ui<0&&fm(3);ui<to;++ui)Et[ui]=(void 0)[$s+ui]}for(;ui<Is;++ui)Et[ui]=Et[ui-Wn]}}yt.l=Fi,yt.p=Vr,yt.b=ui,yt.f=Oi,Fi&&(Oi=1,yt.m=Xi,yt.d=tn,yt.n=Vn)}while(!Oi);return ui!=Et.length&&fi?(Bi=Et,((ji=ui)==null||ji>Bi.length)&&(ji=Bi.length),new Of(Bi.subarray(0,ji))):Et.subarray(0,ui)})(Re.subarray(Ue,-8),{i:2},new Of(((Te=Re)[(Le=Te.length)-4]|Te[Le-3]<<8|Te[Le-2]<<16|Te[Le-1]<<24)>>>0))));var Te,Le,Re,Ue;const rt=wU[Se];if(!rt)throw new Error(`Unhandled codec: ${Se}`);const Qe=new globalThis.DecompressionStream(rt);return new Response(new Blob([me]).stream().pipeThrough(Qe)).arrayBuffer().then((ht=>new Uint8Array(ht)))})(Q,Z).then((me=>((function(Se,Te){Se.readFields(lU,Te)})(new sC(me),ne),new SU[A](ne.buffer)))),oe.then((me=>{for(let Se=q.length-1;Se>=0;Se--)switch(q[Se]){case"delta_filter":uU(me,L);break;case"zigzag_filter":hU(me);break;case"bitshuffle_filter":dU(me,A);break;default:throw new bp(`Unhandled filter "${q[Se]}"`)}return{layerName:g,blockIndex:N,data:me}})).catch((me=>{throw me}))})))},Cn(sL,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Cn(DT,"MapboxRasterTile"),Cn(rL,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class oL{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const d=n[o];this._stringToNumber[d]=o,this._numberToString[o]=d}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class aL{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Tf(Ji,16,0),this.featureIndexArray=new v0,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,o,d,g,w,S=0,A=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,w,S);const N=this.grid;for(let q=0;q<o.length;q++){const Z=o[q],Q=[1/0,1/0,-1/0,-1/0];for(let ne=0;ne<Z.length;ne++){const oe=Z[ne];Q[0]=Math.min(Q[0],oe.x),Q[1]=Math.min(Q[1],oe.y),Q[2]=Math.max(Q[2],oe.x),Q[3]=Math.max(Q[3],oe.y)}A!==0&&(Q[0]-=A,Q[1]-=A,Q[2]+=A,Q[3]+=A),Q[0]<Ji&&Q[1]<Ji&&Q[2]>=0&&Q[3]>=0&&N.insert(L,Q[0],Q[1],Q[2],Q[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kt(new lT(this.rawTileData)).layers,this.sourceLayerCoder=new oL(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o){const{tilespaceGeometry:d,transform:g,tileTransform:w,pixelPosMatrix:S,availableImages:A,worldview:L}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const N=o.queryRadius?o.queryRadius:0,q=d.bufferedTilespaceBounds,Z=this.grid.query(q.min.x,q.min.y,q.max.x,q.max.y,((me,Se,Te,Le)=>kc(d.bufferedTilespaceGeometry,me-N,Se-N,Te+N,Le+N)));Z.sort(EU);let Q=null;g.elevation&&Z.length>0&&(Q=yx.create(g.elevation,this.tileID));const ne={};let oe;for(let me=0;me<Z.length;me++){const Se=Z[me];if(Se===oe)continue;oe=Se;const Te=this.featureIndexArray.get(Se);let Le=null;this.is3DTile?this.loadMatchingModelFeature(ne,Te,n,d,g,L):this.loadMatchingFeature(ne,Te,n,A,L,((Re,Ue,rt,Qe=0)=>(Le||(Le=mt(Re,this.tileID.canonical,w)),Ue.queryIntersectsFeature(d,Re,rt,Le,this.z,g,S,Q,Qe))))}return ne}loadMatchingFeature(n,o,d,g,w,S){const{featureIndex:A,bucketIndex:L,sourceLayerIndex:N,layoutVertexArrayOffset:q}=o,Z=this.bucketLayerIDs[L],Q=d.layers,ne=Object.keys(Q);if(ne.length&&!yn(ne,Z))return;const oe=d.sourceCache,me=this.sourceLayerCoder.decode(N),Se=this.vtLayers[me].feature(A),Te=this.getId(Se,me);for(let Le=0;Le<Z.length;Le++){const Re=Z[Le];if(!Q[Re])continue;const{styleLayer:Ue,targets:rt}=Q[Re];let Qe={};Te!==void 0&&(Qe=oe.getFeatureState(Ue.sourceLayer,Te));const ht=!S||S(Se,Ue,Qe,q);if(!ht)continue;const yt=new H0(Se,this.z,this.x,this.y,Te);yt.tile=this.tileID.canonical,yt.state=Qe;let Et=this.serializedLayersCache.get(Re);Et||(Et=Ue.serialize(),Et.id=Re,this.serializedLayersCache.set(Re,Et)),yt.source=Et.source,yt.sourceLayer=Et["source-layer"],yt.layer=Object.assign({},Et),yt.layer.paint=lL(Et.paint,Ue.paint,Se,Qe,g),yt.layer.layout=lL(Et.layout,Ue.layout,Se,Qe,g);let ai=!1;for(const kt of rt){this.updateFeatureProperties(yt,kt);const{filter:fi}=kt;if(fi){if(Se.properties=yt.properties,fi.needGeometry){const Ti=Pt(Se,!0);if(!fi.filter(new Us(this.tileID.overscaledZ,{worldview:w}),Ti,this.tileID.canonical))continue}else if(!fi.filter(new Us(this.tileID.overscaledZ,{worldview:w}),Se))continue}ai=!0,kt.targetId&&this.addFeatureVariant(yt,kt)}ai&&this.appendToResult(n,Re,A,yt,ht)}}loadMatchingModelFeature(n,o,d,g,w,S){const{featureIndex:A,bucketIndex:L}=o,N=this.bucketLayerIDs[L],q=d.layers,Z=Object.keys(q);if(!Z.length||yn(Z,N))for(let Q=0;Q<N.length;Q++){const ne=N[Q],{styleLayer:oe,targets:me}=q[ne];if(oe.type!=="model")continue;const Se=g.tile,Te=Se.getBucket(oe);if(!(Te&&Te instanceof ET))continue;const Le=D8(Te,A,g,w);if(!Le)continue;const{z:Re,x:Ue,y:rt}=Se.tileID.canonical,{feature:Qe,intersectionZ:ht,position:yt}=Le;let Et={};Qe.id!==void 0&&(Et=d.sourceCache.getFeatureState(oe.sourceLayer,Qe.id));const ai=new H0({},Re,Ue,rt,Qe.id);ai.tile=this.tileID.canonical,ai.state=Et,ai.properties=Qe.properties,ai.geometry={type:"Point",coordinates:[yt.lng,yt.lat]};let kt=this.serializedLayersCache.get(ne);kt||(kt=oe.serialize(),kt.id=ne,this.serializedLayersCache.set(ne,kt)),ai.source=kt.source,ai.sourceLayer=kt["source-layer"],ai.layer=Object.assign({},kt);let fi=!1;for(const Ti of me){this.updateFeatureProperties(ai,Ti);const{filter:Si}=Ti;if(Si){if(Qe.properties=ai.properties,Si.needGeometry){if(!Si.filter(new Us(this.tileID.overscaledZ,{worldview:S}),Qe,this.tileID.canonical))continue}else if(!Si.filter(new Us(this.tileID.overscaledZ,{worldview:S}),Qe))continue}fi=!0,Ti.targetId&&this.addFeatureVariant(ai,Ti)}fi&&this.appendToResult(n,ne,A,ai,ht)}}updateFeatureProperties(n,o,d){if(o.properties){const g={};for(const w in o.properties){const S=o.properties[w].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,d);S!=null&&(g[w]=S)}n.properties=g}}addFeatureVariant(n,o,d){const g={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(g.properties=n.properties),n.variants=n.variants||{},n.variants[o.targetId]=n.variants[o.targetId]||[],n.variants[o.targetId].push(g)}appendToResult(n,o,d,g,w){let S=n[o];S===void 0&&(S=n[o]=[]),S.push({featureIndex:d,feature:g,intersectionZ:w})}lookupSymbolFeatures(n,o,d,g,w,S){const A={};this.loadVTLayers();for(const L of n)this.loadMatchingFeature(A,{bucketIndex:o,sourceLayerIndex:d,featureIndex:L,layoutVertexArrayOffset:0},g,w,S);return A}loadFeature(n){const{featureIndex:o,sourceLayerIndex:d}=n;this.loadVTLayers();const g=this.sourceLayerCoder.decode(d),w=this.vtFeatures[g];if(w[o])return w[o];const S=this.vtLayers[g].feature(o);return w[o]=S,S}hasLayer(n){for(const o of this.bucketLayerIDs)for(const d of o)if(n===d)return!0;return!1}getId(n,o){let d=n.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const w=fu(g);if(w.result!=="success"){const S=w.value.map((A=>`${A.key}: ${A.message}`)).join(", ");return void mn(`Failed to create expression for promoteId: ${S}`)}this.promoteIdExpression=w.value}d=this.promoteIdExpression.evaluate({zoom:0},n)}else d=n.properties[g];typeof d=="boolean"&&(d=Number(d))}return d}}function lL(a,n,o,d,g){return Qt(a,((w,S)=>{const A=n instanceof H?n.get(S):null;return A&&A.evaluate?A.evaluate(o,d,void 0,g):A}))}function EU(a,n){return n-a}Cn(aL,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const cL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class oC{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,d]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=cL[15&d];if(!w)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(n,2,1),[A]=new Uint32Array(n,4,1);return new oC(A,S,w,n)}constructor(n,o=64,d=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=cL.indexOf(this.ArrayType),S=2*n*this.ArrayType.BYTES_PER_ELEMENT,A=n*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-A%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+L,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+S+A+L),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+A+L,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=o,d}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return aC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:S,nodeSize:A}=this,L=[0,w.length-1,0],N=[];for(;L.length;){const q=L.pop()||0,Z=L.pop()||0,Q=L.pop()||0;if(Z-Q<=A){for(let Se=Q;Se<=Z;Se++){const Te=S[2*Se],Le=S[2*Se+1];Te>=n&&Te<=d&&Le>=o&&Le<=g&&N.push(w[Se])}continue}const ne=Q+Z>>1,oe=S[2*ne],me=S[2*ne+1];oe>=n&&oe<=d&&me>=o&&me<=g&&N.push(w[ne]),(q===0?n<=oe:o<=me)&&(L.push(Q),L.push(ne-1),L.push(1-q)),(q===0?d>=oe:g>=me)&&(L.push(ne+1),L.push(Z),L.push(1-q))}return N}within(n,o,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:S}=this,A=[0,g.length-1,0],L=[],N=d*d;for(;A.length;){const q=A.pop()||0,Z=A.pop()||0,Q=A.pop()||0;if(Z-Q<=S){for(let Se=Q;Se<=Z;Se++)hL(w[2*Se],w[2*Se+1],n,o)<=N&&L.push(g[Se]);continue}const ne=Q+Z>>1,oe=w[2*ne],me=w[2*ne+1];hL(oe,me,n,o)<=N&&L.push(g[ne]),(q===0?n-d<=oe:o-d<=me)&&(A.push(Q),A.push(ne-1),A.push(1-q)),(q===0?n+d>=oe:o+d>=me)&&(A.push(ne+1),A.push(Z),A.push(1-q))}return L}}function aC(a,n,o,d,g,w){if(g-d<=o)return;const S=d+g>>1;uL(a,n,S,d,g,w),aC(a,n,o,d,S-1,1-w),aC(a,n,o,S+1,g,1-w)}function uL(a,n,o,d,g,w){for(;g>d;){if(g-d>600){const N=g-d+1,q=o-d+1,Z=Math.log(N),Q=.5*Math.exp(2*Z/3),ne=.5*Math.sqrt(Z*Q*(N-Q)/N)*(q-N/2<0?-1:1);uL(a,n,o,Math.max(d,Math.floor(o-q*Q/N+ne)),Math.min(g,Math.floor(o+(N-q)*Q/N+ne)),w)}const S=n[2*o+w];let A=d,L=g;for(F1(a,n,d,o),n[2*g+w]>S&&F1(a,n,d,g);A<L;){for(F1(a,n,A,L),A++,L--;n[2*A+w]<S;)A++;for(;n[2*L+w]>S;)L--}n[2*d+w]===S?F1(a,n,d,L):(L++,F1(a,n,L,g)),L<=o&&(d=L+1),o<=L&&(g=L-1)}}function F1(a,n,o,d){lC(a,o,d),lC(n,2*o,2*d),lC(n,2*o+1,2*d+1)}function lC(a,n,o){const d=a[n];a[n]=a[o],a[o]=d}function hL(a,n,o,d){const g=a-o,w=n-d;return g*g+w*w}t.$=rf,t.A=Fh,t.B=Pi,t.C=2,t.D=y_,t.E=Au,t.F=y1,t.G=Fk,t.H=Gf,t.I=Jo,t.J=De,t.K=zn,t.L=nf,t.M=Ou,t.N=xf,t.O=Yg,t.P=yi,t.Q=pc,t.R=ou,t.S=Ve,t.T=j0,t.U=fu,t.V=ST,t.W=bf,t.X=lh,t.Y=pf,t.Z=Yf,t._=Fl,t.a=function(a){return qr.API_CDN_URL_REGEX.test(a)},t.a$=ce,t.a0=sr,t.a1=Uc,t.a2=Xe,t.a3=class extends ST{},t.a4=To,t.a5=Zm,t.a6=fe,t.a7=function(a){const n=a.value;return n?sr(n)?WI(n,!0)?[]:[new ST(a.key,n,`invalid url "${n}"`)]:[new ST(a.key,n,`string expected, "${zn(n)}" found`)]:[]},t.a8=u,t.a9=xe,t.aA=we,t.aB=ye,t.aC=Bt,t.aD=Ql,t.aE=Zs,t.aF=B,t.aG=Be,t.aH=function(a,n){const o={};for(let d=0;d<n.length;d++){const g=n[d];g in a&&(o[g]=a[g])}return o},t.aI=x,t.aJ=G,t.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,n,o,d){const g=this.entries[a]=this.entries[a]||{callbacks:[]};if(g.result){const[w,S]=g.result;return this.scheduler?this.scheduler.add((()=>{d(w,S)}),n):d(w,S),()=>{}}return g.callbacks.push(d),g.cancel||(g.cancel=o(((w,S)=>{g.result=[w,S];for(const A of g.callbacks)this.scheduler?this.scheduler.add((()=>{A(w,S)}),n):A(w,S);setTimeout((()=>delete this.entries[a]),3e3)}))),()=>{g.result||(g.callbacks=g.callbacks.filter((w=>w!==d)),g.callbacks.length||(g.cancel(),delete this.entries[a]))}}},t.aL=function(a,n,o){const d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},(g=>{const w=Tc(a.request,((S,A,L)=>{S?g(S):A&&g(null,{rawData:A,vectorTile:o?void 0:new Kt(new lT(A)),responseHeaders:new Map(L.entries())})}));return()=>{w.cancel(),g()}}),n)},t.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},t.aN=Ko,t.aO=function(a){wc++,wc>Dh&&(a.getActor().send("enforceCacheSizeLimit",Op),wc=0)},t.aP=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},t.aQ=Lo,t.aR=dD,t.aS=yD,t.aT=h,t.aU=hD,t.aV=function(a,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let d=0;d<a.length;d++){const g=document.createElement("source");fd(a[d])||(o.crossOrigin="Anonymous"),g.src=a[d],o.appendChild(g)}return{cancel:()=>{}}},t.aW=w_,t.aX=W0,t.aY=_t,t.aZ=w1,t.a_=ee,t.aa=K,t.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,n){return jn(a.expression.evaluate(n))}interpolate(a,n,o){return{x:Gn(a.x,n.x,o),y:Gn(a.y,n.y,o),z:Gn(a.z,n.z,o),azimuthal:Gn(a.azimuthal,n.azimuthal,o),polar:Gn(a.polar,n.polar,o)}}},t.ac=Us,t.ad=Cr,t.ae=Oe,t.af=St,t.ag=$t,t.ah=Ie,t.ai=H,t.aj=tm,t.ak=Gn,t.al=Ji,t.am=lu,t.an=ns,t.ao=ps,t.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,n){return(function([o,d]){const g=jn([1,o,d]);return{x:g.x,y:g.y,z:g.z}})(a.expression.evaluate(n))}interpolate(a,n,o){return{x:Gn(a.x,n.x,o),y:Gn(a.y,n.y,o),z:Gn(a.z,n.z,o)}}},t.aq=function(a,n,o=0,d=!0){const g=new yi(o,o),w=a.sub(g),S=n.add(g),A=[w,new yi(S.x,w.y),S,new yi(w.x,S.y)];return d&&A.push(w.clone()),A},t.ar=function(a,n){const o=[];for(let d=0;d<a.length;d++){const g=qe(d-1,-1,a.length-1),w=qe(d+1,-1,a.length-1),S=a[d],A=a[w],L=a[g].sub(S).unit(),N=A.sub(S).unit(),q=N.angleWithSep(L.x,L.y),Z=L.add(N).unit().mult(-1*n/Math.sin(q/2));o.push(S.add(Z))}return o},t.as=Yk,t.at=kc,t.au=function(a,n,o=0){return Dt(((n.x-o)*a.scale-a.x)*Ji,(n.y*a.scale-a.y)*Ji,le(n.z,n.y))},t.av=pt,t.aw=Gi,t.ax=Pn,t.ay=vp,t.az=function(a){let n=1/0,o=1/0,d=-1/0,g=-1/0;for(const w of a)n=Math.min(n,w.x),o=Math.min(o,w.y),d=Math.max(d,w.x),g=Math.max(g,w.y);return{min:new yi(n,o),max:new yi(d,g)}},t.b=function(a){return qr.API_FONTS_REGEX.test(a)},t.b$=Uv,t.b0=$o,t.b1=na,t.b2=Ct,t.b3=hy,t.b4=xT,t.b5=function(){mu.isLoading()||mu.isLoaded()||Nu()!=="deferred"||Jm()},t.b6=xt,t.b7=Pt,t.b8=H0,t.b9=io,t.bA=ie,t.bB=We,t.bC=ae,t.bD=function(a,n){const{x:o,y:d}=a.point,g=kb(o,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ye(g,g,Pb(xh(n)))},t.bE=F,t.bF=hn,t.bG=Sr,t.bH=mr,t.bI=nr,t.bJ=gn,t.bK=fx,t.bL=td,t.bM=RI,t.bN=function(a,n,o,d,g){const w=5*n+2;a.float32[w+0]=o,a.float32[w+1]=d,a.float32[w+2]=g},t.bO=_x,t.bP=Ci,t.bQ=fr,t.bR=nn,t.bS=al,t.bT=qe,t.bU=function(a,n,o,d){var g=new O(4);return g[0]=a,g[1]=n,g[2]=o,g[3]=d,g},t.bV=class{isDataAvailableAtPoint(a){const n=this._source();if(this.isUsingMockSource()||!n||a.y<0||a.y>1)return!1;const o=n.getSource().maxzoom,d=1<<o,g=Math.floor(a.x),w=Math.floor((a.x-g)*d),S=Math.floor(a.y*d),A=this.findDEMTileFor(new Lo(o,g,o,w,S));return!(!A||!A.dem)}getAtPointOrZero(a,n=0){return this.getAtPoint(a,n)||0}getAtPoint(a,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const d=this._source();if(!d||a.y<0||a.y>1)return n;const g=d.getSource().maxzoom,w=1<<g,S=Math.floor(a.x),A=a.x-S,L=new Lo(g,S,g,Math.floor(A*w),Math.floor(a.y*w)),N=this.findDEMTileFor(L);if(!N||!N.dem)return n;const q=N.dem,Z=1<<N.tileID.canonical.z,Q=(A*Z-N.tileID.canonical.x)*q.dim,ne=(a.y*Z-N.tileID.canonical.y)*q.dim,oe=Math.floor(Q),me=Math.floor(ne);return(o?this.exaggeration():1)*Gn(Gn(q.get(oe,me),q.get(oe,me+1),ne-me),Gn(q.get(oe+1,me),q.get(oe+1,me+1),ne-me),Q-oe)}static getAtTileOffset(a,n,o,d){const g=1<<a.canonical.z;return d?d.pointElevation(n):o?o.getAtPointOrZero(new Oe(a.wrap+(a.canonical.x+n.x/Ji)/g,(a.canonical.y+n.y/Ji)/g)):0}static getAtTileOffsetFunc(a,n,o,d){return(g,w,S)=>{const A=this.getAtTileOffset(a,g,w,S),L=d.upVector(a.canonical,g.x,g.y);return Fn(L,L,A*d.upVectorScale(a.canonical,n,o).metersToTile),L}}getForTilePoints(a,n,o,d){if(this.isUsingMockSource())return!1;const g=yx.create(this,a,d);return!!g&&(n.forEach((w=>{w[2]=this.exaggeration()*g.getElevationAt(w[0],w[1],o)})),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(a);if(!n||!n.dem)return null;const o=n.dem.tree,d=n.tileID,g=1<<a.canonical.z-d.canonical.z;let w=a.canonical.x/g-d.canonical.x,S=a.canonical.y/g-d.canonical.y,A=0;for(let L=0;L<a.canonical.z-d.canonical.z&&!o.leaves[A];L++){w*=2,S*=2;const N=2*Math.floor(S)+Math.floor(w);A=o.childOffsets[A]+N,w%=1,S%=1}return{min:this.exaggeration()*o.minimums[A],max:this.exaggeration()*o.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let n=!1,o=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const g of a){const w=this.getMinMaxForTile(g.tileID);w&&(o=Math.min(o,w.min),d=Math.max(d,w.max),n=!0)}return n?{min:o,max:d}:null}},t.bW=Py,t.bX=ls,t.bY=ca,t.bZ=__,t.b_=vD,t.ba=sx,t.bb=zv,t.bc=mt,t.bd=pa,t.be=ju,t.bf=ug,t.bg=bo,t.bh=p_,t.bi=qI,t.bj=function(a,n){const o=tm(n.zoom);if(o===0)return xh(a);const d=f_(a),g=T0(d),w=B(d.getWest())*n.worldSize,S=B(d.getEast())*n.worldSize,A=G(d.getNorth())*n.worldSize,L=G(d.getSouth())*n.worldSize,N=[w,A,0],q=[S,A,0],Z=[w,L,0],Q=[S,L,0],ne=pe([],n.globeMatrix);return St(N,N,ne),St(q,q,ne),St(Z,Z,ne),St(Q,Q,ne),g[0]=Yh(g[0],Z,o),g[1]=Yh(g[1],Q,o),g[2]=Yh(g[2],q,o),g[3]=Yh(g[3],N,o),Ln.fromPoints(g)},t.bk=Iv,t.bl=pe,t.bm=S0,t.bn=Yh,t.bo=aa,t.bp=d_,t.bq=je,t.br=de,t.bs=DT,t.bt=lT,t.bu=Tc,t.bv=function(a,n){const o=[];for(const d in a)d in n||o.push(d);return o},t.bw=ot,t.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.by=Ao,t.bz=se,t.c=Ra,t.c$=function(a,n,o){let d=0;for(let g=0;g<2;++g)a[g]>0&&(d+=(a[g]-0)*(a[g]-0)),n[g]<0&&(d+=(0-n[g])*(0-n[g]));return d},t.c0=$v,t.c1=kI,t.c2=Gk,t.c3=NI,t.c4=oC,t.c5=Fn,t.c6=vi,t.c7=qt,t.c8=function(a,n,o){o*=.5;var d=n[0],g=n[1],w=n[2],S=n[3],A=Math.sin(o),L=Math.cos(o);return a[0]=d*L+g*A,a[1]=g*L-d*A,a[2]=w*L+S*A,a[3]=S*L-w*A,a},t.c9=Ne,t.cA=ci,t.cB=ys,t.cC=z,t.cD=Ds,t.cE=em,t.cF=function(a,n,o,d,g,w,S,A,L){if(L.name==="globe")return em(a,n,new Ds(o,d,g),!1);const N=w1({z:o,x:d,y:g},L);return new Ln([(w+N.x/N.scale)*n,n*(N.y/N.scale),S],[(w+N.x2/N.scale)*n,n*(N.y2/N.scale),A])},t.cG=function(a,n,o){return a[0]=Math.min(n[0],o[0]),a[1]=Math.min(n[1],o[1]),a[2]=Math.min(n[2],o[2]),a[3]=Math.min(n[3],o[3]),a},t.cH=function(a,n,o){return a[0]=Math.max(n[0],o[0]),a[1]=Math.max(n[1],o[1]),a[2]=Math.max(n[2],o[2]),a[3]=Math.max(n[3],o[3]),a},t.cI=function(a){const n=Math.round((a+45+360)%360/90)%4;return Mn[n]},t.cJ=he,t.cK=on,t.cL=gy,t.cM=function(a){const n=ie(new Float64Array(16));ye(n,a.pixelMatrix,a.globeMatrix);const o=[0,Mc,0],d=[0,yh,0];return St(o,o,n),St(d,d,n),[o[0]>0&&o[0]<=a.width&&o[1]>0&&o[1]<=a.height&&!_p(a,new h(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!_p(a,new h(a.center.lat,-90))]},t.cN=function(a,n){const{scale:o}=a.tileTransform,d=o*Ji/(a.tileSize*Math.pow(2,n.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(g,w,S){var A=w[1],L=w[2],N=w[3],q=S[0],Z=S[1];return g[0]=w[0]*q,g[1]=A*q,g[2]=L*Z,g[3]=N*Z,g})(new Float32Array(4),n.inverseAdjustmentMatrix,[d,d])},t.cO=U,t.cP=Ht,t.cQ=R,t.cR=function(a){const n=R(a,!0);return F([],[n[0],n[1],n[4],n[5]])},t.cS=Ee,t.cT=pn,t.cU=Pe,t.cV=function(a){const{x:n,y:o}=a.point,{lng:d,lat:g}=a._center;return kb(n,o,a.worldSize,d,g)},t.cW=Qi,t.cX=Ja,t.cY=Io,t.cZ=Dl,t.c_=_h,t.ca=oo,t.cb=function(a,n){return a[0]=-n[0],a[1]=-n[1],a[2]=-n[2],a[3]=n[3],a},t.cc=Lt,t.cd=function(a,n,o,d,g){var w=1/Math.tan(n/2);if(a[0]=w/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=w,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0){var S=1/(d-g);a[10]=(g+d)*S,a[14]=2*g*d*S}else a[10]=-1,a[14]=-2*d;return a},t.ce=function(a,n,o,d,g,w,S){var A=1/(n-o),L=1/(d-g),N=1/(w-S);return a[0]=-2*A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*L,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*N,a[11]=0,a[12]=(n+o)*A,a[13]=(g+d)*L,a[14]=(S+w)*N,a[15]=1,a},t.cf=J,t.cg=function(a,n,o){a[4*n+0]=o[0],a[4*n+1]=o[1],a[4*n+2]=o[2],a[4*n+3]=o[3]},t.ch=pp,t.ci=Qp,t.cj=lo,t.ck=Hh,t.cl=a_,t.cm=tD,t.cn=function(){var a=new O(4);return O!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},t.co=function(a,n,o){var d=n[0],g=n[1],w=n[2],S=n[3],A=Math.sin(o),L=Math.cos(o);return a[0]=d*L+w*A,a[1]=g*L+S*A,a[2]=d*-A+w*L,a[3]=g*-A+S*L,a},t.cp=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]},t.cq=Ui,t.cr=function(a){var n=a[0],o=a[1],d=a[2],g=a[3];return Math.sqrt(n*n+o*o+d*d+g*g)},t.cs=bi,t.ct=Ai,t.cu=la,t.cv=3,t.cw=2,t.cx=7,t.cy=6,t.cz=Ur,t.d=function(a){return qr.API_TILEJSON_REGEX.test(a)},t.d$=class{constructor(a,n,o,d){this.context=a,this.format=d,this.size=o,this.texture=a.gl.createTexture();const[g,w,S]=this.size,{gl:A}=a;A.bindTexture(A.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in n&&n.data&&A.texImage3D(A.TEXTURE_3D,0,this.format,g,w,S,0,Oy(this.format),b_(this.format),n.data)}bind(a,n){const{context:o}=this,{gl:d}=o;d.bindTexture(d.TEXTURE_3D,this.texture),a!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,a),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,a),this.minFilter=a),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},t.d0=function(a){return a*a*a*a*a},t.d1=k,t.d2=45,t.d3=py,t.d4=function(a,n,o){const d=Math.sqrt(a*a+n*n+o*o),g=d>0?Math.acos(o/d)*sa:0;let w=a!==0||n!==0?Math.atan2(-n,-a)*sa+90:0;return w<0&&(w+=360),[d,w,g]},t.d5=Dt,t.d6=jn,t.d7=Ae,t.d8=vt,t.d9=Ln,t.dA=function(a){return a({pluginStatus:Pl,pluginURL:Ac}),Rd.on("pluginStateChange",a),a},t.dB=sg,t.dC=class extends qh{constructor(a){super(a),this.current=l_}set(a,n,o){if(this.fetchUniformLocation(a,n)){for(let d=0;d<9;d++)if(o[d]!==this.current[d]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},t.dD=Qa,t.dE=function(a,n,o){const d=tm(o.zoom),g=a.style.map._antialias,w=a.terrain&&a.terrain.exaggeration()>0;return d===0&&!g&&!w},t.dF=function(a){const n=a.pixelsPerMeter,o=n/J(1,a.center.lat),d=ie(new Float64Array(16));return de(d,d,[a.point.x,a.point.y,0]),Ee(d,d,[o,o,n]),Float32Array.from(d)},t.dG=f_,t.dH=function(a){const n=he-5;a=we(a,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(ns(a))),3);return Math.round(o*(_y.length-1))},t.dI=function(a,n,o,d){const g=n.getNorth(),w=n.getSouth(),S=n.getWest(),A=n.getEast(),L=1<<a.z,N=A-S,q=g-w,Z=N/cg,Q=-q/_y[o],ne=[0,Z,0,Q,0,0,g,S,0];if(a.z>0){const oe=180/d;Y(ne,ne,[oe/N+1,0,0,0,oe/q+1,0,-.5*oe/Z,.5*oe/Q,1])}return ne[2]=L,ne[5]=a.x,ne[8]=a.y,ne},t.dJ=xh,t.dK=function(a,n,o){const d=ie(new Float64Array(16)),g=(n/(1<<a)-.5)*Math.PI*2;return Ze(d,o.globeMatrix,g),Float32Array.from(d)},t.dL=kv,t.dM=Od,t.dN=function(a,n){return[Math.pow(a[0],2.2)*n,Math.pow(a[1],2.2)*n,Math.pow(a[2],2.2)*n]},t.dO=$,t.dP=function(a,n){var o=Math.sin(n),d=Math.cos(n);return a[0]=d,a[1]=o,a[2]=0,a[3]=-o,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},t.dQ=Gt,t.dR=u2,t.dS=Wr,t.dT=ao,t.dU=256,t.dV=function(a,n){const o=[0,0,0];return St(o,o,Iv(xh(n.canonical))),St(o,o,a),o},t.dW=a=>({u_matrix:new a_(a),u_texsize:new Hh(a),u_pixels_to_tile_units:new og(a),u_device_pixel_ratio:new lo(a),u_width_scale:new lo(a),u_floor_width_scale:new lo(a),u_image:new pp(a),u_units_to_pixels:new Hh(a),u_tile_units_to_pixels:new lo(a),u_alpha_discard_threshold:new lo(a),u_trim_offset:new Hh(a),u_trim_fade_range:new Hh(a),u_trim_color:new py(a),u_zbias_factor:new lo(a),u_tile_to_meter:new lo(a),u_ground_shadow_factor:new Qp(a),u_pattern_transition:new lo(a)}),t.dX=a=>({u_matrix:new a_(a),u_pixels_to_tile_units:new og(a),u_device_pixel_ratio:new lo(a),u_width_scale:new lo(a),u_floor_width_scale:new lo(a),u_units_to_pixels:new Hh(a),u_dash_image:new pp(a),u_gradient_image:new pp(a),u_image_height:new lo(a),u_texsize:new Hh(a),u_tile_units_to_pixels:new lo(a),u_alpha_discard_threshold:new lo(a),u_trim_offset:new Hh(a),u_trim_fade_range:new Hh(a),u_trim_color:new py(a),u_zbias_factor:new lo(a),u_tile_to_meter:new lo(a),u_ground_shadow_factor:new Qp(a)}),t.dY=a=>({u_camera_to_center_distance:new lo(a),u_extrude_scale:new og(a),u_device_pixel_ratio:new lo(a),u_matrix:new a_(a),u_inv_rot_matrix:new a_(a),u_merc_center:new Hh(a),u_tile_id:new Qp(a),u_zoom_transition:new lo(a),u_up_dir:new Qp(a),u_emissive_strength:new lo(a)}),t.dZ=Yp,t.d_=zf,t.da=wi,t.db=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},t.dc=rx,t.dd=dr,t.de=zt,t.df=WI,t.dg=function(a,n){return a.readFields(z8,{icons:[]},n)},t.dh=N0,t.di=px,t.dj=OI,t.dk=Zl,t.dl=Bu,t.dm=Xu,t.dn=Rh,t.dp=xi,t.dq=function(a){const n=a.indexOf(Di);return n>=0?a.slice(0,n):a},t.dr=function(a){return a.indexOf(Di)>=0},t.ds=function(a){const n=a.lastIndexOf(Di);return n>=0?a.slice(n+1):""},t.dt=function(a){const n=[],o=a.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},t.du=function(a,n,o,d){return a.type==="custom"?new A8(a,n):new L8[a.type](a,n,o,d)},t.dv=Ri,t.dw=function(a){const n=a.indexOf(Di);return n>=0?a.slice(n+1):""},t.dx=class extends H0{constructor(a,n){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},t.dy=Rd,t.dz=el,t.e=qr,t.e$=Ft,t.e0=Av,t.e1=(a,n,o,d,g,w)=>{const S=a.transform,A=S.projection.name==="globe";let L;if(w.paint.get("circle-pitch-alignment")==="map")if(A){const q=u2(S.zoom,n.canonical)*S._pixelsPerMercatorPixel;L=Float32Array.from([q,0,0,q])}else L=S.calculatePixelsToTileUnitsMatrix(o);else L=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(S.projection),u_matrix:a.translatePosMatrix(n.projMatrix,o,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ta.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:Cv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:w.paint.get("circle-emissive-strength")};if(A){N.u_inv_rot_matrix=d,N.u_merc_center=g,N.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],N.u_zoom_transition=tm(S.zoom);const q=g[0]*Ji,Z=g[1]*Ji;N.u_up_dir=S.projection.upVector(new Ds(0,0,0),q,Z)}return N},t.e2=nT,t.e3=tl,t.e4=(a,n,o,d,g,w,S,A,L,N)=>{const q=a.transform,Z=q.pitch<15?f1(.07,.7,we((14-q.zoom)/5,0,1)):.07,Q=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:iT(a,n,o,d),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:q.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_width_scale:w,u_floor_width_scale:S,u_image:0,u_tile_units_to_pixels:p1(n,q),u_units_to_pixels:[1/q.pixelsToGLUnits[0],1/q.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(Q?null:o.lut).toArray01(),u_zbias_factor:Z,u_tile_to_meter:Ae(n.tileID.canonical,0),u_ground_shadow_factor:L,u_pattern_transition:N}},t.e5=(a,n,o,d,g,w,S,A,L,N)=>{const q=a.transform,Z=q.calculatePixelsToTileUnitsMatrix(n),Q=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",ne=q.pitch<15?f1(.07,.7,we((14-q.zoom)/5,0,1)):.07;return{u_matrix:iT(a,n,o,d),u_pixels_to_tile_units:Z,u_device_pixel_ratio:w,u_width_scale:S,u_floor_width_scale:A,u_units_to_pixels:[1/q.pixelsToGLUnits[0],1/q.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:rT(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:p1(n,a.transform),u_alpha_discard_threshold:0,u_trim_offset:L,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(Q?null:o.lut).toArray01(),u_zbias_factor:ne,u_tile_to_meter:Ae(n.tileID.canonical,0),u_ground_shadow_factor:N}},t.e6=Jt,t.e7=Fd,t.e8=le,t.e9=vh,t.eA=function(a,n){var o=2*Math.acos(n[3]),d=Math.sin(o/2);return d>P?(a[0]=n[0]/d,a[1]=n[1]/d,a[2]=n[2]/d):(a[0]=1,a[1]=0,a[2]=0),o},t.eB=YI,t.eC=it,t.eD=Me,t.eE=[1,1,1],t.eF=yx,t.eG=qi,t.eH=function(a,n,o,d){var g=n[0],w=n[1],S=n[2],A=n[3];return a[0]=g+d*(o[0]-g),a[1]=w+d*(o[1]-w),a[2]=S+d*(o[2]-S),a[3]=A+d*(o[3]-A),a},t.eI=$e,t.eJ=Ws,t.eK=yu,t.eL=function(a,n,o,d,g,w,S,A,L,N,q,Z,Q,ne,oe,me){var Se=new O(16);return Se[0]=a,Se[1]=n,Se[2]=o,Se[3]=d,Se[4]=g,Se[5]=w,Se[6]=S,Se[7]=A,Se[8]=L,Se[9]=N,Se[10]=q,Se[11]=Z,Se[12]=Q,Se[13]=ne,Se[14]=oe,Se[15]=me,Se},t.eM=v,t.eN=zd,t.eO=mh,t.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new yi(1/0,1/0),max:new yi(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,n=!1){const o=L0(new yi(0,0),new yi(Ji,Ji),a),d=[];if(n&&!Yb(o,this._globalClipBounds))return d;for(const g of this._activeRegions){if(g.hiddenByOverlap||!Yb(o,g))continue;const w=Vv(g.min,g.max,a);d.push({min:w.min,max:w.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return d}setSources(a){this._setSources(a.map((n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const d of n.cache.getVisibleCoordinates()){const g=n.cache.getTile(d).buckets[n.layer];g&&g.updateFootprints(d.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope}))))}_addSource(a){const n=a.getFootprints();if(n.length===0)return;const o=a.getOrder(),d=a.getClipMask(),g=a.getClipScope();for(const w of n){if(!w.footprint)continue;const S=L0(w.footprint.min,w.footprint.max,w.id);this._activeRegions.push({min:S.min,max:S.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:w.id,footprint:w.footprint,order:o,clipMask:d,clipScope:g})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort(((n,o)=>n.priority-o.priority||Ey(n.min,o.min)||Ey(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||(function(d,g){const w=(S,A)=>S+A;return d.length-g.length||d.reduce(w,"").localeCompare(g.reduce(w,""))})(n.clipScope,o.clipScope)));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let n=0;for(;!a&&n!==this._activeRegions.length;){const o=this._activeRegions[n],d=this._prevRegions[n];a=o.priority!==d.priority||!Xb(o,d)||o.order!==d.order||o.clipMask!==d.clipMask||!Ao(o.clipScope,d.clipScope),this._activeRegions[n].hiddenByOverlap=d.hiddenByOverlap,++n}}if(a){++this._updateTime;for(const o of this._activeRegions)o.order!==Sy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const d=this._activeRegions;if(o>=d.length)return o;const g=d[o].priority;for(;o<d.length&&d[o].priority===g;)++o;return o};if(this._sourceIds.length>1){let o=0,d=n(o);for(;o!==d;){let g=o;const w=o;for(;g!==d;){const S=this._activeRegions[g];S.hiddenByOverlap=!1;for(let A=0;A<w;A++){const L=this._activeRegions[A];if(!L.hiddenByOverlap&&S.order===Sy&&Yb(S,L)&&(S.hiddenByOverlap=jv(S.footprint,S.tileId,L.footprint,L.tileId),S.hiddenByOverlap))break}++g}o=d,d=n(o)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=a.length-1;n>=0;n--)this._addSource(a[n]);this._computeReplacement()}},t.eQ=Sy,t.eR=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,n){const o=new pa,d=new $o,g=[],w=a+1+2,S=n[0]+1,A=n[0]+1+(1+n.length),L=(N,q,Z)=>{let Q=N===w-1?N-2:N===0?N:N-1;return Q+=Z?24575:0,[Q,q]};for(let N=0;N<w;++N)o.emplaceBack(...L(N,0,!0));for(let N=0;N<S;++N)for(let q=0;q<w;++q)o.emplaceBack(...L(q,N,(q===0||q===w-1)&&!0));for(let N=0;N<n.length;++N){const q=n[N];for(let Z=0;Z<w;++Z)o.emplaceBack(...L(Z,q,!0))}for(let N=0;N<n.length;++N){const q=d.length,Z=n[N]+1+2,Q=new $o;for(let me=0;me<Z-1;me++){const Se=me===Z-2,Te=Se?w*(A-n.length+N-me):w;for(let Le=0;Le<w-1;Le++){const Re=me*w+Le;me===0||Se||Le===0||Le===w-2?(Q.emplaceBack(Re+1,Re,Re+Te),Q.emplaceBack(Re+Te,Re+Te+1,Re+1)):(d.emplaceBack(Re+1,Re,Re+Te),d.emplaceBack(Re+Te,Re+Te+1,Re+1))}}const ne=bo.simpleSegment(0,q,o.length,d.length-q);for(let me=0;me<Q.uint16.length;me+=3)d.emplaceBack(Q.uint16[me],Q.uint16[me+1],Q.uint16[me+2]);const oe=bo.simpleSegment(0,q,o.length,d.length-q);g.push({withoutSkirts:ne,withSkirts:oe})}return{vertices:o,indices:d,segments:g}}_createGrid(a){const n=this._fillGridMeshWithLods(cg,_y);this._gridSegments=n.segments,this._gridBuffer=a.createVertexBuffer(n.vertices,ug.members),this._gridIndexBuffer=a.createIndexBuffer(n.indices,!0)}_createPoles(a){const n=new $o;for(let S=0;S<=cg;S++)n.emplaceBack(0,S+1,S+2);this._poleIndexBuffer=a.createIndexBuffer(n,!0);const o=new Pc,d=new Pc,g=new Pc,w=new Pc;this._poleSegments=[];for(let S=0,A=0;S<_h;S++){const L=360/(1<<S);o.emplaceBack(0,-Ql,0,.5,0),d.emplaceBack(0,-Ql,0,.5,1),g.emplaceBack(0,-Ql,0,.5,.5),w.emplaceBack(0,-Ql,0,.5,.5);for(let N=0;N<=cg;N++){let q=N/cg,Z=0;const Q=Gn(0,L,q),[ne,oe,me]=ra(Lb,gI,Q,Ql);o.emplaceBack(ne,oe,me,q,Z),d.emplaceBack(ne,oe,me,q,1-Z);const Se=ns(Q);q=.5+.5*Math.sin(Se),Z=.5+.5*Math.cos(Se),g.emplaceBack(ne,oe,me,q,Z),w.emplaceBack(ne,oe,me,q,1-Z)}this._poleSegments.push(bo.simpleSegment(A,0,66,64)),A+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(o,Xh,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,Xh,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(g,Xh,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(w,Xh,!1)}getGridBuffers(a,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},t.eS=Zb,t.eT=gl,t.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.eV=Nt,t.eW=ke,t.eX=function(a,n,o){return a[0]=n[0]/o[0],a[1]=n[1]/o[1],a[2]=n[2]/o[2],a},t.eY=Ot,t.eZ=Zh,t.e_=ti,t.ea=Yv,t.eb=N2,t.ec=sm,t.ed=Jb,t.ee=Hv,t.ef=_e,t.eg=function(a,n){if(a===n){var o=n[1],d=n[2],g=n[3],w=n[6],S=n[7],A=n[11];a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=o,a[6]=n[9],a[7]=n[13],a[8]=d,a[9]=w,a[11]=n[14],a[12]=g,a[13]=S,a[14]=A}else a[0]=n[0],a[1]=n[4],a[2]=n[8],a[3]=n[12],a[4]=n[1],a[5]=n[5],a[6]=n[9],a[7]=n[13],a[8]=n[2],a[9]=n[6],a[10]=n[10],a[11]=n[14],a[12]=n[3],a[13]=n[7],a[14]=n[11],a[15]=n[15];return a},t.eh=C8,t.ei=hr,t.ej=g0,t.ek=256,t.el=Pb,t.em=bl,t.en=Ze,t.eo=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[4],a[4]=n[5],a[5]=n[6],a[6]=n[8],a[7]=n[9],a[8]=n[10],a},t.ep=Pc,t.eq=ap,t.er=ph,t.es=function(a,n,o,d,g){return we((a-n)/(o-n)*(g-d)+d,d,g)},t.et=Ge,t.eu=function(a,n){var o=n[0],d=n[1],g=n[2],w=n[3],S=n[4],A=n[5],L=n[6],N=n[7],q=n[8],Z=q*S-A*N,Q=-q*w+A*L,ne=N*w-S*L,oe=o*Z+d*Q+g*ne;return oe?(a[0]=Z*(oe=1/oe),a[1]=(-q*d+g*N)*oe,a[2]=(A*d-g*S)*oe,a[3]=Q*oe,a[4]=(q*o-g*L)*oe,a[5]=(-A*o+g*w)*oe,a[6]=ne*oe,a[7]=(-N*o+d*L)*oe,a[8]=(S*o-d*w)*oe,a):null},t.ev=2,t.ew=sn,t.ex=Ii,t.ey=ct,t.ez=function(a,n){var o=new O(3);ct(o,n);var d=1/o[0],g=1/o[1],w=1/o[2],S=n[0]*d,A=n[1]*g,L=n[2]*w,N=n[4]*d,q=n[5]*g,Z=n[6]*w,Q=n[8]*d,ne=n[9]*g,oe=n[10]*w,me=S+q+oe,Se=0;return me>0?(Se=2*Math.sqrt(me+1),a[3]=.25*Se,a[0]=(Z-ne)/Se,a[1]=(Q-L)/Se,a[2]=(A-N)/Se):S>q&&S>oe?(Se=2*Math.sqrt(1+S-q-oe),a[3]=(Z-ne)/Se,a[0]=.25*Se,a[1]=(A+N)/Se,a[2]=(Q+L)/Se):q>oe?(Se=2*Math.sqrt(1+q-S-oe),a[3]=(Q-L)/Se,a[0]=(A+N)/Se,a[1]=.25*Se,a[2]=(Z+ne)/Se):(Se=2*Math.sqrt(1+oe-S-q),a[3]=(A-N)/Se,a[0]=(Q+L)/Se,a[1]=(Z+ne)/Se,a[2]=.25*Se),a},t.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,((n,o)=>String.fromCharCode(+("0x"+o)))))},t.f0=function([a,n,o]){const d=Math.hypot(a,n,o),g=Math.atan2(a,o),w=.5*Math.PI-Math.acos(-n/d);return new h(Ja(g),Ja(w))},t.f1=Hi,t.f2=re,t.f3=function(a){const n=a.navigator?a.navigator.userAgent:null;return!!(function(o){if(No==null){const d=o.navigator?o.navigator.userAgent:null;No=!!o.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return No})(a)&&!(!n||!(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},t.f4=function(a,n){Op=a,Dh=n},t.f5=_p,t.f6=gp,t.f7=function(a){const n=[0,0,0],o=ie(new Float64Array(16));return ye(o,a.pixelMatrix,a.globeMatrix),St(n,n,o),new yi(n[0],n[1])},t.f8=function(){const a=My;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(o1),My=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.f9=function(){N0().acquire(o1)},t.fA=kT,t.fB=It,t.fC=function(a){let n=0;if(new Uint32Array(a,0,1)[0]!==c1){const o=new Uint32Array(a,0,7),[,,d,g,w,S]=o;n=o.byteLength+g+w+S+w,(d!==a.byteLength||n>=a.byteLength)&&mn("Invalid b3dm header information.")}return h1(a,n)},t.fD=function(a,n){const o=dr(a);for(const d of o){for(const g of d.meshes)or(g);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(er(d.lights,n)))}return o},t.fE=ET,t.fF=Kr,t.fG=s1,t.fH=mu,t.fI=Vl,t.fJ=function(a){as(),bc?.then((n=>{n.keys().then((o=>{for(let d=0;d<o.length-a;d++)n.delete(o[d]).catch((g=>mn(g.message)))})).catch((o=>mn(o.message)))})).catch((n=>mn(n.message)))},t.fa=Nu,t.fb=function(a,n,o=!1){if(Pl===Vl.deferred||Pl===Vl.loading||Pl===Vl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ac=Ta.resolveURL(a),Pl=Vl.deferred,If=n,hp(),o||Jm()},t.fc=function(a){v_=Ta.resolveURL(a),am||(am=new y_(N0(),new Au)),am.broadcast("setMeshoptUrl",v_)},t.fd=x_,t.fe=function(a){Qv=Ta.resolveURL(a),am||(am=new y_(N0(),new Au)),am.broadcast("setDracoUrl",Qv)},t.ff=Y2,t.fg=B0,t.fh=function(a){const n=Wl();if(!n)return;const o=n.delete(Xd);a&&o.then((()=>a())).catch(a)},t.fi=wh,t.fj=Cn,t.fk=dg,t.fl=hm,t.fm=oL,t.fn=aL,t.fo=S_,t.fp=oi,t.fq="hd_road_elevation",t.fr=Ts,t.fs=Qt,t.ft=Ea,t.fu=zI,t.fv=G0,t.fw=function(a,n,o,d,g,w,S,A=1,L,N,q){a.createArrays(),a.tilePixelRatio=Ji/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const Z=a.layers[0].layout,Q=a.layers[0]._unevaluatedLayout._values,ne={};ne.scaleFactor=A,ne.textSizeScaleRange=Z.get("text-size-scale-range"),ne.iconSizeScaleRange=Z.get("icon-size-scale-range");const[oe,me]=ne.textSizeScaleRange,[Se,Te]=ne.iconSizeScaleRange;ne.textScaleFactor=we(ne.scaleFactor,oe,me),ne.iconScaleFactor=we(ne.scaleFactor,Se,Te);const Le=Q["text-size"],Re=Q["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:Et,maxZoom:ai}=a.textSizeData;ne.compositeTextSizes=[Le.possiblyEvaluate(new Us(Et,{worldview:q}),w),Le.possiblyEvaluate(new Us(ai,{worldview:q}),w)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Et,maxZoom:ai}=a.iconSizeData;ne.compositeIconSizes=[Re.possiblyEvaluate(new Us(Et,{worldview:q}),w),Re.possiblyEvaluate(new Us(ai,{worldview:q}),w)]}ne.layoutTextSize=Le.possiblyEvaluate(new Us(S+1,{worldview:q}),w),ne.layoutIconSize=Re.possiblyEvaluate(new Us(S+1,{worldview:q}),w),ne.textMaxSize=Le.possiblyEvaluate(new Us(18,{worldview:q}),w);const Ue=Z.get("symbol-placement"),rt=Z.get("text-rotation-alignment")==="map"&&Ue!=="point",Qe=Z.get("text-size");let ht=!1;const yt=[];for(const Et of a.features){const ai=Z.get("text-font").evaluate(Et,{},w).join(","),kt=Qe.evaluate(Et,{},w)*ne.textScaleFactor,fi=ne.layoutTextSize.evaluate(Et,{},w)*ne.textScaleFactor,Ti=ne.layoutIconSize.evaluate(Et,{},w)*ne.iconScaleFactor,Si={horizontal:{},vertical:void 0},Bi=Et.text;let ji,zi=[0,0];if(Bi){const Mr=Bi.toString(),Ys=Z.get("text-letter-spacing").evaluate(Et,{},w)*ca,et=Z.get("text-line-height").evaluate(Et,{},w)*ca,st=cp(Mr)?Ys:0,pi=Z.get("text-anchor").evaluate(Et,{},w),Ni=Z.get("text-variable-anchor");if(!Ni){const Ir=Z.get("text-radial-offset").evaluate(Et,{},w);if(Ir)zi=Gk(pi,[Ir*ca,BI]);else{const zr=Z.get("text-offset").evaluate(Et,{},w);zi=[zr[0]*ca,zr[1]*ca]}}let dn=rt?"center":Z.get("text-justify").evaluate(Et,{},w);const fn=Ue==="point",Un=fn?Z.get("text-max-width").evaluate(Et,{},w)*ca:1/0,Wn=Ir=>{a.allowVerticalPlacement&&Gh(Mr)&&(Si.vertical=MI(Bi,n,o,g,ai,Un,et,pi,Ir,st,zi,td.vertical,!0,fi,kt,L))};if(!rt&&Ni){const Ir=dn==="auto"?Ni.map((Vr=>NI(Vr))):[dn];let zr=!1;for(let Vr=0;Vr<Ir.length;Vr++){const rs=Ir[Vr];if(!Si.horizontal[rs])if(zr)Si.horizontal[rs]=Si.horizontal[0];else{const cr=MI(Bi,n,o,g,ai,Un,et,"center",rs,st,zi,td.horizontal,!1,fi,kt,L);cr&&(Si.horizontal[rs]=cr,zr=cr.positionedLines.length===1)}}Wn("left")}else{if(dn==="auto"&&(dn=NI(pi)),fn||Z.get("text-writing-mode").indexOf("horizontal")>=0||!Gh(Mr)){const Ir=MI(Bi,n,o,g,ai,Un,et,pi,dn,st,zi,td.horizontal,!1,fi,kt,L);Ir&&(Si.horizontal[dn]=Ir)}Wn(fn?"left":dn)}}let Oi,di,ui,Fi,tn,Xi,Vn=!1;const _n=Z.get("icon-text-fit").evaluate(Et,{},w);if(Et.icon&&Et.icon.hasPrimary()){const Mr=x1(Et.icon,a.iconSizeData,Q["icon-size"],w,a.zoom,Et,L,ne.iconScaleFactor,q);Oi=Mr.iconPrimary,ui=Mr.iconSecondary;const Ys=Oi.toString();if(di=d.get(Ys),di&&(tn=Z.get("icon-offset").evaluate(Et,{},w),Xi=Z.get("icon-anchor").evaluate(Et,{},w),ji=uT(g.get(Ys),ui?g.get(ui.toString()):void 0,tn,Xi),Vn=di.sdf,a.sdfIcons===void 0?a.sdfIcons=di.sdf:a.sdfIcons!==di.sdf&&mn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(di.pixelRatio!==a.pixelRatio||Z.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),ui){const et=ui.toString();Fi=d.get(et)}}ht=ht||!(!Et.icon||!Et.icon.hasSecondary());const In=mT(Si.horizontal)||Si.vertical;a.iconsInText||(a.iconsInText=!!In&&In.iconsInText);const Dn=fi*ne.textScaleFactor/ca,{defaultShapedIcon:jr,verticallyShapedIcon:Ki}=f8(a,ji,Z,Et,w,Si,Dn,tn,_n);_n!=="none"&&ji&&(Pk(ji)||Mk(ji))&&(pT(0,di,Oi,ji,jr,_n,N,d,g),pT(0,Fi,ui,ji,jr,_n,N,d,g),Ki&&(pT(0,di,Oi,ji,Ki,_n,N,d,g),pT(0,Fi,ui,ji,Ki,_n,N,d,g))),ji=jr;const{iconBBox:Rn,iconVerticalBBox:wr,textBBox:os,textVerticalBBox:ds}=l8(a,ji,Ki,Z,Et,w,Ti,tn,ne,g,Xi,Si,fi,zi);yt.push({feature:Et,shapedTextOrientations:Si,shapedText:In,shapedIcon:ji,iconPrimary:Oi,iconSecondary:ui,iconOffset:tn,iconAnchor:Xi,verticallyShapedIcon:Ki,layoutTextSize:fi,layoutIconSize:Ti,textOffset:zi,isSDFIcon:Vn,iconTextFit:_n,iconCollisionBounds:Rn,iconVerticalCollisionBounds:wr,textCollisionBounds:os,textVerticalCollisionBounds:ds})}return{featureData:yt,sizes:ne,hasAnySecondaryIcon:ht,textAlongLine:rt,symbolPlacement:Ue}},t.fx=Bk,t.fy=function(a,n,o,d,g,w,S,A,L,N){a.iconAtlasPositions=N.iconPositions;const{featureData:q,hasAnySecondaryIcon:Z,sizes:Q,textAlongLine:ne,symbolPlacement:oe}=n;for(const me of q){const{shapedIcon:Se,verticallyShapedIcon:Te,feature:Le,shapedTextOrientations:Re,shapedText:Ue,layoutTextSize:rt,textOffset:Qe,isSDFIcon:ht,iconPrimary:yt,iconSecondary:Et,iconTextFit:ai,iconOffset:kt,iconCollisionBounds:fi,iconVerticalCollisionBounds:Ti,textCollisionBounds:Si}=me;Hk(Se,N.iconPositions,yt,Et),Hk(Te,N.iconPositions,yt,Et),d8(Re,N.iconPositions),h8(yt,Et,N.iconPositions),(Ue||Se)&&p8(a,Le,Re,Se,Te,L,Q,rt,0,Qe,ht,d,g,S,A,Z,ai,kt,ne,oe,fi,Ti,Si)}o&&a.generateCollisionDebugBuffers(w,a.collisionBoxArray,Q.textScaleFactor)},t.fz=Kt,t.g=function(a,n){return el(Object.assign(a,{method:"GET"}),n)},t.h=function(a){return a.indexOf("mapbox:")===0},t.i=function(a){return qr.API_STYLE_REGEX.test(a)&&!Ra(a)},t.j=Po,t.k=Yu,t.l=function(a){return decodeURIComponent(atob(a).split("").map((n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2))).join(""))},t.m=function(a,n){return el(Object.assign(a,{type:"json"}),n)},t.n=Kd,t.o=Ta,t.p=function(a,n){return el(Object.assign(a,{method:"POST"}),n)},t.q=ic,t.r=su,t.s=function(a){try{const n=self[a];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},t.t=function(){return Jv||(Jv=new wh("ImageRasterizer")),Jv},t.u=function(){return(function a(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},t.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},t.w=mn,t.x=iC,t.y=ms,t.z=Cs})),_(["./shared"],(function(t){function P(Nt){const we=Nt?Nt.url.toString():void 0;return we?performance.getEntriesByName(we):[]}function O(Nt){if(typeof Nt=="number"||typeof Nt=="boolean"||typeof Nt=="string"||Nt==null)return JSON.stringify(Nt);if(Array.isArray(Nt)){let Ie="[";for(const qe of Nt)Ie+=`${O(qe)},`;return`${Ie}]`}let we="{";for(const Ie of Object.keys(Nt).sort())we+=`${Ie}:${O(Nt[Ie])},`;return`${we}}`}function F(Nt){let we="";for(const Ie of t.bx)we+=`/${O(Nt[Ie])}`;return we}class ${constructor(we){this.keyCache={},this._layers={},this._layerConfigs={},we&&this.replace(we)}replace(we,Ie){this._layerConfigs={},this._layers={},this.update(we,[],Ie)}update(we,Ie,qe){this._options=qe;for(const ft of we)this._layerConfigs[ft.id]=ft,(this._layers[ft.id]=t.du(ft,this.scope,null,this._options)).compileFilter(qe),this.keyCache[ft.id]&&delete this.keyCache[ft.id];for(const ft of Ie)delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft];this.familiesBySource={};const ot=(function(ft,Ct){const Jt={};for(let Qt=0;Qt<ft.length;Qt++){const Ri=ft[Qt];let xi=Ct&&Ct[Ri.id];xi||(Ri.type==="symbol"?xi=Ri.id:(xi=F(Ri),Ri.type==="line"&&Ri.paint&&(function $n(mn){return typeof mn=="string"&&mn==="line-progress"||(Array.isArray(mn)?mn.some($n):!(!mn||typeof mn!="object")&&Object.values(mn).some($n))})(Ri.paint["line-width"])&&(xi+=`/${O(Ri.paint["line-width"])}`))),Ct&&(Ct[Ri.id]=xi);let yn=Jt[xi];yn||(yn=Jt[xi]=[]),yn.push(Ri)}const _t=[];for(const Qt in Jt)_t.push(Jt[Qt]);return _t})(Object.values(this._layerConfigs),this.keyCache);for(const ft of ot){const Ct=ft.map((yn=>this._layers[yn.id])),Jt=Ct[0];if(Jt.visibility==="none")continue;const _t=Jt.source||"";let Qt=this.familiesBySource[_t];Qt||(Qt=this.familiesBySource[_t]={});const Ri=Jt.sourceLayer||"_geojsonTileLayer";let xi=Qt[Ri];xi||(xi=Qt[Ri]=[]),xi.push(Ct)}}}const W=1*t.fl;class Y{constructor(we){const Ie={},qe=[];for(const Jt in we){const _t=we[Jt],Qt=Ie[Jt]={};for(const Ri in _t.glyphs){const xi=_t.glyphs[+Ri];if(!xi||xi.bitmap.width===0||xi.bitmap.height===0)continue;const yn=xi.metrics.localGlyph?W:1,$n={x:0,y:0,w:xi.bitmap.width+2*yn,h:xi.bitmap.height+2*yn};qe.push($n),Qt[Ri]=$n}}const{w:ot,h:ft}=t.G(qe),Ct=new t.fk({width:ot||1,height:ft||1});for(const Jt in we){const _t=we[Jt];for(const Qt in _t.glyphs){const Ri=_t.glyphs[+Qt];if(!Ri||Ri.bitmap.width===0||Ri.bitmap.height===0)continue;const xi=Ie[Jt][Qt],yn=Ri.metrics.localGlyph?W:1;t.fk.copy(Ri.bitmap,Ct,{x:0,y:0},{x:xi.x+yn,y:xi.y+yn},Ri.bitmap)}}this.image=Ct,this.positions=Ie}}function ae(Nt,we,Ie){Nt[we]?Ie&&(Nt[we].center=Ie):Nt[we]={floorIds:new Set,center:Ie||[0,0],floors:{}}}function se(Nt,we,Ie,qe){for(const ot of we)ae(Nt,ot),Nt[ot].floors[Ie]=qe,Nt[ot].floorIds.add(Ie)}function ie(Nt){return{id:Nt.properties.id.toString(),center:Nt.properties.center.toString().split(";").map(Number)}}function pe(Nt){return{id:Nt.properties.id.toString(),isDefault:!!Nt.properties.is_default&&Nt.properties.is_default,connections:Nt.properties.connected_floor_ids?new Set(Nt.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Nt.properties.conflicted_floor_ids?new Set(Nt.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Nt.properties.building_ids?new Set(Nt.properties.building_ids.toString().split(";")):new Set,name:Nt.properties.name.toString(),zIndex:Nt.properties.z_index}}function ye(Nt,we){return we.every((Ie=>Nt.properties&&Nt.properties[Ie]!=null))}function de(Nt){return ye(Nt,["type","id","name"])&&Nt.properties.type==="building"}function Ee(Nt){return ye(Nt,["type","id","name","z_index"])&&Nt.properties.type==="floor"}t.fj(Y,"GlyphAtlas");class Pe{constructor(we){this.tileID=new t.aQ(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.lut=we.lut,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.scope=we.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.request&&we.request.collectResourceTiming,this.promoteId=we.promoteId,this.isSymbolTile=we.isSymbolTile,this.tileTransform=t.aZ(we.tileID.canonical,we.projection),this.projection=we.projection,this.worldview=we.worldview,this.localizableLayerIds=we.localizableLayerIds,this.brightness=we.brightness,this.extraShadowCaster=!!we.extraShadowCaster,this.tessellationStep=we.tessellationStep,this.scaleFactor=we.scaleFactor,this.worldview=we.worldview,this.indoor=we.indoor}parse(we,Ie,qe,ot,ft,Ct){this.status="parsing",this.data=we,this.collisionBoxArray=new t.b3;const Jt=new t.fm(Object.keys(we.layers).sort()),_t=new t.fn(this.tileID,this.promoteId);_t.bucketLayerIDs=[];const Qt={},Ri=new t.fo(256,256),xi={featureIndex:_t,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ri,availableImages:qe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Tr=this.indoor.indoorState.activeFloorsVisible,rr=(function(jn,Kr,io){const No=(function(go,Wr){if(!go)return t.w("No source layers defined in indoor specification"),Wr;if(go.size===0)return Wr;const ao=go.difference(Wr);for(const Br of ao)t.w(`Missing source layer required in indoor specification: ${Br}`);return Wr.intersection(Wr)})(Kr.sourceLayers,new Set(Object.keys(jn.layers))),oo=Kr.indoorState,po=(function(go,Wr,ao,Br){const qr=new Set,Po=new Set,Ra=new Set,_l=new Map,Hl={},dd=wa=>{const hc=_l.get(wa)||new Set;for(const yl of qr)if((_l.get(yl)||new Set).has(wa)||hc.has(yl))return!0;return!1};for(const wa of Wr){const hc=go.layers[wa];if(hc)for(let yl=0;yl<hc.length;yl++){const su=hc.feature(yl);if(de(su)){const{id:Ta,center:Zd}=ie(su);ae(Hl,Ta,Zd),qr.add(Ta)}else if(Ee(su)){const{id:Ta,isDefault:Zd,connections:Xu,conflicts:Xd,buildings:Op,name:Dh,zIndex:Yd}=pe(su);se(Hl,Op,Ta,{name:Dh,zIndex:Yd}),_l.set(Ta,Xd),(Ta===Br||Xu.has(Br))&&qr.add(Ta),Po.add(Ta),Zd&&Ra.add(Ta)}}else t.w(`indoor source layer not found: ${wa}`)}if(ao)for(const wa of ao)Po.has(wa)&&(dd(wa)||qr.add(wa));for(const wa of Ra)qr.has(wa)||dd(wa)||qr.add(wa);return{buildings:Hl,activeFloors:qr}})(jn,No,oo.lastActiveFloors,oo.selectedFloorId);return io.send("setIndoorData",po),po})(we,this.indoor,ft);xi.activeFloors=Tr?rr.activeFloors:void 0}const yn=[],$n=Ie.familiesBySource[this.source];for(const Tr in $n){const rr=we.layers[Tr];if(!rr)continue;let jn=!1,Kr=!1,io=!1;for(const Wr of $n[Tr])Wr[0].type==="symbol"?jn=!0:Kr=!0,Wr[0].is3D()&&Wr[0].type!=="model"&&(io=!0);if(this.extraShadowCaster&&!io||this.isSymbolTile===!0&&!jn||this.isSymbolTile===!1&&!Kr)continue;rr.version===1&&t.w(`Vector tile source "${this.source}" layer "${Tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const No=Jt.encode(Tr),oo=[],po=this.localizableLayerIds&&this.localizableLayerIds.has(Tr);let go=!1;for(let Wr=0,ao=0;Wr<rr.length;Wr++){const Br=rr.feature(Wr),qr=_t.getId(Br,Tr),Po=Br.properties?Br.properties.worldview:null;if(po&&this.worldview&&typeof Po=="string")if(Po==="all")Br.properties.$localized=!0;else{if(!Po.split(",").includes(this.worldview))continue;Br.properties.$localized=!0,Br.properties.worldview=this.worldview}!go&&Br.properties&&Br.properties.hasOwnProperty(t.fp)&&(go=!0),oo.push({feature:Br,id:qr,index:ao,sourceLayerIndex:No}),ao++}go&&!xi.elevationFeatures&&we.layers.hasOwnProperty(t.fq)&&(xi.elevationFeatures=t.fr.parseFrom(we.layers[t.fq],this.canonical));for(const Wr of $n[Tr]){const ao=Wr[0];if(this.extraShadowCaster&&(!ao.is3D()||ao.type==="model")||this.isSymbolTile!==void 0&&ao.type==="symbol"!==this.isSymbolTile||ao.minzoom&&this.zoom<Math.floor(ao.minzoom)||ao.maxzoom&&this.zoom>=ao.maxzoom||ao.visibility==="none")continue;Ze(Wr,this.zoom,xi.brightness,qe,this.worldview);const Br=Qt[ao.id]=ao.createBucket({index:_t.bucketLayerIDs.length,layers:Wr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:No,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ot,worldview:this.worldview,localizable:po});_t.bucketLayerIDs.push(Wr.map((Po=>t.B(Po.id,Po.scope))));let qr=Br.prepare?Br.prepare():null;qr!=null?(qr=qr.then((()=>Br.populate(oo,xi,this.tileID.canonical,this.tileTransform))),yn.push(qr)):Br.populate(oo,xi,this.tileID.canonical,this.tileTransform)}}const mn=()=>{let Tr,rr,jn,Kr,io,No;Ri.trim();const oo={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},po=()=>{if(Tr)return this.status="done",Ct(Tr);if(this.extraShadowCaster)this.status="done",Ct(null,{buckets:Object.values(Qt).filter((Wr=>!Wr.isEmpty())),featureIndex:_t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:xi.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rr&&jn&&Kr){const Wr=new Y(rr),ao=new Map;for(const[Po,Ra]of jn.entries()){const{imagePosition:_l}=t.fu(Po,Ra,t.fv);ao.set(Po,_l)}const Br={};for(const Po in Qt){const Ra=Qt[Po];Ra instanceof t.b4&&(Ze(Ra.layers,this.zoom,xi.brightness,qe,this.worldview),Br[Po]=t.fw(Ra,rr,Wr.positions,jn,ao,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,io,this.worldview))}const qr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ft,jn,io,(()=>{qr.iconsPending=!1,go(Br,Wr,qr)})),this.rasterizeIfNeeded(ft,Kr,No,(()=>{qr.patternsPending=!1,go(Br,Wr,qr)}))}},go=(Wr,ao,Br,qr)=>{if(Br.iconsPending||Br.patternsPending)return;const Po=new t.fx(jn,Kr,this.lut);for(const Ra in Qt){const _l=Qt[Ra];if(Ra in Wr)t.fy(_l,Wr[Ra],this.showCollisionBoxes,qe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,jn,Po);else if(_l.hasPattern&&(_l instanceof t.ba||_l instanceof t.bb||_l instanceof t.ea)){Ze(_l.layers,this.zoom,xi.brightness,qe,this.worldview);const Hl=Object.fromEntries(Po.patternPositions);_l.addFeatures(xi,this.tileID.canonical,Hl,qe,this.tileTransform,this.brightness)}}this.status="done",Ct(null,{buckets:Object.values(Qt).filter((Ra=>!Ra.isEmpty())),featureIndex:_t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ao.image,lineAtlas:Ri,imageAtlas:Po,brightness:xi.brightness})};if(!this.extraShadowCaster){const Wr=t.fs(xi.glyphDependencies,(qr=>Object.keys(qr).map(Number)));Object.keys(Wr).length?ft.send("getGlyphs",{uid:this.uid,stacks:Wr},((qr,Po)=>{Tr||(Tr=qr,rr=Po,po())}),void 0,!1,oo):rr={};const ao=Array.from(xi.iconDependencies.keys()).map((qr=>t.I.parse(qr)));ao.length?ft.send("getImages",{images:ao,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((qr,Po)=>{Tr||(Tr=qr,jn=new Map,io=this.updateImageMapAndGetImageTaskQueue(jn,Po,xi.iconDependencies),po())}),void 0,!1,oo):(jn=new Map,io=new Map);const Br=Array.from(xi.patternDependencies.keys()).map((qr=>t.I.parse(qr)));Br.length?ft.send("getImages",{images:Br,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((qr,Po)=>{Tr||(Tr=qr,Kr=new Map,No=this.updateImageMapAndGetImageTaskQueue(Kr,Po,xi.patternDependencies),po())}),void 0,!1,oo):(Kr=new Map,No=new Map)}if(xi.elevationFeatures&&xi.elevationFeatures.length>0){const Wr=[];for(const Br of Object.values(Qt))if(Br instanceof t.bb){const qr=Br.getUnevaluatedPortalGraph();qr&&Wr.push(qr)}const ao=t.ft.evaluate(Wr);for(const Br of Object.values(Qt))if(Br instanceof t.bb){const qr=we.layers[Jt.decode(Br.sourceLayerIndex)];Br.setEvaluatedPortalGraph(ao,qr,this.tileID.canonical,xi.availableImages,xi.brightness)}}po()};yn.length>0?Promise.allSettled(yn).then(mn).catch(Ct):mn()}updateParameters(we){this.scaleFactor=we.scaleFactor,this.showCollisionBoxes=we.showCollisionBoxes,this.projection=we.projection,this.brightness=we.brightness,this.tileTransform=t.aZ(we.tileID.canonical,we.projection),this.extraShadowCaster=we.extraShadowCaster,this.lut=we.lut,this.worldview=we.worldview,this.indoor=we.indoor}rasterizeIfNeeded(we,Ie,qe,ot){Array.from(Ie.values()).some((ft=>ft.usvg))?this.rasterize(we,Ie,qe,ot):ot()}updateImageMapAndGetImageTaskQueue(we,Ie,qe){const ot=new Map;for(const ft of Ie.keys()){const Ct=qe.get(ft)||[];for(const Jt of Ct){const _t=Jt.toString(),Qt=Ie.get(Jt.id.toString());Qt.usvg?ot.has(_t)||(ot.set(_t,Jt),we.set(_t,Object.assign({},Qt))):we.set(_t,Qt)}}return ot}rasterize(we,Ie,qe,ot){this.rasterizeTask=we.send("rasterizeImages",{scope:this.scope,tasks:qe},((ft,Ct)=>{if(!ft)for(const[Jt,_t]of Ct.entries()){const Qt=Object.assign(Ie.get(Jt),{data:_t});Ie.set(Jt,Qt)}ot()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Ze(Nt,we,Ie,qe,ot){const ft=new t.ac(we,{brightness:Ie,worldview:ot});for(const Ct of Nt)Ct.recalculate(ft,qe)}class We extends t.E{constructor(we,Ie,qe,ot,ft,Ct,Jt){super(),this.actor=we,this.layerIndex=Ie,this.availableImages=qe,this.availableModels=ot,this.loadVectorData=Ct||t.aL,this.loading={},this.loaded={},this.deduped=new t.aK(we.scheduler),this.isSpriteLoaded=ft,this.scheduler=we.scheduler,this.brightness=Jt}loadTile(we,Ie){const qe=we.uid,ot=we&&we.request,ft=ot&&ot.collectResourceTiming,Ct=this.loading[qe]=new Pe(we);Ct.abort=this.loadVectorData(we,((Jt,_t)=>{const Qt=!this.loading[qe];if(delete this.loading[qe],Ct.cancelRasterize(),Qt||Jt||!_t)return Ct.status="done",Qt||(this.loaded[qe]=Ct),Ie(Jt);const Ri=_t.rawData,xi={},yn=t.aM(_t.responseHeaders);yn&&yn.expires&&(xi.expires=yn.expires),yn&&yn.cacheControl&&(xi.cacheControl=yn.cacheControl),Ct.vectorTile=_t.vectorTile||new t.fz(new t.bt(Ri));const $n=()=>{Ct.parse(Ct.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((mn,Tr)=>{if(mn||!Tr)return Ie(mn);const rr={};if(ft){const jn=P(ot);jn.length>0&&(rr.resourceTiming=JSON.parse(JSON.stringify(jn)))}Ie(null,Object.assign({rawTileData:Ri.slice(0),responseHeaders:_t.responseHeaders},Tr,xi,rr))}))};this.isSpriteLoaded?$n():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add($n,{type:"parseTile",isSymbolTile:we.isSymbolTile,zoom:we.tileZoom}):$n()})),this.loaded=this.loaded||{},this.loaded[qe]=Ct}))}reloadTile(we,Ie){const qe=this.loaded,ot=we.uid;if(qe&&qe[ot]){const ft=qe[ot];ft.updateParameters(we);const Ct=(Jt,_t)=>{const Qt=ft.reloadCallback;Qt&&(delete ft.reloadCallback,ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qt)),Ie(Jt,_t)};ft.status==="parsing"?ft.reloadCallback=Ct:ft.status==="done"&&(ft.vectorTile?ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ct):Ct())}else Ie(null,void 0)}abortTile(we,Ie){const qe=we.uid,ot=this.loading[qe];ot&&(ot.abort&&ot.abort(),delete this.loading[qe]),Ie()}removeTile(we,Ie){const qe=this.loaded,ot=we.uid;qe&&qe[ot]&&delete qe[ot],Ie()}}class je{loadTile(we,Ie){const{uid:qe,encoding:ot,rawImageData:ft,padding:Ct}=we,Jt=ImageBitmap&&ft instanceof ImageBitmap?this.getImageData(ft,Ct):ft;Ie(null,new t.fA(qe,Jt,ot,Ct<1))}reloadTile(we,Ie){Ie(null,null)}abortTile(we,Ie){Ie()}removeTile(we,Ie){Ie()}getImageData(we,Ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(we.width,we.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=we.width,this.offscreenCanvas.height=we.height,this.offscreenCanvasContext.drawImage(we,0,0,we.width,we.height);const qe=this.offscreenCanvasContext.getImageData(-Ie,-Ie,we.width+2*Ie,we.height+2*Ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),qe}}t.bs.setPbf(t.bt);class Ye{constructor(we){this._mrt=new t.bs(we.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=we.uid,this.tileID=we.tileID,this.source=we.source}parse(we,Ie){const qe=this._mrt;this.status="parsing",this._entireBuffer=we;try{qe.parseHeader(we),this._isHeaderLoaded=!0;const ot=[];for(const ft in qe.layers){const Ct=qe.getLayer(ft),Jt=Ct.getDataRange(Ct.getBandList()),_t=qe.createDecodingTask(Jt),Qt=we.slice(Jt.firstByte,Jt.lastByte+1),Ri=t.bs.performDecoding(Qt,_t).then((xi=>_t.complete(null,xi))).catch((xi=>_t.complete(xi,null)));ot.push(Ri)}Promise.allSettled(ot).then((()=>Ie(null,qe))).catch((ft=>Ie(ft)))}catch(ot){Ie(ot)}}}class ct{constructor(we){this.actor=we,this.loading={},this.loaded={}}loadTile(we,Ie){const qe=we.uid,ot=we.request,ft=this.loading[qe]=new Ye(we),{cancel:Ct}=t.bu(ot,((Jt,_t,Qt)=>{const Ri=!this.loading[qe];if(delete this.loading[qe],Ri||Jt||!_t)return ft.status="done",Ri||(this.loaded[qe]=ft),Ie(Jt);ft.parse(_t,((xi,yn)=>{if(xi||!yn)return Ie(xi);Ie(null,yn,Qt)})),this.loaded[qe]=ft}));ft.abort=Ct}reloadTile(we,Ie){Ie(null,void 0)}abortTile(we,Ie){const qe=we.uid,ot=this.loading[qe];ot&&(ot.abort&&ot.abort(),delete this.loading[qe]),Ie()}removeTile(we,Ie){const qe=we.uid;this.loaded[qe]&&delete this.loaded[qe],Ie()}decodeRasterArray(we,Ie){t.bs.performDecoding(we.buffer,we.task).then((qe=>Ie(null,qe))).catch((qe=>Ie(qe)))}}const Lt=t.fB.prototype.toGeoJSON;class Ht{constructor(we){this._feature=we,this.extent=t.al,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Ie of this._feature.geometry)we.push([new t.P(Ie[0],Ie[1])]);return we}{const we=[];for(const Ie of this._feature.geometry){const qe=[];for(const ot of Ie)qe.push(new t.P(ot[0],ot[1]));we.push(qe)}return we}}toGeoJSON(we,Ie,qe){return Lt.call(this,we,Ie,qe)}}class ci{constructor(we,Ie){this.name=we,this.extent=t.al,this.length=Ie.length,this._jsonFeatures=Ie}feature(we){return new Ht(this._jsonFeatures[we])}}class Wt{constructor(we){this.layers={},this.extent=t.al;for(const Ie of Object.keys(we))this.layers[Ie]=new ci(Ie,we[Ie])}}const $t=64/4096,Dt=128;class Ft{constructor(){this.features=new Map}clear(){this.features.clear()}load(we=[],Ie){for(const qe of we){const ot=qe.id;if(ot==null)continue;let ft=this.features.get(ot);ft&&this.updateCache(ft,Ie),qe.geometry?(ft=wi(qe),this.updateCache(ft,Ie),this.features.set(ot,ft)):this.features.delete(ot),this.updateCache(ft,Ie)}}updateCache(we,Ie){for(const{canonical:qe,uid:ot}of Object.values(Ie)){const{z:ft,x:Ct,y:Jt}=qe;vt(we,Math.pow(2,ft),Ct,Jt)&&delete Ie[ot]}}getTile(we,Ie,qe){const ot=Math.pow(2,we),ft=[];for(const Ct of this.features.values())vt(Ct,ot,Ie,qe)&&ft.push(Fn(Ct,ot,Ie,qe));return{features:ft}}getFeatures(){return[...this.features.values()]}}function vt({minX:Nt,minY:we,maxX:Ie,maxY:qe},ot,ft,Ct){return Nt<(ft+1+$t)/ot&&we<(Ct+1+$t)/ot&&Ie>(ft-$t)/ot&&qe>(Ct-$t)/ot}function wi(Nt){const{id:we,geometry:Ie,properties:qe}=Nt;if(!Ie)return;if(Ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ot,coordinates:ft}=Ie,Ct={id:we,type:1,geometry:[],tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Jt=Ct.geometry;if(ot==="Point")Qi(ft,Jt,Ct);else if(ot==="MultiPoint")for(const _t of ft)Qi(_t,Jt,Ct);else if(ot==="LineString")Ct.type=2,wn(ft,Jt,Ct);else if(ot==="MultiLineString")Ct.type=2,qn(ft,Jt,Ct);else if(ot==="Polygon")Ct.type=3,qn(ft,Jt,Ct,!0);else{if(ot!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ct.type=3;for(const _t of ft)qn(_t,Jt,Ct,!0)}return Ct}function Qi([Nt,we],Ie,qe){const ot=t.aF(Nt);let ft=t.aJ(we);ft=ft<0?0:ft>1?1:ft,Ie.push(ot,ft),qe.minX=Math.min(qe.minX,ot),qe.minY=Math.min(qe.minY,ft),qe.maxX=Math.max(qe.maxX,ot),qe.maxY=Math.max(qe.maxY,ft)}function wn(Nt,we,Ie,qe=!1,ot=!1){const ft=[];for(const Ct of Nt)Qi(Ct,ft,Ie);we.push(ft),qe&&(function(Ct,Jt){let _t=0;for(let Qt=0,Ri=Ct.length,xi=Ri-2;Qt<Ri;xi=Qt,Qt+=2)_t+=(Ct[Qt]-Ct[xi])*(Ct[Qt+1]+Ct[xi+1]);if(_t>0===Jt)for(let Qt=0,Ri=Ct.length;Qt<Ri/2;Qt+=2){const xi=Ct[Qt],yn=Ct[Qt+1];Ct[Qt]=Ct[Ri-2-Qt],Ct[Qt+1]=Ct[Ri-1-Qt],Ct[Ri-2-Qt]=xi,Ct[Ri-1-Qt]=yn}})(ft,ot)}function qn(Nt,we,Ie,qe=!1){for(let ot=0;ot<Nt.length;ot++)wn(Nt[ot],we,Ie,qe,ot===0)}function Fn(Nt,we,Ie,qe){const{id:ot,type:ft,geometry:Ct,tags:Jt}=Nt,_t=[];if(ft===1)(function(Qt,Ri,xi,yn,$n){for(let mn=0;mn<Qt.length;mn+=2){const Tr=Math.round(t.al*(Qt[mn+0]*Ri-xi)),rr=Math.round(t.al*(Qt[mn+1]*Ri-yn));$n.push([Tr,rr])}})(Ct,we,Ie,qe,_t);else if(ft===2)for(const Qt of Ct)mr(Qt,we,Ie,qe,_t);else if(ft===3)for(const Qt of Ct)Sr(Qt,we,Ie,qe,_t);return{id:ot,type:ft,geometry:_t,tags:Jt}}function mr(Nt,we,Ie,qe,ot){const ft=-Dt,Ct=t.al+Dt;let Jt;for(let _t=0;_t<Nt.length-2;_t+=2){let Qt=Math.round(t.al*(Nt[_t+0]*we-Ie)),Ri=Math.round(t.al*(Nt[_t+1]*we-qe)),xi=Math.round(t.al*(Nt[_t+2]*we-Ie)),yn=Math.round(t.al*(Nt[_t+3]*we-qe));const $n=xi-Qt,mn=yn-Ri;Qt<ft&&xi<ft||(Qt<ft?(Ri+=Math.round(mn*((ft-Qt)/$n)),Qt=ft):xi<ft&&(yn=Ri+Math.round(mn*((ft-Qt)/$n)),xi=ft),Ri<ft&&yn<ft||(Ri<ft?(Qt+=Math.round($n*((ft-Ri)/mn)),Ri=ft):yn<ft&&(xi=Qt+Math.round($n*((ft-Ri)/mn)),yn=ft),Qt>=Ct&&xi>=Ct||(Qt>=Ct?(Ri+=Math.round(mn*((Ct-Qt)/$n)),Qt=Ct):xi>=Ct&&(yn=Ri+Math.round(mn*((Ct-Qt)/$n)),xi=Ct),Ri>=Ct&&yn>=Ct||(Ri>=Ct?(Qt+=Math.round($n*((Ct-Ri)/mn)),Ri=Ct):yn>=Ct&&(xi=Qt+Math.round($n*((Ct-Ri)/mn)),yn=Ct),Jt&&Qt===Jt[Jt.length-1][0]&&Ri===Jt[Jt.length-1][1]||(Jt=[[Qt,Ri]],ot.push(Jt)),Jt.push([xi,yn])))))}}function Sr(Nt,we,Ie,qe,ot){const ft=(Ie-$t)/we,Ct=(qe-$t)/we,Jt=(Ie+1+$t)/we,_t=(qe+1+$t)/we;function Qt(yn,$n){let mn=0;return yn<ft?mn|=1:yn>Jt&&(mn|=2),$n<Ct?mn|=4:$n>_t&&(mn|=8),mn}let Ri=[];for(let yn=1;yn<=8;yn*=2){let $n=Nt[Nt.length-2],mn=Nt[Nt.length-1],Tr=!(Qt($n,mn)&yn);for(let rr=0;rr<Nt.length;rr+=2){const jn=Nt[rr],Kr=Nt[rr+1],io=!(Qt(jn,Kr)&yn);io!==Tr&&(8&yn?Ri.push($n+(jn-$n)*(_t-mn)/(Kr-mn),_t):4&yn?Ri.push($n+(jn-$n)*(Ct-mn)/(Kr-mn),Ct):2&yn?Ri.push(Jt,mn+(Kr-mn)*(Jt-$n)/(jn-$n)):1&yn&&Ri.push(ft,mn+(Kr-mn)*(ft-$n)/(jn-$n))),io&&Ri.push(jn,Kr),$n=jn,mn=Kr,Tr=io}if(!(Nt=Ri).length||yn===8)break;Ri=[]}const xi=[];for(let yn=0;yn<Ri.length;yn+=2)xi.push([Math.round(t.al*(Ri[yn]*we-Ie)),Math.round(t.al*(Ri[yn+1]*we-qe))]);ot.push(xi)}function Hr({name:Nt,features:we},Ie){Ie.writeStringField(1,Nt),Ie.writeVarintField(5,t.al);const qe=new Map,ot=new Map,ft={keys:qe,values:ot,feature:null};for(const Ct of we)ft.feature=Ct,Ie.writeMessage(2,ti,ft);for(const Ct of qe.keys())Ie.writeStringField(3,Ct);for(const Ct of ot.keys())Ie.writeMessage(4,Ur,Ct)}function ti(Nt,we){const Ie=Nt.feature;Ie.id!==void 0&&Number.isSafeInteger(+Ie.id)&&we.writeVarintField(1,+Ie.id),Ie.tags&&we.writeMessage(2,sn,Nt),we.writeVarintField(3,Ie.type),we.writeMessage(4,nr,Ie)}function sn({keys:Nt,values:we,feature:Ie},qe){for(const ot of Object.keys(Ie.tags)){let ft=Ie.tags[ot];if(ft===null)continue;let Ct=Nt.get(ot);Ct===void 0&&(Ct=Nt.size,Nt.set(ot,Ct)),qe.writeVarint(Ct);const Jt=typeof ft;Jt!=="string"&&Jt!=="boolean"&&Jt!=="number"&&(ft=JSON.stringify(ft));let _t=we.get(ft);_t===void 0&&(_t=we.size,we.set(ft,_t)),qe.writeVarint(_t)}}function Gi(Nt,we){return(we<<3)+(7&Nt)}function gn(Nt){return Nt<<1^Nt>>31}function nr(Nt,we){const{geometry:Ie,type:qe}=Nt;let ot=0,ft=0;if(qe===1){we.writeVarint(Gi(1,Ie.length));for(const Ct of Ie){const Jt=Ct[0]-ot,_t=Ct[1]-ft;we.writeVarint(gn(Jt)),we.writeVarint(gn(_t)),ot+=Jt,ft+=_t}}else for(const Ct of Ie){we.writeVarint(Gi(1,1));const Jt=Ct.length-(qe===3?1:0);for(let _t=0;_t<Jt;_t++){_t===1&&we.writeVarint(Gi(2,Jt-1));const Qt=Ct[_t][0]-ot,Ri=Ct[_t][1]-ft;we.writeVarint(gn(Qt)),we.writeVarint(gn(Ri)),ot+=Qt,ft+=Ri}qe===3&&we.writeVarint(Gi(7,1))}}function Ur(Nt,we){const Ie=typeof Nt;Ie==="string"?we.writeStringField(1,Nt):Ie==="boolean"?we.writeBooleanField(7,Nt):Ie==="number"&&(Nt%1!=0?we.writeDoubleField(3,Nt):Nt<0?we.writeSVarintField(6,Nt):we.writeVarintField(5,Nt))}const St={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Nt=>Nt},Gt=Math.fround||(Ai=new Float32Array(1),Nt=>(Ai[0]=+Nt,Ai[0]));var Ai;const hn=3,Ui=5,pt=6;class Ot{constructor(we){this.options=Object.assign(Object.create(St),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:Ie,minZoom:qe,maxZoom:ot}=this.options;Ie&&console.time("total time");const ft=`prepare ${we.length} points`;Ie&&console.time(ft),this.points=we;const Ct=[];for(let _t=0;_t<we.length;_t++){const Qt=we[_t];if(!Qt.geometry)continue;const[Ri,xi]=Qt.geometry.coordinates,yn=Gt(on(Ri)),$n=Gt(Hi(xi));Ct.push(yn,$n,1/0,_t,-1,1),this.options.reduce&&Ct.push(0)}let Jt=this.trees[ot+1]=this._createTree(Ct);Ie&&console.timeEnd(ft);for(let _t=ot;_t>=qe;_t--){const Qt=+Date.now();Jt=this.trees[_t]=this._createTree(this._cluster(Jt,_t)),Ie&&console.log("z%d: %d clusters in %dms",_t,Jt.numItems,+Date.now()-Qt)}return Ie&&console.timeEnd("total time"),this}getClusters(we,Ie){let qe=((we[0]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,we[1]));let ft=we[2]===180?180:((we[2]+180)%360+360)%360-180;const Ct=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)qe=-180,ft=180;else if(qe>ft){const xi=this.getClusters([qe,ot,180,Ct],Ie),yn=this.getClusters([-180,ot,ft,Ct],Ie);return xi.concat(yn)}const Jt=this.trees[this._limitZoom(Ie)],_t=Jt.range(on(qe),Hi(Ct),on(ft),Hi(ot)),Qt=Jt.data,Ri=[];for(const xi of _t){const yn=this.stride*xi;Ri.push(Qt[yn+Ui]>1?vi(Qt,yn,this.clusterProps):this.points[Qt[yn+hn]])}return Ri}getChildren(we){const Ie=this._getOriginId(we),qe=this._getOriginZoom(we),ot="No cluster with the specified id.",ft=this.trees[qe];if(!ft)throw new Error(ot);const Ct=ft.data;if(Ie*this.stride>=Ct.length)throw new Error(ot);const Jt=this.options.radius/(this.options.extent*Math.pow(2,qe-1)),_t=ft.within(Ct[Ie*this.stride],Ct[Ie*this.stride+1],Jt),Qt=[];for(const Ri of _t){const xi=Ri*this.stride;Ct[xi+4]===we&&Qt.push(Ct[xi+Ui]>1?vi(Ct,xi,this.clusterProps):this.points[Ct[xi+hn]])}if(Qt.length===0)throw new Error(ot);return Qt}getLeaves(we,Ie,qe){const ot=[];return this._appendLeaves(ot,we,Ie=Ie||10,qe=qe||0,0),ot}getTile(we,Ie,qe){const ot=this.trees[this._limitZoom(we)],ft=Math.pow(2,we),{extent:Ct,radius:Jt}=this.options,_t=Jt/Ct,Qt=(qe-_t)/ft,Ri=(qe+1+_t)/ft,xi={features:[]};return this._addTileFeatures(ot.range((Ie-_t)/ft,Qt,(Ie+1+_t)/ft,Ri),ot.data,Ie,qe,ft,xi),Ie===0&&this._addTileFeatures(ot.range(1-_t/ft,Qt,1,Ri),ot.data,ft,qe,ft,xi),Ie===ft-1&&this._addTileFeatures(ot.range(0,Qt,_t/ft,Ri),ot.data,-1,qe,ft,xi),xi.features.length?xi:null}getClusterExpansionZoom(we){let Ie=this._getOriginZoom(we)-1;for(;Ie<=this.options.maxZoom;){const qe=this.getChildren(we);if(Ie++,qe.length!==1)break;we=qe[0].properties.cluster_id}return Ie}_appendLeaves(we,Ie,qe,ot,ft){const Ct=this.getChildren(Ie);for(const Jt of Ct){const _t=Jt.properties;if(_t&&_t.cluster?ft+_t.point_count<=ot?ft+=_t.point_count:ft=this._appendLeaves(we,_t.cluster_id,qe,ot,ft):ft<ot?ft++:we.push(Jt),we.length===qe)break}return ft}_createTree(we){const Ie=new t.c4(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let qe=0;qe<we.length;qe+=this.stride)Ie.add(we[qe],we[qe+1]);return Ie.finish(),Ie.data=we,Ie}_addTileFeatures(we,Ie,qe,ot,ft,Ct){for(const Jt of we){const _t=Jt*this.stride,Qt=Ie[_t+Ui]>1;let Ri,xi,yn;if(Qt)Ri=qi(Ie,_t,this.clusterProps),xi=Ie[_t],yn=Ie[_t+1];else{const Tr=this.points[Ie[_t+hn]];Ri=Tr.properties;const[rr,jn]=Tr.geometry.coordinates;xi=on(rr),yn=Hi(jn)}const $n={type:1,geometry:[[Math.round(this.options.extent*(xi*ft-qe)),Math.round(this.options.extent*(yn*ft-ot))]],tags:Ri};let mn;mn=Qt||this.options.generateId?Ie[_t+hn]:this.points[Ie[_t+hn]].id,mn!==void 0&&($n.id=mn),Ct.features.push($n)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,Ie){const{radius:qe,extent:ot,reduce:ft,minPoints:Ct}=this.options,Jt=qe/(ot*Math.pow(2,Ie)),_t=we.data,Qt=[],Ri=this.stride;for(let xi=0;xi<_t.length;xi+=Ri){if(_t[xi+2]<=Ie)continue;_t[xi+2]=Ie;const yn=_t[xi],$n=_t[xi+1],mn=we.within(_t[xi],_t[xi+1],Jt),Tr=_t[xi+Ui];let rr=Tr;for(const jn of mn){const Kr=jn*Ri;_t[Kr+2]>Ie&&(rr+=_t[Kr+Ui])}if(rr>Tr&&rr>=Ct){let jn,Kr=yn*Tr,io=$n*Tr,No=-1;const oo=(xi/Ri<<5)+(Ie+1)+this.points.length;for(const po of mn){const go=po*Ri;if(_t[go+2]<=Ie)continue;_t[go+2]=Ie;const Wr=_t[go+Ui];Kr+=_t[go]*Wr,io+=_t[go+1]*Wr,_t[go+4]=oo,ft&&(jn||(jn=this._map(_t,xi,!0),No=this.clusterProps.length,this.clusterProps.push(jn)),ft(jn,this._map(_t,go)))}_t[xi+4]=oo,Qt.push(Kr/rr,io/rr,1/0,oo,-1,rr),ft&&Qt.push(No)}else{for(let jn=0;jn<Ri;jn++)Qt.push(_t[xi+jn]);if(rr>1)for(const jn of mn){const Kr=jn*Ri;if(!(_t[Kr+2]<=Ie)){_t[Kr+2]=Ie;for(let io=0;io<Ri;io++)Qt.push(_t[Kr+io])}}}}return Qt}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,Ie,qe){if(we[Ie+Ui]>1){const Ct=this.clusterProps[we[Ie+pt]];return qe?Object.assign({},Ct):Ct}const ot=this.points[we[Ie+hn]].properties,ft=this.options.map(ot);return qe&&ft===ot?Object.assign({},ft):ft}}function vi(Nt,we,Ie){return{type:"Feature",id:Nt[we+hn],properties:qi(Nt,we,Ie),geometry:{type:"Point",coordinates:[(qe=Nt[we],360*(qe-.5)),Bt(Nt[we+1])]}};var qe}function qi(Nt,we,Ie){const qe=Nt[we+Ui],ot=qe>=1e4?`${Math.round(qe/1e3)}k`:qe>=1e3?Math.round(qe/100)/10+"k":qe,ft=Nt[we+pt],Ct=ft===-1?{}:Object.assign({},Ie[ft]);return Object.assign(Ct,{cluster:!0,cluster_id:Nt[we+hn],point_count:qe,point_count_abbreviated:ot})}function on(Nt){return Nt/360+.5}function Hi(Nt){const we=Math.sin(Nt*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Bt(Nt){const we=(180-360*Nt)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function Ii(Nt,we,Ie,qe){let ot=qe;const ft=we+(Ie-we>>1);let Ct,Jt=Ie-we;const _t=Nt[we],Qt=Nt[we+1],Ri=Nt[Ie],xi=Nt[Ie+1];for(let yn=we+3;yn<Ie;yn+=3){const $n=qt(Nt[yn],Nt[yn+1],_t,Qt,Ri,xi);if($n>ot)Ct=yn,ot=$n;else if($n===ot){const mn=Math.abs(yn-ft);mn<Jt&&(Ct=yn,Jt=mn)}}ot>qe&&(Ct-we>3&&Ii(Nt,we,Ct,qe),Nt[Ct+2]=ot,Ie-Ct>3&&Ii(Nt,Ct,Ie,qe))}function qt(Nt,we,Ie,qe,ot,ft){let Ct=ot-Ie,Jt=ft-qe;if(Ct!==0||Jt!==0){const _t=((Nt-Ie)*Ct+(we-qe)*Jt)/(Ct*Ct+Jt*Jt);_t>1?(Ie=ot,qe=ft):_t>0&&(Ie+=Ct*_t,qe+=Jt*_t)}return Ct=Nt-Ie,Jt=we-qe,Ct*Ct+Jt*Jt}function Ne(Nt,we,Ie,qe){const ot={id:Nt??null,type:we,geometry:Ie,tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(we==="Point"||we==="MultiPoint"||we==="LineString")Ge(ot,Ie);else if(we==="Polygon")Ge(ot,Ie[0]);else if(we==="MultiLineString")for(const ft of Ie)Ge(ot,ft);else if(we==="MultiPolygon")for(const ft of Ie)Ge(ot,ft[0]);return ot}function Ge(Nt,we){for(let Ie=0;Ie<we.length;Ie+=3)Nt.minX=Math.min(Nt.minX,we[Ie]),Nt.minY=Math.min(Nt.minY,we[Ie+1]),Nt.maxX=Math.max(Nt.maxX,we[Ie]),Nt.maxY=Math.max(Nt.maxY,we[Ie+1])}function Ke(Nt,we,Ie,qe){if(!we.geometry)return;const ot=we.geometry.coordinates;if(ot&&ot.length===0)return;const ft=we.geometry.type,Ct=Math.pow(Ie.tolerance/((1<<Ie.maxZoom)*Ie.extent),2);let Jt=[],_t=we.id;if(Ie.promoteId?_t=we.properties[Ie.promoteId]:Ie.generateId&&(_t=qe||0),ft==="Point")At(ot,Jt);else if(ft==="MultiPoint")for(const Qt of ot)At(Qt,Jt);else if(ft==="LineString")jt(ot,Jt,Ct,!1);else if(ft==="MultiLineString"){if(Ie.lineMetrics){for(const Qt of ot)Jt=[],jt(Qt,Jt,Ct,!1),Nt.push(Ne(_t,"LineString",Jt,we.properties));return}bi(ot,Jt,Ct,!1)}else if(ft==="Polygon")bi(ot,Jt,Ct,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(const Qt of we.geometry.geometries)Ke(Nt,{id:_t,geometry:Qt,properties:we.properties},Ie,qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qt of ot){const Ri=[];bi(Qt,Ri,Ct,!0),Jt.push(Ri)}}Nt.push(Ne(_t,ft,Jt,we.properties))}function At(Nt,we){we.push(gi(Nt[0]),ii(Nt[1]),0)}function jt(Nt,we,Ie,qe){let ot,ft,Ct=0;for(let _t=0;_t<Nt.length;_t++){const Qt=gi(Nt[_t][0]),Ri=ii(Nt[_t][1]);we.push(Qt,Ri,0),_t>0&&(Ct+=qe?(ot*Ri-Qt*ft)/2:Math.sqrt(Math.pow(Qt-ot,2)+Math.pow(Ri-ft,2))),ot=Qt,ft=Ri}const Jt=we.length-3;we[2]=1,Ii(we,0,Jt,Ie),we[Jt+2]=1,we.size=Math.abs(Ct),we.start=0,we.end=we.size}function bi(Nt,we,Ie,qe){for(let ot=0;ot<Nt.length;ot++){const ft=[];jt(Nt[ot],ft,Ie,qe),we.push(ft)}}function gi(Nt){return Nt/360+.5}function ii(Nt){const we=Math.sin(Nt*Math.PI/180),Ie=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Ie<0?0:Ie>1?1:Ie}function Ci(Nt,we,Ie,qe,ot,ft,Ct,Jt){if(qe/=we,ft>=(Ie/=we)&&Ct<qe)return Nt;if(Ct<Ie||ft>=qe)return null;const _t=[];for(const Qt of Nt){const Ri=Qt.geometry;let xi=Qt.type;const yn=ot===0?Qt.minX:Qt.minY,$n=ot===0?Qt.maxX:Qt.maxY;if(yn>=Ie&&$n<qe){_t.push(Qt);continue}if($n<Ie||yn>=qe)continue;let mn=[];if(xi==="Point"||xi==="MultiPoint")un(Ri,mn,Ie,qe,ot);else if(xi==="LineString")nn(Ri,mn,Ie,qe,ot,!1,Jt.lineMetrics);else if(xi==="MultiLineString")fr(Ri,mn,Ie,qe,ot,!1);else if(xi==="Polygon")fr(Ri,mn,Ie,qe,ot,!0);else if(xi==="MultiPolygon")for(const Tr of Ri){const rr=[];fr(Tr,rr,Ie,qe,ot,!0),rr.length&&mn.push(rr)}if(mn.length){if(Jt.lineMetrics&&xi==="LineString"){for(const Tr of mn)_t.push(Ne(Qt.id,xi,Tr,Qt.tags));continue}xi!=="LineString"&&xi!=="MultiLineString"||(mn.length===1?(xi="LineString",mn=mn[0]):xi="MultiLineString"),xi!=="Point"&&xi!=="MultiPoint"||(xi=mn.length===3?"Point":"MultiPoint"),_t.push(Ne(Qt.id,xi,mn,Qt.tags))}}return _t.length?_t:null}function un(Nt,we,Ie,qe,ot){for(let ft=0;ft<Nt.length;ft+=3){const Ct=Nt[ft+ot];Ct>=Ie&&Ct<=qe&&Gr(we,Nt[ft],Nt[ft+1],Nt[ft+2])}}function nn(Nt,we,Ie,qe,ot,ft,Ct){let Jt=Zn(Nt);const _t=ot===0?xo:Js;let Qt,Ri,xi=Nt.start;for(let rr=0;rr<Nt.length-3;rr+=3){const jn=Nt[rr],Kr=Nt[rr+1],io=Nt[rr+2],No=Nt[rr+3],oo=Nt[rr+4],po=ot===0?jn:Kr,go=ot===0?No:oo;let Wr=!1;Ct&&(Qt=Math.sqrt(Math.pow(jn-No,2)+Math.pow(Kr-oo,2))),po<Ie?go>Ie&&(Ri=_t(Jt,jn,Kr,No,oo,Ie),Ct&&(Jt.start=xi+Qt*Ri)):po>qe?go<qe&&(Ri=_t(Jt,jn,Kr,No,oo,qe),Ct&&(Jt.start=xi+Qt*Ri)):Gr(Jt,jn,Kr,io),go<Ie&&po>=Ie&&(Ri=_t(Jt,jn,Kr,No,oo,Ie),Wr=!0),go>qe&&po<=qe&&(Ri=_t(Jt,jn,Kr,No,oo,qe),Wr=!0),!ft&&Wr&&(Ct&&(Jt.end=xi+Qt*Ri),we.push(Jt),Jt=Zn(Nt)),Ct&&(xi+=Qt)}let yn=Nt.length-3;const $n=Nt[yn],mn=Nt[yn+1],Tr=ot===0?$n:mn;Tr>=Ie&&Tr<=qe&&Gr(Jt,$n,mn,Nt[yn+2]),yn=Jt.length-3,ft&&yn>=3&&(Jt[yn]!==Jt[0]||Jt[yn+1]!==Jt[1])&&Gr(Jt,Jt[0],Jt[1],Jt[2]),Jt.length&&we.push(Jt)}function Zn(Nt){const we=[];return we.size=Nt.size,we.start=Nt.start,we.end=Nt.end,we}function fr(Nt,we,Ie,qe,ot,ft){for(const Ct of Nt)nn(Ct,we,Ie,qe,ot,ft,!1)}function Gr(Nt,we,Ie,qe){Nt.push(we,Ie,qe)}function xo(Nt,we,Ie,qe,ot,ft){const Ct=(ft-we)/(qe-we);return Gr(Nt,ft,Ie+(ot-Ie)*Ct,1),Ct}function Js(Nt,we,Ie,qe,ot,ft){const Ct=(ft-Ie)/(ot-Ie);return Gr(Nt,we+(qe-we)*Ct,ft,1),Ct}function mi(Nt,we){const Ie=[];for(let qe=0;qe<Nt.length;qe++){const ot=Nt[qe],ft=ot.type;let Ct;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")Ct=bs(ot.geometry,we);else if(ft==="MultiLineString"||ft==="Polygon"){Ct=[];for(const Jt of ot.geometry)Ct.push(bs(Jt,we))}else if(ft==="MultiPolygon"){Ct=[];for(const Jt of ot.geometry){const _t=[];for(const Qt of Jt)_t.push(bs(Qt,we));Ct.push(_t)}}Ie.push(Ne(ot.id,ft,Ct,ot.tags))}return Ie}function bs(Nt,we){const Ie=[];Ie.size=Nt.size,Nt.start!==void 0&&(Ie.start=Nt.start,Ie.end=Nt.end);for(let qe=0;qe<Nt.length;qe+=3)Ie.push(Nt[qe]+we,Nt[qe+1],Nt[qe+2]);return Ie}function al(Nt,we){if(Nt.transformed)return Nt;const Ie=1<<Nt.z,qe=Nt.x,ot=Nt.y;for(const ft of Nt.features){const Ct=ft.geometry,Jt=ft.type;if(ft.geometry=[],Jt===1)for(let _t=0;_t<Ct.length;_t+=2)ft.geometry.push(is(Ct[_t],Ct[_t+1],we,Ie,qe,ot));else for(let _t=0;_t<Ct.length;_t++){const Qt=[];for(let Ri=0;Ri<Ct[_t].length;Ri+=2)Qt.push(is(Ct[_t][Ri],Ct[_t][Ri+1],we,Ie,qe,ot));ft.geometry.push(Qt)}}return Nt.transformed=!0,Nt}function is(Nt,we,Ie,qe,ot,ft){return[Math.round(Ie*(Nt*qe-ot)),Math.round(Ie*(we*qe-ft))]}function Hs(Nt,we,Ie,qe,ot){const ft=we===ot.maxZoom?0:ot.tolerance/((1<<we)*ot.extent),Ct={features:[],numPoints:0,numSimplified:0,numFeatures:Nt.length,source:null,x:Ie,y:qe,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Jt of Nt)ll(Ct,Jt,ft,ot);return Ct}function ll(Nt,we,Ie,qe){const ot=we.geometry,ft=we.type,Ct=[];if(Nt.minX=Math.min(Nt.minX,we.minX),Nt.minY=Math.min(Nt.minY,we.minY),Nt.maxX=Math.max(Nt.maxX,we.maxX),Nt.maxY=Math.max(Nt.maxY,we.maxY),ft==="Point"||ft==="MultiPoint")for(let Jt=0;Jt<ot.length;Jt+=3)Ct.push(ot[Jt],ot[Jt+1]),Nt.numPoints++,Nt.numSimplified++;else if(ft==="LineString")yi(Ct,ot,Nt,Ie,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(let Jt=0;Jt<ot.length;Jt++)yi(Ct,ot[Jt],Nt,Ie,ft==="Polygon",Jt===0);else if(ft==="MultiPolygon")for(let Jt=0;Jt<ot.length;Jt++){const _t=ot[Jt];for(let Qt=0;Qt<_t.length;Qt++)yi(Ct,_t[Qt],Nt,Ie,!0,Qt===0)}if(Ct.length){let Jt=we.tags||null;if(ft==="LineString"&&qe.lineMetrics){Jt={};for(const Qt in we.tags)Jt[Qt]=we.tags[Qt];Jt.mapbox_clip_start=ot.start/ot.size,Jt.mapbox_clip_end=ot.end/ot.size}const _t={geometry:Ct,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:Jt};we.id!==null&&(_t.id=we.id),Nt.features.push(_t)}}function yi(Nt,we,Ie,qe,ot,ft){const Ct=qe*qe;if(qe>0&&we.size<(ot?Ct:qe))return void(Ie.numPoints+=we.length/3);const Jt=[];for(let _t=0;_t<we.length;_t+=3)(qe===0||we[_t+2]>Ct)&&(Ie.numSimplified++,Jt.push(we[_t],we[_t+1])),Ie.numPoints++;ot&&(function(_t,Qt){let Ri=0;for(let xi=0,yn=_t.length,$n=yn-2;xi<yn;$n=xi,xi+=2)Ri+=(_t[xi]-_t[$n])*(_t[xi+1]+_t[$n+1]);if(Ri>0===Qt)for(let xi=0,yn=_t.length;xi<yn/2;xi+=2){const $n=_t[xi],mn=_t[xi+1];_t[xi]=_t[yn-2-xi],_t[xi+1]=_t[yn-1-xi],_t[yn-2-xi]=$n,_t[yn-1-xi]=mn}})(Jt,ft),Nt.push(Jt)}const Ao={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bo{constructor(we,Ie){const qe=(Ie=this.options=(function(ft,Ct){for(const Jt in Ct)ft[Jt]=Ct[Jt];return ft})(Object.create(Ao),Ie)).debug;if(qe&&console.time("preprocess data"),Ie.maxZoom<0||Ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ie.promoteId&&Ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let ot=(function(ft,Ct){const Jt=[];if(ft.type==="FeatureCollection")for(let _t=0;_t<ft.features.length;_t++)Ke(Jt,ft.features[_t],Ct,_t);else Ke(Jt,ft.type==="Feature"?ft:{geometry:ft},Ct);return Jt})(we,Ie);this.tiles={},this.tileCoords=[],qe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ie.indexMaxZoom,Ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ot=(function(ft,Ct){const Jt=Ct.buffer/Ct.extent;let _t=ft;const Qt=Ci(ft,1,-1-Jt,Jt,0,-1,2,Ct),Ri=Ci(ft,1,1-Jt,2+Jt,0,-1,2,Ct);return(Qt||Ri)&&(_t=Ci(ft,1,-Jt,1+Jt,0,-1,2,Ct)||[],Qt&&(_t=mi(Qt,1).concat(_t)),Ri&&(_t=_t.concat(mi(Ri,-1)))),_t})(ot,Ie),ot.length&&this.splitTile(ot,0,0,0),qe&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(we,Ie,qe,ot,ft,Ct,Jt){const _t=[we,Ie,qe,ot],Qt=this.options,Ri=Qt.debug;for(;_t.length;){ot=_t.pop(),qe=_t.pop(),Ie=_t.pop(),we=_t.pop();const xi=1<<Ie,yn=sa(Ie,qe,ot);let $n=this.tiles[yn];if(!$n&&(Ri>1&&console.time("creation"),$n=this.tiles[yn]=Hs(we,Ie,qe,ot,Qt),this.tileCoords.push({z:Ie,x:qe,y:ot}),Ri)){Ri>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ie,qe,ot,$n.numFeatures,$n.numPoints,$n.numSimplified),console.timeEnd("creation"));const Wr=`z${Ie}`;this.stats[Wr]=(this.stats[Wr]||0)+1,this.total++}if($n.source=we,ft==null){if(Ie===Qt.indexMaxZoom||$n.numPoints<=Qt.indexMaxPoints)continue}else{if(Ie===Qt.maxZoom||Ie===ft)continue;if(ft!=null){const Wr=ft-Ie;if(qe!==Ct>>Wr||ot!==Jt>>Wr)continue}}if($n.source=null,we.length===0)continue;Ri>1&&console.time("clipping");const mn=.5*Qt.buffer/Qt.extent,Tr=.5-mn,rr=.5+mn,jn=1+mn;let Kr=null,io=null,No=null,oo=null,po=Ci(we,xi,qe-mn,qe+rr,0,$n.minX,$n.maxX,Qt),go=Ci(we,xi,qe+Tr,qe+jn,0,$n.minX,$n.maxX,Qt);we=null,po&&(Kr=Ci(po,xi,ot-mn,ot+rr,1,$n.minY,$n.maxY,Qt),io=Ci(po,xi,ot+Tr,ot+jn,1,$n.minY,$n.maxY,Qt),po=null),go&&(No=Ci(go,xi,ot-mn,ot+rr,1,$n.minY,$n.maxY,Qt),oo=Ci(go,xi,ot+Tr,ot+jn,1,$n.minY,$n.maxY,Qt),go=null),Ri>1&&console.timeEnd("clipping"),_t.push(Kr||[],Ie+1,2*qe,2*ot),_t.push(io||[],Ie+1,2*qe,2*ot+1),_t.push(No||[],Ie+1,2*qe+1,2*ot),_t.push(oo||[],Ie+1,2*qe+1,2*ot+1)}}getTile(we,Ie,qe){we=+we,Ie=+Ie,qe=+qe;const ot=this.options,{extent:ft,debug:Ct}=ot;if(we<0||we>24)return null;const Jt=1<<we,_t=sa(we,Ie=Ie+Jt&Jt-1,qe);if(this.tiles[_t])return al(this.tiles[_t],ft);Ct>1&&console.log("drilling down to z%d-%d-%d",we,Ie,qe);let Qt,Ri=we,xi=Ie,yn=qe;for(;!Qt&&Ri>0;)Ri--,xi>>=1,yn>>=1,Qt=this.tiles[sa(Ri,xi,yn)];return Qt&&Qt.source?(Ct>1&&(console.log("found parent tile z%d-%d-%d",Ri,xi,yn),console.time("drilling down")),this.splitTile(Qt.source,Ri,xi,yn,we,Ie,qe),Ct>1&&console.timeEnd("drilling down"),this.tiles[_t]?al(this.tiles[_t],ft):null):null}}function sa(Nt,we,Ie){return 32*((1<<Nt)*Ie+we)+Nt}function ns(Nt,we){const Ie=Nt.tileID.canonical;if(!this._geoJSONIndex)return void we(null,null);const qe=this._geoJSONIndex.getTile(Ie.z,Ie.x,Ie.y);if(!qe)return void we(null,null);const ot=Qt=>Qt.tags&&"3d_elevation_id"in Qt.tags&&"source"in Qt.tags&&Qt.tags.source==="elevation",ft=qe.features.filter((Qt=>ot(Qt)));let Ct={_geojsonTileLayer:qe.features};ft.length>0&&(Ct={_geojsonTileLayer:qe.features.filter((Qt=>!ot(Qt))),hd_road_elevation:ft});const Jt=new Wt(Ct),_t=(function(Qt){const Ri=new t.bt;for(const xi of Object.keys(Qt))Ri.writeMessage(3,Hr,{name:xi,features:Qt[xi]});return Ri.finish()})(Ct).buffer;we(null,{vectorTile:Jt,rawData:_t})}class Ja extends We{constructor(we,Ie,qe,ot,ft,Ct,Jt){super(we,Ie,qe,ot,ft,ns,Jt),Ct&&(this.loadGeoJSON=Ct),this._dynamicIndex=new Ft}loadData(we,Ie){const qe=we&&we.request,ot=qe&&qe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(we,((ft,Ct)=>{if(ft||!Ct)return Ie(ft);if(typeof Ct!="object")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));{try{if(we.filter){const _t=t.U(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_t.result==="error")throw new Error(_t.value.map((Qt=>`${Qt.key}: ${Qt.message}`)).join(", "));Ct.features=Ct.features.filter((Qt=>_t.value.evaluate({zoom:0},Qt)))}we.dynamic?(Ct.type==="Feature"&&(Ct={type:"FeatureCollection",features:[Ct]}),we.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ct.features,this.loaded),we.cluster&&(Ct.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=we.cluster?new Ot((function({superclusterOptions:_t,clusterProperties:Qt}){if(!Qt||!_t)return _t;const Ri={},xi={},yn={accumulated:null,zoom:0},$n={properties:null},mn=Object.keys(Qt);for(const Tr of mn){const[rr,jn]=Qt[Tr],Kr=t.U(jn),io=t.U(typeof rr=="string"?[rr,["accumulated"],["get",Tr]]:rr);Ri[Tr]=Kr.value,xi[Tr]=io.value}return _t.map=Tr=>{$n.properties=Tr;const rr={};for(const jn of mn)rr[jn]=Ri[jn].evaluate(yn,$n);return rr},_t.reduce=(Tr,rr)=>{$n.properties=rr;for(const jn of mn)yn.accumulated=Tr[jn],Tr[jn]=xi[jn].evaluate(yn,$n)},_t})(we)).load(Ct.features):we.dynamic?this._dynamicIndex:(function(_t,Qt){return new Bo(_t,Qt)})(Ct,we.geojsonVtOptions)}catch(_t){return Ie(_t)}const Jt={};if(ot){const _t=P(qe);_t&&(Jt.resourceTiming={},Jt.resourceTiming[we.source]=JSON.parse(JSON.stringify(_t)))}Ie(null,Jt)}}))}reloadTile(we,Ie){const qe=this.loaded;return qe&&qe[we.uid]?we.partial?Ie(null,void 0):super.reloadTile(we,Ie):this.loadTile(we,Ie)}loadGeoJSON(we,Ie){if(we.request)t.m(we.request,Ie);else{if(typeof we.data!="string")return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return Ie(null,JSON.parse(we.data))}catch{return Ie(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(we,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(we.clusterId))}catch(qe){Ie(qe)}}getClusterChildren(we,Ie){try{Ie(null,this._geoJSONIndex.getChildren(we.clusterId))}catch(qe){Ie(qe)}}getClusterLeaves(we,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset))}catch(qe){Ie(qe)}}}class Mn{constructor(we,Ie,qe){this.tileID=new t.aQ(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=we.projection,this.brightness=Ie,this.worldview=qe}parse(we,Ie,qe,ot){this.status="parsing";const ft=new t.aQ(qe.tileID.overscaledZ,qe.tileID.wrap,qe.tileID.canonical.z,qe.tileID.canonical.x,qe.tileID.canonical.y),Ct=[],Jt=Ie.familiesBySource[qe.source],_t=new t.fn(ft,qe.promoteId);_t.bucketLayerIDs=[],_t.is3DTile=!0,t.fC(we).then((Qt=>{if(!Qt)return ot(new Error("Could not parse tile"));const Ri=Qt.json.extensionsUsed&&Qt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qt.json.asset.extras&&Qt.json.asset.extras.MAPBOX_mesh_features,xi=Qt.json.extensionsUsed&&Qt.json.extensionsUsed.includes("EXT_meshopt_compression"),yn=new t.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const $n in Jt)for(const mn of Jt[$n]){const Tr=mn[0];_t.bucketLayerIDs.push(mn.map((Kr=>t.B(Kr.id,Kr.scope)))),Tr.recalculate(yn,[]);const rr=t.fD(Qt,1/t.d7(qe.tileID.canonical)),jn=new t.fE(mn,rr,ft,Ri,xi,this.brightness,_t,this.worldview);Ri||(jn.needsUpload=!0),Ct.push(jn),jn.evaluate(Tr)}this.status="done",ot(null,{buckets:Ct,featureIndex:_t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Qt=>ot(new Error(Qt.message))))}}class Qa{constructor(we,Ie,qe,ot,ft,Ct,Jt,_t){this.actor=we,this.layerIndex=Ie,this.availableImages=qe,this.availableModels=ot,this.brightness=Jt,this.loading={},this.loaded={},this.worldview=_t}loadTile(we,Ie){const qe=we.uid,ot=this.loading[qe]=new Mn(we,this.brightness,this.worldview);t.bu(we.request,((ft,Ct)=>{const Jt=!this.loading[qe];return delete this.loading[qe],Jt||ft?(ot.status="done",Jt||(this.loaded[qe]=ot),Ie(ft)):Ct&&Ct.byteLength!==0?void ot.parse(Ct,this.layerIndex,we,((_t,Qt)=>{ot.status="done",this.loaded=this.loaded||{},this.loaded[qe]=ot,_t||!Qt?Ie(_t):Ie(null,Qt)})):(ot.status="done",this.loaded[qe]=ot,Ie())}))}reloadTile(we,Ie){const qe=this.loaded,ot=we.uid;if(qe&&qe[ot]){const ft=qe[ot];ft.projection=we.projection,ft.brightness=we.brightness;const Ct=(Jt,_t)=>{ft.reloadCallback&&(delete ft.reloadCallback,this.loadTile(we,Ie)),Ie(Jt,_t)};ft.status==="parsing"?ft.reloadCallback=Ct:ft.status==="done"&&this.loadTile(we,Ie)}}abortTile(we,Ie){const qe=we.uid;this.loading[qe]&&delete this.loading[qe],Ie()}removeTile(we,Ie){const qe=this.loaded,ot=we.uid;qe&&qe[ot]&&delete qe[ot],Ie()}}class gl{constructor(we){this.self=we,this.actor=new t.fG(we,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new t.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=t.cm({name:"mercator"}),this.workerSourceTypes={vector:We,geojson:Ja,"raster-dem":je,"raster-array":ct,"batched-model":Qa},this.workerSources={},this.self.registerWorkerSource=(Ie,qe)=>{if(this.workerSourceTypes[Ie])throw new Error(`Worker source with name "${Ie}" already registered.`);this.workerSourceTypes[Ie]=qe},this.self.registerRTLTextPlugin=Ie=>{if(t.fH.isParsed())throw new Error("RTL text plugin already registered.");t.fH.setState({pluginStatus:t.fI.parsed,pluginURL:t.fH.getPluginURL()}),t.fH.applyArabicShaping=Ie.applyArabicShaping,t.fH.processBidirectionalText=Ie.processBidirectionalText,t.fH.processStyledBidirectionalText=Ie.processStyledBidirectionalText;for(const qe of this.rtlPluginParsingListeners)qe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(we,Ie,qe){delete this.layerIndexes[we],delete this.availableImages[we],delete this.availableModels[we],delete this.workerSources[we],qe()}checkIfReady(we,Ie,qe){qe()}setReferrer(we,Ie){this.referrer=Ie}spriteLoaded(we,Ie){this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={});const{scope:qe,isLoaded:ot}=Ie;if(this.isSpriteLoaded[we][qe]=ot,this.workerSources[we]&&this.workerSources[we][qe])for(const ft in this.workerSources[we][qe]){const Ct=this.workerSources[we][qe][ft];for(const Jt in Ct){const _t=Ct[Jt];_t instanceof We&&(_t.isSpriteLoaded=ot,_t.fire(new t.z("isSpriteLoaded")))}}}setImages(we,Ie,qe){this.availableImages[we]||(this.availableImages[we]={});const{scope:ot,images:ft}=Ie;if(this.availableImages[we][ot]=ft,this.workerSources[we]&&this.workerSources[we][ot]){for(const Ct in this.workerSources[we][ot]){const Jt=this.workerSources[we][ot][Ct];for(const _t in Jt)Jt[_t].availableImages=ft}qe()}else qe()}setModels(we,{scope:Ie,models:qe},ot){if(this.availableModels[we]||(this.availableModels[we]={}),this.availableModels[we][Ie]=qe,this.workerSources[we]&&this.workerSources[we][Ie]){for(const ft in this.workerSources[we][Ie]){const Ct=this.workerSources[we][Ie][ft];for(const Jt in Ct)Ct[Jt].availableModels=qe}ot()}else ot()}setProjection(we,Ie){this.projections[we]=t.cm(Ie)}setBrightness(we,Ie,qe){this.brightness=Ie,qe()}setWorldview(we,Ie,qe){this.worldview=Ie,qe()}setLayers(we,Ie,qe){this.getLayerIndex(we,Ie.scope).replace(Ie.layers,Ie.options),qe()}updateLayers(we,Ie,qe){this.getLayerIndex(we,Ie.scope).update(Ie.layers,Ie.removedIds,Ie.options),qe()}loadTile(we,Ie,qe){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).loadTile(Ie,qe)}decodeRasterArray(we,Ie,qe){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).decodeRasterArray(Ie,qe)}reloadTile(we,Ie,qe){Ie.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).reloadTile(Ie,qe)}abortTile(we,Ie,qe){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).abortTile(Ie,qe)}removeTile(we,Ie,qe){this.getWorkerSource(we,Ie.type,Ie.source,Ie.scope).removeTile(Ie,qe)}removeSource(we,Ie,qe){if(!(this.workerSources[we]&&this.workerSources[we][Ie.scope]&&this.workerSources[we][Ie.scope][Ie.type]&&this.workerSources[we][Ie.scope][Ie.type][Ie.source]))return;const ot=this.workerSources[we][Ie.scope][Ie.type][Ie.source];delete this.workerSources[we][Ie.scope][Ie.type][Ie.source],ot.removeSource!==void 0?ot.removeSource(Ie,qe):qe()}loadWorkerSource(we,Ie,qe){try{this.self.importScripts(Ie.url),qe()}catch(ot){qe(ot)}}syncRTLPluginState(we,Ie,qe){if(t.fH.isParsed())qe(null,!0);else if(t.fH.isParsing())this.rtlPluginParsingListeners.push(qe);else try{t.fH.setState(Ie);const ot=t.fH.getPluginURL();!t.fH.isLoaded()||t.fH.isParsed()||t.fH.isParsing()||ot==null||(t.fH.setState({pluginStatus:t.fI.parsing,pluginURL:t.fH.getPluginURL()}),this.self.importScripts(ot),t.fH.isParsed()?qe(null,!0):this.rtlPluginParsingListeners.push(qe))}catch(ot){qe(ot)}}setDracoUrl(we,Ie){this.dracoUrl=Ie}getAvailableImages(we,Ie){this.availableImages[we]||(this.availableImages[we]={});let qe=this.availableImages[we][Ie];return qe||(qe=[]),qe}getAvailableModels(we,Ie){this.availableModels[we]||(this.availableModels[we]={});let qe=this.availableModels[we][Ie];return qe||(qe={}),qe}getLayerIndex(we,Ie){this.layerIndexes[we]||(this.layerIndexes[we]={});let qe=this.layerIndexes[we][Ie];return qe||(qe=this.layerIndexes[we][Ie]=new $,qe.scope=Ie),qe}getWorkerSource(we,Ie,qe,ot){const ft=this.workerSources;return ft[we]||(ft[we]={}),ft[we][ot]||(ft[we][ot]={}),ft[we][ot][Ie]||(ft[we][ot][Ie]={}),this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),ft[we][ot][Ie][qe]||(ft[we][ot][Ie][qe]=new this.workerSourceTypes[Ie]({send:(Ct,Jt,_t,Qt,Ri,xi)=>this.actor.send(Ct,Jt,_t,we,Ri,xi),scheduler:this.actor.scheduler},this.getLayerIndex(we,ot),this.getAvailableImages(we,ot),this.getAvailableModels(we,ot),this.isSpriteLoaded[we][ot],void 0,this.brightness,this.worldview)),ft[we][ot][Ie][qe]}rasterizeImagesWorker(we,Ie,qe){const ot=new Map;for(const[ft,{image:Ct,imageVariant:Jt}]of Ie.tasks.entries()){const _t=this.imageRasterizer.rasterize(Jt,Ct,Ie.scope,we);ot.set(ft,_t)}qe(void 0,ot)}removeRasterizedImages(we,Ie,qe){this.imageRasterizer.removeImagesFromCacheByIds(Ie.imageIds,Ie.scope,we),qe()}enforceCacheSizeLimit(we,Ie){t.fJ(Ie)}getWorkerPerformanceMetrics(we,Ie,qe){qe(void 0,void 0)}}return t.fF(self)&&(self.worker=new gl(self)),gl})),_(["./shared"],(function(t){var P="3.17.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(v){performance.mark(v)},measure(v,r,h){performance.measure(v,r,h)}};function $(v){const r=v.name.split("?")[0];return t.a(r)&&r.includes("mapbox-gl.js")?"javascript":t.a(r)&&r.includes("mapbox-gl.css")?"css":t.b(r)?"fontRange":t.c(r)?"sprite":t.i(r)?"style":t.d(r)?"tilejson":"other"}var W,Y={},ae=(function(){if(W)return Y;function v(x){return!r(x)}function r(x){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,k,B=new Blob([""],{type:"text/javascript"}),G=URL.createObjectURL(B);try{k=new Worker(G),M=!0}catch{M=!1}return k&&k.terminate(),URL.revokeObjectURL(G),M})()?(function(){var M=document.createElement("canvas");M.width=M.height=1;var k=M.getContext("2d");if(!k)return!1;var B=k.getImageData(0,0,1,1);return B&&B.width===M.width})()?(h[E=x&&x.failIfMajorPerformanceCaveat]===void 0&&(h[E]=(function(M){var k,B=(function(G){var J=document.createElement("canvas"),ee=Object.create(v.webGLContextAttributes);return ee.failIfMajorPerformanceCaveat=G,J.getContext("webgl2",ee)})(M);if(!B)return!1;try{k=B.createShader(B.VERTEX_SHADER)}catch{return!1}return!(!k||B.isContextLost())&&(B.shaderSource(k,"void main() {}"),B.compileShader(k),B.getShaderParameter(k,B.COMPILE_STATUS)===!0)})(E)),h[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}W=1,Y.supported=v,Y.notSupportedReason=r;var h={};return v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Y})();function se(v,r,h){const x=document.createElement(v);return r!=null&&(x.className=r),h&&h.appendChild(x),x}function ie(v,r,h){const x=document.createElementNS("http://www.w3.org/2000/svg",v);for(const E of Object.keys(r))x.setAttributeNS(null,E,String(r[E]));return h&&h.appendChild(x),x}const pe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ye=pe&&pe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function Ee(){pe&&ye&&(de=pe[ye],pe[ye]="none")}function Pe(){pe&&ye&&(pe[ye]=de)}function Ze(v){v.preventDefault(),v.stopPropagation(),window.removeEventListener("click",Ze,!0)}function We(){window.addEventListener("click",Ze,!0),window.setTimeout((()=>{window.removeEventListener("click",Ze,!0)}),0)}function je(v,r){const h=v.getBoundingClientRect();return Lt(v,h,r)}function Ye(v,r){const h=v.getBoundingClientRect(),x=[];for(let E=0;E<r.length;E++)x.push(Lt(v,h,r[E]));return x}function ct(v){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&v.button===2&&v.ctrlKey?0:v.button}function Lt(v,r,h){const x=v.offsetWidth===r.width?1:v.offsetWidth/r.width;return new t.P((h.clientX-r.left)*x,(h.clientY-r.top)*x)}const Ht="01",ci="NO_ACCESS_TOKEN";class Wt{constructor(r,h,x){this._transformRequestFn=r,this._customAccessToken=h,this._silenceAuthErrors=!!x,this._createSkuToken()}_createSkuToken(){const r=(function(){let h="";for(let x=0;x<10;x++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ht,h].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}normalizeStyleURL(r,h){if(!t.h(r))return r;const x=Dt(r);return x.params.push(`sdk=js-${P}`),x.path=`/styles/v1${x.path}`,this._makeAPIURL(x,this._customAccessToken||h)}normalizeGlyphsURL(r,h){if(!t.h(r))return r;const x=Dt(r);return x.path=`/fonts/v1${x.path}`,this._makeAPIURL(x,this._customAccessToken||h)}normalizeModelURL(r,h){if(!t.h(r))return r;const x=Dt(r);return x.path=`/models/v1${x.path}`,this._makeAPIURL(x,this._customAccessToken||h)}normalizeSourceURL(r,h,x,E){if(!t.h(r))return r;const M=Dt(r);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),x&&M.params.push(`language=${x}`),E&&M.params.push(`worldview=${E}`),this._makeAPIURL(M,this._customAccessToken||h)}normalizeIconsetURL(r,h){const x=Dt(r);return t.h(r)?(x.path=`/styles/v1${x.path}/iconset.pbf`,this._makeAPIURL(x,this._customAccessToken||h)):Ft(x)}normalizeSpriteURL(r,h,x,E){const M=Dt(r);return t.h(r)?(M.path=`/styles/v1${M.path}/sprite${h}${x}`,this._makeAPIURL(M,this._customAccessToken||E)):(M.path+=`${h}${x}`,Ft(M))}normalizeTileURL(r,h,x){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!t.h(r))return r;const E=Dt(r);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||x&&E.authority!=="raster"&&x===512?"@2x":""}${t.k.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${t.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${t.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${t.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${t.e.TILE_URL_VERSION}${E.path}`);const M=this._customAccessToken||(function(k){for(const B of k){const G=B.match(/^access_token=(.*)$/);if(G)return G[1]}return null})(E.params)||t.e.ACCESS_TOKEN;return t.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,M)}canonicalizeTileURL(r,h){const x=Dt(r);if(!x.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!x.path.match(/\.[\w]+$/))return r;let E="mapbox://";x.path.match(/^\/raster\/v1\//)?E+=`raster/${x.path.replace(`/${t.e.RASTER_URL_PREFIX}/`,"")}`:x.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${x.path.replace(`/${t.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${x.path.replace(`/${t.e.TILE_URL_VERSION}/`,"")}`;let M=x.params;return h&&(M=M.filter((k=>!k.match(/^access_token=/)))),M.length&&(E+=`?${M.join("&")}`),E}canonicalizeTileset(r,h){const x=!!h&&t.h(h),E=[];for(const M of r.tiles||[])t.j(M)?E.push(this.canonicalizeTileURL(M,x)):E.push(M);return E}_makeAPIURL(r,h){const x="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=Dt(t.e.API_URL);if(r.protocol=E.protocol,r.authority=E.authority,r.protocol==="http"){const M=r.params.indexOf("secure");M>=0&&r.params.splice(M,1)}if(E.path!=="/"&&(r.path=`${E.path}${r.path}`),!t.e.REQUIRE_ACCESS_TOKEN)return Ft(r);if(h=h||t.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${x}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${x}`)}return r.params=r.params.filter((M=>M.indexOf("access_token")===-1)),r.params.push(`access_token=${h||""}`),Ft(r)}}const $t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Dt(v){const r=v.match($t);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ft(v){const r=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${r}`}const vt="mapbox.eventData";function wi(v){if(!v)return null;const r=v.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(t.l(r[1]))}catch{return null}}class Qi{constructor(r){this.type=r,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const h=wi(t.e.ACCESS_TOKEN);let x="";return x=h&&h.u?t.f(h.u):t.e.ACCESS_TOKEN||"",r?`${vt}.${r}:${x}`:`${vt}:${x}`}fetchEventData(){const r=t.s("localStorage"),h=this.getStorageKey(),x=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp");if(r)try{const M=localStorage.getItem(h);M&&(this.eventData=JSON.parse(M));const k=localStorage.getItem(x);k&&(this.anonId=k);const B=localStorage.getItem(E);B&&(this.anonIdTimestamp=Number(B));const G=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<G)&&this.refreshUUID()}catch{t.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=t.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const r=t.s("localStorage"),h=this.getStorageKey(),x=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp"),M=this.anonId,k=this.anonIdTimestamp;if(r&&M)try{localStorage.setItem(x,M),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData)),k&&localStorage.setItem(E,k.toString())}catch{t.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,h,x,E){if(!t.e.EVENTS_URL)return;const M=Dt(t.e.EVENTS_URL);M.params.push(`access_token=${E||t.e.ACCESS_TOKEN||""}`);const k={event:this.type,created:new Date(r).toISOString()},B=h?Object.assign(k,h):k,G={url:Ft(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([B])};this.pendingRequest=t.p(G,(J=>{this.pendingRequest=null,x(J),this.saveEventData(),this.processRequests(E)}))}queueRequest(r,h){this.queue.push(r),this.processRequests(h)}}class wn extends Qi{constructor(r){super("metrics"),r&&(this.data=r)}postMetricsEvent(r){if(!t.e.EVENTS_URL||!r&&!t.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),t.v(this.anonId)||this.refreshUUID();const h=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:h},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:h,payload:x}=this.queue.shift();this.postEvent(h,x,(()=>{}),r)}}const qn=new class extends Qi{constructor(v){super("appUserTurnstile"),this._customAccessToken=v}postTurnstileEvent(v,r){t.e.EVENTS_URL&&t.e.ACCESS_TOKEN&&Array.isArray(v)&&v.some((h=>t.h(h)||t.j(h)))&&this.queueRequest(Date.now(),r)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=wi(t.e.ACCESS_TOKEN),h=r?r.u:t.e.ACCESS_TOKEN;let x=h!==this.eventData.tokenU;t.v(this.anonId)||(this.refreshUUID(),x=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),k=new Date(E),B=(E-this.eventData.lastSuccess)/864e5;x=x||B>=1||B<-1||M.getDate()!==k.getDate()}else x=!0;x?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Ht,"enabled.telemetry":!1,userId:this.anonId},(M=>{M||(this.eventData.lastSuccess=E,this.eventData.tokenU=h)}),v):this.processRequests()}},Fn=qn.postTurnstileEvent.bind(qn),mr=new class extends Qi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(v,r,h,x){this.skuToken=r,this.errorCb=x,t.e.EVENTS_URL&&(h||t.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},h):this.errorCb(new Error(ci)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:h}=this.queue.shift();r&&this.success[r]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),t.v(this.anonId)||this.refreshUUID(),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:Ht,skuToken:this.skuToken,userId:this.anonId},(x=>{x?this.errorCb(x):r&&(this.success[r]=!0)}),v))}remove(){this.errorCb=null}},Sr=mr.postMapLoadEvent.bind(mr),Hr=new class extends Qi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(v){let r=this.mapInstanceIdMap.get(v);return r||(r=t.u(),this.mapInstanceIdMap.set(v,r)),r}getEventId(v){const r=this.eventIdPerMapInstanceMap.get(v)||0;return this.eventIdPerMapInstanceMap.set(v,r+1),r}postStyleLoadEvent(v,r){const{map:h,style:x,importedStyles:E}=r;if(!t.e.EVENTS_URL||!v&&!t.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(h),k={mapInstanceId:M,eventId:this.getEventId(M),style:x};E.length&&(k.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:k},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:h}=this.queue.shift();this.postEvent(r,h,(()=>{}),v)}},ti=Hr.postStyleLoadEvent.bind(Hr),sn=new wn({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Gi=sn.postMetricsEvent.bind(sn),gn=new wn({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),nr=gn.postMetricsEvent.bind(gn),Ur=new class extends Qi{constructor(){super("gljs.performance")}postPerformanceEvent(v,r){t.e.EVENTS_URL&&(v||t.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:h}=this.queue.shift(),x=(function(E){const M=performance.getEntriesByType("resource"),k=performance.getEntriesByType("mark"),B=(function(he){const be={};if(he){for(const _e in he)if(_e!=="other")for(const ke of he[_e]){const Ae=`${_e}ResolveRangeMin`,Oe=`${_e}ResolveRangeMax`,He=`${_e}RequestCount`,Be=`${_e}RequestCachedCount`;be[Ae]=Math.min(be[Ae]||1/0,ke.startTime),be[Oe]=Math.max(be[Oe]||-1/0,ke.responseEnd);const dt=nt=>{be[nt]===void 0&&(be[nt]=0),++be[nt]};ke.transferSize!==void 0&&ke.transferSize===0&&dt(Be),dt(He)}}return be})((function(he,be){const _e={};if(he)for(const ke of he){const Ae=be(ke);_e[Ae]===void 0&&(_e[Ae]=[]),_e[Ae].push(ke)}return _e})(M,$)),G=window.devicePixelRatio,J=navigator.connection||navigator.mozConnection||navigator.webkitConnection,ee=J?J.effectiveType:void 0,ce={counters:[],metadata:[],attributes:[]},le=(he,be,_e)=>{_e!=null&&he.push({name:be,value:_e.toString()})};for(const he in B)le(ce.counters,he,B[he]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(le(ce.counters,"interactionRangeMin",E.interactionRange[0]),le(ce.counters,"interactionRangeMax",E.interactionRange[1])),k)for(const he of Object.values(O)){const be=k.find((_e=>_e.name===he));be&&le(ce.counters,he,be.startTime)}return le(ce.counters,"visibilityHidden",E.visibilityHidden),le(ce.attributes,"style",(function(he){if(he)for(const be of he){const _e=be.name.split("?")[0];if(t.i(_e)){const ke=_e.split("/").slice(-2);if(ke.length===2)return`mapbox://styles/${ke[0]}/${ke[1]}`}}})(M)),le(ce.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),le(ce.attributes,"fogEnabled",E.fogEnabled?"true":"false"),le(ce.attributes,"projection",E.projection),le(ce.attributes,"zoom",E.zoom),le(ce.metadata,"devicePixelRatio",G),le(ce.metadata,"connectionEffectiveType",ee),le(ce.metadata,"navigatorUserAgent",navigator.userAgent),le(ce.metadata,"screenWidth",window.screen.width),le(ce.metadata,"screenHeight",window.screen.height),le(ce.metadata,"windowWidth",window.innerWidth),le(ce.metadata,"windowHeight",window.innerHeight),le(ce.metadata,"mapWidth",E.width/G),le(ce.metadata,"mapHeight",E.height/G),le(ce.metadata,"webglRenderer",E.renderer),le(ce.metadata,"webglVendor",E.vendor),le(ce.metadata,"sdkVersion",P),le(ce.metadata,"sdkIdentifier","mapbox-gl-js"),ce})(h);for(const E of x.metadata);for(const E of x.counters);for(const E of x.attributes);this.postEvent(r,x,(()=>{}),v)}},St=Ur.postPerformanceEvent.bind(Ur),Gt=new class extends Qi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(v,r,h,x){if(!t.e.API_URL||!t.e.SESSION_PATH)return;const E=Dt(t.e.API_URL+t.e.SESSION_PATH);E.params.push(`sku=${r||""}`),E.params.push(`access_token=${x||t.e.ACCESS_TOKEN||""}`);const M={url:Ft(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=t.g(M,(k=>{this.pendingRequest=null,h(k),this.saveEventData(),this.processRequests(x)}))}getSessionAPI(v,r,h,x){this.skuToken=r,this.errorCb=x,t.e.SESSION_PATH&&t.e.API_URL&&(h||t.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},h):this.errorCb(new Error(ci)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:h}=this.queue.shift();r&&this.success[r]||this.getSession(h,this.skuToken,(x=>{x?this.errorCb(x):r&&(this.success[r]=!0)}),v)}remove(){this.errorCb=null}},Ai=Gt.getSessionAPI.bind(Gt),hn=new Set;function Ui(v,r){r?hn.add(v):hn.delete(v)}class pt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,h){this._updatedSourceCaches[r]=h,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const h=r.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(r.id),this.setDirty()}removeLayer(r){const h=r.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][r.id]=r,this._updatedLayers[h].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const h in this._updatedLayers)r[h]=r[h]||{},r[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)r[h]=r[h]||{},r[h].removedIds=Object.keys(this._removedLayers[h]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(t.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ot(v){const{userImage:r}=v;return!!(r&&r.render&&r.render())&&(v.data.replace(new Uint8Array(r.data.buffer)),!0)}class vi extends t.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&t.r()&&(this.imageRasterizerDispatcher=new t.D(t.t(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new t.q({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const h=this.atlasTexture.get(r);h&&(h.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(r.id,r)}removeImageProvider(r,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(r)}getPendingImageProviders(){const r=[];for(const h of this.imageProviders.values())for(const x of h.values())x.hasPendingRequests()&&r.push(x);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new t.x),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,h){if(this.loaded.get(h)!==r&&(this.loaded.set(h,r),r)){for(const{ids:x,callback:E}of this.requestors)this._notify(x,h,E);this.requestors=[]}}hasImage(r,h){return!!this.getImage(r,h)}getImage(r,h){return this.images.get(h).get(r.toString())}addImage(r,h,x){this._validate(r,x)&&this.images.get(h).set(r.toString(),x)}_validate(r,h){let x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new t.y(new Error(`Image "${r.name}" has invalid "stretchX" value`))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new t.y(new Error(`Image "${r.name}" has invalid "stretchY" value`))),x=!1),this._validateContent(h.content,h)||(this.fire(new t.y(new Error(`Image "${r.name}" has invalid "content" value`))),x=!1),x}_validateStretch(r,h){if(!r)return!0;let x=0;for(const E of r){if(E[0]<x||E[1]<E[0]||h<E[1])return!1;x=E[1]}return!0}_validateContent(r,h){return r?r.length!==4||!h.usvg&&(r[0]<0||h.data.width<r[0]||r[1]<0||h.data.height<r[1]||r[2]<0||h.data.width<r[2]||r[3]<0||h.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,h,x){const E=this.images.get(h).get(r.toString());x.version=E.version+1,this.images.get(h).set(r.toString(),x),this.updatedImages.get(h).add(r),this.removeFromImageRasterizerCache(r,h)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,h){this.spriteFormat!=="raster"&&(t.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([r],h))}removeImage(r,h){const x=this.images.get(h),E=x.get(r.toString());x.delete(r.toString()),this.patterns.get(h).delete(r.toString()),this.removeFromImageRasterizerCache(r,h),E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map((h=>t.I.from(h)))}getImages(r,h,x){const E=[],M=[],k=this.imageProviders.get(h);for(const ee of r){if(!ee.iconsetId){E.push(ee);continue}const ce=k.get(ee.iconsetId);ce&&(this.getImage(ee,h)?M.push(ee):ce.addPendingRequest(ee))}if(E.length===0)return void this._notify(M,h,x);let B=!0;const G=!!this.loaded.get(h),J=this.images.get(h);if(!G)for(const ee of E)J.has(ee.toString())||(B=!1);G||B?this._notify(E,h,x):this.requestors.push({ids:E,scope:h,callback:x})}rasterizeImages(r,h){const x=new Map,{tasks:E,scope:M}=r;for(const[k,B]of E.entries()){const G=this.getImage(B.id,M);G&&x.set(k,{image:G,imageVariant:B})}this._rasterizeImages(M,x,h)}_rasterizeImages(r,h,x){if(t.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:r},x);else{const E=new Map;for(const[M,{image:k,imageVariant:B}]of h.entries())E.set(M,this.imageRasterizer.rasterize(B,k,r,0));x(void 0,E)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,h,x){const E=this.images.get(h),M=new Map;for(const k of r){if(!E.get(k.toString())){if(k.iconsetId)continue;this.fire(new t.z("styleimagemissing",{id:k.name}))}const B=E.get(k.toString());if(!B){t.w(`Image "${k.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const G={data:B.usvg?null:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,usvg:B.usvg,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)};B.usvg&&Object.assign(G,{width:B.icon.usvg_tree.width,height:B.icon.usvg_tree.height}),M.set(t.I.toString(k),G)}x(null,M)}getPixelSize(r){const{width:h,height:x}=this.atlasImage.get(r);return{width:h,height:x}}getPattern(r,h,x){const E=r.toString(),M=this.patterns.get(h),k=M.get(E),B=this.getImage(r,h);if(!B)return null;if(k){if(k.position.version===B.version)return k.position;k.position.version=B.version}else{if(B.usvg&&!B.data){const G=this.getPatternInFlightId(E,h);if(this.patternsInFlight.has(G))return null;this.patternsInFlight.add(G);const J=new t.A(r).scaleSelf(t.o.devicePixelRatio),ee=new Map([[J.toString(),{image:B,imageVariant:J}]]);return this._rasterizeImages(h,ee,((ce,le)=>this.storePatternImage(J,h,B,x,le))),null}this.storePattern(r,h,B)}return this._updatePatternAtlas(h,x),M.get(E).position}getPatternInFlightId(r,h){return t.B(r,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,h,x,E,M){const k=r.toString(),B=M?M.get(k):void 0;B&&(x.data=B,this.storePattern(r.id,h,x),this._updatePatternAtlas(h,E),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),h)))}storePattern(r,h,x){const E={w:x.data.width+2*t.C,h:x.data.height+2*t.C,x:0,y:0},M=new t.F(E,x,t.C);this.patterns.get(h).set(r.toString(),{bin:E,position:M})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,h){const x=r.gl;let E=this.atlasTexture.get(h);E?this.dirty&&(E.update(this.atlasImage.get(h)),this.dirty=!1):(E=new t.T(r,this.atlasImage.get(h),x.RGBA8),this.atlasTexture.set(h,E)),E.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(r,h){const x=this.patterns.get(r),E=Array.from(x.values()).map((({bin:J})=>J)),{w:M,h:k}=t.G(E),B=this.atlasImage.get(r);B.resize({width:M||1,height:k||1});const G=this.images.get(r);for(const[J,{bin:ee,position:ce}]of x.entries()){let le=ce.padding;const he=ee.x+le,be=ee.y+le,_e=G.get(J).data,ke=_e.width,Ae=_e.height;le=le>1?le-1:le,t.q.copy(_e,B,{x:0,y:0},{x:he,y:be},{width:ke,height:Ae},h),t.q.copy(_e,B,{x:0,y:Ae-le},{x:he,y:be-le},{width:ke,height:le},h),t.q.copy(_e,B,{x:0,y:0},{x:he,y:be+Ae},{width:ke,height:le},h),t.q.copy(_e,B,{x:ke-le,y:0},{x:he-le,y:be},{width:le,height:Ae},h),t.q.copy(_e,B,{x:0,y:0},{x:he+ke,y:be},{width:le,height:Ae},h),t.q.copy(_e,B,{x:ke-le,y:Ae-le},{x:he-le,y:be-le},{width:le,height:le},h),t.q.copy(_e,B,{x:0,y:Ae-le},{x:he+ke,y:be-le},{width:le,height:le},h),t.q.copy(_e,B,{x:0,y:0},{x:he+ke,y:be+Ae},{width:le,height:le},h),t.q.copy(_e,B,{x:ke-le,y:0},{x:he-le,y:be+Ae},{width:le,height:le},h)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,h){const x=this.images.get(h);for(const E of r){if(this.callbackDispatchedThisFrame.get(h).has(E.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(E.toString());const M=x.get(E.toString());Ot(M)&&this.updateImage(E,h,M)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function qi(v){const r=v.value,h=v.valueSpec,x=v.style,E=v.styleSpec,M=v.key,k=v.arrayElementValidator||mi;if(!Array.isArray(r))return[new t.V(M,r,`array expected, ${t.K(r)} found`)];if(h.length&&r.length!==h.length)return[new t.V(M,r,`array length ${h.length} expected, length ${r.length} found`)];if(h["min-length"]&&r.length<h["min-length"])return[new t.V(M,r,`array length at least ${h["min-length"]} expected, length ${r.length} found`)];let B={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};E.$version<7&&(B.function=h.function),t.H(h.value)&&(B=h.value);let G=[];for(let J=0;J<r.length;J++)G=G.concat(k({array:r,arrayIndex:J,value:r[J],valueSpec:B,style:x,styleSpec:E,key:`${M}[${J}]`},!0));return G}function on(v){const r=v.key,h=v.value,x=v.valueSpec;if(!t.L(h))return[new t.V(r,h,`number expected, ${t.K(h)} found`)];if(h!=h)return[new t.V(r,h,"number expected, NaN found")];if("minimum"in x){let E=x.minimum;if(Array.isArray(x.minimum)&&(E=x.minimum[v.arrayIndex]),h<E)return[new t.V(r,h,`${h} is less than the minimum value ${E}`)]}if("maximum"in x){let E=x.maximum;if(Array.isArray(x.maximum)&&(E=x.maximum[v.arrayIndex]),h>E)return[new t.V(r,h,`${h} is greater than the maximum value ${E}`)]}return[]}function Hi(v){const r=v.key,h=v.value;if(!t.H(h))return[new t.V(r,h,`object expected, ${t.K(h)} found`)];const x=v.valueSpec,E=t.J(h.type);let M,k,B,G={};const J=E!=="categorical"&&h.property===void 0,ee=!J,ce=(function(_e){const ke=_e.stops;return Array.isArray(ke)&&Array.isArray(ke[0])&&t.H(ke[0][0])})(h),le=bs({key:v.key,value:v.value,valueSpec:v.styleSpec.function,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{stops:function(_e){if(E==="identity")return[new t.V(_e.key,_e.value,'identity function may not have a "stops" property')];let ke=[];const Ae=_e.value;return ke=ke.concat(qi({key:_e.key,value:Ae,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:he})),Array.isArray(Ae)&&Ae.length===0&&ke.push(new t.V(_e.key,Ae,"array must have at least one stop")),ke},default:function(_e){return mi({key:_e.key,value:_e.value,valueSpec:x,style:_e.style,styleSpec:_e.styleSpec})}}});return E==="identity"&&J&&le.push(new t.V(v.key,v.value,'missing required property "property"')),E==="identity"||h.stops||le.push(new t.V(v.key,v.value,'missing required property "stops"')),E==="exponential"&&x.expression&&!t.M(x)&&le.push(new t.V(v.key,v.value,"exponential functions not supported")),v.styleSpec.$version>=8&&(ee&&!t.N(x)?le.push(new t.V(v.key,v.value,"property functions not supported")):J&&!t.O(x)&&le.push(new t.V(v.key,v.value,"zoom functions not supported"))),E!=="categorical"&&!ce||h.property!==void 0||le.push(new t.V(v.key,v.value,'"property" property is required')),le;function he(_e){let ke=[];const Ae=_e.value,Oe=_e.key;if(!Array.isArray(Ae))return[new t.V(Oe,Ae,`array expected, ${t.K(Ae)} found`)];if(Ae.length!==2)return[new t.V(Oe,Ae,`array length 2 expected, length ${Ae.length} found`)];if(ce){if(!t.H(Ae[0]))return[new t.V(Oe,Ae,`object expected, ${t.K(Ae[0])} found`)];const He=Ae[0];if(He.zoom===void 0)return[new t.V(Oe,Ae,"object stop key must have zoom")];if(He.value===void 0)return[new t.V(Oe,Ae,"object stop key must have value")];const Be=t.J(He.zoom);if(typeof Be!="number")return[new t.V(Oe,He.zoom,"stop zoom values must be numbers")];if(B&&B>Be)return[new t.V(Oe,He.zoom,"stop zoom values must appear in ascending order")];Be!==B&&(B=Be,k=void 0,G={}),ke=ke.concat(bs({key:`${Oe}[0]`,value:Ae[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:on,value:be}}))}else ke=ke.concat(be({key:`${Oe}[0]`,value:Ae[0],style:_e.style,styleSpec:_e.styleSpec},Ae));return t.Q(t.S(Ae[1]))?ke.concat([new t.V(`${Oe}[1]`,Ae[1],"expressions are not allowed in function stops.")]):ke.concat(mi({key:`${Oe}[1]`,value:Ae[1],valueSpec:x,style:_e.style,styleSpec:_e.styleSpec}))}function be(_e,ke){const Ae=t.K(_e.value),Oe=t.J(_e.value),He=_e.value!==null?_e.value:ke;if(M){if(Ae!==M)return[new t.V(_e.key,He,`${Ae} stop domain type must match previous stop domain type ${M}`)]}else M=Ae;if(Ae!=="number"&&Ae!=="string"&&Ae!=="boolean"&&typeof Oe!="number"&&typeof Oe!="string"&&typeof Oe!="boolean")return[new t.V(_e.key,He,"stop domain value must be a number, string, or boolean")];if(Ae!=="number"&&E!=="categorical"){let Be=`number expected, ${Ae} found`;return t.N(x)&&E===void 0&&(Be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(_e.key,He,Be)]}return E!=="categorical"||Ae!=="number"||typeof Oe=="number"&&isFinite(Oe)&&Math.floor(Oe)===Oe?E!=="categorical"&&Ae==="number"&&typeof Oe=="number"&&typeof k=="number"&&k!==void 0&&Oe<k?[new t.V(_e.key,He,"stop domain values must appear in ascending order")]:(k=Oe,E==="categorical"&&Oe in G?[new t.V(_e.key,He,"stop domain values must be unique")]:(G[Oe]=!0,[])):[new t.V(_e.key,He,`integer expected, found ${String(Oe)}`)]}}function Bt(v){const r=(v.expressionContext==="property"?t.W:t.U)(t.S(v.value),v.valueSpec);if(r.result==="error")return r.value.map((x=>new t.V(`${v.key}${x.key}`,v.value,x.message)));const h=r.value.expression||r.value._styleExpression.expression;if(v.expressionContext==="property"&&v.propertyKey==="text-font"&&!h.outputDefined())return[new t.V(v.key,v.value,`Invalid data expression for "${v.propertyKey}". Output values must be contained as literals within the expression.`)];if(v.expressionContext==="property"&&v.propertyType==="layout"&&!t.Z(h))return[new t.V(v.key,v.value,'"feature-state" data expressions are not supported with layout properties.')];if(v.expressionContext==="filter")return Ii(h,v);if(v.expressionContext==="appearance")return qt(h,v);if(v.expressionContext&&v.expressionContext.indexOf("cluster")===0){if(!t.X(h,["zoom","feature-state"]))return[new t.V(v.key,v.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(v.expressionContext==="cluster-initial"&&!t.Y(h))return[new t.V(v.key,v.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ii(v,r){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const E of r.valueSpec.expression.parameters)h.delete(E);if(h.size===0)return[];const x=[];return v instanceof t._&&h.has(v.name)?[new t.V(r.key,r.value,`["${v.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(v.eachChild((E=>{x.push(...Ii(E,r))})),x)}function qt(v,r){const h=new Set;if(r.valueSpec&&r.valueSpec.expression)for(const E of r.valueSpec.expression.parameters)h.add(E);if(h.size===0)return[];const x=[];return v instanceof t._&&!h.has(v.name)?[new t.V(r.key,r.value,`["${v.name}"] is not an allowed parameter`)]:(v.eachChild((E=>{x.push(...qt(E,r))})),x)}function Ne(v){const r=v.key,h=v.value,x=v.valueSpec,E=[];return Array.isArray(x.values)?x.values.indexOf(t.J(h))===-1&&E.push(new t.V(r,h,`expected one of [${x.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(x.values).indexOf(t.J(h))===-1&&E.push(new t.V(r,h,`expected one of [${Object.keys(x.values).join(", ")}], ${JSON.stringify(h)} found`)),E}function Ge(v){return t.a2(t.S(v.value))?Bt(Object.assign({},v,{expressionContext:"filter",valueSpec:v.styleSpec[`filter_${v.layerType||"fill"}`]})):Ke(v)}function Ke(v){const r=v.value,h=v.key;if(!Array.isArray(r))return[new t.V(h,r,`array expected, ${t.K(r)} found`)];if(r.length<1)return[new t.V(h,r,"filter array must have at least 1 element")];const x=v.styleSpec;let E=Ne({key:`${h}[0]`,value:r[0],valueSpec:x.filter_operator});const M=()=>{r.length>=2&&(t.a0(r[1])||E.push(new t.V(`${h}[1]`,r[1],`string expected, ${t.K(r[1])} found`)));for(let k=2;k<r.length;k++)t.J(r[1])==="$type"?E=E.concat(Ne({key:`${h}[${k}]`,value:r[k],valueSpec:x.geometry_type})):t.a0(r[k])||t.L(r[k])||t.$(r[k])||E.push(new t.V(`${h}[${k}]`,r[k],`string, number, or boolean expected, ${t.K(r[k])} found.`))};switch(t.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&t.J(r[1])==="$type"&&E.push(new t.V(h,r,`"$type" cannot be use with operator "${r[0]}"`)),r.length!==3&&E.push(new t.V(h,r,`filter array for operator "${r[0]}" must have 3 elements`)),M();break;case"==":case"!=":r.length!==3&&E.push(new t.V(h,r,`filter array for operator "${r[0]}" must have 3 elements`)),M();break;case"in":case"!in":M();break;case"any":case"all":case"none":for(let k=1;k<r.length;k++)E=E.concat(Ke({key:`${h}[${k}]`,value:r[k],style:v.style,styleSpec:v.styleSpec}));break;case"has":case"!has":r.length!==2?E.push(new t.V(h,r,`filter array for "${r[0]}" operator must have 2 elements`)):t.a0(r[1])||E.push(new t.V(`${h}[1]`,r[1],`string expected, ${t.K(r[1])} found`))}return E}function At(v,r){const h=v.key,x=v.style,E=v.layer,M=v.styleSpec,k=v.value,B=v.objectKey,G=M[`${r}_${v.layerType}`];if(!G)return[];const J=B.match(/^(.*)-use-theme$/);if(J&&G[J[1]])return t.Q(t.S(k))?[].concat(mi({key:h,value:k,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:x,styleSpec:M,expressionContext:"property",propertyType:r,propertyKey:B})):mi({key:h,value:k,valueSpec:{type:"string"},style:x,styleSpec:M});const ee=B.match(/^(.*)-transition$/);if(r==="paint"&&ee&&G[ee[1]]&&G[ee[1]].transition)return mi({key:h,value:k,valueSpec:M.transition,style:x,styleSpec:M});const ce=v.valueSpec||G[B];if(!ce)return[new t.a3(h,k,`unknown property "${B}"`)];let le;if(t.a0(k)&&t.N(ce)&&!ce.tokens&&(le=/^{([^}]+)}$/.exec(k))){const be=`\`{ "type": "identity", "property": ${le?JSON.stringify(le[1]):'"_"'} }\``;return[new t.V(h,k,`"${B}" does not support interpolation syntax
Use an identity property function instead: ${be}.`)]}const he=[];if(v.layerType==="symbol")B!=="text-field"||!x||x.glyphs||x.imports||he.push(new t.V(h,k,'use of "text-field" requires a style "glyphs" property')),B==="text-font"&&t.a4(t.S(k))&&t.J(k.type)==="identity"&&he.push(new t.V(h,k,'"text-font" does not support identity functions'));else if(v.layerType==="model"&&r==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&t.N(ce)&&(t.a5(ce)||t.O(ce))){const be=t.W(t.S(k),ce).value,_e="expression"in be&&be.expression||"_styleExpression"in be&&be._styleExpression&&be._styleExpression.expression;_e&&!t.X(_e,["measure-light"])&&(B==="model-emissive-strength"&&t.Y(_e)&&t.Z(_e)||he.push(new t.V(h,k,`${B} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return he.concat(mi({key:v.key,value:k,valueSpec:ce,style:x,styleSpec:M,expressionContext:"property",propertyType:r,propertyKey:B}))}function jt(v){return At(v,"paint")}function bi(v){return At(v,"layout")}function gi(v){let r=[];const h=v.value,x=v.key,E=v.style,M=v.styleSpec;if(!t.H(h))return[new t.V(x,h,"object expected")];h.type||h.ref||r.push(new t.V(x,h,'either "type" or "ref" is required'));let k=t.J(h.type);const B=t.J(h.ref);if(h.id){const G=t.J(h.id);for(let J=0;J<v.arrayIndex;J++){const ee=E.layers[J];t.J(ee.id)===G&&r.push(new t.V(x,h.id,`duplicate layer id "${G}", previously used at line ${ee.id.__line__}`))}}if("ref"in h){let G;["type","source","source-layer","filter","layout"].forEach((J=>{J in h&&r.push(new t.V(x,h[J],`"${J}" is prohibited for ref layers`))})),E.layers.forEach((J=>{t.J(J.id)===B&&(G=J)})),G?G.ref?r.push(new t.V(x,h.ref,"ref cannot reference another ref layer")):k=t.J(G.type):typeof B=="string"&&r.push(new t.V(x,h.ref,`ref layer "${B}" not found`))}else if(k!=="background"&&k!=="sky"&&k!=="slot")if(h.source)if(t.a0(h.source)){const G=E.sources&&E.sources[h.source],J=G&&t.J(G.type);G?J==="vector"&&k==="raster"?r.push(new t.V(x,h.source,`layer "${h.id}" requires a raster source`)):J==="raster"&&k!=="raster"?r.push(new t.V(x,h.source,`layer "${h.id}" requires a vector source`)):J!=="vector"||h["source-layer"]?J==="raster-dem"&&k!=="hillshade"?r.push(new t.V(x,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):J!=="raster-array"||["raster","raster-particle"].includes(k)?k==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&J==="geojson"&&!G.lineMetrics?r.push(new t.V(x,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):k==="raster-particle"&&J!=="raster-array"&&r.push(new t.V(x,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):r.push(new t.V(x,h.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new t.V(x,h,`layer "${h.id}" must specify a "source-layer"`)):r.push(new t.V(x,h.source,`source "${h.source}" not found`))}else r.push(new t.V(`${x}.source`,h.source,'"source" must be a string'));else r.push(new t.V(x,h,'missing required property "source"'));return r=r.concat(bs({key:x,value:h,valueSpec:M.layer,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mi({key:`${x}.type`,value:h.type,valueSpec:M.layer.type,style:v.style,styleSpec:v.styleSpec,object:h,objectKey:"type"}),filter:G=>Ge(Object.assign({layerType:k},G)),layout:G=>bs({layer:h,key:G.key,value:G.value,valueSpec:{},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{"*":J=>bi(Object.assign({layerType:k},J))}}),paint:G=>bs({layer:h,key:G.key,value:G.value,valueSpec:{},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{"*":J=>jt(Object.assign({layerType:k,layer:h},J))}}),appearances(G){const J=qi({key:G.key,value:G.value,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:le=>(function(he){const{key:be,layer:_e,layerType:ke}=he,Ae=t.J(he.value),Oe=t.J(Ae.name),He=t.J(Ae.condition),Be=bs({key:be,value:Ae,valueSpec:he.styleSpec.appearance,style:he.style,styleSpec:he.styleSpec,objectElementValidators:{condition:dt=>(function(nt){const at=[];return at.push(...Bt({key:nt.key,value:nt.object.condition,valueSpec:t.a6.appearance.condition,expressionContext:"appearance"})),at})(Object.assign({layer:_e,layerType:ke},dt)),properties:dt=>(function(nt){const at=[],{styleSpec:tt,layer:Je,layerType:mt}=nt,Pt=tt[`paint_${mt}`],It=tt[`layout_${mt}`],ri=nt.object[nt.objectKey];for(const si in ri){const _i=si in Pt?"paint":si in It?"layout":void 0;if(!_i){at.push(new t.V(nt.key,si,`unknown property "${si}" for layer type "${mt}"`));continue}const Vi=Object.assign({},nt,{key:`${nt.key}.${si}`,object:ri,objectKey:si,layer:Je,layerType:mt,value:ri[si],valueSpec:_i==="paint"?Pt[si]:It[si]});at.push(...At(Vi,_i))}return at})(Object.assign({layer:_e,layerType:ke},dt))}});return Oe!=="hidden"&&He===void 0&&Be.push(new t.V(he.key,"name",'Appearance with name different than "hidden" must have a condition')),Be})(Object.assign({layerType:k,layer:h},le))}),ee=Array.isArray(G.value)?G.value:[],ce=new Set;return ee.forEach(((le,he)=>{const be=t.J(le.name);if(be)if(ce.has(be)){const _e=t.J(h.id);J.push(new t.V(G.key,be,`Duplicated appearance name "${be}" for layer "${_e}"`))}else ce.add(be)})),J}}})),r}function ii({key:v,value:r}){return t.a0(r)?[]:[new t.V(v,r,`string expected, ${t.K(r)} found`)]}const Ci={promoteId:function v({key:r,value:h}){if(t.a0(h))return ii({key:r,value:h});if(Array.isArray(h)){const E=[],M=t.S(h),k=t.U(M);return k.result==="error"&&k.value.forEach((B=>{E.push(new t.V(`${r}${B.key}`,null,`${B.message}`))})),t.X(k.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||E.push(new t.V(`${r}`,null,"promoteId expression should be only feature dependent")),E}if(!t.H(h))return[new t.V(r,h,`string, expression or object expected, "${t.K(h)}" found`)];const x=[];for(const E in h)x.push(...v({key:`${r}.${E}`,value:h[E]}));return x}};function un(v){const r=v.value,h=v.key,x=v.styleSpec,E=v.style;if(!t.H(r))return[new t.V(h,r,`object expected, ${t.K(r)} found`)];if(!("type"in r))return[new t.V(h,r,'"type" is required')];const M=t.J(r.type);let k=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&("url"in r||"tiles"in r||k.push(new t.a3(h,r,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return k=k.concat(bs({key:h,value:r,valueSpec:x[`source_${M.replace("-","_")}`],style:v.style,styleSpec:x,objectElementValidators:Ci})),k;case"geojson":if(k=bs({key:h,value:r,valueSpec:x.source_geojson,style:E,styleSpec:x,objectElementValidators:Ci}),"cluster"in r&&"clusterProperties"in r){if(!t.H(r.clusterProperties))return[new t.V(`${h}.clusterProperties`,r,`object expected, ${t.K(r)} found`)];for(const B in r.clusterProperties){const G=r.clusterProperties[B];if(!Array.isArray(G))return[new t.V(`${h}.clusterProperties.${B}`,G,"array expected")];const[J,ee]=G,ce=typeof J=="string"?[J,["accumulated"],["get",B]]:J;k.push(...Bt({key:`${h}.${B}.map`,value:ee,expressionContext:"cluster-map"})),k.push(...Bt({key:`${h}.${B}.reduce`,value:ce,expressionContext:"cluster-reduce"}))}}return k;case"video":return bs({key:h,value:r,valueSpec:x.source_video,style:E,styleSpec:x});case"image":return bs({key:h,value:r,valueSpec:x.source_image,style:E,styleSpec:x});case"canvas":return[new t.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ne({key:`${h}.type`,value:r.type,valueSpec:{values:nn(x)}})}}function nn(v){return v.source.reduce(((r,h)=>{const x=v[h];return x.type.type==="enum"&&(r=r.concat(Object.keys(x.type.values||{}))),r}),[])}function Zn(v){const r=v.value,h=v.styleSpec,x=h.light,E=v.style;if(r===void 0)return[];if(!t.H(r))return[new t.V("light",r,`object expected, ${t.K(r)} found`)];let M=[];for(const k in r){const B=k.match(/^(.*)-transition$/),G=k.match(/^(.*)-use-theme$/);M=M.concat(G&&x[G[1]]?mi({key:k,value:r[k],valueSpec:{type:"string"},style:E,styleSpec:h}):B&&x[B[1]]&&x[B[1]].transition?mi({key:k,value:r[k],valueSpec:h.transition,style:E,styleSpec:h}):x[k]?mi({key:k,value:r[k],valueSpec:x[k],style:E,styleSpec:h}):[new t.V(k,r[k],`unknown property "${k}"`)])}return M}function fr(v){const r=v.value;if(!r)return[];const h=v.key;if(!t.H(r))return[new t.V(h,r,`object expected, ${t.K(r)} found`)];let x=[];const E=v.styleSpec,M=E["light-3d"],k=v.style,B=v.style.lights;for(const ee of["type","id"])if(!(ee in r))return x=x.concat([new t.V(h,r,`missing property "${ee}"`)]),x;if(!t.a0(r.type))return x=x.concat([new t.V(`${h}.type`,r.type,"string expected")]),x;if(B)for(let ee=0;ee<v.arrayIndex;ee++){const ce=t.J(r.type),le=B[ee];t.J(le.type)===ce&&x.push(new t.V(h,r.id,`duplicate light type "${r.type}", previously defined at line ${le.id.__line__}`))}const G=`properties_light_${r.type}`;if(!(G in E))return x=x.concat([new t.V(`${h}.type`,r,`Invalid light type ${r.type}`)]),x;const J=E[G];for(const ee in r)if(ee==="properties"){const ce=r[ee];if(!t.H(ce))return x=x.concat([new t.V("properties",ce,`object expected, ${t.K(ce)} found`)]),x;for(const le in ce){const he=le.match(/^(.*)-transition$/),be=le.match(/^(.*)-use-theme$/);x=x.concat(be&&J[be[1]]?mi({key:ee,value:ce[le],valueSpec:{type:"string"},style:k,styleSpec:E}):he&&J[he[1]]&&J[he[1]].transition?mi({key:ee,value:r[ee],valueSpec:E.transition,style:k,styleSpec:E}):J[le]?mi({key:le,value:ce[le],valueSpec:J[le],style:k,styleSpec:E}):[new t.a3(v.key,ce[le],`unknown property "${le}"`)])}}else x=x.concat(M[ee]?mi({key:ee,value:r[ee],valueSpec:M[ee],style:k,styleSpec:E}):[new t.a3(ee,r[ee],`unknown property "${ee}"`)]);return x}function Gr(v){const r=v.value,h=v.key,x=v.style,E=v.styleSpec,M=E.terrain;if(r==null)return[];if(!t.H(r))return[new t.V("terrain",r,`object expected, ${t.K(r)} found`)];let k=[];for(const B in r){const G=B.match(/^(.*)-transition$/),J=B.match(/^(.*)-use-theme$/);k=k.concat(J&&M[J[1]]?mi({key:B,value:r[B],valueSpec:{type:"string"},style:x,styleSpec:E}):G&&M[G[1]]&&M[G[1]].transition?mi({key:B,value:r[B],valueSpec:E.transition,style:x,styleSpec:E}):M[B]?mi({key:B,value:r[B],valueSpec:M[B],style:x,styleSpec:E}):[new t.a3(B,r[B],`unknown property "${B}"`)])}if(r.source)if(t.a0(r.source)){const B=x.sources&&x.sources[r.source],G=B&&t.J(B.type);B?G!=="raster-dem"&&k.push(new t.V(`${h}.source`,r.source,`terrain cannot be used with a source of type ${G}, it only be used with a "raster-dem" source type`)):k.push(new t.V(`${h}.source`,r.source,`source "${r.source}" not found`))}else k.push(new t.V(`${h}.source`,r.source,"source must be a string"));else k.push(new t.V(h,r,'terrain is missing required property "source"'));return k}function xo(v){const r=v.value,h=v.style,x=v.styleSpec,E=x.fog;if(r===void 0)return[];if(!t.H(r))return[new t.V("fog",r,`object expected, ${t.K(r)} found`)];let M=[];for(const k in r){const B=k.match(/^(.*)-transition$/),G=k.match(/^(.*)-use-theme$/);M=M.concat(G&&E[G[1]]?mi({key:k,value:r[k],valueSpec:{type:"string"},style:h,styleSpec:x}):B&&E[B[1]]&&E[B[1]].transition?mi({key:k,value:r[k],valueSpec:x.transition,style:h,styleSpec:x}):E[k]?mi({key:k,value:r[k],valueSpec:E[k],style:h,styleSpec:x}):[new t.a3(k,r[k],`unknown property "${k}"`)])}return M}const Js={"*":()=>[],array:qi,boolean:function(v){const r=v.value,h=v.key;return t.$(r)?[]:[new t.V(h,r,`boolean expected, ${t.K(r)} found`)]},number:on,color:function({key:v,value:r}){return t.a0(r)?t.a1.parseCSSColor(r)===null?[new t.V(v,r,`color expected, "${r}" found`)]:[]:[new t.V(v,r,`color expected, ${t.K(r)} found`)]},enum:Ne,filter:Ge,function:Hi,layer:gi,object:bs,source:un,model:t.a7,light:Zn,"light-3d":fr,terrain:Gr,fog:xo,string:ii,formatted:function(v){return ii(v).length===0?[]:Bt(v)},resolvedImage:function(v){return ii(v).length===0?[]:Bt(v)},projection:function(v){const r=v.value,h=v.styleSpec,x=h.projection,E=v.style;if(t.H(r)){let M=[];for(const k in r)M=M.concat(mi({key:k,value:r[k],valueSpec:x[k],style:E,styleSpec:h}));return M}return t.a0(r)?[]:[new t.V("projection",r,`object or string expected, ${t.K(r)} found`)]},import:function(v){const r=v.key,{value:h,styleSpec:x}=v;if(!t.H(h))return[new t.V(r,h,"import must be an object")];const{data:E,...M}=h;Object.defineProperty(M,"__line__",{value:h.__line__,enumerable:!1});let k=bs(Object.assign({},v,{value:M,valueSpec:x.import}));return t.J(M.id)===""&&k.push(new t.V(`${v.key}.id`,M,"import id can't be an empty string")),E&&(k=k.concat(is(E,x,{key:`${v.key}.data`}))),k},iconset:function(v){const r=v.value,h=v.key,x=v.styleSpec,E=v.style;if(!t.H(r))return[new t.V(h,r,"object expected")];if(!r.type)return[new t.V(h,r,'"type" is required')];const M=t.J(r.type);let k=[];if(k=k.concat(bs({key:h,value:r,valueSpec:x[`iconset_${M}`],style:E,styleSpec:x})),(function(B,G){return!(B!=="source"||!G.source)})(M,r)){const B=E.sources&&E.sources[r.source],G=B&&t.J(B.type);B?G!=="raster-array"&&k.push(new t.V(h,r.source,`iconset cannot be used with a source of type ${String(G)}, it only be used with a "raster-array" source type`)):k.push(new t.V(h,r.source,`source "${r.source}" not found`))}return k}};function mi(v,r=!1){const h=v.value,x=v.valueSpec,E=v.styleSpec;if(x.expression){if(t.a4(t.J(h)))return Hi(v);if(t.Q(t.S(h)))return Bt(v)}if(x.type&&Js[x.type]){const M=Js[x.type](v);return r===!0&&M.length>0&&Array.isArray(v.value)?Bt(v):M}return bs(Object.assign({},v,{valueSpec:x.type?E[x.type]:x}))}function bs(v){const r=v.key,h=v.value,x=v.valueSpec||{},E=v.objectElementValidators||{},M=v.style,k=v.styleSpec;if(!t.H(h))return[new t.V(r,h,`object expected, ${t.K(h)} found`)];let B=[];for(const G in h){const J=G.split(".")[0];let ee;E[J]?ee=E[J]:x[J]?ee=mi:E["*"]?ee=E["*"]:x["*"]&&(ee=mi),ee?B=B.concat(ee({key:(r&&`${r}.`)+G,value:h[G],valueSpec:x[J]||x["*"],style:M,styleSpec:k,object:h,objectKey:G},h)):B.push(new t.a3(r,h[G],`unknown property "${G}"`))}for(const G in x){if(E[G])continue;const J=x[G];J.required&&J.default===void 0&&h[G]===void 0&&B.push(new t.V(r,h,`missing required property "${G}"`))}return B}function al({key:v,value:r}){const h=ii({key:v,value:r});if(h.length)return h;const x=r;return x.indexOf("{fontstack}")===-1&&h.push(new t.V(v,r,'"glyphs" url must include a "{fontstack}" token')),x.indexOf("{range}")===-1&&h.push(new t.V(v,r,'"glyphs" url must include a "{range}" token')),h}function is(v,r=t.a6,h={}){return bs({key:h.key||"",value:v,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:v,objectElementValidators:{glyphs:al}})}function Hs(v,r=t.a6){return Ie(is(v,r))}const ll=v=>Ie(un(v)),yi=v=>Ie(Zn(v)),Ao=v=>Ie(fr(v)),Bo=v=>Ie(Gr(v)),sa=v=>Ie(xo(v)),ns=v=>Ie((function(r){const h=r.value,x=r.style,E=r.styleSpec,M=E.snow;if(h===void 0)return[];if(!t.H(h))return[new t.V("snow",h,`object expected, ${t.K(h)} found`)];let k=[];for(const B in h){const G=B.match(/^(.*)-transition$/);k=k.concat(G&&M[G[1]]&&M[G[1]].transition?mi({key:B,value:h[B],valueSpec:E.transition,style:x,styleSpec:E}):M[B]?mi({key:B,value:h[B],valueSpec:M[B],style:x,styleSpec:E}):[new t.a3(B,h[B],`unknown property "${B}"`)])}return k})(v)),Ja=v=>Ie((function(r){const h=r.value,x=r.style,E=r.styleSpec,M=E.rain;if(h===void 0)return[];if(!t.H(h))return[new t.V("rain",h,`object expected, ${t.K(h)} found`)];let k=[];for(const B in h){const G=B.match(/^(.*)-transition$/);k=k.concat(G&&M[G[1]]&&M[G[1]].transition?mi({key:B,value:h[B],valueSpec:E.transition,style:x,styleSpec:E}):M[B]?mi({key:B,value:h[B],valueSpec:M[B],style:x,styleSpec:E}):[new t.a3(B,h[B],`unknown property "${B}"`)])}return k})(v)),Mn=v=>Ie(gi(v)),Qa=v=>Ie(Ge(v)),gl=v=>Ie(jt(v)),Nt=v=>Ie(bi(v)),we=v=>Ie(t.a7(v));function Ie(v){return v.slice().sort(((r,h)=>r.line&&h.line?r.line-h.line:0))}function qe(v,r){let h=!1;if(r&&r.length)for(const x of r)x instanceof t.a3?t.w(x.message):(v.fire(new t.y(new Error(x.message))),h=!0);return h}const ot=t.a6.light;let ft;class Ct extends t.E{constructor(r,h="flat"){super(),this._transitionable=new t.a8(ft||(ft=new t.a9({anchor:new t.aa(ot.anchor),position:new t.ab(ot.position),color:new t.aa(ot.color),intensity:new t.aa(ot.intensity)}))),this.setLight(r,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h,x={}){this._validate(yi,r,x)||(this._transitionable.setTransitionOrValue(r),this.id=h)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,x){return(!x||x.validate!==!1)&&qe(this,r.call(Hs,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.a6})))}}const Jt=t.a6.terrain;let _t=class extends t.E{constructor(v,r,h,x,E){super(),this.scope=h,this._transitionable=new t.a8(new t.a9({source:new t.aa(Jt.source),exaggeration:new t.aa(Jt.exaggeration)}),h,x),this._transitionable.setTransitionOrValue(v,x),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=E}get(){return this._transitionable.serialize()}set(v,r){this._transitionable.setTransitionOrValue(v,r)}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}getExaggeration(v){return this._transitioning.possiblyEvaluate(new t.ac(v,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const v=this._transitionable._values.exaggeration;if(!v)return null;const r=v.value.expression;if(!r)return null;let h=-1,x=-1,E=1;for(const M of r.zoomStops)E=r.evaluate(new t.ac(M,{worldview:this.worldview})),E>.01?(h=M,x=-1):x=M;return E<.01&&h>0&&x>h?[h,x]:null}isZoomDependent(){const v=this._transitionable._values.exaggeration;return v!=null&&v.value!=null&&v.value.expression!=null&&v.value.expression instanceof t.ad}};const Qt=45,Ri=65,xi=.05;function yn(v,r,h,x){const E=t.ah(Qt,Ri,h),[M,k]=$n(v,x);let B=1-Math.min(1,Math.exp((r-M)/(k-M)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*E*v.alpha}function $n(v,r){const h=.5/Math.tan(.5*r);return[v.range[0]+h,v.range[1]+h]}function mn(v,r,h,x,E){const M=t.af([],[r,h,x],E.mercatorFogMatrix);return yn(v,t.ag(M),E.pitch,E._fov)}function Tr(v,r,h,x,E,M,k){const B=[[h,x,0],[E,x,0],[E,M,0],[h,M,0]];let G=Number.MAX_VALUE,J=-Number.MAX_VALUE;for(const ee of B){const ce=t.af([],ee,r),le=t.ag(ce);G=Math.min(G,le),J=Math.max(J,le)}return[yn(v,G,k.pitch,k._fov),yn(v,J,k.pitch,k._fov)]}const rr=t.a6.fog;class jn extends t.E{constructor(r,h,x,E){super();const M=new t.a9({range:new t.aa(rr.range),color:new t.aa(rr.color),"color-use-theme":new t.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new t.aa(rr["high-color"]),"high-color-use-theme":new t.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new t.aa(rr["space-color"]),"space-color-use-theme":new t.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new t.aa(rr["horizon-blend"]),"star-intensity":new t.aa(rr["star-intensity"]),"vertical-range":new t.aa(rr["vertical-range"])});this._transitionable=new t.a8(M,x,new Map(E)),this.set(r,E),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new t.ai(M),this.scope=x}get state(){const r=this._transform,h=r.projection.name==="globe",x=t.aj(r.zoom),E=this.properties.get("range"),M=[.5,3];return{range:h?[t.ak(M[0],E[0],x),t.ak(M[1],E[1],x)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,h,x={}){if(this._validate(sa,r,x))return;const E=Object.assign({},r);for(const M of Object.keys(rr))E[M]===void 0&&(E[M]=rr[M].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.ah(Qt,Ri,r))*h.a}getOpacityAtLatLng(r,h){return this._transform.projection.supportsFog?(function(x,E,M){const k=t.ae.fromLngLat(E),B=M.elevation?M.elevation.getAtPointOrZero(k):0;return mn(x,k.x,k.y,B,M)})(this.state,r,h):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Tr(this.state,h,0,0,t.al,t.al,this._transform)}getOpacityForBounds(r,h,x,E,M){return this._transform.projection.supportsFog?Tr(this.state,r,h,x,E,M,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?$n(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const x of h){const E=r.points[x];let M;if(E[2]>=0)M=E;else{const k=r.points[x-4];M=t.am(k,E,k[2]/(k[2]-E[2]))}if(mn(this.state,M[0],M[1],0,this._transform)>=xi)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,x){return(!x||x.validate!==!1)&&qe(this,r.call(Hs,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:t.a6})))}}let Kr,io,No,oo,po=class extends t.E{constructor(v,r,h,x){super();const E=Kr||(Kr=new t.a9({density:new t.aa(t.a6.snow.density),intensity:new t.aa(t.a6.snow.intensity),color:new t.aa(t.a6.snow.color),opacity:new t.aa(t.a6.snow.opacity),vignette:new t.aa(t.a6.snow.vignette),"vignette-color":new t.aa(t.a6.snow["vignette-color"]),"center-thinning":new t.aa(t.a6.snow["center-thinning"]),direction:new t.aa(t.a6.snow.direction),"flake-size":new t.aa(t.a6.snow["flake-size"])}));this._transitionable=new t.a8(E,h,new Map(x)),this.set(v,x),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ai(E),this.scope=h}get state(){const v=this.properties.get("opacity"),r=this.properties.get("color"),h=this.properties.get("direction"),x=t.an(h[0]),E=-Math.max(t.an(h[1]),.01),M=[Math.cos(x)*Math.cos(E),Math.sin(x)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette"),B=this.properties.get("vignette-color");return B.a=k,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.ao(r.r,r.g,r.b,r.a*v),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:B}}get(){return this._transitionable.serialize()}set(v,r,h={}){if(this._validate(ns,v,h))return;const x=Object.assign({},v),E=t.a6.snow;for(const M of Object.keys(E))x[M]===void 0&&(x[M]=E[M].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,r,h){return(!h||h.validate!==!1)&&qe(this,v.call(Hs,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.a6})))}},go=class extends t.E{constructor(v,r,h,x){super();const E=io||(io=new t.a9({density:new t.aa(t.a6.rain.density),intensity:new t.aa(t.a6.rain.intensity),color:new t.aa(t.a6.rain.color),opacity:new t.aa(t.a6.rain.opacity),vignette:new t.aa(t.a6.rain.vignette),"vignette-color":new t.aa(t.a6.rain["vignette-color"]),"center-thinning":new t.aa(t.a6.rain["center-thinning"]),direction:new t.aa(t.a6.rain.direction),"droplet-size":new t.aa(t.a6.rain["droplet-size"]),"distortion-strength":new t.aa(t.a6.rain["distortion-strength"])}));this._transitionable=new t.a8(E,h,new Map(x)),this.set(v,x),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ai(E),this.scope=h}get state(){const v=this.properties.get("opacity"),r=this.properties.get("color"),h=this.properties.get("direction"),x=t.an(h[0]),E=-Math.max(t.an(h[1]),.01),M=[Math.cos(x)*Math.cos(E),Math.sin(x)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette-color");return k.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.ao(r.r,r.g,r.b,r.a*v),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:k}}get(){return this._transitionable.serialize()}set(v,r,h={}){if(this._validate(Ja,v,h))return;const x=Object.assign({},v),E=t.a6.rain;for(const M of Object.keys(E))x[M]===void 0&&(x[M]=E[M].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,r,h){return(!h||h.validate!==!1)&&qe(this,v.call(Hs,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.a6})))}};class Wr extends t.E{constructor(r,h,x,E){super(),this.scope=x,this._options=r,this.properties=new t.ai(h),this._transitionable=new t.a8(h,x,new Map(E)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,h){this._options=r,this._transitionable.setTransitionOrValue(r.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ao{constructor(r,h,x){this.screenBounds=r,this.cameraPoint=x.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,h){let x,E;if(r instanceof t.P||typeof r[0]=="number"){const M=t.P.convert(r);x=[M],E=h.isPointAboveHorizon(M)}else{const M=t.P.convert(r[0]),k=t.P.convert(r[1]),B=M.add(k)._div(2);x=[M,k],E=t.aq(M,k).every((G=>h.isPointAboveHorizon(G)))&&h.isPointAboveHorizon(B)}return new ao(x,E,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return t.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],E=t.aq(h,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<x.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?E[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(E[3]=this.cameraPoint)),t.ar(E,r)}bufferedCameraGeometryGlobe(r){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],E=t.aq(h,x,r),M=this.cameraPoint.clone();switch(3*((M.y>h.y)+(M.y>x.y))+((M.x>h.x)+(M.x>x.x))){case 0:E[0]=M,E[4]=M.clone();break;case 1:E.splice(1,0,M);break;case 2:E[1]=M;break;case 3:E.splice(4,0,M);break;case 5:E.splice(2,0,M);break;case 6:E[3]=M;break;case 7:E.splice(3,0,M);break;case 8:E[2]=M}return E}containsTile(r,h,x,E=0){const M=Math.max(r.queryPadding,r.evaluateQueryRenderedFeaturePadding())/h._pixelsPerMercatorPixel+1,k=x?this._bufferedCameraMercator(M,h):this._bufferedScreenMercator(M,h);let B=r.tileID.wrap+(k.unwrapped?E:0);const G=k.polygon.map((ke=>t.as(r.tileTransform,ke,B)));if(!t.at(G,0,0,t.al,t.al))return;B=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const J=this.screenGeometryMercator.polygon.map((ke=>t.au(r.tileTransform,ke,B))),ee=J.map((ke=>new t.P(ke[0],ke[1]))),ce=h.getFreeCameraOptions().position||new t.ae(0,0,0),le=t.au(r.tileTransform,ce,B),he=J.map((ke=>{const Ae=t.av(ke,ke,le);return t.aw(Ae,Ae),new t.ax(le,Ae)})),be=t.ay(r,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ee,tilespaceRays:he,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(_e=t.az(G),_e.min.x=t.aA(_e.min.x,0,t.al),_e.min.y=t.aA(_e.min.y,0,t.al),_e.max.x=t.aA(_e.max.x,0,t.al),_e.max.y=t.aA(_e.max.y,0,t.al),_e),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:be};var _e}_bufferedScreenMercator(r,h){const x=Po(r);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let E;return E=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),h):{polygon:this.bufferedScreenGeometry(r).map((M=>h.pointCoordinate3D(M))),unwrapped:!0},this._screenRaycastCache[x]=E,E}}_bufferedCameraMercator(r,h){const x=Po(r);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let E;return E=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),h):{polygon:this.bufferedCameraGeometry(r).map((M=>h.pointCoordinate3D(M))),unwrapped:!0},this._cameraRaycastCache[x]=E,E}}_projectAndResample(r,h){const x=(function(M,k){const B=t.aB([],k.pixelMatrix,k.globeMatrix),G=[0,-t.aD,0,1],J=[0,t.aD,0,1],ee=[0,0,0,1];t.aC(G,G,B),t.aC(J,J,B),t.aC(ee,ee,B);const ce=new t.P(G[0]/G[3],G[1]/G[3]),le=new t.P(J[0]/J[3],J[1]/J[3]),he=t.aE(M,ce)&&G[3]<ee[3],be=t.aE(M,le)&&J[3]<ee[3];if(!he&&!be)return null;const _e=(function(at,tt,Je){for(let mt=1;mt<at.length;mt++){const Pt=qr(tt.pointCoordinate3D(at[mt-1]).x),It=qr(tt.pointCoordinate3D(at[mt]).x);if(Je<0){if(Pt<It)return{idx:mt,t:-Pt/(It-1-Pt)}}else if(It<Pt)return{idx:mt,t:(1-Pt)/(It+1-Pt)}}return null})(M,k,he?-1:1);if(!_e)return null;const{idx:ke,t:Ae}=_e;let Oe=ke>1?Br(M.slice(0,ke),k):[],He=ke<M.length?Br(M.slice(ke),k):[];Oe=Oe.map((at=>new t.P(qr(at.x),at.y))),He=He.map((at=>new t.P(qr(at.x),at.y)));const Be=[...Oe];Be.length===0&&Be.push(He[He.length-1]);const dt=t.ak(Be[Be.length-1].y,(He.length===0?Oe[0]:He[0]).y,Ae);let nt;return nt=he?[new t.P(0,dt),new t.P(0,0),new t.P(1,0),new t.P(1,dt)]:[new t.P(1,dt),new t.P(1,1),new t.P(0,1),new t.P(0,dt)],Be.push(...nt),He.length===0?Be.push(Oe[0]):Be.push(...He),{polygon:Be.map((at=>new t.ae(at.x,at.y))),unwrapped:!1}})(r,h);if(x)return x;const E=(function(M,k){let B=!1,G=-1/0,J=0;for(let ce=0;ce<M.length-1;ce++)M[ce].x>G&&(G=M[ce].x,J=ce);for(let ce=0;ce<M.length-1;ce++){const le=(J+ce)%(M.length-1),he=M[le],be=M[le+1];Math.abs(he.x-be.x)>.5&&(he.x<be.x?(he.x+=1,le===0&&(M[M.length-1].x+=1)):(be.x+=1,le+1===M.length-1&&(M[0].x+=1)),B=!0)}const ee=t.aF(k.center.lng);return B&&ee<Math.abs(ee-1)&&M.forEach((ce=>{ce.x-=1})),{polygon:M,unwrapped:B}})(Br(r,h).map((M=>new t.P(qr(M.x),M.y))),h);return{polygon:E.polygon.map((M=>new t.ae(M.x,M.y))),unwrapped:E.unwrapped}}}function Br(v,r){return t.aG(v,(h=>{const x=r.pointCoordinate3D(h);h.x=x.x,h.y=x.y}),1/256)}function qr(v){return v<0?1+v%1:v%1}function Po(v){return 100*v|0}function Ra(v,r,h,x,E){const M=function(B,G){if(B)return E(B);if(G){if(v.url&&G.tiles&&v.tiles&&delete v.tiles,G.variants){if(!Array.isArray(G.variants))return E(new Error("variants must be an array"));for(const ee of G.variants){if(ee==null||typeof ee!="object"||ee.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray(ee.capabilities))return E(new Error("capabilities must be an array"));if(ee.capabilities.length===1&&ee.capabilities[0]==="meshopt"){G=Object.assign(G,ee);break}}}const J=t.aH(Object.assign({},G,v),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);J.tiles=r.canonicalizeTileset(J,v.url),E(null,J)}},k=(function(B,G,J){if(!B)return null;if(!G&&!J)return B;J=J||B.worldview_default;const ee=Object.values(B.language||{});if(ee.length===0)return null;const ce=Object.values(B.worldview||{});if(ce.length===0)return null;const le=ee.every((be=>be===G)),he=ce.every((be=>be===J));return le&&he?B:G in(B.language_options||{})||J in(B.worldview_options||{})?null:B.language_options&&B.worldview_options?B:null})(v.data,h,x);return k?t.o.frame((()=>M(null,k))):v.url?t.m(r.transformRequest(r.normalizeSourceURL(v.url,null,h,x),t.R.Source),M):t.o.frame((()=>{const{data:B,...G}=v;M(null,G)}))}function _l(v,r){const h=Math.pow(2,r.z),x=Math.floor(t.aF(v.getWest())*h),E=Math.floor(t.aJ(v.getNorth())*h),M=Math.ceil(t.aF(v.getEast())*h),k=Math.ceil(t.aJ(v.getSouth())*h);return r.x>=x&&r.x<M&&r.y>=E&&r.y<k}class Hl{constructor(r,h,x){this.bounds=r?t.aI.convert(this.validateBounds(r)):null,this.minzoom=h||0,this.maxzoom=x||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const h of r)this.extraBounds.push(t.aI.convert(this.validateBounds(h)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!_l(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(_l(h,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const h=new Hl(r.bounds,r.minzoom,r.maxzoom);return h.addExtraBounds(r.extra_bounds),h}}class dd extends t.E{constructor(r,h,x,E){if(super(),this.id=r,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,t.aH(h,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new t.aK}load(r){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,x=this.map.getWorldview();this._tileJSONRequest=Ra(this._options,this.map._requestManager,h,x,((E,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,E)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),x&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${x}`),this.fire(new t.y(E));else if(M){if(Object.assign(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const k of M.vector_layers)this.vectorLayerIds.push(k.id),M.worldview&&M.worldview[k.source]&&this.localizableLayerIds.add(k.id)}this.tileBounds=Hl.fromTileJSON(M),Fn(M.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(E)}))}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=t.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(r)))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(r,h){const x=r.tileID.canonical.url(this.tiles,this.scheme),E=this.map._requestManager.normalizeTileURL(x),M=this.map._requestManager.transformRequest(E,t.R.Tile),k=this.map.style?this.map.style.getLut(this.scope):null,B=k?{image:k.image.clone()}:null,G={request:M,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:B,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&t.h(x)&&(G.localizableLayerIds=this.localizableLayerIds),G.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=h:r.request=r.actor.send("reloadTile",G,J.bind(this));else if(r.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",G,J.bind(this),void 0,!0);else{const ee=t.aL.call({deduped:this._deduped},G,((ce,le)=>{if(ce||!le)J.call(this,ce);else{const he=t.aM(le.responseHeaders);G.data={rawData:le.rawData.slice(0),expires:he.expires,cacheControl:he.cacheControl},r.actor&&r.actor.send("loadTile",G,J.bind(this),void 0,!0)}}),!0);r.request={cancel:ee}}function J(ee,ce){return delete r.request,r.aborted?h(null):ee&&ee instanceof t.aN&&ee.status!==404?h(ee):(ce&&ce.resourceTiming&&(r.resourceTiming=ce.resourceTiming),this.map._refreshExpiredTiles&&ce&&r.setExpiryData(ce),r.loadVectorData(ce,this.map.painter),t.aO(this.dispatcher),h(null,ce),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,h){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wa extends t.E{constructor(r,h,x,E){super(),this.id=r,this.dispatcher=x,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},h),Object.assign(this,t.aH(h,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=Ra(this._options,this.map._requestManager,null,h,((x,E)=>{this._tileJSONRequest=null,this._loaded=!0,x?this.fire(new t.y(x)):E&&(Object.assign(this,E),E.raster_layers&&(this.rasterLayers=E.raster_layers,this.rasterLayerIds=this.rasterLayers.map((M=>M.id))),this.tileBounds=Hl.fromTileJSON(E),Fn(E.tiles),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(x)}))}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=t.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(r)))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,h){const x=t.o.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);r.request=t.n(this.map._requestManager.transformRequest(E,t.R.Tile),((M,k,B)=>{if(delete r.request,r.aborted)return r.state="unloaded",h(null);if(M)return r.state="errored",h(M);if(!k)return h(null);const G=t.aM(B);this.map._refreshExpiredTiles&&r.setExpiryData(G),r.setTexture(k,this.map.painter),r.state="loaded",t.aO(this.dispatcher),h(null)}))}abortTile(r,h){r.request&&(r.request.cancel(),delete r.request),h&&h()}unloadTile(r,h){r.texture&&r.texture instanceof t.T?(r.destroy(!1),r.texture&&r.texture instanceof t.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function hc([v,r],h,x,{scaled:E=!0}={}){const{tileSize:M,buffer:k}=x,{x:B,y:G,z:J}=h;if(!isFinite(B)||!isFinite(G)||!isFinite(J))throw new Error("Invalid MRT header");const ee=2**J,ce=ee*t.aF(v),le=ee*t.aJ(r);return(function([he,be],_e,{scaled:ke=!0}={}){if(!_e)throw new Error("bandView is undefined");const{data:Ae,tileSize:Oe,buffer:He,offset:Be,scale:dt,dimension:nt}=_e;if(he<-He||he>Oe+He||be<-He||be>Oe+He)throw new Error(`Point (${he}, ${be}) out of bounds for tileSize=${Oe}, buffer=${He}`);const at=(be+He)*(Oe+2*He)+(he+He);if(new Uint32Array(Ae.buffer)[at]===4294967295)return null;let tt=[];tt=ke?[]:new _e.data.constructor(nt);for(let Je=0;Je<nt;Je++)tt[Je]=Math.round(1e12*(Ae[nt*at+Je]*dt+Be))/1e12;return tt})([Math.min(Math.max(-k,Math.floor((ce-B)*M)),M-1+k),Math.min(Math.max(-k,Math.floor((le-G)*M)),M-1+k)],x,{scaled:E})}class yl extends wa{constructor(r,h,x,E){super(r,h,x,E),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},h)}triggerRepaint(r){const h=this.map.painter._terrain,x=this.map.style.getSourceCache(this.id);h&&h.enabled&&x&&h._clearRenderCacheForTile(x.id,r.tileID),this.map.triggerRepaint()}loadTile(r,h){const x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(x,t.R.Tile),M={request:E,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=E,r.actor||(r.actor=this.dispatcher.getActor());const k=(B,G,J)=>{if(delete r.request,r.aborted)return r.state="unloaded",h(null);if(B)return B.name==="AbortError"?void 0:(r.state="errored",h(B));if(this.map._refreshExpiredTiles&&G){const ee=t.aM(J);r.setExpiryData(ee)}if(this.partial&&r.state!=="expired")r.state="empty";else if(!this.partial){if(!G)return h(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=G}h(null)};r.request=this.partial?r.fetchHeader(void 0,k.bind(this)):r.actor.send("loadTile",M,k.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,h){const x=r.texturePerLayer;if(r.flushAllQueues(),x.size){r.destroy(!1);for(const E of x.values())this.map.painter.saveTileTexture(E)}else r.destroy()}prepareTile(r,h,x,E){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBandForRender(h,x,E,((M,k)=>{if(M)return r.state="errored",this.fire(new t.y(M)),void this.triggerRepaint(r);k&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(x,k,this.map.painter),r.state="loaded",this.triggerRepaint(r))})))}getInitialBand(r){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find((({id:M})=>M===r)),x=h&&h.fields,E=x&&x.bands&&x.bands;return E?E[0]:0}getTextureDescriptor(r,h,x){if(!r)return;const E=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let M=null;h instanceof t.aR?M=h.paint.get("raster-array-band"):h instanceof t.aS&&(M=h.paint.get("raster-particle-array-band"));const k=M||this.getInitialBand(E);if(k==null)return;if(!r.textureDescriptorPerLayer.get(h.id))return void this.prepareTile(r,E,h.id,k);if(r.updateNeeded(h.id,k)&&!x)return;const B=r.textureDescriptorPerLayer.get(h.id);return Object.assign({},B,{texture:r.texturePerLayer.get(h.id)})}getImages(r,h){const x=new Map;for(const E of r)for(const M of h){const[k,B]=M.split("/"),G=E.getLayer(k);if(!G||!G.hasBand(B)||!G.hasDataForBand(B))continue;const{bytes:J,tileSize:ee,buffer:ce}=G.getBandView(B),le=ee+2*ce,he={data:new t.q({width:le,height:le},J),pixelRatio:2,sdf:!1,usvg:!1,version:0};x.set(M,he)}return x}queryRasterArrayValueByBandId(r,h,x){const E=h._mrt;return new Promise((M=>{const k={},B=new Set;for(const[G,J]of Object.entries(E.layers)){if(x.layerName&&G!==x.layerName)continue;const ee={};k[G]=ee;for(const{bands:ce}of J.dataIndex)for(const le of ce)x.bands&&!x.bands.includes(le)||(B.add(t.B(G,le)),h.fetchBand(G,null,le,(he=>{t.o.frame((()=>{ee[le]=he?null:hc([r.lng,r.lat],E,J.getBandView(le)),B.delete(t.B(G,le)),B.size===0&&M(k)}))}),!1))}B.size===0&&M(k)}))}_loadTileForQuery(r,h){if(this._loadTileLoaded[r.uid])return void h(null,r._mrt);if(this._loadTilePending[r.uid])return void this._loadTilePending[r.uid].push(h);this._loadTilePending[r.uid]=[h];const x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(x,t.R.Tile);r.actor.send("loadTile",{request:E,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((M,k,B)=>{if(M)return this._loadTilePending[r.uid].forEach((G=>G(M,null))),void delete this._loadTilePending[r.uid];if(!k)return this._loadTilePending[r.uid].forEach((G=>G(null,null))),void delete this._loadTilePending[r.uid];if(this.map._refreshExpiredTiles&&k){const G=t.aM(B);r.setExpiryData(G)}r._mrt=k,r._isHeaderLoaded=!0,r.state="loaded",this._loadTilePending[r.uid].forEach((G=>G(null,k))),this._loadTileLoaded[r.uid]=!0,delete this._loadTilePending[r.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(r,h,x){return new Promise(((E,M)=>{this._loadTileForQuery(h,((k,B)=>{k?M(k):E(B?this.queryRasterArrayValueByBandId(r,h,x):null)}))}))}queryRasterArrayValue(r,h){const x=t.aT.convert(r),E=this.findLoadedParent(x);return E&&E._mrt?h.bands||!this.partial?this.queryRasterArrayValueByBandId(x,E,h):this.queryRasterArrayValueByAllBands(x,E,h):Promise.resolve(null)}findLoadedParent(r){const h=t.ae.fromLngLat(r,this.map.transform.tileSize),x=this.maxzoom+1,E=1<<x,M=Math.floor(h.x),k=Math.floor((h.x-M)*E),B=Math.floor(h.y*E),G=this.map.style.getSourceCache(this.id),J=new t.aQ(x,M,x,k,B);return G.findLoadedParent(J,this.minzoom)}}const su={vector:dd,raster:wa,"raster-dem":class extends wa{constructor(v,r,h,x){super(v,r,h,x),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(v,r){const h=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(E,M){E&&(v.state="errored",r(E)),M&&(v.dem=M,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",r(null))}v.request=t.n(this.map._requestManager.transformRequest(h,t.R.Tile),(function(E,M,k){if(delete v.request,v.aborted)v.state="unloaded",r(null);else if(E)v.state="errored",r(E);else if(M){const B=t.aM(k);this.map._refreshExpiredTiles&&v.setExpiryData(B);const G=ImageBitmap&&M instanceof ImageBitmap&&t.r(),J=1-(M.width-t.aP(M.width))/2;J<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const ee=G?M:t.o.getImageData(M,J),ce={uid:v.uid,tileID:v.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:ee,encoding:this.encoding,padding:J};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadTile",ce,x.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(v){const r=v.canonical,h=Math.pow(2,r.z),x=(r.x-1+h)%h,E=r.x===0?v.wrap-1:v.wrap,M=(r.x+1+h)%h,k=r.x+1===h?v.wrap+1:v.wrap,B={};return B[new t.aQ(v.overscaledZ,E,r.z,x,r.y).key]={backfilled:!1},B[new t.aQ(v.overscaledZ,k,r.z,M,r.y).key]={backfilled:!1},r.y>0&&(B[new t.aQ(v.overscaledZ,E,r.z,x,r.y-1).key]={backfilled:!1},B[new t.aQ(v.overscaledZ,v.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},B[new t.aQ(v.overscaledZ,k,r.z,M,r.y-1).key]={backfilled:!1}),r.y+1<h&&(B[new t.aQ(v.overscaledZ,E,r.z,x,r.y+1).key]={backfilled:!1},B[new t.aQ(v.overscaledZ,v.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},B[new t.aQ(v.overscaledZ,k,r.z,M,r.y+1).key]={backfilled:!1}),B}},"raster-array":yl,geojson:class extends t.E{constructor(v,r,h,x){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(x),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const E=t.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*E,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*E,extent:t.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.al,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*E,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}updateData(v){if(!this._options.dynamic)return this.fire(new t.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof v!="string"&&(v.type==="Feature"&&(v={type:"FeatureCollection",features:[v]}),v.type!=="FeatureCollection"))return this.fire(new t.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof v!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const h of this._data.features)r.set(h.id,h);for(const h of v.features)r.set(h.id,h);this._data.features=[...r.values()]}else this._data=v;return this._updateWorkerData(!0),this}getClusterExpansionZoom(v,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id,scope:this.scope},r),this}getClusterChildren(v,r){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id,scope:this.scope},r),this}getClusterLeaves(v,r,h,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:v,limit:r,offset:h},x),this}_updateWorkerData(v=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=Object.assign({append:v},this.workerOptions);r.scope=this.scope;const h=this._data;typeof h=="string"?(r.request=this.map._requestManager.transformRequest(t.o.resolveURL(h),t.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,((x,E)=>{if(this._loaded=!0,this._pendingLoad=null,x)this.fire(new t.y(x));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(M.resourceTiming=E.resourceTiming[this.id]),v&&(this._partialReload=!0),this.fire(new t.z("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(v),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const v=t.B(this.id,this.scope);this.map.style.clearSource(v),this._updateWorkerData()}loadTile(v,r){const h=v.actor?"reloadTile":"loadTile";v.actor=this.actor;const x=this.map.style?this.map.style.getLut(this.scope):null,E=x?{image:x.image.clone()}:null,M=this._partialReload,k={type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:E,scope:this.scope,pixelRatio:t.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:v.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:M,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};v.request=this.actor.send(h,k,((B,G)=>M&&!G?(v.state="loaded",r(null)):(delete v.request,v.destroy(!1),v.aborted?r(null):B?r(B):(v.loadVectorData(G,this.map.painter,h==="reloadTile"),r(null)))),void 0,h==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v,r){this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id,scope:this.scope}),v.destroy()}onRemove(v){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.aU{constructor(v,r,h,x){super(v,r,h,x),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const r of v.urls)this.urls.push(this.map._requestManager.transformRequest(r,t.R.Source).url);t.aV(this.urls,((r,h)=>{this._loaded=!0,r?this.fire(new t.y(r)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const r=this.video.seekable;v<r.start(0)||v>r.end(0)?this.fire(new t.y(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,r=v.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(v,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.aU,model:t.aX,"batched-model":class extends t.E{constructor(v,r,h,x){super(),this.type="batched-model",this.id=v,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(x)}onAdd(v){this.map=v,this.load()}reload(){this.cancelTileJSONRequest();const v=t.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(v)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(v){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Ra(this._options,this.map._requestManager,r,h,((x,E)=>{this._tileJSONRequest=null,this._loaded=!0,x?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new t.y(x))):E&&(Object.assign(this,E),E.bounds&&(this.tileBounds=new Hl(E.bounds,this.minzoom,this.maxzoom)),Fn(E.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),v&&v(x)}))}hasTransition(){return!1}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}loaded(){return this._loaded}loadTile(v,r){const h=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(h,t.R.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:v.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:t.o.devicePixelRatio,promoteId:this.promoteId};if(v.actor&&v.state!=="expired")if(v.state==="loading")v.reloadCallback=r;else{if(v.buckets){const M=Object.values(v.buckets);for(const k of M)k.dirty=!0;return void(v.state="loaded")}v.request=v.actor.send("reloadTile",x,E.bind(this))}else v.actor=this.dispatcher.getActor(),v.request=v.actor.send("loadTile",x,E.bind(this),void 0,!0);function E(M,k){return v.aborted?r(null):M&&M.status!==404?r(M):(this.map._refreshExpiredTiles&&k&&v.setExpiryData(k),v.loadModelData(k,this.map.painter),v.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends t.aU{constructor(v,r,h,x){super(v,r,h,x),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((E=>!Array.isArray(E)||E.length!==2||E.some((M=>typeof M!="number"))))||this.fire(new t.y(new t.V(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.y(new t.V(`sources.${v}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new t.y(new t.V(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new t.y(new t.V(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.y(new t.V(`sources.${v}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(v){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!v&&!this._playing||this.texture instanceof t.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends t.E{constructor(v,r,h,x){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=r,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Hl(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,t.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this.map=v,this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:r,y:h,z:x}=v.canonical;return this._implementation.hasTile({x:r,y:h,z:x})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,r){const{x:h,y:x,z:E}=v.tileID.canonical,M=new AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:h,y:x,z:E},{signal:M.signal})).then((function(k){return delete v.request,v.aborted?(v.state="unloaded",r(null)):k===void 0?(v.state="errored",r(null)):k===null?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",r(null)):(function(B){return B instanceof ImageData||B instanceof HTMLCanvasElement||B instanceof ImageBitmap||B instanceof HTMLImageElement})(k)?(this.loadTileData(v,k),v.state="loaded",void r(null)):(v.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((k=>{k.name!=="AbortError"&&(v.state="errored",r(k))})),v.request.cancel=()=>M.abort()}loadTileData(v,r){v.setTexture(r,this.map.painter)}unloadTile(v,r){if(v.texture&&v.texture instanceof t.T?(v.destroy(!1),v.texture&&v.texture instanceof t.T&&this.map.painter.saveTileTexture(v.texture)):v.destroy(),this._implementation.unloadTile){const{x:h,y:x,z:E}=v.tileID.canonical;this._implementation.unloadTile({x:h,y:x,z:E})}r&&r()}abortTile(v,r){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z})))}_clearTiles(){const v=t.B(this.id,this.scope);this.map.style.clearSource(v)}_update(){this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ta=function(v,r,h,x){const E=new su[r.type](v,r,h,x);if(E.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${E.id}`);return t.aY(["load","abort","unload","serialize","prepare"],E),E};function Zd(v,r,h=""){return`${h}:${r.id||""}:${r.layer.id}:${(function(x){if("layerId"in x)return`layer:${x.layerId}`;{const{featuresetId:E,importId:M}=x;return`featureset:${E}${M?`:import:${M}`:""}`}})(v.target)}`}function Xu(v,r,h,x=""){if(v.uniqueFeatureID){const E=Zd(v,r,x);if(h.has(E))return!0;h.add(E)}return!1}function Xd(v,r,h,x,E=!1){const M=r.sourceCache.transform,k=r.sourceCache.tilesIn(v,r.has3DLayers,E);k.sort(Yd);const B=[];for(const G of k){const J=G.tile.queryRenderedFeatures(r,G,h,x,M,E);Object.keys(J).length&&B.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:J})}for(const G in r.layers){const J=r.layers[G];if(J.styleLayer){const ee=J.styleLayer.queryRenderedFeatures(v,r.sourceCache,x);Object.keys(ee).length&&B.push({wrappedTileID:0,queryResults:ee})}}return B.length===0?{}:(function(G){const J={},ee={};for(const ce of G){const le=ce.queryResults,he=ce.wrappedTileID,be=ee[he]=ee[he]||{};for(const _e in le){const ke=le[_e],Ae=be[_e]=be[_e]||{},Oe=J[_e]=J[_e]||[];for(const He of ke)Ae[He.featureIndex]||(Ae[He.featureIndex]=!0,Oe.push(He))}}return J})(B)}function Op(v,r,h,x,E,M){const k={},B=x.queryRenderedSymbols(v),G=[];for(const J of Object.keys(B).map(Number))G.push(E[J]);G.sort(Yd);for(const J of G){const ee=J.featureIndex.lookupSymbolFeatures(B[J.bucketInstanceId],J.bucketIndex,J.sourceLayerIndex,r,h,M);for(const ce in ee){const le=k[ce]=k[ce]||[],he=ee[ce];he.sort(((be,_e)=>{const ke=J.featureSortOrder;if(ke){const Ae=ke.indexOf(be.featureIndex);return ke.indexOf(_e.featureIndex)-Ae}return _e.featureIndex-be.featureIndex}));for(const be of he)le.push(be)}}return k}function Dh(v,r){const h=v.getRenderableIds().map((M=>v.getTileByID(M))),x=[],E={};for(let M=0;M<h.length;M++){const k=h[M],B=k.tileID.canonical.key;E[B]||(E[B]=!0,k.querySourceFeatures(x,r))}return x}function Yd(v,r){const h=v.tileID,x=r.tileID;return h.overscaledZ-x.overscaledZ||h.canonical.y-x.canonical.y||h.wrap-x.wrap||h.canonical.x-x.canonical.x}function bc(v,r){const h={};if(!r)return h;for(const x of v){const E=x.layerIds.map((M=>r.getLayer(M))).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map((M=>E.filter((k=>k.id===M))[0])));for(const M of E)h[M.fqid]=x}}return h}const ja=32,Wl=33,as=new Uint16Array(8184);for(let v=0;v<2046;v++){let r=v+2,h=0,x=0,E=0,M=0,k=0,B=0;for(1&r?E=M=k=ja:h=x=B=ja;(r>>=1)>1;){const J=h+E>>1,ee=x+M>>1;1&r?(E=h,M=x,h=k,x=B):(h=E,x=M,E=k,M=B),k=J,B=ee}const G=4*v;as[G+0]=h,as[G+1]=x,as[G+2]=E,as[G+3]=M}const wc=new Uint16Array(2178),Yu=new Uint8Array(1089),Ku=new Uint16Array(1089);function cl(v){return v===0?-.03125:v===32?.03125:0}const vl={type:2,extent:t.al,loadGeometry:()=>[[new t.P(0,0),new t.P(t.al+1,0),new t.P(t.al+1,t.al+1),new t.P(0,t.al+1),new t.P(0,0)]]};class Vo{constructor(r,h,x,E,M,k){this.tileID=r,this.uid=t.b2(),this.uses=0,this.tileSize=h,this.tileZoom=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection),this.worldview=k,this._hasAppearances=null}registerFadeDuration(r){const h=r+this.timeAdded;h<t.o.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=t.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,h,x){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=bc(r.buckets,h.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const M=this.buckets[E];if(M instanceof t.b4){if(this.hasSymbolBuckets=!0,!x)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const M=this.buckets[E];if(M instanceof t.b4&&M.hasRTLText){this.hasRTLText=!0,t.b5();break}}this.queryPadding=0;for(const E in this.buckets){const M=this.buckets[E],k=h.style.getOwnLayer(E);if(!k)continue;const B=k.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,B)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new t.b3}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,h,x){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,bc(r.buckets,h.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r,h){for(const M in this.buckets){const k=this.buckets[M];if(k.uploadPending()){let B={},G=[],J={zoom:0,pitch:0,brightness:0,worldview:""};if(h){if(h.style){G=h.style.listImages();const ee=k.layers[0],ce=ee.sourceLayer||"_geojsonTileLayer",le=h.style.getLayerSourceCache(ee);le&&(B=le._state.getState(ce,void 0))}J={zoom:h.transform.zoom||0,pitch:h.transform.pitch||0,brightness:h.style.getBrightness()||0,worldview:h.worldview||""}}k.upload(r,this.tileID.canonical,B,G,J)}}const x=r.gl,E=this.imageAtlas;E&&!E.uploaded&&(this.imageAtlasTexture=new t.T(r,E.image,x.RGBA8,{useMipmap:!!E.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(r,this.glyphAtlasImage,x.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(r,this.lineAtlas.image,x.R8),this.lineAtlas.uploaded=!0)}prepare(r,h,x){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,x),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=h.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(h)),(this._lastUpdatedBrightness||E||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==E),this._lastUpdatedBrightness=E))}evaluateQueryRenderedFeaturePadding(){let r=0;for(const h in this.buckets){const x=this.buckets[h];x.evaluateQueryRenderedFeaturePadding&&(r=Math.max(r,x.evaluateQueryRenderedFeaturePadding()))}return r}queryRenderedFeatures(r,h,x,E,M,k){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const B=this.evaluateQueryRenderedFeaturePadding(),G=(function(J,ee){const ce=t.bq([],[.5*J.width,.5*-J.height,1]);return t.br(ce,ce,[1,-1,0]),t.aB(ce,ce,J.calculateProjMatrix(ee.toUnwrapped())),Float32Array.from(ce)})(M,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:h,pixelPosMatrix:G,transform:E,availableImages:x,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:B})}querySourceFeatures(r,h){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const E=x.loadVTLayers(),M=h?h.sourceLayer:"",k=E._geojsonTileLayer||E[M];if(!k)return;const B=t.b6(h&&h.filter),{z:G,x:J,y:ee}=this.tileID.canonical,ce={z:G,x:J,y:ee};for(let le=0;le<k.length;le++){const he=k.feature(le);if(B.needGeometry){const ke=t.b7(he,!0);if(!B.filter(new t.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ke,this.tileID.canonical))continue}else if(!B.filter(new t.ac(this.tileID.overscaledZ,{worldview:this.worldview}),he))continue;const be=x.getId(he,M),_e=new t.b8(he,G,J,ee,be);_e.tile=ce,r.push(_e)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const x=t.b9(r.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const x=Date.now();let E=!1;if(this.expirationTime>x)E=!1;else if(h)if(this.expirationTime<h)E=!0;else{const M=this.expirationTime-h;M?this.expirationTime=x+Math.max(M,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}hasAppearances(r){for(const h in this.buckets)if(r.style.hasLayer(h)&&this.buckets[h].layers.some((x=>x.appearances&&x.appearances.length>0)))return!0;return!1}updateBuckets(r,h){if(!this.latestFeatureIndex||!r.style)return;const x=r.style.listImages(),E=r.style.getBrightness();for(const M in this.buckets){if(!r.style.hasLayer(M))continue;const k=this.buckets[M],B=k.layers[0],G=B.sourceLayer||"_geojsonTileLayer",J=r.style.getLayerSourceCache(B);let ee={};J&&(ee=J._state.getState(G,void 0));const ce=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(ee).length>0&&!h;k.hasAppearances=k.layers.some((_e=>_e.appearances&&_e.appearances.length>0));const he=le?k.stateDependentLayers:k.layers;if(le&&k.stateDependentLayers.length!==0||h){const _e=this.latestFeatureIndex.loadVTLayers();k.update(ee,_e[G],x,ce,he,h,E)}if(le&&k.stateDependentLayers.length!==0||h||k.hasAppearances){const _e={zoom:r.transform.zoom,pitch:r.transform.pitch,brightness:r.style.getBrightness()||0,worldview:r.worldview};k.updateAppearances(this.tileID.canonical,ee,x,_e)}(k instanceof t.ba||k instanceof t.bb)&&r._terrain&&r._terrain.enabled&&J&&k.uploadPending()&&r._terrain._clearRenderCacheForTile(J.id,this.tileID);const be=r&&r.style&&r.style.getOwnLayer(M);be&&(this.queryPadding=Math.max(this.queryPadding,be.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=t.o.now()+r}setTexture(r,h){const x=h.context,E=x.gl;this.texture=this.texture||h.getTileTexture(r.width),this.texture&&this.texture instanceof t.T?this.texture.update(r):(this.texture=new t.T(x,r,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(r,h){const x={};for(const E of h)x[E]=!0;this.dependencies[r]=x}hasDependency(r,h){for(const x of r){const E=this.dependencies[x];if(E){for(const M of h)if(E[M])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const x=t.bc(vl,this.tileID.canonical,this.tileTransform)[0],E=new t.bd,M=new t.be;for(let k=0;k<x.length;k++){const{x:B,y:G}=x[k];E.emplaceBack(B,G),M.emplaceBack(k)}M.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(M),this._tileDebugBuffer=r.createVertexBuffer(E,t.bf.members),this._tileDebugSegments=t.bg.simpleSegment(0,0,E.length,M.length)}_makeTileBoundsBuffers(r,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const x=t.bc(vl,this.tileID.canonical,this.tileTransform)[0];let E,M;if(this.isRaster){const k=(function(B,G){const J=t.aZ(B,G),ee=Math.pow(2,B.z);for(let ke=0;ke<Wl;ke++)for(let Ae=0;Ae<Wl;Ae++){const Oe=t.a_((B.x+(Ae+cl(Ae))/ja)/ee),He=t.a$((B.y+(ke+cl(ke))/ja)/ee),Be=G.project(Oe,He),dt=ke*Wl+Ae;wc[2*dt+0]=Math.round((Be.x*J.scale-J.x)*t.al),wc[2*dt+1]=Math.round((Be.y*J.scale-J.y)*t.al)}Yu.fill(0),Ku.fill(0);for(let ke=2045;ke>=0;ke--){const Ae=4*ke,Oe=as[Ae+0],He=as[Ae+1],Be=as[Ae+2],dt=as[Ae+3],nt=Oe+Be>>1,at=He+dt>>1,tt=nt+at-He,Je=at+Oe-nt,mt=He*Wl+Oe,Pt=dt*Wl+Be,It=at*Wl+nt,ri=Math.hypot((wc[2*mt+0]+wc[2*Pt+0])/2-wc[2*It+0],(wc[2*mt+1]+wc[2*Pt+1])/2-wc[2*It+1])>=16;Yu[It]=Yu[It]||(ri?1:0),ke<1022&&(Yu[It]=Yu[It]||Yu[(He+Je>>1)*Wl+(Oe+tt>>1)]||Yu[(dt+Je>>1)*Wl+(Be+tt>>1)])}const ce=new t.b1,le=new t.b0;let he=0;function be(ke,Ae){const Oe=Ae*Wl+ke;return Ku[Oe]===0&&(ce.emplaceBack(wc[2*Oe+0],wc[2*Oe+1],ke*t.al/ja,Ae*t.al/ja),Ku[Oe]=++he),Ku[Oe]-1}function _e(ke,Ae,Oe,He,Be,dt){const nt=ke+Oe>>1,at=Ae+He>>1;if(Math.abs(ke-Be)+Math.abs(Ae-dt)>1&&Yu[at*Wl+nt])_e(Be,dt,ke,Ae,nt,at),_e(Oe,He,Be,dt,nt,at);else{const tt=be(ke,Ae),Je=be(Oe,He),mt=be(Be,dt);le.emplaceBack(tt,Je,mt)}}return _e(0,0,ja,ja,ja,0),_e(ja,ja,0,0,0,ja),{vertices:ce,indices:le}})(this.tileID.canonical,h);E=k.vertices,M=k.indices}else{E=new t.b1,M=new t.b0;for(const{x:B,y:G}of x)E.emplaceBack(B,G,0,0);const k=t.bh(E.int16.subarray(0,4*E.length),void 0,4);for(let B=0;B<k.length;B+=3)M.emplaceBack(k[B],k[B+1],k[B+2])}this._tileBoundsBuffer=r.createVertexBuffer(E,t.bi.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(M),this._tileBoundsSegments=t.bg.simpleSegment(0,0,E.length,M.length)}_makeGlobeTileDebugBuffers(r,h){const x=h.projection;if(!x||x.name!=="globe"||h.freezeTileCoverage)return;const E=this.tileID.canonical,M=t.bj(E,h),k=t.bk(M),B=t.aj(h.zoom);let G;B>0&&(G=t.bl(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,E,h,k,G,B),this._makeGlobeTileDebugTextBuffer(r,E,h,k,G,B)}_globePoint(r,h,x,E,M,k,B){let G=t.bm(r,h,x);if(k){const J=1<<x.z,ee=t.aF(E.center.lng),ce=t.aJ(E.center.lat),le=(x.x+.5)/J-ee;let he=0;le>.5?he=-1:le<-.5&&(he=1);let be=(r/t.al+x.x)/J+he,_e=(h/t.al+x.y)/J;be=(be-ee)*E._pixelsPerMercatorPixel+ee,_e=(_e-ce)*E._pixelsPerMercatorPixel+ce;const ke=[be*E.worldSize,_e*E.worldSize,0];t.af(ke,ke,k),G=t.bn(G,ke,B)}return t.af(G,G,M)}_makeGlobeTileDebugBorderBuffer(r,h,x,E,M,k){const B=new t.bd,G=new t.be,J=new t.bo,ee=(le,he,be,_e,ke)=>{const Ae=(be-le)/(ke-1),Oe=(_e-he)/(ke-1),He=B.length;for(let Be=0;Be<ke;Be++){const dt=le+Be*Ae,nt=he+Be*Oe;B.emplaceBack(dt,nt);const at=this._globePoint(dt,nt,h,x,E,M,k);J.emplaceBack(at[0],at[1],at[2]),G.emplaceBack(He+Be)}},ce=t.al;ee(0,0,ce,0,16),ee(ce,0,ce,ce,16),ee(ce,ce,0,ce,16),ee(0,ce,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(G),this._tileDebugBuffer=r.createVertexBuffer(B,t.bf.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(J,t.bp.members),this._tileDebugSegments=t.bg.simpleSegment(0,0,B.length,G.length)}_makeGlobeTileDebugTextBuffer(r,h,x,E,M,k){const B=t.al/4,G=new t.bd,J=new t.b0,ee=new t.bo,ce=25;J.reserve(32),G.reserve(ce),ee.reserve(ce);const le=(he,be)=>ce*he+be;for(let he=0;he<ce;he++){const be=he*B;for(let _e=0;_e<ce;_e++){const ke=_e*B;G.emplaceBack(ke,be);const Ae=this._globePoint(ke,be,h,x,E,M,k);ee.emplaceBack(Ae[0],Ae[1],Ae[2])}}for(let he=0;he<4;he++)for(let be=0;be<4;be++){const _e=le(he,be),ke=le(he,be+1),Ae=le(he+1,be),Oe=le(he+1,be+1);J.emplaceBack(_e,ke,Ae),J.emplaceBack(Ae,ke,Oe)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(J),this._tileDebugTextBuffer=r.createVertexBuffer(G,t.bf.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(ee,t.bp.members),this._tileDebugTextSegments=t.bg.simpleSegment(0,0,ce,32)}destroy(r=!0){for(const h in this.buckets)this.buckets[h].destroy(r);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),r&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof t.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}t.bs.setPbf(t.bt);class Jr extends Vo{constructor(r,h,x,E,M){super(r,h,x,E,M),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,h,x){const E=x.context,M=E.gl;let k=this.texturePerLayer.get(r)||x.getTileTexture(h.width);k&&k instanceof t.T?k.update(h,{premultiply:!1}):k=new t.T(E,h,M.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,k)}flushQueues(r){const h=this._workQueuePerLayer.get(r)||[],x=this._fetchQueuePerLayer.get(r)||[];for(;h.length;)h.pop()();for(;x.length;)x.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const h=this._workQueuePerLayer.get(r)||[];for(;h.length;)h.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const h=this._fetchQueuePerLayer.get(r)||[];for(;h.length;)h.pop()()}}fetchHeader(r=16384,h){const x=this._mrt=new t.bs(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=t.bu(E,((M,k,B)=>{if(M)h(M);else try{const G=x.getHeaderLength(k);if(G>r)return void(this.request=this.fetchHeader(G,h));x.parseHeader(k),this._isHeaderLoaded=!0;let J=0;for(const ee of Object.values(x.layers))J=Math.max(J,ee.dataIndex[ee.dataIndex.length-1].lastByte);k.byteLength>=J&&(this.entireBuffer=k),h(null,this.entireBuffer||k,B)}catch(G){h(G)}})),this.request}fetchBandForRender(r,h,x,E){this.fetchBand(r,h,x,(M=>{if(M)return void E(M);this.updateTextureDescriptor(r,h,x);const k=this.textureDescriptorPerLayer.get(h);E(null,k?k.img:null)}))}fetchBand(r,h,x,E,M=!0){const k=this._mrt;if(!this._isHeaderLoaded||!k)return void E(new Error("Tile header is not ready"));const B=this.actor;if(!B)return void E(new Error("Can't fetch tile band without an actor"));let G;const J=t.B(String(x),t.B(this.tileID.key,r));let ee=this._taskQueue.get(J);ee?ee.add(E):(ee=new Set,ee.add(E),this._taskQueue.set(J,ee));const ce=(_e,ke)=>{G.complete(_e,ke),_e?E(_e):(ee.forEach((Ae=>Ae(null,ke))),this._taskQueue.delete(J))},le=(_e,ke)=>{if(_e)return E(_e);const Ae=B.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ke,task:G},ce,void 0,!0);if(h!==null){const Oe=this._workQueuePerLayer.get(h)||[];Oe.push((()=>{Ae&&Ae.cancel(),G.cancel()})),this._workQueuePerLayer.has(h)||this._workQueuePerLayer.set(h,Oe)}};let he;try{he=k.getLayer(r)}catch(_e){if(this.state==="reloading")return;throw _e}if(!he)return void E(new Error(`Unknown sourceLayer "${r}"`));if(he.hasDataForBand(x))return ee.forEach((_e=>_e(null,null))),void this._taskQueue.delete(J);const be=he.getDataRange([x]);if(G=k.createDecodingTask(be),!G||G.tasks.length)if(h!==null&&this.flushQueues(h),this.entireBuffer)le(null,this.entireBuffer.slice(be.firstByte,be.lastByte+1));else{const _e=Object.assign({},this.requestParams,{headers:{Range:`bytes=${be.firstByte}-${be.lastByte}`}}),ke=t.bu(_e,le);if(h!==null){const Ae=this._fetchQueuePerLayer.get(h)||[];Ae.push((()=>{ke.cancel(),G.cancel()})),this._fetchQueuePerLayer.has(h)||this._fetchQueuePerLayer.set(h,Ae)}}}updateNeeded(r,h){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==h||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(r,h,x){if(!this._mrt)return;const E=this._mrt.getLayer(r);if(!E||!E.hasBand(x)||!E.hasDataForBand(x))return;const{bytes:M,tileSize:k,buffer:B,offset:G,scale:J}=E.getBandView(x),ee=k+2*B,ce=new t.q({width:ee,height:ee},M),le=this.texturePerLayer.get(h);le&&le instanceof t.T&&le.update(ce,{premultiply:!1}),this.textureDescriptorPerLayer.set(h,{layer:r,band:x,img:ce,buffer:B,offset:G,tileSize:k,format:E.pixelFormat,mix:[J,256*J,65536*J,16777216*J]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const h of this.texturePerLayer.values())h&&h instanceof t.T&&h.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Zo{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,x){const E=r.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const M={value:h,timeout:void 0};if(x!==void 0&&(M.timeout=setTimeout((()=>{this.remove(r,M)}),x)),this.data[E].push(M),this.order.push(E),this.order.length>this.max){const k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const x=r.wrapped().key,E=h===void 0?0:this.data[x].indexOf(h),M=this.data[x][E];return this.data[x].splice(E,1),M.timeout&&clearTimeout(M.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(M.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const x in this.data)for(const E of this.data[x])r(E.value)||h.push(E);for(const x of h)this.remove(x.value.tileID,x)}}class ou{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,x){const E=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][E]=this.stateChanges[r][E]||{},Object.assign(this.stateChanges[r][E],x),this.deletedStates[r]===null){this.deletedStates[r]={};for(const M in this.state[r])M!==E&&(this.deletedStates[r][M]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][E]===null){this.deletedStates[r][E]={};for(const M in this.state[r][E])x[M]||(this.deletedStates[r][E][M]=null)}else for(const M in x)this.deletedStates[r]&&this.deletedStates[r][E]&&this.deletedStates[r][E][M]===null&&delete this.deletedStates[r][E][M]}removeFeatureState(r,h,x){if(this.deletedStates[r]===null)return;const E=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},x&&h!==void 0)this.deletedStates[r][E]!==null&&(this.deletedStates[r][E]=this.deletedStates[r][E]||{},this.deletedStates[r][E][x]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][E])for(x in this.deletedStates[r][E]={},this.stateChanges[r][E])this.deletedStates[r][E][x]=null;else this.deletedStates[r][E]=null;else this.deletedStates[r]=null}getState(r,h){const x=this.state[r]||{},E=this.stateChanges[r]||{},M=this.deletedStates[r];if(M===null)return{};if(h!==void 0){const B=String(h),G=Object.assign({},x[B],E[B]);if(M){const J=M[h];if(J===null)return{};for(const ee in J)delete G[ee]}return G}const k=Object.assign({},x,E);if(M)for(const B in M)delete k[B];return k}initializeTileState(r,h){r.refreshFeatureState(h)}coalesceChanges(r,h){const x={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const M={};for(const k in this.stateChanges[E])this.state[E][k]||(this.state[E][k]={}),Object.assign(this.state[E][k],this.stateChanges[E][k]),M[k]=this.state[E][k];x[E]=M}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const M={};if(this.deletedStates[E]===null)for(const k in this.state[E])M[k]={},this.state[E][k]={};else for(const k in this.deletedStates[E]){if(this.deletedStates[E][k]===null)this.state[E][k]={};else if(this.state[E][k])for(const B of Object.keys(this.deletedStates[E][k]))delete this.state[E][k][B];M[k]=this.state[E][k]}x[E]=x[E]||{},Object.assign(x[E],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(const E in r)r[E].refreshFeatureState(h)}}class Ko extends t.E{constructor(r,h,x){super(),this.id=r,this._onlySymbols=x,h.on("data",(E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),h.on("error",(()=>{this._sourceErrored=!0})),this._source=h,this._tiles={},this._cache=new Zo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ou,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,h){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,h)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const x=this._tiles[h];x.upload(r,this.map?this.map.painter:void 0),x.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((r=>r.tileID)).sort(Zl).map((r=>r.key))}getRenderableIds(r,h){const x=[];for(const E in this._tiles)this._isIdRenderable(+E,r,h)&&x.push(this._tiles[E]);return r?x.sort(((E,M)=>{const k=E.tileID,B=M.tileID,G=new t.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),J=new t.P(B.canonical.x,B.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-B.overscaledZ||J.y-G.y||J.x-G.x})).map((E=>E.tileID.key)):x.map((E=>E.tileID)).sort(Zl).map((E=>E.key))}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h,x){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())&&(x||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,h){const x=this._tiles[r];x&&(x.state!=="loading"&&(x.state=h),this._loadTile(x,this._tileLoaded.bind(this,x,r,h)))}_tileLoaded(r,h,x,E,M){if(E){if(r.state="errored",E.status!==404)this._source.fire(new t.y(E,{tile:r}));else{if(this._source.fire(new t.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const B=this.map.painter.terrain;this.update(this.transform,B.getScaledDemTileSize(),!0),B.resetTileLookupCache(this.id)}else this.update(this.transform)}return}r.timeAdded=t.o.now(),x==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null);let k=new Map;M&&M.responseHeaders&&(k=M.responseHeaders),this._source.fire(new t.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id,responseHeaders:k}))}_backfillDEM(r){const h=this.getRenderableIds();for(let E=0;E<h.length;E++){const M=h[E];if(r.neighboringTiles&&r.neighboringTiles[M]){const k=this.getTileByID(M);x(r,k),x(k,r)}}function x(E,M){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let k=M.tileID.canonical.x-E.tileID.canonical.x;const B=M.tileID.canonical.y-E.tileID.canonical.y,G=Math.pow(2,E.tileID.canonical.z),J=M.tileID.key;k===0&&B===0||Math.abs(B)>1||(Math.abs(k)>1&&(Math.abs(k+G)===1?k+=G:Math.abs(k-G)===1&&(k-=G)),M.dem&&E.dem&&(E.dem.backfillBorder(M.dem,k,B),E.neighboringTiles&&E.neighboringTiles[J]&&(E.neighboringTiles[J].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h,x,E){for(const M in this._tiles){let k=this._tiles[M];if(E[M]||!k.hasData()||k.tileID.overscaledZ<=h||k.tileID.overscaledZ>x)continue;let B=k.tileID;for(;k&&k.tileID.overscaledZ>h+1;){const J=k.tileID.scaledTo(k.tileID.overscaledZ-1);k=this._tiles[J.key],k&&k.hasData()&&(B=J)}let G=B;for(;G.overscaledZ>h;)if(G=G.scaledTo(G.overscaledZ-1),r[G.key]){E[B.key]=B;break}}}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const x=this._loadedParentTiles[r.key];return x&&x.tileID.overscaledZ>=h?x:null}for(let x=r.overscaledZ-1;x>=h;x--){const E=r.scaledTo(x),M=this._getLoadedTile(E);if(M)return M}}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,h){h=h||this._source.tileSize;const x=Math.ceil(r.width/h)+1,E=Math.ceil(r.height/h)+1,M=Math.floor(x*E*5),k=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,M):M,B=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(B)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const x={};for(const E in this._tiles){const M=this._tiles[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),x[M.tileID.key]=M}this._tiles=x;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(r,h,x,E,M){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!x)return;this.updateCacheSize(r,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const k=this._source.type==="batched-model";let B,G=this._source.maxzoom;const J=this.map&&this.map.painter?this.map.painter._terrain:null;if(J&&J.sourceCache===this&&J.attenuationRange()){const le=J.attenuationRange()[0],he=Math.floor(le)-Math.log2(J.getDemUpscale());G>he&&(G=he)}if(this.used||this.usedForTerrain){if(this._source.tileID)B=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((le=>new t.aQ(le.canonical.z,le.wrap,le.canonical.z,le.canonical.x,le.canonical.y)));else if(this.tileCoverLift!==0){const le=r.clone();le.tileCoverLift=this.tileCoverLift,B=le.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:G,roundZoom:this._source.roundZoom&&!x,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.minzoom<=1&&r.projection.name==="globe"&&(B.push(new t.aQ(1,0,1,0,0)),B.push(new t.aQ(1,0,1,1,0)),B.push(new t.aQ(1,0,1,0,1)),B.push(new t.aQ(1,0,1,1,1)))}else if(B=r.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:G,roundZoom:this._source.roundZoom&&!x,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.hasTile){const le=this._source.hasTile.bind(this._source);B=B.filter((he=>le(he)))}}else B=[];if(B.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!el(this._source.type)){const le=r.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!x}),he=Math.min(le,this._source.maxzoom);if(k){const be=r.extendTileCover(B,he);for(const _e of be)B.push(_e)}else if(M){const be=r.extendTileCoverToNearPlane(B,this.transform.getFrustum(he),he);for(const _e of be)B.push(_e)}else if(this.castsShadows&&E){const be=r.extendTileCover(B,he,E,16);for(const _e of be)this._shadowCasterTiles[_e.key]=!0,B.push(_e)}}const ee=this._updateRetainedTiles(B);if(el(this._source.type)&&B.length!==0){const le={},he={},be=Object.keys(ee);for(const ke of be){const Ae=ee[ke],Oe=this._tiles[ke];if(!Oe||Oe.fadeEndTime&&Oe.fadeEndTime<=t.o.now())continue;const He=this.findLoadedParent(Ae,Math.max(Ae.overscaledZ-Ko.maxOverzooming,this._source.minzoom));He&&(this._addTile(He.tileID),le[He.tileID.key]=He.tileID),he[ke]=Ae}const _e=B[B.length-1].overscaledZ;for(const ke in this._tiles){const Ae=this._tiles[ke];if(ee[ke]||!Ae.hasData())continue;let Oe=Ae.tileID;for(;Oe.overscaledZ>_e;){Oe=Oe.scaledTo(Oe.overscaledZ-1);const He=this._tiles[Oe.key];if(He&&He.hasData()&&he[Oe.key]){ee[ke]=Ae.tileID;break}}}for(const ke in le)ee[ke]||(this._coveredTiles[ke]=!0,ee[ke]=le[ke])}for(const le in ee)this._tiles[le].clearFadeHold();const ce=t.bv(this._tiles,ee);for(const le of ce){const he=this._tiles[le];he.hasSymbolBuckets&&!he.holdingForFade()?he.setHoldDuration(this.map._fadeDuration):he.hasSymbolBuckets&&!he.symbolFadeFinished()||this._removeTile(+le)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const h={};if(r.length===0)return h;const x={},E=r.reduce(((J,ee)=>Math.min(J,ee.overscaledZ)),1/0),M=r[0].overscaledZ,k=Math.max(M-Ko.maxOverzooming,this._source.minzoom),B=Math.max(M+Ko.maxUnderzooming,this._source.minzoom),G={};for(const J of r){const ee=this._addTile(J);h[J.key]=J,ee.hasData()||E<this._source.maxzoom&&(G[J.key]=J)}this._retainLoadedChildren(G,E,B,h);for(const J of r){let ee=this._tiles[J.key];if(ee.hasData())continue;if(J.canonical.z>=this._source.maxzoom){const le=J.children(this._source.maxzoom)[0],he=this.getTile(le);if(he&&he.hasData()){h[le.key]=le;continue}}else{const le=J.children(this._source.maxzoom);if(h[le[0].key]&&h[le[1].key]&&h[le[2].key]&&h[le[3].key])continue}let ce=ee.wasRequested();for(let le=J.overscaledZ-1;le>=k;--le){const he=J.scaledTo(le);if(x[he.key]||(x[he.key]=!0,ee=this.getTile(he),!ee&&ce&&(ee=this._addTile(he)),ee&&(h[he.key]=he,ce=ee.wasRequested(),ee.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let x,E=this._tiles[r].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){x=this._loadedParentTiles[E.key];break}h.push(E.key);const M=E.scaledTo(E.overscaledZ-1);if(x=this._getLoadedTile(M),x)break;E=M}for(const M of h)this._loadedParentTiles[M]=x}}_addTile(r){let h=this._tiles[r.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const x=!!h;if(!x){const E=this.map?this.map.painter:null,M=this._source.tileSize*r.overscaleFactor();h=this._source.type==="raster-array"?new Jr(r,M,this.transform.tileZoom,E,this._isRaster):new Vo(r,M,this.transform.tileZoom,E,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,r.key,h.state))}return h.uses++,this._tiles[r.key]=h,x||this._source.fire(new t.z("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const x=h.getExpiryTimeout();x&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),x))}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,h,x){const E=[],M=this.transform;if(!M)return E;const k=M.projection.name==="globe",B=t.aF(M.center.lng);for(const G in this._tiles){const J=this._tiles[G];if(x&&J.clearQueryDebugViz(),J.holdingForFade())continue;let ee;if(k){const ce=J.tileID.canonical;if(ce.z===0){const le=[Math.abs(t.aA(B,...Tc(ce,-1))-B),Math.abs(t.aA(B,...Tc(ce,1))-B)];ee=[0,2*le.indexOf(Math.min(...le))-1]}else{const le=[Math.abs(t.aA(B,...Tc(ce,-1))-B),Math.abs(t.aA(B,...Tc(ce,0))-B),Math.abs(t.aA(B,...Tc(ce,1))-B)];ee=[le.indexOf(Math.min(...le))-1]}}else ee=[0];for(const ce of ee){const le=r.containsTile(J,M,h,ce);le&&E.push(le)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,h){const x=this.getRenderableIds(r,h).map((M=>this._tiles[M].tileID)),E=this.transform.projection.name==="globe";for(const M of x)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=E?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return x}sortCoordinatesByDistance(r){const h=r.slice(),x=this.transform._camera.position,E=this.transform._camera.forward(),M={};for(const k of h){const B=1/(1<<k.canonical.z);M[k.key]=((k.canonical.x+.5)*B+k.wrap-x[0])*E[0]+((k.canonical.y+.5)*B-x[1])*E[1]-x[2]*E[2]}return h.sort(((k,B)=>M[k.key]-M[B.key])),h}hasTransition(){if(this._source.hasTransition())return!0;if(el(this._source.type))for(const r in this._tiles){const h=this._tiles[r];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=t.o.now())return!0}return!1}setFeatureState(r,h,x){this._state.updateState(r=r||"_geojsonTileLayer",h,x)}removeFeatureState(r,h,x){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,x)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,x){const E=this._tiles[r];E&&E.setDependencies(h,x)}reloadTilesForDependencies(r,h){for(const x in this._tiles)this._tiles[x].hasDependency(r,h)&&this._reloadTile(+x,"reloading");this._cache.filter((x=>!x.hasDependency(r,h)))}_preloadTiles(r,h){if(!this._sourceLoaded){const G=()=>{this._sourceLoaded&&(this._source.off("data",G),this._preloadTiles(r,h))};return void this._source.on("data",G)}const x=new Map,E=Array.isArray(r)?r:[r],M=this.map.painter.terrain,k=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const G of E){const J=G.coveringTiles({tileSize:k,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ee of J)x.set(ee.key,ee);this.usedForTerrain&&G.updateElevation(!1)}const B=Array.from(x.values());t.bw(B,((G,J)=>{const ee=new Vo(G,this._source.tileSize*G.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(ee,(ce=>{this._source.type==="raster-dem"&&ee.dem&&this._backfillDEM(ee),J(ce,ee)}))}),h)}}function Zl(v,r){const h=Math.abs(2*v.wrap)-+(v.wrap<0),x=Math.abs(2*r.wrap)-+(r.wrap<0);return v.overscaledZ-r.overscaledZ||x-h||r.canonical.y-v.canonical.y||r.canonical.x-v.canonical.x}function el(v){return v==="raster"||v==="image"||v==="video"||v==="custom"}function Tc(v,r){const h=1<<v.z;return[v.x/h+r,(v.x+1)/h+r]}Ko.maxOverzooming=10,Ko.maxUnderzooming=3;class fd{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,h=!1;for(const x in this.style._mergedLayers){const E=this.style._mergedLayers[x];if(E.type==="fill-extrusion"||E.type==="building")this.layers.push({layer:E,visible:r,visibilityChanged:h});else if(E.type==="model"){const M=this.style.getLayerSource(E);M&&M.type==="batched-model"&&this.layers.push({layer:E,visible:r,visibilityChanged:h})}}}onNewFrame(r){this.layersGotHidden=!1;for(const h of this.layers){const x=h.layer;let E=!1;x.type==="fill-extrusion"?E=!x.isHidden(r)&&x.paint.get("fill-extrusion-opacity")>0:x.type==="building"?E=!x.isHidden(r)&&x.paint.get("building-opacity")>0:x.type==="model"&&(E=!x.isHidden(r)&&x.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!E&&h.visible,h.visible=E}}updateZOffset(r,h){this.currentBuildingBuckets=[];for(const E of this.layers){const M=E.layer,k=this.style.getLayerSourceCache(M);let B=1;M.type==="fill-extrusion"?B=E.visible?M.paint.get("fill-extrusion-vertical-scale"):0:M.type==="building"&&(B=E.visible?M.paint.get("building-vertical-scale"):0);let G=k?k.getTile(h):null;if(!G&&k)for(const J in k._tiles){const ee=k._tiles[J];if(h.canonical.isChildOf(ee.tileID.canonical)){G=ee;break}}this.currentBuildingBuckets.push({bucket:G?G.getBucket(M):null,tileID:G?G.tileID:h,verticalScale:B})}r.hasAnyZOffset=!1;let x=!1;for(let E=0;E<r.symbolInstances.length;E++){const M=r.symbolInstances.get(E),k=M.zOffset,B=this._getHeightAtTileOffset(h,M.tileAnchorX,M.tileAnchorY);M.zOffset=B!==Number.NEGATIVE_INFINITY?B:k,x||k===M.zOffset||(x=!0),r.hasAnyZOffset||M.zOffset===0||(r.hasAnyZOffset=!0)}x&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,h,x,E){let M=h,k=x;if(r.canonical.z!==E.canonical.z){const B=E.canonical,G=1/(1<<r.canonical.z-B.z);M=(h+r.canonical.x*t.al)*G-B.x*t.al|0,k=(x+r.canonical.y*t.al)*G-B.y*t.al|0}return{tileX:M,tileY:k}}_getHeightAtTileOffset(r,h,x){let E,M;for(let k=0;k<this.layers.length;++k){const B=this.layers[k].layer;if(B.type!=="fill-extrusion"&&B.type!=="building")continue;const{bucket:G,tileID:J,verticalScale:ee}=this.currentBuildingBuckets[k];if(!G)continue;const{tileX:ce,tileY:le}=this._mapCoordToOverlappingTile(r,h,x,J),he=G.getHeightAtTileCoord(ce,le);he&&he.height!==void 0&&(he.hidden?E=he.height:M=Math.max(he.height*ee,M||0))}if(M!==void 0)return M;for(let k=0;k<this.layers.length;++k){const B=this.layers[k];if(B.layer.type!=="model"||!B.visible)continue;const{bucket:G,tileID:J}=this.currentBuildingBuckets[k];if(!G)continue;const{tileX:ee,tileY:ce}=this._mapCoordToOverlappingTile(r,h,x,J),le=G.getHeightAtTileCoord(ee,ce);if(le&&!le.hidden)return le.height===void 0&&E!==void 0?Math.min(le.maxHeight,E)*le.verticalScale:le.height?le.height*le.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function za(v,r){const h={};for(const x in v)x!=="ref"&&(h[x]=v[x]);return t.bx.forEach((x=>{x in r&&(h[x]=r[x])})),h}function Iu(v){v=v.slice();const r=Object.create(null);for(let h=0;h<v.length;h++)r[v[h].id]=v[h];for(let h=0;h<v.length;h++)"ref"in v[h]&&(v[h]=za(v[h],r[v[h].ref]));return v}const $r={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Kd(v,r,h){h.push({command:$r.addSource,args:[v,r[v]]})}function Xl(v,r,h){r.push({command:$r.removeSource,args:[v]}),h[v]=!0}function pd(v,r,h,x){Xl(v,h,x),Kd(v,r,h)}function Ju(v,r,h){let x;for(x in v[h])if(v[h].hasOwnProperty(x)&&x!=="data"&&!t.by(v[h][x],r[h][x]))return!1;for(x in r[h])if(r[h].hasOwnProperty(x)&&x!=="data"&&!t.by(v[h][x],r[h][x]))return!1;return!0}function Lh(v,r,h,x,E,M){let k;for(k in r=r||{},v=v||{})v.hasOwnProperty(k)&&(t.by(v[k],r[k])||h.push({command:M,args:[x,k,r[k],E]}));for(k in r)r.hasOwnProperty(k)&&!v.hasOwnProperty(k)&&(t.by(v[k],r[k])||h.push({command:M,args:[x,k,r[k],E]}))}function Jd(v){return v.id}function Cu(v,r){return v[r.id]=r,v}function jo(v,r,h){const x=r.createTileMatrix(v,v.worldSize,h.toUnwrapped());return t.aB(new Float32Array(16),v.projMatrix,x)}function Rh(v,r,h){if(r.projection.name===h.projection.name)return v.projMatrix;const x=h.clone();return x.setProjection(r.projection),jo(x,r.getProjection(),v)}function Cs(v,r,h){return r.name===h.projection.name?v.projMatrix:jo(h,r,v)}class ms{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=t.aA(r,0,1);let h=1,x=this._distances[h];const E=r*this.paddedLength+this.padding;for(;x<E&&h<this._distances.length;)x=this._distances[++h];const M=h-1,k=this._distances[M],B=x-k,G=B>0?(E-k)/B:0;return this.points[M].mult(1-G).add(this.points[h].mult(G))}}class md{constructor(r,h,x){const E=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(r/x),this.yCellCount=Math.ceil(h/x);for(let k=0;k<this.xCellCount*this.yCellCount;k++)E.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,x,E,M){this._forEachCell(h,x,E,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(x),this.bboxes.push(E),this.bboxes.push(M)}insertCircle(r,h,x,E){this._forEachCell(h-E,x-E,h+E,x+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(x),this.circles.push(E)}_insertBoxCell(r,h,x,E,M,k){this.boxCells[M].push(k)}_insertCircleCell(r,h,x,E,M,k){this.circleCells[M].push(k)}_query(r,h,x,E,M,k){if(x<0||r>this.width||E<0||h>this.height)return!M&&[];const B=[];if(r<=0&&h<=0&&this.width<=x&&this.height<=E){if(M)return!0;for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const J=this.circles[3*G],ee=this.circles[3*G+1],ce=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:J-ce,y1:ee-ce,x2:J+ce,y2:ee+ce})}return k?B.filter(k):B}return this._forEachCell(r,h,x,E,this._queryCell,B,{hitTest:M,seenUids:{box:{},circle:{}}},k),M?B.length>0:B}_queryCircle(r,h,x,E,M){const k=r-x,B=r+x,G=h-x,J=h+x;if(B<0||k>this.width||J<0||G>this.height)return!E&&[];const ee=[];return this._forEachCell(k,G,B,J,this._queryCellCircle,ee,{hitTest:E,circle:{x:r,y:h,radius:x},seenUids:{box:{},circle:{}}},M),E?ee.length>0:ee}query(r,h,x,E,M){return this._query(r,h,x,E,!1,M)}hitTest(r,h,x,E,M){return this._query(r,h,x,E,!0,M)}hitTestCircle(r,h,x,E){return this._queryCircle(r,h,x,!0,E)}_queryCell(r,h,x,E,M,k,B,G){const J=B.seenUids,ee=this.boxCells[M];if(ee!==null){const le=this.bboxes;for(const he of ee)if(!J.box[he]){J.box[he]=!0;const be=4*he;if(r<=le[be+2]&&h<=le[be+3]&&x>=le[be+0]&&E>=le[be+1]&&(!G||G(this.boxKeys[he]))){if(B.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[he],x1:le[be],y1:le[be+1],x2:le[be+2],y2:le[be+3]})}}}const ce=this.circleCells[M];if(ce!==null){const le=this.circles;for(const he of ce)if(!J.circle[he]){J.circle[he]=!0;const be=3*he;if(this._circleAndRectCollide(le[be],le[be+1],le[be+2],r,h,x,E)&&(!G||G(this.circleKeys[he]))){if(B.hitTest)return k.push(!0),!0;{const _e=le[be],ke=le[be+1],Ae=le[be+2];k.push({key:this.circleKeys[he],x1:_e-Ae,y1:ke-Ae,x2:_e+Ae,y2:ke+Ae})}}}}}_queryCellCircle(r,h,x,E,M,k,B,G){const J=B.circle,ee=B.seenUids,ce=this.boxCells[M];if(ce!==null){const he=this.bboxes;for(const be of ce)if(!ee.box[be]){ee.box[be]=!0;const _e=4*be;if(this._circleAndRectCollide(J.x,J.y,J.radius,he[_e+0],he[_e+1],he[_e+2],he[_e+3])&&(!G||G(this.boxKeys[be])))return k.push(!0),!0}}const le=this.circleCells[M];if(le!==null){const he=this.circles;for(const be of le)if(!ee.circle[be]){ee.circle[be]=!0;const _e=3*be;if(this._circlesCollide(he[_e],he[_e+1],he[_e+2],J.x,J.y,J.radius)&&(!G||G(this.circleKeys[be])))return k.push(!0),!0}}}_forEachCell(r,h,x,E,M,k,B,G){const J=this._convertToXCellCoord(r),ee=this._convertToYCellCoord(h),ce=this._convertToXCellCoord(x),le=this._convertToYCellCoord(E);for(let he=J;he<=ce;he++)for(let be=ee;be<=le;be++)if(M.call(this,r,h,x,E,this.xCellCount*be+he,k,B,G))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,x,E,M,k){const B=E-r,G=M-h,J=x+k;return J*J>B*B+G*G}_circleAndRectCollide(r,h,x,E,M,k,B){const G=(k-E)/2,J=Math.abs(r-(E+G));if(J>G+x)return!1;const ee=(B-M)/2,ce=Math.abs(h-(M+ee));if(ce>ee+x)return!1;if(J<=G||ce<=ee)return!0;const le=J-G,he=ce-ee;return le*le+he*he<=x*x}}const js={unknown:0,flipRequired:1,flipNotRequired:2},Au=Math.tan(85*Math.PI/180);function Jo(v,r,h,x,E,M,k){const B=t.bC();if(h)if(M.name==="globe"){const G=t.bD(E,r);t.aB(B,B,G)}else{const G=t.bE([],k);B[0]=G[0],B[1]=G[1],B[4]=G[2],B[5]=G[3],x||t.bB(B,B,E.angle)}else t.aB(B,E.labelPlaneMatrix,v);return B}function zh(v,r,h,x,E,M,k){const B=Jo(v,r,h,x,E,M,k);return M.name==="globe"&&h||(B[2]=B[6]=B[10]=B[14]=0),B}function au(v,r,h,x,E,M,k){if(h){if(M.name==="globe"){const B=Jo(v,r,h,x,E,M,k);return t.bl(B,B),t.aB(B,v,B),B}{const B=t.bz(v),G=t.bA([]);return G[0]=k[0],G[1]=k[1],G[4]=k[2],G[5]=k[3],t.aB(B,B,G),x||t.bB(B,B,-E.angle),B}}return E.glCoordMatrix}function Uc(v,r,h,x){const E=[v,r,h,1];h?t.aC(E,E,x):vn(E,E,x);const M=E[3];return E[0]/=M,E[1]/=M,E[2]/=M,E}function ps(v,r){return Math.min(.5+v/r*.5,1.5)}function km(v,r){const h=v[0]/v[3],x=v[1]/v[3];return h>=-r[0]&&h<=r[0]&&x>=-r[1]&&x<=r[1]}function sy(v,r,h,x,E,M,k,B,G,J,ee=1){const ce=h.transform,le=x?v.textSizeData:v.iconSizeData,he=t.bK(le,h.transform.zoom,ee),be=ce.projection.name==="globe",_e=[256/h.width*2+1,256/h.height*2+1],ke=x?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;ke.clear();let Ae=null;be&&(Ae=x?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const Oe=v.lineVertexArray,He=x?v.text.placedSymbolArray:v.icon.placedSymbolArray,Be=h.transform.width/h.transform.height;let dt,nt=!1;for(let at=0;at<He.length;at++){const tt=He.get(at),{numGlyphs:Je,writingMode:mt}=tt;if(mt!==t.bL.vertical||nt||dt===t.bL.horizontal||(nt=!0),dt=mt,(tt.hidden||mt===t.bL.vertical)&&!nt){dc(Je,ke);continue}nt=!1;const Pt=new t.P(tt.tileAnchorX,tt.tileAnchorY),It=v.elevationType==="road",ri=!!ce.elevation||It;let{x:si,y:_i,z:Vi}=ce.projection.projectTilePoint(Pt.x,Pt.y,J.canonical),Kt=null;if(ri){const Tn=It?v.getElevationFeatureForText(at):null;Kt={getElevation:G,elevation:ce.elevation,elevationFeature:Tn};const[Kn,Er,ts]=G(Pt,ce.elevation,Tn);si+=Kn,_i+=Er,Vi+=ts}const bt=[si,_i,Vi,1];if(t.aC(bt,bt,r),!km(bt,_e)){dc(Je,ke);continue}const oi=bt[3],ni=ps(h.transform.getCameraToCenterDistance(ce.projection),oi),Li=t.bM(le,he,tt),en=k?Li/ni:Li*ni,xn=Uc(si,_i,Vi,E);if(xn[3]<=0){dc(Je,ke);continue}let Yi={};const Wi=t.an(v.layers[0].layout.get("text-max-angle")),kn=Math.cos(Wi),Pn=k?null:Kt,pn=lu(tt,en,!1,B,r,E,M,v.glyphOffsetArray,Oe,ke,Ae,xn,Pt,Yi,Be,Pn,ce.projection,J,k,kn);nt=pn.useVertical,Pn&&pn.needsFlipping&&(Yi={}),(pn.notEnoughRoom||nt||pn.needsFlipping&&lu(tt,en,!0,B,r,E,M,v.glyphOffsetArray,Oe,ke,Ae,xn,Pt,Yi,Be,Pn,ce.projection,J,k,kn).notEnoughRoom)&&dc(Je,ke)}x?(v.text.dynamicLayoutVertexBuffer.updateData(ke),Ae&&v.text.globeExtVertexBuffer&&v.text.globeExtVertexBuffer.updateData(Ae)):(v.icon.dynamicLayoutVertexBuffer.updateData(ke),Ae&&v.icon.globeExtVertexBuffer&&v.icon.globeExtVertexBuffer.updateData(Ae))}function Fg(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke){const{lineStartIndex:Ae,glyphStartIndex:Oe,segment:He}=B,Be=Oe+B.numGlyphs,dt=Ae+B.lineLength,nt=r.getoffsetX(Oe),at=r.getoffsetX(Be-1),tt=gd(v*nt,h,x,E,M,k,He,Ae,dt,G,J,ee,ce,le,!0,he,be,_e,ke);if(!tt)return null;const Je=gd(v*at,h,x,E,M,k,He,Ae,dt,G,J,ee,ce,le,!0,he,be,_e,ke);return Je?{first:tt,last:Je}:null}function Gn(v,r,h,x){return v===t.bL.horizontal&&Math.abs(x)>Math.abs(h)?{useVertical:!0}:v===t.bL.vertical?x>0?{needsFlipping:!0}:null:r!==js.unknown&&(function(E,M){return E===0||Math.abs(M/E)>Au})(h,x)?r===js.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function lu(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe,He){const Be=r/24,dt=v.lineOffsetX*Be,nt=v.lineOffsetY*Be,{lineStartIndex:at,glyphStartIndex:tt,numGlyphs:Je,segment:mt,writingMode:Pt,flipState:It}=v,ri=at+v.lineLength,si=_i=>{if(ee){const[oi,ni,Li]=_i.up,en=J.length;t.bN(ee,en+0,oi,ni,Li),t.bN(ee,en+1,oi,ni,Li),t.bN(ee,en+2,oi,ni,Li),t.bN(ee,en+3,oi,ni,Li)}const[Vi,Kt,bt]=_i.point;t.bO(J,Vi,Kt,bt,_i.angle)};if(Je>1){const _i=Fg(Be,B,dt,nt,h,ce,le,v,G,M,he,_e,!1,ke,Ae,Oe,He);if(!_i)return{notEnoughRoom:!0};if(x&&!h){let[Vi,Kt,bt]=_i.first.point,[oi,ni,Li]=_i.last.point;[Vi,Kt]=Uc(Vi,Kt,bt,k),[oi,ni]=Uc(oi,ni,Li,k);const en=Gn(Pt,It,(oi-Vi)*be,ni-Kt);if(v.flipState=en&&en.needsFlipping?js.flipRequired:js.flipNotRequired,en)return en}si(_i.first);for(let Vi=tt+1;Vi<tt+Je-1;Vi++){const Kt=gd(Be*B.getoffsetX(Vi),dt,nt,h,ce,le,mt,at,ri,G,M,he,_e,!1,!1,ke,Ae,Oe,He);if(!Kt)return J.length-=4*(Vi-tt),{notEnoughRoom:!0};si(Kt)}si(_i.last)}else{if(x&&!h){const Vi=Uc(le.x,le.y,0,E),Kt=at+mt+1,bt=new t.P(G.getx(Kt),G.gety(Kt)),oi=Uc(bt.x,bt.y,0,E),ni=oi[3]>0?oi:Al(le,bt,Vi,1,E,void 0,ke,Ae.canonical),Li=Gn(Pt,It,(ni[0]-Vi[0])*be,ni[1]-Vi[1]);if(v.flipState=Li&&Li.needsFlipping?js.flipRequired:js.flipNotRequired,Li)return Li}const _i=gd(Be*B.getoffsetX(tt),dt,nt,h,ce,le,mt,at,ri,G,M,he,_e,!1,!1,ke,Ae,Oe,He);if(!_i)return{notEnoughRoom:!0};si(_i)}return{}}function Xo(v,r,h,x,E){const{x:M,y:k,z:B}=x.projectTilePoint(v.x,v.y,r);if(!E)return Uc(M,k,B,h);const[G,J,ee]=E.getElevation(v,E.elevation,E.elevationFeature);return Uc(M+G,k+J,B+ee,h)}function Al(v,r,h,x,E,M,k,B){const G=Xo(v.sub(r)._unit()._add(v),B,E,k,M);return t.av(G,h,G),t.aw(G,G),t.bH(G,h,G,x)}function gd(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe){const He=x?v-r:v+r;let Be=He>0?1:-1,dt=0;x&&(Be*=-1,dt=Math.PI),Be<0&&(dt+=Math.PI);let nt=B+k+(Be>0?0:1)|0,at=E,tt=E,Je=0,mt=0;const Pt=Math.abs(He),It=[],ri=[];let si=M,_i=si,Vi=t.bF([]);const Kt=()=>Al(_i,si,tt,Pt-Je+1,ee,le,_e,ke.canonical);for(;Je+mt<=Pt;){if(nt+=Be,nt<B||nt>=G)return null;if(tt=at,_i=si,It.push(tt),he&&ri.push(_i),si=new t.P(J.getx(nt),J.gety(nt)),at=ce[nt],!at){const Pn=Xo(si,ke.canonical,ee,_e,le);at=Pn[3]>0?ce[nt]=Pn:Kt()}Je+=mt;const Wi=t.av([],at,tt),kn=t.bG(tt,at);if(h&&kn>0&&mt>0&&t.bJ(Vi,Wi)/(mt*kn)<Oe)return null;mt=kn,Vi=Wi}be&&le&&(ce[nt]&&(at=Kt(),mt=t.bG(tt,at),Vi=t.av([],at,tt)),ce[nt]=at);const bt=(Pt-Je)/mt,oi=si.sub(_i)._mult(bt)._add(_i),ni=t.bH([],tt,Vi,bt);let Li=[0,0,1],en=Vi[0],xn=Vi[1];if(Ae&&(Li=_e.upVector(ke.canonical,oi.x,oi.y),Li[0]!==0||Li[1]!==0||Li[2]!==1)){const Wi=[Li[2],0,-Li[0]],kn=t.bI([],Li,Wi);t.aw(Wi,Wi),t.aw(kn,kn),en=t.bJ(Vi,Wi),xn=t.bJ(Vi,kn)}if(h){const Wi=t.bI([],Li,Vi);t.aw(Wi,Wi),t.bH(ni,ni,Wi,h*Be)}const Yi=dt+Math.atan2(xn,en);return It.push(ni),he&&ri.push(oi),{point:ni,angle:Yi,path:It,tilePath:ri,up:Li}}function dc(v,r){const h=r.length,x=h+4*v;r.resize(x),r.float32.fill(-1/0,4*h,4*x)}function vn(v,r,h){const x=r[0],E=r[1];return v[0]=h[0]*x+h[4]*E+h[12],v[1]=h[1]*x+h[5]*E+h[13],v[3]=h[3]*x+h[7]*E+h[15],v}const Qr=100;class ws{constructor(r,h,x=new md(r.width+200,r.height+200,25),E=new md(r.width+200,r.height+200,25)){this.transform=r,this.grid=x,this.ignoredGrid=E,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Qr,this.screenBottomBoundary=r.height+Qr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=h}placeCollisionBox(r,h,x,E,M,k,B,G,J,ee,ce){let le=x.projectedAnchorX,he=x.projectedAnchorY,be=x.projectedAnchorZ;const _e=x.tileAnchorX,ke=x.tileAnchorY,Ae=x.elevation,Oe=x.tileID,He=r.getProjection();if(Ae&&Oe){const[ri,si,_i]=He.upVector(Oe.canonical,x.tileAnchorX,x.tileAnchorY),Vi=He.upVectorScale(Oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;le+=ri*Ae*Vi,he+=si*Ae*Vi,be+=_i*Ae*Vi}const Be=r.projection.name==="globe",dt=r.projection.name==="globe"?t.aj(this.transform.zoom):0;if(Oe&&Be&&dt<1&&!k){const ri=1<<Oe.canonical.z,si=t.bP(_e,ke);t.bQ(si,si,1/t.al),t.bR(si,si,t.bP(Oe.canonical.x,Oe.canonical.y)),t.bQ(si,si,1/ri),t.bS(si,si,t.bP(E[0],E[1])),si[0]=t.bT(si[0],-.5,.5),t.bQ(si,si,t.al);const _i=t.bU(si[0],si[1],t.al/(2*Math.PI),1);t.aC(_i,_i,M),le=t.ak(le,_i[0],dt),he=t.ak(he,_i[1],dt),be=t.ak(be,_i[2],dt)}const nt=this.projectAndGetPerspectiveRatio(ee,le,he,be,x.tileID,He.name==="globe"||!!Ae||this.transform.pitch>0,He),at=J*nt.perspectiveRatio,tt=(x.x1*h+B.x-x.padding)*at+nt.point.x,Je=(x.y1*h+B.y-x.padding)*at+nt.point.y,mt=(x.x2*h+B.x+x.padding)*at+nt.point.x,Pt=(x.y2*h+B.y+x.padding)*at+nt.point.y,It=nt.perspectiveRatio<=.55||nt.occluded;return!this.isInsideGrid(tt,Je,mt,Pt)||!G&&this.grid.hitTest(tt,Je,mt,Pt,ce)||It?{box:[],offscreen:!1,occluded:nt.occluded}:{box:[tt,Je,mt,Pt],offscreen:this.isOffscreen(tt,Je,mt,Pt),occluded:!1}}placeCollisionCircles(r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke){const Ae=[],Oe=this.transform.elevation,He=r.getProjection(),Be=r.elevationType==="road",dt=!!Oe||Be,nt=t.bV.getAtTileOffsetFunc(ke,this.transform.center.lat,this.transform.worldSize,He),at=new t.P(x.tileAnchorX,x.tileAnchorY),tt=new t.P(x.tileAnchorX,x.tileAnchorY);let{x:Je,y:mt,z:Pt}=He.projectTilePoint(tt.x,tt.y,ke.canonical),It=null;if(dt){const kn=Be?r.getElevationFeatureForText(E):null;It={getElevation:nt,elevation:Oe,elevationFeature:kn};const[Pn,pn,Tn]=nt(at,Oe,kn);Je+=Pn,mt+=pn,Pt+=Tn}const ri=He.name==="globe",si=this.projectAndGetPerspectiveRatio(G,Je,mt,Pt,ke,ri||!!Oe||this.transform.pitch>0,He),{perspectiveRatio:_i}=si,Vi=(le?B/_i:B*_i)/t.bY,Kt=Uc(Je,mt,Pt,J),bt=x.lineOffsetX*Vi,oi=x.lineOffsetY*Vi,ni=t.an(r.layers[0].layout.get("text-max-angle")),Li=Math.cos(ni),en=si.signedDistanceFromCamera>0?Fg(Vi,k,bt,oi,Be&&x.flipState===1,Kt,tt,x,M,J,{},dt&&!le?It:null,le&&dt,He,ke,le,Li):null;let xn=!1,Yi=!1,Wi=!0;if(en&&!si.occluded){const kn=.5*be*_i+_e,Pn=new t.P(-100,-100),pn=new t.P(this.screenRightBoundary,this.screenBottomBoundary),Tn=new ms,{first:Kn,last:Er}=en,ts=Kn.path.length;let ys=[];for(let br=ts-1;br>=1;br--)ys.push(Kn.path[br]);for(let br=1;br<Er.path.length;br++)ys.push(Er.path[br]);const Ln=2.5*kn;ee&&(ys=ys.map((([br,Ts,zs],Os)=>(dt&&!ri&&(zs=nt(Os<ts-1?Kn.tilePath[ts-1-Os]:Er.tilePath[Os-ts+2],Oe,It.elevationFeature)[2]),Uc(br,Ts,zs,ee)))),ys.some((br=>br[3]<=0))&&(ys=[]));let fs=[];if(ys.length>0){let br=1/0,Ts=-1/0,zs=1/0,Os=-1/0;for(const ls of ys)br=Math.min(br,ls[0]),zs=Math.min(zs,ls[1]),Ts=Math.max(Ts,ls[0]),Os=Math.max(Os,ls[1]);Ts>=Pn.x&&br<=pn.x&&Os>=Pn.y&&zs<=pn.y&&(fs=[ys.map((ls=>new t.P(ls[0],ls[1])))],(br<Pn.x||Ts>pn.x||zs<Pn.y||Os>pn.y)&&(fs=t.bW(fs,Pn.x,Pn.y,pn.x,pn.y)))}for(const br of fs){Tn.reset(br,.25*kn);let Ts=0;Ts=Tn.length<=.5*kn?1:Math.ceil(Tn.paddedLength/Ln)+1;for(let zs=0;zs<Ts;zs++){const Os=zs/Math.max(Ts-1,1),ls=Tn.lerp(Os),Ar=ls.x+Qr,vs=ls.y+Qr;Ae.push(Ar,vs,kn,0);const ko=Ar-kn,yo=vs-kn,Ms=Ar+kn,cs=vs+kn;if(Wi=Wi&&this.isOffscreen(ko,yo,Ms,cs),Yi=Yi||this.isInsideGrid(ko,yo,Ms,cs),!h&&this.grid.hitTestCircle(Ar,vs,kn,he)&&(xn=!0,!ce))return{circles:[],offscreen:!1,collisionDetected:xn,occluded:!1}}}}return{circles:!ce&&xn||!Yi?[]:Ae,offscreen:Wi,collisionDetected:xn,occluded:si.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let x=1/0,E=1/0,M=-1/0,k=-1/0;for(const ee of r){const ce=new t.P(ee.x+Qr,ee.y+Qr);x=Math.min(x,ce.x),E=Math.min(E,ce.y),M=Math.max(M,ce.x),k=Math.max(k,ce.y),h.push(ce)}const B=this.grid.query(x,E,M,k).concat(this.ignoredGrid.query(x,E,M,k)),G={},J={};for(const ee of B){const ce=ee.key;if(G[ce.bucketInstanceId]===void 0&&(G[ce.bucketInstanceId]={}),G[ce.bucketInstanceId][ce.featureIndex])continue;const le=[new t.P(ee.x1,ee.y1),new t.P(ee.x2,ee.y1),new t.P(ee.x2,ee.y2),new t.P(ee.x1,ee.y2)];t.bX(h,le)&&(G[ce.bucketInstanceId][ce.featureIndex]=!0,J[ce.bucketInstanceId]===void 0&&(J[ce.bucketInstanceId]=[]),J[ce.bucketInstanceId].push(ce.featureIndex))}return J}insertCollisionBox(r,h,x,E,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:E,collisionGroupID:M},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,x,E,M){const k=h?this.ignoredGrid:this.grid,B={bucketInstanceId:x,featureIndex:E,collisionGroupID:M};for(let G=0;G<r.length;G+=4)k.insertCircle(B,r[G],r[G+1],r[G+2])}projectAndGetPerspectiveRatio(r,h,x,E,M,k,B){const G=[h,x,E,1];let J=!1;E||this.transform.pitch>0?(t.aC(G,G,r),this.fogState&&M&&B.name!=="globe"&&(J=(function(le,he,be,_e,ke,Ae){const Oe=Ae.calculateFogTileMatrix(ke),He=[he,be,_e];return t.af(He,He,Oe),yn(le,t.ag(He),Ae.pitch,Ae._fov)})(this.fogState,h,x,E,M.toUnwrapped(),this.transform)>.9)):vn(G,G,r);const ee=G[3];return{point:new t.P((G[0]/ee+1)/2*this.transform.width+Qr,(-G[1]/ee+1)/2*this.transform.height+Qr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(B)/ee*.5,1.5),signedDistanceFromCamera:ee,occluded:k&&G[2]>ee||J}}isOffscreen(r,h,x,E){return x<Qr||r>=this.screenRightBoundary||E<Qr||h>this.screenBottomBoundary}isInsideGrid(r,h,x,E){return x>=0&&r<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=t.bA([]);return t.br(r,r,[-100,-100,0]),r}}class Yl{constructor(r,h,x,E){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):E&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Qu{constructor(r,h,x,E,M,k=!1){this.text=new Yl(r?r.text:null,h,x,M),this.icon=new Yl(r?r.icon:null,h,E,M),this.clipped=k}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hs{constructor(r,h,x,E=!1){this.text=r,this.icon=h,this.skipFade=x,this.clipped=E}}class Qd{constructor(){this.invProjMatrix=t.bC(),this.viewportMatrix=t.bC(),this.circles=[]}}class eh{constructor(r,h,x,E,M){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=x,this.bucketIndex=E,this.tileID=M}}class ef{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:x=>x.collisionGroupID===h}}return this.collisionGroups[r]}}function Ua(v,r,h,x,E){const{horizontalAlign:M,verticalAlign:k}=t.c1(v),B=-(M-.5)*r,G=-(k-.5)*h,J=t.c2(v,x);return new t.P(B+J[0]*E,G+J[1]*E)}function Mo(v,r,h,x,E){const M=new t.P(v,r);return h&&M._rotate(x?E:-E),M}class $f{constructor(r,h,x,E,M,k){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ws(this.transform,M),this.buildingIndex=k,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ef(x),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(r,h,x,E,M=1){const k=x.getBucket(h),B=x.latestFeatureIndex;if(!k||!B||h.fqid!==k.layerIds[0])return;const G=k.layers[0].layout,J=k.layers[0].paint,ee=x.collisionBoxArray,ce=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),le=x.tileSize/t.al,he=x.tileID.toUnwrapped();this.transform.setProjection(k.projection);const be=(_e=x.tileID,ke=k.getProjection(),Ae=this.transform,ke.name===this.projection?Ae.calculateProjMatrix(_e.toUnwrapped()):jo(Ae,ke,_e));var _e,ke,Ae;const Oe=G.get("text-pitch-alignment")==="map",He=G.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Be=h.dynamicFilter(),dt=h.dynamicFilterNeedsFeature(),nt=this.transform.calculatePixelsToTileUnitsMatrix(x),at=zh(be,x.tileID.canonical,Oe,He,this.transform,k.getProjection(),nt);let tt=null;const Je=k.getProjection().createInversionMatrix(this.transform,x.tileID.canonical);if(Oe){const bt=au(be,x.tileID.canonical,Oe,He,this.transform,k.getProjection(),nt);tt=t.aB([],this.transform.labelPlaneMatrix,bt)}let mt=null;Be&&x.latestFeatureIndex&&(mt={unwrappedTileID:he,dynamicFilter:Be,dynamicFilterNeedsFeature:dt}),this.retainedQueryData[k.bucketInstanceId]=new eh(k.bucketInstanceId,B,k.sourceLayerIndex,k.index,x.tileID);const[Pt,It]=k.layers[0].layout.get("text-size-scale-range"),ri=t.aA(M,Pt,It),[si,_i]=G.get("icon-size-scale-range"),Vi=t.aA(M,si,_i),Kt={bucket:k,layout:G,paint:J,posMatrix:be,invMatrix:Je,mercatorCenter:[t.aF(this.transform.center.lng),t.aJ(this.transform.center.lat)],textLabelPlaneMatrix:at,labelToScreenMatrix:tt,clippingData:mt,scale:ce,textPixelRatio:le,holdingForFade:x.holdingForFade(),collisionBoxArray:ee,partiallyEvaluatedTextSize:t.bK(k.textSizeData,this.transform.zoom,ri),partiallyEvaluatedIconSize:t.bK(k.iconSizeData,this.transform.zoom,Vi),collisionGroup:this.collisionGroups.get(k.sourceID),latestFeatureIndex:x.latestFeatureIndex};if(E)for(const bt of k.sortKeyRanges){const{sortKey:oi,symbolInstanceStart:ni,symbolInstanceEnd:Li}=bt;r.push({sortKey:oi,symbolInstanceStart:ni,symbolInstanceEnd:Li,parameters:Kt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Kt})}attemptAnchorPlacement(r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe,He,Be,dt){const{textOffset0:nt,textOffset1:at,crossTileID:tt}=_e,Je=[nt,at],mt=Ua(r,k,B,Je,G),Pt=this.collisionIndex.placeCollisionBox(Ae,G,h,x,E,M,Mo(mt.x,mt.y,J,ee,this.transform.angle),be,ce,le,he.predicate);if(He){const It=Ae.getSymbolInstanceIconSize(dt,this.transform.zoom,_e.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ae,It,He,x,E,M,Mo(mt.x,mt.y,J,ee,this.transform.angle),be,ce,le,he.predicate).box.length===0)return}if(Pt.box.length>0){let It;return this.prevPlacement&&this.prevPlacement.variableOffsets[tt]&&this.prevPlacement.placements[tt]&&this.prevPlacement.placements[tt].text&&(It=this.prevPlacement.variableOffsets[tt].anchor),this.variableOffsets[tt]={textOffset:Je,width:k,height:B,anchor:r,textScale:G,prevAnchor:It},this.markUsedJustification(Ae,r,_e,Oe),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,Oe,_e),this.placedOrientations[tt]=Oe),{shift:mt,placedGlyphBoxes:Pt}}}placeLayerBucketPart(r,h,x,E,M=1){const{bucket:k,layout:B,paint:G,posMatrix:J,textLabelPlaneMatrix:ee,labelToScreenMatrix:ce,clippingData:le,textPixelRatio:he,mercatorCenter:be,invMatrix:_e,holdingForFade:ke,collisionBoxArray:Ae,partiallyEvaluatedTextSize:Oe,partiallyEvaluatedIconSize:He,collisionGroup:Be,latestFeatureIndex:dt}=r.parameters,nt=B.get("text-optional"),at=B.get("icon-optional"),tt=B.get("text-allow-overlap"),Je=B.get("icon-allow-overlap"),mt=B.get("text-rotation-alignment")==="map",Pt=B.get("icon-rotation-alignment")==="map",It=B.get("text-pitch-alignment")==="map",ri=G.get("symbol-z-offset"),si=B.get("symbol-elevation-reference")==="sea",_i=B.get("symbol-placement"),[Vi,Kt]=B.get("text-size-scale-range"),[bt,oi]=B.get("icon-size-scale-range"),ni=t.aA(M,Vi,Kt),Li=t.aA(M,bt,oi),en=B.get("text-variable-anchor"),xn=mt&&_i!=="point",Yi=Pt&&_i!=="point",Wi=en&&k.hasTextData(),kn=k.hasIconTextFit()&&Wi&&k.hasIconData();this.transform.setProjection(k.projection);const Pn=Wi||xn,pn=Yi||kn;let Tn=tt&&(Je||!k.hasIconData()||at),Kn=Je&&(tt||!k.hasTextData()||nt);const Er=!ri.isConstant();!k.collisionArrays&&Ae&&k.deserializeCollisionBoxes(Ae),x&&E&&k.updateCollisionDebugBuffers(this.transform.zoom,Ae,ni,Li);const ts=(Ln,fs,br)=>{const{crossTileID:Ts,numVerticalGlyphVertices:zs}=Ln;let Os=null;if(le&&le.dynamicFilterNeedsFeature||Er){const Do=this.retainedQueryData[k.bucketInstanceId];Os=dt.loadFeature({featureIndex:Ln.featureIndex,bucketIndex:Do.bucketIndex,sourceLayerIndex:Do.sourceLayerIndex,layoutVertexArrayOffset:0});const Go=Os.properties?Os.properties.worldview:null;if(k.localizable&&k.worldview&&typeof Go=="string")if(Go==="all")Os.properties.$localized=!0;else{if(!Go.split(",").includes(k.worldview))return;Os.properties.$localized=!0,Os.properties.worldview=k.worldview}}if(le&&!(0,le.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:k.worldview},Os,this.retainedQueryData[k.bucketInstanceId].tileID.canonical,new t.P(Ln.tileAnchorX,Ln.tileAnchorY),this.transform.calculateDistanceTileData(le.unwrappedTileID)))return this.placements[Ts]=new hs(!1,!1,!1,!0),void h.add(Ts);const ls=ri.evaluate(Os,{});if(h.has(Ts))return;if(ke)return void(this.placements[Ts]=new hs(!1,!1,!1));let Ar=!1,vs=!1,ko=!0,yo=!1,Ms=!1,cs=null,Pr={box:null,offscreen:null,occluded:null},co={box:null},Ss=null,uo=null,Zs=null,kc=0,Dl=0,Fa=0;br.textFeatureIndex?kc=br.textFeatureIndex:Ln.useRuntimeCollisionCircles&&(kc=Ln.featureIndex),br.verticalTextFeatureIndex&&(Dl=br.verticalTextFeatureIndex);const ec=k.elevationFeatures?k.elevationFeatures[Ln.elevationFeatureIndex]:void 0,Ul=Do=>{Do.tileID=this.retainedQueryData[k.bucketInstanceId].tileID;const Go=this.transform.elevation;Do.elevation=si?ls:ls+t.bV.getAtTileOffset(Do.tileID,new t.P(Do.tileAnchorX,Do.tileAnchorY),Go,ec),Do.elevation+=Ln.zOffset},Tl=br.textBox;if(Tl){Ul(Tl);const Do=Ds=>{let la=t.bL.horizontal;if(k.allowVerticalPlacement&&!Ds&&this.prevPlacement){const Lo=this.prevPlacement.placedOrientations[Ts];Lo&&(this.placedOrientations[Ts]=Lo,la=Lo,this.markUsedOrientation(k,la,Ln))}return la},Go=(Ds,la)=>{if(k.allowVerticalPlacement&&zs>0&&br.verticalTextBox){for(const Lo of k.writingModes)if(Lo===t.bL.vertical?(Pr=la(),co=Pr):Pr=Ds(),Pr&&Pr.box&&Pr.box.length)break}else Pr=Ds()};if(en){let Ds=en;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ts]){const Io=this.prevPlacement.variableOffsets[Ts];Ds.indexOf(Io.anchor)>0&&(Ds=Ds.filter((vh=>vh!==Io.anchor)),Ds.unshift(Io.anchor))}const la=(Io,vh,h_)=>{const Xh=k.getSymbolInstanceTextSize(Oe,Ln,this.transform.zoom,fs),d_=(Io.x2-Io.x1)*Xh+2*Io.padding,ug=(Io.y2-Io.y1)*Xh+2*Io.padding,Od=Ln.hasIconTextFit&&!Je?vh:null;Od&&Ul(Od);let Mf={box:[],offscreen:!1,occluded:!1};const hg=tt?2*Ds.length:Ds.length;for(let mp=0;mp<hg;++mp){const kf=this.attemptAnchorPlacement(Ds[mp%Ds.length],Io,be,_e,Pn,d_,ug,Xh,mt,It,he,J,Be,mp>=Ds.length,Ln,fs,k,h_,Od,Oe,He);if(kf&&(Mf=kf.placedGlyphBoxes,Mf&&Mf.box&&Mf.box.length)){Ar=!0,cs=kf.shift;break}}return Mf};Go((()=>la(Tl,br.iconBox,t.bL.horizontal)),(()=>{const Io=br.verticalTextBox;return Io&&Ul(Io),k.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&zs>0&&Io?la(Io,br.verticalIconBox,t.bL.vertical):{box:null,offscreen:null,occluded:null}})),Pr&&(Ar=Pr.box,ko=Pr.offscreen,yo=Pr.occluded);const Lo=Do(!(!Pr||!Pr.box));if(!Ar&&this.prevPlacement){const Io=this.prevPlacement.variableOffsets[Ts];Io&&(this.variableOffsets[Ts]=Io,this.markUsedJustification(k,Io.anchor,Ln,Lo))}}else{const Ds=(la,Lo)=>{const Io=k.getSymbolInstanceTextSize(Oe,Ln,this.transform.zoom,fs),vh=this.collisionIndex.placeCollisionBox(k,Io,la,be,_e,Pn,new t.P(0,0),tt,he,J,Be.predicate);return vh&&vh.box&&vh.box.length&&(this.markUsedOrientation(k,Lo,Ln),this.placedOrientations[Ts]=Lo),vh};Go((()=>Ds(Tl,t.bL.horizontal)),(()=>{const la=br.verticalTextBox;return k.allowVerticalPlacement&&zs>0&&la?(Ul(la),Ds(la,t.bL.vertical)):{box:null,offscreen:null,occluded:null}})),Do(!!(Pr&&Pr.box&&Pr.box.length))}}if(Ss=Pr,Ar=Ss&&Ss.box&&Ss.box.length>0,ko=Ss&&Ss.offscreen,yo=Ss&&Ss.occluded,Ln.useRuntimeCollisionCircles){const Do=Ln.centerJustifiedTextSymbolIndex>=0?Ln.centerJustifiedTextSymbolIndex:Ln.verticalPlacedTextSymbolIndex,Go=k.text.placedSymbolArray.get(Do),Ds=t.bM(k.textSizeData,Oe,Go),la=B.get("text-padding");uo=this.collisionIndex.placeCollisionCircles(k,tt,Go,Do,k.lineVertexArray,k.glyphOffsetArray,Ds,J,ee,ce,x,It,Be.predicate,Ln.collisionCircleDiameter*Ds/t.bY,la,this.retainedQueryData[k.bucketInstanceId].tileID),Ar=tt||uo.circles.length>0&&!uo.collisionDetected,ko=ko&&uo.offscreen,yo=uo.occluded}if(br.iconFeatureIndex&&(Fa=br.iconFeatureIndex),br.iconBox){const Do=Go=>{Ul(Go);const Ds=Ln.hasIconTextFit&&cs?Mo(cs.x,cs.y,mt,It,this.transform.angle):new t.P(0,0),la=k.getSymbolInstanceIconSize(He,this.transform.zoom,Ln.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(k,la,Go,be,_e,pn,Ds,Je,he,J,Be.predicate)};co&&co.box&&co.box.length&&br.verticalIconBox?(Zs=Do(br.verticalIconBox),vs=Zs.box.length>0):(Zs=Do(br.iconBox),vs=Zs.box.length>0),ko=ko&&Zs.offscreen,Ms=Zs.occluded}const tc=nt||Ln.numHorizontalGlyphVertices===0&&zs===0,vu=at||Ln.numIconVertices===0;if(tc||vu?vu?tc||(vs=vs&&Ar):Ar=vs&&Ar:vs=Ar=vs&&Ar,Ar&&Ss&&Ss.box&&this.collisionIndex.insertCollisionBox(Ss.box,B.get("text-ignore-placement"),k.bucketInstanceId,co&&co.box&&Dl?Dl:kc,Be.ID),vs&&Zs&&this.collisionIndex.insertCollisionBox(Zs.box,B.get("icon-ignore-placement"),k.bucketInstanceId,Fa,Be.ID),uo&&(Ar&&this.collisionIndex.insertCollisionCircles(uo.circles,B.get("text-ignore-placement"),k.bucketInstanceId,kc,Be.ID),x)){const Do=k.bucketInstanceId;let Go=this.collisionCircleArrays[Do];Go===void 0&&(Go=this.collisionCircleArrays[Do]=new Qd);for(let Ds=0;Ds<uo.circles.length;Ds+=4)Go.circles.push(uo.circles[Ds+0]),Go.circles.push(uo.circles[Ds+1]),Go.circles.push(uo.circles[Ds+2]),Go.circles.push(uo.collisionDetected?1:0)}const Dc=k.projection.name!=="globe";Tn=Tn&&(Dc||!yo),Kn=Kn&&(Dc||!Ms),this.placements[Ts]=new hs(Ar||Tn,vs||Kn,ko||k.justReloaded),h.add(Ts)},ys=this.retainedQueryData[k.bucketInstanceId].tileID;if(k.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(k,ys),k.elevationType==="road"&&k.updateRoadElevation(ys.canonical),k.updateZOffset(),k.sortFeaturesByY){const Ln=k.getSortedSymbolIndexes(this.transform.angle);for(let fs=Ln.length-1;fs>=0;--fs){const br=Ln[fs];ts(k.symbolInstances.get(br),br,k.collisionArrays[br])}k.hasAnyZOffset&&t.w(`${k.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(k.hasAnyZOffset){const Ln=k.getSortedIndexesByZOffset();for(let fs=0;fs<Ln.length;++fs){const br=Ln[fs];ts(k.symbolInstances.get(br),br,k.collisionArrays[br])}}else for(let Ln=r.symbolInstanceStart;Ln<r.symbolInstanceEnd;Ln++)ts(k.symbolInstances.get(Ln),Ln,k.collisionArrays[Ln]);if(x&&k.bucketInstanceId in this.collisionCircleArrays){const Ln=this.collisionCircleArrays[k.bucketInstanceId];t.bl(Ln.invProjMatrix,J),Ln.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(r,h,x,E){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G,crossTileID:J}=x,ee=t.c3(h),ce=E===t.bL.vertical?G:ee==="left"?M:ee==="center"?k:ee==="right"?B:-1;M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=ce>=0&&M!==ce?0:J),k>=0&&(r.text.placedSymbolArray.get(k).crossTileID=ce>=0&&k!==ce?0:J),B>=0&&(r.text.placedSymbolArray.get(B).crossTileID=ce>=0&&B!==ce?0:J),G>=0&&(r.text.placedSymbolArray.get(G).crossTileID=ce>=0&&G!==ce?0:J)}markUsedOrientation(r,h,x){const E=h===t.bL.horizontal||h===t.bL.horizontalOnly?h:0,M=h===t.bL.vertical?h:0,{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:B,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:J}=x,ee=r.text.placedSymbolArray;k>=0&&(ee.get(k).placedOrientation=E),B>=0&&(ee.get(B).placedOrientation=E),G>=0&&(ee.get(G).placedOrientation=E),J>=0&&(ee.get(J).placedOrientation=M)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let x=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(r):1,M=h?h.opacities:{},k=h?h.variableOffsets:{},B=h?h.placedOrientations:{};for(const G in this.placements){const J=this.placements[G],ee=M[G];ee?(this.opacities[G]=new Qu(ee,E,J.text,J.icon,null,J.clipped),x=x||J.text!==ee.text.placed||J.icon!==ee.icon.placed):(this.opacities[G]=new Qu(null,E,J.text,J.icon,J.skipFade,J.clipped),x=x||J.text||J.icon)}for(const G in M){const J=M[G];if(!this.opacities[G]){const ee=new Qu(J,E,!1,!1);ee.isHidden()||(this.opacities[G]=ee,x=x||J.text.placed||J.icon.placed)}}for(const G in k)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=k[G]);for(const G in B)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=B[G]);x?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h,x,E){E&&(this.lastReplacementSourceUpdateTime=E.updateTime);const M=new Set;for(const k of h){const B=k.getBucket(r);B&&k.latestFeatureIndex&&r.fqid===B.layerIds[0]&&(this.updateBucketOpacities(B,M,k,k.collisionBoxArray,x,E,k.tileID,r.scope),B.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(B,k.tileID),B.elevationType==="road"&&B.updateRoadElevation(k.tileID.canonical),B.updateZOffset())}}updateBucketOpacities(r,h,x,E,M,k,B,G){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const J=r.layers[0].layout,ee=r.layers[0].paint,ce=!!r.layers[0].dynamicFilter(),le=new Qu(null,0,!1,!1,!0),he=J.get("text-allow-overlap"),be=J.get("icon-allow-overlap"),_e=J.get("text-variable-anchor"),ke=J.get("text-rotation-alignment")==="map",Ae=J.get("text-pitch-alignment")==="map",Oe=ee.get("symbol-z-offset"),He=J.get("symbol-elevation-reference")==="sea",Be=!Oe.isConstant(),dt=new Qu(null,0,he&&(be||!r.hasIconData()||J.get("icon-optional")),be&&(he||!r.hasTextData()||J.get("text-optional")),!0);!r.collisionArrays&&E&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(E);const nt=(tt,Je,mt)=>{for(let Pt=0;Pt<Je/4;Pt++)tt.opacityVertexArray.emplaceBack(mt)};let at=0;k&&r.updateReplacement(B,k);for(let tt=0;tt<r.symbolInstances.length;tt++){const Je=r.symbolInstances.get(tt),{numHorizontalGlyphVertices:mt,numVerticalGlyphVertices:Pt,crossTileID:It,numIconVertices:ri,tileAnchorX:si,tileAnchorY:_i}=Je;let Vi=null;const Kt=this.retainedQueryData[r.bucketInstanceId];Be&&Je&&Kt&&(Vi=x.latestFeatureIndex.loadFeature({featureIndex:Je.featureIndex,bucketIndex:Kt.bucketIndex,sourceLayerIndex:Kt.sourceLayerIndex,layoutVertexArrayOffset:0}));const bt=Oe.evaluate(Vi,{}),oi=h.has(It);let ni=this.opacities[It];oi?ni=le:ni||(ni=dt,this.opacities[It]=ni),h.add(It);const Li=mt>0||Pt>0,en=ri>0,xn=this.placedOrientations[It],Yi=xn===t.bL.vertical,Wi=xn===t.bL.horizontal||xn===t.bL.horizontalOnly;!Li&&!en||ni.isHidden()||at++;let kn=!1;if((Li||en)&&k)for(const Pn of r.activeReplacements){if(t.bZ(Pn,M,t.b_.Symbol,G)||Pn.min.x>si||si>Pn.max.x||Pn.min.y>_i||_i>Pn.max.y)continue;const pn=t.b$(si,_i,B.canonical,Pn.footprintTileId.canonical);if(kn=t.c0(pn,Pn.footprint),kn)break}if(Li){const Pn=kn?ih:tl(ni.text);nt(r.text,mt,Yi?ih:Pn),nt(r.text,Pt,Wi?ih:Pn);const pn=ni.text.isHidden(),{leftJustifiedTextSymbolIndex:Tn,centerJustifiedTextSymbolIndex:Kn,rightJustifiedTextSymbolIndex:Er,verticalPlacedTextSymbolIndex:ts}=Je,ys=r.text.placedSymbolArray,Ln=pn||Yi?1:0;Tn>=0&&(ys.get(Tn).hidden=Ln),Kn>=0&&(ys.get(Kn).hidden=Ln),Er>=0&&(ys.get(Er).hidden=Ln),ts>=0&&(ys.get(ts).hidden=pn||Wi?1:0);const fs=this.variableOffsets[It];fs&&this.markUsedJustification(r,fs.anchor,Je,xn);const br=this.placedOrientations[It];br&&(this.markUsedJustification(r,"left",Je,br),this.markUsedOrientation(r,br,Je))}if(en){const Pn=kn?ih:tl(ni.icon),{placedIconSymbolIndex:pn,verticalPlacedIconSymbolIndex:Tn}=Je,Kn=r.icon.placedSymbolArray,Er=ni.icon.isHidden()?1:0;pn>=0&&(nt(r.icon,ri,Yi?ih:Pn),Kn.get(pn).hidden=Er),Tn>=0&&(nt(r.icon,Je.numVerticalIconVertices,Wi?ih:Pn),Kn.get(Tn).hidden=Er)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Pn=r.collisionArrays[tt];if(Pn){let pn=new t.P(0,0),Tn=!0;if(Pn.textBox||Pn.verticalTextBox){if(_e){const Er=this.variableOffsets[It];Er?(pn=Ua(Er.anchor,Er.width,Er.height,Er.textOffset,Er.textScale),ke&&pn._rotate(Ae?this.transform.angle:-this.transform.angle)):Tn=!1}ce&&(Tn=!ni.clipped),Pn.textBox&&ea(r.textCollisionBox.collisionVertexArray,ni.text.placed,!Tn||Yi,bt,He,pn.x,pn.y),Pn.verticalTextBox&&ea(r.textCollisionBox.collisionVertexArray,ni.text.placed,!Tn||Wi,bt,He,pn.x,pn.y)}const Kn=Tn&&!!(!Wi&&Pn.verticalIconBox);Pn.iconBox&&ea(r.iconCollisionBox.collisionVertexArray,ni.icon.placed,Kn,bt,He,Je.hasIconTextFit?pn.x:0,Je.hasIconTextFit?pn.y:0),Pn.verticalIconBox&&ea(r.iconCollisionBox.collisionVertexArray,ni.icon.placed,!Kn,bt,He,Je.hasIconTextFit?pn.x:0,Je.hasIconTextFit?pn.y:0)}}}if(r.fullyClipped=at===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=tt.invProjMatrix,r.placementViewportMatrix=tt.viewportMatrix,r.collisionCircleArray=tt.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const x=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*x>r}isStale(){return this.stale}setStale(){this.stale=!0}}function ea(v,r,h,x,E,M,k){v.emplaceBack(r?1:0,h?1:0,M||0,k||0,x,E?1:0),v.emplaceBack(r?1:0,h?1:0,M||0,k||0,x,E?1:0),v.emplaceBack(r?1:0,h?1:0,M||0,k||0,x,E?1:0),v.emplaceBack(r?1:0,h?1:0,M||0,k||0,x,E?1:0)}const Dm=Math.pow(2,25),th=Math.pow(2,24),_d=Math.pow(2,17),Oh=Math.pow(2,16),Lm=Math.pow(2,9),xl=Math.pow(2,8),Fh=Math.pow(2,1);function tl(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const r=v.placed?1:0,h=Math.floor(127*v.opacity);return h*Dm+r*th+h*_d+r*Oh+h*Lm+r*xl+h*Fh+r}const ih=0;class tf{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,h,x,E,M,k){const B=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(B,E,r[this._currentTileIndex],this._sortAcrossTiles,k),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,B.sort(((G,J)=>G.sortKey-J.sortKey)));this._currentPartIndex<B.length;){const G=B[this._currentPartIndex];if(h.placeLayerBucketPart(G,this._seenCrossTileIDs,x,G.symbolInstanceStart===0,k),this._currentPartIndex++,M())return!0}return!1}}class Oa{constructor(r,h,x,E,M,k,B,G,J){this.placement=new $f(r,M,k,B,G,J),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(r,h,x,E,M){const k=t.o.now(),B=()=>{const G=t.o.now()-k;return!this._forceFullPlacement&&G>2};for(;this._currentPlacementIndex>=0;){const G=h[r[this._currentPlacementIndex]],J=this.placement.collisionIndex.transform.zoom;if(G.type==="symbol"&&G.visibility!=="none"&&(!G.minzoom||G.minzoom<=J)&&(!G.maxzoom||G.maxzoom>J)){const ee=G,ce=ee.layout.get("symbol-z-elevate"),le=ee.layout.get("symbol-sort-key").constantOr(1)!==void 0,he=ee.layout.get("symbol-z-order"),be=he==="viewport-y"||he==="auto"&&!(he!=="viewport-y"&&le),_e=ee.layout.get("text-allow-overlap")||ee.layout.get("icon-allow-overlap")||ee.layout.get("text-ignore-placement")||ee.layout.get("icon-ignore-placement"),ke=be&&_e,Ae=this._inProgressLayer=this._inProgressLayer||new tf(ee),Oe=t.B(G.source,G.scope);if(Ae.continuePlacement(ce||ke?E[Oe]:x[Oe],this.placement,this._showCollisionBoxes,G,B,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Sc=512/t.al/2;class Pu{constructor(r,h,x){this.tileID=r,this.bucketInstanceId=x,this.index=new t.c4(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=r.canonical.x*t.al,M=r.canonical.y*t.al;for(let k=0;k<h.length;k++){const{key:B,crossTileID:G,tileAnchorX:J,tileAnchorY:ee}=h.get(k),ce=Math.floor((E+J)*Sc),le=Math.floor((M+ee)*Sc);this.index.add(ce,le),this.keys.push(B),this.crossTileIDs.push(G)}this.index.finish()}findMatches(r,h,x){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),M=Sc/Math.pow(2,h.canonical.z-this.tileID.canonical.z),k=h.canonical.x*t.al,B=h.canonical.y*t.al;for(let G=0;G<r.length;G++){const J=r.get(G);if(J.crossTileID)continue;const{key:ee,tileAnchorX:ce,tileAnchorY:le}=J,he=Math.floor((k+ce)*M),be=Math.floor((B+le)*M),_e=this.index.range(he-E,be-E,he+E,be+E).sort(((ke,Ae)=>ke-Ae));for(const ke of _e){const Ae=this.crossTileIDs[ke];if(this.keys[ke]===ee&&!x.has(Ae)){x.add(Ae),J.crossTileID=Ae;break}}}}}class da{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const x in this.indexes){const E=this.indexes[x],M={};for(const k in E){const B=E[k];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+h),M[B.tileID.key]=B}this.indexes[x]=M}this.lng=r}addBucket(r,h,x){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let M=0;M<h.symbolInstances.length;M++)h.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const E=this.usedCrossTileIDs[r.overscaledZ];for(const M in this.indexes){const k=this.indexes[M];if(Number(M)>r.overscaledZ)for(const B in k){const G=k[B];G.tileID.isChildOf(r)&&G.findMatches(h.symbolInstances,r,E)}else{const B=k[r.scaledTo(Number(M)).key];B&&B.findMatches(h.symbolInstances,r,E)}}for(let M=0;M<h.symbolInstances.length;M++){const k=h.symbolInstances.get(M);k.crossTileID||(k.crossTileID=x.generate(),E.add(k.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Pu(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const x of h.crossTileIDs)this.usedCrossTileIDs[r].delete(x)}removeStaleBuckets(r){let h=!1;for(const x in this.indexes){const E=this.indexes[x];for(const M in E)r[E[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,E[M]),delete E[M],h=!0)}return h}}class cu{constructor(){this.layerIndexes={},this.crossTileIDs=new da,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,x,E){let M=this.layerIndexes[r.fqid];M===void 0&&(M=this.layerIndexes[r.fqid]=new Rm);let k=!1;const B={};E.name!=="globe"&&M.handleWrapJump(x);for(const G of h){const J=G.getBucket(r);J&&r.fqid===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(G.tileID,J,this.crossTileIDs)&&(k=!0),B[J.bucketInstanceId]=!0)}return M.removeStaleBuckets(B)&&(k=!0),k}pruneUnusedLayers(r){const h={};r.forEach((x=>{h[x]=!0}));for(const x in this.layerIndexes)h[x]||delete this.layerIndexes[x]}}const Mu=771;class yr{constructor(r,h,x,E){this.blendFunction=r,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=x,this.blendEquation=E}}yr.Replace=[1,0,1,0],yr.disabled=new yr(yr.Replace,t.ao.transparent,[!1,!1,!1,!1]),yr.unblended=new yr(yr.Replace,t.ao.transparent,[!0,!0,!0,!0]),yr.alphaBlended=new yr([1,Mu,1,Mu],t.ao.transparent,[!0,!0,!0,!0]),yr.alphaBlendedNonPremultiplied=new yr([770,Mu,770,Mu],t.ao.transparent,[!0,!0,!0,!0]),yr.multiply=new yr([774,0,774,0],t.ao.transparent,[!0,!0,!0,!0]),yr.additive=new yr([1,1,1,1],t.ao.transparent,[!0,!0,!0,!0]);class zn{constructor(r,h,x){this.func=r,this.mask=h,this.range=x}}zn.ReadOnly=!1,zn.ReadWrite=!0,zn.disabled=new zn(519,zn.ReadOnly,[0,1]);const Gf=7680;class sr{constructor(r,h,x,E,M,k){this.test=r,this.ref=h,this.mask=x,this.fail=E,this.depthFail=M,this.pass=k}}sr.disabled=new sr({func:519,mask:0},0,0,Gf,Gf,Gf);const nf=1029,rf=2305;class pr{constructor(r,h,x){this.enable=r,this.mode=h,this.frontFace=x}}function nh(v,r){const h=t.ca(v,3);t.cc(v,r),t.cg(v,3,h)}function zm(v,r){const h=t.c7([]);return t.c8(h,h,-r),t.c9(h,h,-v),h}function yd(v,r){const h=[v[0],v[1],0],x=[r[0],r[1],0];if(t.ag(h)>=1e-15){const k=t.aw([],h);t.c5(x,k,t.bJ(x,k)),r[0]=x[0],r[1]=x[1]}const E=t.bI([],r,v);if(t.c6(E)<1e-15)return null;const M=Math.atan2(-E[1],E[0]);return zm(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),M)}pr.disabled=new pr(!1,nf,rf),pr.backCCW=new pr(!0,nf,rf),pr.backCW=new pr(!0,nf,2304),pr.frontCW=new pr(!0,1028,2304),pr.frontCCW=new pr(!0,1028,rf);class Fl{constructor(r,h){this.position=r,this.orientation=h}get position(){return this._position}set position(r){if(r){const h=r instanceof t.ae?r:new t.ae(r[0],r[1],r[2]);this._renderWorldCopies&&(h.x=t.bT(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(r,h,x){if(this.orientation=null,!this.position)return;const E=this.position,M=x||(this._elevation?this._elevation.getAtPointOrZero(t.ae.fromLngLat(r)):0),k=t.ae.fromLngLat(r,M),B=[k.x-E.x,k.y-E.y,k.z-E.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=yd(B,h)}setPitchBearing(r,h){this.orientation=zm(t.an(r),t.an(-h))}}class qf{constructor(r,h){this._transform=t.bA([]),this.orientation=h,this.position=r}get mercatorPosition(){const r=this.position;return new t.ae(r[0],r[1],r[2])}get position(){const r=t.ca(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var h;r&&t.cg(this._transform,3,[(h=r)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||t.c7([]),r&&nh(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,h){this._orientation=zm(r,h),nh(this._transform,this._orientation)}forward(){const r=t.ca(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=t.ca(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=t.ca(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,h){const x=new Float64Array(16);return t.bl(x,this.getWorldToCamera(r,h)),x}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,h,x){const E=this.position;t.c5(E,E,-r);const M=new Float64Array(16);return t.bq(M,[x,x,x]),t.br(M,M,E),M[10]*=h,M}getWorldToCamera(r,h){const x=new Float64Array(16),E=new Float64Array(4),M=this.position;return t.cb(E,this._orientation),t.c5(M,M,-r),t.cc(x,E),t.br(x,x,M),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=h,x[9]*=h,x[10]*=h,x[11]*=h,x}getCameraToClipPerspective(r,h,x,E){const M=new Float64Array(16);return t.cd(M,r,h,x,E),M}getCameraToClipOrthographic(r,h,x,E,M,k){const B=new Float64Array(16);return t.ce(B,r,h,x,E,M,k),B}getDistanceToElevation(r,h=!1){const x=r===0?0:t.cf(r,h?t.a$(this.position[1]):this.position[1]),E=this.forward();return(x-this.position[2])/E[2]}clone(){return new qf([...this.position],[...this.orientation])}}const $a={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class sf{constructor(r=0,h=0,x=0,E=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(x)||x<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=x,this.right=E}interpolate(r,h,x){return h.top!=null&&r.top!=null&&(this.top=t.ak(r.top,h.top,x)),h.bottom!=null&&r.bottom!=null&&(this.bottom=t.ak(r.bottom,h.bottom,x)),h.left!=null&&r.left!=null&&(this.left=t.ak(r.left,h.left,x)),h.right!=null&&r.right!=null&&(this.right=t.ak(r.right,h.right,x)),this}getCenter(r,h){const x=t.aA((this.left+r-this.right)/2,0,r),E=t.aA((this.top+h-this.bottom)/2,0,h);return new t.P(x,E)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new sf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const il=15;class Hf{constructor(r,h,x,E,M,k,B){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=x??0,this._maxPitch=E??60,this.setProjection(k),this.setMaxBounds(B),this.width=0,this.height=0,this._center=new t.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new Hf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<il}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,h=!1){const x=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||x)&&this._updateCameraOnTerrain(),(r||x)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return t.aH(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=t.cm(this.projectionOptions);const x=this.getProjection(),E=!t.by(h,x);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.cm({name:"mercator"});const h=r!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bT(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const h=-r*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=t.cn(),t.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const h=t.aA(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=t.an(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const x=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&x.exaggeration()&&this._centerAltitudeValidForExaggeration!==x.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*x.exaggeration(),this._centerAltitudeValidForExaggeration=x.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=x.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let E=0,M=0;for(let k=0;k<h.length;k++){const B=new t.P(h[k][0]*this.width,x+h[k][1]*(this.height-x)),G=r.pointCoordinate(B);if(!G)continue;const J=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);E+=G[3]*J,M+=J}return M===0?NaN:E/M}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*h,E=this._mercatorZfromZoom(r),M=this._mercatorZfromZoom(this._maxZoom),k=Math.max(E-x,M);this._setZoom(this._zoomFromMercatorZ(k))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}equals(r){const h=this.elevation,x=r.elevation,E=h!=null!=(x!=null)||h&&x&&h.exaggeration()!==x.exaggeration();return this.width===r.width&&this.height===r.height&&this.center.lng===r.center.lng&&this.center.lat===r.center.lat&&this.zoom===r.zoom&&this.bearing===r.bearing&&this.pitch===r.pitch&&this.fov===r.fov&&this.projection.name===r.projection.name&&this._edgeInsets.equals(r.padding)&&!E}computeZoomRelativeTo(r){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let x;x=r.z<this._camera.position[2]?[h.x,h.y,h.z]:[r.x,r.y,r.z];const E=t.ag(t.av([],this._camera.position,x));return t.aA(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let h=!1;if(r.orientation&&!t.cp(r.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(r.orientation)),r.position){const x=[r.position.x,r.position.y,r.position.z];t.cq(x,this._camera.position)||(this._setCameraPosition(x),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,h=new Fl;return h.position=new t.ae(r[0],r[1],r[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(r){if(!t.cr(r))return!1;t.cs(r,r);const h=t.ct([],[0,0,-1],r),x=t.ct([],[0,-1,0],r);if(x[2]<0)return!1;const E=yd(h,x);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(r){const h=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;r[2]=t.aA(r[2],E/x,E/h),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,x){this._unmodified=!1,this._edgeInsets.interpolate(r,h,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){const h=[new t.cu(0,r)];if(this.renderWorldCopies){const x=this.pointCoordinate(new t.P(0,0)),E=this.pointCoordinate(new t.P(this.width,0)),M=this.pointCoordinate(new t.P(this.width,this.height)),k=this.pointCoordinate(new t.P(0,this.height)),B=Math.floor(Math.min(x.x,E.x,M.x,k.x)),G=Math.floor(Math.max(x.x,E.x,M.x,k.x)),J=1;for(let ee=B-J;ee<=G+J;ee++)ee!==0&&h.push(new t.cu(ee,r))}return h}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,h,x,E){let M=[];const k=x!=null,B=!k;if(B&&this.zoom<h||k&&x[0]===0&&x[1]===0)return M;const G=new Set,J=(ce,le,he,be,_e)=>{const ke=t.cY(le,ce,he,be,_e);G.has(ke)||(M.push(new t.aQ(ce,le,he,be,_e)),G.add(ke))};for(let ce=0;ce<r.length;ce++){const le=r[ce];if(B&&le.canonical.z!==h||k&&E!==void 0&&E>le.canonical.z)continue;const he=le.canonical,be=le.overscaledZ,_e=le.wrap,ke=1<<he.z,Ae=he.x+1<ke,Oe=he.x>0,He=he.y+1<ke,Be=he.y>0,dt=le.wrap-(Oe?0:1),nt=le.wrap+(Ae?0:1),at=Oe?he.x-1:ke-1,tt=Ae?he.x+1:0;if(k)x[0]<0?(J(be,nt,he.z,tt,he.y),x[1]<0&&He&&(J(be,_e,he.z,he.x,he.y+1),J(be,nt,he.z,tt,he.y+1)),x[1]>0&&Be&&(J(be,_e,he.z,he.x,he.y-1),J(be,nt,he.z,tt,he.y-1))):x[0]>0?(J(be,dt,he.z,at,he.y),x[1]<0&&He&&(J(be,_e,he.z,he.x,he.y+1),J(be,dt,he.z,at,he.y+1)),x[1]>0&&Be&&(J(be,_e,he.z,he.x,he.y-1),J(be,dt,he.z,at,he.y-1))):x[1]<0&&He?J(be,_e,he.z,he.x,he.y+1):Be&&J(be,_e,he.z,he.x,he.y-1);else{const Je=le.visibleQuadrants;1&Je&&(J(be,dt,he.z,at,he.y),Be&&(J(be,_e,he.z,he.x,he.y-1),J(be,dt,he.z,at,he.y-1))),2&Je&&(J(be,nt,he.z,tt,he.y),Be&&(J(be,_e,he.z,he.x,he.y-1),J(be,nt,he.z,tt,he.y-1))),4&Je&&(J(be,dt,he.z,at,he.y),He&&(J(be,_e,he.z,he.x,he.y+1),J(be,dt,he.z,at,he.y+1))),8&Je&&(J(be,nt,he.z,tt,he.y),He&&(J(be,_e,he.z,he.x,he.y+1),J(be,nt,he.z,tt,he.y+1)))}}const ee=[];for(const ce of M)M.some((le=>ce.isChildOf(le)))||ee.push(ce);if(M=ee.filter((ce=>!r.some((le=>!!(ce.overscaledZ<h&&le.isChildOf(ce))||ce.equals(le)||ce.isChildOf(le))))),B){const ce=1<<h,le=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),he=[ce*le.x,ce*le.y],be=4,_e=be*be;M=M.filter((ke=>{const Ae=ke.canonical.x+.5-he[0],Oe=ke.canonical.y+.5-he[1];return Ae*Ae+Oe*Oe<_e}))}return M}extendTileCoverToNearPlane(r,h,x){const E=[],M=new Set;for(const Oe of r)M.add(Oe.key);const k=(Oe,He,Be,dt,nt)=>{const at=t.cY(He,Oe,Be,dt,nt);M.has(at)||(E.push(new t.aQ(Oe,He,Be,dt,nt)),M.add(at))},B=r.reduce(((Oe,He)=>Math.max(Oe,He.overscaledZ)),x),G=1<<x,J=[new t.P(0,0),new t.P(t.al,0),new t.P(t.al,t.al),new t.P(0,t.al)],ee=new t.P(0,0),ce=new t.P(0,0),le=(Oe,He)=>{const Be=Math.floor(Oe[0]),dt=Math.floor(Oe[1]),nt=(Oe[0]-Be)*t.al,at=(Oe[1]-dt)*t.al,tt=Math.floor(He[0]),Je=Math.floor(He[1]),mt=(He[0]-tt)*t.al,Pt=(He[1]-Je)*t.al;for(let It=-1;It<=1;It++){const ri=Be+It;if(!(ri<0||ri>=G)){ee.x=nt-It*t.al,ce.x=mt-(ri-tt)*t.al;for(let si=-1;si<=1;si++){const _i=dt+si;ee.y=at-si*t.al,ce.y=Pt-(_i-Je)*t.al,t.cZ(ee,ce,J)&&k(B,0,x,ri,_i)}}}},he=h.points,be=he[t.cv],_e=he[t.cw],ke=this._projectToGround(be,he[t.cx]),Ae=this._projectToGround(_e,he[t.cy]);return le(be,ke),le(_e,Ae),E}_projectToGround(r,h){return t.cz(t.cA(),r,h,r[2]/(r[2]-h[2]))}coveringTiles(r){let h=this.coveringZoomLevel(r);const x=h,E=this.elevation&&this.elevation.exaggeration(),M=E&&!r.isTerrainDEM,k=this.projection.name==="mercator";if(r.minzoom!==void 0&&h<r.minzoom)return[];r.maxzoom!==void 0&&h>r.maxzoom&&(h=r.maxzoom);const B=this.locationCoordinate(this.center),G=this.center.lat,J=1<<h,ee=[J*B.x,J*B.y,0],ce=this.projection.name==="globe",le=!ce,he=t.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,le),be=ce?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),_e=J*t.cf(1,this.center.lat),ke=this._camera.position[2]/t.cf(1,this.center.lat),Ae=[J*be.x,J*be.y,ke*(le?1:_e)],Oe=ce||E,He=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Be=this.isLODDisabled(!0)?h:0;let dt;if(this._elevation&&r.isTerrainDEM)dt=1e4*this._elevation.exaggeration();else if(this._elevation){const bt=this._elevation.getMinMaxForVisibleTiles();dt=bt?bt.max:this._centerAltitude}else dt=this._centerAltitude;const nt=r.isTerrainDEM?-dt:this._elevation?this._elevation.getMinElevationBelowMSL():0,at=this.projection.isReprojectedInTileSpace?t.cC(this):1,tt=bt=>{const ni=new t.ae(bt.x+25e-6,bt.y,bt.z),Li=new t.ae(bt.x,bt.y+25e-6,bt.z),en=bt.toLngLat(),xn=ni.toLngLat(),Yi=Li.toLngLat(),Wi=this.locationCoordinate(en),kn=this.locationCoordinate(xn),Pn=this.locationCoordinate(Yi),pn=Math.hypot(kn.x-Wi.x,kn.y-Wi.y),Tn=Math.hypot(Pn.x-Wi.x,Pn.y-Wi.y);return Math.sqrt(pn*Tn)*at/25e-6},Je=bt=>{const oi=dt,ni=nt;return{aabb:t.cF(this,J,0,0,0,bt,ni,oi,this.projection),zoom:0,x:0,y:0,minZ:ni,maxZ:oi,wrap:bt,fullyVisible:!1}},mt=[];let Pt=[];const It=h,ri=r.reparseOverscaled?x:h,si=(ke-this._centerAltitude)*_e,_i=bt=>{if(!this._elevation||!bt.tileID||!k)return;const oi=this._elevation.getMinMaxForTile(bt.tileID),ni=bt.aabb;oi?(ni.min[2]=oi.min,ni.max[2]=oi.max,ni.center[2]=(ni.min[2]+ni.max[2])/2):(bt.shouldSplit=Kt(bt),bt.shouldSplit||(ni.min[2]=ni.max[2]=ni.center[2]=this._centerAltitude))},Vi=(bt,oi)=>{if(.707*oi<bt)return 1;const ni=oi/bt;return ni/(1.4144271570014144+(Math.pow(1.1,ni-1.4144271570014144+1)-1)/(1.1-1)-1)},Kt=bt=>{if(bt.zoom<Be)return!0;if(bt.zoom===It)return!1;if(bt.shouldSplit!=null)return bt.shouldSplit;const oi=bt.aabb.distanceX(Ae),ni=bt.aabb.distanceY(Ae);let Li=si,en=1;if(ce){Li=bt.aabb.distanceZ(Ae);const Tn=Math.pow(2,bt.zoom),Kn=t.a$((bt.y+1)/Tn),Er=t.a$(bt.y/Tn),ts=Math.min(Math.max(G,Kn),Er),ys=t.d1(ts)/t.d1(G);if(en=ts===G?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ys/this._mercatorScaleRatio),this.zoom<=t.c_&&bt.zoom===It-1&&ys>=.9)return!0}else if(M&&(Li=bt.aabb.distanceZ(Ae)*_e),this.projection.isReprojectedInTileSpace&&x<=5){const Tn=Math.pow(2,bt.zoom),Kn=tt(new t.ae((bt.x+.5)/Tn,(bt.y+.5)/Tn));en=Kn>.85?1:Kn}if(!k&&!ce){const Tn=Math.sqrt(oi*oi+ni*ni+Li*Li);let Kn=(1<<It-bt.zoom)*He*en;return Kn*=Vi(Math.max(Li,si),Tn),Tn<Kn}let xn=Number.MAX_VALUE,Yi=0;const Wi=bt.aabb.getCorners(),kn=[];for(const Tn of Wi){t.av(kn,Tn,Ae),ce||(M?kn[2]*=_e:kn[2]=si);const Kn=t.bJ(kn,this._camera.forward());Kn<xn&&(xn=Kn,Yi=Math.abs(kn[2]))}let Pn=(1<<It-bt.zoom)*He*en;if(Pn*=Vi(Math.max(Yi,si),xn),xn<Pn)return!0;const pn=bt.aabb.closestPoint(ee);return pn[0]===ee[0]&&pn[1]===ee[1]};if(this.renderWorldCopies)for(let bt=1;bt<=3;bt++)mt.push(Je(-bt)),mt.push(Je(bt));for(mt.push(Je(0));mt.length>0;){const bt=mt.pop(),oi=bt.x,ni=bt.y;let Li=bt.fullyVisible;const en=()=>this.projection.name==="globe"&&(bt.y===0||bt.y===(1<<bt.zoom)-1);if(!Li){let xn=Oe?bt.aabb.intersects(he):bt.aabb.intersectsFlat(he);if(xn===0&&en()){const Yi=new t.cD(bt.zoom,oi,ni);xn=t.cE(this,J,Yi,!0).intersects(he)}if(xn===0)continue;Li=xn===2}if(bt.zoom!==It&&Kt(bt))for(let xn=0;xn<4;xn++){const Yi=(oi<<1)+xn%2,Wi=(ni<<1)+(xn>>1),kn={aabb:k?bt.aabb.quadrant(xn):t.cF(this,J,bt.zoom+1,Yi,Wi,bt.wrap,bt.minZ,bt.maxZ,this.projection),zoom:bt.zoom+1,x:Yi,y:Wi,wrap:bt.wrap,fullyVisible:Li,tileID:void 0,shouldSplit:void 0,minZ:bt.minZ,maxZ:bt.maxZ};M&&!ce&&(kn.tileID=new t.aQ(bt.zoom+1===It?ri:bt.zoom+1,bt.wrap,bt.zoom+1,Yi,Wi),_i(kn)),mt.push(kn)}else{const xn=bt.zoom===It?ri:bt.zoom;if(r.minzoom&&r.minzoom>xn)continue;let Yi=0;if(!Li){let pn=Oe?bt.aabb.intersectsPrecise(he):bt.aabb.intersectsPreciseFlat(he);if(pn===0&&en()){const Tn=new t.cD(bt.zoom,oi,ni);pn=t.cE(this,J,Tn,!0).intersectsPrecise(he)}if(pn===0)continue;if(r.calculateQuadrantVisibility)if(he.containsPoint(bt.aabb.center))Yi=15;else for(let Tn=0;Tn<4;Tn++)bt.aabb.quadrant(Tn).intersects(he)!==0&&(Yi|=1<<Tn)}const Wi=ee[0]-(.5+oi+(bt.wrap<<bt.zoom))*(1<<h-bt.zoom),kn=ee[1]-.5-ni,Pn=bt.tileID?bt.tileID:new t.aQ(xn,bt.wrap,bt.zoom,oi,ni);r.calculateQuadrantVisibility&&(Pn.visibleQuadrants=Yi),Pt.push({tileID:Pn,distanceSq:Wi*Wi+kn*kn})}}if(this.fogCullDistSq){const bt=this.fogCullDistSq,oi=this.horizonLineFromTop();Pt=Pt.filter((ni=>{const Li=[0,0,0,1],en=[t.al,t.al,0,1],xn=this.calculateFogTileMatrix(ni.tileID.toUnwrapped());t.aC(Li,Li,xn),t.aC(en,en,xn);const Yi=t.cG([],Li,en),Wi=t.cH([],Li,en),kn=t.c$(Yi,Wi);if(kn===0)return!0;let Pn=!1;const pn=this._elevation;if(pn&&kn>bt&&oi!==0){const Tn=this.calculateProjMatrix(ni.tileID.toUnwrapped());let Kn;r.isTerrainDEM||(Kn=pn.getMinMaxForTile(ni.tileID)),Kn||(Kn={min:nt,max:dt});const Er=t.cI(this.rotation),ts=[Er[0]*t.al,Er[1]*t.al,Kn.max];t.af(ts,ts,Tn),Pn=(1-ts[1])*this.height*.5<oi}return kn<bt||Pn}))}return Pt.sort(((bt,oi)=>bt.distanceSq-oi.distanceSq)).map((bt=>bt.tileID))}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log2(r)}project(r){const h=t.aA(r.lat,-t.cJ,t.cJ),x=this.projection.project(r.lng,h);return new t.P(x.x*this.worldSize,x.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,h){let x,E;const M=this.centerPoint;if(this.projection.name==="globe"){const B=this.worldSize;x=(h.x-M.x)/B,E=(h.y-M.y)/B}else{const B=this.pointCoordinate(h),G=this.pointCoordinate(M);x=B.x-G.x,E=B.y-G.y}const k=this.locationCoordinate(r);this.setLocation(new t.ae(k.x-x,k.y-E))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,h){return this.projection.locationPoint(this,r,h)}locationPoint3D(r,h){return this.projection.locationPoint(this,r,h,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,h){return this.coordinateLocation(this.pointCoordinate3D(r,h))}locationCoordinate(r,h){const x=h?t.cf(h,r.lat):void 0,E=this.projection.project(r.lng,r.lat);return new t.ae(E.x,E.y,x)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,h){const x=h??this._centerAltitude,E=[r.x,r.y,0,1],M=[r.x,r.y,1,1];t.aC(E,E,this.pixelMatrixInverse),t.aC(M,M,this.pixelMatrixInverse);const k=M[3];t.cK(E,E,1/E[3]),t.cK(M,M,1/k);const B=E[2],G=M[2];return{p0:E,p1:M,t:B===G?0:(x-B)/(G-B)}}screenPointToMercatorRay(r){const h=[r.x,r.y,0,1],x=[r.x,r.y,1,1];return t.aC(h,h,this.pixelMatrixInverse),t.aC(x,x,this.pixelMatrixInverse),t.cK(h,h,1/h[3]),t.cK(x,x,1/x[3]),h[2]=t.cf(h[2],this._center.lat)*this.worldSize,x[2]=t.cf(x[2],this._center.lat)*this.worldSize,t.cK(h,h,1/this.worldSize),t.cK(x,x,1/this.worldSize),new t.ax([h[0],h[1],h[2]],t.aw([],t.av([],x,h)))}rayIntersectionCoordinate(r){const{p0:h,p1:x,t:E}=r,M=t.cf(h[2],this._center.lat),k=t.cf(x[2],this._center.lat);return new t.ae(t.ak(h[0],x[0],E)/this.worldSize,t.ak(h[1],x[1],E)/this.worldSize,t.ak(M,k,E))}pointCoordinate(r,h=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,h)}pointCoordinate3D(r,h){if(!this.elevation)return this.pointCoordinate(r,h);let x=this.projection.pointCoordinate3D(this,r.x,r.y);if(x)return new t.ae(x[0],x[1],x[2]);let E=0,M=this.horizonLineFromTop();if(r.y>M)return this.pointCoordinate(r,h);const k=.02*M,B=r.clone();for(let G=0;G<10&&M-E>k;G++){B.y=t.ak(E,M,.66);const J=this.projection.pointCoordinate3D(this,B.x,B.y);J?(M=B.y,x=J):E=B.y}return x?new t.ae(x[0],x[1],x[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=t.cL)return!this.isPointAboveHorizon(r);const h=this.pointCoordinate(r);return h.y>=0&&h.y<=1}_coordinatePoint(r,h){const x=h&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,E=[r.x*this.worldSize,r.y*this.worldSize,x+r.toAltitude(),1];return t.aC(E,E,this.pixelMatrix),E[3]>0?new t.P(E[0]/E[3],E[1]/E[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:h}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,M=this.pointLocation3D(new t.P(h,r)),k=this.pointLocation3D(new t.P(E,r)),B=this.pointLocation3D(new t.P(E,x)),G=this.pointLocation3D(new t.P(h,x));let J=Math.min(M.lng,k.lng,B.lng,G.lng),ee=Math.max(M.lng,k.lng,B.lng,G.lng),ce=Math.min(M.lat,k.lat,B.lat,G.lat),le=Math.max(M.lat,k.lat,B.lat,G.lat);const he=Math.pow(2,-this.zoom)/16*270,be=this.projection.name==="globe"?1:4,_e=(ke,Ae,Oe,He,Be)=>{const dt=(ke+Oe)/2,nt=(Ae+He)/2,at=new t.P(dt,nt),{lng:tt,lat:Je}=this.pointLocation3D(at),mt=Math.max(0,J-tt,ce-Je,tt-ee,Je-le);J=Math.min(J,tt),ee=Math.max(ee,tt),ce=Math.min(ce,Je),le=Math.max(le,Je),(Be<be||mt>he)&&(_e(ke,Ae,dt,nt,Be+1),_e(dt,nt,Oe,He,Be+1))};if(_e(h,r,E,r,1),_e(E,r,E,x,1),_e(E,x,h,x,1),_e(h,x,h,r,1),this.projection.name==="globe"){const[ke,Ae]=t.cM(this);ke?(le=90,ee=180,J=-180):Ae&&(ce=-90,ee=180,J=-180)}return new t.aI(new t.aT(J,ce),new t.aT(ee,le))}_getBoundsRectangular(r,h){const{top:x,left:E}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,k=this.width-this._edgeInsets.right,B=new t.P(E,x),G=new t.P(k,x),J=new t.P(k,M),ee=new t.P(E,M);let ce=this.pointCoordinate(B,r),le=this.pointCoordinate(G,r);const he=this.pointCoordinate(J,h),be=this.pointCoordinate(ee,h),_e=(ke,Ae)=>(Ae.y-ke.y)/(Ae.x-ke.x);return ce.y>1&&le.y>=0?ce=new t.ae((1-be.y)/_e(be,ce)+be.x,1):ce.y<0&&le.y<=1&&(ce=new t.ae(-be.y/_e(be,ce)+be.x,0)),le.y>1&&ce.y>=0?le=new t.ae((1-he.y)/_e(he,le)+he.x,1):le.y<0&&ce.y<=1&&(le=new t.ae(-he.y/_e(he,le)+he.x,0)),new t.aI().extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(be)).extend(this.coordinateLocation(he))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=r.visibleDemTiles.reduce(((x,E)=>{if(E.dem){const M=E.dem.tree;x.min=Math.min(x.min,M.minimums[0]),x.max=Math.max(x.max,M.maximums[0])}return x}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*r.exaggeration(),h.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,x=this.height/2-h*(1-this._horizonShift);return r?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-t.cJ,this.maxLat=t.cJ,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.aF(this.minLng)*this.tileSize,this.worldMaxX=t.aF(this.maxLng)*this.tileSize,this.worldMinY=t.aJ(this.maxLat)*this.tileSize,this.worldMaxY=t.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,h){return this.projection.createTileMatrix(this,h,r)}calculateDistanceTileData(r){const h=r.key,x=this._distanceTileDataCache;if(x[h])return x[h];const E=r.canonical,M=1/this.height,k=this.cameraWorldSize,B=k/this.zoomScale(E.z),G=(E.x+Math.pow(2,E.z)*r.wrap)*B,J=E.y*B,ee=this.point;ee.x*=k/this.worldSize,ee.y*=k/this.worldSize;const ce=this.angle,le=Math.sin(-ce),he=-Math.cos(-ce);return x[h]={bearing:[le,he],center:[(ee.x-G)*M,(ee.y-J)*M],scale:B/t.al*M},x[h]}calculateFogTileMatrix(r){const h=r.key,x=this._fogTileMatrixCache;if(x[h])return x[h];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return t.aB(E,this.worldToFogMatrix,E),x[h]=new Float32Array(E),x[h]}calculateProjMatrix(r,h=!1,x=!1){const E=r.key;let M;if(M=x?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,M[E])return M[E];const k=this.calculatePosMatrix(r,this.worldSize);let B;return B=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:x?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,t.aB(k,B,k),M[E]=new Float32Array(k),M[E]}calculatePixelsToTileUnitsMatrix(r){const h=r.tileID.key,x=this._pixelsToTileUnitsCache;if(x[h])return x[h];const E=t.cN(r,this);return x[h]=E,x[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,h=t.bq([],[r,r,r]);return t.aB(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const h=t.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(h),E=this._camera.forward(),M=t.cf(1,this._center.lat);x[2]/=M,E[2]/=M,t.aw(E,E);const k=r.raycast(x,E,r.exaggeration());if(k){const B=t.bH([],x,E,k),G=new t.ae(B[0],B[1],t.cf(B[2],t.a$(B[1]))),J=(G.z+t.ag([G.x-x[0],G.y-x[1],G.z-x[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(J),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const h=this._elevation,x=t.cf(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(x),M=h.getAtPointOrZero(new t.ae(...E)),k=this.pixelsPerMeter/this.worldSize*M,B=this._minimumHeightOverTerrain(),G=E[2]-k;if(G<=B)if(G<0||r){const J=this.locationCoordinate(this._center,this._centerAltitude),ee=[E[0],E[1],J.z-E[2]],ce=t.ag(ee);ee[2]-=(B-G)/this._pixelsPerMercatorPixel;const le=t.ag(ee);if(le===0)return;t.c5(ee,ee,ce/le*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],J.z*this._pixelsPerMercatorPixel-ee[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const le=this.center;return le.lat=t.aA(le.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(le.lng=t.aA(le.lng,this.minLng,this.maxLng)),this.center=le,void(this._constraining=!1)}const h=this._unmodified,{x,y:E}=this.point;let M=0,k=x,B=E;const G=this.width/2,J=this.height/2,ee=this.worldMinY*this.scale,ce=this.worldMaxY*this.scale;if(E-J<ee&&(B=ee+J),E+J>ce&&(B=ce-J),ce-ee<this.height&&(M=Math.max(M,this.height/(ce-ee)),B=(ce+ee)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const le=this.worldMinX*this.scale,he=this.worldMaxX*this.scale,be=this.worldSize/2-(le+he)/2;k=(x+be+this.worldSize)%this.worldSize-be,k-G<le&&(k=le+G),k+G>he&&(k=he-G),he-le<this.width&&(M=Math.max(M,this.width/(he-le)),k=(he+le)/2)}k===x&&B===E||this._allowWorldUnderZoom||(this.center=this.unproject(new t.P(k,B))),M&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,h=this.projection.name==="globe",x=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.cf(1,this.center.lat)/t.cf(1,t.d2));const E=t.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?x:1,k=this._camera.getWorldToCamera(this.worldSize,M);let B;const G=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(G[8]=2*-r.x/this.width,G[9]=2*r.y/this.height,this.isOrthographic){let Je=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),mt=Je*this.aspect,Pt=-mt,It=-Je;mt-=r.x,Pt-=r.x,Je+=r.y,It+=r.y,B=this._camera.getCameraToClipOrthographic(Pt,mt,It,Je,this._nearZ,this._farZ),((ri,si,_i,Vi)=>{for(let Kt=0;Kt<16;Kt++)ri[Kt]=t.ak(si[Kt],_i[Kt],Vi)})(B,B,G,t.d0(this.pitch>=il?1:this.pitch/il))}else B=G;const J=t.cP([],G,k);let ee=t.cP([],B,k);if(this.projection.isReprojectedInTileSpace){const Je=this.locationCoordinate(this.center),mt=t.bA([]);t.br(mt,mt,[Je.x*this.worldSize,Je.y*this.worldSize,0]),t.aB(mt,mt,t.cQ(this)),t.br(mt,mt,[-Je.x*this.worldSize,-Je.y*this.worldSize,0]),t.aB(ee,ee,mt),t.aB(J,J,mt),this.inverseAdjustmentMatrix=t.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.cS([],ee,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=ee,this.invProjMatrix=t.bl(new Float64Array(16),this.projMatrix),h){const Je=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Je[8]=2*-r.x/this.width,Je[9]=2*r.y/this.height,this.expandedFarZProjMatrix=t.cP([],Je,k)}else this.expandedFarZProjMatrix=this.projMatrix;const ce=t.bl([],B);this.frustumCorners=t.cT.fromInvProjectionMatrix(ce,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const le=new Float32Array(16);t.bA(le),t.cS(le,le,[1,-1,1]),t.cU(le,le,this._pitch),t.bB(le,le,this.angle);const he=t.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.bz(he);const be=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;he[8]=2*-r.x/this.width,he[9]=2*(r.y+be)/this.height,this.skyboxMatrix=t.aB(le,he,le);const _e=this.point,ke=_e.x,Ae=_e.y,Oe=this.width%2/2,He=this.height%2/2,Be=Math.cos(this.angle),dt=Math.sin(this.angle),nt=ke-Math.round(ke)+Be*Oe+dt*He,at=Ae-Math.round(Ae)+Be*He+dt*Oe,tt=new Float64Array(ee);if(t.br(tt,tt,[nt>.5?nt-1:nt,at>.5?at-1:at,0]),this.alignedProjMatrix=tt,ee=t.bC(),t.cS(ee,ee,[this.width/2,-this.height/2,1]),t.br(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=t.bC(),t.cS(ee,ee,[1,-1,1]),t.br(ee,ee,[-1,-1,0]),t.cS(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=t.aB(new Float64Array(16),this.labelPlaneMatrix,J),this._calcFogMatrices(),this._distanceTileDataCache={},ee=t.bl(new Float64Array(16),this.pixelMatrix),!ee)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=ee,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.cV(this);const Je=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.af(Je,Je,k),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ee;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,x=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,M=[r,r,h];t.c5(M,M,E),t.c5(x,x,-1),t.cW(x,x,M);const k=t.bC();t.br(k,k,x),t.cS(k,k,M),this.mercatorFogMatrix=k,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,h,E)}_computeCameraPosition(r){const h=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),E=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-r/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-x[0]*M,E.y/this.worldSize-x[1]*M,r/this.worldSize*this._centerAltitude-x[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],E=r[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(M=Math.min((h-x)/E,1)),this._camera.position=t.bH([],this._camera.position,r,M),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,h=this._camera.forward(),{pitch:x,bearing:E}=this._camera.getPitchBearing(),M=t.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,k=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.an(this._maxPitch)),B=Math.max((r[2]-M)/Math.cos(x),k),G=this._zoomFromMercatorZ(B);t.bH(r,r,h,B),this._pitch=t.aA(x,t.an(this.minPitch),t.an(this.maxPitch)),this.angle=t.bT(E,-Math.PI,Math.PI),this._setZoom(t.aA(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.ae(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let h=0,x=t.cL,E=0,M=1/0;for(;x-h>1e-6&&x>h;){const k=h+.5*(x-h),B=this.tileSize*Math.pow(2,k),G=this.getCameraToCenterDistance(this.projection,k,B),J=this.scaleZoom(G/(Math.max(0,r)*this.tileSize)),ee=Math.abs(k-J);ee<M&&(M=ee,E=k),k<J?h=k:x=k}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,h){const x=Math.min(r.x,h.x),E=Math.max(r.x,h.x),M=Math.min(r.y,h.y),k=Math.max(r.y,h.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const B=[new t.P(x,M),new t.P(E,k),new t.P(x,k),new t.P(E,M)],G=this.renderWorldCopies?-3:0,J=this.renderWorldCopies?4:1;for(const ee of B){const ce=this.pointRayIntersection(ee);if(ce.t<0)return!0;const le=this.rayIntersectionCoordinate(ce);if(le.x<G||le.y<0||le.x>J||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(r,h){const x=t.ag(t.av([],this._camera.position,r)),E=this._zoomFromMercatorZ(x)+h;return x-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const r=(function([h,x,E],M){const k=[h,x,E,1];t.aC(k,k,M);const B=k[3]=Math.max(k[3],1e-6);return k[0]/=B,k[1]/=B,k[2]/=B,k})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,r))}}getCameraToCenterDistance(r,h=this.zoom,x=this.worldSize){const E=t.cO(r,h,this.width,this.height,1024),M=r.pixelSpaceConversion(this.center.lat,x,E);let k=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(k=t.ak(1,k,t.d0(this.pitch>=il?1:this.pitch/il))),k}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.aB(r,r,this.globeMatrix),r}getFrustum(r){return t.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const rh=(v,r)=>{if(r>0&&v.terrain&&t.w("Cutoff is currently disabled on terrain"),r<=0||v.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=v.transform,x=Math.max(Math.abs(h._zoom-(v.minCutoffZoom-1)),1),E=h.isLODDisabled(!1)?t.ah(60,45,h.pitch):t.ah(30,15,h.pitch),M=h._farZ-h._nearZ,k=r*h.height,B=((1-(G=E))*h.cameraToCenterDistance+G*(h._farZ+k))*x;var G;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(B-h._nearZ)/M,(B-k-h._nearZ)/M]}}},Ec=2048;class of{constructor(r,h){this.aabb=r,this.lastCascade=h}}class Om{add(r,h){const x=this.receivers[r.key];x!==void 0?(x.aabb.min[0]=Math.min(x.aabb.min[0],h.min[0]),x.aabb.min[1]=Math.min(x.aabb.min[1],h.min[1]),x.aabb.min[2]=Math.min(x.aabb.min[2],h.min[2]),x.aabb.max[0]=Math.max(x.aabb.max[0],h.max[0]),x.aabb.max[1]=Math.max(x.aabb.max[1],h.max[1]),x.aabb.max[2]=Math.max(x.aabb.max[2],h.max[2])):this.receivers[r.key]=new of(h,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,h,x){const E=t.d9.fromPoints(r.points);let M=0;for(const k in this.receivers){const B=this.receivers[k];if(!B||!E.intersectsAabb(B.aabb))continue;B.aabb.min=E.closestPoint(B.aabb.min),B.aabb.max=E.closestPoint(B.aabb.max);const G=B.aabb.getCorners();for(let J=0;J<x.length;J++){let ee=!0;for(const ce of G){const le=[ce[0]*h,ce[1]*h,ce[2]];if(t.af(le,le,x[J].matrix),le[0]<-1||le[0]>1||le[1]<-1||le[1]>1){ee=!1;break}}if(B.lastCascade=J,M=Math.max(M,J),ee)break}}return M+1}}class uu{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Om,this._depthMode=new zn(r.context.gl.LEQUAL,zn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,h){const x=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const E=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||E<=0||(this._shadowLayerCount=x.style.order.reduce(((be,_e)=>{const ke=x.style._mergedLayers[_e];return be+(ke.hasShadowPass()&&!ke.isHidden(r.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=x.context,k=Ec,B=Ec;if(this._cascades.length===0||Ec!==this._cascades[0].texture.size[0]){this._cascades=[];for(let be=0;be<2;++be){const _e=x._shadowMapDebug,ke=M.gl,Ae=M.createFramebuffer(k,B,_e?1:0,"texture"),Oe=new t.T(M,{width:k,height:B,data:null},ke.DEPTH_COMPONENT16);if(Ae.depthAttachment.set(Oe.texture),_e){const He=new t.T(M,{width:k,height:B,data:null},ke.RGBA8);Ae.colorAttachment0.set(He.texture)}this._cascades.push({framebuffer:Ae,texture:Oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.cB,scale:0})}}this.shadowDirection=Fp(h);let G=0;if(r.elevation){const be=r.elevation,_e=[1e4,-1e4];be.visibleDemTiles.filter((ke=>ke.dem)).forEach((ke=>{const Ae=ke.dem.tree;_e[0]=Math.min(_e[0],Ae.minimums[0]),_e[1]=Math.max(_e[1],Ae.maximums[0])})),_e[0]!==1e4&&(G=(_e[1]-_e[0])*be.exaggeration())}const J=1.5*r.cameraToCenterDistance,ee=3*J,ce=new Float64Array(16);for(let be=0;be<this._cascades.length;++be){const _e=this._cascades[be];let ke=r.height/50,Ae=1;be===0?Ae=J:(ke=J,Ae=ee);const[Oe,He]=vd(r,this.shadowDirection,ke,Ae,Ec,G);_e.scale=r.scale,_e.matrix=Oe,_e.boundingSphereRadius=He,t.bl(ce,_e.matrix),_e.frustum=t.cB.fromInvProjectionMatrix(ce,1,0,!0),_e.far=Ae}const le=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[le].far,this._cascades[le].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Ec,this._uniformValues.u_shadowmap_0=$a.ShadowMap0,this._uniformValues.u_shadowmap_1=$a.ShadowMap0+1,this._groundShadowTiles=x.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const he=x.transform.elevation;for(const be of this._groundShadowTiles){let _e={min:0,max:0};if(he){const ke=he.getMinMaxForTile(be);ke&&(_e=ke)}this.addShadowReceiver(be.toUnwrapped(),_e.min,_e.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,h){if(!this.enabled)return;const x=this.painter,E=x.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(x.transform.getFrustum(0),x.transform.worldSize,this._cascades),E.viewport.set([0,0,Ec,Ec]);for(let M=0;M<this._numCascadesToRender;++M){x.currentShadowCascade=M,E.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),E.clear({color:t.ao.white,depth:1});for(const k of r.order){const B=r._mergedLayers[k];if(!B.hasShadowPass()||B.isHidden(x.transform.zoom))continue;const G=r.getLayerSourceCache(B),J=G?h[G.id]:void 0;(B.type==="model"||J&&J.length)&&x.renderLayer(x,G,B,J)}}x.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,h=r.style,x=r.context,E=x.gl,M=h.directionalLight,k=h.ambientLight;if(!M||!k)return;const B=[],G=rh(r,r.longestCutoffRange);G.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),B.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&B.push("NORMAL_OFFSET");const J=sh(h,M,k),ee=new zn(E.LEQUAL,zn.ReadOnly,r.depthRangeFor3D),ce=new sr({func:E.EQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.KEEP);for(const le of this._groundShadowTiles){const he=le.toUnwrapped(),be=r.isTileAffectedByFog(le),_e=r.getOrCreateProgram("groundShadow",{defines:B,overrideFog:be});this.setupShadows(he,_e),r.uploadCommonUniforms(x,_e,he,null,G);const ke={u_matrix:r.transform.calculateProjMatrix(he),u_ground_shadow_factor:J};_e.draw(r,E.TRIANGLES,ee,ce,yr.multiply,pr.disabled,ke,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?yr.unblended:yr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const h=this.painter.transform,x=h.calculatePosMatrix(r,h.worldSize);return t.aB(x,this._cascades[this.painter.currentShadowCascade].matrix,x),Float32Array.from(x)}calculateShadowPassMatrixFromMatrix(r){const h=t.bz(r);return t.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,r),h}setupShadows(r,h,x){if(!this.enabled)return;const E=this.painter.transform,M=this.painter.context,k=M.gl,B=this._uniformValues,G=new Float64Array(16),J=E.calculatePosMatrix(r,E.worldSize);for(let ee=0;ee<this._cascades.length;ee++)t.aB(G,this._cascades[ee].matrix,J),B[ee===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(G),M.activeTexture.set(k.TEXTURE0+$a.ShadowMap0+ee),this._cascades[ee].texture.bindExtraParam(k.LINEAR,k.LINEAR,k.CLAMP_TO_EDGE,k.CLAMP_TO_EDGE,k.GREATER);if(this.useNormalOffset=!!x,this.useNormalOffset){const ee=t.d7(r.canonical),ce=2/E.tileSize*t.al/Ec,le=ce*this._cascades[0].boundingSphereRadius,he=ce*this._cascades[this._cascades.length-1].boundingSphereRadius,be=(x==="vector-tile"?1:3)*(function(_e,ke,Ae,Oe,He){const Be=t.aA((_e-22)/-22,0,1);return .125*(1-Be)+4*Be})(E.zoom);B.u_shadow_normal_offset=[ee,le*be,he*be],B.u_shadow_bias=[1e-4,.0012,.012]}else B.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(M,B)}setupShadowsFromMatrix(r,h,x=!1){if(!this.enabled)return;const E=this.painter.context,M=E.gl,k=this._uniformValues,B=new Float64Array(16);for(let G=0;G<2;G++)t.aB(B,this._cascades[G].matrix,r),k[G===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),E.activeTexture.set(M.TEXTURE0+$a.ShadowMap0+G),this._cascades[G].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);this.useNormalOffset=x,x?(k.u_shadow_normal_offset=[1,3,3],k.u_shadow_bias=[6e-5,.0012,.012]):k.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(E,k)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,h,x,E){if(E[2]>=0)return{};const M=(function(G,J,ee){const ce=ee/(1<<G.canonical.z);return new t.d9([G.canonical.x*ce+G.wrap*ee,G.canonical.y*ce+G.wrap*ee,0],[(G.canonical.x+1)*ce+G.wrap*ee,(G.canonical.y+1)*ce+G.wrap*ee,J])})(r,h,x).getCorners(),k=h/-E[2];E[0]<0?(t.d8(M[0],M[0],[E[0]*k,0,0]),t.d8(M[3],M[3],[E[0]*k,0,0])):E[0]>0&&(t.d8(M[1],M[1],[E[0]*k,0,0]),t.d8(M[2],M[2],[E[0]*k,0,0])),E[1]<0?(t.d8(M[0],M[0],[0,E[1]*k,0]),t.d8(M[1],M[1],[0,E[1]*k,0])):E[1]>0&&(t.d8(M[2],M[2],[0,E[1]*k,0]),t.d8(M[3],M[3],[0,E[1]*k,0]));const B={};return B.vertices=M,B.planes=[af(M[1],M[0],M[4]),af(M[2],M[1],M[5]),af(M[3],M[2],M[6]),af(M[0],M[3],M[7])],B}addShadowReceiver(r,h,x){this._receivers.add(r,t.d9.fromTileIdAndHeight(r,h,x))}getMaxCascadeForTile(r){const h=this._receivers.get(r);return h&&h.lastCascade?h.lastCascade:0}}function af(v,r,h){const x=t.av([],h,r),E=t.av([],v,r),M=t.bI([],x,E),k=t.ag(M);return k===0?[0,0,1,0]:(t.c5(M,M,1/k),[M[0],M[1],M[2],-t.bJ(M,r)])}function Fp(v){const r=v.properties.get("direction"),h=t.d4(r.x,r.y,r.z);h[2]=t.aA(h[2],0,75);const x=t.d6([h[0],h[1],h[2]]);return t.d5(x.x,x.y,x.z)}function sh(v,r,h){const x=r.properties.get("color-use-theme")==="none",E=r.properties.get("color"),M=r.properties.get("intensity"),k=r.properties.get("direction"),B=[k.x,k.y,k.z],G=h.properties.get("color-use-theme")==="none",J=h.properties.get("color"),ee=h.properties.get("intensity"),ce=Math.max(t.bJ([0,0,1],B),0),le=[0,0,0];t.c5(le,J.toPremultipliedRenderColor(G?null:v.getLut(r.scope)).toArray01Linear().slice(0,3),ee);const he=[0,0,0];return t.c5(he,E.toPremultipliedRenderColor(x?null:v.getLut(h.scope)).toArray01Linear().slice(0,3),ce*M),t.db([le[0]>0?le[0]/(le[0]+he[0]):0,le[1]>0?le[1]/(le[1]+he[1]):0,le[2]>0?le[2]/(le[2]+he[2]):0])}function vd(v,r,h,x,E,M){const k=v.zoom,B=v.scale,G=v.worldSize,J=1/G,ee=v.aspect,ce=Math.sqrt(1+ee*ee)*Math.tan(.5*v.fovX),le=ce*ce,he=x-h,be=x+h;let _e,ke;le>he/be?(_e=x,ke=x*ce):(_e=.5*be*(1+le),ke=.5*Math.sqrt(he*he+2*(x*x+h*h)*le+be*be*le*le));const Ae=v.projection.pixelsPerMeter(v.center.lat,G),Oe=v._camera.getCameraToWorldMercator(),He=[0,0,-_e*J];t.af(He,He,Oe);let Be=ke*J;const dt=v._edgeInsets;if(!(dt.left===0&&dt.top===0&&dt.right===0&&dt.bottom===0||dt.left===dt.right&&dt.top===dt.bottom)){const Li=v._camera.getWorldToCamera(v.worldSize,v.projection.zAxisUnit==="meters"?Ae:1),en=v._camera.getCameraToClipPerspective(v._fov,v.width/v.height,h,x);en[8]=2*-v.centerOffset.x/v.width,en[9]=2*v.centerOffset.y/v.height;const xn=new Float64Array(16);t.cP(xn,en,Li);const Yi=new Float64Array(16);t.bl(Yi,xn);const Wi=t.cB.fromInvProjectionMatrix(Yi,G,k,!0);for(const kn of Wi.points){const Pn=((nt=kn)[0]/=B,nt[1]/=B,nt[2]=t.cf(nt[2],v._center.lat),nt);Be=Math.max(Be,t.c6(t.da([],He,Pn)))}}var nt;Be*=E/(E-1);const at=Math.acos(r[2]),tt=Math.atan2(-r[0],-r[1]),Je=new qf;Je.position=He,Je.setPitchBearing(at,tt);const mt=Je.getWorldToCamera(G,Ae),Pt=Be*G,It=Math.min(v._mercatorZfromZoom(17)*G*-2,-2*Pt),ri=Je.getCameraToClipOrthographic(-Pt,Pt,-Pt,Pt,It,(Pt+M*Ae)/r[2]),si=new Float64Array(16);t.aB(si,ri,mt);const _i=t.d5(Math.floor(1e6*He[0])/1e6*G,Math.floor(1e6*He[1])/1e6*G,0),Vi=.5*E,Kt=[0,0,0];t.af(Kt,_i,si),t.c5(Kt,Kt,Vi);const bt=[Math.floor(Kt[0]),Math.floor(Kt[1]),Math.floor(Kt[2])],oi=[0,0,0];t.av(oi,Kt,bt),t.c5(oi,oi,-1/Vi);const ni=new Float64Array(16);return t.bA(ni),t.br(ni,ni,oi),t.aB(si,ni,si),[si,Pt]}class f0 extends t.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,h){return t.dc(this.requestManager.transformRequest(h,t.R.Model).url).then((x=>{if(!x)return;const E=t.dd(x),M=new t.de(r,h,void 0,void 0,E);return M.computeBoundsAndApplyParent(),M})).catch((x=>{if(x&&x.status===404)return null;this.fire(new t.y(new Error(`Could not load model ${r} from ${h}: ${x.message}`)))}))}load(r,h,x={forceReload:!1}){this.models[h]||(this.models[h]={});const E=Object.keys(r),M=[],k=[];for(const B of E){const G=r[B];this.hasURLBeenRequested(G)&&!x.forceReload||(this.modelByURL[G]={modelId:B,scope:h},M.push(this.loadModel(B,G)),k.push(B)),this.models[h][B]||(this.models[h][B]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+k.length,Promise.allSettled(M).then((B=>{for(let G=0;G<B.length;G++){const{status:J}=B[G];if(J==="rejected")continue;const{value:ee}=B[G];this.models[h][k[G]]||(this.models[h][k[G]]={model:null,numReferences:1}),this.models[h][k[G]].model=ee}this.numModelsLoading[h]-=k.length,this.fire(new t.z("data",{dataType:"style"}))})).catch((B=>{this.fire(new t.y(new Error(`Could not load models: ${B.message}`)))}))}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,h,x={exactIdMatch:!1}){return!!(x.exactIdMatch?this.getModel(r,h):this.getModelByURL(this.modelUris[h][r]))}getModel(r,h){return this.models[h]||(this.models[h]={}),this.models[h][r]?this.models[h][r].model:void 0}getModelByURL(r){if(!r)return null;const h=this.modelByURL[r];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(r,h){return this.models[h]&&this.models[h][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,h,x){this.models[x]||(this.models[x]={}),this.modelUris[x]||(this.modelUris[x]={});const E=this.requestManager.normalizeModelURL(h);if((this.hasModel(r,x,{exactIdMatch:!0})||this.hasModelBeenAdded(r,x))&&this.modelUris[x][r]===E)this.models[x][r].numReferences++;else if(this.hasURLBeenRequested(E)){const{scope:M,modelId:k}=this.modelByURL[E];this.models[M][k].numReferences++}else this.modelUris[x][r]=E,this.load({[r]:this.modelUris[x][r]},x)}addModelURLs(r,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const x=this.modelUris[h];for(const E in r)x[E]=this.requestManager.normalizeModelURL(r[E])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const x={};for(const E of r)this.hasModel(E,h,{exactIdMatch:!0})||this.hasURLBeenRequested(E)?this.models[h][E].numReferences++:this.modelUris[h][E]&&!this.hasURLBeenRequested(E)?x[E]=this.modelUris[h][E]:!this.hasURLBeenRequested(E)&&t.df(E,!1)&&(this.modelUris[h][E]=this.requestManager.normalizeModelURL(E),x[E]=this.modelUris[h][E]);this.load(x,h)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,h,x=!1,E=!1){if(this.models[h]&&this.models[h][r]&&(this.models[h][r].numReferences--,this.models[h][r].numReferences===0||E)){const M=this.modelUris[h][r];x||delete this.modelUris[h][r],delete this.modelByURL[M];const k=this.models[h][r].model;if(!k)return;delete this.models[h][r],k.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const h of Object.keys(this.models[r])){const x=this.models[r][h].model;delete this.models[r][h],x&&x.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,h){this.models[h]||(this.models[h]={});for(const x in this.models[h])this.models[h][x].model&&this.models[h][x].model.upload(r.context)}}const Fm=t.a6.colorTheme,p0=new t.a9({data:new t.aa(Fm.data)});function _o(v){if(!v.metadata||!v.metadata.content_area)return;const r=t.o.devicePixelRatio,{left:h,top:x,width:E,height:M}=v.metadata.content_area,k=h*r,B=x*r;return[k,B,k+E*r,B+M*r]}function Bp(v){if(v)return v.map((([r,h])=>[r*t.o.devicePixelRatio,h*t.o.devicePixelRatio]))}class Wf{constructor(r,h,x){this.id=r,this.scope=h,this.sourceCache=x,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return r;const x=this.sourceCache.getSource();if(!(x instanceof yl))return r;const E=h.map((k=>this.sourceCache.getTile(k))),M=x.getImages(E,Array.from(this.pendingRequests));for(const[k,B]of M)r.set(t.I.from({name:k,iconsetId:this.id}),B),this.pendingRequests.delete(k);for(const k of this.pendingRequests)this.missingRequests.add(k);return this.pendingRequests.clear(),r}}const ku=(v,r)=>qe(v,r&&r.filter((h=>h.identifier!=="source.canvas"))),Bm=t.aH($r,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),xd=t.aH($r,["setCenter","setZoom","setBearing","setPitch"]),bd=new Set(["background","sky","slot","custom"]),$c={version:8,layers:[],sources:{}},Kl={duration:300,delay:0};class Gc extends t.E{constructor(r,h={}){super(),this.map=r,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=Object.assign({},Kl),this._buildingIndex=new fd(this),this.crossTileSymbolIndex=new cu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=h.styleChanges||new pt,this._hasDataDrivenEmissive=!1,this.dispatcher=h.dispatcher?h.dispatcher:new t.D(t.dh(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new vi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new t.di(r._requestManager,h.localFontFamily?t.dj.all:h.localIdeographFontFamily?t.dj.ideographs:t.dj.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new f0(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._indoorDependentLayers=h.indoorDependentLayers?h.indoorDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",t.dk());const x=this;this._rtlTextPluginCallback=Gc.registerForPluginStateChange((E=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},((M,k)=>{if(t.dl(M),k&&k.every((B=>B)))for(const B in x._sourceCaches){const G=x._sourceCaches[B],J=G.getSource().type;J!=="vector"&&J!=="geojson"||G.reload()}}))})),this.on("data",(E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const M=this.getOwnSource(E.sourceId);if(M&&M.vectorLayerIds)for(const k in this._layers){const B=this._layers[k];B.source===M.id&&this._validateLayer(B)}}))}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(t.h(r))return r;const h=t.dm(r);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${t.dn(JSON.stringify(r))}`}_diffStyle(r,h,x){this.globalId=this._getGlobalId(r);const E=(M,k)=>{try{k(null,this.setState(M,x))}catch(B){k(B,!1)}};if(typeof r=="string"){const M=this.map._requestManager.normalizeStyleURL(r),k=this.map._requestManager.transformRequest(M,t.R.Style);t.m(k,((B,G)=>{B?this.fire(new t.y(B)):G&&E(G,h)}))}else typeof r=="object"&&E(r,h)}loadURL(r,h={}){this.fire(new t.z("dataloading",{dataType:"style"}));const x=typeof h.validate=="boolean"?h.validate:!t.h(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,h.accessToken),this.resolvedImports.add(r);const E=this.importsCache.get(r);if(E)return this._load(E,x);const M=this.map._requestManager.transformRequest(r,t.R.Style);this._request=t.m(M,((k,B)=>{if(this._request=null,k)this.fire(new t.y(k));else if(B)return this.importsCache.set(r,B),this._load(B,x)}))}loadJSON(r,h={}){this.fire(new t.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=t.o.frame((()=>{this._request=null,this._load(r,h.validate!==!1)}))}loadEmpty(){this.fire(new t.z("dataloading",{dataType:"style"})),this._load($c,!1)}_loadImports(r,h,x){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const M of r){const k=this._createFragmentStyle(M),B=new Promise((ee=>{k.once("style.import.load",ee),k.once("error",ee)})).then((()=>this.mergeAll()));if(E.push(B),this.resolvedImports.has(M.url)){k.loadEmpty();continue}const G=M.data||this.importsCache.get(M.url);G?(k.loadJSON(G,{validate:h}),this._isInternalStyle(G)&&(k.globalId=null)):M.url?k.loadURL(M.url,{validate:h}):k.loadEmpty();const J={style:k,id:M.id,config:M.config};if(x){const ee=this.fragments.findIndex((({id:ce})=>ce===x));this.fragments=this.fragments.slice(0,ee).concat(J).concat(this.fragments.slice(ee))}else this.fragments.push(J)}return Promise.allSettled(E)}getImportGlobalIds(r=this,h=new Set){for(const x of r.fragments)x.style.globalId&&h.add(x.style.globalId),this.getImportGlobalIds(x.style,h);return[...h.values()]}_createFragmentStyle(r){const h=this.scope?t.B(r.id,this.scope):r.id;let x;const E=this._initialConfig&&this._initialConfig[h];(r.config||E)&&(x=Object.assign({},r.config,E));const M=new Gc(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:x,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,h){if(this._isInternalStyle(r)){const M=Object.assign({},$c,{imports:[{id:"basemap",data:r,url:""}]},r.center?{center:r.center}:{},r.bearing?{bearing:r.bearing}:{},r.pitch?{pitch:r.pitch}:{},r.zoom?{zoom:r.zoom}:{},r.light?{light:r.light}:{});return this._importedAsBasemap=!0,void this._load(M,h)}if(this.updateConfig(this._config,r.schema),h&&ku(this,Hs(r)))return;this._loaded=!0,this.stylesheet=t.dp(r);const x=()=>{for(const G in r.sources)this.addSource(G,r.sources[G],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const G in r.iconsets)this.addIconset(G,r.iconsets[G]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const M=Iu(this.stylesheet.layers);if(this._order=M.map((G=>G.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const G=this.stylesheet.lights[0];this.light=new Ct(G.properties,G.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ct(this.stylesheet.light)),this._layers={};for(const G of M){const J=t.du(G,this.scope,this._styleColorTheme.lut,this.options);J.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(J.fqid),J.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(J.fqid),this._hasAppearances=this._hasAppearances||J.getAppearances().length!==0,J.setEventedParent(this,{layer:{id:J.id}}),this._layers[J.id]=J;const ee=this.getOwnLayerSourceCache(J),ce=!!this.directionalLight&&this.directionalLight.shadowsEnabled();ee&&J.canCastShadows()&&ce&&(ee.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.z("data",{dataType:"style"}));const B=this.isRootStyle();r.imports?this._loadImports(r.imports,h).then((()=>{this._reloadImports(),this.fire(new t.z(B?"style.load":"style.import.load"))})).catch((G=>{this.fire(new t.y(new Error("Failed to load imports",G))),this.fire(new t.z(B?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new t.z(B?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const E=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(E){const M=this._evaluateColorThemeData(E);this._loadColorTheme(M).then((()=>{x()})).catch((k=>{t.w(`Couldn't load color theme from the stylesheet: ${k}`),x()}))}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((r=>r.style.hasAppearances()))}mergeAll(){let r,h,x,E,M,k,B,G,J,ee;const ce={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((le=>{if(le.stylesheet){if(le.light!=null&&(r=le.light),le.stylesheet.lights)for(const he of le.stylesheet.lights)he.type==="ambient"&&le.ambientLight!=null&&(h=le.ambientLight),he.type==="directional"&&le.directionalLight!=null&&(x=le.directionalLight);E=this._prioritizeTerrain(E,le.terrain,le.stylesheet.terrain),le.stylesheet.fog&&le.fog!=null&&(M=le.fog),le.stylesheet.snow&&le.snow!=null&&(k=le.snow),le.stylesheet.rain&&le.rain!=null&&(B=le.rain),le.stylesheet.camera!=null&&(ee=le.stylesheet.camera),le.stylesheet.projection!=null&&(G=le.stylesheet.projection),le.stylesheet.transition!=null&&(J=le.stylesheet.transition),ce[le.scope]=le._styleColorTheme}})),this.light=r,this.ambientLight=h,this.directionalLight=x,this.fog=M,this.snow=k,this.rain=B,this._styleColorThemeForScope=ce,E===null?delete this.terrain:this.terrain=E,this.camera=ee||{"camera-projection":"perspective"},this.projection=G||{name:"mercator"},this.transition=Object.assign({},Kl,J),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(r){const h=x=>{for(const E of x.fragments)h(E.style);r(x)};h(this)}_prioritizeTerrain(r,h,x){const E=r&&r.drapeRenderMode===0;return x===null?h&&h.drapeRenderMode===0?h:E?r:null:h!=null&&(!r||E||h&&h.drapeRenderMode===1)?h:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((h=>{r=this._prioritizeTerrain(r,h.terrain,h.stylesheet.terrain)})),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle((h=>{h.stylesheet.projection!=null&&(r=h.stylesheet.projection)})),this.projection=r||{name:"mercator"}}mergeSources(){const r={},h={},x={};this.forEachFragmentStyle((E=>{for(const M in E._sourceCaches){const k=t.B(M,E.scope);r[k]=E._sourceCaches[M]}for(const M in E._otherSourceCaches){const k=t.B(M,E.scope);h[k]=E._otherSourceCaches[M]}for(const M in E._symbolSourceCaches){const k=t.B(M,E.scope);x[k]=E._symbolSourceCaches[M]}})),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=x}mergeIndoor(){this.forEachFragmentStyle((r=>{if(r.stylesheet&&r.stylesheet.indoor)for(const h of Object.values(r.stylesheet.indoor)){const x=h,E=t.B(x.sourceId,r.scope);this._mergedIndoor[E]=new Set(x.sourceLayers||[])}}))}mergeLayers(){const r={},h=[],x={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((k=>{for(const B of k._order){const G=k._layers[B];if(G.type==="slot"){const J=t.dq(B);if(r[J])continue;r[J]=[]}G.slot&&r[G.slot]?r[G.slot].push(G):h.push(G)}})),this._mergedOrder=[];let E=-1;const M=(k=[])=>{for(const B of k)if(B.type==="slot"){const G=t.dq(B.id);r[G]&&M(r[G]),this._mergedSlots.push(G)}else{const G=t.B(B.id,B.scope);this._mergedOrder.push(G),x[G]=B,B.is3D(!!this.terrain)&&(this._has3DLayers=!0,E=this._mergedOrder.length-1),B.type==="circle"&&(this._hasCircleLayers=!0),B.type==="symbol"&&(this._hasSymbolLayers=!0),B.type==="clip"&&(this._clipLayerPresent=!0)}};if(M(h),this._has3DLayers){const k={};for(let B=0;B<this._mergedOrder.length;++B){const G=this._mergedOrder[B];k[G]=B===E?1:B<E?x[G].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((B,G)=>k[B]-k[G]))}this._mergedLayers=x,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?(function(h,x,E,M){const k=Object.assign({},x);for(const G of Object.keys(Fm))k[G]===void 0&&(k[G]=Fm[G].default);const B=new t.a8(p0,h,new Map(E));return B.setTransitionOrValue(k,E),B.untransitioned().possiblyEvaluate(new t.ac(0,{worldview:void 0}))})(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((x,E)=>{const M="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void x();let k=r;k.startsWith(M)||(k=M+k);const B=t.I.from("mapbox-reserved-lut"),G=new Image;G.src=k,G.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},G.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void x();this._styleColorTheme.lutLoading=!1;const{width:J,height:ee,data:ce}=t.o.getImageData(G);if(ee>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(J!==ee*ee)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(B)&&this.removeImage(B),this.addImage(B,{data:new t.q({width:J,height:ee},ce),pixelRatio:1,sdf:!1,usvg:!1,version:0});const le=this.imageManager.getImage(B,this.scope);le?(this._styleColorTheme.lut={image:le.data,data:r},x()):E(new Error("Missing LUT image."))}}))}getLut(r){const h=this._styleColorThemeForScope[r];return h?h.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=(function(h,x,E){let M,k,B;const G=t.o.devicePixelRatio>1?"@2x":"";let J=t.m(x.transformRequest(x.normalizeSpriteURL(h,G,".json"),t.R.SpriteJSON),((le,he)=>{J=null,B||(B=le,M=he,ce())})),ee=t.n(x.transformRequest(x.normalizeSpriteURL(h,G,".png"),t.R.SpriteImage),((le,he)=>{ee=null,B||(B=le,k=he,ce())}));function ce(){if(B)E(B);else if(M&&k){const le=t.o.getImageData(k),he={};for(const be in M){const{width:_e,height:ke,x:Ae,y:Oe,sdf:He,pixelRatio:Be,stretchX:dt,stretchY:nt,content:at}=M[be],tt=new t.q({width:_e,height:ke});t.q.copy(le,tt,{x:Ae,y:Oe},{x:0,y:0},{width:_e,height:ke},null),he[be]={data:tt,pixelRatio:Be!==void 0?Be:1,sdf:He!==void 0&&He,stretchX:dt,stretchY:nt,content:at,usvg:!1,version:0}}E(null,he)}}return{cancel(){J&&(J.cancel(),J=null),ee&&(ee.cancel(),ee=null)}}})(r,this.map._requestManager,((h,x)=>{if(this._spriteRequest=null,h)this.fire(new t.y(h));else if(x){const E=new Map;for(const M in x)E.set(t.I.from(M),x[M]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))}))}addIconset(r,h){if(h.type==="sprite")return void this._loadSprite(h.url);const x=this.getOwnSourceCache(h.source);if(!x)return void this.fire(new t.y(new Error(`Source "${h.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const E=x.getSource();if(E.type!=="raster-array")return void this.fire(new t.y(new Error(`Source "${h.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));E.partial=!1;const M=new Wf(r,this.scope,x);this.imageManager.addImageProvider(M,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!t.h(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const h=this.map._spriteFormat==="auto";var x,E;this._spriteRequest=(E=(M,k)=>{if(this._spriteRequest=null,M)h?this._loadSprite(r):this.fire(new t.y(M));else if(k){const B=new Map;for(const G in k)B.set(t.I.from(G),k[G]);this.addImages(B)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))},t.bu((x=this.map._requestManager).transformRequest(x.normalizeIconsetURL(r),t.R.Iconset),((M,k)=>{if(M)return void E(M);const B={},G=t.dg(new t.bt(k));for(const J of G.icons){const ee={version:1,pixelRatio:t.o.devicePixelRatio,content:_o(J),stretchX:J.metadata?Bp(J.metadata.stretch_x_areas):void 0,stretchY:J.metadata?Bp(J.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:J};B[J.name]=ee}E(null,B)})))}_validateLayer(r){const h=this.getOwnSource(r.source);if(!h)return;const x=r.sourceLayer;x&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(x)===-1)&&this.fire(new t.y(new Error(`Source layer "${x}" does not exist on source "${h.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((r,h)=>{const x=this.fragments[h];return x&&x.style&&(r.data=x.style.serialize()),r}))}_serializeSources(){const r={};for(const h in this._sourceCaches){const x=this._sourceCaches[h].getSource();r[x.id]||(r[x.id]=x.serialize())}return r}_serializeLayers(r){const h=[];for(const x of r){const E=this._layers[x];E&&E.type!=="custom"&&h.push(E.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const r in this._mergedLayers){const h=this._mergedLayers[r];if(h._transitionablePaint&&h._transitionablePaint._values){const x=h._transitionablePaint._values["line-emissive-strength"];if(x&&x.value&&x.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const h=this.getOwnLayer(r);if(h)return h;this.fire(new t.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const h=this.getOwnSource(r);if(h)return h;this.fire(new t.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,h){const x=this.map.painter;if(x)for(let E=r.minzoom||0;E<(r.maxzoom||25.5);E++){const M=r.getProgramIds();if(M)for(const k of M){const B=r.getDefaultProgramParams(k,h.zoom,this._styleColorTheme.lut);B&&(x.style=this,this.fog&&(x._fogVisible=!0,B.overrideFog=!0,x.getOrCreateProgram(k,B)),x._fogVisible=!1,B.overrideFog=!1,x.getOrCreateProgram(k,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,x.getOrCreateProgram(k,B)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const h=this.calculateLightsBrightness();r.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const x=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const B=this._changes.getLayerUpdatesByScope();for(const G in B){const{updatedIds:J,removedIds:ee}=B[G];(J||ee)&&(this._updateWorkerLayers(G,J,ee),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const M={};for(const B in this._mergedSourceCaches){const G=this._mergedSourceCaches[B];M[B]=G.used,G.used=!1,G.tileCoverLift=0}for(const B of this._mergedOrder){const G=this._mergedLayers[B];if(G.visibility!=="none"&&G.recalculate(r,this._availableImages),!G.isHidden(r.zoom)){const J=this.getLayerSourceCache(G);J&&(J.used=!0,J.tileCoverLift=Math.max(J.tileCoverLift,G.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(G,r)})):this.precompilePrograms(G,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();const k=this.imageManager.getPendingImageProviders();for(const B of k)B.sourceCache.used=!0;for(const B in M){const G=this._mergedSourceCaches[B];M[B]!==G.used&&G.getSource().fire(new t.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:G.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),x&&this.fire(new t.z("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const h of r){const x=h.resolvePendingRequests(),E=this.getFragmentStyle(h.scope);E&&E.addImages(x)}}_updateTilesForChangedImages(){const r={};for(const h in this._mergedSourceCaches){const x=this._mergedSourceCaches[h].getSource().scope;r[x]=r[x]||this._changes.getUpdatedImages(x),r[x].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r[x])}for(const h in r)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(r,h,x){const E=this.getFragmentStyle(r);E&&this.dispatcher.broadcast("updateLayers",{layers:h?E._serializeLayers(h):[],scope:r,removedIds:x||[],options:E.options})}setState(r,h){if(this._checkLoaded(),ku(this,Hs(r)))return!1;(r=t.dp(r)).layers=Iu(r.layers);const x=(function(k,B){if(!k)return[{command:$r.setStyle,args:[B]}];let G=[];try{if(!t.by(k.version,B.version))return[{command:$r.setStyle,args:[B]}];if(t.by(k.center,B.center)||G.push({command:$r.setCenter,args:[B.center]}),t.by(k.zoom,B.zoom)||G.push({command:$r.setZoom,args:[B.zoom]}),t.by(k.bearing,B.bearing)||G.push({command:$r.setBearing,args:[B.bearing]}),t.by(k.pitch,B.pitch)||G.push({command:$r.setPitch,args:[B.pitch]}),t.by(k.sprite,B.sprite)||G.push({command:$r.setSprite,args:[B.sprite]}),t.by(k.glyphs,B.glyphs)||G.push({command:$r.setGlyphs,args:[B.glyphs]}),t.by(k.imports,B.imports)||(function(he=[],be=[],_e){be=be||[];const ke=(he=he||[]).map(Jd),Ae=be.map(Jd),Oe=he.reduce(Cu,{}),He=be.reduce(Cu,{}),Be=ke.slice();let dt,nt,at,tt;for(dt=0,nt=0;dt<ke.length;dt++)at=ke[dt],He.hasOwnProperty(at)?nt++:(_e.push({command:$r.removeImport,args:[at]}),Be.splice(Be.indexOf(at,nt),1));for(dt=0,nt=0;dt<Ae.length;dt++)at=Ae[Ae.length-1-dt],Be[Be.length-1-dt]!==at&&(Oe.hasOwnProperty(at)?(_e.push({command:$r.removeImport,args:[at]}),Be.splice(Be.lastIndexOf(at,Be.length-nt),1)):nt++,tt=Be[Be.length-dt],_e.push({command:$r.addImport,args:[He[at],tt]}),Be.splice(Be.length-dt,0,at));for(const Je of be){const mt=Oe[Je.id];mt&&(delete mt.data,t.by(mt,Je)||_e.push({command:$r.updateImport,args:[Je.id,Je]}))}})(k.imports,B.imports,G),t.by(k.transition,B.transition)||G.push({command:$r.setTransition,args:[B.transition]}),t.by(k.light,B.light)||G.push({command:$r.setLight,args:[B.light]}),t.by(k.fog,B.fog)||G.push({command:$r.setFog,args:[B.fog]}),t.by(k.snow,B.snow)||G.push({command:$r.setSnow,args:[B.snow]}),t.by(k.rain,B.rain)||G.push({command:$r.setRain,args:[B.rain]}),t.by(k.projection,B.projection)||G.push({command:$r.setProjection,args:[B.projection]}),t.by(k.lights,B.lights)||G.push({command:$r.setLights,args:[B.lights]}),t.by(k.camera,B.camera)||G.push({command:$r.setCamera,args:[B.camera]}),t.by(k.iconsets,B.iconsets)||(function(he,be,_e){let ke;for(ke in be=be||{},he=he||{})he.hasOwnProperty(ke)&&(be.hasOwnProperty(ke)||_e.push({command:$r.removeIconset,args:[ke]}));for(ke in be){if(!be.hasOwnProperty(ke))continue;const Ae=be[ke];he.hasOwnProperty(ke)?t.by(he[ke],Ae)||(_e.push({command:$r.removeIconset,args:[ke]}),_e.push({command:$r.addIconset,args:[ke,Ae]})):_e.push({command:$r.addIconset,args:[ke,Ae]})}})(k.iconsets,B.iconsets,G),!t.by(k["color-theme"],B["color-theme"]))return[{command:$r.setStyle,args:[B]}];const J={},ee=[];(function(he,be,_e,ke){let Ae;for(Ae in be=be||{},he=he||{})he.hasOwnProperty(Ae)&&(be.hasOwnProperty(Ae)||Xl(Ae,_e,ke));for(Ae in be){if(!be.hasOwnProperty(Ae))continue;const Oe=be[Ae];he.hasOwnProperty(Ae)?t.by(he[Ae],Oe)||(he[Ae].type==="geojson"&&Oe.type==="geojson"&&Ju(he,be,Ae)?_e.push({command:$r.setGeoJSONSourceData,args:[Ae,Oe.data]}):pd(Ae,be,_e,ke)):Kd(Ae,be,_e)}})(k.sources,B.sources,ee,J);const ce=[];k.layers&&k.layers.forEach((he=>{he.source&&J[he.source]?G.push({command:$r.removeLayer,args:[he.id]}):ce.push(he)}));let le=k.terrain;le&&J[le.source]&&(G.push({command:$r.setTerrain,args:[void 0]}),le=void 0),G=G.concat(ee),t.by(le,B.terrain)||G.push({command:$r.setTerrain,args:[B.terrain]}),(function(he,be,_e){be=be||[];const ke=(he=he||[]).map(Jd),Ae=be.map(Jd),Oe=he.reduce(Cu,{}),He=be.reduce(Cu,{}),Be=ke.slice(),dt=Object.create(null);let nt,at,tt,Je,mt,Pt,It;for(nt=0,at=0;nt<ke.length;nt++)tt=ke[nt],He.hasOwnProperty(tt)?at++:(_e.push({command:$r.removeLayer,args:[tt]}),Be.splice(Be.indexOf(tt,at),1));for(nt=0,at=0;nt<Ae.length;nt++)tt=Ae[Ae.length-1-nt],Be[Be.length-1-nt]!==tt&&(Oe.hasOwnProperty(tt)?(_e.push({command:$r.removeLayer,args:[tt]}),Be.splice(Be.lastIndexOf(tt,Be.length-at),1)):at++,Pt=Be[Be.length-nt],_e.push({command:$r.addLayer,args:[He[tt],Pt]}),Be.splice(Be.length-nt,0,tt),dt[tt]=!0);for(nt=0;nt<Ae.length;nt++)if(tt=Ae[nt],Je=Oe[tt],mt=He[tt],!dt[tt]&&!t.by(Je,mt))if(t.by(Je.source,mt.source)&&t.by(Je["source-layer"],mt["source-layer"])&&t.by(Je.type,mt.type)){for(It in Lh(Je.layout,mt.layout,_e,tt,null,$r.setLayoutProperty),Lh(Je.paint,mt.paint,_e,tt,null,$r.setPaintProperty),t.by(Je.slot,mt.slot)||_e.push({command:$r.setSlot,args:[tt,mt.slot]}),t.by(Je.filter,mt.filter)||_e.push({command:$r.setFilter,args:[tt,mt.filter]}),t.by(Je.minzoom,mt.minzoom)&&t.by(Je.maxzoom,mt.maxzoom)||_e.push({command:$r.setLayerZoomRange,args:[tt,mt.minzoom,mt.maxzoom]}),Je)Je.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&It!=="slot"&&(It.indexOf("paint.")===0?Lh(Je[It],mt[It],_e,tt,It.slice(6),$r.setPaintProperty):t.by(Je[It],mt[It])||_e.push({command:$r.setLayerProperty,args:[tt,It,mt[It]]}));for(It in mt)mt.hasOwnProperty(It)&&!Je.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&It!=="slot"&&(It.indexOf("paint.")===0?Lh(Je[It],mt[It],_e,tt,It.slice(6),$r.setPaintProperty):t.by(Je[It],mt[It])||_e.push({command:$r.setLayerProperty,args:[tt,It,mt[It]]}))}else _e.push({command:$r.removeLayer,args:[tt]}),Pt=Be[Be.lastIndexOf(tt)+1],_e.push({command:$r.addLayer,args:[mt,Pt]})})(ce,B.layers,G)}catch(J){console.warn("Unable to compute style diff:",J),G=[{command:$r.setStyle,args:[B]}]}return G})(this.serialize(),r).filter((k=>!(k.command in xd)));if(x.length===0)return!1;const E=x.filter((k=>!(k.command in Bm)));if(E.length>0)throw new Error(`Unimplemented: ${E.map((k=>k.command)).join(", ")}.`);const M=[];return x.forEach((k=>{M.push(this[k.command](...k.args))})),h&&Promise.all(M).then(h).catch(h),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(const[h,x]of r.entries()){if(this.getImage(h))return this.fire(new t.y(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,x),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new t.z("data",{dataType:"style"})),this}addImage(r,h){return this.getImage(r)?this.fire(new t.y(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,h),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new t.z("data",{dataType:"style"})),this)}updateImage(r,h,x=!1){this.imageManager.updateImage(r,this.scope,h),x&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new t.z("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new t.z("data",{dataType:"style"})),this):this.fire(new t.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(r){return this.modelManager.addModelURLs(r,this.getActualScope()),this._updateWorkerModels(),this.fire(new t.z("data",{dataType:"style"})),this}addModel(r,h,x={}){return this._checkLoaded(),this._validate(we,`models.${r}`,h,null,x)||(this.modelManager.addModel(r,h,this.getActualScope()),this.fire(new t.z("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.getActualScope())}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.getActualScope(),!1,!0),this.fire(new t.z("data",{dataType:"style"})),this):this.fire(new t.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(r,h,x={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(ll,`sources.${r}`,h,null,x))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=Ta(r,h,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id})));const M=k=>{const B=(k?"symbol:":"other:")+E.id,G=t.B(B,this.scope),J=this._sourceCaches[B]=new Ko(G,E,k);(k?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=J,J.onAdd(this.map)};M(!1),h.type!=="vector"&&h.type!=="geojson"||M(!0),E.onAdd&&E.onAdd(this.map),x.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const h=this.getOwnSource(r);if(!h)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===r)return this.fire(new t.y(new Error(`Source "${r}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new t.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const E=Object.entries(this.stylesheet.iconsets).find((([M,k])=>k.type==="source"&&k.source===r));if(E)return this.fire(new t.y(new Error(`Source "${r}" cannot be removed while iconset "${E[0]}" is using it.`)))}const x=this.getOwnSourceCaches(r);for(const E of x){const M=t.dq(E.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(E.id),E.fire(new t.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,h){this._checkLoaded(),this.getOwnSource(r).setData(h),this._changes.setDirty()}getOwnSource(r){const h=this.getOwnSourceCache(r);return h&&h.getSource()}getOwnSources(){const r=[];for(const h in this._otherSourceCaches){const x=this.getOwnSourceCache(h);x&&r.push(x.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const h in r){const x=r[h]._tiles;for(const E in x){const M=x[E];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const M of r){if(this._validate(Ao,"lights",M))return;switch(M.type){case"ambient":if(this.ambientLight){const k=this.ambientLight;k.set(M),k.updateTransitions(h)}else this.ambientLight=new Wr(M,No||(No=new t.a9({color:new t.aa(t.a6.properties_light_ambient.color),"color-use-theme":new t.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.aa(t.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const k=this.directionalLight;k.set(M),k.updateTransitions(h)}else this.directionalLight=new Wr(M,oo||(oo=new t.a9({direction:new t.ap(t.a6.properties_light_directional.direction),color:new t.aa(t.a6.properties_light_directional.color),"color-use-theme":new t.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.aa(t.a6.properties_light_directional.intensity),"cast-shadows":new t.aa(t.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new t.aa(t.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new t.aa(t.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const x=Object.assign(h,{worldview:this.map.getWorldview()}),E=new t.ac(this.z||0,x);this.ambientLight&&this.ambientLight.recalculate(E),this.directionalLight&&this.directionalLight.recalculate(E),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,h=this.ambientLight;if(!r||!h)return;const x=le=>.2126*(le[0]<=.03928?le[0]/12.92:Math.pow((le[0]+.055)/1.055,2.4))+.7152*(le[1]<=.03928?le[1]/12.92:Math.pow((le[1]+.055)/1.055,2.4))+.0722*(le[2]<=.03928?le[2]/12.92:Math.pow((le[2]+.055)/1.055,2.4)),E=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=r.properties.get("intensity"),k=r.properties.get("direction"),B=1-t.d4(k.x,k.y,k.z)[2]/90,G=x(E)*M*B,J=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),ee=h.properties.get("intensity"),ce=x(J)*ee;return Number(((G+ce)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(t.dr(r)){const h=t.ds(r),x=this.fragments.find((({id:M})=>M===h));if(!x)return;const E=t.dq(r);return x.style.getFragmentStyle(E)}{const h=this.fragments.find((({id:x})=>x===r));return h?h.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const h={},x=(E,M="")=>`${E}::${M}`;this._featuresetSelectors={};for(const E in r){const M=this._featuresetSelectors[E]=[];for(const k of r[E].selectors){if(k.featureNamespace){const G=this.getOwnLayer(k.layer);if(!G){t.w(`Layer is undefined for selector: ${k.layer}`);continue}const J=x(G.source,G.sourceLayer);if(J in h&&h[J]!==k.featureNamespace){t.w(`"featureNamespace ${k.featureNamespace} of featureset ${E}'s selector is not associated to the same source, skip this selector`);continue}h[J]=k.featureNamespace}let B;if(k.properties)for(const G in k.properties){const J=t.U(k.properties[G]);J.result==="success"&&(B=B||{},B[G]=J.value)}M.push({layerId:k.layer,namespace:k.featureNamespace,properties:B,uniqueFeatureID:k._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const h=this.getFragmentStyle(r);if(!h||!h.stylesheet.featuresets)return[];const x=[];for(const E in h.stylesheet.featuresets)x.push({featuresetId:E,importId:h.scope?h.scope:void 0});return x}getFeaturesetLayers(r,h){const x=this.getFragmentStyle(h),E=x.stylesheet.featuresets;if(!E||!E[r])return this.fire(new t.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const k of E[r].selectors){const B=x.getOwnLayer(k.layer);B&&M.push(B)}return M}getConfigProperty(r,h){const x=this.getFragmentStyle(r);if(!x)return null;const E=t.B(h,x.scope),M=x.options.get(E),k=M?M.value||M.default:null;return k?k.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(r,h){const x=t.B(r,h);return this._mergedIndoor[x]}setIndoorData(r,h){this.map.indoor.setIndoorData(h)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(r,h,x){const E=this.getFragmentStyle(r);if(!E)return;const M=E.stylesheet.schema;if(!M||!M[h])return;const k=t.U(x);if(k.result!=="success")return void ku(this,k.value);const B=k.value.expression,G=t.B(h,E.scope),J=E.options.get(G);if(!J)return;let ee;const{minValue:ce,maxValue:le,stepValue:he,type:be,values:_e}=M[h],ke=t.U(M[h].default);ke.result==="success"&&(ee=ke.value.expression),ee?(this.options.set(G,Object.assign({},J,{value:B,default:ee,minValue:ce,maxValue:le,stepValue:he,type:be,values:_e})),this.updateConfigDependencies(h)):this.fire(new t.y(new Error(`No schema defined for the config option "${h}" in the "${r}" fragment.`)))}getConfig(r){const h=this.getFragmentStyle(r);if(!h)return null;const x=h.stylesheet.schema;if(!x)return null;const E={};for(const M in x){const k=t.B(M,h.scope),B=h.options.get(k),G=B?B.value||B.default:null;E[M]=G?G.serialize():null}return E}setConfig(r,h){const x=this.getFragmentStyle(r);x&&(x.updateConfig(h,x.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const h=this.getFragmentStyle(r);return h?h.stylesheet.schema:null}setSchema(r,h){const x=this.getFragmentStyle(r);x&&(x.stylesheet.schema=h,x.updateConfig(x._config,h),this.updateConfigDependencies())}updateConfig(r,h){if(this._config=r,r||h)if(h)for(const x in h){let E,M;const k=t.U(h[x].default);if(k.result==="success"&&(E=k.value.expression),r&&r[x]!==void 0){const le=t.U(r[x]);le.result==="success"&&(M=le.value.expression)}const{minValue:B,maxValue:G,stepValue:J,type:ee,values:ce}=h[x];if(E){const le=t.B(x,this.scope);this.options.set(le,{default:E,value:M,minValue:B,maxValue:G,stepValue:J,type:ee,values:ce})}else this.fire(new t.y(new Error(`No schema defined for config option "${x}".`)))}else this.fire(new t.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(r,h=(()=>!0)){for(const x of r){const E=this.getLayer(x);E&&h(E)&&(E.possiblyEvaluateVisibility(),this._updateLayer(E),this._changes.setDirty())}}updateConfigDependencies(r){this._updateLayers(this._configDependentLayers,(h=>!r||h.expressionDependencies.configDependencies.has(r))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((h=>{const x=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(x){const E=h._evaluateColorThemeData(x);(!h._styleColorTheme.lut&&E!==""||h._styleColorTheme.lut&&E!==h._styleColorTheme.lut.data)&&h.setColorTheme(x)}})),this._changes.setDirty()}addLayer(r,h,x={}){this._checkLoaded();const E=r.id;if(this._layers[E])return void this.fire(new t.y(new Error(`Layer with id "${E}" already exists on this map`)));let M;if(r.type==="custom"){if(ku(this,t.dt(r)))return;M=t.du(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(E,r.source),r=t.dp(r),r=Object.assign(r,{source:E})),this._validate(Mn,`layers.${E}`,r,{arrayIndex:-1},x))return;M=t.du(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:E}})}const k=t.B(M.source,M.scope);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k);let B=this._order.length;if(h){const ce=this._order.indexOf(h);if(ce===-1)return void this.fire(new t.y(new Error(`Layer with id "${h}" does not exist on this map.`)));M.slot===this._layers[h].slot?B=ce:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(B,0,E),this._layerOrderChanged=!0,this._layers[E]=M;const G=this.getOwnLayerSourceCache(M),J=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&M.canCastShadows()&&J&&(G.castsShadows=!0);const ee=this._changes.getRemovedLayer(M);if(ee&&M.source&&G&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const ce=t.B(M.source,M.scope);ee.type!==M.type?this._changes.updateSourceCache(ce,"clear"):(this._changes.updateSourceCache(ce,"reload"),G.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(r,h){this._checkLoaded();const x=this._checkLayer(r);if(!x||r===h)return;const E=this._order.indexOf(r);this._order.splice(E,1);let M=this._order.length;if(h){const k=this._order.indexOf(h);if(k===-1)return void this.fire(new t.y(new Error(`Layer with id "${h}" does not exist on this map.`)));x.slot===this._layers[h].slot?M=k:t.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const h=this._checkLayer(r);if(!h)return;h.setEventedParent(null);const x=this._order.indexOf(r);this._order.splice(x,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._indoorDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const E=this.getOwnLayerSourceCache(h);if(E&&E.castsShadows){let M=!1;for(const k in this._layers)if(this._layers[k].source===h.source&&this._layers[k].canCastShadows()){M=!0;break}E.castsShadows=M}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const h in this._layers)if(this._layers[h].type===r)return!0;return!1}setLayerZoomRange(r,h,x){this._checkLoaded();const E=this._checkLayer(r);E&&(E.minzoom===h&&E.maxzoom===x||(h!=null&&(E.minzoom=h),x!=null&&(E.maxzoom=x),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,h){this._checkLoaded();const x=this._checkLayer(r);x&&x.slot!==h&&(x.slot=h,this._updateLayer(x))}setFilter(r,h,x={}){this._checkLoaded();const E=this._checkLayer(r);if(E&&!t.by(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(Qa,`layers.${E.id}.filter`,h,{layerType:E.type},x)||(E.filter=t.dp(h),this._updateLayer(E)))}getFilter(r){const h=this._checkLayer(r);if(h)return t.dp(h.filter)}setLayoutProperty(r,h,x,E={}){this._checkLoaded();const M=this._checkLayer(r);if(M&&!t.by(M.getLayoutProperty(h),x)){if(x!=null&&(!E||E.validate!==!1)&&ku(M,Nt.call(Hs,{key:`layers.${r}.layout.${h}`,layerType:M.type,objectKey:h,value:x,styleSpec:t.a6,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(h,x),M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._updateLayer(M)}}setLayerProperty(r,h,x,E={}){this._checkLoaded();const M=this._checkLayer(r);M&&(h==="appearances"?(M.setAppearances(x),this._changes.setDirty()):M.isPaintProperty(h)?this.setPaintProperty(r,h,x,E):this.setLayoutProperty(r,h,x,E))}getLayoutProperty(r,h){const x=this._checkLayer(r);if(x)return x.getLayoutProperty(h)}setPaintProperty(r,h,x,E={}){this._checkLoaded();const M=this._checkLayer(r);if(!M||t.by(M.getPaintProperty(h),x)||x!=null&&(!E||E.validate!==!1)&&ku(M,gl.call(Hs,{key:`layers.${r}.paint.${h}`,layerType:M.type,objectKey:h,value:x,styleSpec:t.a6})))return;const k=M.setPaintProperty(h,x);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),k&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(r,h){const x=this._checkLayer(r);if(x)return x.getPaintProperty(h)}setFeatureState(r,h){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:G,importId:J}=r.target,ee=this.getFragmentStyle(J),ce=ee.getFeaturesetLayers(G);for(const{source:le,sourceLayer:he}of ce)ee.setFeatureState({id:r.id,source:le,sourceLayer:he},h)}else if("layerId"in r.target){const{layerId:G}=r.target,J=this.getLayer(G);this.setFeatureState({id:r.id,source:J.source,sourceLayer:J.sourceLayer},h)}return}const x=r.source,E=r.sourceLayer,M=this._checkSource(x);if(!M)return;const k=M.type;if(k==="geojson"&&E)return void this.fire(new t.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(k==="vector"&&!E)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided.")));const B=this.getOwnSourceCaches(x);for(const G of B)G.setFeatureState(E,r.id,h)}removeFeatureState(r,h){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:G,importId:J}=r.target,ee=this.getFragmentStyle(J),ce=ee.getFeaturesetLayers(G);for(const{source:le,sourceLayer:he}of ce)ee.removeFeatureState({id:r.id,source:le,sourceLayer:he},h)}else if("layerId"in r.target){const{layerId:G}=r.target,J=this.getLayer(G);this.removeFeatureState({id:r.id,source:J.source,sourceLayer:J.sourceLayer},h)}return}const x=r.source,E=this._checkSource(x);if(!E)return;const M=E.type,k=M==="vector"?r.sourceLayer:void 0;if(M==="vector"&&!k)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new t.y(new Error("A feature id is required to remove its specific state property.")));const B=this.getOwnSourceCaches(x);for(const G of B)G.removeFeatureState(k,r.id,h)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let M;if("featuresetId"in r.target){const{featuresetId:k,importId:B}=r.target,G=this.getFragmentStyle(B),J=G.getFeaturesetLayers(k);for(const{source:ee,sourceLayer:ce}of J){const le=G.getFeatureState({id:r.id,source:ee,sourceLayer:ce});if(le&&!M)M=le;else if(!t.by(M,le))return void this.fire(new t.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:k}=r.target,B=this.getLayer(k);M=this.getFeatureState({id:r.id,source:B.source,sourceLayer:B.sourceLayer})}return M}const h=r.source,x=r.sourceLayer,E=this._checkSource(h);if(E){if(E.type!=="vector"||x)return r.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(x,r.id);this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),h=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return t.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(x=>x!==void 0))}_updateFilteredLayers(r){for(const h of Object.values(this._mergedLayers))r(h)&&this._updateLayer(h)}_updateLayer(r){this._changes.updateLayer(r);const h=this.getLayerSourceCache(r),x=t.B(r.source,r.scope),E=this._changes.getUpdatedSourceCaches();r.source&&!E[x]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(x,"reload"),h.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const h=B=>this._mergedLayers[B].is3D(!!this.terrain),x=this.order,E={},M=[];for(let B=x.length-1;B>=0;B--){const G=x[B];if(h(G)){E[G]=B;for(const J of r){const ee=J[G];if(ee)for(const ce of ee)M.push(ce)}}}M.sort(((B,G)=>G.intersectionZ-B.intersectionZ));const k=[];for(let B=x.length-1;B>=0;B--){const G=x[B];if(h(G))for(let J=M.length-1;J>=0;J--){const ee=M[J].feature;if(ee.layer&&E[ee.layer.id]<B)break;k.push(ee),M.pop()}else for(const J of r){const ee=J[G];if(ee)for(const ce of ee)k.push(ce.feature)}}return k}queryRasterValue(r,h,x){const E=this.getOwnSource(r);return E?E.type!=="raster-array"?(this.fire(new t.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):E.queryRasterArrayValue(h,x):(this.fire(new t.y(new Error(`Source with id "${r}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(r,h,x){let E;h&&!Array.isArray(h)&&h.filter&&(this._validate(Qa,"queryRenderedFeatures.filter",h.filter,null,h),E=t.b6(h.filter));const M={},k=ee=>{if(bd.has(ee.type))return;const ce=this.getOwnLayerSourceCache(ee),le=M[ce.id]=M[ce.id]||{sourceCache:ce,layers:{},has3DLayers:!1};ee.is3D(!!this.terrain)&&(le.has3DLayers=!0),le.layers[ee.fqid]=le.layers[ee.fqid]||{styleLayer:ee,targets:[]},le.layers[ee.fqid].targets.push({filter:E})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new t.y(new Error("parameters.layers must be an Array."))),[];for(const ee of h.layers){const ce=this._layers[ee];if(!ce)return this.fire(new t.y(new Error(`The layer '${ee}' does not exist in the map's style and cannot be queried for features.`))),[];k(ce)}}else for(const ee in this._layers)k(this._layers[ee]);const B=this._queryRenderedFeatures(r,M,x),G=this._flattenAndSortRenderedFeatures(B),J=[];for(const ee of G)t.dw(ee.layer.id)===this.scope&&J.push(ee);return J}queryRenderedFeatureset(r,h,x){let E;h&&!Array.isArray(h)&&h.filter&&(this._validate(Qa,"queryRenderedFeatures.filter",h.filter,null,h),E=t.b6(h.filter));const M="mock",k=[];if(h&&h.target)k.push(Object.assign({},h,{targetId:M,filter:E}));else{const ee=this.getFeaturesetDescriptors();for(const ce of ee)k.push({targetId:M,filter:E,target:ce});for(const{style:ce}of this.fragments){const le=ce.getFeaturesetDescriptors();for(const he of le)k.push({targetId:M,filter:E,target:he})}}const B=this.queryRenderedTargets(r,k,x),G=[],J=new Set;for(const ee of B)for(const ce of ee.variants[M])Xu(ce,ee,J)||G.push(new t.dx(ee,ce));return G}queryRenderedTargets(r,h,x){const E={},M=(B,G,J,ee)=>{const ce=E[G.id]=E[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};if(ce.layers[B.fqid]=ce.layers[B.fqid]||{styleLayer:B,targets:[]},B.is3D(!!this.terrain)&&(ce.has3DLayers=!0),!ee)return J.uniqueFeatureID=!1,void ce.layers[B.fqid].targets.push(J);ce.layers[B.fqid].targets.push(Object.assign({},J,{namespace:ee.namespace,properties:ee.properties,uniqueFeatureID:ee.uniqueFeatureID}))};for(const B of h)if("featuresetId"in B.target){const{featuresetId:G,importId:J}=B.target,ee=this.getFragmentStyle(J);if(!ee||!ee._featuresetSelectors)continue;const ce=ee._featuresetSelectors[G];if(!ce){this.fire(new t.y(new Error(`The featureset '${G}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const le of ce){const he=ee.getOwnLayer(le.layerId);he&&!bd.has(he.type)&&M(he,ee.getOwnLayerSourceCache(he),B,le)}}else if("layerId"in B.target){const{layerId:G}=B.target,J=this.getLayer(G);if(!J||bd.has(J.type))continue;M(J,this.getLayerSourceCache(J),B)}const k=this._queryRenderedFeatures(r,E,x);return this._flattenAndSortRenderedFeatures(k)}_queryRenderedFeatures(r,h,x){const E=[],M=!!this.map._showQueryGeometry,k=ao.createFromScreenPoints(r,x);for(const B in h){const G=Xd(k,h[B],this._availableImages,x,M);Object.keys(G).length&&E.push(G)}if(this.placement)for(const B in h){if(!h[B].sourceCache._onlySymbols)continue;const G=Op(k.screenGeometry,h[B],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(G).length&&E.push(G)}return E}querySourceFeatures(r,h){const x=h&&h.filter;x&&this._validate(Qa,"querySourceFeatures.filter",x,null,h);let E=[];const M=this.getOwnSourceCaches(r);for(const k of M)E=E.concat(Dh(k,h));return E}addSourceType(r,h,x){return Gc.getSourceType(r)?x(new Error(`A source type called "${r}" already exists.`)):(Gc.setSourceType(r,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:h.workerSourceURL},x):x(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,h,x={}){this._checkLoaded();const E=this.light.getLight();let M=!1;for(const B in r)if(!t.by(r[B],E[B])){M=!0;break}if(!M)return;const k=this._getTransitionParameters();this.light.setLight(r,h,x),this.light.updateTransitions(k)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,h=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let x=r;const E=!("source"in r)||r.source==null;if(h===1){if(this.disableElevatedTerrain)return;if("source"in x&&typeof x.source=="object"){const B="terrain-dem-src";this.addSource(B,x.source),x=t.dp(x),x=Object.assign(x,{source:B})}const M=Object.assign({},x),k={};if(this.terrain&&E){M.source=this.terrain.get().source;const B=this.terrain?this.getFragmentStyle(this.terrain.scope):null;B&&(k.style=B.serialize())}if(this._validate(Bo,"terrain",M,k))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&h!==this.terrain.drapeRenderMode){if(!x)return;this._createTerrain(x,h),this.fire(new t.z("data",{dataType:"style"}))}else{const M=this.terrain,k=M.get();for(const B of Object.keys(t.a6.terrain))!x.hasOwnProperty(B)&&t.a6.terrain[B].default&&(x[B]=t.a6.terrain[B].default);for(const B in r)if(!t.by(r[B],k[B])){M.set(r,this.options),this.stylesheet.terrain=r;const G=this._getTransitionParameters({duration:0});M.updateTransitions(G),this.fire(new t.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const h=this.fog=new jn(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}_createSnow(r){const h=this.snow=new po(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}_createRain(r){const h=this.rain=new go(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const r of this.map._markers)r._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!t.by(h.get(),r)){h.set(r,this.options),this.stylesheet.fog=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!t.by(h.get(),r)){h.set(r,this.options),this.stylesheet.snow=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!t.by(h.get(),r)){h.set(r,this.options),this.stylesheet.rain=h.get();const x=this._getTransitionParameters({duration:0});h.updateTransitions(x)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void r();const x=this._evaluateColorThemeData(h);this._loadColorTheme(x).then((()=>{this.fire(new t.z("colorthemeset")),r()})).catch((E=>{t.w(`Couldn't set color theme: ${E}`)}))}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&t.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,h){const x=this.getFragmentStyle(r);x&&(x._styleColorTheme.colorThemeOverride=h,x._reloadColorTheme())}_getTransitionParameters(r){return{now:t.o.now(),transition:Object.assign(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],h=[];for(const x of this._mergedOrder)this.isLayerDraped(this._mergedLayers[x])?r.push(x):h.push(x);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...h)}_createTerrain(r,h){const x=this.terrain=new _t(r,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});x.updateTransitions(E)}_force3DLayerUpdate(){for(const r in this._layers){const h=this._layers[r];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const h=this._layers[r];h.type==="symbol"&&this._updateLayer(h)}}_validate(r,h,x,E,M={}){if(M&&M.validate===!1)return!1;const k=Object.assign({},this.serialize());return ku(this,r.call(Hs,Object.assign({key:h,style:k,value:x,styleSpec:t.a6},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const h=this.getSourceCaches(r);for(const x of h)x.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const h=this._mergedLayers[r];h._clear&&h._clear()}}reloadSource(r){const h=this.getSourceCaches(r);for(const x of h)x.resume(),x.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((r=>{r.modelManager.reloadModels(r.scope)}))}updateSources(r){let h;this.directionalLight&&(h=Fp(this.directionalLight));const x=new Set,E=new Set;for(const M in this._mergedLayers){const k=this._mergedLayers[M];k.type==="building"&&x.add(k.source),k.hasElevation()&&!E.has(k.source)&&E.add(k.source)}for(const M in this._mergedSourceCaches){const k=this._mergedSourceCaches[M],B=E.has(k._source.id);x.has(k._source.id)&&(k._source.reparseOverscaled=!1),k.update(r,void 0,void 0,h,B)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const h=this._sourceCaches[r];h.resume(),h.reload()}}_updatePlacement(r,h,x,E,M,k,B=!1){let G=!1,J=!1;const ee={},ce={};for(const _e of this._mergedOrder){const ke=this._mergedLayers[_e];if(ke.type!=="symbol")continue;const Ae=t.B(ke.source,ke.scope);let Oe=ee[Ae];if(!Oe){const Be=this.getLayerSourceCache(ke);if(!Be)continue;const dt=Be.getRenderableIds(!0).map((nt=>Be.getTileByID(nt)));ce[Ae]=dt.slice(),Oe=ee[Ae]=dt.sort(((nt,at)=>at.tileID.overscaledZ-nt.tileID.overscaledZ||(nt.tileID.isLessThan(at.tileID)?-1:1)))}const He=this.crossTileSymbolIndex.addLayer(ke,Oe,h.center.lng,h.projection);G=G||He}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),B=B||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new t.z("neworder"));const le=!!(this.placement&&!h.equals(this.placement.transform)),he=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!k||this.placement.lastReplacementSourceUpdateTime!==k.updateTime)),be=(le||he||G||this.placement&&this.placement.isStale())&&E===0;if((B||!this.pauseablePlacement||be||E!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.o.now(),h.zoom))&&(this.pauseablePlacement=new Oa(h,this._mergedOrder,B||E===0,x,E,M,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,ee,ce,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.o.now()),J=!0),G&&this.pauseablePlacement.placement.setStale()),J||G){this._buildingIndex.onNewFrame(h.zoom);for(let _e=0;_e<this._mergedOrder.length;_e++){const ke=this._mergedLayers[this._mergedOrder[_e]];if(ke.type!=="symbol"||ke.visibility==="none")continue;const Ae=this.isLayerClipped(ke);this.placement.updateLayerOpacities(ke,ee[t.B(ke.source,ke.scope)],_e,Ae?k:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.o.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,h){this._checkLoaded();const x=this.stylesheet.imports=this.stylesheet.imports||[];if(x.findIndex((({id:M})=>M===r.id))!==-1)return void this.fire(new t.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!h)return x.push(r),this._loadImports([r],!0);const E=x.findIndex((({id:M})=>M===h));return E===-1&&this.fire(new t.y(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=x.slice(0,E).concat(r).concat(x.slice(E)),this._loadImports([r],!0,h)}updateImport(r,h){this._checkLoaded();const x=this.stylesheet.imports||[],E=this.getImportIndex(r);return E===-1?this:typeof h=="string"?(this.setImportUrl(r,h),this):(h.url&&h.url!==x[E].url&&this.setImportUrl(r,h.url),t.by(h.config,x[E].config)||this.setImportConfig(r,h.config,h.data.schema),t.by(h.data,x[E].data)||this.setImportData(r,h.data),this)}moveImport(r,h){this._checkLoaded();let x=this.stylesheet.imports||[];const E=this.getImportIndex(r);if(E===-1)return this;const M=this.getImportIndex(h);if(M===-1)return this;const k=x[E],B=this.fragments[E];return x=x.filter((({id:G})=>G!==r)),this.fragments=this.fragments.filter((({id:G})=>G!==r)),this.stylesheet.imports=x.slice(0,M).concat(k).concat(x.slice(M)),this.fragments=this.fragments.slice(0,M).concat(B).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(r,h){this._checkLoaded();const x=this.stylesheet.imports||[],E=this.getImportIndex(r);if(E===-1)return this;x[E].url=h;const M=this.fragments[E];return M.style=this._createFragmentStyle(x[E]),M.style.on("style.import.load",(()=>this.mergeAll())),M.style.loadURL(h),this}setImportData(r,h){this._checkLoaded();const x=this.getImportIndex(r),E=this.stylesheet.imports||[];return x===-1?this:h?(this.fragments[x].style.setState(h),this._reloadImports(),this):(delete E[x].data,this.setImportUrl(r,E[x].url))}setImportConfig(r,h,x){this._checkLoaded();const E=this.getImportIndex(r),M=this.stylesheet.imports||[];if(E===-1)return this;h?M[E].config=h:delete M[E].config;const k=this.fragments[E];x&&k.style.stylesheet&&(k.style.stylesheet.schema=x);const B=k.style.stylesheet&&k.style.stylesheet.schema;return k.config=h,k.style.updateConfig(h,B),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const h=this.stylesheet.imports||[],x=this.getImportIndex(r);x!==-1&&(h.splice(x,1),this.fragments[x].style._remove(),this.fragments.splice(x,1),this._reloadImports())}getImportIndex(r){const h=(this.stylesheet.imports||[]).findIndex((x=>x.id===r));return h===-1&&this.fire(new t.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),h}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const h in this._mergedOtherSourceCaches){const x=this._mergedOtherSourceCaches[h];x&&r.push(x.getSource())}return r}getSource(r,h){const x=this.getSourceCache(r,h);return x&&x.getSource()}getLayerSource(r){const h=this.getLayerSourceCache(r);return h&&h.getSource()}getSourceCache(r,h){const x=t.B(r,h);return this._mergedOtherSourceCaches[x]}getLayerSourceCache(r){const h=t.B(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[r]&&h.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&h.push(this._mergedSymbolSourceCaches[r]),h}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const h in r){const x=r[h];x==="reload"?this.reloadSource(h):x==="clear"&&this.clearSource(h)}}updateLayers(r){const h=this._changes.getUpdatedPaintProperties();for(const x of h){const E=this.getLayer(x);E&&E.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,h,x){this.imageManager.getImages(h.images,h.scope,x),this._updateTilesForChangedImages();const E=k=>{if(k){const B=h.images.map((G=>t.I.toString(G)));k.setDependencies(h.tileID.key,h.type,B)}},M=t.B(h.source,h.scope);E(this._mergedOtherSourceCaches[M]),E(this._mergedSymbolSourceCaches[M]),h.images.some((k=>k.iconsetId))&&this.fire(new t.z("data",{dataType:"style"}))}rasterizeImages(r,h,x){this.imageManager.rasterizeImages(h,x)}getGlyphs(r,h,x){this.glyphManager.getGlyphs(h.stacks,x)}getResource(r,h,x){return t.dz(h,x)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const h=[];return this._otherSourceCaches[r]&&h.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&h.push(this._symbolSourceCaches[r]),h}_isSourceCacheLoaded(r){const h=this.getOwnSourceCaches(r);return h.length===0?(this.fire(new t.y(new Error(`There is no source with ID '${r}'`))),!1):h.every((x=>x.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,h){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const x=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),E=r.type==="building";if(r.is3D(!!this.terrain)){if(x||E||h&&h.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((r=>{r.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Gc.getSourceType=function(v){return su[v]},Gc.setSourceType=function(v,r){su[v]=r},Gc.registerForPluginStateChange=t.dA;class Bg extends t.E{constructor(r){super(),this._style=r,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},t.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(r){r===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=r,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(r){this._activeFloorsVisible=r,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(r){for(const[h,x]of Object.entries(r.buildings))if(this._buildings[h])for(const E of x.floorIds)this._buildings[h].floors[E]||(this._buildings[h].floors[E]=x.floors[E]);else this._buildings[h]=x;for(const h of r.activeFloors)this._activeFloors.add(h);this._updateIndoorSelector()}getIndoorTileOptions(r,h){const x=this._style.getIndoorSourceLayers(r,h);return x&&this._indoorState?{sourceLayers:x,indoorState:this._indoorState}:null}_updateUI(r,h,x){const E=(function(M,k,B,G){let J=null,ee=Number.MAX_SAFE_INTEGER;if(G<16)return null;for(const[ce,le]of Object.entries(M)){const he=le.center;if(he){const be=k.distanceTo(t.aT.convert(he));be<ee&&B.contains(he)&&(ee=be,J=ce)}}return J})(this._buildings,h,x,r);E!==this._closestBuildingId&&(this._closestBuildingId=E,this._updateIndoorSelector())}_updateIndoorSelector(){const r=this._buildings,h=this._closestBuildingId,x=h&&r?r[h]:void 0;if(!x)return void this.fire(new t.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let E=null;for(const k of x.floorIds)if(this._activeFloors&&this._activeFloors.has(k)){E=k;break}const M=Array.from(x.floorIds).map((k=>({id:k,name:x.floors[k].name,zIndex:x.floors[k].zIndex}))).sort(((k,B)=>B.zIndex-k.zIndex));this.fire(new t.z("selector-update",{selectedFloorId:E,activeFloorsVisible:this._activeFloorsVisible,floors:M}))}_updateActiveFloors(){const r=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:r,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var wd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,hu=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Zf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,lf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,cf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ji=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Td=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Bh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Np=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Vp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const As=/#include\s+"([^"]+)"/g,qc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Ng=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Sd=new Set(["ifdef","ifndef","elif","if","defined"]),Du=new Set;Lu(wd,Du),Lu(Zf,Du),Lu(hu,Du);const Ed={"_prelude_fog.vertex.glsl":cf,"_prelude_terrain.vertex.glsl":Bl,"_prelude_shadow.vertex.glsl":Np,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ji,"_prelude_shadow.fragment.glsl":Vp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Td,"_prelude_raster_particle.glsl":Bh},Nm={};es("",Bl),es(Ji,cf),es(Vp,Np),es(Td,""),es(Bh,"");const Vg=es(hu,Zf),Vm=wd,jg=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Vm,Vg.fragmentSource].join(`
`),uf=["precision highp float;",Vm,Vg.vertexSource].join(`
`);var hf={background:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:es(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:es(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:es("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:es(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:es(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:es("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:es("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:es("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:es(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:es(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:es(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:es(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:es(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:es(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:es("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:es("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:es(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:es(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:es("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:es(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lf),skyboxGradient:es(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lf),skyboxCapture:es(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:es(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:es(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:es(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:es(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:es("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:es("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:es("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:es("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Lu(v,r){const h=v.split(`
`);for(let x of h){if(x=x.trimStart(),x[0]!=="#"||!x.includes("if")||x.startsWith("#endif"))continue;const E=x.match(Ng);if(E)for(const M of E)Sd.has(M)||r.add(M)}}function es(v,r){const h=new Set,x=[],E=[];v=v.replace(As,((k,B)=>(E.push(B),""))),r=r.replace(As,((k,B)=>(x.push(B),"")));let M=new Set(Du);Lu(v,M),Lu(r,M);for(const k of[...x,...E])Nm[k]||(Nm[k]=new Set,Lu(Ed[k],Nm[k])),M=new Set([...M,...Nm[k]]);return{fragmentSource:v=v.replace(qc,((k,B,G,J,ee)=>(h.add(ee),B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
in ${G} ${J} ${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${ee}
    ${G} ${J} ${ee} = u_${ee};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${G} ${J} ${ee};
#endif
`:B==="initialize-attribute"?"":void 0))),vertexSource:r=r.replace(qc,((k,B,G,J,ee)=>{const ce=`MATERIAL_ATTRIBUTE_OFFSET_${ee}`,le=J==="float"?"vec2":J,he=`GET_ATTRIBUTE_${le}(a_${ee}, materialInfo, ${ce})`,be=ee.match(/color/)?"color":le;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
in ${G} ${J} a_${ee};
#endif
`:h.has(ee)?B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
    #if !defined(${ce})
        in ${G} ${le} a_${ee};
    #endif
out ${G} ${J} ${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:B==="initialize"?be==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${ee})
    #ifdef ${ce}
        ${ee} = unpack_mix_${be}(${he}, u_${ee}_t);
    #else
        ${ee} = unpack_mix_${be}(a_${ee}, u_${ee}_t);
    #endif
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${G} ${J} a_${ee};
    out ${G} ${J} ${ee};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${ee} = a_${ee};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
    #if !defined(${ce})
        in ${G} ${le} a_${ee};
    #endif
#else
uniform ${G} ${J} u_${ee};
#endif
`:B==="define-instanced"?be==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ee}0;
in vec4 a_${ee}1;
in vec4 a_${ee}2;
in vec4 a_${ee}3;
#else
uniform ${G} ${J} u_${ee};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${G} ${le} a_${ee};
#else
uniform ${G} ${J} u_${ee};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${G} ${J} ${ee} = a_${ee};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    #ifdef ${ce}
        ${G} ${J} ${ee} = ${he};
    #else
        ${G} ${J} ${ee} = a_${ee};
    #endif
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    #ifdef ${ce}
        ${G} ${J} ${ee} = unpack_mix_${be}(${he}, u_${ee}_t);
    #else
        ${G} ${J} ${ee} = unpack_mix_${be}(a_${ee}, u_${ee}_t);
    #endif
#else
    ${G} ${J} ${ee} = u_${ee};
#endif
`})),usedDefines:M,vertexIncludes:x,fragmentIncludes:E}}class Ug{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,h,x,E,M,k,B,G){this.context=r;let J=this.boundPaintVertexBuffers.length!==E.length;for(let ce=0;!J&&ce<E.length;ce++)this.boundPaintVertexBuffers[ce]!==E[ce]&&(J=!0);let ee=this.boundDynamicVertexBuffers.length!==B.length;for(let ce=0;!ee&&ce<B.length;ce++)this.boundDynamicVertexBuffers[ce]!==B[ce]&&(ee=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==x||J||ee||this.boundIndexBuffer!==M||this.boundVertexOffset!==k)this.freshBind(h,x,E,M,k,B,G);else{r.bindVertexArrayOES.set(this.vao);for(const ce of B)ce&&(ce.bind(),G&&ce.instanceCount&&ce.setVertexAttribDivisor(r.gl,h,G));M&&M.dynamicDraw&&M.bind()}}freshBind(r,h,x,E,M,k,B){const G=this.context,J=G.gl;this.vao&&this.destroy(),this.vao=G.gl.createVertexArray(),G.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=E,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=k,h.enableAttributes(J,r),h.bind(),h.setVertexAttribPointers(J,r,M);for(const ee of x)ee.enableAttributes(J,r),ee.bind(),ee.setVertexAttribPointers(J,r,M);for(const ee of k)ee&&(ee.enableAttributes(J,r),ee.bind(),ee.setVertexAttribPointers(J,r,M),B&&ee.instanceCount&&ee.setVertexAttribDivisor(J,r,B));E&&E.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function jm(v,r){const h=Math.pow(2,r.canonical.z),x=r.canonical.y;return[new t.ae(0,x/h).toLngLat().lat,new t.ae(0,(x+1)/h).toLngLat().lat]}function Um(v,r,h,x,E,M,k){const B=v.context,G=B.gl,J=h.hillshadeFBO;if(!J)return;v.prepareDrawTile();const ee=v.isTileAffectedByFog(r),ce=[];v.terrain&&v.terrain.renderingToTexture&&v.emissiveMode==="mrt-fallback"&&ce.push("USE_MRT1");const le=v.getOrCreateProgram("hillshade",{overrideFog:ee,defines:ce});B.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,J.colorAttachment0.get());const he=((Ae,Oe,He,Be)=>{const dt=He.paint.get("hillshade-shadow-color"),nt=He.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",at=He.paint.get("hillshade-highlight-color"),tt=He.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Je=He.paint.get("hillshade-accent-color"),mt=He.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Pt=He.paint.get("hillshade-emissive-strength");let It=t.an(He.paint.get("hillshade-illumination-direction"));if(He.paint.get("hillshade-illumination-anchor")==="viewport")It-=Ae.transform.angle;else if(Ae.style&&Ae.style.enable3dLights()&&Ae.style.directionalLight){const si=Ae.style.directionalLight.properties.get("direction"),_i=t.d4(si.x,si.y,si.z);It=t.an(_i[1])}const ri=!Ae.options.moving;return{u_matrix:Be||Ae.transform.calculateProjMatrix(Oe.tileID.toUnwrapped(),ri),u_image:0,u_latrange:jm(0,Oe.tileID),u_light:[He.paint.get("hillshade-exaggeration"),It],u_shadow:dt.toPremultipliedRenderColor(nt?null:He.lut),u_highlight:at.toPremultipliedRenderColor(tt?null:He.lut),u_emissive_strength:Pt,u_accent:Je.toPremultipliedRenderColor(mt?null:He.lut)}})(v,h,x,v.terrain?r.projMatrix:null);v.uploadCommonUniforms(B,le,r.toUnwrapped());const{tileBoundsBuffer:be,tileBoundsIndexBuffer:_e,tileBoundsSegments:ke}=v.getTileBoundsBuffers(h);le.draw(v,G.TRIANGLES,E,M,k,pr.disabled,he,x.id,be,_e,ke)}function oh(v,r,h){if(!r.needsDEMTextureUpload)return;const x=v.context,E=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||v.getTileTexture(h.stride);const M=h.getPixels();r.demTexture?r.demTexture.update(M,{premultiply:!1}):r.demTexture=new t.T(x,M,E.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function df(v,r,h){const x=v.context,E=x.gl;if(!r.dem)return;const M=r.dem;if(x.activeTexture.set(E.TEXTURE1),oh(v,r,M),!r.demTexture)return;r.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=M.dim;x.activeTexture.set(E.TEXTURE0);let B=r.hillshadeFBO;if(!B){const le=new t.T(x,{width:k,height:k,data:null},E.RGBA8);le.bind(E.LINEAR,E.CLAMP_TO_EDGE),B=r.hillshadeFBO=x.createFramebuffer(k,k,1,"renderbuffer"),B.colorAttachment0.set(le.texture)}x.bindFramebuffer.set(B.framebuffer),x.viewport.set([0,0,k,k]);const{tileBoundsBuffer:G,tileBoundsIndexBuffer:J,tileBoundsSegments:ee}=v.getMercatorTileBoundsBuffers(),ce=[];v.linearFloatFilteringSupported()&&ce.push("TERRAIN_DEM_FLOAT_FORMAT"),v.terrain&&v.terrain.renderingToTexture&&v.emissiveMode==="mrt-fallback"&&ce.push("USE_MRT1"),v.getOrCreateProgram("hillshadePrepare",{defines:ce}).draw(v,E.TRIANGLES,zn.disabled,sr.disabled,yr.unblended,pr.disabled,((le,he)=>{const be=he.stride,_e=t.bC();return t.ce(_e,0,t.al,-t.al,0,0,1),t.br(_e,_e,[0,-t.al,0]),{u_matrix:_e,u_image:1,u_dimension:[be,be],u_zoom:le.overscaledZ}})(r.tileID,M),h.id,G,J,ee),r.needsHillshadePrepare=!1}class no{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class m0 extends no{getDefault(){return t.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Xf extends no{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class $g extends no{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class jp extends no{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ff extends no{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class ah extends no{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class pf extends no{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Yf extends no{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class lh extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class Up extends no{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class $m extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Gg extends no{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ta extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class ch extends no{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Jl extends no{getDefault(){return t.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Kf extends no{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Id extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class Cd extends no{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Nh extends no{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Jf=class extends no{getDefault(){return null}set(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)}};class Ad extends no{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ru extends no{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class qg extends no{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class oy extends no{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ay extends no{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ly extends no{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Gm extends no{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class uh extends no{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class $p extends no{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Gp extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Qf extends no{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class qp extends no{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class ep extends qp{constructor(r,h,x=0){super(r,h),this.attachmentPoint=r.gl.COLOR_ATTACHMENT0+x}setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachmentPoint,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Pd extends qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class tp extends qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class qm extends Pd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const fc=(v,r,h,x)=>({u_matrix:v,u_image0:0,u_image1:1,u_skirt_height:r,u_ground_shadow_factor:h,u_emissive_texture_available:x}),zu=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:h,u_zoom_transition:E,u_merc_center:M,u_image0:0,u_image1:1,u_frustum_tl:k,u_frustum_tr:B,u_frustum_br:G,u_frustum_bl:J,u_globe_pos:ee,u_globe_radius:ce,u_viewport:le,u_grid_matrix:ke?Float32Array.from(ke):new Float32Array(9),u_skirt_height:he,u_far_z_cutoff:be,u_emissive_texture_available:_e});function ip(v,r){return v!=null&&r!=null&&!(!v.hasData()||!r.hasData())&&v.demTexture!=null&&r.demTexture!=null&&v.tileID.key!==r.tileID.key}const ul=new class{constructor(){this.operations={}}newMorphing(v,r,h,x,E){if(v in this.operations){const M=this.operations[v];M.to.tileID.key!==h.tileID.key&&(M.queued=h)}else this.operations[v]={startTime:x,phase:0,duration:E,from:r,to:h,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const r=this.operations[v];return{from:r.from,to:r.to,phase:r.phase}}update(v){for(const r in this.operations){const h=this.operations[r];for(h.phase=(v-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,v)){delete this.operations[r];break}}}_nextOp(v,r){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=r,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Ic={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Hp(v,r,h){if(r===0)return 0;const x=r<1&&h===514?.25/r:1;return 6*Math.pow(1.5,22-v)*Math.max(r,1)*x}function Hc(v,r){const h=1<<v.z;return!r&&(v.x===0||v.x===h-1)||v.y===0||v.y===h-1}function np(v,r){if(!v.style||!v.style.enable3dLights())return;const h=v.context,x=h.gl;h.activeTexture.set(x.TEXTURE1),r?r.bind(x.LINEAR,x.CLAMP_TO_EDGE):v.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}const Vh=v=>({u_matrix:v});function jh(v,r,h,x,E){if(E>0){const M=t.o.now(),k=(M-v.timeAdded)/E,B=r?(M-r.timeAdded)/E:-1,G=h.getSource(),J=x.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),ee=!r||Math.abs(r.tileID.overscaledZ-J)>Math.abs(v.tileID.overscaledZ-J),ce=ee&&v.refreshedUponExpiration?1:t.aA(ee?k:1-B,0,1);return r?{opacity:1,mix:1-ce,isFading:k<1}:{opacity:ce,mix:0,isFading:k<1}}return{opacity:1,mix:0,isFading:!1}}class nl extends Ko{constructor(r){const h=Ta("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",h,!1),h.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,h){r.state="loaded",h(null)}}class mf extends Ko{constructor(r){const h=Ta("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,h,x){if(r.freezeTileCoverage)return;this.transform=r;const E=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((M,k)=>{if(M[k.key]="",!this._tiles[k.key]){const B=new Vo(k,this._source.tileSize*k.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);B.state="loaded",this._tiles[k.key]=B}return M}),{});for(const M in this._tiles)M in E||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(r){const h=this.proxyCachedFBO[r];if(h!==void 0){const x=Object.values(h);this.renderCachePool.push(...x),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach((r=>r.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Hm extends t.aQ{constructor(r,h,x){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=h,this.projMatrix=x}}class Hg extends t.bV{constructor(r,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,E,M]=(function(G){const J=new t.bd,ee=new t.b0,ce=131;J.reserve(17161),ee.reserve(33800);const le=t.al/128,he=t.al+le/2,be=he+le;for(let ke=-le;ke<be;ke+=le)for(let Ae=-le;Ae<be;Ae+=le){const Oe=Ae<0||Ae>he||ke<0||ke>he?24575:0,He=t.aA(Math.round(Ae),0,t.al),Be=t.aA(Math.round(ke),0,t.al);J.emplaceBack(He+Oe,Be)}const _e=(ke,Ae)=>{const Oe=Ae*ce+ke;ee.emplaceBack(Oe+1,Oe,Oe+ce),ee.emplaceBack(Oe+ce,Oe+ce+1,Oe+1)};for(let ke=1;ke<129;ke++)for(let Ae=1;Ae<129;Ae++)_e(Ae,ke);return[0,129].forEach((ke=>{for(let Ae=0;Ae<130;Ae++)_e(Ae,ke),_e(ke,Ae)})),[J,ee,32768]})(),k=r.context;this.gridBuffer=k.createVertexBuffer(x,t.bf.members),this.gridIndexBuffer=k.createIndexBuffer(E),this.gridSegments=t.bg.simpleSegment(0,0,x.length,E.length),this.gridNoSkirtSegments=t.bg.simpleSegment(0,0,x.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mf(h.map),this.orthoMatrix=t.bC(),t.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.al,0,t.al,0,1);const B=k.gl;this._overlapStencilMode=new sr({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new nl(h.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(r,h,x){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const E=r.terrain.properties,M=r.terrain.drapeRenderMode===0,k=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.o.now();const B=r.terrain&&r.terrain.scope,G=E.get("source"),J=M?this._mockSourceCache:r.getSourceCache(G,B);if(!J)return void t.w(`Couldn't find terrain source "${G}".`);if(this.sourceCache=J,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=k?this.calculateExaggeration(h):E.get("exaggeration"),!h.projection.requiresDraping&&k&&this._exaggeration===0)return void this._disable();this.enabled=!0;const ee=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const ce=this.getScaledDemTileSize();this.sourceCache.update(h,ce,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ee(),this._initializing=!0),ee(),h.updateElevation(!0,x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const h=this._previousCameraAltitude,x=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=x;const E=h!=null?x-h:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const M=r.zoom,k=this._style.terrain;if(!this._previousUpdateTimestamp)return k.getExaggeration(M);let B=M-this._previousZoom;const G=this._previousUpdateTimestamp;let J=M;this._evaluationZoom!=null&&(J=this._evaluationZoom,Math.abs(M-J)>.5&&(B=.5*(M-J+B)),B*E<0&&(J+=B)),this._evaluationZoom=J;const ee=k.getExaggeration(J),ce=ee===k.getExaggeration(Math.max(0,J-.1));if(ce&&Math.abs(ee-this._exaggeration)<.01)return ee;let le=Math.min(.1,.00375*(this._updateTimestamp-G));return(ce||ee<.1||Math.abs(B)<1e-4)&&(le=Math.min(.2,4*le)),t.ak(this._exaggeration,ee,le)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.dataType==="source"&&r.coord?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((r=>r.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(t.ae.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=h.getIds().map((G=>{const J=h.getTileByID(G).tileID;return J.projMatrix=x.calculateProjMatrix(J.toUnwrapped()),J}));(function(G,J){const ee=J.transform.pointCoordinate(J.transform.getCameraPoint()),ce=new t.P(ee.x,ee.y);G.sort(((le,he)=>{if(he.overscaledZ-le.overscaledZ)return he.overscaledZ-le.overscaledZ;const be=new t.P(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),_e=new t.P(he.canonical.x+(1<<he.canonical.z)*he.wrap,he.canonical.y),ke=ce.mult(1<<le.canonical.z);return ke.x-=.5,ke.y-=.5,ke.distSqr(be)-ke.distSqr(_e)}))})(E,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},E.forEach((G=>{this.proxyToSource[G.key]={}})),this.terrainTileForTile={};const k=this._style._mergedSourceCaches;for(const G in k){const J=k[G];if(!J.used||(J!==this.sourceCache&&this.resetTileLookupCache(J.id),this._setupProxiedCoordsForOrtho(J,r[G],M),J.usedForTerrain))continue;const ee=r[G];J.getSource().reparseOverscaled&&this._assignTerrainTiles(ee)}this.proxiedCoords[h.id]=E.map((G=>new Hm(G,G.key,this.orthoMatrix))),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const B={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const J=this.terrainTileForTile[G.key];if(!J)continue;const ee=J.tileID.key;ee in B||(this._visibleDemTiles.push(J),B[ee]=ee)}}_assignTerrainTiles(r){this._initializing||r.forEach((h=>{if(this.terrainTileForTile[h.key])return;const x=this._findTileCoveringTileID(h,this.sourceCache);x&&(this.terrainTileForTile[h.key]=x)}))}_prepareDEMTextures(){const r=this.painter.context,h=r.gl;for(const x in this.terrainTileForTile){const E=this.terrainTileForTile[x],M=E.dem;!M||E.demTexture&&!E.needsDEMTextureUpload||(r.activeTexture.set(h.TEXTURE1),oh(this.painter,E,M))}}_prepareDemTileUniforms(r,h,x,E){if(!h||h.demTexture==null)return!1;const M=r.tileID.canonical,k=Math.pow(2,h.tileID.canonical.z-M.z),B=E||"";return x[`u_dem_tl${B}`]=[M.x*k%1,M.y*k%1],x[`u_dem_scale${B}`]=k,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const h=this._visibleDemTiles.reduce(((x,E)=>{if(!E.dem)return x;const M=E.dem.tree.minimums[0];return M>0&&r++,x+M}),0);return r?h/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,h=r.gl;r.activeTexture.set(h.TEXTURE2);const x=this._getLoadedAreaMinimum(),E=new t.dL({width:1,height:1},new Float32Array([x]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(E,{premultiply:!1}):M=this._emptyDEMTexture=new t.T(r,E,h.R32F,{premultiply:!1}),M}setupElevationDraw(r,h,x){const E=this.painter.context,M=E.gl,k={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};k.u_exaggeration=this.exaggeration();let B=null,G=null,J=1;if(x&&x.morphing&&this._useVertexMorphing){const he=x.morphing.srcDemTile,be=x.morphing.dstDemTile;J=x.morphing.phase,he&&be&&(this._prepareDemTileUniforms(r,he,k,"_prev")&&(G=he),this._prepareDemTileUniforms(r,be,k)&&(B=be))}const ee=he=>he&&he.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let ce=null;var le;if(this.enabled?G&&B?(ce=B.demTexture,E.activeTexture.set(M.TEXTURE4),G.demTexture.bind(ee(G),M.CLAMP_TO_EDGE),k.u_dem_lerp=J):(B=this.terrainTileForTile[r.tileID.key],ce=this._prepareDemTileUniforms(r,B,k)?B.demTexture:this.emptyDEMTexture):ce=this.emptyDEMTexture,E.activeTexture.set(M.TEXTURE2),ce&&(k.u_dem_size=(le=ce).size[0]===1?1:le.size[0]-2,ce.bind(ee(B),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(x&&x.useDepthForOcclusion,h,k),x&&x.useMeterToDem&&B){const he=(1<<B.tileID.canonical.z)*t.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;k.u_meter_to_dem=he}if(x&&x.labelPlaneMatrixInv&&(k.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),h.setTerrainUniformValues(E,k),this.painter.transform.projection.name==="globe"){const he=this.globeUniformValues(this.painter.transform,r.tileID.canonical,x&&x.useDenormalizedUpVectorScale);h.setGlobeUniformValues(E,he)}}globeUniformValues(r,h,x){const E=r.projection;return{u_tile_tl_up:E.upVector(h,0,0),u_tile_tr_up:E.upVector(h,t.al,0),u_tile_br_up:E.upVector(h,t.al,t.al),u_tile_bl_up:E.upVector(h,0,t.al),u_tile_up_scale:x?t.dM(1):E.upVectorScale(h,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const h=this.painter,x=this.painter.context;r.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(E,M,k,B,G){if(E.transform.projection.name==="globe")(function(J,ee,ce,le,he){const be=J.context,_e=be.gl;let ke,Ae;const Oe=J.transform,He=t.dE(J,be,Oe),Be=(ri,si)=>{if(Ae===si)return;const _i=[Ic[si],"PROJECTION_GLOBE_VIEW"];He&&_i.push("CUSTOM_ANTIALIASING");const Vi=J.isTileAffectedByFog(ri);ke=J.getOrCreateProgram("globeRaster",{defines:_i,overrideFog:Vi}),Ae=si},dt=J.colorModeForRenderPass(),nt=new zn(_e.LEQUAL,zn.ReadWrite,J.depthRangeFor3D);ul.update(he);const at=t.dF(Oe),tt=[t.aF(Oe.center.lng),t.aJ(Oe.center.lat)],Je=J.globeSharedBuffers,mt=[Oe.width*t.o.devicePixelRatio,Oe.height*t.o.devicePixelRatio],Pt=Float32Array.from(Oe.globeMatrix),It={useDenormalizedUpVectorScale:!0};{const ri=J.transform,si=Hp(ri.zoom,ee.exaggeration(),ee.sourceCache._source.tileSize);Ae=-1;const _i=_e.TRIANGLES;for(const Vi of le){const Kt=ce.getTile(Vi),bt=sr.disabled,oi=ee.prevTerrainTileForTile[Vi.key],ni=ee.terrainTileForTile[Vi.key];ip(oi,ni)&&ul.newMorphing(Vi.key,oi,ni,he,250),np(J,Kt.emissiveTexture),be.activeTexture.set(_e.TEXTURE0),Kt.texture&&Kt.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const Li=ul.getMorphValuesForProxy(Vi.key),en=Li?1:0;Li&&Object.assign(It,{morphing:{srcDemTile:Li.from,dstDemTile:Li.to,phase:t.dD(Li.phase)}});const xn=t.dG(Vi.canonical),Yi=t.dH(xn.getCenter().lat),Wi=t.dI(Vi.canonical,xn,Yi,ri.worldSize/ri._pixelsPerMercatorPixel),kn=t.bk(t.dJ(Vi.canonical)),Pn=J.emissiveMode==="mrt-fallback"?1:0,pn=zu(ri.expandedFarZProjMatrix,Pt,at,kn,t.aj(ri.zoom),tt,ri.frustumCorners.TL,ri.frustumCorners.TR,ri.frustumCorners.BR,ri.frustumCorners.BL,ri.globeCenterInViewSpace,ri.globeRadius,mt,si,ri._farZ,Pn,Wi);if(Be(Vi,en),ke&&(ee.setupElevationDraw(Kt,ke,It),J.uploadCommonUniforms(be,ke,Vi.toUnwrapped()),Je)){const[Tn,Kn,Er]=Je.getGridBuffers(Yi,si!==0);ke.draw(J,_i,nt,bt,dt,pr.backCCW,pn,"globe_raster",Tn,Kn,Er)}}}if(Je&&(J.renderDefaultNorthPole||J.renderDefaultSouthPole)){const ri=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];He&&ri.push("CUSTOM_ANTIALIASING"),ke=J.getOrCreateProgram("globeRaster",{defines:ri});for(const si of le){const{x:_i,y:Vi,z:Kt}=si.canonical,bt=Vi===0,oi=Vi===(1<<Kt)-1,[ni,Li,en,xn]=Je.getPoleBuffers(Kt,!1);if(xn&&(bt||oi)){const Yi=ce.getTile(si);np(J,Yi.emissiveTexture),be.activeTexture.set(_e.TEXTURE0),Yi.texture&&Yi.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);let Wi=t.dK(Kt,_i,Oe);const kn=t.bk(t.dJ(si.canonical)),Pn=J.emissiveMode==="mrt-fallback"?1:0,pn=(Tn,Kn)=>Tn.draw(J,_e.TRIANGLES,nt,sr.disabled,dt,pr.disabled,zu(Oe.expandedFarZProjMatrix,Wi,Wi,kn,0,tt,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,mt,0,Oe._farZ,Pn),"globe_pole_raster",Kn,en,xn);ee.setupElevationDraw(Yi,ke,It),J.uploadCommonUniforms(be,ke,si.toUnwrapped()),bt&&J.renderDefaultNorthPole&&pn(ke,ni),oi&&J.renderDefaultSouthPole&&(Wi=t.cS(t.bC(),Wi,[1,-1,1]),pn(ke,Li))}}}})(E,M,k,B,G);else{const J=E.context,ee=J.gl;let ce,le;const he=E.shadowRenderer,be=rh(E,E.longestCutoffRange),_e=dt=>{if(le===dt)return;const nt=[];nt.push(Ic[dt]),be.shouldRenderCutoff&&nt.push("RENDER_CUTOFF"),he&&(nt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&nt.push("NORMAL_OFFSET")),ce=E.getOrCreateProgram("terrainRaster",{defines:nt}),le=dt},ke=E.colorModeForRenderPass(),Ae=new zn(ee.LEQUAL,zn.ReadWrite,E.depthRangeFor3D);ul.update(G);const Oe=E.transform,He=Hp(Oe.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let Be=[0,0,0];if(he){const dt=E.style.directionalLight,nt=E.style.ambientLight;dt&&nt&&(Be=sh(E.style,dt,nt))}{le=-1;const dt=ee.TRIANGLES,[nt,at]=[M.gridIndexBuffer,M.gridSegments];for(const tt of B){const Je=k.getTile(tt),mt=sr.disabled,Pt=M.prevTerrainTileForTile[tt.key],It=M.terrainTileForTile[tt.key];ip(Pt,It)&&ul.newMorphing(tt.key,Pt,It,G,250),np(E,Je.emissiveTexture),J.activeTexture.set(ee.TEXTURE0),Je.texture&&Je.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const ri=ul.getMorphValuesForProxy(tt.key),si=ri?1:0;let _i;ri&&(_i={morphing:{srcDemTile:ri.from,dstDemTile:ri.to,phase:t.dD(ri.phase)}});const Vi=E.emissiveMode==="mrt-fallback"?1:0,Kt=fc(tt.projMatrix,Hc(tt.canonical,Oe.renderWorldCopies)?He/10:He,Be,Vi);if(_e(si),!ce)continue;M.setupElevationDraw(Je,ce,_i);const bt=tt.toUnwrapped();he&&he.setupShadows(bt,ce),E.uploadCommonUniforms(J,ce,bt,null,be),ce.draw(E,dt,Ae,mt,ke,pr.backCCW,Kt,"terrain_raster",M.gridBuffer,nt,at)}}}})(h,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const h=this.painter,x=this.painter.context,E=this.proxySourceCache,M=this.proxiedCoords[E.id],k=this._drapedRenderBatches.shift(),B=h.style.order,G=[];this._updateFBOs(h.emissiveMode==="mrt-fallback");let J=0;for(const ee of M){const ce=E.getTileByID(ee.proxyTileKey),le=E.proxyCachedFBO[ee.key]?E.proxyCachedFBO[ee.key][r]:void 0,he=le!==void 0?E.renderCache[le]:this.pool[J++],be=le!==void 0;if(ce.texture=he.tex,ce.emissiveTexture=he.emissiveTex,be&&!he.dirty){G.push(ce.tileID);continue}x.bindFramebuffer.set(he.fb.framebuffer);const _e=x.gl;let ke;_e.drawBuffers(h.emissiveMode==="mrt-fallback"?[_e.COLOR_ATTACHMENT0,_e.COLOR_ATTACHMENT1]:[_e.COLOR_ATTACHMENT0]),this.renderedToTile=!1,he.dirty&&(x.clear({color:t.ao.transparent,stencil:0}),he.dirty=!1);for(let Ae=k.start;Ae<=k.end;++Ae){const Oe=h.style._mergedLayers[B[Ae]];if(Oe.isHidden(h.transform.zoom))continue;const He=h.style.getLayerSourceCache(Oe),Be=He?this.proxyToSource[ee.key][He.id]:[ee];if(!Be)continue;const dt=Be;x.viewport.set([0,0,he.fb.width,he.fb.height]),ke!==(He?He.id:null)&&(this._setupStencil(he,Be,Oe,He),ke=He?He.id:null),h.renderLayer(h,He,Oe,dt)}if(_e.drawBuffers([_e.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const Ae of this._pendingGroundEffectLayers){const Oe=h.style._mergedLayers[B[Ae]];if(Oe.isHidden(h.transform.zoom))continue;const He=h.style.getLayerSourceCache(Oe),Be=He?this.proxyToSource[ee.key][He.id]:[ee];if(!Be)continue;const dt=Be;x.viewport.set([0,0,he.fb.width,he.fb.height]),ke!==(He?He.id:null)&&(this._setupStencil(he,Be,Oe,He),ke=He?He.id:null),h.renderLayer(h,He,Oe,dt)}this.renderedToTile?(he.dirty=!0,G.push(ce.tileID)):be||--J,J===5&&(J=0,this.renderToBackBuffer(G))}return this.renderToBackBuffer(G),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),k.end+1}postRender(){}isLayerOrderingCorrect(r){const h=r.order.length;let x=-1,E=h;for(let M=0;M<h;++M)this._style.isLayerDraped(r._mergedLayers[r.order[M]])?x=Math.max(x,M):E=Math.min(E,M);return E>x}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter((h=>h.dem)).forEach((h=>{r=Math.min(r,h.dem.tree.minimums[0])})),r===0?r:(r-30)*this._exaggeration}raycast(r,h,x){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter((M=>M.dem)).map((M=>{const k=M.tileID,B=1<<k.overscaledZ,{x:G,y:J}=k.canonical,ee=G/B,ce=(G+1)/B,le=J/B,he=(J+1)/B;return{minx:ee,miny:le,maxx:ce,maxy:he,t:M.dem.tree.raycastRoot(ee,le,ce,he,r,h,x),tile:M}}));E.sort(((M,k)=>(M.t!==null?M.t:Number.MAX_VALUE)-(k.t!==null?k.t:Number.MAX_VALUE)));for(const M of E){if(M.t==null)return null;const k=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,r,h,x);if(k!=null)return k}return null}_createFBO(){const r=this.painter.context,h=r.gl,x=this.drapeBufferSize;r.activeTexture.set(h.TEXTURE0);const E=new t.T(r,{width:x[0],height:x[1],data:null},h.RGBA8);E.bind(h.LINEAR,h.CLAMP_TO_EDGE);const M=r.createFramebuffer(x[0],x[1],1,null);let k;return M.colorAttachment0.set(E.texture),this._emissiveTexture&&(k=new t.T(r,{width:x[0],height:x[1],data:null},h.R8),k.bind(h.LINEAR,h.CLAMP_TO_EDGE),M.createColorAttachment(r,1),M.colorAttachment1.set(k.texture)),M.depthAttachment=new qm(r,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:M,tex:E,emissiveTex:k,dirty:!1}}_updateFBOs(r){if(this._emissiveTexture!==r){for(const h of this.pool)this._updateFBO(h,r);for(const h of this.proxySourceCache.renderCache)this._updateFBO(h,r);this._emissiveTexture=r}}_updateFBO(r,h){const x=r.fb,E=this.painter.context,M=E.gl,k=this.drapeBufferSize;if(h){const B=new t.T(E,{width:k[0],height:k[1],data:null},M.R8);B.bind(M.LINEAR,M.CLAMP_TO_EDGE),r.emissiveTex=B,x.createColorAttachment(E,1),x.colorAttachment1.set(B.texture)}else r.emissiveTex=void 0,x.removeColorAttachment(E,1);r.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some((r=>{const h=this._style._mergedLayers[r],x=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!x&&h.shouldRedrape():!x&&h.hasTransition()}))}_clearLineLayersFromRenderCache(){let r=!1;for(const x of this._style.getSources())if(x instanceof dd){r=!0;break}if(!r)return;const h={};for(let x=0;x<this._style.order.length;++x){const E=this._style._mergedLayers[this._style.order[x]],M=this._style.getLayerSourceCache(E);if(!M||h[M.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="line")continue;const k=E.widthExpression(),B=E.emissiveStrengthExpression();if(k instanceof t.ad||B instanceof t.ad){h[M.id]=!0;for(const G of this.proxyCoords){const J=this.proxyToSource[G.key][M.id];if(J)for(const ee of J)this._clearRenderCacheForTile(M.id,ee)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const x in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[x]._source instanceof wa){r=!0;break}if(!r)return;const h={};for(let x=0;x<this._style.order.length;++x){const E=this._style._mergedLayers[this._style.order[x]],M=this._style.getLayerSourceCache(E);if(!M||h[M.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const k=E.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const G=this.proxyToSource[B.key][M.id];if(G)for(const J of G){const ee=jh(M.getTile(J),M.findLoadedParent(J,0),M,this.painter.transform,k);(ee.opacity!==1||ee.mix!==0)&&this._clearRenderCacheForTile(M.id,J)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,h=r.length;if(h===0)return;const x=[];this._pendingGroundEffectLayers=[];let E,M=0,k=this._style._mergedLayers[r[M]];for(;!this._style.isLayerDraped(k)&&k.isHidden(this.painter.transform.zoom)&&++M<h;)k=this._style._mergedLayers[r[M]];for(;M<h;++M){const B=this._style._mergedLayers[r[M]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?E===void 0&&(E=M):(B.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),E!==void 0&&(x.push({start:E,end:M-1}),E=void 0)))}if(E!==void 0&&x.push({start:E,end:M-1}),x.length!==0){const B=x[x.length-1];this._pendingGroundEffectLayers.every((G=>G>B.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=x}_setupRenderCache(r){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const k=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let B=0;B<k.length;++B){const G=Object.values(k[B]);h.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const x=this.proxyCoords,E=this._tilesDirty;for(let k=x.length-1;k>=0;k--){const B=x[k];if(h.getTileByID(B.key),h.proxyCachedFBO[B.key]!==void 0){const G=r[B.key],J=this.proxyToSource[B.key];let ee=0;for(const ce in J){const le=J[ce],he=G[ce];if(!he||he.length!==le.length||le.some(((be,_e)=>be!==he[_e]||E[ce]&&E[ce].hasOwnProperty(be.key)))){ee=-1;break}++ee}for(const ce in h.proxyCachedFBO[B.key])h.renderCache[h.proxyCachedFBO[B.key][ce]].dirty=ee<0||ee!==Object.values(G).length}}const M=[...this._drapedRenderBatches];M.sort(((k,B)=>B.end-B.start-(k.end-k.start)));for(const k of M)for(const B of x){if(h.proxyCachedFBO[B.key])continue;let G=h.renderCachePool.pop();G===void 0&&h.renderCache.length<50&&(G=h.renderCache.length,h.renderCache.push(this._createFBO())),G!==void 0&&(h.proxyCachedFBO[B.key]={},h.proxyCachedFBO[B.key][k.start]=G,h.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(r,h,x,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,k=M.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let B;if(x.isTileClipped())B=h.length,this._overlapStencilMode.test={func:k.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);B=1,this._overlapStencilMode.test={func:k.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+B>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=B,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):sr.disabled}_renderTileClippingMasks(r,h){const x=this.painter,E=this.painter.context,M=E.gl;x._tileClippingMaskIDs={},E.setColorMode(yr.disabled),E.setDepthMode(zn.disabled);const k=x.getOrCreateProgram("clippingMask");for(const B of r){const G=x._tileClippingMaskIDs[B.key]=--h;k.draw(x,M.TRIANGLES,zn.disabled,new sr({func:M.ALWAYS,mask:0},G,255,M.KEEP,M.KEEP,M.REPLACE),yr.disabled,pr.disabled,Vh(B.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(r){const h=this.painter.transform;if(r.x<0||r.x>h.width||r.y<0||r.y>h.height)return null;const x=[r.x,r.y,1,1];t.aC(x,x,h.pixelMatrixInverse),t.cK(x,x,1/x[3]),x[0]/=h.worldSize,x[1]/=h.worldSize;const E=h._camera.position,M=t.cf(1,h.center.lat),k=[E[0],E[1],E[2]/M,0],B=t.da([],x.slice(0,3),k);t.aw(B,B);const G=this.raycast(k,B,this._exaggeration);return G!==null&&G?(t.bH(k,k,B,G),k[3]=k[2],k[2]*=M,k):null}_setupProxiedCoordsForOrtho(r,h,x){if(r.getSource()instanceof t.aU)return this._setupProxiedCoordsForImageSource(r,h,x);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const E=this.proxiedCoords[r.id]=[],M=this.proxyCoords;for(let G=0;G<M.length;G++){const J=M[G],ee=this._findTileCoveringTileID(J,r);if(ee){const ce=this._createProxiedId(J,ee,x[J.key]&&x[J.key][r.id]);E.push(ce),this.proxyToSource[J.key][r.id]=[ce]}}let k=!1;const B=new Set;for(let G=0;G<h.length;G++){const J=r.getTile(h[G]);if(!J||!J.hasData())continue;const ee=this._findTileCoveringTileID(J.tileID,this.proxySourceCache);if(ee&&ee.tileID.canonical.z!==J.tileID.canonical.z){const ce=this.proxyToSource[ee.tileID.key][r.id],le=this._createProxiedId(ee.tileID,J,x[ee.tileID.key]&&x[ee.tileID.key][r.id]);ce?ce.splice(ce.length-1,0,le):this.proxyToSource[ee.tileID.key][r.id]=[le];const he=this.proxyToSource[ee.tileID.key][r.id];B.has(he)||B.add(he),E.push(le),k=!0}}if(this._sourceTilesOverlap[r.id]=k,k&&this._debugParams.sortTilesHiZFirst)for(const G of B)G.sort(((J,ee)=>ee.overscaledZ-J.overscaledZ))}_setupProxiedCoordsForImageSource(r,h,x){if(!r.getSource().loaded())return;const E=this.proxiedCoords[r.id]=[],M=this.proxyCoords,k=r.getSource(),B=k.tileID;if(!B)return;const G=new t.P(B.x,B.y)._div(1<<B.z),J=k.coordinates.map(t.ae.fromLngLat).reduce(((ce,le)=>(ce.min.x=Math.min(ce.min.x,le.x-G.x),ce.min.y=Math.min(ce.min.y,le.y-G.y),ce.max.x=Math.max(ce.max.x,le.x-G.x),ce.max.y=Math.max(ce.max.y,le.y-G.y),ce)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ee=(ce,le)=>{const he=ce.wrap+ce.canonical.x/(1<<ce.canonical.z),be=ce.canonical.y/(1<<ce.canonical.z),_e=t.al/(1<<ce.canonical.z),ke=le.wrap+le.canonical.x/(1<<le.canonical.z),Ae=le.canonical.y/(1<<le.canonical.z);return he+_e<ke+J.min.x||he>ke+J.max.x||be+_e<Ae+J.min.y||be>Ae+J.max.y};for(let ce=0;ce<M.length;ce++){const le=M[ce];for(let he=0;he<h.length;he++){const be=r.getTile(h[he]);if(!be||!be.hasData()||ee(le,be.tileID))continue;const _e=this._createProxiedId(le,be,x[le.key]&&x[le.key][r.id]),ke=this.proxyToSource[le.key][r.id];ke?ke.push(_e):this.proxyToSource[le.key][r.id]=[_e],E.push(_e)}}}_createProxiedId(r,h,x){let E=this.orthoMatrix;if(x){const M=x.find((k=>k.key===h.tileID.key));if(M)return M}if(h.tileID.key!==r.key){const M=r.canonical.z-h.tileID.canonical.z;let k,B,G;E=t.bC();const J=h.tileID.wrap-r.wrap<<r.overscaledZ;M>0?(k=t.al>>M,B=k*((h.tileID.canonical.x<<M)-r.canonical.x+J),G=k*((h.tileID.canonical.y<<M)-r.canonical.y)):(k=t.al<<-M,B=t.al*(h.tileID.canonical.x-(r.canonical.x+J<<-M)),G=t.al*(h.tileID.canonical.y-(r.canonical.y<<-M))),t.ce(E,0,k,0,k,0,1),t.br(E,E,[B,G,0])}return new Hm(h.tileID,r.key,E)}_findTileCoveringTileID(r,h){let x=h.getTile(r);if(x&&x.hasData())return x;const E=this._findCoveringTileCache[h.id],M=E[r.key];if(x=M?h.getTileByID(M):null,x&&x.hasData()||M===null)return x;let k=x?x.tileID:r,B=k.overscaledZ;const G=h.getSource().minzoom,J=[];if(!M){const ce=h.getSource().maxzoom;if(r.canonical.z>=ce){const le=r.canonical.z-ce;h.getSource().reparseOverscaled?(B=Math.max(r.canonical.z+2,h.transform.tileZoom),k=new t.aQ(B,r.wrap,ce,r.canonical.x>>le,r.canonical.y>>le)):le!==0&&(B=ce,k=new t.aQ(B,r.wrap,ce,r.canonical.x>>le,r.canonical.y>>le))}k.key!==r.key&&(J.push(k.key),x=h.getTile(k))}const ee=ce=>{J.forEach((le=>{E[le]=ce})),J.length=0};for(B-=1;B>=G&&(!x||!x.hasData());B--){x&&ee(x.tileID.key);const ce=k.calculateScaledKey(B);if(x=h.getTileByID(ce),x&&x.hasData())break;const le=E[ce];if(le===null)break;le===void 0?J.push(ce):x=h.getTileByID(le)}return ee(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,h){let x=this._tilesDirty[r];x||(x=this._tilesDirty[r]={}),x[h.key]=!0}}function rp(v,r,h){const x=(function(B,G,J){const ee=t.bJ(G,B),ce=t.bJ(J,[.2126,.7152,.0722]),le=(be,_e,ke)=>(1-ke)*be+ke*_e,he=le(1-.3*Math.min(ce,1),1,Math.min(ee+1,1));return le(.92,1,Math.asin(t.aA(G[2],-1,1))/Math.PI+.5)*he})(v,[0,0,1],r),E=[0,0,0];t.c5(E,h.slice(0,3),x);const M=[0,0,0];t.c5(M,r.slice(0,3),v[2]);const k=[0,0,0];return t.d8(k,E,M),t.db(k)}const sp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],op=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class du{static cacheKey(r,h,x,E){const M=[h];E&&M.push(E.cacheKey);for(const k of x)r.usedDefines.has(k)&&M.push(k);return M.join("/")}constructor(r,h,x,E,M,k){const B=r.gl;this.program=B.createProgram(),this.configuration=E,this.name=h,this.fixedDefines=[...k];const G=`#version 300 es
${(E?E.defines():[]).concat(k.map((_e=>`#define ${_e}`))).join(`
`)}`,J=[G,jg];for(const _e of x.fragmentIncludes)J.push(Ed[_e]);J.push(x.fragmentSource);const ee=J.join(`
`),ce=[G,uf];for(const _e of x.vertexIncludes)ce.push(Ed[_e]);this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&x.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&ce.push("uniform int u_instanceID;"),ce.push(x.vertexSource);let le=ce.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(le=le.replaceAll("gl_InstanceID","u_instanceID"));const he=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(he,ee),B.compileShader(he),B.attachShader(this.program,he);const be=B.createShader(B.VERTEX_SHADER);B.isContextLost()?this.failedToCreate=!0:(B.shaderSource(be,le),B.compileShader(be),B.attachShader(this.program,be),this.attributes={},B.linkProgram(this.program),B.deleteShader(be),B.deleteShader(he),this.fixedUniforms=M(r),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=E?E.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(_e=>({u_instanceID:new t.ch(_e)}))(r)),(k.includes("TERRAIN")||h.includes("symbol")||h.includes("circle"))&&(this.terrainUniforms=(_e=>({u_dem:new t.ch(_e),u_dem_prev:new t.ch(_e),u_dem_tl:new t.ck(_e),u_dem_scale:new t.cj(_e),u_dem_tl_prev:new t.ck(_e),u_dem_scale_prev:new t.cj(_e),u_dem_size:new t.cj(_e),u_dem_lerp:new t.cj(_e),u_exaggeration:new t.cj(_e),u_depth:new t.ch(_e),u_depth_size_inv:new t.ck(_e),u_depth_range_unpack:new t.ck(_e),u_occluder_half_size:new t.cj(_e),u_occlusion_depth_offset:new t.cj(_e),u_meter_to_dem:new t.cj(_e),u_label_plane_matrix_inv:new t.cl(_e)}))(r)),k.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new t.ci(_e),u_tile_tr_up:new t.ci(_e),u_tile_br_up:new t.ci(_e),u_tile_bl_up:new t.ci(_e),u_tile_up_scale:new t.cj(_e)}))(r)),k.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new t.cl(_e),u_fog_range:new t.ck(_e),u_fog_color:new t.d3(_e),u_fog_horizon_blend:new t.cj(_e),u_fog_vertical_limit:new t.ck(_e),u_fog_temporal_offset:new t.cj(_e),u_frustum_tl:new t.ci(_e),u_frustum_tr:new t.ci(_e),u_frustum_br:new t.ci(_e),u_frustum_bl:new t.ci(_e),u_globe_pos:new t.ci(_e),u_globe_radius:new t.cj(_e),u_globe_transition:new t.cj(_e),u_is_globe:new t.ch(_e),u_viewport:new t.ck(_e)}))(r)),k.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new t.d3(_e)}))(r)),k.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new t.ci(_e),u_lighting_directional_dir:new t.ci(_e),u_lighting_directional_color:new t.ci(_e),u_ground_radiance:new t.ci(_e)}))(r)),k.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new t.cl(_e),u_light_matrix_1:new t.cl(_e),u_fade_range:new t.ck(_e),u_shadow_normal_offset:new t.ci(_e),u_shadow_intensity:new t.cj(_e),u_shadow_texel_size:new t.cj(_e),u_shadow_map_resolution:new t.cj(_e),u_shadow_direction:new t.ci(_e),u_shadow_bias:new t.ci(_e),u_shadowmap_0:new t.ch(_e),u_shadowmap_1:new t.ch(_e)}))(r)))}getAttributeLocation(r,h){let x=this.attributes[h];return x===void 0&&(x=this.attributes[h]=r.getAttribLocation(this.program,h)),x}setTerrainUniformValues(r,h){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const E in h)x[E]&&x[E].set(this.program,E,h[E])}}setGlobeUniformValues(r,h){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const E in h)x[E]&&x[E].set(this.program,E,h[E])}}setFogUniformValues(r,h){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const E in h)x[E].set(this.program,E,h[E])}}setCutoffUniformValues(r,h){if(!this.cutoffUniforms)return;const x=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const E in h)x[E].set(this.program,E,h[E])}}setLightsUniformValues(r,h){if(!this.lightsUniforms)return;const x=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const E in h)x[E].set(this.program,E,h[E])}}setShadowUniformValues(r,h){if(this.failedToCreate||!this.shadowUniforms)return;const x=this.shadowUniforms;r.program.set(this.program);for(const E in h)x[E].set(this.program,E,h[E])}_drawDebugWireframe(r,h,x,E,M,k,B,G,J,ee){const ce=r.options.wireframe;if(ce.terrain===!1&&ce.layers2D===!1&&ce.layers3D===!1)return;const le=r.context;if(!(!(!ce.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!ce.layers2D||r._terrain&&r._terrain.renderingToTexture||!sp.includes(this.name))||!(!ce.layers3D||!op.includes(this.name))))return;const he=le.gl,be=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,M,le);if(!be)return;const _e=[...this.fixedDefines,"DEBUG_WIREFRAME"],ke=r.getOrCreateProgram(this.name,{config:this.configuration,defines:_e});le.program.set(ke.program);const Ae=(Be,dt,nt)=>{if(dt[Be]&&nt[Be])for(const at in dt[Be])nt[Be][at]&&nt[Be][at].set(nt.program,at,dt[Be][at].current)};J&&J.setUniforms(ke.program,le,ke.binderUniforms,B,{zoom:G}),Ae("fixedUniforms",this,ke),Ae("terrainUniforms",this,ke),Ae("globeUniforms",this,ke),Ae("fogUniforms",this,ke),Ae("lightsUniforms",this,ke),Ae("shadowUniforms",this,ke),be.bind(),le.setColorMode(new yr([he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ZERO,he.ONE],t.ao.transparent,[!0,!0,!0,!1])),le.setDepthMode(new zn(h.func===he.LESS?he.LEQUAL:h.func,zn.ReadOnly,h.range)),le.setStencilMode(sr.disabled);const Oe=3*k.primitiveLength*2,He=3*k.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Be=ee||1;for(let dt=0;dt<Be;++dt)ke.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",dt),he.drawElements(he.LINES,Oe,he.UNSIGNED_SHORT,He)}else ee&&ee>1?he.drawElementsInstanced(he.LINES,Oe,he.UNSIGNED_SHORT,He,ee):he.drawElements(he.LINES,Oe,he.UNSIGNED_SHORT,He);M.bind(),le.program.set(this.program),le.setDepthMode(h),le.setStencilMode(x),le.setColorMode(E)}checkUniforms(r,h,x){if(this.fixedDefines.includes(h)){for(const E of Object.keys(x))if(!x[E].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${E} not set but required by ${h} being defined`)}}draw(r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke){const Ae=r.context,Oe=Ae.gl;if(this.failedToCreate)return;Ae.program.set(this.program),Ae.setDepthMode(x),Ae.setStencilMode(E),Ae.setColorMode(M),Ae.setCullFace(k);for(const[tt,Je]of this.fixedUniformsEntries)Je.set(this.program,tt,B[tt]);be&&be.setUniforms(this.program,Ae,this.binderUniforms,le,{zoom:he});const He={[Oe.POINTS]:1,[Oe.LINES]:2,[Oe.TRIANGLES]:3,[Oe.LINE_STRIP]:1}[h];this.checkUniforms(G,"RENDER_SHADOWS",this.shadowUniforms);const Be=_e||[],dt=be?be.getPaintVertexBuffers():[],nt=h===Oe.TRIANGLES&&ee,at=ke&&ke>0?1:void 0;for(const tt of ce.get()){const Je=tt.vaos||(tt.vaos={});if((Je[G]||(Je[G]=new Ug)).bind(Ae,this,J,dt,ee,tt.vertexOffset,Be,at),this.forceManualRenderingForInstanceIDShaders){const mt=ke||1;for(let Pt=0;Pt<mt;++Pt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pt),ee?Oe.drawElements(h,tt.primitiveLength*He,Oe.UNSIGNED_SHORT,tt.primitiveOffset*He*2):Oe.drawArrays(h,tt.vertexOffset,tt.vertexLength)}else ke&&ke>1?Oe.drawElementsInstanced(h,tt.primitiveLength*He,Oe.UNSIGNED_SHORT,tt.primitiveOffset*He*2,ke):ee?Oe.drawElements(h,tt.primitiveLength*He,Oe.UNSIGNED_SHORT,tt.primitiveOffset*He*2):Oe.drawArrays(h,tt.vertexOffset,tt.vertexLength);nt&&this._drawDebugWireframe(r,x,E,M,ee,tt,le,he,be,ke)}}}function ur(v,r,h=0){const x=Math.pow(2,r.tileID.overscaledZ),E=r.tileSize*Math.pow(2,v.transform.tileZoom)/x,M=E*(r.tileID.canonical.x+r.tileID.wrap*x),k=E*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.ay(r,1,v.transform.tileZoom),u_pixel_coord_upper:[M>>16,k>>16],u_pixel_coord_lower:[65535&M,65535&k],u_pattern_transition:h}}const gf={terrain:0,flat:1},Wg=t.bC(),Uh=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae)=>{const Oe=r.style.light,He=Oe.properties.get("position"),Be=[He.x,He.y,He.z],dt=t.dO();Oe.properties.get("anchor")==="viewport"&&(t.dP(dt,-r.transform.angle),t.dQ(Be,Be,dt));const nt=Oe.properties.get("color").toPremultipliedRenderColor(null),at=r.transform,tt={u_matrix:v,u_lightpos:Be,u_lightintensity:Oe.properties.get("intensity"),u_lightcolor:[nt.r,nt.g,nt.b],u_vertical_gradient:+h,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:gf[J],u_base_type:gf[ee],u_ao:E,u_edge_radius:M,u_width_scale:k,u_flood_light_color:be,u_vertical_scale:_e,u_flood_light_intensity:ke,u_ground_shadow_factor:Ae};return at.projection.name==="globe"&&(tt.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],tt.u_zoom_transition=ce,tt.u_inv_rot_matrix=he,tt.u_merc_center=le,tt.u_up_dir=at.projection.upVector(new t.cD(0,0,0),le[0]*t.al,le[1]*t.al),tt.u_height_lift=G),tt},_f=(v,r,h,x,E,M)=>({u_matrix:v,u_edge_radius:r,u_width_scale:h,u_vertical_scale:x,u_height_type:gf[E],u_base_type:gf[M]}),ap=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae)=>{const Oe=Uh(v,r,h,x,E,M,k,B,J,ee,ce,le,he,be,_e,ke,1,[0,0,0]),He={u_height_factor:-Math.pow(2,B.overscaledZ)/G.tileSize/8};return Object.assign(Oe,ur(r,G,Ae),He)},Md=(v,r,h,x,E,M,k,B,G,J,ee)=>({u_matrix:r,u_opacity:h,u_ao_pass:x?1:0,u_meter_to_tile:E,u_ao:M,u_flood_light_intensity:k,u_flood_light_color:B,u_attenuation:G,u_edge_radius:J,u_fb:0,u_fb_size:ee,u_dynamic_offset:1}),yf=(v,r,h)=>({u_matrix:v,u_emissive_strength:r,u_ground_shadow_factor:h}),Wp=(v,r,h,x,E,M=0)=>Object.assign(yf(v,r,E),ur(h,x,M)),Zg=(v,r,h,x)=>({u_matrix:v,u_world:h,u_emissive_strength:r,u_ground_shadow_factor:x}),kd=(v,r,h,x,E,M,k=0)=>Object.assign(Wp(v,r,h,x,M,k),{u_world:E}),Dd=(v,r)=>({u_matrix:v,u_ground_shadow_factor:r}),hh=(v,r,h,x,E)=>({u_matrix:v,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:h,u_height_scale:x,u_reset_depth:E}),vf=(v,r,h,x,E,M,k,B,G)=>({u_matrix:v,u_normal_matrix:r,u_opacity:h,u_faux_facade_ao_intensity:x,u_camera_pos:E,u_tile_to_meter:M,u_facade_emissive_chance:k,u_flood_light_color:B,u_flood_light_intensity:G}),Xg=v=>({u_matrix:v}),dh=v=>({u_matrix:v}),Wm=(v,r,h,x,E,M,k,B)=>{const G=t.al/M.tileSize;return{u_matrix:v,u_inv_rot_matrix:r,u_camera_to_center_distance:h.getCameraToCenterDistance(B),u_extrude_scale:[h.pixelsToGLUnits[0]/G,h.pixelsToGLUnits[1]/G],u_zoom_transition:x,u_tile_id:k,u_merc_center:E}},xf=(v,r,h=1)=>({u_matrix:v,u_color:r,u_overlay:0,u_overlay_scale:h}),Zm=t.bC(),Yg=(v,r,h,x,E,M,k)=>{const B=v.transform,G=B.projection.name==="globe",J=G?t.dR(B.zoom,r.canonical)*B._pixelsPerMercatorPixel:t.ay(h,1,M),ee={u_matrix:r.projMatrix,u_extrude_scale:J,u_intensity:k,u_inv_rot_matrix:Zm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){ee.u_inv_rot_matrix=x,ee.u_merc_center=E,ee.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],ee.u_zoom_transition=t.aj(B.zoom);const ce=E[0]*t.al,le=E[1]*t.al;ee.u_up_dir=B.projection.upVector(new t.cD(0,0,0),ce,le)}return ee};function Ou(v,[r,h,x,E],[M,k]){if(M===k)return[0,0,0,0];const B=255*(v-1)/(v*(k-M));return[r*B,h*B,x*B,E*B]}function To(v,r,[h,x]){return h===x?0:.5/v+(r-h)*(v-1)/(v*(x-h))}const cy=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe,He,Be)=>({u_matrix:v,u_normalize_matrix:r,u_globe_matrix:h,u_merc_matrix:x,u_grid_matrix:E,u_tl_parent:M,u_scale_parent:J,u_fade_t:ee.mix,u_opacity:ee.opacity*ce.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ce.paint.get("raster-brightness-min"),u_brightness_high:ce.paint.get("raster-brightness-max"),u_saturation_factor:t.dT(ce.paint.get("raster-saturation")),u_contrast_factor:t.dS(ce.paint.get("raster-contrast")),u_spin_weights:lp(ce.paint.get("raster-hue-rotate")),u_perspective_transform:le,u_raster_elevation:he,u_zoom_transition:k,u_merc_center:B,u_cutoff_params:G,u_colorization_mix:Ou(t.dU,_e,Ae),u_colorization_offset:To(t.dU,ke,Ae),u_color_ramp:be,u_texture_offset:[He/(Oe+2*He),Oe/(Oe+2*He)],u_texture_res:[Oe+2*He,Oe+2*He],u_emissive_strength:Be});function lp(v){v*=Math.PI/180;const r=Math.sin(v),h=Math.cos(v);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const Wc=.05,Xm=(v,r,h,x,E,M,k,B,G,J,ee,ce)=>({u_matrix:v,u_normalize_matrix:r,u_globe_matrix:h,u_merc_matrix:x,u_grid_matrix:E,u_tl_parent:M,u_scale_parent:J,u_fade_t:ee.mix,u_opacity:ee.opacity,u_image0:0,u_image1:1,u_raster_elevation:ce,u_zoom_transition:k,u_merc_center:B,u_cutoff_params:G}),Kg=(v,r,h,x,E,M,k,B,G,J)=>({u_particle_texture:v,u_particle_texture_side_len:r,u_tile_offset:h,u_velocity:x,u_color_ramp:M,u_velocity_res:E,u_max_speed:k,u_uv_offset:B,u_data_scale:[255*G[0],255*G[1]],u_data_offset:J,u_particle_pos_scale:1.1,u_particle_pos_offset:[Wc,Wc]}),Jg=(v,r,h,x,E,M,k,B,G,J)=>({u_particle_texture:v,u_particle_texture_side_len:r,u_velocity:h,u_velocity_res:x,u_max_speed:E,u_speed_factor:M,u_reset_rate:k,u_rand_seed:Math.random(),u_uv_offset:B,u_data_scale:[255*G[0],255*G[1]],u_data_offset:J,u_particle_pos_scale:1.1,u_particle_pos_offset:[Wc,Wc]}),Qg=t.bC(),Zp=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe,He,Be,dt,nt,at)=>{const tt=E.transform,Je={u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:tt.getCameraToCenterDistance(Oe),u_rotate_symbol:+h,u_aspect_ratio:tt.width/tt.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:k,u_coord_matrix:B,u_is_text:+J,u_elevation_from_sea:G?1:0,u_pitch_with_map:+x,u_texsize:ee,u_texsize_icon:ce,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Qg,u_up_vector:[0,-1,0],u_color_adj_mat:dt,u_icon_transition:nt||0,u_gamma_scale:x?E.transform.getCameraToCenterDistance(Oe)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:t.o.devicePixelRatio,u_is_halo:1,u_scale_factor:at||1,u_ground_shadow_factor:He,u_inv_matrix:t.bl(t.bC(),k),u_normal_scale:Be,u_lutTexture:$a.LUT};return Oe.name==="globe"&&(Je.u_tile_id=[he.canonical.x,he.canonical.y,1<<he.canonical.z],Je.u_zoom_transition=be,Je.u_inv_rot_matrix=ke,Je.u_merc_center=_e,Je.u_camera_forward=tt._camera.forward(),Je.u_ecef_origin=t.dV(tt.globeMatrix,he.toUnwrapped()),Je.u_tile_matrix=Float32Array.from(tt.globeMatrix),Je.u_up_vector=Ae),Je},pc=(v,r,h,x)=>({u_matrix:v,u_emissive_strength:r,u_opacity:h,u_color:x}),fu=(v,r,h,x,E,M,k,B,G)=>Object.assign((function(J,ee,ce,le,he,be){const{width:_e,height:ke}=le.imageManager.getPixelSize(ee),Ae=Math.pow(2,be.tileID.overscaledZ),Oe=be.tileSize*Math.pow(2,le.transform.tileZoom)/Ae,He=Oe*(be.tileID.canonical.x+be.tileID.wrap*Ae),Be=Oe*be.tileID.canonical.y;return{u_image:0,u_pattern_tl:ce.tl,u_pattern_br:ce.br,u_texsize:[_e,ke],u_pattern_size:ce.displaySize,u_pattern_units_to_pixels:he?[le.transform.width,-1*le.transform.height]:[1/t.ay(be,1,le.transform.tileZoom),1/t.ay(be,1,le.transform.tileZoom)],u_pixel_coord_upper:[He>>16,Be>>16],u_pixel_coord_lower:[65535&He,65535&Be]}})(0,M,k,x,B,G),{u_matrix:v,u_emissive_strength:r,u_opacity:h}),vr=new Float32Array(t.bA([])),Cr=(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he=[0,0,0],be,_e,ke)=>{const Ae=E.style.light,Oe=Ae.properties.get("position"),He=[-Oe.x,-Oe.y,Oe.z],Be=t.dO();Ae.properties.get("anchor")==="viewport"&&(t.dP(Be,-E.transform.angle),t.dQ(He,He,Be));const dt=ee.alphaMode==="MASK",nt=Ae.properties.get("color").toNonPremultipliedRenderColor(null),at=le.paint.get("model-ambient-occlusion-intensity"),tt=le.paint.get("model-color").constantOr(t.ao.white).toNonPremultipliedRenderColor(null);return tt.a=le.paint.get("model-color-mix-intensity").constantOr(0),ke&&(tt.r=ke[0],tt.g=ke[1],tt.b=ke[2],tt.a=ke[3]),_e&&(tt.r=_e.color.r,tt.g=_e.color.g,tt.b=_e.color.b,tt.a=_e.colorMix,ce=_e.emissionStrength,M*=_e.opacity),{u_matrix:v,u_lighting_matrix:r,u_normal_matrix:h,u_node_matrix:x||vr,u_lightpos:He,u_lightintensity:Ae.properties.get("intensity"),u_lightcolor:[nt.r,nt.g,nt.b],u_camera_pos:he,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+dt,u_alphaCutoff:ee.alphaCutoff,u_baseColorFactor:k.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:B.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:G,u_roughnessFactor:J,u_baseColorTexture:$a.BaseColor,u_metallicRoughnessTexture:$a.MetallicRoughness,u_normalTexture:$a.Normal,u_occlusionTexture:$a.Occlusion,u_emissionTexture:$a.Emission,u_lutTexture:$a.LUT,u_color_mix:tt.toArray01(),u_aoIntensity:at,u_emissive_strength:ce,u_occlusionTextureTransform:be||[0,0,0,0]}},bf=(v,r=vr,h=vr)=>({u_matrix:v,u_instance:r,u_node_matrix:h}),wf={fillExtrusion:v=>({u_matrix:new t.cl(v),u_lightpos:new t.ci(v),u_lightintensity:new t.cj(v),u_lightcolor:new t.ci(v),u_vertical_gradient:new t.cj(v),u_opacity:new t.cj(v),u_edge_radius:new t.cj(v),u_width_scale:new t.cj(v),u_ao:new t.ck(v),u_height_type:new t.ch(v),u_base_type:new t.ch(v),u_tile_id:new t.ci(v),u_zoom_transition:new t.cj(v),u_inv_rot_matrix:new t.cl(v),u_merc_center:new t.ck(v),u_up_dir:new t.ci(v),u_height_lift:new t.cj(v),u_flood_light_color:new t.ci(v),u_vertical_scale:new t.cj(v),u_flood_light_intensity:new t.cj(v),u_ground_shadow_factor:new t.ci(v)}),fillExtrusionDepth:v=>({u_matrix:new t.cl(v),u_edge_radius:new t.cj(v),u_width_scale:new t.cj(v),u_vertical_scale:new t.cj(v),u_height_type:new t.ch(v),u_base_type:new t.ch(v)}),fillExtrusionPattern:v=>({u_matrix:new t.cl(v),u_lightpos:new t.ci(v),u_lightintensity:new t.cj(v),u_lightcolor:new t.ci(v),u_vertical_gradient:new t.cj(v),u_height_factor:new t.cj(v),u_edge_radius:new t.cj(v),u_width_scale:new t.cj(v),u_ao:new t.ck(v),u_height_type:new t.ch(v),u_base_type:new t.ch(v),u_tile_id:new t.ci(v),u_zoom_transition:new t.cj(v),u_inv_rot_matrix:new t.cl(v),u_merc_center:new t.ck(v),u_up_dir:new t.ci(v),u_height_lift:new t.cj(v),u_image:new t.ch(v),u_texsize:new t.ck(v),u_pixel_coord_upper:new t.ck(v),u_pixel_coord_lower:new t.ck(v),u_tile_units_to_pixels:new t.cj(v),u_opacity:new t.cj(v),u_pattern_transition:new t.cj(v)}),fillExtrusionGroundEffect:v=>({u_matrix:new t.cl(v),u_opacity:new t.cj(v),u_ao_pass:new t.cj(v),u_meter_to_tile:new t.cj(v),u_ao:new t.ck(v),u_flood_light_intensity:new t.cj(v),u_flood_light_color:new t.ci(v),u_attenuation:new t.cj(v),u_edge_radius:new t.cj(v),u_fb:new t.ch(v),u_fb_size:new t.cj(v),u_dynamic_offset:new t.cj(v)}),fill:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_ground_shadow_factor:new t.ci(v)}),fillPattern:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_image:new t.ch(v),u_texsize:new t.ck(v),u_pixel_coord_upper:new t.ck(v),u_pixel_coord_lower:new t.ck(v),u_tile_units_to_pixels:new t.cj(v),u_ground_shadow_factor:new t.ci(v),u_pattern_transition:new t.cj(v)}),fillOutline:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_world:new t.ck(v),u_ground_shadow_factor:new t.ci(v)}),fillOutlinePattern:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_world:new t.ck(v),u_image:new t.ch(v),u_texsize:new t.ck(v),u_pixel_coord_upper:new t.ck(v),u_pixel_coord_lower:new t.ck(v),u_tile_units_to_pixels:new t.cj(v),u_ground_shadow_factor:new t.ci(v),u_pattern_transition:new t.cj(v)}),building:v=>({u_matrix:new t.cl(v),u_normal_matrix:new t.cl(v),u_opacity:new t.cj(v),u_faux_facade_ao_intensity:new t.cj(v),u_camera_pos:new t.ci(v),u_tile_to_meter:new t.cj(v),u_facade_emissive_chance:new t.cj(v),u_flood_light_color:new t.ci(v),u_flood_light_intensity:new t.cj(v)}),buildingBloom:v=>({u_matrix:new t.cl(v)}),buildingDepth:v=>({u_matrix:new t.cl(v)}),elevatedStructuresDepth:v=>({u_matrix:new t.cl(v),u_depth_bias:new t.cj(v)}),elevatedStructures:v=>({u_matrix:new t.cl(v),u_ground_shadow_factor:new t.ci(v)}),elevatedStructuresDepthReconstruct:v=>({u_matrix:new t.cl(v),u_camera_pos:new t.ci(v),u_depth_bias:new t.cj(v),u_height_scale:new t.cj(v),u_reset_depth:new t.cj(v)}),circle:t.dY,collisionBox:v=>({u_matrix:new t.cl(v),u_inv_rot_matrix:new t.cl(v),u_camera_to_center_distance:new t.cj(v),u_extrude_scale:new t.ck(v),u_zoom_transition:new t.cj(v),u_merc_center:new t.ck(v),u_tile_id:new t.ci(v)}),collisionCircle:v=>({u_matrix:new t.cl(v),u_inv_matrix:new t.cl(v),u_camera_to_center_distance:new t.cj(v),u_viewport_size:new t.ck(v)}),debug:v=>({u_color:new t.dB(v),u_matrix:new t.cl(v),u_overlay:new t.ch(v),u_overlay_scale:new t.cj(v)}),clippingMask:v=>({u_matrix:new t.cl(v)}),heatmap:v=>({u_extrude_scale:new t.cj(v),u_intensity:new t.cj(v),u_matrix:new t.cl(v),u_inv_rot_matrix:new t.cl(v),u_merc_center:new t.ck(v),u_tile_id:new t.ci(v),u_zoom_transition:new t.cj(v),u_up_dir:new t.ci(v)}),heatmapTexture:v=>({u_image:new t.ch(v),u_color_ramp:new t.ch(v),u_opacity:new t.cj(v)}),hillshade:v=>({u_matrix:new t.cl(v),u_image:new t.ch(v),u_latrange:new t.ck(v),u_light:new t.ck(v),u_shadow:new t.dB(v),u_highlight:new t.dB(v),u_emissive_strength:new t.cj(v),u_accent:new t.dB(v)}),hillshadePrepare:v=>({u_matrix:new t.cl(v),u_image:new t.ch(v),u_dimension:new t.ck(v),u_zoom:new t.cj(v)}),line:t.dX,linePattern:t.dW,raster:v=>({u_matrix:new t.cl(v),u_normalize_matrix:new t.cl(v),u_globe_matrix:new t.cl(v),u_merc_matrix:new t.cl(v),u_grid_matrix:new t.dC(v),u_tl_parent:new t.ck(v),u_scale_parent:new t.cj(v),u_fade_t:new t.cj(v),u_opacity:new t.cj(v),u_image0:new t.ch(v),u_image1:new t.ch(v),u_brightness_low:new t.cj(v),u_brightness_high:new t.cj(v),u_saturation_factor:new t.cj(v),u_contrast_factor:new t.cj(v),u_spin_weights:new t.ci(v),u_perspective_transform:new t.ck(v),u_raster_elevation:new t.cj(v),u_zoom_transition:new t.cj(v),u_merc_center:new t.ck(v),u_cutoff_params:new t.d3(v),u_colorization_mix:new t.d3(v),u_colorization_offset:new t.cj(v),u_color_ramp:new t.ch(v),u_texture_offset:new t.ck(v),u_texture_res:new t.ck(v),u_emissive_strength:new t.cj(v)}),rasterParticle:v=>({u_matrix:new t.cl(v),u_normalize_matrix:new t.cl(v),u_globe_matrix:new t.cl(v),u_merc_matrix:new t.cl(v),u_grid_matrix:new t.dC(v),u_tl_parent:new t.ck(v),u_scale_parent:new t.cj(v),u_fade_t:new t.cj(v),u_opacity:new t.cj(v),u_image0:new t.ch(v),u_image1:new t.ch(v),u_raster_elevation:new t.cj(v),u_zoom_transition:new t.cj(v),u_merc_center:new t.ck(v),u_cutoff_params:new t.d3(v)}),rasterParticleTexture:v=>({u_texture:new t.ch(v),u_opacity:new t.cj(v)}),rasterParticleDraw:v=>({u_particle_texture:new t.ch(v),u_particle_texture_side_len:new t.cj(v),u_tile_offset:new t.ck(v),u_velocity:new t.ch(v),u_color_ramp:new t.ch(v),u_velocity_res:new t.ck(v),u_max_speed:new t.cj(v),u_uv_offset:new t.ck(v),u_data_scale:new t.ck(v),u_data_offset:new t.cj(v),u_particle_pos_scale:new t.cj(v),u_particle_pos_offset:new t.ck(v)}),rasterParticleUpdate:v=>({u_particle_texture:new t.ch(v),u_particle_texture_side_len:new t.cj(v),u_velocity:new t.ch(v),u_velocity_res:new t.ck(v),u_max_speed:new t.cj(v),u_speed_factor:new t.cj(v),u_reset_rate:new t.cj(v),u_rand_seed:new t.cj(v),u_uv_offset:new t.ck(v),u_data_scale:new t.ck(v),u_data_offset:new t.cj(v),u_particle_pos_scale:new t.cj(v),u_particle_pos_offset:new t.ck(v)}),symbol:v=>({u_is_size_zoom_constant:new t.ch(v),u_is_size_feature_constant:new t.ch(v),u_size_t:new t.cj(v),u_size:new t.cj(v),u_camera_to_center_distance:new t.cj(v),u_rotate_symbol:new t.ch(v),u_aspect_ratio:new t.cj(v),u_fade_change:new t.cj(v),u_matrix:new t.cl(v),u_label_plane_matrix:new t.cl(v),u_coord_matrix:new t.cl(v),u_is_text:new t.ch(v),u_elevation_from_sea:new t.ch(v),u_pitch_with_map:new t.ch(v),u_texsize:new t.ck(v),u_texsize_icon:new t.ck(v),u_texture:new t.ch(v),u_texture_icon:new t.ch(v),u_gamma_scale:new t.cj(v),u_device_pixel_ratio:new t.cj(v),u_tile_id:new t.ci(v),u_zoom_transition:new t.cj(v),u_inv_rot_matrix:new t.cl(v),u_merc_center:new t.ck(v),u_camera_forward:new t.ci(v),u_tile_matrix:new t.cl(v),u_up_vector:new t.ci(v),u_ecef_origin:new t.ci(v),u_is_halo:new t.ch(v),u_icon_transition:new t.cj(v),u_color_adj_mat:new t.cl(v),u_scale_factor:new t.cj(v),u_ground_shadow_factor:new t.ci(v),u_inv_matrix:new t.cl(v),u_normal_scale:new t.cj(v),u_lutTexture:new t.ch(v)}),background:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_opacity:new t.cj(v),u_color:new t.dB(v)}),backgroundPattern:v=>({u_matrix:new t.cl(v),u_emissive_strength:new t.cj(v),u_opacity:new t.cj(v),u_image:new t.ch(v),u_pattern_tl:new t.ck(v),u_pattern_br:new t.ck(v),u_texsize:new t.ck(v),u_pattern_size:new t.ck(v),u_pixel_coord_upper:new t.ck(v),u_pixel_coord_lower:new t.ck(v),u_pattern_units_to_pixels:new t.ck(v)}),terrainRaster:v=>({u_matrix:new t.cl(v),u_image0:new t.ch(v),u_image1:new t.ch(v),u_skirt_height:new t.cj(v),u_ground_shadow_factor:new t.ci(v),u_emissive_texture_available:new t.cj(v)}),skybox:v=>({u_matrix:new t.cl(v),u_sun_direction:new t.ci(v),u_cubemap:new t.ch(v),u_opacity:new t.cj(v),u_temporal_offset:new t.cj(v)}),skyboxGradient:v=>({u_matrix:new t.cl(v),u_color_ramp:new t.ch(v),u_center_direction:new t.ci(v),u_radius:new t.cj(v),u_opacity:new t.cj(v),u_temporal_offset:new t.cj(v)}),skyboxCapture:v=>({u_matrix_3f:new t.dC(v),u_sun_direction:new t.ci(v),u_sun_intensity:new t.cj(v),u_color_tint_r:new t.d3(v),u_color_tint_m:new t.d3(v),u_luminance:new t.cj(v)}),globeRaster:v=>({u_proj_matrix:new t.cl(v),u_globe_matrix:new t.cl(v),u_normalize_matrix:new t.cl(v),u_merc_matrix:new t.cl(v),u_zoom_transition:new t.cj(v),u_merc_center:new t.ck(v),u_image0:new t.ch(v),u_image1:new t.ch(v),u_grid_matrix:new t.dC(v),u_skirt_height:new t.cj(v),u_far_z_cutoff:new t.cj(v),u_frustum_tl:new t.ci(v),u_frustum_tr:new t.ci(v),u_frustum_br:new t.ci(v),u_frustum_bl:new t.ci(v),u_globe_pos:new t.ci(v),u_globe_radius:new t.cj(v),u_viewport:new t.ck(v),u_emissive_texture_available:new t.cj(v)}),globeAtmosphere:v=>({u_frustum_tl:new t.ci(v),u_frustum_tr:new t.ci(v),u_frustum_br:new t.ci(v),u_frustum_bl:new t.ci(v),u_horizon:new t.cj(v),u_transition:new t.cj(v),u_fadeout_range:new t.cj(v),u_atmosphere_fog_color:new t.d3(v),u_high_color:new t.d3(v),u_space_color:new t.d3(v),u_temporal_offset:new t.cj(v),u_horizon_angle:new t.cj(v)}),model:v=>({u_matrix:new t.cl(v),u_lighting_matrix:new t.cl(v),u_normal_matrix:new t.cl(v),u_node_matrix:new t.cl(v),u_lightpos:new t.ci(v),u_lightintensity:new t.cj(v),u_lightcolor:new t.ci(v),u_camera_pos:new t.ci(v),u_opacity:new t.cj(v),u_baseColorFactor:new t.d3(v),u_emissiveFactor:new t.d3(v),u_metallicFactor:new t.cj(v),u_roughnessFactor:new t.cj(v),u_baseTextureIsAlpha:new t.ch(v),u_alphaMask:new t.ch(v),u_alphaCutoff:new t.cj(v),u_baseColorTexture:new t.ch(v),u_metallicRoughnessTexture:new t.ch(v),u_normalTexture:new t.ch(v),u_occlusionTexture:new t.ch(v),u_emissionTexture:new t.ch(v),u_lutTexture:new t.ch(v),u_color_mix:new t.d3(v),u_aoIntensity:new t.cj(v),u_emissive_strength:new t.cj(v),u_occlusionTextureTransform:new t.d3(v)}),modelDepth:v=>({u_matrix:new t.cl(v),u_instance:new t.cl(v),u_node_matrix:new t.cl(v)}),groundShadow:v=>({u_matrix:new t.cl(v),u_ground_shadow_factor:new t.ci(v)}),stars:v=>({u_matrix:new t.cl(v),u_up:new t.ci(v),u_right:new t.ci(v),u_intensity_multiplier:new t.cj(v)}),snowParticle:v=>({u_modelview:new t.cl(v),u_projection:new t.cl(v),u_time:new t.cj(v),u_cam_pos:new t.ci(v),u_velocityConeAperture:new t.cj(v),u_velocity:new t.cj(v),u_horizontalOscillationRadius:new t.cj(v),u_horizontalOscillationRate:new t.cj(v),u_boxSize:new t.cj(v),u_billboardSize:new t.cj(v),u_simpleShapeParameters:new t.ck(v),u_screenSize:new t.ck(v),u_thinningCenterPos:new t.ck(v),u_thinningShape:new t.ci(v),u_thinningAffectedRatio:new t.cj(v),u_thinningParticleOffset:new t.cj(v),u_particleColor:new t.d3(v),u_direction:new t.ci(v)}),rainParticle:v=>({u_modelview:new t.cl(v),u_projection:new t.cl(v),u_time:new t.cj(v),u_cam_pos:new t.ci(v),u_texScreen:new t.ch(v),u_velocityConeAperture:new t.cj(v),u_velocity:new t.cj(v),u_boxSize:new t.cj(v),u_rainDropletSize:new t.ck(v),u_distortionStrength:new t.cj(v),u_rainDirection:new t.ci(v),u_color:new t.d3(v),u_screenSize:new t.ck(v),u_thinningCenterPos:new t.ck(v),u_thinningShape:new t.ci(v),u_thinningAffectedRatio:new t.cj(v),u_thinningParticleOffset:new t.cj(v),u_shapeDirectionalPower:new t.cj(v),u_shapeNormalPower:new t.cj(v),u_mode:new t.cj(v)}),vignette:v=>({u_vignetteShape:new t.ci(v),u_vignetteColor:new t.d3(v)}),occlusion:v=>({u_matrix:new t.cl(v),u_anchorPos:new t.ci(v),u_screenSizePx:new t.ck(v),u_occluderSizePx:new t.ck(v),u_color:new t.d3(v)})};class Cc{constructor(r,h,x,E){this.id=Cc.uniqueIdxCounter,Cc.uniqueIdxCounter++,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||E||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=Cc.uniqueIdxCounter,Cc.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Cc.uniqueIdxCounter=0;const Nl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zc{constructor(r,h,x,E,M,k){this.length=h.length,this.attributes=x,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.instanceCount=k,this.context=r;const B=r.gl;this.buffer=B.createBuffer(),r.bindVertexBuffer.set(this.buffer),B.bufferData(B.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||M||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let x=0;x<this.attributes.length;x++){const E=h.getAttributeLocation(r,this.attributes[x].name);E!==-1&&r.enableVertexAttribArray(E)}}setVertexAttribPointers(r,h,x){for(let E=0;E<this.attributes.length;E++){const M=this.attributes[E],k=h.getAttributeLocation(r,M.name);k!==-1&&r.vertexAttribPointer(k,M.components,r[Nl[M.type]],!1,this.itemSize,M.offset+this.itemSize*(x||0))}}setVertexAttribDivisor(r,h,x){for(let E=0;E<this.attributes.length;E++){const M=h.getAttributeLocation(r,this.attributes[E].name);M!==-1&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(M,x)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ym{constructor(r,h,x,E,M){this.context=r,this.width=h,this.height=x;const k=this.framebuffer=r.gl.createFramebuffer();E>0&&(this.colorAttachment0=new ep(r,k,0)),E>1&&(this.colorAttachment1=new ep(r,k,1)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new Pd(r,k):new tp(r,k))}createColorAttachment(r,h){h===0?this.colorAttachment0=new ep(r,this.framebuffer,0):h===1&&(this.colorAttachment1=new ep(r,this.framebuffer,1))}removeColorAttachment(r,h){const x=this.context.gl;let E;h===0?(E=this.colorAttachment0.get(),this.colorAttachment0=void 0):h===1&&(E=this.colorAttachment1.get(),this.colorAttachment1=void 0),E&&x.deleteTexture(E)}destroy(){const r=this.context.gl;if(this.colorAttachment0){const h=this.colorAttachment0.get();h&&r.deleteTexture(h)}if(this.colorAttachment1){const h=this.colorAttachment1.get();h&&r.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&r.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&r.deleteTexture(h)}r.deleteFramebuffer(this.framebuffer)}}class Tf{constructor(r,h){this.gl=r,this.clearColor=new m0(this),this.clearDepth=new Xf(this),this.clearStencil=new $g(this),this.colorMask=new jp(this),this.depthMask=new ff(this),this.stencilMask=new ah(this),this.stencilFunc=new pf(this),this.stencilOp=new Yf(this),this.stencilTest=new lh(this),this.depthRange=new Up(this),this.depthTest=new $m(this),this.depthFunc=new Gg(this),this.blend=new ta(this),this.blendFunc=new ch(this),this.blendColor=new Jl(this),this.blendEquation=new Kf(this),this.cullFace=new Id(this),this.cullFaceSide=new Cd(this),this.frontFace=new Nh(this),this.program=new Jf(this),this.activeTexture=new Ad(this),this.viewport=new Ru(this),this.bindFramebuffer=new qg(this),this.bindRenderbuffer=new oy(this),this.bindTexture=new ay(this),this.bindVertexBuffer=new ly(this),this.bindElementBuffer=new Gm(this),this.bindVertexArrayOES=new uh(this),this.pixelStoreUnpack=new $p(this),this.pixelStoreUnpackPremultiplyAlpha=new Gp(this),this.pixelStoreUnpackFlipY=new Qf(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=r.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h,x){return new Cc(this,r,h,x)}createVertexBuffer(r,h,x,E,M){return new Zc(this,r,h,x,E,M)}createRenderbuffer(r,h,x){const E=this.gl,M=E.createRenderbuffer();return this.bindRenderbuffer.set(M),E.renderbufferStorage(E.RENDERBUFFER,r,h,x),this.bindRenderbuffer.set(null),M}createFramebuffer(r,h,x,E){return new Ym(this,r,h,x,E)}clear({color:r,depth:h,stencil:x,colorMask:E}){const M=this.gl;let k=0;r&&(k|=M.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(E||[!0,!0,!0,!0])),h!==void 0&&(k|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),x!==void 0&&(k|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),M.clear(k)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){t.by(r.blendFunction,yr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Sf;function Cn(v,r,h,x,E,M,k){const B=v.context,G=B.gl,J=v.transform,ee=[t.aF(J.center.lng),t.aJ(J.center.lat)],ce=h.layout.get("symbol-placement"),le=h.layout.get("text-variable-anchor"),he=h.layout.get("icon-rotation-alignment")==="map",be=h.layout.get("text-rotation-alignment")==="map",_e=ce!=="point",ke=[];let Ae=0,Oe=0;for(let Je=0;Je<x.length;Je++){const mt=x[Je],Pt=r.getTile(mt),It=Pt.getBucket(h);if(!It)continue;const ri=It.getProjection().createInversionMatrix(J,mt.canonical),si=[],_i=Rh(mt,It,J),Vi=!k&&he&&_e,Kt=k&&be&&_e,bt=le&&It.hasTextData(),oi=It.hasIconTextFit()&&bt&&It.hasIconData(),ni=Vi||Kt||k&&bt||oi,Li=It.projection.name==="globe",en=Li?t.aj(J.zoom):0;Li&&(si.push("PROJECTION_GLOBE_VIEW"),ni&&si.push("PROJECTED_POS_ON_VIEWPORT"));const xn=v.getOrCreateProgram("collisionBox",{defines:si});let Yi=_i;E[0]===0&&E[1]===0||(Yi=v.translatePosMatrix(_i,Pt,E,M));const Wi=k?It.textCollisionBox:It.iconCollisionBox,kn=It.collisionCircleArray;if(kn.length>0){const pn=t.bC(),Tn=Yi;t.cP(pn,It.placementInvProjMatrix,J.glCoordMatrix),t.cP(pn,pn,It.placementViewportMatrix),ke.push({circleArray:kn,circleOffset:Oe,transform:Tn,invTransform:pn,projection:It.getProjection()}),Ae+=kn.length/4,Oe=Ae}if(!Wi)continue;v.terrain&&v.terrain.setupElevationDraw(Pt,xn);const Pn=Li?[mt.canonical.x,mt.canonical.y,1<<mt.canonical.z]:[0,0,0];xn.draw(v,G.LINES,zn.disabled,sr.disabled,v.colorModeForRenderPass(),pr.disabled,Wm(Yi,ri,J,en,ee,Pt,Pn,It.getProjection()),h.id,Wi.layoutVertexBuffer,Wi.indexBuffer,Wi.segments,null,J.zoom,null,[Wi.collisionVertexBuffer,Wi.collisionVertexBufferExt])}if(!k||!ke.length)return;const He=v.getOrCreateProgram("collisionCircle"),Be=new t.dZ;Be.resize(4*Ae),Be._trim();let dt=0;for(const Je of ke)for(let mt=0;mt<Je.circleArray.length/4;mt++){const Pt=4*mt,It=Je.circleArray[Pt+0],ri=Je.circleArray[Pt+1],si=Je.circleArray[Pt+2],_i=Je.circleArray[Pt+3];Be.emplace(dt++,It,ri,si,_i,0),Be.emplace(dt++,It,ri,si,_i,1),Be.emplace(dt++,It,ri,si,_i,2),Be.emplace(dt++,It,ri,si,_i,3)}(!Sf||Sf.length<2*Ae)&&(Sf=(function(Je){const mt=2*Je,Pt=new t.b0;Pt.resize(mt),Pt._trim();for(let It=0;It<mt;It++){const ri=6*It;Pt.uint16[ri+0]=4*It+0,Pt.uint16[ri+1]=4*It+1,Pt.uint16[ri+2]=4*It+2,Pt.uint16[ri+3]=4*It+2,Pt.uint16[ri+4]=4*It+3,Pt.uint16[ri+5]=4*It+0}return Pt})(Ae));const nt=B.createIndexBuffer(Sf,!0),at=B.createVertexBuffer(Be,t.d_.members,!0);for(const Je of ke){const mt={u_matrix:Je.transform,u_inv_matrix:Je.invTransform,u_camera_to_center_distance:(tt=J).getCameraToCenterDistance(Je.projection),u_viewport_size:[tt.width,tt.height]};He.draw(v,G.TRIANGLES,zn.disabled,sr.disabled,v.colorModeForRenderPass(),pr.disabled,mt,h.id,at,nt,t.bg.simpleSegment(0,2*Je.circleOffset,Je.circleArray.length,Je.circleArray.length/2),null,J.zoom)}var tt;at.destroy(),nt.destroy()}const $h=t.bC();function So(v){const r=v._camera.getWorldToCamera(v.worldSize,1),h=t.aB([],r,v.globeMatrix);t.bl(h,h);const x=[0,0,0],E=[0,1,0,0];return t.aC(E,E,h),x[0]=E[0],x[1]=E[1],x[2]=E[2],t.aw(x,x),x}function Yo({width:v,height:r,anchor:h,textOffset:x,textScale:E},M){const{horizontalAlign:k,verticalAlign:B}=t.c1(h),G=-(k-.5)*v,J=-(B-.5)*r,ee=t.c2(h,x);return new t.P((G/E+ee[0])*M,(J/E+ee[1])*M)}function Hn(v,r,h,x,E,M,k,B,G,J){const ee=v.text.placedSymbolArray,ce=v.text.dynamicLayoutVertexArray,le=v.icon.dynamicLayoutVertexArray,he={},be=v.getProjection(),_e=Cs(k,be,E),ke=E.elevation,Ae=be.upVectorScale(k.canonical,E.center.lat,E.worldSize).metersToTile;ce.clear();for(let Oe=0;Oe<ee.length;Oe++){const He=ee.get(Oe),{tileAnchorX:Be,tileAnchorY:dt,numGlyphs:nt}=He,at=He.hidden||!He.crossTileID||v.allowVerticalPlacement&&!He.placedOrientation?null:x[He.crossTileID];if(at){let tt=0,Je=0,mt=0;const Pt=v.elevationType==="road";if(ke||Pt){const ni=Pt?v.getElevationFeatureForText(Oe):null,Li=t.bV.getAtTileOffset(k,new t.P(Be,dt),ke,ni),[en,xn,Yi]=be.upVector(k.canonical,Be,dt);tt=Li*en*Ae,Je=Li*xn*Ae,mt=Li*Yi*Ae}let[It,ri,si,_i]=Uc(He.projectedAnchorX+tt,He.projectedAnchorY+Je,He.projectedAnchorZ+mt,h?_e:M);const Vi=ps(E.getCameraToCenterDistance(be),_i);let Kt=t.bM(v.textSizeData,G,He)*Vi/t.bY;h&&(Kt*=v.tilePixelRatio/B);const bt=Yo(at,Kt);h?({x:It,y:ri,z:si}=be.projectTilePoint(Be+bt.x,dt+bt.y,k.canonical),[It,ri,si]=Uc(It+tt,ri+Je,si+mt,M)):(r&&bt._rotate(-E.angle),It+=bt.x,ri+=bt.y,si=0);const oi=v.allowVerticalPlacement&&He.placedOrientation===t.bL.vertical?Math.PI/2:0;for(let ni=0;ni<nt;ni++)t.bO(ce,It,ri,si,oi);J&&He.associatedIconIndex>=0&&(he[He.associatedIconIndex]={x:It,y:ri,z:si,angle:oi})}else dc(nt,ce)}if(J){le.clear();const Oe=v.icon.placedSymbolArray;for(let He=0;He<Oe.length;He++){const Be=Oe.get(He),{numGlyphs:dt}=Be,nt=he[He];if(Be.hidden||!nt)dc(dt,le);else{const{x:at,y:tt,z:Je,angle:mt}=nt;for(let Pt=0;Pt<dt;Pt++)t.bO(le,at,tt,Je,mt)}}v.icon.dynamicLayoutVertexBuffer.updateData(le)}v.text.dynamicLayoutVertexBuffer.updateData(ce)}function Gh(v,r,h,x,E,M,k={}){const B=h.paint.get("icon-translate"),G=h.paint.get("text-translate"),J=h.paint.get("icon-translate-anchor"),ee=h.paint.get("text-translate-anchor"),ce=h.layout.get("icon-rotation-alignment"),le=h.layout.get("text-rotation-alignment"),he=h.layout.get("icon-pitch-alignment"),be=h.layout.get("text-pitch-alignment"),_e=h.layout.get("icon-keep-upright"),ke=h.layout.get("text-keep-upright"),Ae=h.paint.get("icon-color-saturation"),Oe=h.paint.get("icon-color-contrast"),He=h.paint.get("icon-color-brightness-min"),Be=h.paint.get("icon-color-brightness-max"),dt=h.layout.get("symbol-elevation-reference")==="sea",nt=h.layout.get("icon-image-use-theme")==="none",at=v.context,tt=at.gl,Je=v.transform,mt=ce==="map",Pt=le==="map",It=he==="map",ri=be==="map",si=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let _i=!1;const Vi=v.depthModeForSublayer(0,zn.ReadOnly),Kt=new zn(v.context.gl.LEQUAL,zn.ReadOnly,v.depthRangeFor3D),bt=[t.aF(Je.center.lng),t.aJ(Je.center.lat)],oi=h.layout.get("text-variable-anchor"),ni=Je.projection.name==="globe",Li=[],en=[0,-1,0];for(const xn of x){const Yi=r.getTile(xn),Wi=Yi.getBucket(h);if(!Wi||Wi.projection.name==="mercator"&&ni||Wi.fullyClipped)continue;const kn=Wi.projection.name==="globe",Pn=kn?t.aj(Je.zoom):0,pn=Cs(xn,Wi.getProjection(),Je),Tn=Je.calculatePixelsToTileUnitsMatrix(Yi),Kn=oi&&Wi.hasTextData(),Er=Wi.hasIconTextFit()&&Kn&&Wi.hasIconData(),ts=Wi.getProjection().createInversionMatrix(Je,xn.canonical),ys=(1<<Yi.tileID.canonical.z)*t.al/v.transform.worldSize,Ln=Ms=>{let cs=[0,0,0];if(Ms){const Pr=v.style.directionalLight,co=v.style.ambientLight;Pr&&co&&(cs=sh(v.style,Pr,co))}return cs},fs=Ms=>{Je.depthOcclusionForSymbolsAndCircles&&(h.hasOcclusionOpacityProperties||v.terrain)&&(Ms.push("DEPTH_D24"),Ms.push("DEPTH_OCCLUSION"))},br=Ms=>{h.lut&&!nt&&(h.lut.texture||(h.lut.texture=new t.d$(v.context,h.lut.image,[h.lut.image.height,h.lut.image.height,h.lut.image.height],at.gl.RGBA8)),at.activeTexture.set(at.gl.TEXTURE0+$a.LUT),h.lut.texture&&h.lut.texture.bind(at.gl.LINEAR,at.gl.CLAMP_TO_EDGE),Ms.push("APPLY_LUT_ON_GPU"))},Ts=()=>{const Ms=mt&&h.layout.get("symbol-placement")!=="point",cs=[];fs(cs),br(cs);const Pr=Ms||Er,co=Wi.elevationType==="road",Ss=v.shadowRenderer,uo=co&&It&&!!Ss&&Ss.enabled,Zs=Ln(uo),kc=co&&It&&!v.terrain?Kt:Vi,Dl=h.paint.get("icon-image-cross-fade");v.terrainRenderModeElevated()&&It&&cs.push("PITCH_WITH_MAP_TERRAIN"),kn&&(cs.push("PROJECTION_GLOBE_VIEW"),Pr&&cs.push("PROJECTED_POS_ON_VIEWPORT")),Dl>0&&Wi.hasAnySecondaryIcon&&cs.push("ICON_TRANSITION"),!Wi.icon.zOffsetVertexBuffer||co&&v.terrain||cs.push("Z_OFFSET"),Ae===0&&Oe===0&&He===0&&Be===1||cs.push("COLOR_ADJUSTMENT"),Wi.sdfIcons&&cs.push("RENDER_SDF"),uo&&cs.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),co&&It&&!v.terrain&&Wi.icon.orientationVertexBuffer&&cs.push("ELEVATED_ROADS");const Fa=Wi.icon.programConfigurations.get(h.id),ec=v.getOrCreateProgram("symbol",{config:Fa,defines:cs}),Ul=Yi.imageAtlasTexture?Yi.imageAtlasTexture.size:[0,0],Tl=Wi.iconSizeData,tc=t.bK(Tl,Je.zoom),vu=It||!Je.isOrthographic,Dc=Jo(pn,Yi.tileID.canonical,It,mt,Je,Wi.getProjection(),Tn),Do=au(pn,Yi.tileID.canonical,It,mt,Je,Wi.getProjection(),Tn),Go=v.translatePosMatrix(Do,Yi,B,J,!0),Ds=v.translatePosMatrix(pn,Yi,B,J),la=Pr?$h:Dc,Lo=mt&&!It&&!Ms;let Io=en;!ni&&!Je.mercatorFromTransition||mt||(Io=So(Je));const vh=kn?Io:en,h_=h.getColorAdjustmentMatrix(Ae,Oe,He,Be),Xh=Zp(Tl.kind,tc,Lo,It,v,Ds,la,Go,dt,!1,Ul,[0,0],0,xn,Pn,bt,ts,vh,Wi.getProjection(),Zs,ys,h_,Dl,null),d_=Yi.imageAtlasTexture?Yi.imageAtlasTexture:null,ug=h.layout.get("icon-size").constantOr(0)!==1||Wi.iconsNeedLinear,Od=Wi.sdfIcons||v.options.rotating||v.options.zooming||ug||vu?tt.LINEAR:tt.NEAREST,Mf=Wi.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,hg=v.terrain&&It&&Ms?t.bl(t.bC(),Dc):$h;if(Ms&&Wi.icon){const mp=t.bV.getAtTileOffsetFunc(xn,Je.center.lat,Je.worldSize,Wi.getProjection()),kf=zh(pn,Yi.tileID.canonical,It,mt,Je,Wi.getProjection(),Tn),xh=h.layout.get("icon-size-scale-range"),Yh=t.aA(v.scaleFactor,xh[0],xh[1]);sy(Wi,pn,v,!1,kf,Do,It,_e,mp,xn,Yh)}return{program:ec,buffers:Wi.icon,uniformValues:Xh,atlasTexture:d_,atlasTextureIcon:null,atlasInterpolation:Od,atlasInterpolationIcon:null,isSDF:Wi.sdfIcons,hasHalo:Mf,depthMode:kc,tile:Yi,renderWithShadows:uo,labelPlaneMatrixInv:hg}},zs=()=>{const Ms=Pt&&h.layout.get("symbol-placement")!=="point",cs=[],Pr=Ms||oi||Er,co=Wi.elevationType==="road",Ss=v.shadowRenderer,uo=co&&ri&&!!Ss&&Ss.enabled,Zs=Ln(uo),kc=co&&ri&&!v.terrain?Kt:Vi;v.terrainRenderModeElevated()&&ri&&cs.push("PITCH_WITH_MAP_TERRAIN"),kn&&(cs.push("PROJECTION_GLOBE_VIEW"),Pr&&cs.push("PROJECTED_POS_ON_VIEWPORT")),!Wi.text.zOffsetVertexBuffer||co&&v.terrain||cs.push("Z_OFFSET"),Wi.iconsInText&&cs.push("RENDER_TEXT_AND_SYMBOL"),cs.push("RENDER_SDF"),uo&&cs.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),co&&ri&&!v.terrain&&Wi.text.orientationVertexBuffer&&cs.push("ELEVATED_ROADS"),fs(cs);const Dl=Wi.text.programConfigurations.get(h.id),Fa=v.getOrCreateProgram("symbol",{config:Dl,defines:cs});let ec,Ul=[0,0],Tl=null;const tc=Wi.textSizeData;Wi.iconsInText&&(Ul=Yi.imageAtlasTexture?Yi.imageAtlasTexture.size:[0,0],Tl=Yi.imageAtlasTexture?Yi.imageAtlasTexture:null,ec=ri||!Je.isOrthographic||v.options.rotating||v.options.zooming||tc.kind==="composite"||tc.kind==="camera"?tt.LINEAR:tt.NEAREST);const vu=Yi.glyphAtlasTexture?Yi.glyphAtlasTexture.size:[0,0],Dc=h.layout.get("text-size-scale-range"),Do=t.aA(v.scaleFactor,Dc[0],Dc[1]),Go=t.bK(tc,Je.zoom,Do),Ds=Jo(pn,Yi.tileID.canonical,ri,Pt,Je,Wi.getProjection(),Tn),la=au(pn,Yi.tileID.canonical,ri,Pt,Je,Wi.getProjection(),Tn),Lo=v.translatePosMatrix(la,Yi,G,ee,!0),Io=v.translatePosMatrix(pn,Yi,G,ee),vh=Pr?$h:Ds,h_=Pt&&!ri&&!Ms;let Xh=en;!ni&&!Je.mercatorFromTransition||Pt||(Xh=So(Je));const d_=Zp(tc.kind,Go,h_,ri,v,Io,vh,Lo,dt,!0,vu,Ul,0,xn,Pn,bt,ts,kn?Xh:en,Wi.getProjection(),Zs,ys,null,null,Do),ug=Yi.glyphAtlasTexture?Yi.glyphAtlasTexture:null,Od=tt.LINEAR,Mf=h.paint.get("text-halo-width").constantOr(1)!==0,hg=v.terrain&&ri&&Ms?t.bl(t.bC(),Ds):$h;if(Ms&&Wi.text){const mp=t.bV.getAtTileOffsetFunc(xn,Je.center.lat,Je.worldSize,Wi.getProjection()),kf=zh(pn,Yi.tileID.canonical,ri,Pt,Je,Wi.getProjection(),Tn);sy(Wi,pn,v,!0,kf,la,ri,ke,mp,xn,Do)}return{program:Fa,buffers:Wi.text,uniformValues:d_,atlasTexture:ug,atlasTextureIcon:Tl,atlasInterpolation:Od,atlasInterpolationIcon:ec,isSDF:!0,hasHalo:Mf,depthMode:kc,tile:Yi,renderWithShadows:uo,labelPlaneMatrixInv:hg}},Os=Wi.icon.segments.get().length,ls=Wi.text.segments.get().length,Ar=Os&&!k.onlyText?Ts():null,vs=ls&&!k.onlyIcons?zs():null,ko=h.paint.get("icon-opacity").constantOr(1),yo=h.paint.get("text-opacity").constantOr(1);if(si&&Wi.canOverlap){_i=!0;const Ms=ko&&!k.onlyText?Wi.icon.segments.get():[],cs=yo&&!k.onlyIcons?Wi.text.segments.get():[];for(const Pr of Ms)Li.push({segments:new t.bg([Pr]),sortKey:Pr.sortKey,state:Ar});for(const Pr of cs)Li.push({segments:new t.bg([Pr]),sortKey:Pr.sortKey,state:vs})}else k.onlyText||Li.push({segments:ko?Wi.icon.segments:new t.bg([]),sortKey:0,state:Ar}),k.onlyIcons||Li.push({segments:yo?Wi.text.segments:new t.bg([]),sortKey:0,state:vs})}_i&&Li.sort(((xn,Yi)=>xn.sortKey-Yi.sortKey));for(const xn of Li){const Yi=xn.state;if(Yi)if(v.terrain?v.terrain.setupElevationDraw(Yi.tile,Yi.program,{useDepthForOcclusion:Je.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Yi.labelPlaneMatrixInv}):v.setupDepthForOcclusion(Je.depthOcclusionForSymbolsAndCircles,Yi.program),at.activeTexture.set(tt.TEXTURE0),Yi.atlasTexture&&Yi.atlasTexture.bind(Yi.atlasInterpolation,tt.CLAMP_TO_EDGE,!0),Yi.atlasTextureIcon&&(at.activeTexture.set(tt.TEXTURE1),Yi.atlasTextureIcon&&Yi.atlasTextureIcon.bind(Yi.atlasInterpolationIcon,tt.CLAMP_TO_EDGE,!0)),Yi.renderWithShadows&&v.shadowRenderer.setupShadows(Yi.tile.tileID.toUnwrapped(),Yi.program,"vector-tile"),v.uploadCommonLightUniforms(v.context,Yi.program),Yi.hasHalo){const Wi=Yi.uniformValues;Wi.u_is_halo=1,cp(Yi.buffers,xn.segments,h,v,Yi.program,Yi.depthMode,E,M,Wi,2),Wi.u_is_halo=0}else{if(Yi.isSDF){const Wi=Yi.uniformValues;Yi.hasHalo&&(Wi.u_is_halo=1,cp(Yi.buffers,xn.segments,h,v,Yi.program,Yi.depthMode,E,M,Wi,1)),Wi.u_is_halo=0}cp(Yi.buffers,xn.segments,h,v,Yi.program,Yi.depthMode,E,M,Yi.uniformValues,1)}}}function cp(v,r,h,x,E,M,k,B,G,J){const ee=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.iconTransitioningVertexBuffer,v.globeExtVertexBuffer,v.zOffsetVertexBuffer,v.orientationVertexBuffer];E.draw(x,x.context.gl.TRIANGLES,M,k,B,pr.disabled,G,h.id,v.layoutVertexBuffer,v.indexBuffer,r,h.paint,x.transform.zoom,v.programConfigurations.get(h.id),ee,J)}function Km(v,r){const h=1<<v.canonical.z,x=(r.x*h-v.canonical.x-v.wrap*h)*t.al,E=(r.y*h-v.canonical.y)*t.al,M=t.e8(r.z,r.y);return t.d5(x,E,M)}function Ef(v,r,h,x,E){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const M=v.context.gl,k=new zn(v.context.gl.LEQUAL,zn.ReadWrite,v.depthRangeFor3D),B=new zn(v.context.gl.GREATER,zn.ReadWrite,v.depthRangeFor3D),G=(function(he){let be=.01;return he.isOrthographic&&(be=t.ak(1e-4,be,t.d0(he.pitch>=il?1:he.pitch/il))),2*be})(v.transform),J=v.transform.getFreeCameraOptions().position,ee="elevatedStructuresDepthReconstruct",ce=v.getOrCreateProgram(ee,{defines:["DEPTH_RECONSTRUCTION"]}),le=v.getOrCreateProgram(ee);for(const he of x){const be=r.getTile(he),_e=be.getBucket(h);if(!_e)continue;const ke=_e.elevatedStructures;if(!ke)continue;const Ae=_e.elevationBufferData.heightRange,Oe=Km(he.toUnwrapped(),J),He=v.translatePosMatrix(he.projMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let Be,dt,nt,at;if(E==="initialize"){if(!Ae||Ae.min>=1||ke.depthSegments.segments[0].primitiveLength===0)continue;Be=hh(He,Oe,G,1,0),dt=k,nt=ke.depthSegments,at=ce}else if(E==="reset"){if(!Ae||Ae.min>=0||ke.maskSegments.segments[0].primitiveLength===0)continue;Be=hh(He,Oe,0,0,1),dt=B,nt=ke.maskSegments,at=ce}else if(E==="geometry"){if(ke.depthSegments.segments[0].primitiveLength===0)continue;Be=hh(He,Oe,G,1,0),dt=k,nt=ke.depthSegments,at=le}at.draw(v,M.TRIANGLES,dt,sr.disabled,yr.disabled,pr.disabled,Be,h.id,ke.vertexBuffer,ke.indexBuffer,nt,h.paint,v.transform.zoom)}}function up(v,r,h,x){const{painter:E,sourceCache:M,layer:k,coords:B,colorMode:G,elevationType:J,terrainEnabled:ee,pass:ce}=v,le=E.context.gl,he=k.paint.get("fill-pattern"),be=k.paint.get("fill-pattern-cross-fade"),_e=he.constantOr(null);let ke=J;J!=="road"||r&&!ee||(ke="none");const Ae=ke==="road",Oe=v.painter.shadowRenderer,He=Ae&&!!Oe&&Oe.enabled,Be=new zn(E.context.gl.LEQUAL,zn.ReadOnly,E.depthRangeFor3D);let dt=[0,0,0];if(He){const Je=E.style.directionalLight,mt=E.style.ambientLight;Je&&mt&&(dt=sh(E.style,Je,mt))}const nt=he&&he.constantOr(1),at=E.terrain&&E.terrain.renderingToTexture,tt=(Je,mt)=>{let Pt,It,ri,si,_i;mt?(Pt=nt&&!k.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ri=le.LINES):(Pt=nt?"fillPattern":"fill",ri=le.TRIANGLES);for(const Vi of B){const Kt=M.getTile(Vi);if(nt&&!Kt.patternsLoaded())continue;const bt=Kt.getBucket(k);if(!bt)continue;const oi=r?bt.elevationBufferData:bt.bufferData;if(oi.isEmpty())continue;E.prepareDrawTile();const ni=oi.programConfigurations.get(k.id),Li=E.isTileAffectedByFog(Vi),en=[],xn=[];Ae&&(en.push("ELEVATED_ROADS"),xn.push(oi.elevatedLayoutVertexBuffer)),He&&en.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),at&&h&&en.push("USE_MRT1"),nt&&(E.context.activeTexture.set(le.TEXTURE0),Kt.imageAtlasTexture&&Kt.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ni.updatePaintBuffers());let Yi=!1;if(_e&&Kt.imageAtlas){const Tn=Kt.imageAtlas,Kn=t.e3.from(_e),Er=Kn.getPrimary().scaleSelf(t.o.devicePixelRatio).toString(),ts=Kn.getSecondary(),ys=Tn.patternPositions.get(Er),Ln=ts?Tn.patternPositions.get(ts.scaleSelf(t.o.devicePixelRatio).toString()):null;Yi=!!ys&&!!Ln,ys&&ni.setConstantPatternPositions(ys,Ln)}be>0&&(Yi||ni.getPatternTransitionVertexBuffer("fill-pattern"))&&en.push("FILL_PATTERN_TRANSITION");const Wi=E.getOrCreateProgram(Pt,{config:ni,overrideFog:Li,defines:en}),kn=E.translatePosMatrix(Vi.projMatrix,Kt,k.paint.get("fill-translate"),k.paint.get("fill-translate-anchor"));He&&Oe.setupShadows(Kt.tileID.toUnwrapped(),Wi,"vector-tile");const Pn=k.paint.get("fill-emissive-strength");if(mt){si=oi.lineIndexBuffer,_i=oi.lineSegments;const Tn=E.terrain&&E.terrain.renderingToTexture?E.terrain.drapeBufferSize:[le.drawingBufferWidth,le.drawingBufferHeight];It=Pt==="fillOutlinePattern"&&nt?kd(kn,Pn,E,Kt,Tn,dt,be):Zg(kn,Pn,Tn,dt)}else si=oi.indexBuffer,_i=oi.triangleSegments,It=nt?Wp(kn,Pn,E,Kt,dt,be):yf(kn,Pn,dt);E.uploadCommonUniforms(E.context,Wi,Vi.toUnwrapped());let pn=Je;(J==="road"&&!ee||J==="offset")&&(pn=Be),Wi.draw(E,ri,pn,x||E.stencilModeForClipping(Vi),G,pr.disabled,It,k.id,oi.layoutVertexBuffer,si,_i,k.paint,E.transform.zoom,ni,xn)}};E.renderPass===ce&&tt(E.depthModeForSublayer(1,E.renderPass==="opaque"?zn.ReadWrite:zn.ReadOnly),!1),ke==="none"&&E.renderPass==="translucent"&&k.paint.get("fill-antialias")&&tt(E.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,zn.ReadOnly),!0)}function Ld(v,r,h,x,E,M,k,B){h.resetLayerRenderingStats(v);const G=v.context,J=G.gl,ee=v.transform,ce=h.paint.get("fill-extrusion-pattern"),le=h.paint.get("fill-extrusion-pattern-cross-fade"),he=ce.constantOr(null),be=ce.constantOr(1),_e=h.paint.get("fill-extrusion-opacity"),ke=v.style.enable3dLights(),Ae=h.paint.get(ke&&!be?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Oe=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Ae],He=h.layout.get("fill-extrusion-edge-radius"),Be=He>0&&!h.paint.get("fill-extrusion-rounded-roof"),dt=Be?0:He,nt=ee.projection.name==="globe"?t.eb():0,at=ee.projection.name==="globe",tt=at?t.aj(ee.zoom):0,Je=[t.aF(ee.center.lng),t.aJ(ee.center.lat)],mt=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Pt=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(mt?null:h.lut).toArray01().slice(0,3),It=h.paint.get("fill-extrusion-flood-light-intensity"),ri=h.paint.get("fill-extrusion-vertical-scale"),si=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,_i=h.paint.get("fill-extrusion-height-alignment"),Vi=h.paint.get("fill-extrusion-base-alignment"),Kt=rh(v,h.paint.get("fill-extrusion-cutoff-fade-range")),bt=[];let oi;at&&bt.push("PROJECTION_GLOBE_VIEW"),Oe[0]>0&&bt.push("FAUX_AO"),Be&&bt.push("ZERO_ROOF_RADIUS"),B&&bt.push("HAS_CENTROID"),It>0&&bt.push("FLOOD_LIGHT"),Kt.shouldRenderCutoff&&bt.push("RENDER_CUTOFF"),si&&bt.push("RENDER_WALL_MODE");const ni=v.renderPass==="shadow",Li=v.shadowRenderer,en=ni&&!!Li,xn=ni?pr.disabled:pr.backCCW;v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0);let Yi=[0,0,0];if(Li){const Pn=v.style.directionalLight,pn=v.style.ambientLight;Pn&&pn&&(Yi=sh(v.style,Pn,pn)),ni||(bt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Li.useNormalOffset&&bt.push("NORMAL_OFFSET")),oi=bt.concat(["SHADOWS_SINGLE_CASCADE"])}const Wi=en?"fillExtrusionDepth":be?"fillExtrusionPattern":"fillExtrusion",kn=h.getLayerRenderingStats();for(const Pn of x){const pn=r.getTile(Pn),Tn=pn.getBucket(h);if(!Tn||Tn.projection.name!==ee.projection.name)continue;let Kn=!1;Li&&(Kn=Li.getMaxCascadeForTile(Pn.toUnwrapped())===0);const Er=v.isTileAffectedByFog(Pn),ts=Tn.programConfigurations.get(h.id);let ys=!1;if(he&&pn.imageAtlas){const ls=pn.imageAtlas,Ar=t.e3.from(he),vs=Ar.getPrimary().scaleSelf(t.o.devicePixelRatio).toString(),ko=Ar.getSecondary(),yo=ls.patternPositions.get(vs),Ms=ko?ls.patternPositions.get(ko.scaleSelf(t.o.devicePixelRatio).toString()):null;ys=!!yo&&!!Ms,yo&&ts.setConstantPatternPositions(yo,Ms)}le>0&&(ys||ts.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&bt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ln=v.getOrCreateProgram(Wi,{config:ts,defines:Kn?oi:bt,overrideFog:Er});if(v.terrain&&v.terrain.setupElevationDraw(pn,Ln,{useMeterToDem:!0}),!Tn.centroidVertexBuffer){const ls=Ln.getAttributeLocation(J,"a_centroid_pos");ls!==-1&&J.vertexAttrib2f(ls,0,0)}!ni&&Li&&Li.setupShadows(pn.tileID.toUnwrapped(),Ln,"vector-tile"),be&&(v.context.activeTexture.set(J.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ts.updatePaintBuffers());const fs=h.paint.get("fill-extrusion-vertical-gradient"),br=1/Tn.tileToMeter;let Ts;if(ni&&Li){if(Ac(pn.tileID,Tn.maxHeight,v))continue;const ls=Li.calculateShadowPassMatrixFromTile(pn.tileID.toUnwrapped());Ts=_f(ls,dt,br,ri,_i,Vi)}else{const ls=v.translatePosMatrix(Pn.expandedProjMatrix,pn,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ar=ee.projection.createInversionMatrix(ee,Pn.canonical);Ts=be?ap(ls,v,fs,_e,Oe,dt,br,Pn,pn,nt,_i,Vi,tt,Je,Ar,Pt,ri,le):Uh(ls,v,fs,_e,Oe,dt,br,Pn,nt,_i,Vi,tt,Je,Ar,Pt,ri,It,Yi)}v.uploadCommonUniforms(G,Ln,Pn.toUnwrapped(),null,Kt);let zs=Tn.segments;if(ee.projection.name==="mercator"&&!ni&&(zs=Tn.getVisibleSegments(pn.tileID,v.terrain,v.transform.getFrustum(0)),!zs.get().length))continue;if(kn)if(ni)for(const ls of zs.get())kn.numRenderedVerticesInShadowPass+=ls.primitiveLength;else for(const ls of zs.get())kn.numRenderedVerticesInTransparentPass+=ls.primitiveLength;const Os=[];(v.terrain||B)&&Os.push(Tn.centroidVertexBuffer),at&&Os.push(Tn.layoutVertexExtBuffer),si&&Os.push(Tn.wallVertexBuffer),Ln.draw(v,G.gl.TRIANGLES,E,M,k,xn,Ts,h.id,Tn.layoutVertexBuffer,Tn.indexBuffer,zs,h.paint,v.transform.zoom,ts,Os)}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1)}class Fu{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function pu(v,r,h,x,E,M,k,B,G,J,ee,ce,le,he,be,_e,ke,Ae,Oe,He){const Be=r.context,dt=Be.gl,nt=r.transform,at=r.transform.zoom,tt=[],Je=v.translate,mt=v.translateAnchor,Pt=v.edgeRadius,It=rh(r,v.cutoffFadeRange);ee==="clear"?(tt.push("CLEAR_SUBPASS"),He&&(tt.push("CLEAR_FROM_TEXTURE"),Be.activeTexture.set(dt.TEXTURE0),He.bind(dt.LINEAR,dt.CLAMP_TO_EDGE))):ee==="sdf"?tt.push("SDF_SUBPASS"):ee==="emissive"&&(tt.push("USE_MRT1"),Be.activeTexture.set(dt.TEXTURE0),He.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)),Ae&&tt.push("HAS_CENTROID"),It.shouldRenderCutoff&&tt.push("RENDER_CUTOFF");const ri=(si,_i,Vi,Kt,bt)=>{let oi=tt;_i.groundRadiusBuffer!=null&&(oi=tt.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ni=_i.programConfigurations.get(x.id),Li=r.isTileAffectedByFog(si),en=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:ni,defines:oi,overrideFog:Li}),xn=Md(r,Kt,ce,J,bt,[le,he*bt],be,_e,ke,at>=17?0:Pt*bt,He?He.size[0]:0),Yi=[];Ae&&Yi.push(_i.hiddenByLandmarkVertexBuffer),_i.groundRadiusBuffer!=null&&Yi.push(_i.groundRadiusBuffer),r.uploadCommonUniforms(Be,en,si.toUnwrapped(),null,It),en.draw(r,Be.gl.TRIANGLES,M,k,B,G,xn,x.id,_i.vertexBuffer,_i.indexBuffer,Vi,x.paint,at,ni,Yi)};for(const si of E){const _i=h.getTile(si),Vi=_i.getBucket(x);if(!Vi||Vi.projection.name!==nt.projection.name||!Vi.groundEffect||Vi.groundEffect&&!Vi.groundEffect.hasData())continue;const Kt=Vi.groundEffect,bt=1/Vi.tileToMeter;{const oi=r.translatePosMatrix(si.projMatrix,_i,Je,mt),ni=Kt.getDefaultSegment();ri(si,Kt,ni,oi,bt)}if(Oe)for(let oi=0;oi<4;oi++){const ni=t.e9[oi](si),Li=h.getTile(ni);if(!Li)continue;const en=Li.getBucket(x);if(!en||en.projection.name!==nt.projection.name||!en.groundEffect||en.groundEffect&&!en.groundEffect.hasData())continue;const xn=en.groundEffect;let Yi,Wi;oi===0?(Yi=[-t.al,0,0],Wi=1):oi===1?(Yi=[t.al,0,0],Wi=0):oi===2?(Yi=[0,-t.al,0],Wi=3):(Yi=[0,t.al,0],Wi=2);const kn=xn.regionSegments[Wi];if(!kn)continue;const Pn=new Float32Array(16);t.br(Pn,si.projMatrix,Yi),ri(si,xn,kn,r.translatePosMatrix(Pn,_i,Je,mt),bt)}}}function Xp(v,r,h,x,E,M,k){x.centroidVertexArray.length===0&&x.createCentroidsBuffer();const B=M?M.findDEMTileFor(h):null;if(!(B&&B.dem||k))return;M&&B&&B.dem&&x.selfDEMTileTimestamp!==B.dem._timestamp&&(x.borderDoneWithNeighborZ=[-1,-1,-1,-1],x.selfDEMTileTimestamp=B.dem._timestamp);const G=Ae=>new t.P(Math.ceil((Ae+t.ed)*t.ee),0),J=Ae=>{const Oe=r.getSource().minzoom,He=dt=>{const nt=r.getTileByID(dt);if(nt&&nt.hasData())return nt.getBucket(E)},Be=[0,-1,1];for(const dt of Be){if(Ae.overscaledZ+dt<Oe)continue;const nt=He(Ae.calculateScaledKey(Ae.overscaledZ+dt));if(nt)return nt}},ee=[0,0,0],ce=(Ae,Oe)=>(ee[0]=Math.min(Ae.min.y,Oe.min.y),ee[1]=Math.max(Ae.max.y,Oe.max.y),ee[2]=t.al-Oe.min.x>Ae.max.x?Oe.min.x-t.al:Ae.max.x,ee),le=(Ae,Oe)=>(ee[0]=Math.min(Ae.min.x,Oe.min.x),ee[1]=Math.max(Ae.max.x,Oe.max.x),ee[2]=t.al-Oe.min.y>Ae.max.y?Oe.min.y-t.al:Ae.max.y,ee),he=[(Ae,Oe)=>ce(Ae,Oe),(Ae,Oe)=>ce(Oe,Ae),(Ae,Oe)=>le(Ae,Oe),(Ae,Oe)=>le(Oe,Ae)],be=(Ae,Oe,He,Be,dt,nt,at)=>{if(!M)return 0;const tt=[[nt?He:Ae,nt?Ae:He,0],[nt?He:Oe,nt?Oe:He,0]],Je=at<0?t.al+at:at,mt=[nt?Je:(Ae+Oe)/2,nt?(Ae+Oe)/2:Je,0];return He===0&&at<0||He!==0&&at>0?M.getForTilePoints(dt,[mt],!0,Be):tt.push(mt),M.getForTilePoints(h,tt,!0,B),Math.max(tt[0][2],tt[1][2],mt[2])/M.exaggeration()};for(let Ae=0;Ae<4;Ae++){const Oe=x.borderFeatureIndices[Ae];if(Oe.length===0)continue;const He=t.e9[Ae](h),Be=J(He);if(!(Be&&Be instanceof t.ea))continue;const dt=M?M.findDEMTileFor(He):null;if(!(dt&&dt.dem||k)||(M&&dt&&dt.dem&&x.borderDEMTileTimestamp[Ae]!==dt.dem._timestamp&&(x.borderDoneWithNeighborZ[Ae]=-1,x.borderDEMTileTimestamp[Ae]=dt.dem._timestamp),x.borderDoneWithNeighborZ[Ae]===Be.canonical.z))continue;Be.centroidVertexArray.length===0&&Be.createCentroidsBuffer();const nt=(Ae<2?1:5)-Ae,at=Be.borderDoneWithNeighborZ[nt]!==x.canonical.z,tt=Be.borderFeatureIndices[nt];let Je=0;if(x.canonical.z!==Be.canonical.z){for(const mt of Oe)x.showCentroid(x.featuresOnBorder[mt]);if(at)for(const mt of tt)Be.showCentroid(Be.featuresOnBorder[mt]);x.borderDoneWithNeighborZ[Ae]=Be.canonical.z,Be.borderDoneWithNeighborZ[nt]=x.canonical.z}for(const mt of Oe){const Pt=x.featuresOnBorder[mt],It=x.centroidData[Pt.centroidDataIndex],ri=Pt.borders[Ae];let si;for(;Je<tt.length;){si=Be.featuresOnBorder[tt[Je]];const _i=si.borders[nt];if(_i[1]>ri[0]+3||_i[0]>ri[0]-3)break;Be.showCentroid(si),Je++}if(si&&Je<tt.length){const _i=Je;let Vi=0;for(;!(si.borders[nt][0]>ri[1]-3)&&(Vi++,++Je!==tt.length);)si=Be.featuresOnBorder[tt[Je]];si=Be.featuresOnBorder[tt[_i]];let Kt=!1;if(Vi>=1){const ni=si.borders[nt];Math.abs(ri[0]-ni[0])<3&&Math.abs(ri[1]-ni[1])<3&&(Vi=1,Kt=!0,Je=_i+1)}else if(Vi===0){x.showCentroid(Pt);continue}const bt=Be.centroidData[si.centroidDataIndex];k&&Kt&&(((_e=It).flags|(ke=bt).flags)&t.ec?(_e.flags|=t.ec,ke.flags|=t.ec):(_e.flags&=~t.ec,ke.flags&=~t.ec));const oi=Pt.intersectsCount()>1||si.intersectsCount()>1;if(Vi>1)Je=_i,It.centroidXY=bt.centroidXY=new t.P(0,0);else if(dt&&dt.dem&&!oi){const ni=he[Ae](It,bt),Li=Ae%2?t.al-1:0,en=be(ni[0],Math.min(t.al-1,ni[1]),Li,dt,He,Ae<2,ni[2]);It.centroidXY=bt.centroidXY=G(en)}else oi?It.centroidXY=bt.centroidXY=new t.P(0,0):(It.centroidXY=x.encodeBorderCentroid(Pt),bt.centroidXY=Be.encodeBorderCentroid(si));x.writeCentroidToBuffer(It),Be.writeCentroidToBuffer(bt)}else x.showCentroid(Pt)}x.borderDoneWithNeighborZ[Ae]=Be.canonical.z,Be.borderDoneWithNeighborZ[nt]=x.canonical.z}var _e,ke;(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(v)}const Vl=[1,0,0],If=[0,1,0],Pl=[0,0,1];function Ac(v,r,h){const x=h.transform,E=h.shadowRenderer;if(!E)return!0;const M=v.toUnwrapped(),k=x.tileSize*E._cascades[h.currentShadowCascade].scale;let B=r;if(x.elevation){const _e=x.elevation.getMinMaxForTile(v);_e&&(B+=_e.max)}const G=[...E.shadowDirection];G[2]=-G[2];const J=E.computeSimplifiedTileShadowVolume(M,B,k,G);if(!J)return!1;const ee=[Vl,If,Pl,G,[G[0],0,G[2]],[0,G[1],G[2]]],ce=x.projection.name==="globe",le=x.scaleZoom(k),he=t.cB.fromInvProjectionMatrix(x.invProjMatrix,x.worldSize,le,!ce),be=E.getCurrentCascadeFrustum();return he.intersectsPrecise(J.vertices,J.planes,ee)===0||be.intersectsPrecise(J.vertices,J.planes,ee)===0}function Bu(v){const{painter:r,source:h,layer:x,coords:E}=v;let M=v.defines;const k=r.context,B=r.renderPass==="shadow",G=r.renderPass==="light-beam",J=r.shadowRenderer,ee=t.ef(r.transform.center.lat,r.transform.zoom),ce=rh(r,x.paint.get("building-cutoff-fade-range"));ce.shouldRenderCutoff&&(M=M.concat("RENDER_CUTOFF")),v.floodLightIntensity>0&&(M=M.concat("FLOOD_LIGHT"));for(const le of E){const he=h.getTile(le),be=he.getBucket(x);if(!be)continue;J&&J.getMaxCascadeForTile(le.toUnwrapped())===0&&(M=M.concat("SHADOWS_SINGLE_CASCADE"));const _e=be.programConfigurations.get(x.id);let ke,Ae,Oe,He=r.translatePosMatrix(le.expandedProjMatrix,he,[0,0],"map");if(He=t.cS(t.bC(),He,[1,1,v.verticalScale]),B&&J){if(Ac(he.tileID,be.maxHeight*ee,r))continue;let dt=J.calculateShadowPassMatrixFromTile(he.tileID.toUnwrapped());dt=t.cS(t.bC(),dt,[1,1,v.verticalScale]),Oe=dh(dt),ke=Ae=r.getOrCreateProgram("buildingDepth",{config:_e,defines:M,overrideFog:!1})}else if(G)ke=Ae=r.getOrCreateProgram("buildingBloom",{config:_e,defines:M,overrideFog:!1}),Oe=Xg(He);else{const dt=r.transform.calculatePosMatrix(le.toUnwrapped(),r.transform.worldSize);t.cS(dt,dt,[1,1,v.verticalScale]);const nt=t.bC();t.cS(nt,dt,[1,-1,1/ee]),t.bl(nt,nt),t.eg(nt,nt);const at=r.transform.getFreeCameraOptions().position,tt=1<<le.canonical.z;if(Oe=vf(He,nt,v.opacity,v.facadeAOIntensity,[((at.x-le.wrap)*tt-le.canonical.x)*t.al,(at.y*tt-le.canonical.y)*t.al,at.z*tt*t.al],be.tileToMeter,v.facadeEmissiveChance,v.floodLightColor,v.floodLightIntensity),Ae=r.getOrCreateProgram("building",{config:_e,defines:M,overrideFog:!1}),v.depthOnly===!0)ke=Ae;else{const Je=M.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ke=r.getOrCreateProgram("building",{config:_e,defines:Je,overrideFog:!1})}J&&(J.setupShadowsFromMatrix(dt,Ae,!0),ke!==Ae&&J.setupShadowsFromMatrix(dt,ke,!0))}const Be=(dt,nt)=>{if(G){const at=dt.entranceBloom;nt.draw(r,k.gl.TRIANGLES,v.depthMode,sr.disabled,v.blendMode,pr.disabled,Oe,x.id,at.layoutVertexBuffer,at.indexBuffer,at.segmentsBucket,x.paint,r.transform.zoom,_e,[at.layoutAttenuationBuffer,at.layoutColorBuffer])}else{const at=dt.segmentsBucket;let tt=[dt.layoutNormalBuffer,dt.layoutCentroidBuffer,dt.layoutColorBuffer,dt.layoutFloodLightDataBuffer];dt.layoutFacadePaintBuffer&&(tt=tt.concat([dt.layoutFacadeDataBuffer,dt.layoutFacadeVerticalRangeBuffer,dt.layoutFacadePaintBuffer])),nt.draw(r,k.gl.TRIANGLES,v.depthMode,sr.disabled,v.blendMode,B?pr.disabled:pr.backCW,Oe,x.id,dt.layoutVertexBuffer,dt.indexBuffer,at,x.paint,r.transform.zoom,_e,tt)}};r.uploadCommonUniforms(k,Ae,le.toUnwrapped(),null,ce),be.buildingWithoutFacade&&Be(be.buildingWithoutFacade,Ae),be.buildingWithFacade&&(ke!==Ae&&r.uploadCommonUniforms(k,ke,le.toUnwrapped(),null,ce),Be(be.buildingWithFacade,ke))}}function hp(v,r,h,x,E,M,k,B,G,J,ee,ce,le){const he=v.context.gl,be=v.depthModeForSublayer(1,zn.ReadOnly,he.LEQUAL,!0),_e=.1*(1-(ke=ee))+3*ke;var ke;const Ae=v._showOverdrawInspector,Oe=ce,He=new Fu;Ae||pu(He,v,r,h,x,be,new sr({func:he.ALWAYS,mask:255},255,255,he.KEEP,he.KEEP,he.REPLACE),new yr([he.ONE,he.ONE,he.ONE,he.ONE],t.ao.transparent,[!1,!1,!1,!0],he.MIN),pr.disabled,E,"sdf",M,k,B,G,J,_e,Oe,!1);{const Be=Ae?sr.disabled:new sr({func:he.EQUAL,mask:255},255,255,he.KEEP,he.DECR,he.DECR),dt=Ae?v.colorModeForRenderPass():new yr([he.ONE_MINUS_DST_ALPHA,he.DST_ALPHA,he.ONE,he.ONE],t.ao.transparent,[!0,!0,!0,!0]);pu(He,v,r,h,x,be,Be,dt,pr.disabled,E,"color",M,k,B,G,J,_e,Oe,!1)}}function Rd(v){return[v[0]*t.eh,v[1]*t.eh,v[2]*t.eh,0]}function Nu(v,r,h,x,E,M,k,B,G){const J=x.getSource(),ee=h.globeSharedBuffers;if(!ee)return;let ce,le,he;if(r&&(ce=x.getTile(r)),J instanceof t.aU?(le=J.texture,he=t.dK(0,0,h.transform)):ce&&r&&(le=ce.texture,he=t.dK(r.canonical.z,r.canonical.x,h.transform)),!le||!he)return;v||(he=t.cS(t.bC(),he,[1,-1,1]));const be=h.context,_e=be.gl,ke=E.paint.get("raster-resampling")==="nearest"?_e.NEAREST:_e.LINEAR,Ae=h.colorModeForDrapableLayerRenderPass(M),Oe=k.defines;Oe.push("GLOBE_POLES");const He=new zn(_e.LEQUAL,zn.ReadWrite,h.depthRangeFor3D),Be=Float32Array.from(h.transform.expandedFarZProjMatrix),dt=Float32Array.from(t.bk(t.dJ(new t.cD(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),be.activeTexture.set(_e.TEXTURE0),le.bind(ke,_e.CLAMP_TO_EDGE),be.activeTexture.set(_e.TEXTURE1),le.bind(ke,_e.CLAMP_TO_EDGE),"useMipmap"in le&&be.extTextureFilterAnisotropic&&h.transform.pitch>20&&_e.texParameterf(_e.TEXTURE_2D,be.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,be.extTextureFilterAnisotropicMax);const[nt,at,tt,Je]=r?ee.getPoleBuffers(r.canonical.z,!1):ee.getPoleBuffers(0,!0),mt=E.paint.get("raster-elevation");let Pt;v?(Pt=nt,h.renderDefaultNorthPole=mt!==0):(Pt=at,h.renderDefaultSouthPole=mt!==0);const It=Rd(k.mix),ri=((_i,Vi,Kt,bt,oi,ni,Li,en,xn,Yi,Wi,kn,Pn)=>cy(_i,Vi,Kt,new Float32Array(16),new Float32Array(9),[0,0],bt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ni,[0,0],en,2,Yi,Wi,kn,1,0,Pn))(Be,dt,he,t.aj(h.transform.zoom),0,E,0,mt,0,It,k.offset,k.range,M),si=h.getOrCreateProgram("raster",{defines:Oe});h.uploadCommonUniforms(be,si,null),si.draw(h,_e.TRIANGLES,He,G,Ae,B,ri,E.id,Pt,tt,Je)}function Jm(v){const r=v._nearZ,h=v.projection.farthestPixelDistance(v),x=h-r,E=.2*v.height,M=r+E;return[r,h,(M-E-r)/x,(M-r)/x]}function mu(v,r,h,x){if(v)return r instanceof yl&&v instanceof Jr?r.getTextureDescriptor(v,h,!0):{texture:v.texture,mix:Rd(x.mix),offset:x.offset,buffer:0,tileSize:1}}var Us=t.ei([{name:"a_index",type:"Int16",components:1}]);class dp{constructor(r,h,x,E){const M={width:x[0],height:x[1],data:null},k=r.gl;this.targetColorTexture=new t.T(r,M,k.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new t.T(r,M,k.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(h,E),this.lastInvalidatedAt=0}updateParticleTexture(r,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const x=this.context.gl,E=h.width*h.height;this.particleTexture0=new t.T(this.context,h,x.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,h,x.RGBA8,{premultiply:!1,useMipmap:!1});const M=new t.ej;M.reserve(E);for(let k=0;k<E;k++)M.emplaceBack(k);this.particleIndexBuffer=this.context.createVertexBuffer(M,Us.members,!0),this.particleSegment=t.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=t.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function V(v,r,h){if(!v)return null;const x=r.getTextureDescriptor(v,h,!0);if(!x)return null;let{texture:E,mix:M,offset:k,tileSize:B,buffer:G,format:J}=x;if(!E||!J)return null;let ee=!1;return J==="uint32"&&(ee=!0,M[3]=0,M=Ou(t.ek,M,[0,h.paint.get("raster-particle-max-speed")]),k=To(t.ek,k,[0,h.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[G/(B+2*G),B/(B+2*G)],tileSize:B,scalarData:ee,scale:M,offset:k,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[J]]}}function u(v){const r=v._nearZ,h=v.projection.farthestPixelDistance(v),x=h-r,E=.2*v.height,M=r+E;return[r,h,(M-E-r)/x,(M-r)/x]}const y=new t.ao(1,0,0,1),I=new t.ao(0,1,0,1),D=new t.ao(0,0,1,1),j=new t.ao(1,0,1,1),H=new t.ao(0,1,1,1);function K(v,r,h,x,E,M){for(let k=0;k<h.length;k++)if(E){const J=new t.ao(x.r*.8,x.g*.8,x.b*.8,1);te(v,r,h[k],x,-1,-1,M),te(v,r,h[k],x,-1,1,M),te(v,r,h[k],x,1,1,M),te(v,r,h[k],x,1,-1,M),te(v,r,h[k],J,0,0,M)}else te(v,r,h[k],x,0,0,M)}function te(v,r,h,x,E,M,k){const B=v.context,G=v.transform,J=B.gl,ee=G.projection.name==="globe",ce=ee?["PROJECTION_GLOBE_VIEW"]:[];let le=t.bz(h.projMatrix);if(ee&&t.aj(G.zoom)>0){const It=t.bj(h.canonical,G),ri=t.el(It);le=t.aB(new Float32Array(16),G.globeMatrix,ri),t.aB(le,G.projMatrix,le)}const he=t.bC();he[12]+=2*E/(t.o.devicePixelRatio*G.width),he[13]+=2*M/(t.o.devicePixelRatio*G.height),t.aB(le,he,le);const be=v.getOrCreateProgram("debug",{defines:ce}),_e=r.getTileByID(h.key);v.terrain&&v.terrain.setupElevationDraw(_e,be);const ke=zn.disabled,Ae=sr.disabled,Oe=v.colorModeForRenderPass(),He="$debug";B.activeTexture.set(J.TEXTURE0),v.emptyTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ee?_e._makeGlobeTileDebugBuffers(v.context,G):_e._makeDebugTileBoundsBuffers(v.context,G.projection);const Be=_e._tileDebugBuffer||v.debugBuffer,dt=_e._tileDebugIndexBuffer||v.debugIndexBuffer,nt=_e._tileDebugSegments||v.debugSegments;if(be.draw(v,J.LINE_STRIP,ke,Ae,Oe,pr.disabled,xf(le,x.toPremultipliedRenderColor(null)),He,Be,dt,nt,null,null,null,[_e._globeTileDebugBorderBuffer]),k){const It=_e.latestRawTileData,ri=Math.floor((It&&It.byteLength||0)/1024);let si=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(si+=` => ${h.overscaledZ}`),si+=` ${_e.state}`,si+=` ${ri}kb`,(function(_i,Vi){_i.initDebugOverlayCanvas();const Kt=_i.debugOverlayCanvas,bt=_i.context.gl,oi=_i.debugOverlayCanvas.getContext("2d");oi.clearRect(0,0,Kt.width,Kt.height),oi.shadowColor="white",oi.shadowBlur=2,oi.lineWidth=1.5,oi.strokeStyle="white",oi.textBaseline="top",oi.font="bold 36px Open Sans, sans-serif",oi.fillText(Vi,5,5),oi.strokeText(Vi,5,5),_i.debugOverlayTexture.update(Kt),_i.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)})(v,si)}const at=r.getTile(h).tileSize,tt=512/Math.min(at,512)*(h.overscaledZ/G.zoom)*.5,Je=_e._tileDebugTextBuffer||v.debugBuffer,mt=_e._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,Pt=_e._tileDebugTextSegments||v.debugSegments;be.draw(v,J.TRIANGLES,ke,Ae,yr.alphaBlended,pr.disabled,xf(le,t.ao.transparent.toPremultipliedRenderColor(null),tt),He,Je,mt,Pt,null,null,null,[_e._globeTileDebugTextBuffer])}function ge(v,r,h,x){fe(v,0,r+h/2,v.transform.width,h,x)}function xe(v,r,h,x){fe(v,r-h/2,0,h,v.transform.height,x)}function fe(v,r,h,x,E,M){const k=v.context,B=k.gl;B.enable(B.SCISSOR_TEST),B.scissor(r*t.o.devicePixelRatio,h*t.o.devicePixelRatio,x*t.o.devicePixelRatio,E*t.o.devicePixelRatio),k.clear({color:M}),B.disable(B.SCISSOR_TEST)}const De=t.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ve}=De;function Xe(v,r,h,x){v.emplaceBack(r,h,x)}class xt{constructor(r){this.vertexArray=new t.em,this.indices=new t.b0,Xe(this.vertexArray,-1,-1,1),Xe(this.vertexArray,1,-1,1),Xe(this.vertexArray,-1,1,1),Xe(this.vertexArray,1,1,1),Xe(this.vertexArray,-1,-1,-1),Xe(this.vertexArray,1,-1,-1),Xe(this.vertexArray,-1,1,-1),Xe(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Ve),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=t.bg.simpleSegment(0,0,36,12)}}function wt(v,r,h,x,E,M){const k=v.context.gl,B=r.paint.get("sky-atmosphere-color"),G=r.paint.get("sky-atmosphere-halo-color"),J=r.paint.get("sky-atmosphere-sun-intensity"),ee=((ce,le,he,be,_e)=>({u_matrix_3f:ce,u_sun_direction:le,u_sun_intensity:he,u_color_tint_r:[be.r,be.g,be.b,be.a],u_color_tint_m:[_e.r,_e.g,_e.b,_e.a],u_luminance:5e-5}))(t.eo(t.dO(),x),E,J,B.toPremultipliedRenderColor(null),G.toPremultipliedRenderColor(null));k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+M,r.skyboxTexture,0),h.draw(v,k.TRIANGLES,zn.disabled,sr.disabled,yr.unblended,pr.frontCW,ee,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Tt=t.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Mt{constructor(r){const h=new t.ep;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const x=new t.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(h,Tt.members),this.indexBuffer=r.createIndexBuffer(x),this.segments=t.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Yt=t.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Rt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zt{constructor(r){this.colorModeAlphaBlendedWriteRGB=new yr([1,Mu,1,Mu],t.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new yr([1,0,1,0],t.ao.transparent,[!1,!1,!1,!0]),this.params=new Rt,this.updateNeeded=!0}update(r){const h=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Mt(h);const x=this.params.sizeRange,E=this.params.intensityRange,M=(function(ee){const ce=t.eq(30),le=[];for(let he=0;he<ee;++he){const be=2*Math.PI*ce(),_e=Math.acos(1-2*ce())-.5*Math.PI;le.push(t.d5(Math.cos(_e)*Math.cos(be),Math.cos(_e)*Math.sin(be),Math.sin(_e)))}return le})(this.params.starsCount),k=t.eq(300),B=new t.er,G=new t.b0;let J=0;for(let ee=0;ee<M.length;++ee){const ce=t.c5([],M[ee],200),le=Math.max(0,1+.01*x*(1*k()-.5)),he=Math.max(0,1+.01*E*(1*k()-.5));B.emplaceBack(ce[0],ce[1],ce[2],-1,-1,le,he),B.emplaceBack(ce[0],ce[1],ce[2],1,-1,le,he),B.emplaceBack(ce[0],ce[1],ce[2],1,1,le,he),B.emplaceBack(ce[0],ce[1],ce[2],-1,1,le,he),G.emplaceBack(J+0,J+1,J+2),G.emplaceBack(J+0,J+2,J+3),J+=4}this.starsVx=h.createVertexBuffer(B,Yt.members),this.starsIdx=h.createIndexBuffer(G),this.starsSegments=t.bg.simpleSegment(0,0,B.length,G.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,h){const x=r.context,E=x.gl,M=r.transform,k=new zn(E.LEQUAL,zn.ReadOnly,[0,1]),B=t.aj(M.zoom),G=r.style.getLut(h.scope),J=h.properties.get("color-use-theme")==="none",ee=h.properties.get("color").toNonPremultipliedRenderColor(J?null:G),ce=h.properties.get("high-color-use-theme")==="none",le=h.properties.get("high-color").toNonPremultipliedRenderColor(ce?null:G),he=h.properties.get("space-color-use-theme")==="none",be=h.properties.get("space-color").toNonPremultipliedRenderColor(he?null:G),_e=5e-4,ke=t.es(h.properties.get("horizon-blend"),0,1,_e,.25),Ae=t.dE(r,x,M)&&ke===_e?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,Oe=r.frameCounter/1e3%1,He=t.ag(M.globeCenterInViewSpace),Be=Math.sqrt(Math.pow(He,2)-Math.pow(Ae,2)),dt=Math.acos(Be/He),nt=at=>{const tt=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];at&&tt.push("ALPHA_PASS");const Je=r.getOrCreateProgram("globeAtmosphere",{defines:tt}),mt=((It,ri,si,_i,Vi,Kt,bt,oi,ni,Li,en,xn)=>({u_frustum_tl:It,u_frustum_tr:ri,u_frustum_br:si,u_frustum_bl:_i,u_horizon:Vi,u_transition:Kt,u_fadeout_range:bt,u_atmosphere_fog_color:oi.toArray01(),u_high_color:ni.toArray01(),u_space_color:Li.toArray01(),u_temporal_offset:en,u_horizon_angle:xn}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,B,ke,ee,le,be,Oe,dt);r.uploadCommonUniforms(x,Je);const Pt=this.atmosphereBuffer;Pt&&Je.draw(r,E.TRIANGLES,k,sr.disabled,at?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,pr.backCW,mt,at?"atmosphere_glow_alpha":"atmosphere_glow",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)};nt(!1),nt(!0)}drawStars(r,h){const x=t.aA(h.properties.get("star-intensity"),0,1);if(x===0)return;const E=r.context,M=E.gl,k=r.transform,B=r.getOrCreateProgram("stars"),G=t.c7([]);t.c9(G,G,-k._pitch),t.c8(G,G,-k.angle),t.c9(G,G,t.an(k._center.lat)),t.et(G,G,-t.an(k._center.lng));const J=t.cc(new Float32Array(16),G),ee=t.aB([],k.starsProjMatrix,J),ce=t.eo([],J),le=t.eu([],ce),he=[0,1,0];t.dQ(he,he,le),t.c5(he,he,this.params.sizeMultiplier);const be=[1,0,0];t.dQ(be,be,le),t.c5(be,be,this.params.sizeMultiplier);const _e=(ke=he,Ae=be,Oe=x,{u_matrix:Float32Array.from(ee),u_up:ke,u_right:Ae,u_intensity_multiplier:Oe});var ke,Ae,Oe;r.uploadCommonUniforms(E,B),this.starsVx&&this.starsIdx&&B.draw(r,M.TRIANGLES,zn.disabled,sr.disabled,this.colorModeAlphaBlendedWriteRGB,pr.disabled,_e,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ei{constructor(){this.visibleTiles=[]}updateBorders(r,h){const x=[],E=[],M=r._getRenderableCoordinates(!1,!0);for(const G of M){const J=r.getTile(G);if(!J.hasData())continue;const ee=J.getBucket(h);ee&&(ee.isEmpty()||(x.push(G.key),E.push({bucket:ee,tileID:G.canonical})))}let k=x.length!==this.visibleTiles.length;if(!k){x.sort();for(let G=0;G<x.length;G++)if(x[G]!==this.visibleTiles[G]){k=!0;break}}if(!k)return;const B=new Set;this.visibleTiles=x,E.sort(((G,J)=>G.tileID.z-J.tileID.z||G.tileID.x-J.tileID.x||G.tileID.y-J.tileID.y));for(const G of E){const J=new Array,ee=new Array,ce=G.bucket;for(const le of ce.featuresOnBorder)B.has(le.featureId)?ee.push(le.footprintIndex):(B.add(le.featureId),J.push(le.footprintIndex));ce.updateFootprintHiddenFlags(J,t.ev,!1),ce.updateFootprintHiddenFlags(ee,t.ev,!0)}}}function Ut(v,r){const h=[...v],x=r.cameraWorldSizeForFog/r.worldSize,E=t.bA([]);return t.cS(E,E,[x,x,1]),t.aB(h,E,h),t.aB(h,r.worldToFogMatrix,h),h}function hi(v,r,h,x,E){const M=h.material,k=x.context,{baseColorTexture:B,metallicRoughnessTexture:G}=M.pbrMetallicRoughness,{normalTexture:J,occlusionTexture:ee,emissionTexture:ce}=M;function le(be,_e,ke){if(be&&(v.push(_e),k.activeTexture.set(k.gl.TEXTURE0+ke),be.gfxTexture)){const{minFilter:Ae,magFilter:Oe,wrapS:He,wrapT:Be}=be.sampler;be.gfxTexture.bindExtraParam(Ae,Oe,He,Be)}}le(B,"HAS_TEXTURE_u_baseColorTexture",$a.BaseColor),le(G,"HAS_TEXTURE_u_metallicRoughnessTexture",$a.MetallicRoughness),le(J,"HAS_TEXTURE_u_normalTexture",$a.Normal),le(ee,"HAS_TEXTURE_u_occlusionTexture",$a.Occlusion),le(ce,"HAS_TEXTURE_u_emissionTexture",$a.Emission),E&&(E.texture||(E.texture=new t.d$(x.context,E.image,[E.image.height,E.image.height,E.image.height],k.gl.RGBA8)),k.activeTexture.set(k.gl.TEXTURE0+$a.LUT),E.texture&&E.texture.bind(k.gl.LINEAR,k.gl.CLAMP_TO_EDGE),v.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(v.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(h.texcoordBuffer)),h.colorBuffer&&(v.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(h.colorBuffer)),h.normalBuffer&&(v.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(h.normalBuffer)),h.pbrBuffer&&(v.push("HAS_ATTRIBUTE_a_pbr"),v.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(h.pbrBuffer)),M.alphaMode!=="OPAQUE"&&M.alphaMode!=="MASK"||v.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||v.push("DIFFUSE_SHADED");const he=x.shadowRenderer;he&&(v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),he.useNormalOffset&&v.push("NORMAL_OFFSET"))}function $i(v,r,h,x,E,M){const k=v.modelOpacity,B=r.context,G=new zn(r.context.gl.LEQUAL,v.isLightMesh?zn.ReadOnly:zn.ReadWrite,r.depthRangeFor3D),J=r.transform,ee=v.mesh,ce=ee.material,le=ce.pbrMetallicRoughness,he=r.style.fog;let be;be=r.transform.projection.zAxisUnit==="pixels"?[...v.nodeModelMatrix]:t.aB([],x.zScaleMatrix,v.nodeModelMatrix),t.aB(be,x.negCameraPosMatrix,be);const _e=t.bl([],be);t.eg(_e,_e);const ke=h.paint.get("model-color-use-theme").constantOr("default")==="none",Ae=h.paint.get("model-emissive-strength").constantOr(0),Oe=Cr(new Float32Array(v.worldViewProjection),new Float32Array(be),new Float32Array(_e),null,r,k,le.baseColorFactor,ce.emissiveFactor,le.metallicFactor,le.roughnessFactor,ce,Ae,h,void 0,void 0,v.materialOverride,v.modelColor),He={defines:[]},Be=[],dt=r.shadowRenderer;dt&&(dt.useNormalOffset=!1),hi(He.defines,Be,ee,r,ke?null:h.lut);let nt=null;if(he){const Je=Ut(v.nodeModelMatrix,r.transform);if(nt=new Float32Array(Je),J.projection.name!=="globe"){const mt=ee.aabb.min,Pt=ee.aabb.max,[It,ri]=he.getOpacityForBounds(Je,mt[0],mt[1],Pt[0],Pt[1]);He.overrideFog=It>=xi||ri>=xi}}const at=rh(r,h.paint.get("model-cutoff-fade-range"));at.shouldRenderCutoff&&He.defines.push("RENDER_CUTOFF");const tt=r.getOrCreateProgram("model",He);r.uploadCommonUniforms(B,tt,null,nt,at),r.renderPass!=="shadow"&&dt&&dt.setupShadowsFromMatrix(v.nodeModelMatrix,tt),tt.draw(r,B.gl.TRIANGLES,G,E,M,ee.material.doubleSided?pr.disabled:pr.backCCW,Oe,h.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,h.paint,r.transform.zoom,void 0,Be)}function ki(v,r){return v.style._importedAsBasemap?"basemap":r.scope}function Di(v,r,h,x,E,M,k,B,G,J){const ee=v.transform,ce=!!r.isGeometryBloom&&r.isGeometryBloom;if(ce&&v.renderPass==="shadow")return;const le=ee.projection.name==="globe"?t.eD(h,ee):[...h];t.aB(le,le,r.globalMatrix);const he=t.aB([],x,le);if(r.meshes)for(const be of r.meshes){const _e=B.get(be.material.name);if(_e&&_e.opacity<=0)continue;if(be.material.alphaMode!=="BLEND"){k.push({mesh:be,depth:0,modelIndex:E,worldViewProjection:he,nodeModelMatrix:le,isLightMesh:ce,materialOverride:_e,modelOpacity:G,modelColor:J});continue}const ke=t.af([],be.centroid,he);!ee.isOrthographic&&ke[2]<=0||M.push({mesh:be,depth:ke[2],modelIndex:E,worldViewProjection:he,nodeModelMatrix:le,isLightMesh:ce,materialOverride:_e,modelOpacity:G,modelColor:J})}if(r.children)for(const be of r.children)Di(v,be,h,x,E,M,k,B,G,J)}function Pi(v,r,h,x){const E=h.shadowRenderer;if(!E)return;const M=E.getShadowPassDepthMode(),k=E.getShadowPassColorMode(),B=E.calculateShadowPassMatrixFromMatrix(r),G=bf(B);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,M,sr.disabled,k,pr.disabled,G,x.id,v.vertexBuffer,v.indexBuffer,v.segments,x.paint,h.transform.zoom,void 0,void 0)}function On(v,r,h,x,E,M){for(const k of E){const B=Object.assign({},x);B.part=k;const G={type:"Unknown",id:r,properties:B},J={orientation:v.paint.get("model-rotation").evaluate(G,h)};M.set(k,J)}}function Nn(v,r,h,x,E,M){for(const k of E){const B=Object.assign({},x);B.part=k;const G={type:"Unknown",id:r,properties:B},J={color:v.paint.get("model-color").evaluate(G,h),colorMix:v.paint.get("model-color-mix-intensity").evaluate(G,h),opacity:v.paint.get("model-opacity").evaluate(G,h),emissionStrength:v.paint.get("model-emissive-strength").evaluate(G,h)};M.set(k,J)}}function bn(v,r,h,x,E){let M=!1;for(const B of x)B.modelOpacity!==1&&($i(B,v,r,E[B.modelIndex],sr.disabled,yr.disabled),M=!0);for(const B of x)$i(B,v,r,E[B.modelIndex],B.modelOpacity!==1?v.stencilModeFor3D():sr.disabled,v.colorModeForRenderPass());M&&v.resetStencilClippingMasks();const k=yr.additive;for(const B of h)$i(B,v,r,E[B.modelIndex],sr.disabled,B.isLightMesh?k:v.colorModeForRenderPass())}function Yn(v,r,h){const x=r.updateZoomBasedPaintProperties(),E=(function(M,k,B){let G,J,ee,ce=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&ce>0){const le=M.terrain,he=le.findDEMTileFor(B);he&&he.dem?G=t.eF.create(le,B,he):ce=0}if(ce===0&&(k.terrainElevationMin=0,k.terrainElevationMax=0),ce===k.validForExaggeration&&(ce===0||G&&G._demTile&&G._demTile.tileID===k.validForDEMTile.id&&G._dem._timestamp===k.validForDEMTile.timestamp))return!1;for(const le in k.instancesPerModel){const he=k.instancesPerModel[le];for(let be=0;be<he.instancedDataArray.length;++be){const _e=(G?ce*G.getElevationAt(0|he.instancedDataArray.float32[16*be],0|he.instancedDataArray.float32[16*be+1],!0,!0):0)+he.instancesEvaluatedElevation[be];he.instancedDataArray.float32[16*be+6]=_e,J=J?Math.min(k.terrainElevationMin,_e):_e,ee=ee?Math.max(k.terrainElevationMax,_e):_e}}return k.terrainElevationMin=J||0,k.terrainElevationMax=ee||0,k.validForExaggeration=ce,k.validForDEMTile=G&&G._demTile?{id:G._demTile.tileID,timestamp:G._dem._timestamp}:{id:void 0,timestamp:0},!0})(v,r,h);(x||E)&&(r.uploaded=!1,r.upload(v.context))}const Zr={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.d9([0,0,0],[t.al,t.al,0])};function Ps(v,r){const h=1<<v.canonical.z,x=r.getFreeCameraOptions().position,E=r.elevation,M=v.canonical.x/h,k=(v.canonical.x+1)/h,B=v.canonical.y/h,G=(v.canonical.y+1)/h;let J=r._centerAltitude;if(E){const he=E.getMinMaxForTile(v);he&&he.max>J&&(J=he.max)}const ee=t.aA(x.x,M,k)-x.x,ce=t.aA(x.y,B,G)-x.y,le=t.cf(J,r.center.lat)-x.z;return r._zoomFromMercatorZ(Math.sqrt(ee*ee+ce*ce+le*le))}function ia(v,r,h,x,E,M,k){const B=v.context,G=v.renderPass==="shadow",J=v.shadowRenderer,ee=G&&J?J.getShadowPassDepthMode():new zn(B.gl.LEQUAL,zn.ReadWrite,v.depthRangeFor3D),ce=v.isTileAffectedByFog(M),le=v.transform.projection.name==="globe";if(h.meshes)for(const he of h.meshes){const be=le?[]:["MODEL_POSITION_ON_GPU"],_e=[];let ke,Ae,Oe;const He=!le&&x.instancedDataArray.length>20;He&&be.push("INSTANCED_ARRAYS");const Be=rh(v,r.paint.get("model-cutoff-fade-range"));if(Be.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),G&&J)ke=v.getOrCreateProgram("modelDepth",{defines:be}),Ae=bf(k.shadowTileMatrix,k.shadowTileMatrix,Float32Array.from(h.globalMatrix)),Oe=J.getShadowPassColorMode();else{hi(be,_e,he,v,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),ke=v.getOrCreateProgram("model",{defines:be,overrideFog:ce});const nt=he.material,at=nt.pbrMetallicRoughness,tt=r.paint.get("model-opacity").constantOr(1),Je=r.paint.get("model-emissive-strength").constantOr(0);Ae=Cr(M.expandedProjMatrix,Float32Array.from(h.globalMatrix),new Float32Array(16),null,v,tt,at.baseColorFactor,nt.emissiveFactor,at.metallicFactor,at.roughnessFactor,nt,Je,r,E),J&&(k.shadowUniformsInitialized?ke.setShadowUniformValues(B,J.getShadowUniformValues()):(J.setupShadows(M.toUnwrapped(),ke,"model-tile"),k.shadowUniformsInitialized=!0)),Oe=Be.shouldRenderCutoff||tt<1||nt.alphaMode!=="OPAQUE"?yr.alphaBlended:yr.unblended}v.uploadCommonUniforms(B,ke,M.toUnwrapped(),null,Be);const dt=he.material.doubleSided?pr.disabled:pr.backCCW;if(He)_e.push(x.instancedDataBuffer),ke.draw(v,B.gl.TRIANGLES,ee,sr.disabled,Oe,dt,Ae,r.id,he.vertexBuffer,he.indexBuffer,he.segments,r.paint,v.transform.zoom,void 0,_e,x.instancedDataArray.length);else{const nt=G?"u_instance":"u_normal_matrix";for(let at=0;at<x.instancedDataArray.length;++at)Ae[nt]=new Float32Array(x.instancedDataArray.arrayBuffer,64*at,16),ke.draw(v,B.gl.TRIANGLES,ee,sr.disabled,Oe,dt,Ae,r.id,he.vertexBuffer,he.indexBuffer,he.segments,r.paint,v.transform.zoom,void 0,_e)}}if(h.children)for(const he of h.children)ia(v,r,he,x,E,M,k)}const Eo=[1,-1,1];function fa(v,r,h,x){if(!h.modelManager)return!0;const E=h.modelManager;if(!h.shadowRenderer)return!0;const M=h.shadowRenderer,k=r.aabb;let B=!0,G=v.maxHeight;if(G===0){let ee=0;for(const ce in v.instancesPerModel){const le=E.getModel(ce,x);le?ee=Math.max(ee,Math.max(Math.max(le.aabb.max[0],le.aabb.max[1]),le.aabb.max[2])):B=!1}G=v.maxScale*ee*1.41+v.maxVerticalOffset,B&&(v.maxHeight=G)}k.max[2]=G,k.min[2]+=v.terrainElevationMin,k.max[2]+=v.terrainElevationMax,t.af(k.min,k.min,r.tileMatrix),t.af(k.max,k.max,r.tileMatrix);const J=k.intersects(M.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(v.isInsideFirstShadowMapFrustum=J===2),J===0}function Nr(v,r){const h=v.uniformValues.u_cutoff_params[0],x=v.uniformValues.u_cutoff_params[1],E=v.uniformValues.u_cutoff_params[2],M=v.uniformValues.u_cutoff_params[3];return x===h||M===E?1:t.aA(((r-h)/(x-h)-E)/(M-E),0,1)}function hr(v,r,h,x){if(r.pitch<20)return 1;const E=r.getWorldToCameraMatrix();t.aB(E,E,v);const M=t.bU(h.min[0],h.min[1],h.min[2],1);let k=t.aC(t.eG(),M,E),B=k,G=k;M[1]=h.max[1],k=t.aC(t.eG(),M,E),B=k[1]<B[1]?k:B,G=k[1]>G[1]?k:G,M[0]=h.max[0],k=t.aC(t.eG(),M,E),B=k[1]<B[1]?k:B,G=k[1]>G[1]?k:G,M[1]=h.min[1],k=t.aC(t.eG(),M,E),B=k[1]<B[1]?k:B,G=k[1]>G[1]?k:G;const J=t.aA(x[0],0,1),ee=100*r.pixelsPerMeter*t.aA(x[1],0,1),ce=t.aA(x[2],0,1),le=t.eH(t.eG(),B,G,J),he=Math.tan(.5*r.fovX),be=-le[2]*he;if(ee===0)return le[1]<-Math.abs(be)?ce:1;const _e=(-Math.abs(be)-le[1])/ee,ke=(Oe,He,Be)=>(1-Be)*Oe+Be*He,Ae=t.aA(ke(1,ce,_e),ce,1);return ke(1,Ae,t.aA((r.pitch-20)/20,0,1))}class oa{}class pa{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,h,x){{const ce=this._storage.get(h.id);if(ce)return ce.lastUsedFrameIdx=r,ce.buf}const E=x.gl,M=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),k=new ArrayBuffer(M),B=new Int16Array(k);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(k));const G=new t.eJ;for(let ce=0;ce<M/2;ce+=3){const le=B[ce],he=B[ce+1],be=B[ce+2];G.emplaceBack(le,he),G.emplaceBack(he,be),G.emplaceBack(be,le)}const J=x.bindVertexArrayOES.current,ee=new oa;return ee.buf=new Cc(x,G),ee.lastUsedFrameIdx=r,this._storage.set(h.id,ee),x.bindVertexArrayOES.set(J),ee.buf}update(r){for(const[h,x]of this._storage)r-x.lastUsedFrameIdx>30&&(x.buf.destroy(),this._storage.delete(h))}destroy(){for(const[r,h]of this._storage)h.buf.destroy(),this._storage.delete(r)}}class aa{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const na=t.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ma{constructor(r){this.revealStart=11,this.revealRange=2}}const fh=t.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Vu{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,h){const x=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const k=new t.eK,B=new t.b0;k.emplaceBack(-1,-1),k.emplaceBack(1,-1),k.emplaceBack(1,1),k.emplaceBack(-1,1),B.emplaceBack(0,1,2),B.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(k,fh.members),this.vignetteIdx=r.context.createIndexBuffer(B)}const E=t.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,x);const k={u_vignetteShape:(M={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};x.draw(r,r.context.gl.TRIANGLES,zn.disabled,sr.disabled,yr.alphaBlended,pr.disabled,k,"vignette",this.vignetteVx,this.vignetteIdx,E)}var M}}class gu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,h){const x=r.getFreeCameraOptions().position,E=x.toAltitude(),M=x.toLngLat(),k=t.an(M.lng),B=t.an(M.lat),G=r.pixelsPerMeter/h,J=k*t.eM,ee=t.eM*Math.log(Math.tan(Math.PI/4+B/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const ce=-this._offsetYPrev+ee,le=-this._elevationPrev+E;this._accumulatedOffsetX+=(-this._offsetXPrev+J)*G,this._accumulatedOffsetY+=ce*G,this._accumulatedElevation+=le*G,this._offsetXPrev=J,this._offsetYPrev=ee,this._elevationPrev=E}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function jl(v,r){return[-(v[0]-Math.floor(v[0]/r)*r),-(v[1]-Math.floor(v[1]/r)*r),-(v[2]-Math.floor(v[2]/r)*r)]}function bl(v){const r=t.eq(1323123451230),h=[];for(let x=0;x<v;++x){const E=2*r()-1,M=2*r()-1,k=2*r()-1;h.push(t.d5(E,M,k))}return h}function wl(v,r,h,x,E){const M=t.aA((E-h)/(x-h),0,1);return(1-M)*v+M*r}class Xc{constructor(r){this._movement=new gu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Vu,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,h){const x=r.transform;this._movement.update(x,this._ppmScaleFactor);const E=x.starsProjMatrix,M=t.c7([]);t.c9(M,M,t.an(90)-x._pitch),t.c8(M,M,-x.angle);const k=t.cc(new Float32Array(16),M),B=t.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),G=t.eg([],B),J=t.aB([],G,k),ee=Date.now()/1e3;return this._accumulatedTimeFromStart+=(ee-this._prevTime)*h,this._prevTime=ee,{projectionMatrix:E,modelviewMatrix:J}}}class mc extends Xc{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ma("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const h=r.context;if(!this.particlesVx){const x=bl(this.particlesCount),E=new t.eN,M=new t.b0;let k=0;const B=t.eq(1323123451230);for(let G=0;G<x.length;++G){const J=x[G],ee=[2*B()-1,B(),B(),B()];E.emplaceBack(J[0],J[1],J[2],-1,-1,...ee),E.emplaceBack(J[0],J[1],J[2],1,-1,...ee),E.emplaceBack(J[0],J[1],J[2],1,1,...ee),E.emplaceBack(J[0],J[1],J[2],-1,1,...ee),M.emplaceBack(k+0,k+1,k+2),M.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=h.createVertexBuffer(E,na.members),this.particlesIdx=h.createIndexBuffer(M)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=r.transform.zoom;if(h.revealStart>x)return;const E=wl(0,1,h.revealStart,h.revealStart+h.revealRange,x);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let k=[-M.direction.x,M.direction.y,-100];t.aw(k,k);const B=structuredClone(this._vignetteParams);B.strength*=E,M.overrideStyleParameters||(M.intensity=r.style.rain.state.density,M.timeFactor=r.style.rain.state.intensity,M.color=structuredClone(r.style.rain.state.color),k=structuredClone(r.style.rain.state.direction),M.screenThinning.intensity=r.style.rain.state.centerThinning,M.dropletSizeX=r.style.rain.state.dropletSize[0],M.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],M.distortionStrength=100*r.style.rain.state.distortionStrength,B.strength=1,B.color=structuredClone(r.style.rain.state.vignetteColor));const G=this.updateOnRender(r,M.timeFactor),J=r.context,ee=J.gl,ce=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new t.T(J,{width:r.width,height:r.height,data:null},ee.RGBA8)),M.distortionStrength>0&&(J.activeTexture.set(ee.TEXTURE0),this.screenTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ee.copyTexSubImage2D(ee.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const le=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(J,le),J.activeTexture.set(ee.TEXTURE0),this.screenTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const he=[M.color.r,M.color.g,M.color.b,M.color.a],be=(_e,ke)=>{const Ae=jl(this._movement.getPosition(),_e),Oe=M.dropletSizeX,He=M.dropletSizeX*M.dropletSizeYScale,Be=r.width/2,dt=r.height/2,nt=wl(0,M.screenThinning.start,0,1,M.screenThinning.intensity),at=wl(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),tt=wl(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),Je=(mt={modelview:G.modelviewMatrix,projection:G.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Ae,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:_e,rainDropletSize:[Oe,He],distortionStrength:M.distortionStrength,rainDirection:k,color:he,screenSize:[ce.width,ce.height],thinningCenterPos:[Be,dt],thinningShape:[nt,at,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:tt,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:ke?0:1},{u_modelview:Float32Array.from(mt.modelview),u_projection:Float32Array.from(mt.projection),u_time:mt.time,u_cam_pos:mt.camPos,u_texScreen:0,u_velocityConeAperture:mt.velocityConeAperture,u_velocity:mt.velocity,u_boxSize:mt.boxSize,u_rainDropletSize:mt.rainDropletSize,u_distortionStrength:mt.distortionStrength,u_rainDirection:mt.rainDirection,u_color:mt.color,u_screenSize:mt.screenSize,u_thinningCenterPos:mt.thinningCenterPos,u_thinningShape:mt.thinningShape,u_thinningAffectedRatio:mt.thinningAffectedRatio,u_thinningParticleOffset:mt.thinningParticleOffset,u_shapeDirectionalPower:mt.shapeDirectionalPower,u_shapeNormalPower:mt.shapeNormalPower,u_mode:mt.mode});var mt;const Pt=Math.round(M.intensity*this.particlesCount),It=t.bg.simpleSegment(0,0,4*Pt,2*Pt);le.draw(r,ee.TRIANGLES,zn.disabled,sr.disabled,yr.alphaBlended,pr.disabled,Je,"rain_particles",this.particlesVx,this.particlesIdx,It)};M.distortionStrength>0&&be(M.boxSize,!0),be(M.boxSize,!1),this._vignette.draw(r,B)}}const _u=t.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Yc extends Xc{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ma("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const h=r.context;if(!this.particlesVx){const x=bl(this.particlesCount),E=new t.eO,M=new t.b0;let k=0;const B=t.eq(1323123451230);for(let G=0;G<x.length;++G){const J=x[G],ee=B(),ce=B(),le=B(),he=[G/x.length,ee,ce,le],be=[B(),B()];E.emplaceBack(J[0],J[1],J[2],-1,-1,...he,...be),E.emplaceBack(J[0],J[1],J[2],1,-1,...he,...be),E.emplaceBack(J[0],J[1],J[2],1,1,...he,...be),E.emplaceBack(J[0],J[1],J[2],-1,1,...he,...be),M.emplaceBack(k+0,k+1,k+2),M.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=h.createVertexBuffer(E,_u.members),this.particlesIdx=h.createIndexBuffer(M)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const h=structuredClone(this._params);let x=[-h.direction.x,h.direction.y,-100];t.aw(x,x);const E=structuredClone(this._vignetteParams),M=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},k=r.transform.zoom;if(M.revealStart>k)return;const B=wl(0,1,M.revealStart,M.revealStart+M.revealRange,k);E.strength*=B,h.overrideStyleParameters||(h.intensity=r.style.snow.state.density,h.timeFactor=r.style.snow.state.intensity,h.color=structuredClone(r.style.snow.state.color),x=structuredClone(r.style.snow.state.direction),h.screenThinning.intensity=r.style.snow.state.centerThinning,h.billboardSize=2.79*r.style.snow.state.flakeSize,E.strength=1,E.color=structuredClone(r.style.snow.state.vignetteColor));const G=this.updateOnRender(r,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const J=r.context,ee=J.gl,ce=r.transform,le=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(J,le),((he,be,_e)=>{const ke=jl(this._movement.getPosition(),he),Ae=ce.width/2,Oe=ce.height/2,He=wl(0,_e.screenThinning.start,0,1,_e.screenThinning.intensity),Be=wl(.001,_e.screenThinning.range,0,1,_e.screenThinning.intensity),dt=wl(0,_e.screenThinning.particleOffset,0,1,_e.screenThinning.intensity),nt=(at={modelview:G.modelviewMatrix,projection:G.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ke,velocityConeAperture:_e.velocityConeAperture,velocity:_e.velocity,horizontalOscillationRadius:_e.horizontalOscillationRadius,horizontalOscillationRate:_e.horizontalOscillationRate,boxSize:he,billboardSize:1*_e.billboardSize,simpleShapeParameters:[_e.shapeFadeStart,_e.shapeFadePower],screenSize:[ce.width,ce.height],thinningCenterPos:[Ae,Oe],thinningShape:[He,Be,Math.pow(10,_e.screenThinning.fadePower)],thinningAffectedRatio:_e.screenThinning.affectedRatio,thinningParticleOffset:dt,color:[_e.color.r,_e.color.g,_e.color.b,_e.color.a],direction:x},{u_modelview:Float32Array.from(at.modelview),u_projection:Float32Array.from(at.projection),u_time:at.time,u_cam_pos:at.camPos,u_velocityConeAperture:at.velocityConeAperture,u_velocity:at.velocity,u_horizontalOscillationRadius:at.horizontalOscillationRadius,u_horizontalOscillationRate:at.horizontalOscillationRate,u_boxSize:at.boxSize,u_billboardSize:at.billboardSize,u_simpleShapeParameters:at.simpleShapeParameters,u_screenSize:at.screenSize,u_thinningCenterPos:at.thinningCenterPos,u_thinningShape:at.thinningShape,u_thinningAffectedRatio:at.thinningAffectedRatio,u_thinningParticleOffset:at.thinningParticleOffset,u_particleColor:at.color,u_direction:at.direction});var at;const tt=Math.round(_e.intensity*this.particlesCount),Je=t.bg.simpleSegment(0,0,4*tt,2*tt);this.particlesVx&&this.particlesIdx&&le.draw(r,ee.TRIANGLES,zn.disabled,sr.disabled,yr.alphaBlended,pr.disabled,nt,"snow_particles",this.particlesVx,this.particlesIdx,Je)})(h.boxSize,0,h),this._vignette.draw(r,E)}}const Ml={symbol:function(v,r,h,x,E){if(v.renderPass!=="translucent")return;const M=sr.disabled,k=v.colorModeForRenderPass(),B=h.layout.get("text-variable-anchor"),G=h.layout.get("text-size-scale-range"),J=t.aA(v.scaleFactor,G[0],G[1]);B&&(function(le,he,be,_e,ke,Ae,Oe,He){const Be=he.transform,dt=ke==="map",nt=Ae==="map";for(const at of le){const tt=_e.getTile(at),Je=tt.getBucket(be);if(!Je||!Je.text||!Je.text.segments.get().length)continue;const mt=t.bK(Je.textSizeData,Be.zoom,He),Pt=Cs(at,Je.getProjection(),Be),It=Be.calculatePixelsToTileUnitsMatrix(tt),ri=Jo(Pt,tt.tileID.canonical,nt,dt,Be,Je.getProjection(),It),si=Je.hasIconTextFit()&&Je.hasIconData();mt&&Hn(Je,dt,nt,Oe,Be,ri,at,Math.pow(2,Be.zoom-tt.tileID.overscaledZ),mt,si)}})(x,v,h,r,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E,J);const ee=h.paint.get("icon-opacity").constantOr(1)!==0,ce=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(ee||ce)?Gh(v,r,h,x,M,k):(ee&&Gh(v,r,h,x,M,k,{onlyIcons:!0}),ce&&Gh(v,r,h,x,M,k,{onlyText:!0})),r.map.showCollisionBoxes&&(Cn(v,r,h,x,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Cn(v,r,h,x,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(v,r,h,x){if(v.renderPass!=="translucent")return;const E=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),k=h.paint.get("circle-stroke-opacity"),B=h.layout.get("circle-sort-key").constantOr(1)!==void 0,G=h.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(M.constantOr(1)===0||k.constantOr(1)===0))return;const J=v.context,ee=J.gl,ce=v.transform,le=!(!v.terrain||!v.terrain.enabled),he=h.layout.get("circle-elevation-reference"),be=v.depthModeForSublayer(0,zn.ReadOnly),_e=new zn(v.context.gl.LEQUAL,zn.ReadOnly,v.depthRangeFor3D),ke=he==="none"||le?be:_e,Ae=sr.disabled,Oe=v.colorModeForDrapableLayerRenderPass(G),He=ce.projection.name==="globe",Be=[t.aF(ce.center.lng),t.aJ(ce.center.lat)],dt=[];for(let at=0;at<x.length;at++){const tt=x[at],Je=r.getTile(tt),mt=Je.getBucket(h);if(!mt||mt.projection.name!==ce.projection.name)continue;const Pt=mt.programConfigurations.get(h.id),It=mt.layoutVertexBuffer,ri=mt.globeExtVertexBuffer,si=mt.indexBuffer,_i=t.e0(h),Vi=[ri],Kt=v.isTileAffectedByFog(tt);He&&_i.push("PROJECTION_GLOBE_VIEW"),_i.push("DEPTH_D24"),v.terrain&&ce.depthOcclusionForSymbolsAndCircles&&_i.push("DEPTH_OCCLUSION"),mt.hasElevation&&!v.terrain&&(_i.push("ELEVATED_ROADS"),Vi.push(mt.elevatedLayoutVertexBuffer));const bt=v.getOrCreateProgram("circle",{config:Pt,defines:_i,overrideFog:Kt}),oi=ce.projection.createInversionMatrix(ce,tt.canonical),ni={programConfiguration:Pt,program:bt,layoutVertexBuffer:It,dynamicBuffers:Vi,indexBuffer:si,uniformValues:t.e1(v,tt,Je,oi,Be,h),tile:Je};if(B){const Li=mt.segments.get();for(const en of Li)dt.push({segments:new t.bg([en]),sortKey:en.sortKey,state:ni})}else dt.push({segments:mt.segments,sortKey:0,state:ni})}B&&dt.sort(((at,tt)=>at.sortKey-tt.sortKey));const nt={useDepthForOcclusion:ce.depthOcclusionForSymbolsAndCircles};for(const at of dt){const{programConfiguration:tt,program:Je,layoutVertexBuffer:mt,dynamicBuffers:Pt,indexBuffer:It,uniformValues:ri,tile:si}=at.state,_i=at.segments;v.terrain&&v.terrain.setupElevationDraw(si,Je,nt),v.uploadCommonUniforms(J,Je,si.tileID.toUnwrapped()),Je.draw(v,ee.TRIANGLES,ke,Ae,Oe,pr.disabled,ri,h.id,mt,It,_i,h.paint,ce.zoom,tt,Pt)}},heatmap:function(v,r,h,x){if(h.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const E=v.context,M=E.gl,k=sr.disabled,B=new yr([M.ONE,M.ONE,M.ONE,M.ONE],t.ao.transparent,[!0,!0,!0,!0]);(function(he,be,_e,ke){const Ae=he.gl,Oe=be.width*ke,He=be.height*ke;he.activeTexture.set(Ae.TEXTURE1),he.viewport.set([0,0,Oe,He]);let Be=_e.heatmapFbo;if(!Be||Be&&(Be.width!==Oe||Be.height!==He)){Be&&Be.destroy();const dt=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,dt),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Be=_e.heatmapFbo=he.createFramebuffer(Oe,He,1,null),(function(nt,at,tt,Je,mt,Pt){const It=nt.gl;It.texImage2D(It.TEXTURE_2D,0,nt.extRenderToTextureHalfFloat?It.RGBA16F:It.RGBA,mt,Pt,0,It.RGBA,nt.extRenderToTextureHalfFloat?It.HALF_FLOAT:It.UNSIGNED_BYTE,null),Je.colorAttachment0.set(tt)})(he,0,dt,Be,Oe,He)}else Ae.bindTexture(Ae.TEXTURE_2D,Be.colorAttachment0.get()),he.bindFramebuffer.set(Be.framebuffer)})(E,v,h,v.transform.projection.name==="globe"?.5:.25),E.clear({color:t.ao.transparent});const G=v.transform,J=G.projection.name==="globe",ee=J?["PROJECTION_GLOBE_VIEW"]:[],ce=J?pr.frontCCW:pr.disabled,le=[t.aF(G.center.lng),t.aJ(G.center.lat)];for(let he=0;he<x.length;he++){const be=x[he];if(r.hasRenderableParent(be))continue;const _e=r.getTile(be),ke=_e.getBucket(h);if(!ke||ke.projection.name!==G.projection.name)continue;const Ae=v.isTileAffectedByFog(be),Oe=ke.programConfigurations.get(h.id),He=v.getOrCreateProgram("heatmap",{config:Oe,defines:ee,overrideFog:Ae}),{zoom:Be}=v.transform;v.terrain&&v.terrain.setupElevationDraw(_e,He),v.uploadCommonUniforms(E,He,be.toUnwrapped());const dt=G.projection.createInversionMatrix(G,be.canonical);He.draw(v,M.TRIANGLES,zn.disabled,k,B,ce,Yg(v,be,_e,dt,le,Be,h.paint.get("heatmap-intensity")),h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,h.paint,v.transform.zoom,Oe,J?[ke.globeExtVertexBuffer]:null)}E.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),(function(E,M){const k=E.context,B=k.gl,G=M.heatmapFbo;if(!G)return;k.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment0.get()),k.activeTexture.set(B.TEXTURE1);let J=M.colorRampTexture;J||(J=M.colorRampTexture=new t.T(k,M.colorRamp,B.RGBA8)),J.bind(B.LINEAR,B.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,B.TRIANGLES,zn.disabled,sr.disabled,E.colorModeForRenderPass(),pr.disabled,((ee,ce,le,he)=>({u_image:0,u_color_ramp:1,u_opacity:ce.paint.get("heatmap-opacity")}))(0,M),M.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,M.paint,E.transform.zoom)})(v,h))},line:function(v,r,h,x){if(v.renderPass!=="translucent")return;const E=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(E.constantOr(1)===0||M.constantOr(1)===0)return;const k=h.paint.get("line-emissive-strength").isConstant(),B=h.paint.get("line-emissive-strength").constantOr(0),G=h.paint.get("line-occlusion-opacity"),J=h.layout.get("line-elevation-reference"),ee=h.layout.get("line-width-unit")==="meters",ce=J==="sea",le=!(!v.terrain||!v.terrain.enabled),he=v.context,be=he.gl;if(h.hasElevatedBuckets&&v.transform.projection.name==="globe")return;const _e=h.layout.get("line-cross-slope"),ke=_e!==void 0,Ae=_e<1,Oe=v.colorModeForDrapableLayerRenderPass(k?B:null),He=v.terrain&&v.terrain.renderingToTexture,Be=He?1:t.o.devicePixelRatio,dt=h.paint.get("line-dasharray"),nt=dt.constantOr(1),at=h.layout.get("line-cap"),tt=dt.constantOr(null),Je=at.constantOr(null),mt=h.paint.get("line-pattern"),Pt=mt.constantOr(1),It=h.paint.get("line-pattern-cross-fade"),ri=mt.constantOr(null),si=h.paint.get("line-opacity").constantOr(1);let _i=!Pt&&si!==1||v.depthOcclusion&&G>0&&G<1;const Vi=h.paint.get("line-gradient"),Kt=Pt?"linePattern":"line",bt=t.e2(h);let oi;if(He&&v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(_i=!1),G!==0&&v.depthOcclusion){const xn=h.paint._values["line-opacity"];xn&&xn.value&&xn.value.kind==="constant"?oi=xn.value:t.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}M.value.kind!=="constant"&&M.value.isLineProgressConstant===!1&&bt.push("VARIABLE_LINE_WIDTH"),He&&(v.emissiveMode!=="dual-source-blending"||k?v.emissiveMode==="mrt-fallback"&&bt.push("USE_MRT1"):bt.push("DUAL_SOURCE_BLENDING"));const ni=(xn,Yi,Wi,kn,Pn,pn)=>{for(const Tn of xn){const Kn=r.getTile(Tn);if(Pt&&!Kn.patternsLoaded())continue;const Er=Kn.getBucket(h);if(!Er||Er.elevationType!=="none"&&!Pn||Er.elevationType==="none"&&Pn)continue;v.prepareDrawTile();const ts=[...Yi],ys=v.shadowRenderer,Ln=Er.elevationType==="road"&&!!ys&&ys.enabled;let fs=[0,0,0];if(Ln){const Pr=v.style.directionalLight,co=v.style.ambientLight;Pr&&co&&(fs=sh(v.style,Pr,co)),ts.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const br=Er.programConfigurations.get(h.id);let Ts=!1;if(ri&&Kn.imageAtlas){const Pr=t.e3.from(ri),co=Pr.getPrimary().scaleSelf(Be).toString(),Ss=Kn.imageAtlas.patternPositions.get(co),uo=Pr.getSecondary(),Zs=uo?Kn.imageAtlas.patternPositions.get(uo.scaleSelf(Be).toString()):null;Ts=!!Ss&&!!Zs,Ss&&br.setConstantPatternPositions(Ss,Zs)}It>0&&(Ts||br.getPatternTransitionVertexBuffer("line-pattern"))&&ts.push("LINE_PATTERN_TRANSITION");const zs=v.isTileAffectedByFog(Tn),Os=v.getOrCreateProgram(Kt,{config:br,defines:ts,overrideFog:zs});if(!Pt&&tt&&Je&&Kn.lineAtlas){const Pr=Kn.lineAtlas.getDash(tt,Je);Pr&&br.setConstantPatternPositions(Pr)}Ln&&ys.setupShadows(Kn.tileID.toUnwrapped(),Os,"vector-tile");let[ls,Ar]=h.paint.get("line-trim-offset");(Je==="round"||Je==="square")&&ls!==Ar&&(ls===0&&(ls-=1),Ar===1&&(Ar+=1));const vs=He?Tn.projMatrix:null,ko=ee?1/Er.tileToMeter/t.ay(Kn,1,v.transform.zoom):1,yo=ee?1/Er.tileToMeter/t.ay(Kn,1,Math.floor(v.transform.zoom)):1,Ms=Pt?t.e4(v,Kn,h,vs,Be,ko,yo,[ls,Ar],fs,It):t.e5(v,Kn,h,vs,Er.lineClipsArray.length,Be,ko,yo,[ls,Ar],fs);if(Vi){const Pr=Er.gradients[h.id];let co=Pr.texture;if(h.gradientVersion!==Pr.version){let Ss=256;if(h.stepInterpolant){const uo=r.getSource().maxzoom,Zs=Tn.canonical.z===uo?Math.ceil(1<<v.transform.maxZoom-Tn.canonical.z):1;Ss=t.aA(t.e6(Er.maxLineLength/t.al*1024*Zs),256,he.maxTextureSize)}Pr.gradient=t.e7({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ss,image:Pr.gradient||void 0,clips:Er.lineClipsArray}),Pr.texture?Pr.texture.update(Pr.gradient):Pr.texture=new t.T(he,Pr.gradient,be.RGBA8),Pr.version=h.gradientVersion,co=Pr.texture}he.activeTexture.set(be.TEXTURE1),co.bind(h.stepInterpolant?be.NEAREST:be.LINEAR,be.CLAMP_TO_EDGE)}nt&&(he.activeTexture.set(be.TEXTURE0),Kn.lineAtlasTexture&&Kn.lineAtlasTexture.bind(be.LINEAR,be.REPEAT),br.updatePaintBuffers()),Pt&&(he.activeTexture.set(be.TEXTURE0),Kn.imageAtlasTexture&&Kn.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),br.updatePaintBuffers()),Pn&&!ce&&v.terrain.setupElevationDraw(Kn,Os),v.uploadCommonUniforms(he,Os,Tn.toUnwrapped());const cs=Pr=>{oi!=null&&(oi.value=si*G),Os.draw(v,be.TRIANGLES,Wi,Pr,Oe,pr.disabled,Ms,h.id,Er.layoutVertexBuffer,Er.indexBuffer,Er.segments,h.paint,v.transform.zoom,br,[Er.layoutVertexBuffer2,Er.patternVertexBuffer,Er.zOffsetVertexBuffer]),oi!=null&&(oi.value=si)};if(_i&&!Pn){const Pr=v.stencilModeForClipping(Tn).ref;Pr===0&&He&&he.clear({stencil:0});const co={func:be.EQUAL,mask:255};Ms.u_alpha_discard_threshold=.8,cs(new sr(co,Pr,255,be.KEEP,be.KEEP,be.INVERT)),Ms.u_alpha_discard_threshold=0,cs(new sr(co,Pr,255,be.KEEP,be.KEEP,be.KEEP))}else Ms.u_alpha_discard_threshold=_i&&Pn&&pn?.8:0,cs(Pn?kn:v.stencilModeForClipping(Tn))}};let Li=v.depthModeForSublayer(0,zn.ReadOnly);const en=new zn(v.depthOcclusion?be.GREATER:be.LEQUAL,zn.ReadOnly,v.depthRangeFor3D);if(h.hasNonElevatedBuckets){const xn=!He&&v.terrain;G!==0&&xn?t.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):xn?t.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):ni(x,bt,Li,sr.disabled,!1,!0)}if(h.hasElevatedBuckets){J==="hd-road-markup"?le||(Li=en,bt.push("ELEVATED_ROADS")):(bt.push("ELEVATED"),Li=en,ke&&bt.push(Ae?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ce&&bt.push("ELEVATION_REFERENCE_SEA"));const xn=_i?v.stencilModeFor3D():sr.disabled;v.forceTerrainMode=!0,ni(x,bt,Li,xn,!0,!0),_i&&ni(x,bt,Li,xn,!0,!1),v.forceTerrainMode=!1}_i&&(v.resetStencilClippingMasks(),He&&he.clear({stencil:0})),G===0||v.depthOcclusion||He||v.layersWithOcclusionOpacity.push(v.currentLayer)},fill:function(v,r,h,x){const E=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const k=h.paint.get("fill-emissive-strength"),B=v.colorModeForDrapableLayerRenderPass(k),G=h.paint.get("fill-pattern"),J=v.opaquePassEnabledForLayer()&&!G.constantOr(1)&&E.constantOr(t.ao.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";let ee="none";h.layout.get("fill-elevation-reference")!=="none"?ee="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(ee="offset");const ce=!(!v.terrain||!v.terrain.enabled),le={painter:v,sourceCache:r,layer:h,coords:x,colorMode:B,elevationType:ee,terrainEnabled:ce,pass:J};if(v.renderPass==="shadow")return void(v.shadowRenderer&&ee==="road"&&!ce&&(function(be){const{painter:_e,sourceCache:ke,layer:Ae,coords:Oe}=be,He=_e.context.gl,Be=be.painter.shadowRenderer;for(const dt of Oe){const nt=ke.getTile(dt),at=nt.getBucket(Ae);if(!at)continue;const tt=at.elevatedStructures;if(!tt||!tt.shadowCasterSegments||tt.shadowCasterSegments.segments[0].primitiveLength===0)continue;_e.prepareDrawTile();const Je=at.bufferData.programConfigurations.get(Ae.id),mt=_e.isTileAffectedByFog(dt),Pt=_e.getOrCreateProgram("elevatedStructuresDepth",{config:Je,overrideFog:mt}),It=Be.calculateShadowPassMatrixFromTile(nt.tileID.toUnwrapped());_e.uploadCommonUniforms(_e.context,Pt,dt.toUnwrapped());const ri={u_matrix:It,u_depth_bias:0};Pt.draw(_e,He.TRIANGLES,Be.getShadowPassDepthMode(),sr.disabled,Be.getShadowPassColorMode(),pr.disabled,ri,Ae.id,tt.vertexBuffer,tt.indexBuffer,tt.shadowCasterSegments,Ae.paint,_e.transform.zoom,Je)}})(le));const he=v.emissiveMode==="mrt-fallback";if(ee!=="offset"){if(up(le,!1,he),ee==="road"){const be=!ce&&v.renderPass==="translucent";be&&Ef(v,r,h,x,"geometry"),up(le,!0,he,sr.disabled),be&&(function(_e){const{painter:ke,sourceCache:Ae,layer:Oe,coords:He,colorMode:Be}=_e,dt=ke.context.gl,nt=_e.painter.shadowRenderer,at=!!nt&&nt.enabled,tt=new zn(ke.context.gl.LEQUAL,zn.ReadOnly,ke.depthRangeFor3D);let Je=[0,0,0];if(at){const Pt=ke.style.directionalLight,It=ke.style.ambientLight;Pt&&It&&(Je=sh(ke.style,Pt,It))}const mt=Pt=>{for(const It of He){const ri=Ae.getTile(It),si=ri.getBucket(Oe);if(!si)continue;const _i=si.elevatedStructures;if(!_i)continue;let Vi,Kt;if(Pt?(Vi=_i.renderableBridgeSegments,Kt=_i.bridgeProgramConfigurations.get(Oe.id)):(Vi=_i.renderableTunnelSegments,Kt=_i.tunnelProgramConfigurations.get(Oe.id)),!Vi||Vi.segments[0].primitiveLength===0)continue;Kt.updatePaintBuffers(),ke.prepareDrawTile();const bt=ke.isTileAffectedByFog(It),oi=[];at&&oi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ni=ke.getOrCreateProgram("elevatedStructures",{config:Kt,overrideFog:bt,defines:oi}),Li=ke.translatePosMatrix(It.projMatrix,ri,Oe.paint.get("fill-translate"),Oe.paint.get("fill-translate-anchor"));at&&nt.setupShadows(ri.tileID.toUnwrapped(),ni,"vector-tile");const en=Dd(Li,Je);ke.uploadCommonUniforms(ke.context,ni,It.toUnwrapped()),ni.draw(ke,dt.TRIANGLES,tt,sr.disabled,Be,pr.backCCW,en,Oe.id,_i.vertexBuffer,_i.indexBuffer,Vi,Oe.paint,ke.transform.zoom,Kt,[_i.vertexBufferNormal])}};mt(!0),mt(!1)})(le)}}else up(le,!1,he,v.stencilModeFor3D())},"fill-extrusion":function(v,r,h,x){const E=h.paint.get("fill-extrusion-opacity"),M=v.context,k=M.gl,B=v.terrain,G=B&&B.renderingToTexture;if(E===0)return;const J=v.emissiveMode==="mrt-fallback",ee=v.conflationActive&&v.style.isLayerClipped(h,r.getSource()),ce=v.style.order.indexOf(h.fqid);if(ee&&(function(le,he,be,_e,ke){for(const Ae of _e){const Oe=he.getTile(Ae).getBucket(be);Oe&&(Oe.updateReplacement(Ae,le.replacementSource,ke),Oe.uploadCentroid(le.context))}})(v,r,h,x,ce),B||ee)for(const le of x){const he=r.getTile(le).getBucket(h);he&&Xp(v.context,r,le,he,h,B,ee)}if(v.renderPass==="shadow"&&v.shadowRenderer){const le=v.shadowRenderer;if(B&&E<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.ad)return;const he=le.getShadowPassDepthMode(),be=le.getShadowPassColorMode();Ld(v,r,h,x,he,sr.disabled,be,ee)}else if(v.renderPass==="translucent"){const le=!h.paint.get("fill-extrusion-pattern").constantOr(1),he=h.paint.get("fill-extrusion-color").constantOr(t.ao.white);if(!G&&he.a!==0){const be=new zn(v.context.gl.LEQUAL,zn.ReadWrite,v.depthRangeFor3D);E===1&&le?Ld(v,r,h,x,be,sr.disabled,yr.unblended,ee):(Ld(v,r,h,x,be,sr.disabled,yr.disabled,ee),Ld(v,r,h,x,be,v.stencilModeFor3D(),v.colorModeForRenderPass(),ee),v.resetStencilClippingMasks())}if(v.style.enable3dLights()&&le&&(!B&&v.transform.projection.name!=="globe"||G)){const be=h.paint.get("fill-extrusion-opacity"),_e=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ke=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Ae=h.paint.get("fill-extrusion-flood-light-intensity"),Oe=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Oe?null:h.lut).toArray01().slice(0,3),Be=_e>0&&ke>0,dt=Ae>0,nt=(Je,mt,Pt)=>(1-Pt)*Je+Pt*mt,at=new Fu;at.translate=h.paint.get("fill-extrusion-translate"),at.translateAnchor=h.paint.get("fill-extrusion-translate-anchor"),at.edgeRadius=h.layout.get("fill-extrusion-edge-radius"),at.cutoffFadeRange=h.paint.get("fill-extrusion-cutoff-fade-range");const tt=Je=>{const mt=v.depthModeForSublayer(1,zn.ReadOnly,k.LEQUAL,!0),Pt=h.paint.get(Je?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),It=nt(.1,3,Pt),ri=v._showOverdrawInspector;if(!ri){const si=new sr({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),_i=new yr([k.ONE,k.ONE,k.ONE,k.ONE],t.ao.transparent,[!1,!1,!1,!0],k.MIN);pu(at,v,r,h,x,mt,si,_i,pr.disabled,Je,"sdf",be,_e,ke,Ae,He,It,ee,!1)}{const si=ri?sr.disabled:new sr({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),_i=ri?v.colorModeForRenderPass():new yr([k.ONE_MINUS_DST_ALPHA,k.DST_ALPHA,k.ONE,k.ONE],t.ao.transparent,[!0,!0,!0,!0]);pu(at,v,r,h,x,mt,si,_i,pr.disabled,Je,"color",be,_e,ke,Ae,He,It,ee,!1)}};if(G){const Je=()=>{const Pt=B.drapeBufferSize[0],It=B.drapeBufferSize[1];let ri=B.framebufferCopyTexture;return ri&&(!ri||ri.size[0]===Pt&&ri.size[1]===It)||(ri&&ri.destroy(),ri=B.framebufferCopyTexture=new t.T(M,new t.q({width:Pt,height:It}),k.RGBA8)),ri.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,Pt,It),ri},mt=(Pt,It,ri)=>{const si=v.depthModeForSublayer(1,zn.ReadOnly,k.LEQUAL,!1),_i=h.paint.get(Pt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Vi=nt(.1,3,_i);{const Kt=new yr([k.ONE,k.ONE,k.ONE,k.ONE],t.ao.transparent,[!1,!1,!1,!0]);pu(at,v,r,h,x,si,sr.disabled,Kt,pr.disabled,Pt,"clear",be,_e,ke,Ae,He,Vi,ee,It)}{const Kt=new sr({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),bt=new yr([k.ONE,k.ONE,k.ONE,k.ONE],t.ao.transparent,[!1,!1,!1,!0],k.MIN);pu(at,v,r,h,x,si,Kt,bt,pr.disabled,Pt,"sdf",be,_e,ke,Ae,He,Vi,ee,It)}J&&!Pt&&(ri=Je());{const Kt=Pt?k.ZERO:k.ONE_MINUS_DST_ALPHA,bt=new sr({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),oi=new yr([Kt,k.DST_ALPHA,k.ONE_MINUS_DST_ALPHA,k.ZERO],t.ao.transparent,[!0,!0,!0,!0]);pu(at,v,r,h,x,si,bt,oi,pr.disabled,Pt,"color",be,_e,ke,Ae,He,Vi,ee,It)}if(!J||Pt){const Kt=new yr([k.ONE,k.ONE,k.ONE,Pt?k.ZERO:k.ONE],t.ao.transparent,[!1,!1,!1,!0],Pt?k.FUNC_ADD:k.MAX);pu(at,v,r,h,x,si,sr.disabled,Kt,pr.disabled,Pt,"clear",be,_e,ke,Ae,He,Vi,ee,It,ri)}else{k.drawBuffers([k.NONE,k.COLOR_ATTACHMENT1]);const Kt=new sr({func:k.EQUAL,mask:255},254,255,k.KEEP,k.DECR,k.DECR),bt=new yr([k.ONE,k.ONE,k.ONE,k.ONE],t.ao.transparent,[!0,!1,!1,!1],k.MAX);pu(at,v,r,h,x,si,Kt,bt,pr.disabled,Pt,"emissive",be,_e,ke,Ae,He,Vi,ee,It,ri),k.drawBuffers([k.COLOR_ATTACHMENT0])}};if(Be||dt){let Pt;v.prepareDrawTile(),J&&!Be||(Pt=Je()),Be&&mt(!0,!1,Pt),dt&&mt(!1,!0,Pt)}}else Be&&tt(!0),dt&&tt(!1),(Be||dt)&&v.resetStencilClippingMasks()}}},building:function(v,r,h,x){v.currentLayer<v.firstLightBeamLayer&&(v.firstLightBeamLayer=v.currentLayer);const E=h.paint.get("building-ambient-occlusion-ground-intensity"),M=h.paint.get("building-ambient-occlusion-ground-radius"),k=h.paint.get("building-ambient-occlusion-ground-attenuation"),B=h.paint.get("building-opacity");if(B<=0)return;let G=E>0&&M>0,J=!0;const ee=h.paint.get("building-vertical-scale");if(ee<=0)return;v.shadowRenderer||(J=!1);const ce=v.conflationActive&&v.style.isLayerClipped(h,r.getSource()),le=v.style.order.indexOf(h.fqid);if((function(he,be,_e,ke,Ae,Oe){for(const He of Oe){const Be=be.getTile(He).getBucket(_e);Be&&(Ae&&Be.updateReplacement(He,he.replacementSource,ke),Be.uploadUpdatedIndexBuffer(he.context))}})(v,r,h,le,ce,x),(function(he,be,_e,ke){for(const Ae of ke){const Oe=be.getTile(Ae).getBucket(_e);Oe&&Oe.needsEvaluation()&&Oe.uploadUpdatedColorBuffer(he.context)}})(v,r,h,x),h.resetLayerRenderingStats(v),v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0),v.renderPass==="shadow"&&v.shadowRenderer){const he=v.shadowRenderer,be=[],_e=he.getShadowPassDepthMode();Bu({painter:v,source:r,layer:h,coords:x,defines:be,blendMode:he.getShadowPassColorMode(),depthMode:_e,opacity:B,verticalScale:ee,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(v.renderPass==="translucent"){let he=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];J&&(he=he.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),v.shadowRenderer&&v.shadowRenderer.useNormalOffset&&(he=he.concat("NORMAL_OFFSET"));const be=h.paint.get("building-facade-emissive-chance"),_e=h.paint.get("building-ambient-occlusion-intensity"),ke=h.paint.get("building-flood-light-intensity"),Ae=h.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Oe=h.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(Ae?null:h.lut).toArray01().slice(0,3),He=h.paint.get("building-flood-light-ground-attenuation"),Be=ke>0,dt=new zn(v.context.gl.LEQUAL,zn.ReadWrite,v.depthRangeFor3D);B<1&&Bu({painter:v,source:r,layer:h,coords:x,defines:he,blendMode:yr.disabled,depthMode:dt,opacity:B,verticalScale:ee,facadeEmissiveChance:be,facadeAOIntensity:_e,floodLightIntensity:ke,floodLightColor:Oe,depthOnly:!0});const nt=v.colorModeForRenderPass();Bu({painter:v,source:r,layer:h,coords:x,defines:he,blendMode:nt,depthMode:dt,opacity:B,verticalScale:ee,facadeEmissiveChance:be,facadeAOIntensity:_e,floodLightIntensity:ke,floodLightColor:Oe}),G&&hp(v,r,h,x,!0,B,E,M,ke,Oe,k,ce),Be&&hp(v,r,h,x,!1,B,E,M,ke,Oe,He,ce)}else if(v.renderPass==="light-beam"){const he=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],be=new zn(v.context.gl.LEQUAL,zn.ReadOnly,v.depthRangeFor3D);Bu({painter:v,source:r,layer:h,coords:x,defines:he,blendMode:yr.alphaBlended,depthMode:be,opacity:B,verticalScale:ee,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1),v.resetStencilClippingMasks()},hillshade:function(v,r,h,x){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent"||v.style.disableElevatedTerrain)return;const E=v.context,M=v.terrain&&v.terrain.renderingToTexture,[k,B]=v.renderPass!=="translucent"||M?[{},x]:v.stencilConfigForOverlap(x);for(const G of B){const J=r.getTile(G);if(J.needsHillshadePrepare&&v.renderPass==="offscreen")df(v,J,h);else if(v.renderPass==="translucent"){const ee=v.depthModeForSublayer(0,zn.ReadOnly),ce=h.paint.get("hillshade-emissive-strength"),le=v.colorModeForDrapableLayerRenderPass(ce),he=M&&v.terrain?v.terrain.stencilModeForRTTOverlap(G):k[G.overscaledZ];Um(v,G,J,h,ee,he,le)}}E.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,r,h,x,E,M){if(v.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const k=v.transform.projection.name==="globe",B=h.paint.get("raster-elevation")!==0,G=B&&k;if(v.renderElevatedRasterBackface&&!G)return;const J=v.context,ee=J.gl,ce=r.getSource(),le=(function(nt,at,tt,Je,mt){const Pt=at.paint.get("raster-color"),It=nt.type==="raster-array",ri=[],si=at.paint.get("raster-resampling"),_i=at.paint.get("raster-color-mix");let Vi=at.paint.get("raster-color-range");const Kt=[_i[0],_i[1],_i[2],0],bt=_i[3];let oi=si==="nearest"?Je.NEAREST:Je.LINEAR;if(It&&(ri.push("RASTER_ARRAY"),Pt||ri.push("RASTER_COLOR"),si==="linear"&&ri.push("RASTER_ARRAY_LINEAR"),oi=Je.NEAREST,!Vi&&nt.rasterLayers)){const ni=nt.rasterLayers.find((({id:Li})=>Li===at.sourceLayer));ni&&ni.fields&&ni.fields.range&&(Vi=ni.fields.range)}if(Vi=Vi||[0,1],Pt){ri.push("RASTER_COLOR"),tt.activeTexture.set(Je.TEXTURE2),at.updateColorRamp(Vi);let ni=at.colorRampTexture;ni||(ni=at.colorRampTexture=new t.T(tt,at.colorRamp,Je.RGBA8)),ni.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}return mt&&ri.push("USE_MRT1"),{mix:Kt,range:Vi,offset:bt,defines:ri,resampling:oi}})(ce,h,J,ee,v.terrain&&v.terrain.renderingToTexture&&v.emissiveMode==="mrt-fallback");if(ce instanceof t.aU&&!x.length&&!k)return;const he=h.paint.get("raster-emissive-strength"),be=v.colorModeForDrapableLayerRenderPass(he),_e=v.terrain&&v.terrain.renderingToTexture,ke=!v.options.moving,Ae=h.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;if(ce instanceof t.aU&&!x.length&&(ce.onNorthPole||ce.onSouthPole)){const nt=B?v.stencilModeFor3D():sr.disabled;return void Nu(!!ce.onNorthPole,null,v,r,h,he,le,pr.disabled,nt)}if(!x.length)return;const[Oe,He]=ce instanceof t.aU||_e?[{},x]:v.stencilConfigForOverlap(x),Be=He[He.length-1].overscaledZ;G&&le.defines.push("PROJECTION_GLOBE_VIEW"),B&&le.defines.push("RENDER_CUTOFF");const dt=(nt,at,tt)=>{for(const Je of nt){const mt=Je.toUnwrapped(),Pt=r.getTile(Je);if(_e&&(!Pt||!Pt.hasData()))continue;J.activeTexture.set(ee.TEXTURE0);const It=mu(Pt,ce,h,le);if(!It||!It.texture)continue;const{texture:ri,mix:si,offset:_i,tileSize:Vi,buffer:Kt}=It;let bt,oi;_e?(bt=zn.disabled,oi=Je.projMatrix):B?(bt=new zn(ee.LEQUAL,zn.ReadWrite,v.depthRangeFor3D),oi=k?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(mt,ke)):(bt=v.depthModeForSublayer(Je.overscaledZ-Be,h.paint.get("raster-opacity")===1?zn.ReadWrite:zn.ReadOnly,ee.LESS),oi=v.transform.calculateProjMatrix(mt,ke));const ni=v.terrain&&_e?v.terrain.stencilModeForRTTOverlap(Je):Oe[Je.overscaledZ],Li=M?0:h.paint.get("raster-fade-duration");Pt.registerFadeDuration(Li);const en=r.findLoadedParent(Je,0),xn=jh(Pt,en,r,v.transform,Li);let Yi,Wi;!xn.isFading&&Pt.refreshedUponExpiration&&(Pt.refreshedUponExpiration=!1),v.terrain&&v.terrain.prepareDrawTile(),J.activeTexture.set(ee.TEXTURE0),ri.bind(Ae,ee.CLAMP_TO_EDGE),J.activeTexture.set(ee.TEXTURE1),en?(en.texture&&en.texture.bind(Ae,ee.CLAMP_TO_EDGE),Yi=Math.pow(2,en.tileID.overscaledZ-Pt.tileID.overscaledZ),Wi=[Pt.tileID.canonical.x*Yi%1,Pt.tileID.canonical.y*Yi%1]):ri.bind(Ae,ee.CLAMP_TO_EDGE),"useMipmap"in ri&&J.extTextureFilterAnisotropic&&v.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const kn=v.transform;let Pn;const pn=B?Jm(kn):[0,0,0,0];let Tn,Kn,Er,ts,ys,Ln=0;if(G&&ce instanceof t.aU&&ce.coordinates.length>3)Tn=Float32Array.from(t.bk(t.dJ(new t.cD(0,0,0)))),Kn=Float32Array.from(kn.globeMatrix),Er=Float32Array.from(t.dF(kn)),ts=[t.aF(kn.center.lng),t.aJ(kn.center.lat)],Pn=ce.elevatedGlobePerspectiveTransform,ys=ce.elevatedGlobeGridMatrix||new Float32Array(9);else if(G){const zs=t.dG(Je.canonical);Ln=t.dH(zs.getCenter().lat),Tn=Float32Array.from(t.bk(t.dJ(Je.canonical))),Kn=Float32Array.from(kn.globeMatrix),Er=Float32Array.from(t.dF(kn)),ts=[t.aF(kn.center.lng),t.aJ(kn.center.lat)],Pn=[0,0],ys=Float32Array.from(t.dI(Je.canonical,zs,Ln,kn.worldSize/kn._pixelsPerMercatorPixel))}else Pn=ce instanceof t.aU?ce.perspectiveTransform:[0,0],Tn=new Float32Array(16),Kn=new Float32Array(9),Er=new Float32Array(16),ts=[0,0],ys=new Float32Array(9);const fs=cy(oi,Tn,Kn,Er,ys,Wi||[0,0],t.aj(v.transform.zoom),ts,pn,Yi||1,xn,h,Pn,B?h.paint.get("raster-elevation"):0,2,si,_i,le.range,Vi,Kt,he),br=v.isTileAffectedByFog(Je),Ts=v.getOrCreateProgram("raster",{defines:le.defines,overrideFog:br});if(v.uploadCommonUniforms(J,Ts,mt),ce instanceof t.aU){const zs=ce.elevatedGlobeVertexBuffer,Os=ce.elevatedGlobeIndexBuffer;if(_e||!k)ce.boundsBuffer&&ce.boundsSegments&&Ts.draw(v,ee.TRIANGLES,bt,sr.disabled,be,pr.disabled,fs,h.id,ce.boundsBuffer,v.quadTriangleIndexBuffer,ce.boundsSegments);else if(zs&&Os){const ls=kn.zoom<=t.c_?ce.elevatedGlobeSegments:ce.getSegmentsForLongitude(kn.center.lng);ls&&Ts.draw(v,ee.TRIANGLES,bt,sr.disabled,be,at,fs,h.id,zs,Os,ls)}}else if(G){bt=new zn(ee.LEQUAL,zn.ReadOnly,v.depthRangeFor3D);const zs=v.globeSharedBuffers;if(zs){const[Os,ls,Ar]=zs.getGridBuffers(Ln,!1);Ts.draw(v,ee.TRIANGLES,bt,tt||ni,v.colorModeForRenderPass(),at,fs,h.id,Os,ls,Ar)}}else{const{tileBoundsBuffer:zs,tileBoundsIndexBuffer:Os,tileBoundsSegments:ls}=v.getTileBoundsBuffers(Pt);Ts.draw(v,ee.TRIANGLES,bt,ni,be,pr.disabled,fs,h.id,zs,Os,ls)}}if(!(ce instanceof t.aU)&&G)for(const Je of nt){const mt=Je.canonical.y===(1<<Je.canonical.z)-1;Je.canonical.y===0&&Nu(!0,Je,v,r,h,he,le,at,tt||sr.disabled),mt&&Nu(!1,Je,v,r,h,he,le,at===pr.frontCW?pr.backCW:pr.frontCW,tt||sr.disabled)}};G?dt(He,v.renderElevatedRasterBackface?pr.backCW:pr.frontCW,v.stencilModeFor3D()):dt(He,pr.disabled,void 0),v.resetStencilClippingMasks()},"raster-particle":function(v,r,h,x,E,M){v.renderPass==="offscreen"&&(function(k,B,G,J){if(!J.length)return;const ee=k.context,ce=ee.gl,le=B.getSource();if(!(le instanceof yl))return;const he=Math.ceil(Math.sqrt(G.paint.get("raster-particle-count")));let be=G.particlePositionRGBAImage;if(!be||be.width!==he){const He=(function(Be){const dt=Be*Be,nt=new Uint8Array(4*dt),at=function(Je){return Je|=0,Je=Math.imul(2747636419^Je,2654435769),Je=Math.imul(Je^Je>>>16,2654435769),((Je=Math.imul(Je^Je>>>16,2654435769))>>>0)/4294967296},tt=1/1.1;for(let Je=0;Je<dt;Je++){const mt=tt*(at(2*Je+0)+Wc),Pt=tt*(at(2*Je+1)+Wc),It=255*mt%1,ri=255*Pt%1,si=It,_i=Pt-ri/255,Vi=ri;nt[4*Je+0]=255*(mt-It/255),nt[4*Je+1]=255*si,nt[4*Je+2]=255*_i,nt[4*Je+3]=255*Vi}return nt})(he);be=G.particlePositionRGBAImage=new t.q({width:he,height:he},He)}let _e=G.particleFramebuffer;_e?_e.width!==he&&(_e.destroy(),_e=G.particleFramebuffer=ee.createFramebuffer(he,he,1,null)):_e=G.particleFramebuffer=ee.createFramebuffer(he,he,1,null);const ke=[];for(const He of J){const Be=B.getTile(He);if(!(Be instanceof Jr))continue;const dt=V(Be,le,G);if(!dt)continue;const nt=[Be.tileSize,Be.tileSize];let at=G.tileFramebuffer;at||(at=G.tileFramebuffer=ee.createFramebuffer(nt[0],nt[1],1,null));let tt=Be.rasterParticleState;tt||(tt=Be.rasterParticleState=new dp(ee,He,nt,be));const Je=tt.update(G.lastInvalidatedAt);tt.particleTextureDimension!==he&&tt.updateParticleTexture(He,be);const mt=tt.targetColorTexture;tt.targetColorTexture=tt.backgroundColorTexture,tt.backgroundColorTexture=mt;const Pt=tt.particleTexture0;tt.particleTexture0=tt.particleTexture1,tt.particleTexture1=Pt,ke.push([He,dt,tt,Je])}if(ke.length===0)return;const Ae=t.o.now(),Oe=G.previousDrawTimestamp?.001*(Ae-G.previousDrawTimestamp):.0167;if(G.previousDrawTimestamp=Ae,G.hasColorMap()){ee.activeTexture.set(ce.TEXTURE0+2);let He=G.colorRampTexture;He||(He=G.colorRampTexture=new t.T(ee,G.colorRamp,ce.RGBA8)),He.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}ee.bindFramebuffer.set(G.tileFramebuffer.framebuffer),(function(He,Be,dt){const nt=He.context,at=nt.gl,tt=Be.tileFramebuffer;nt.activeTexture.set(at.TEXTURE0);const Je={u_texture:0,u_opacity:1.05*(Pt=Be.paint.get("raster-particle-fade-opacity-factor"))/(Pt+.05)},mt=He.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Pt;for(const It of dt){const[,,ri,si]=It;tt.colorAttachment0.set(ri.targetColorTexture.texture),nt.viewport.set([0,0,tt.width,tt.height]),nt.clear({color:t.ao.transparent}),si&&(ri.backgroundColorTexture.bind(at.NEAREST,at.CLAMP_TO_EDGE),mt.draw(He,at.TRIANGLES,zn.disabled,sr.disabled,yr.alphaBlended,pr.disabled,Je,Be.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments))}})(k,G,ke),(function(He,Be,dt,nt){const at=He.context,tt=at.gl,Je=dt.tileFramebuffer,mt=He.transform.projection.name==="globe",Pt=dt.paint.get("raster-particle-max-speed");for(const It of nt){const[ri,si,_i]=It;at.activeTexture.set(tt.TEXTURE0+0),si.texture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE),Je.colorAttachment0.set(_i.targetColorTexture.texture);const Vi=He.getOrCreateProgram("rasterParticleDraw",{defines:si.defines,overrideFog:!1});at.activeTexture.set(tt.TEXTURE0+1);const Kt=si.scalarData?[]:[0,1,2,3].map((ni=>t.e9[ni](ri)));Kt.push(ri);const bt=ri.canonical.x,oi=ri.canonical.y;for(const ni of Kt){const Li=Be.getTile(mt?ni.wrapped():ni);if(!Li)continue;const en=Li.rasterParticleState;if(!en)continue;const xn=ni.canonical.x+(1<<ni.canonical.z)*(ni.wrap-ri.wrap),Yi=ni.canonical.y;en.particleTexture0.bind(tt.NEAREST,tt.CLAMP_TO_EDGE);const Wi=Kg(1,en.particleTexture0.size[0],[xn-bt,Yi-oi],0,si.texture.size,2,Pt,si.textureOffset,si.scale,si.offset);Vi.draw(He,tt.POINTS,zn.disabled,sr.disabled,yr.alphaBlended,pr.disabled,Wi,dt.id,en.particleIndexBuffer,void 0,en.particleSegment)}}})(k,B,G,ke),ee.bindFramebuffer.set(G.particleFramebuffer.framebuffer),(function(He,Be,dt,nt){const at=He.context,tt=at.gl,Je=Be.paint.get("raster-particle-max-speed"),mt=nt*Be.paint.get("raster-particle-speed-factor")*.15,Pt=(function(ri){return Math.pow(ri,6)})(.01+1*Be.paint.get("raster-particle-reset-rate-factor")),It=Be.particleFramebuffer;at.viewport.set([0,0,It.width,It.height]);for(const ri of dt){const[,si,_i]=ri;at.activeTexture.set(tt.TEXTURE0+0),si.texture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE),at.activeTexture.set(tt.TEXTURE0+1);const Vi=_i.particleTexture0;Vi.bind(tt.NEAREST,tt.CLAMP_TO_EDGE);const Kt=Jg(1,Vi.size[0],0,si.texture.size,Je,mt,Pt,si.textureOffset,si.scale,si.offset);It.colorAttachment0.set(_i.particleTexture1.texture),at.clear({color:t.ao.transparent}),He.getOrCreateProgram("rasterParticleUpdate",{defines:si.defines}).draw(He,tt.TRIANGLES,zn.disabled,sr.disabled,yr.unblended,pr.disabled,Kt,Be.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments)}})(k,G,ke,Oe)})(v,r,h,x),v.renderPass==="translucent"&&((function(k,B,G,J,ee){const ce=k.context,le=ce.gl,he=B.getSource().tileSize,be=5*(1-t.ah(t.cL,t.cL+1,k.transform.zoom))*he+G.paint.get("raster-particle-elevation"),_e=!k.options.moving,ke=k.transform.projection.name==="globe";if(!J.length)return;const[Ae,Oe]=k.stencilConfigForOverlap(J),He=[];ke&&He.push("PROJECTION_GLOBE_VIEW");const Be=k.stencilModeFor3D();for(const dt of Oe){const nt=dt.toUnwrapped(),at=B.getTile(dt);if(!at.rasterParticleState)continue;const tt=at.rasterParticleState,Je=100;at.registerFadeDuration(Je);const mt=B.findLoadedParent(dt,0),Pt=jh(at,mt,B,k.transform,Je);let It,ri;k.terrain&&k.terrain.prepareDrawTile(),ce.activeTexture.set(le.TEXTURE0),tt.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ce.activeTexture.set(le.TEXTURE1),mt&&mt.rasterParticleState?(mt.rasterParticleState.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),It=Math.pow(2,mt.tileID.overscaledZ-at.tileID.overscaledZ),ri=[at.tileID.canonical.x*It%1,at.tileID.canonical.y*It%1]):tt.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const si=ke?Float32Array.from(k.transform.expandedFarZProjMatrix):k.transform.calculateProjMatrix(nt,_e),_i=k.transform,Vi=u(_i),Kt=t.dG(dt.canonical),bt=t.dH(Kt.getCenter().lat);let oi,ni,Li,en,xn;ke?(oi=Float32Array.from(t.bk(t.dJ(dt.canonical))),ni=Float32Array.from(_i.globeMatrix),Li=Float32Array.from(t.dF(_i)),en=[t.aF(_i.center.lng),t.aJ(_i.center.lat)],xn=Float32Array.from(t.dI(dt.canonical,Kt,bt,_i.worldSize/_i._pixelsPerMercatorPixel))):(oi=new Float32Array(16),ni=new Float32Array(9),Li=new Float32Array(16),en=[0,0],xn=new Float32Array(9));const Yi=Xm(si,oi,ni,Li,xn,ri||[0,0],t.aj(k.transform.zoom),en,Vi,It||1,Pt,be),Wi=k.isTileAffectedByFog(dt),kn=k.getOrCreateProgram("rasterParticle",{defines:He,overrideFog:Wi});if(k.uploadCommonUniforms(ce,kn,nt),ke){const Pn=new zn(le.LEQUAL,zn.ReadOnly,k.depthRangeFor3D),pn=0,Tn=k.globeSharedBuffers;if(Tn){const[Kn,Er,ts]=Tn.getGridBuffers(bt,pn!==0);kn.draw(k,le.TRIANGLES,Pn,Be,yr.alphaBlended,k.renderElevatedRasterBackface?pr.frontCCW:pr.backCCW,Yi,G.id,Kn,Er,ts)}}else{const Pn=k.depthModeForSublayer(0,zn.ReadOnly),pn=Ae[dt.overscaledZ],{tileBoundsBuffer:Tn,tileBoundsIndexBuffer:Kn,tileBoundsSegments:Er}=k.getTileBoundsBuffers(at);kn.draw(k,le.TRIANGLES,Pn,pn,yr.alphaBlended,pr.disabled,Yi,G.id,Tn,Kn,Er)}}k.resetStencilClippingMasks()})(v,r,h,x),v.style.map.triggerRepaint())},background:function(v,r,h,x){const E=h.paint.get("background-color"),M=h.paint.get("background-color-use-theme").constantOr("default")==="none",k=h.paint.get("background-opacity"),B=h.paint.get("background-emissive-strength"),G=h.paint.get("background-pitch-alignment")==="viewport";if(k===0)return;const J=v.context,ee=J.gl,ce=v.transform,le=ce.tileSize,he=h.paint.get("background-pattern");let be;if(he!==void 0&&(he===null||(be=v.imageManager.getPattern(t.I.from(he.toString()),h.scope,v.style.getLut(h.scope)),!be)))return;const _e=!he&&E.a===1&&k===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==_e)return;const ke=sr.disabled,Ae=v.depthModeForSublayer(0,_e==="opaque"?zn.ReadWrite:zn.ReadOnly),Oe=v.colorModeForDrapableLayerRenderPass(B),He=he?"backgroundPattern":"background";let Be,dt=x;dt||(Be=v.getBackgroundTiles(),dt=Object.values(Be).map((at=>at.tileID))),he&&(J.activeTexture.set(ee.TEXTURE0),v.imageManager.bind(v.context,h.scope));const nt=[];if(v.terrain&&v.terrain.renderingToTexture&&v.emissiveMode==="mrt-fallback"&&nt.push("USE_MRT1"),G){const at=v.getOrCreateProgram(He,{overrideFog:!1,overrideRtt:!0,defines:nt}),tt=new Float32Array(t.bA([])),Je=new t.aQ(0,0,0,0,0),mt=he?fu(tt,B,k,v,0,h.scope,be,G,{tileID:Je,tileSize:le}):pc(tt,B,k,E.toPremultipliedRenderColor(M?null:h.lut));at.draw(v,ee.TRIANGLES,Ae,ke,Oe,pr.disabled,mt,h.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments)}else for(const at of dt){const tt=v.isTileAffectedByFog(at),Je=v.getOrCreateProgram(He,{overrideFog:tt,defines:nt}),mt=at.toUnwrapped(),Pt=x?at.projMatrix:v.transform.calculateProjMatrix(mt);v.prepareDrawTile();const It=r?r.getTile(at):Be?Be[at.key]:new Vo(at,le,ce.zoom,v),ri=he?fu(Pt,B,k,v,0,h.scope,be,G,{tileID:at,tileSize:le}):pc(Pt,B,k,E.toPremultipliedRenderColor(M?null:h.lut));v.uploadCommonUniforms(J,Je,mt);const{tileBoundsBuffer:si,tileBoundsIndexBuffer:_i,tileBoundsSegments:Vi}=v.getTileBoundsBuffers(It);Je.draw(v,ee.TRIANGLES,Ae,ke,Oe,pr.disabled,ri,h.id,si,_i,Vi)}},sky:function(v,r,h){const x=v._atmosphere?t.aj(v.transform.zoom):1,E=h.paint.get("sky-opacity")*x;if(E===0)return;const M=v.context,k=h.paint.get("sky-type"),B=new zn(M.gl.LEQUAL,zn.ReadOnly,[0,1]),G=v.frameCounter/1e3%1;k==="atmosphere"?v.renderPass==="offscreen"?h.needsSkyboxCapture(v)&&((function(J,ee,ce,le){const he=J.context,be=he.gl;let _e=ee.skyboxFbo;if(!_e){_e=ee.skyboxFbo=he.createFramebuffer(32,32,1,null),ee.skyboxGeometry=new xt(he),ee.skyboxTexture=he.gl.createTexture(),be.bindTexture(be.TEXTURE_CUBE_MAP,ee.skyboxTexture),be.texParameteri(be.TEXTURE_CUBE_MAP,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_CUBE_MAP,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_CUBE_MAP,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_CUBE_MAP,be.TEXTURE_MAG_FILTER,be.LINEAR);for(let He=0;He<6;++He)be.texImage2D(be.TEXTURE_CUBE_MAP_POSITIVE_X+He,0,be.RGBA,32,32,0,be.RGBA,be.UNSIGNED_BYTE,null)}he.bindFramebuffer.set(_e.framebuffer),he.viewport.set([0,0,32,32]);const ke=ee.getCenter(J,!0),Ae=J.getOrCreateProgram("skyboxCapture"),Oe=new Float64Array(16);t.bA(Oe),t.en(Oe,Oe,.5*-Math.PI),wt(J,ee,Ae,Oe,ke,0),t.bA(Oe),t.en(Oe,Oe,.5*Math.PI),wt(J,ee,Ae,Oe,ke,1),t.bA(Oe),t.cU(Oe,Oe,.5*-Math.PI),wt(J,ee,Ae,Oe,ke,2),t.bA(Oe),t.cU(Oe,Oe,.5*Math.PI),wt(J,ee,Ae,Oe,ke,3),t.bA(Oe),wt(J,ee,Ae,Oe,ke,4),t.bA(Oe),t.en(Oe,Oe,Math.PI),wt(J,ee,Ae,Oe,ke,5),he.viewport.set([0,0,J.width,J.height])})(v,h),h.markSkyboxValid(v)):v.renderPass==="sky"&&(function(J,ee,ce,le,he){const be=J.context,_e=be.gl,ke=J.transform,Ae=J.getOrCreateProgram("skybox");be.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_CUBE_MAP,ee.skyboxTexture);const Oe=((He,Be,dt,nt,at)=>({u_matrix:He,u_sun_direction:Be,u_cubemap:0,u_opacity:nt,u_temporal_offset:at}))(ke.skyboxMatrix,ee.getCenter(J,!1),0,le,he);J.uploadCommonUniforms(be,Ae),Ae.draw(J,_e.TRIANGLES,ce,sr.disabled,J.colorModeForRenderPass(),pr.backCW,Oe,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)})(v,h,B,E,G):k==="gradient"&&v.renderPass==="sky"&&(function(J,ee,ce,le,he){const be=J.context,_e=be.gl,ke=J.transform,Ae=J.getOrCreateProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new xt(be)),be.activeTexture.set(_e.TEXTURE0);let Oe=ee.colorRampTexture;Oe||(Oe=ee.colorRampTexture=new t.T(be,ee.colorRamp,_e.RGBA8)),Oe.bind(_e.LINEAR,_e.CLAMP_TO_EDGE);const He=((Be,dt,nt,at,tt)=>({u_matrix:Be,u_color_ramp:0,u_center_direction:dt,u_radius:t.an(nt),u_opacity:at,u_temporal_offset:tt}))(ke.skyboxMatrix,ee.getCenter(J,!1),ee.paint.get("sky-gradient-radius"),le,he);J.uploadCommonUniforms(be,Ae),Ae.draw(J,_e.TRIANGLES,ce,sr.disabled,J.colorModeForRenderPass(),pr.backCW,He,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)})(v,h,B,E,G)},custom:function(v,r,h,x){const E=v.context,M=h.implementation;if(!v.transform.projection.unsupportedLayers||!v.transform.projection.unsupportedLayers.includes("custom")||v.terrain&&(v.terrain.renderingToTexture||v.renderPass==="offscreen")&&h.isDraped(r)){if(v.renderPass==="offscreen"){const k=M.prerender;if(k){if(v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),v.transform.projection.name==="globe"){const B=v.transform.pointMerc;k.call(M,E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),t.aj(v.transform.zoom),[B.x,B.y],v.transform.pixelsPerMeterRatio)}else k.call(M,E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState()}}else if(v.renderPass==="translucent"){if(v.terrain&&v.terrain.renderingToTexture){const B=M.renderToTile;if(B){const G=x[0].canonical,J={x:G.x+x[0].wrap*(M.wrapTileId?0:1<<G.z),y:G.y,z:G.z};E.setDepthMode(zn.disabled),E.setStencilMode(sr.disabled),E.setColorMode(v.colorModeForRenderPass()),v.setCustomLayerDefaults(),B.call(M,E.gl,J),E.setDirty(),v.setBaseState()}return}v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),E.setStencilMode(sr.disabled);const k=M.renderingMode==="3d"?new zn(v.context.gl.LEQUAL,zn.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,zn.ReadOnly);if(E.setDepthMode(k),v.transform.projection.name==="globe"){const B=v.transform.pointMerc;M.render(E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),t.aj(v.transform.zoom),[B.x,B.y],v.transform.pixelsPerMeterRatio)}else M.render(E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState(),E.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(v,r,h,x){if(v.renderPass==="opaque")return;const E=h.paint.get("model-opacity").constantOr(1),M=h.paint.get("model-elevation-reference"),k=M==="ground",B=M==="ground";if(E===0)return;const G=h.paint.get("model-cast-shadows");if(v.renderPass==="shadow"&&(!G||v.terrain&&E<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof t.ad))return;const J=v.shadowRenderer,ee=h.paint.get("model-receive-shadows");J&&(J.useNormalOffset=!0,ee||(J.enabled=!1));const ce=()=>{J&&(J.useNormalOffset=!0,ee||(J.enabled=!0))},le=r.getSource();if(v.renderPass==="light-beam"&&le.type!=="batched-model")return;if(le.type==="vector"||le.type==="geojson")return(function(Be,dt,nt,at,tt){const Je=Be.transform,mt=Je.projection.name==="globe",Pt=Je.getFreeCameraOptions().position;if(!Be.modelManager)return;const It=Be.modelManager;nt.modelManager=It;const ri=Be.shadowRenderer;if(!nt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const si=nt._unevaluatedLayout._values["model-id"],_i=Object.assign({},nt.layout.get("model-id").parameters),Vi=Be.style.order.indexOf(nt.fqid),Kt=nt.paint.get("model-opacity").constantOr(1);for(const bt of at){const oi=dt.getTile(bt).getBucket(nt);if(!oi||oi.projection.name!==Je.projection.name)continue;const ni=oi.getModelUris();if(ni&&!oi.modelsRequested&&(It.addModelsFromBucket(ni,tt),oi.modelsRequested=!0),mt)_i.zoom=bt.overscaledZ;else{const pn=Ps(bt,Je);_i.zoom=pn}const Li=si.possiblyEvaluate(_i);if(Yn(Be,oi,bt),Zr.shadowUniformsInitialized=!1,Zr.useSingleShadowCascade=!!ri&&ri.getMaxCascadeForTile(bt.toUnwrapped())===0,Be.renderPass==="shadow"&&ri){if(Be.currentShadowCascade===1&&oi.isInsideFirstShadowMapFrustum)continue;const pn=Je.calculatePosMatrix(bt.toUnwrapped(),Je.worldSize);if(Zr.tileMatrix.set(pn),Zr.shadowTileMatrix=Float32Array.from(ri.calculateShadowPassMatrixFromMatrix(pn)),Zr.aabb.min=[0,0,0],Zr.aabb.max[0]=Zr.aabb.max[1]=t.al,Zr.aabb.max[2]=0,fa(oi,Zr,Be,nt.scope))continue}const en=1<<bt.canonical.z,xn=[((Pt.x-bt.wrap)*en-bt.canonical.x)*t.al,(Pt.y*en-bt.canonical.y)*t.al,Pt.z*en*t.al];Be.conflationActive&&Object.keys(oi.instancesPerModel).length>0&&Be.style.isLayerClipped(nt,dt.getSource())&&oi.updateReplacement(bt,Be.replacementSource,Vi,nt.scope)&&(oi.uploaded=!1,oi.upload(Be.context));let Yi=0;const Wi=new Array,kn=new Array,Pn=new Array;for(let pn in oi.instancesPerModel){const Tn=oi.instancesPerModel[pn];Tn.features.length>0&&!mt&&(pn=Li.evaluate(Tn.features[0].feature,{}));const Kn=It.getModel(pn,tt);if(Kn||It.hasURLBeenRequested(pn)||oi.modelUris.includes(pn)||(oi.modelUris.push(pn),oi.modelsRequested=!1),Kn&&Kn.uploaded)if(mt){const Er=t.c5([],[Pt.x,Pt.y,Pt.z],Be.transform.worldSize);t.ew(Er,Er);for(let ts=0;ts<Tn.instancedDataArray.length;++ts){const ys=[0,0,0],Ln=[1,1,1],fs=t.ex(),br=Tn.tileCoordinatesForInstance(ts),Ts=Tn.transformForInstance(ts);t.ey(Ln,Ts),t.ez(fs,Ts),t.eA(ys,fs);const zs=Tn.translationForInstance(ts),Os=new t.aT(0,0);t.eB(oi.canonical,Os,br.x,br.y);const ls=t.bC();t.eC(ls,Kn,Be.transform,Os,ys,Ln,zs,!0,!1,!1);const Ar=Tn.colorForInstance(ts),vs=t.bA([]),ko=t.ef(Os.lat,Be.transform.zoom),yo=t.bq([],[1,1,1/ko]);t.br(vs,vs,Er),Pn.push({zScaleMatrix:yo,negCameraPosMatrix:vs});for(const Ms of Kn.nodes)Di(Be,Ms,ls,Be.transform.expandedFarZProjMatrix,Yi,Wi,kn,Kn.materialOverrides,Kt,Ar);++Yi}}else for(const Er of Kn.nodes)ia(Be,nt,Er,Tn,xn,bt,Zr)}if(mt)if(Be.renderPass==="shadow"){for(const pn of kn)Pi(pn.mesh,pn.nodeModelMatrix,Be,nt);for(const pn of Wi)Pi(pn.mesh,pn.nodeModelMatrix,Be,nt)}else bn(Be,nt,Wi,kn,Pn)}})(v,r,h,x,ki(v,h)),void ce();if(!le.loaded())return;if(le.type==="batched-model")return(function(Be,dt,nt,at){nt.resetLayerRenderingStats(Be);const tt=Be.context,Je=Be.transform,mt=Be.style.fog,Pt=Be.shadowRenderer;if(Je.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${Je.projection.name} projection is not yet implemented`);const It=Be.transform.getFreeCameraOptions().position,ri=t.c5([],[It.x,It.y,It.z],Be.transform.worldSize),si=t.ew([],ri),_i=t.bA([]),Vi=t.ef(Je.center.lat,Je.zoom),Kt=t.bq([],[1,1,1/Vi]);t.br(_i,_i,si);const bt=nt.paint.get("model-opacity").constantOr(1),oi=new zn(tt.gl.LEQUAL,zn.ReadWrite,Be.depthRangeFor3D),ni=new zn(tt.gl.LEQUAL,zn.ReadOnly,Be.depthRangeFor3D),Li=new t.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),en=Be.renderPass==="shadow",xn=en&&Pt?Pt.getCurrentCascadeFrustum():Je.getFrustum(Je.scaleZoom(Je.worldSize)),Yi=nt.paint.get("model-front-cutoff"),Wi=Yi[2]<1,kn=rh(Be,nt.paint.get("model-cutoff-fade-range")),Pn=nt.getLayerRenderingStats();(function(pn,Tn,Kn,Er){const ts=pn.terrain?pn.terrain.exaggeration():0,ys=pn.transform.zoom;for(const Ln of Er){const fs=Tn.getTile(Ln).getBucket(Kn);fs&&(fs.setFilter(Kn.filter),pn.conflationActive&&fs.updateReplacement(Ln,pn.replacementSource),fs.evaluateTransform(pn,Kn),pn.terrain&&ts>0&&fs.elevationUpdate(pn.terrain,ts,Ln,Kn.source),fs.needsReEvaluation(pn,ys,Kn)&&fs.evaluate(Kn))}})(Be,dt,nt,at),(function(){let pn,Tn,Kn;Wi?(pn=at.length-1,Tn=-1,Kn=-1):(pn=0,Tn=at.length,Kn=1);const Er=new Float64Array(16),ts=t.cA(),ys=new t.P(0,0);for(let Ln=pn;Ln!==Tn;Ln+=Kn){const fs=at[Ln],br=dt.getTile(fs).getBucket(nt);if(!br||!br.uploaded)continue;let Ts=!1;Pt&&(Ts=Pt.getMaxCascadeForTile(fs.toUnwrapped())===0);const zs=Je.calculatePosMatrix(fs.toUnwrapped(),Je.worldSize),Os=br.modelTraits;!en&&Wi&&(t.bl(Er,zs),t.af(ts,ri,Er),ys.x=ts[0],ys.y=ts[1]);const ls=[];br.setFilter(nt.filter);for(const Ar of br.getNodesInfo()){if(Ar.hiddenByReplacement||!Ar.node.meshes)continue;const vs=Ar.node;let ko=0;Be.terrain&&vs.elevation&&(ko=vs.elevation*Be.terrain.exaggeration());const yo=(()=>{const ec=Ar.aabb;return Li.min=[...ec.min],Li.max=[...ec.max],Li.min[2]+=ko,Li.max[2]+=ko,t.af(Li.min,Li.min,zs),t.af(Li.max,Li.max,zs),Li})(),Ms=Ar.evaluatedScale;if(Ms[0]<=1&&Ms[1]<=1&&Ms[2]<=1&&yo.intersects(xn)===0)continue;if(!en&&Wi){const ec=.16666666666666666;Ar.cameraCollisionOpacity=ri[0]>yo.min[0]&&ri[0]<yo.max[0]&&ri[1]>yo.min[1]&&ri[1]<yo.max[1]&&ri[2]*Vi<yo.max[2]&&vs.footprint&&t.c0(ys,vs.footprint)?Math.max(Ar.cameraCollisionOpacity-ec,0):Math.min(1,Ar.cameraCollisionOpacity+ec)}const cs=[...zs],Pr=1/t.d7(fs.canonical),co=vs.anchor?vs.anchor[0]:0,Ss=vs.anchor?vs.anchor[1]:0;t.br(cs,cs,[co*(Ms[0]-1)+Ar.evaluatedTranslation[0]*Pr,Ss*(Ms[1]-1)+Ar.evaluatedTranslation[1]*Pr,ko+Ar.evaluatedTranslation[2]]),t.cq(Ms,t.eE)||t.cS(cs,cs,Ms);const uo=t.aB([],cs,vs.globalMatrix),Zs=t.aB([],Je.expandedFarZProjMatrix,uo),kc=t.aB([],Je.expandedFarZProjMatrix,cs),Dl=t.aC([],[co,Ss,ko,1],Zs)[2];vs.hidden=!1;let Fa=bt;en||(Wi&&(Fa*=Ar.cameraCollisionOpacity,Fa*=hr(cs,Je,Ar.aabb,Yi)),Fa*=Nr(kn,Dl)),Fa!==0?ls.push({nodeInfo:Ar,depth:Dl,opacity:Fa,wvpForNode:Zs,wvpForTile:kc,nodeModelMatrix:uo,tileModelMatrix:cs}):vs.hidden=!0}en||ls.sort(((Ar,vs)=>!Wi||Ar.opacity===1&&vs.opacity===1?Ar.depth<vs.depth?-1:1:Ar.opacity===1?-1:vs.opacity===1?1:Ar.depth>vs.depth?-1:1));for(const Ar of ls){const vs=Ar.nodeInfo,ko=vs.node;let yo=t.aB([],Kt,Ar.tileModelMatrix);t.aB(yo,_i,yo);const Ms=t.bl([],yo);t.eg(Ms,Ms),t.cS(Ms,Ms,Eo),yo=t.aB(yo,yo,ko.globalMatrix);const cs=Be.renderPass==="light-beam",Pr=nt.paint.get("model-color-use-theme").constantOr("default")==="none",co=Os&t.eI.HasMapboxMeshFeatures,Ss=co?0:vs.evaluatedRMEA[0][2];for(let uo=0;uo<ko.meshes.length;++uo){const Zs=ko.meshes[uo],kc=uo===ko.lightMeshIndex;let Dl=Ar.wvpForNode;if(kc){if(!cs&&!Be.terrain&&Be.shadowRenderer){Be.currentLayer<Be.firstLightBeamLayer&&(Be.firstLightBeamLayer=Be.currentLayer);continue}Dl=Ar.wvpForTile}else if(cs)continue;const Fa={defines:[]},ec=[];if(!en&&Pt&&(Pt.useNormalOffset=!!Zs.normalBuffer),hi(Fa.defines,ec,Zs,Be,Pr?null:nt.lut),co||Fa.defines.push("DIFFUSE_SHADED"),Ts&&Fa.defines.push("SHADOWS_SINGLE_CASCADE"),Pn&&(en?Pn.numRenderedVerticesInShadowPass+=Zs.vertexArray.length:Pn.numRenderedVerticesInTransparentPass+=Zs.vertexArray.length),en){Pi(Zs,Ar.nodeModelMatrix,Be,nt);continue}let Ul=null;if(mt){const Go=Ut(Ar.nodeModelMatrix,Be.transform);if(Ul=new Float32Array(Go),Je.projection.name!=="globe"){const Ds=Zs.aabb.min,la=Zs.aabb.max,[Lo,Io]=mt.getOpacityForBounds(Go,Ds[0],Ds[1],la[0],la[1]);Fa.overrideFog=Lo>=xi||Io>=xi}}const Tl=Zs.material;let tc;Tl.occlusionTexture&&Tl.occlusionTexture.offsetScale&&(tc=Tl.occlusionTexture.offsetScale,Fa.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const vu=Be.getOrCreateProgram("model",Fa);!en&&Pt&&Pt.setupShadowsFromMatrix(Ar.tileModelMatrix,vu,Pt.useNormalOffset),Be.uploadCommonUniforms(tt,vu,null,Ul);const Dc=Tl.pbrMetallicRoughness;Dc.metallicFactor=.9,Dc.roughnessFactor=.5;const Do=Cr(new Float32Array(Dl),new Float32Array(yo),new Float32Array(Ms),new Float32Array(ko.globalMatrix),Be,Ar.opacity,Dc.baseColorFactor,Tl.emissiveFactor,Dc.metallicFactor,Dc.roughnessFactor,Tl,Ss,nt,[0,0,0],tc);!kc&&(vs.hasTranslucentParts||Ar.opacity<1)&&vu.draw(Be,tt.gl.TRIANGLES,oi,sr.disabled,yr.disabled,pr.backCCW,Do,nt.id,Zs.vertexBuffer,Zs.indexBuffer,Zs.segments,nt.paint,Be.transform.zoom,void 0,ec),vu.draw(Be,tt.gl.TRIANGLES,kc?ni:oi,sr.disabled,kc||Ar.opacity<1||vs.hasTranslucentParts?yr.alphaBlended:yr.unblended,pr.backCCW,Do,nt.id,Zs.vertexBuffer,Zs.indexBuffer,Zs.segments,nt.paint,Be.transform.zoom,void 0,ec)}}}})()})(v,r,h,x),void ce();if(le.type!=="model")return;const he=le.getModels(),be=[],_e=v.transform.getFreeCameraOptions().position,ke=t.c5([],[_e.x,_e.y,_e.z],v.transform.worldSize);t.ew(ke,ke);const Ae=[],Oe=[];let He=0;for(const Be of he){const dt=r.getFeatureState("",Be.id),nt={type:"Unknown",id:Be.id,properties:Be.featureProperties},at=h.paint.get("model-rotation").evaluate(nt,dt),tt=h.paint.get("model-scale").evaluate(nt,dt),Je=h.paint.get("model-translation").evaluate(nt,dt),mt=h.paint.get("model-opacity").evaluate(nt,dt);On(h,Be.id,dt,Be.featureProperties,Be.nodeOverrideNames,Be.nodeOverrides),Nn(h,Be.id,dt,Be.featureProperties,Be.materialOverrideNames,Be.materialOverrides),Be.nodeOverrides.size>0&&Be.computeBoundsAndApplyParent(),Be.computeModelMatrix(v,at,tt,Je,B,k,!1);const Pt=t.bA([]),It=t.ef(Be.position.lat,v.transform.zoom),ri=t.bq([],[1,1,1/It]);t.br(Pt,Pt,ke),be.push({zScaleMatrix:ri,negCameraPosMatrix:Pt});for(const si of Be.nodes)Di(v,si,Be.matrix,v.transform.expandedFarZProjMatrix,He,Ae,Oe,Be.materialOverrides,mt);He++}if(Ae.sort(((Be,dt)=>dt.depth-Be.depth)),v.renderPass!=="shadow")bn(v,h,Ae,Oe,be),ce();else{for(const Be of Oe)Pi(Be.mesh,Be.nodeModelMatrix,v,h);for(const Be of Ae)Pi(Be.mesh,Be.nodeModelMatrix,v,h);ce()}}},Uo={line:function(v,r,h){if(v.hasElevatedBuckets=!1,v.hasNonElevatedBuckets=!1,v._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||v._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const x=r.getVisibleCoordinates();for(const E of x){const M=r.getTile(E).getBucket(v);if(M&&(M.elevationType!=="none"?v.hasElevatedBuckets=!0:v.hasNonElevatedBuckets=!0,v.hasElevatedBuckets&&v.hasNonElevatedBuckets))break}}}else v.hasNonElevatedBuckets=!0},model:function(v,r,h){const x=r.getSource();if(!x.loaded())return;if(x.type==="vector"||x.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,ki(h,v)));if(x.type==="batched-model"||x.type!=="model")return;const E=x.getModels();for(const M of E)M.upload(h.context)},raster:function(v,r,h){const x=r.getSource();if(!(x instanceof yl&&x.loaded()))return;const E=v.sourceLayer||x.rasterLayerIds&&x.rasterLayerIds[0];if(!E)return;const M=v.paint.get("raster-array-band")||x.getInitialBand(E);if(M==null)return;const k=r.getIds().map((B=>r.getTileByID(B)));for(const B of k)B.updateNeeded(v.id,M)&&x.prepareTile(B,E,v.id,M)},"raster-particle":function(v,r,h){const x=r.getSource();if(!(x instanceof yl&&x.loaded()))return;const E=v.sourceLayer||x.rasterLayerIds&&x.rasterLayerIds[0];if(!E)return;const M=v.paint.get("raster-particle-array-band")||x.getInitialBand(E);if(M==null)return;const k=r.getIds().map((B=>r.getTileByID(B)));for(const B of k)B.updateNeeded(v.id,M)&&x.prepareTile(B,E,v.id,M)}},Ws={fill:Ef},Ga={fill:function(v,r,h,x){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const E=v.context.gl,M=new zn(E.LEQUAL,zn.ReadOnly,v.depthRangeFor3D),k=new sr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),B=v.transform.getFreeCameraOptions().position,G=v.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const J of x){const ee=r.getTile(J),ce=ee.getBucket(h);if(!ce)continue;const le=ce.elevatedStructures;if(!le||le.depthSegments.segments[0].primitiveLength===0)continue;const he=Km(J.toUnwrapped(),B),be=v.translatePosMatrix(J.projMatrix,ee,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),_e=hh(be,he,0,1,0);G.draw(v,E.TRIANGLES,M,k,yr.disabled,pr.disabled,_e,h.id,le.vertexBuffer,le.indexBuffer,le.depthSegments,h.paint,v.transform.zoom)}}};class qa{constructor(r,h,x,E,M){this.context=new Tf(r,h),this.transform=x,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=t.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const k=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of k)this._debugParams.enabledLayers[G]=!0;for(const G of k);this.occlusionParams=new aa,this.setup(),this.numSublayers=Ko.maxUnderzooming+Ko.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uu(this),this._wireframeDebugCache=new pa,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const B=new t.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new t.T(this.context,B,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=E,this.worldview=M,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(r,h){const x=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Hg(this,r));const E=this._terrain;this.transform.elevation=x?E:null,E.update(r,this.transform,h),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(r){const h=r.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,E]=h.getFovAdjustedRange(this.transform._fov);if(x>E)return void(this.transform.fogCullDistSq=null);const M=x+.78*(E-x);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Hg(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,h){if(this.width=r*t.o.devicePixelRatio,this.height=h*t.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._mergedLayers[x].resize()}setup(){const r=this.context,h=new t.bd;h.emplaceBack(0,0),h.emplaceBack(t.al,0),h.emplaceBack(0,t.al),h.emplaceBack(t.al,t.al),this.tileExtentBuffer=r.createVertexBuffer(h,t.bf.members),this.tileExtentSegments=t.bg.simpleSegment(0,0,4,2);const x=new t.bd;x.emplaceBack(0,0),x.emplaceBack(t.al,0),x.emplaceBack(0,t.al),x.emplaceBack(t.al,t.al),this.debugBuffer=r.createVertexBuffer(x,t.bf.members),this.debugSegments=t.bg.simpleSegment(0,0,4,5);const E=new t.bd;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(E,t.bf.members),this.viewportSegments=t.bg.simpleSegment(0,0,4,2);const M=new t.b1;M.emplaceBack(0,0,0,0),M.emplaceBack(t.al,0,t.al,0),M.emplaceBack(0,t.al,0,t.al),M.emplaceBack(t.al,t.al,t.al,t.al),this.mercatorBoundsBuffer=r.createVertexBuffer(M,t.bi.members),this.mercatorBoundsSegments=t.bg.simpleSegment(0,0,4,2);const k=new t.b0;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(k);const B=new t.be;for(const J of[0,1,3,2,0])B.emplaceBack(J);this.debugIndexBuffer=r.createIndexBuffer(B),this.emptyTexture=new t.T(r,new t.q({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=t.bC();const G=this.context.gl;this.stencilClearMode=new sr({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,zn.disabled,this.stencilClearMode,yr.disabled,pr.disabled,Vh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,h,x){if(!h||this.currentStencilSource===h.id||!r.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let B=!1;for(const G of x)if(this._tileClippingMaskIDs[G.key]===void 0){B=!0;break}if(!B)return}this.currentStencilSource=h.id;const E=this.context,M=E.gl;this.nextStencilID+x.length>256&&this.clearStencil(),E.setColorMode(yr.disabled),E.setDepthMode(zn.disabled);const k=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of x){const G=h.getTile(B),J=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ce,tileBoundsSegments:le}=this.getTileBoundsBuffers(G);k.draw(this,M.TRIANGLES,zn.disabled,new sr({func:M.ALWAYS,mask:0},J,255,M.KEEP,M.KEEP,M.REPLACE),yr.disabled,pr.disabled,Vh(B.projMatrix),"$clipping",ee,ce,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new sr({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const h=this.context.gl;return new sr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){const h=this.context.gl,x=r.sort(((k,B)=>B.overscaledZ-k.overscaledZ)),E=x[x.length-1].overscaledZ,M=x[0].overscaledZ-E+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const k={};for(let B=0;B<M;B++)k[B+E]=new sr({func:h.GEQUAL,mask:255},B+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[k,x]}return[{[E]:sr.disabled},x]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new yr([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new t.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yr.unblended:yr.alphaBlended}colorModeForDrapableLayerRenderPass(r){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?r!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new yr([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new t.ao(0,0,0,r??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new yr([h.ONE,h.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,h.ONE_MINUS_SRC_ALPHA],t.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(r,h,x,E=!1){if(this.depthOcclusion)return new zn(this.context.gl.GREATER,zn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return zn.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new zn(x||this.context.gl.LEQUAL,h,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,h=Math.ceil(this.width),x=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),M=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===x||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&x!==0&&(this.depthFBO=new Ym(this.context,h,x,0,"texture"),this.depthTexture=new t.T(this.context,{width:h,height:x,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),r.bindTexture(r.TEXTURE_2D,M),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,h,x,0,0,h,x,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((r,h)=>r+h/this._fpsHistory.length),0))}render(r,h){const x=t.o.now();this._dt=x-this._timeStamp,this._timeStamp=x,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=h;const E=this.style._mergedLayers,M=!(!this.terrain||!this.terrain.enabled),k=()=>this.style._getOrder(M).filter((Kt=>{const bt=E[Kt];return!(bt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[bt.type]}));let B=k(),G=!1,J=!1,ee=null,ce=0,le=!1;for(const Kt of B){const bt=E[Kt];bt.visibility!=="none"&&(bt.type==="circle"?G=!0:bt.type==="building"?(ee=bt,++ce):bt.type==="symbol"&&(bt.hasOcclusionOpacityProperties?J=!0:G=!0))}this.updateEmissiveMode();let he=B.map((Kt=>E[Kt]));const be=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(t.o.now()),this.imageManager.beginFrame();for(const Kt in be){const bt=be[Kt];bt.used&&(bt.prepare(this.context),bt.getSource().usedInConflation&&++ce)}let _e=!1;for(const Kt of he)Kt.isHidden(this.transform.zoom)||(Kt.type==="clip"&&(_e=!0),this.prepareLayer(Kt));const ke={},Ae={},Oe={},He={},Be={};for(const Kt in be){const bt=be[Kt];ke[Kt]=bt.getVisibleCoordinates(),Ae[Kt]=ke[Kt].slice().reverse(),Oe[Kt]=bt.getVisibleCoordinates(!0).reverse(),He[Kt]=bt.getShadowCasterCoordinates(),Be[Kt]=bt.sortCoordinatesByDistance(ke[Kt])}const dt=Kt=>{const bt=this.style.getLayerSourceCache(Kt);return bt&&bt.used?bt.getSource():null};if(ce||_e||this._clippingActiveLastFrame){const Kt=[],bt=[];let oi=0;for(const ni of he)this.isSourceForClippingOrConflation(ni,dt(ni))&&(Kt.push(ni),bt.push(oi)),oi++;if(Kt&&(_e||Kt.length>1)||this._clippingActiveLastFrame){_e=!1;const ni=[];for(let Li=0;Li<Kt.length;Li++){const en=Kt[Li],xn=bt[Li],Yi=this.style.getLayerSourceCache(en);if(!Yi||!Yi.used||!Yi.getSource().usedInConflation&&en.type!=="clip"&&en.type!=="building")continue;let Wi=t.eQ,kn=t.b_.None;const Pn=[];let pn=!0;if(en.type==="building")Wi=t.eS;else if(en.type==="clip"){Wi=xn;for(const Tn of en.layout.get("clip-layer-types"))kn|=Tn==="model"?t.b_.Model:Tn==="symbol"?t.b_.Symbol:t.b_.FillExtrusion;for(const Tn of en.layout.get("clip-layer-scope"))Pn.push(Tn);en.isHidden(this.transform.zoom)?pn=!1:_e=!0}pn&&ni.push({layer:en.fqid,cache:Yi,order:Wi,clipMask:kn,clipScope:Pn})}this.replacementSource.setSources(ni),le=!0}}this._clippingActiveLastFrame=_e,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Kt=0;Kt<he.length;Kt++){const bt=he[Kt];if(bt.visibility==="none")continue;const oi=bt.cutoffRange();if(this.longestCutoffRange=Math.max(oi,this.longestCutoffRange),oi>0){const ni=dt(bt);ni&&(this.minCutoffZoom=Math.max(ni.minzoom,this.minCutoffZoom)),bt.minzoom&&(this.minCutoffZoom=Math.max(bt.minzoom,this.minCutoffZoom))}bt.is3D(M)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Kt),this._lastOcclusionLayer=Kt)}const nt=this.style&&this.style.fog;nt?(this._fogVisible=nt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=nt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Oe),this.opaquePassCutoff=0,B=k(),he=B.map((Kt=>E[Kt])));const at=this._shadowRenderer;if(at){at.updateShadowParameters(this.transform,this.style.directionalLight);for(const Kt in be)for(const bt of ke[Kt]){let oi={min:0,max:0};this.terrain&&(oi=this.terrain.getMinMaxForTile(bt)||oi),at.addShadowReceiver(bt.toUnwrapped(),oi.min,oi.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const tt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Je=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(tt&&!this._snow&&(this._snow=new Yc(this)),!tt&&this._snow&&(this._snow.destroy(),delete this._snow),Je&&!this._rain&&(this._rain=new mc(this)),!Je&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),ee){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ei);const Kt=this.style.getLayerSourceCache(ee);this.buildingTileBorderManager.updateBorders(Kt,ee)}if(!hn.has(this.context.gl))return;this.renderPass="offscreen";for(const Kt of he){const bt=r.getLayerSourceCache(Kt);if(!Kt.hasOffscreenPass()||Kt.isHidden(this.transform.zoom))continue;const oi=bt?Ae[bt.id]:void 0;(Kt.type==="custom"||Kt.type==="raster"||Kt.type==="raster-particle"||Kt.isSky()||oi&&oi.length)&&this.renderLayer(this,bt,Kt,oi)}this.depthRangeFor3D=[0,1-(he.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,He)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const mt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Pt=(()=>{if(h.showOverdrawInspector)return t.ao.black;const Kt=this.style.fog;if(Kt&&this.transform.projection.supportsFog){const bt=this.style.getLut(Kt.scope);if(!mt){const oi=Kt.properties.get("color-use-theme")==="none",ni=Kt.properties.get("color").toNonPremultipliedRenderColor(oi?null:bt).toArray01();return new t.ao(...ni)}if(mt){const oi=Kt.properties.get("space-color-use-theme")==="none",ni=Kt.properties.get("space-color").toNonPremultipliedRenderColor(oi?null:bt).toArray01();return new t.ao(...ni)}}return t.ao.transparent})();if(this.context.clear({color:Pt,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&mt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const Kt=he[this.currentLayer],bt=r.getLayerSourceCache(Kt);if(Kt.isSky())continue;const oi=bt?(Kt.is3D(M)?Be:Ae)[bt.id]:void 0;this._renderTileClippingMasks(Kt,bt,oi),this.renderLayer(this,bt,Kt,oi)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&mt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const Kt=he[this.currentLayer],bt=r.getLayerSourceCache(Kt);Kt.isSky()&&this.renderLayer(this,bt,Kt,bt?Ae[bt.id]:void 0)}function It(Kt,bt){let oi;return bt&&(oi=(Kt.type==="symbol"?Oe:Kt.is3D(M)?Be:Ae)[bt.id]),oi}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<B.length;){const Kt=he[this.currentLayer];if(Kt.type==="raster"||Kt.type==="raster-particle"){const bt=r.getLayerSourceCache(Kt);this.renderLayer(this,bt,Kt,It(Kt,bt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ri=0;at&&(ri=at.getShadowCastingLayerCount());let si=!1,_i=-1;for(let Kt=0;Kt<B.length;++Kt){const bt=he[Kt];bt.isHidden(this.transform.zoom)||bt.is3D(M)&&(_i=Kt)}J&&_i===-1&&(G=!0);let Vi=!1;for(;this.currentLayer<B.length;){const Kt=he[this.currentLayer],bt=r.getLayerSourceCache(Kt);if(Kt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Kt)){if(Kt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Vi&&Kt.is3D(M)&&!M){const oi=this.currentLayer,ni=Li=>{for(this.currentLayer=0;this.currentLayer<he.length;this.currentLayer++){const en=he[this.currentLayer];if(Ws[en.type]){const xn=this.style.getLayerSourceCache(en);Ws[en.type](this,xn,en,It(en,xn),Li)}}};ni("initialize"),ni("reset"),this.currentLayer=oi,Vi=!0}if(G&&!si&&this.terrain&&!this.transform.isOrthographic&&(si=!0,this.blitDepth()),J&&_i!==-1&&this.currentLayer===_i+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Kt,bt,bt?ke[bt.id]:void 0),this.renderLayer(this,bt,Kt,It(Kt,bt)),!this.terrain&&at&&ri>0&&Kt.hasShadowPass()&&--ri==0){{this.clearStencil(),this.resetStencilClippingMasks();const oi=this.currentLayer;for(this.currentLayer=0;this.currentLayer<he.length;this.currentLayer++){const ni=he[this.currentLayer];if(Ga[ni.type]){const Li=this.style.getLayerSourceCache(ni);Ga[ni.type](this,Li,ni,It(ni,Li))}}this.currentLayer=oi}if(at.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const oi=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=oi;this.currentLayer++){const ni=he[this.currentLayer];if(!ni.hasLightBeamPass())continue;const Li=r.getLayerSourceCache(ni);this.renderLayer(this,Li,ni,Li?Ae[Li.id]:void 0)}this.currentLayer=oi,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const oi=this.currentLayer;this.depthOcclusion=!0;for(const ni of this.layersWithOcclusionOpacity){this.currentLayer=ni;const Li=he[this.currentLayer],en=r.getLayerSourceCache(Li),xn=en?Ae[en.id]:void 0;this.terrain||this._renderTileClippingMasks(Li,en,en?ke[en.id]:void 0),this.renderLayer(this,en,Li,xn)}this.depthOcclusion=!1,this.currentLayer=oi,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Kt=null;he.forEach((bt=>{const oi=r.getLayerSourceCache(bt);oi&&!bt.isHidden(this.transform.zoom)&&oi.getVisibleCoordinates().length&&(!Kt||Kt.getSource().maxzoom<oi.getSource().maxzoom)&&(Kt=oi)})),Kt&&this.options.showTileBoundaries&&K(this,Kt,Kt.getVisibleCoordinates(),t.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&K(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Kt){const bt=Kt.transform.padding;ge(Kt,Kt.transform.height-(bt.top||0),3,y),ge(Kt,bt.bottom||0,3,I),xe(Kt,bt.left||0,3,D),xe(Kt,Kt.transform.width-(bt.right||0),3,j);const oi=Kt.transform.centerPoint;(function(ni,Li,en,xn){fe(ni,Li-1,en-10,2,20,xn),fe(ni,Li-10,en-1,20,2,xn)})(Kt,oi.x,Kt.transform.height-oi.y,H)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:h}=this.transform.projection,x=!h||!h.includes(r.type);if(Uo[r.type]&&(x||this.terrain&&r.type==="custom")){const E=this.style.getLayerSourceCache(r);Uo[r.type](r,E,this)}this.gpuTimingEnd()}renderLayer(r,h,x,E){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||x.type==="model"||x.type==="raster"||x.type==="raster-particle"||E&&E.length)&&(this.id=x.id,this.gpuTimingStart(x),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(x.type)&&(!r.terrain||x.type!=="custom")||x.type==="clip"||Ml[x.type](r,h,x,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,x=this.context.gl;let E=this.gpuTimers[r.id];E||(E=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:x.createQuery()}),E.calls++,x.beginQuery(h.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,h=this.context.gl,x=h.createQuery();this.deferredRenderGpuTimeQueries.push(x),h.beginQuery(r.TIME_ELAPSED_EXT,x)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const h={};for(const x in r){const E=r[x],M=this.context.extTimerQuery,k=M.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(E.query),h[x]=k}return h}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let x=0;for(const E of r)x+=h.getQueryParameter(E,h.QUERY_RESULT)/1e6,h.deleteQuery(E);return x}translatePosMatrix(r,h,x,E,M){if(!x[0]&&!x[1])return r;const k=M?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(k){const J=Math.sin(k),ee=Math.cos(k);x=[x[0]*ee-x[1]*J,x[0]*J+x[1]*ee]}const B=[M?x[0]:t.ay(h,x[0],this.transform.zoom),M?x[1]:t.ay(h,x[1],this.transform.zoom),0],G=new Float32Array(16);return t.br(G,r,B),G}saveTileTexture(r){if(r.context!==this.context)return;const h=r.size[0],x=this._tileTextures[h];x?x.push(r):this._tileTextures[h]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,h,x){const E=x===void 0?this.terrain&&this.terrain.renderingToTexture:x,M=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||E||h!==void 0&&!h||M.push("FOG","FOG_DITHERING"),E&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(r,h){this.cache=this.cache||{};const x=h&&h.defines||[],E=h&&h.config,M=this.currentGlobalDefines(r,h&&h.overrideFog,h&&h.overrideRtt).concat(x),k=du.cacheKey(hf[r],r,M,E);return this.cache[k]||(this.cache[k]=new du(this.context,r,hf[r],E,wf[r],M)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,h){if(this.style.enable3dLights()){const x=this.style.directionalLight,E=this.style.ambientLight;if(x&&E){const M=((k,B,G)=>{const J=k.properties.get("direction"),ee=k.properties.get("color-use-theme")==="none",ce=k.properties.get("color").toNonPremultipliedRenderColor(ee?null:G.getLut(k.scope)).toArray01(),le=k.properties.get("intensity"),he=B.properties.get("color-use-theme")==="none",be=B.properties.get("color").toNonPremultipliedRenderColor(he?null:G.getLut(B.scope)).toArray01(),_e=B.properties.get("intensity"),ke=[J.x,J.y,J.z],Ae=t.dN(be,_e),Oe=t.dN(ce,le);return{u_lighting_ambient_color:Ae,u_lighting_directional_dir:ke,u_lighting_directional_color:Oe,u_ground_radiance:rp(ke,Oe,Ae)}})(x,E,this.style);h.setLightsUniformValues(r,M)}}}uploadCommonUniforms(r,h,x,E,M){if(this.uploadCommonLightUniforms(r,h),this.terrain&&this.terrain.renderingToTexture)return;const k=this.style.fog;if(k){const B=k.getOpacity(this.transform.pitch),G=((J,ee,ce,le,he,be,_e,ke,Ae,Oe,He,Be)=>{const dt=J.transform,nt=ee.properties.get("color-use-theme")==="none",at=ee.properties.get("color").toNonPremultipliedRenderColor(nt?null:J.style.getLut(ee.scope)).toArray01();at[3]=le;const tt=J.frameCounter/1e3%1,[Je,mt]=ee.properties.get("vertical-range");return{u_fog_matrix:ce?dt.calculateFogTileMatrix(ce):Be||J.identityMat,u_fog_range:ee.getFovAdjustedRange(dt._fov),u_fog_color:at,u_fog_horizon_blend:ee.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Je,mt),mt],u_fog_temporal_offset:tt,u_frustum_tl:he,u_frustum_tr:be,u_frustum_br:_e,u_frustum_bl:ke,u_globe_pos:Ae,u_globe_radius:Oe,u_viewport:He,u_globe_transition:t.aj(dt.zoom),u_is_globe:+(dt.projection.name==="globe")}})(this,k,x,B,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.o.devicePixelRatio,this.transform.height*t.o.devicePixelRatio],E);h.setFogUniformValues(r,G)}M&&h.setCutoffUniformValues(r,M.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,h=r.createTexture();return r.bindTexture(r.TEXTURE_2D,h),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,h=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const E of x)h[E.key]=r[E.key]||new Vo(E,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,h){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[r.key];return h||(this._cachedTileFogOpacities[r.key]=h=this.style.fog.getOpacityForTile(r)),h[0]>=xi||h[1]>=xi}setupDepthForOcclusion(r,h,x){const E=this.context,M=E.gl,k=!!x;var B;x||(x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(M.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),x.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],x.u_depth_range_unpack=[2/((B=this.depthRangeFor3D)[1]-B[0]),-1-2*B[0]/(B[1]-B[0])],x.u_occluder_half_size=.5*this.occlusionParams.occluderSize,x.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),E.activeTexture.set(M.TEXTURE0),k||h.setTerrainUniformValues(E,x)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const r=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=r?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Yp(v,r){let h=!1,x=null;const E=()=>{x=null,h&&(v(),x=setTimeout(E,r),h=!1)};return()=>(h=!0,x||E(),x)}class Qm{constructor(r){this._hashName=r&&encodeURIComponent(r),t.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yp(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const h=$o(r);if(this._hashName){const x=this._hashName;let E=!1;const M=location.hash.slice(1).split("&").map((k=>{const B=k.split("=")[0];return B===x?(E=!0,`${B}=${h}`):k})).filter((k=>k));return E||M.push(`${x}=${h}`),`#${M.join("&")}`}return`#${h}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let h;return r.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(h=x)})),(h&&h[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some((x=>isNaN(Number(x))))){const x=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(h[3]||0):r.getBearing();return r.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:x,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function $o(v,r){const h=v.getCenter(),x=Math.round(100*v.getZoom())/100,E=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,E),k=Math.round(h.lng*M)/M,B=Math.round(h.lat*M)/M,G=v.getBearing(),J=v.getPitch();let ee=r?`/${k}/${B}/${x}`:`${x}/${B}/${k}`;return(G||J)&&(ee+="/"+Math.round(10*G)/10),J&&(ee+=`/${Math.round(J)}`),ee}const fp={linearity:.3,easing:t.eT(0,0,.3,1)},eg=Object.assign({deceleration:2500,maxSpeed:1400},fp),Kp=Object.assign({deceleration:20,maxSpeed:1400},fp),Pc=Object.assign({deceleration:1e3,maxSpeed:360},fp),ph=Object.assign({deceleration:1e3,maxSpeed:90},fp);class mh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.o.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=t.o.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)h.zoom+=M.zoomDelta||0,h.bearing+=M.bearingDelta||0,h.pitch+=M.pitchDelta||0,M.panDelta&&h.pan._add(M.panDelta),M.around&&(h.around=M.around),M.pinchAround&&(h.pinchAround=M.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const M=yu(h.pan.mag(),x,Object.assign({},eg,r||{}));E.offset=h.pan.mult(M.amount/h.pan.mag()),E.center=this._map.transform.center,zd(E,M)}if(h.zoom){const M=yu(h.zoom,x,Kp);E.zoom=this._map.transform.zoom+M.amount,zd(E,M)}if(h.bearing){const M=yu(h.bearing,x,Pc);E.bearing=this._map.transform.bearing+t.aA(M.amount,-179,179),zd(E,M)}if(h.pitch){const M=yu(h.pitch,x,ph);E.pitch=this._map.transform.pitch+M.amount,zd(E,M)}if(E.zoom||E.bearing){const M=h.pinchAround===void 0?h.around:h.pinchAround;E.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function zd(v,r){(!v.duration||v.duration<r.duration)&&(v.duration=r.duration,v.easing=r.easing)}function yu(v,r,h){const{maxSpeed:x,linearity:E,deceleration:M}=h,k=t.aA(v*E/(r/1e3),-x,x),B=Math.abs(k)/(M*E);return{easing:h.easing,duration:1e3*B,amount:k*(B/2)}}class kl extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,x,E={}){const M=je(h.getCanvasContainer(),x),k=h.unproject(M);super(r,Object.assign({point:M,lngLat:k,originalEvent:x},E)),this._defaultPrevented=!1,this.target=h}}class ju extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,x){const E=r==="touchend"?x.changedTouches:x.touches,M=Ye(h.getCanvasContainer(),E),k=M.map((G=>h.unproject(G))),B=M.reduce(((G,J,ee,ce)=>G.add(J.div(ce.length))),new t.P(0,0));super(r,{points:M,point:B,lngLats:k,lngLat:h.unproject(B),originalEvent:x}),this._defaultPrevented=!1}}class tg extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class e_{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new tg(this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new kl(r.type,this._map,r))}mouseup(r){this._map.fire(new kl(r.type,this._map,r))}preclick(r){const h=new MouseEvent("preclick",r);this._map.fire(new kl(h.type,this._map,h))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(r),this._map.fire(new kl(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new kl(r.type,this._map,r))}mouseover(r){this._map.fire(new kl(r.type,this._map,r))}mouseout(r){this._map.fire(new kl(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ju(r.type,this._map,r))}touchmove(r){this._map.fire(new ju(r.type,this._map,r))}touchend(r){this._map.fire(new ju(r.type,this._map,r))}touchcancel(r){this._map.fire(new ju(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class g0{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new kl(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new kl(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ig{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(Ee(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const x=h,E=this._startPos,M=this._lastPos;if(!E||!M||M.equals(x)||!this._box&&x.dist(E)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const k=Math.min(E.x,x.x),B=Math.max(E.x,x.x),G=Math.min(E.y,x.y),J=Math.max(E.y,x.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${k}px,${G}px)`,this._box.style.width=B-k+"px",this._box.style.height=J-G+"px")}))}mouseupWindow(r,h){if(!this._active)return;const x=this._startPos,E=h;if(x&&r.button===0){if(this.reset(),We(),x.x!==E.x||x.y!==E.y)return this._map.fire(new t.z("boxzoomend",{originalEvent:r})),{cameraAnimation:M=>M.fitScreenCoordinates(x,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pe(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new t.z(r,{originalEvent:h}))}}function uy(v,r){const h={};for(let x=0;x<v.length;x++)h[v[x].identifier]=r[x];return h}class hy{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,h,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),x.length===this.numTouches&&(this.centroid=(function(E){const M=new t.P(0,0);for(const k of E)M._add(k);return M.div(E.length)})(h),this.touches=uy(x,h)))}touchmove(r,h,x){if(this.aborted||!this.centroid)return;const E=uy(x,h);for(const M in this.touches){const k=E[M];(!k||k.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(r,h,x){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class t_{constructor(r){this.singleTap=new hy(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,h,x){this.singleTap.touchstart(r,h,x)}touchmove(r,h,x){this.singleTap.touchmove(r,h,x)}touchend(r,h,x){const E=this.singleTap.touchend(r,h,x);if(E){const M=r.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(E)<30;if(M&&k||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class _0{constructor(){this._zoomIn=new t_({numTouches:1,numTaps:2}),this._zoomOut=new t_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,x){this._zoomIn.touchstart(r,h,x),this._zoomOut.touchstart(r,h,x)}touchmove(r,h,x){this._zoomIn.touchmove(r,h,x),this._zoomOut.touchmove(r,h,x)}touchend(r,h,x){const E=this._zoomIn.touchend(r,h,x),M=this._zoomOut.touchend(r,h,x);return E?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(E)},{originalEvent:r})}):M?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(M)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jp={0:1,2:2},y0={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Cf{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,h){return!1}_move(r,h){return{}}mousedown(r,h){if(this._lastPoint)return;const x=ct(r);this._correctButton(r,x)&&(this._lastPoint=h,this._eventButton=x)}mousemoveWindow(r,h){const x=this._lastPoint;if(x){if(r.preventDefault(),this._eventButton!=null&&(function(E,M){const k=Jp[M];return E.buttons===void 0||(E.buttons&k)!==k})(r,this._eventButton))this.reset();else if(this._moved||!(h.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(x,h)}}mouseupWindow(r){this._lastPoint&&ct(r)===this._eventButton&&(this._moved&&We(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class i_ extends Cf{mousedown(r,h){super.mousedown(r,h),this._lastPoint&&(this._active=!0)}_correctButton(r,h){return h===0&&!r.ctrlKey}_move(r,h){return{around:h,panDelta:h.sub(r)}}}class ng extends Cf{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?y0[r.pitchRotateKey]:void 0}_correctButton(r,h){return this._pitchRotateKey?h===0&&r[this._pitchRotateKey]:h===0&&r.ctrlKey||h===2}_move(r,h){const x=.8*(h.x-r.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class v0 extends Cf{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?y0[r.pitchRotateKey]:void 0}_correctButton(r,h){return this._pitchRotateKey?h===0&&r[this._pitchRotateKey]:h===0&&r.ctrlKey||h===2}_move(r,h){const x=-.5*(h.y-r.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class wv{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),t.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(r,h,x){return this._calculateTransform(r,h,x)}touchmove(r,h,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1&&!t.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,h,x)}}touchend(r,h,x){this._calculateTransform(r,h,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,x){x.length>0&&(this._active=!0);const E=uy(x,h),M=new t.P(0,0),k=new t.P(0,0);let B=0;for(const J in E){const ee=E[J],ce=this._touches[J];ce&&(M._add(ee),k._add(ee.sub(ce)),B++,E[J]=ee)}if(this._touches=E,B<this._minTouches||!k.mag())return;const G=k.div(B);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(B),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class dy{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,h,x){return{}}touchstart(r,h,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,x){const E=this._firstTwoTouches;if(!E)return;r.preventDefault();const[M,k]=E,B=n_(x,h,M),G=n_(x,h,k);if(!B||!G)return;const J=this._aroundCenter?null:B.add(G).div(2);return this._move([B,G],J,r)}touchend(r,h,x){if(!this._firstTwoTouches)return;const[E,M]=this._firstTwoTouches,k=n_(x,h,E),B=n_(x,h,M);k&&B||(this._active&&We(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function n_(v,r,h){for(let x=0;x<v.length;x++)if(v[x].identifier===h)return r[x]}function Tv(v,r){return Math.log2(v/r)}class Sv extends dy{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const x=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Tv(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tv(this._distance,x),pinchAround:h}}}function fy(v,r){return 180*v.angleWith(r)/Math.PI}class bo extends dy{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h){const x=this._vector;if(this._vector=r[0].sub(r[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fy(this._vector,x),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const E=fy(r,x);return Math.abs(E)<h}}function r_(v){return Math.abs(v.y)>Math.abs(v.x)}class bb extends dy{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,r_(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,x){const E=this._lastPoints;if(!E)return;const M=r[0].sub(E[0]),k=r[1].sub(E[1]);return this._map._cooperativeGestures&&!t.eU()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(M,k,x.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(M.y+k.y)/2*-.5})}gestureBeginsVertically(r,h,x){if(this._valid!==void 0)return this._valid;const E=r.mag()>=2,M=h.mag()>=2;if(!E&&!M)return;if(!E||!M)return this._firstMove==null&&(this._firstMove=x),x-this._firstMove<100&&void 0;const k=r.y>0==h.y>0;return r_(r)&&r_(h)&&k}}const wb={panStep:100,bearingStep:15,pitchStep:10};class Ev{constructor(){const r=wb;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,x=0,E=0,M=0,k=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?x=-1:(r.preventDefault(),M=-1);break;case 39:r.shiftKey?x=1:(r.preventDefault(),M=1);break;case 38:r.shiftKey?E=1:(r.preventDefault(),k=-1);break;case 40:r.shiftKey?E=-1:(r.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(x=0,E=0),{cameraAnimation:B=>{const G=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:rg,zoom:h?Math.round(G)+h*(r.shiftKey?2:1):G,bearing:B.getBearing()+x*this._bearingStep,pitch:B.getPitch()+E*this._pitchStep,offset:[-M*this._panStep,-k*this._panStep],center:B.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rg(v){return v*(2-v)}const x0=4.000244140625,s_=1/450;class o_{constructor(r,h){this._map=r,this._el=r.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=s_,t.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||t.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const x=t.o.now(),E=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,h!==0&&h%x0==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=je(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const J=this._type==="wheel"&&Math.abs(this._delta)>x0?this._wheelZoomRate:this._defaultZoomRate;let ee=2/(1+Math.exp(-Math.abs(this._delta*J)));this._delta<0&&ee!==0&&(ee=1/ee);const ce=h(),le=Math.pow(2,ce),he=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):le;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(he*ee))),this._type==="wheel"&&(this._startZoom=ce,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:h(),E=this._startZoom,M=this._easing;let k,B=!1;if(this._type==="wheel"&&E&&M){const J=Math.min((t.o.now()-this._lastWheelEventTime)/200,1),ee=M(J);k=t.ak(E,x,ee),J<1?this._frameId||(this._frameId=!0):B=!0}else k=x,B=!0;this._active=!0,B&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let G=k-h();return G*this._lastDelta<0&&(G=0),{noInertia:!0,needsRenderFrame:!B,zoomDelta:G,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=t.eV;if(this._prevEase){const x=this._prevEase,E=(t.o.now()-x.start)/x.duration,M=x.easing(E+.01)-x.easing(E),k=.27/Math.sqrt(M*M+1e-4)*.01,B=Math.sqrt(.0729-k*k);h=t.eT(k,B,.25,1)}return this._prevEase={start:t.o.now(),duration:r,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class qh{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,h){return r.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(r.shiftKey?-1:1),around:x.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lo{constructor(){this._tap=new t_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,h,x){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=h[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(r,h,x))}touchmove(r,h,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const E=h[0],M=E.y-this._swipePoint.y;return this._swipePoint=E,r.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(r,h,x)}touchend(r,h,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(r,h,x)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(r,h,x){this._el=r,this._mousePan=h,this._touchPan=x}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qp{constructor(r,h,x){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class py{constructor(r,h,x,E){this._el=r,this._touchZoom=h,this._touchRotate=x,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sg=v=>v.zoom||v.drag||v.pitch||v.rotate;class Tb extends t.z{}class a_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,h){const x=t.av([],h,r);this.radius=t.ag(x[2]<0?t.eX([],x,this.constants):[x[0],x[1],0])}projectRay(r){t.eX(r,r,this.constants),t.aw(r,r),t.eY(r,r,this.constants);const h=t.c5([],r,this.radius);if(h[2]>0){const x=t.c5([],[0,0,1],t.bJ(h,[0,0,1])),E=t.c5([],t.aw([],[h[0],h[1],0]),this.radius),M=t.d8([],h,t.c5([],t.av([],t.d8([],E,x),h),2));h[0]=M[0],h[1]=M[1]}return h}}function l_(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Sb{constructor(r,h){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mh(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new a_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),t.aY(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,M,k]of this._listeners){const B=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(M,B,k)}}destroy(){for(const[r,h,x]of this._listeners){const E=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(h,E,x)}}_addDefaultHandlers(r){const h=this._map,x=h.getCanvasContainer();this._add("mapEvent",new e_(h,r));const E=h.boxZoom=new ig(h,r);this._add("boxZoom",E);const M=new _0,k=new pp;h.doubleClickZoom=new qh(k,M),this._add("tapZoom",M),this._add("clickZoom",k);const B=new lo;this._add("tapDragZoom",B);const G=h.touchPitch=new bb(h);this._add("touchPitch",G);const J=new ng(r),ee=new v0(r);h.dragRotate=new Qp(r,J,ee),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);const ce=new i_(r),le=new wv(h,r);h.dragPan=new Hh(x,ce,le),this._add("mousePan",ce),this._add("touchPan",le,["touchZoom","touchRotate"]);const he=new bo,be=new Sv;h.touchZoomRotate=new py(x,be,he,B),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),this._add("blockableMapEvent",new g0(h));const _e=h.scrollZoom=new o_(h,this);this._add("scrollZoom",_e,["mousePan"]);const ke=h.keyboard=new Ev;this._add("keyboard",ke);for(const Ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Ae]&&h[Ae].enable(r[Ae])}_add(r,h,x){this._handlers.push({handlerName:r,handler:h,allowed:x}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,h,x){for(const E in r)if(E!==x&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const h=[];for(const x of r)this._el.contains(x.target)&&h.push(x);return h}handleEvent(r,h){this._updatingCamera=!0;const x=r.type==="renderFrame",E=x?void 0:r,M={needsRenderFrame:!1},k={},B={},G=r.touches?this._getMapTouches(r.touches):void 0,J=G?Ye(this._el,G):x?void 0:je(this._el,r);for(const{handlerName:le,handler:he,allowed:be}of this._handlers){if(!he.isEnabled())continue;let _e;this._blockedByActive(B,be,le)?he.reset():he[h||r.type]&&(_e=he[h||r.type](r,J,G),this.mergeHandlerResult(M,k,_e,le,E),_e&&_e.needsRenderFrame&&this._triggerRenderFrame()),(_e||he.isActive())&&(B[le]=he)}const ee={};for(const le in this._previousActiveHandlers)B[le]||(ee[le]=E);this._previousActiveHandlers=B,(Object.keys(ee).length||l_(M))&&(this._changes.push([M,k,ee]),this._triggerRenderFrame()),(Object.keys(B).length||l_(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=M;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))}mergeHandlerResult(r,h,x,E,M){if(!x)return;Object.assign(r,x);const k={handlerName:E,originalEvent:x.originalEvent||M};x.zoomDelta!==void 0&&(h.zoom=k),x.panDelta!==void 0&&(h.drag=k),x.pitchDelta!==void 0&&(h.pitch=k),x.bearingDelta!==void 0&&(h.rotate=k)}_applyChanges(){const r={},h={},x={};for(const[E,M,k]of this._changes)E.panDelta&&(r.panDelta=(r.panDelta||new t.P(0,0))._add(E.panDelta)),E.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(r.around=E.around),E.aroundCoord!==void 0&&(r.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(r.pinchAround=E.pinchAround),E.noInertia&&(r.noInertia=E.noInertia),Object.assign(h,M),Object.assign(x,k);this._updateMapTransform(r,h,x),this._changes=[]}_updateMapTransform(r,h,x){const E=this._map,M=E.transform,k=Oe=>[Oe.x,Oe.y,Oe.z];if((Oe=>{const He=this._eventsInProgress.drag;return He&&!this._handlersById[He.handlerName].isActive()})()&&!l_(r)){const Oe=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),Oe!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&E._stop(!0),!l_(r))return void this._fireEvents(h,x,!0);let{panDelta:B,zoomDelta:G,bearingDelta:J,pitchDelta:ee,around:ce,aroundCoord:le,pinchAround:he}=r;M._isCameraConstrained&&(G>0&&(G=0),M._isCameraConstrained=!1),he!==void 0&&(ce=he),(G||(Oe=>h[Oe]&&!this._eventsInProgress[Oe])("drag"))&&ce&&(this._dragOrigin=k(M.pointCoordinate3D(ce)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",E._stop(!0),ce=ce||E.transform.centerPoint,J&&(M.bearing+=J),ee&&(M.pitch+=ee),M._updateCameraState();const be=[0,0,0];if(B)if(M.projection.name==="mercator"){const Oe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(ce).dir),He=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(ce.sub(B)).dir);be[0]=He[0]-Oe[0],be[1]=He[1]-Oe[1]}else{const Oe=M.pointCoordinate(ce);if(M.projection.name==="globe"){B=B.rotate(-M.angle);const He=M._pixelsPerMercatorPixel/M.worldSize;be[0]=-B.x*t.eW(t.a$(Oe.y))*He,be[1]=-B.y*t.eW(M.center.lat)*He}else{const He=M.pointCoordinate(ce.sub(B));Oe&&He&&(be[0]=He.x-Oe.x,be[1]=He.y-Oe.y)}}const _e=M.zoom,ke=[0,0,0];if(G){const Oe=k(le||M.pointCoordinate3D(ce)),He={dir:t.aw([],t.av([],Oe,M._camera.position))};if(He.dir[2]<0){const Be=M.zoomDeltaToMovement(Oe,G);t.c5(ke,He.dir,Be)}}const Ae=t.d8(be,be,ke);M._translateCameraConstrained(Ae),G&&Math.abs(M.zoom-_e)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,x,!0)}_fireEvents(r,h,x){const E=sg(this._eventsInProgress),M=sg(r),k={};for(const ee in r){const{originalEvent:ce}=r[ee];this._eventsInProgress[ee]||(k[`${ee}start`]=ce),this._eventsInProgress[ee]=r[ee]}!E&&M&&this._fireEvent("movestart",M.originalEvent);for(const ee in k)this._fireEvent(ee,k[ee]);M&&this._fireEvent("move",M.originalEvent);for(const ee in r){const{originalEvent:ce}=r[ee];this._fireEvent(ee,ce)}const B={};let G;for(const ee in this._eventsInProgress){const{handlerName:ce,originalEvent:le}=this._eventsInProgress[ee];this._handlersById[ce].isActive()||(delete this._eventsInProgress[ee],G=h[ce]||le,B[`${ee}end`]=G)}for(const ee in B)this._fireEvent(ee,B[ee]);const J=sg(this._eventsInProgress);if(x&&(E||M)&&!J){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ce=le=>le!==0&&-this._bearingSnap<le&&le<this._bearingSnap;ee?(ce(ee.bearing||this._map.getBearing())&&(ee.bearing=0),this._map.easeTo(ee,{originalEvent:G})):(this._map.fire(new t.z("moveend",{originalEvent:G})),ce(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new t.z(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((r=>{this._frameId=void 0,this.handleEvent(new Tb("renderFrame",{timeStamp:r})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const og="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class my extends t.E{constructor(r,h){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,t.aY(["_renderFrameCallback"],this)}getCenter(){return new t.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,x){return r=t.P.convert(r).mult(-1),this.panTo(this.transform.center,Object.assign({offset:r},h),x)}panTo(r,h,x){return this.easeTo(Object.assign({center:r},h),x)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,x){return this.easeTo(Object.assign({zoom:r},h),x)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,x){return this.easeTo(Object.assign({bearing:r},h),x)}resetNorth(r,h){return this.rotateTo(0,Object.assign({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=t.aI.convert(r);const x=h&&h.bearing||0,E=h&&h.pitch||0,M=r.getNorthWest(),k=r.getSouthEast();return this._cameraForBounds(this.transform,M,k,x,E,h)}_extendPadding(r){const h={top:0,right:0,bottom:0,left:0};return r==null?Object.assign({},h,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:Object.assign({},h,r)}_extendCameraOptions(r){return(r=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,h){const x=h.max[0]-h.min[0],E=h.max[1]-h.min[1];return x/E>r.aspect?x/(2*Math.tan(.5*r.fovX)*r.aspect):E/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,h,x,E,M,k){const B=r.clone(),G=this._extendCameraOptions(k);B.bearing=E,B.pitch=M;const J=t.aT.convert(h),ee=t.aT.convert(x),ce=.5*(J.lat+ee.lat),le=.5*(J.lng+ee.lng),he=t.eZ(ce,le),be=t.aw([],he),_e=t.aw([],t.bI([],be,[0,1,0])),ke=t.bI([],_e,be),Ae=[_e[0],_e[1],_e[2],0,ke[0],ke[1],ke[2],0,be[0],be[1],be[2],0,0,0,0,1],Oe=[he,t.eZ(J.lat,J.lng),t.eZ(ee.lat,J.lng),t.eZ(ee.lat,ee.lng),t.eZ(J.lat,ee.lng),t.eZ(ce,J.lng),t.eZ(ce,ee.lng),t.eZ(J.lat,le),t.eZ(ee.lat,le)];let He=t.d9.fromPoints(Oe.map((ni=>[t.bJ(_e,ni),t.bJ(ke,ni),t.bJ(be,ni)])));const Be=t.af([],He.center,Ae);t.e_(Be)===0&&t.e$(Be,0,0,1),t.aw(Be,Be),t.c5(Be,Be,t.aD),B.center=t.f0(Be);const dt=B.getWorldToCameraMatrix(),nt=t.bl(new Float64Array(16),dt);He=t.d9.applyTransform(He,t.aB([],dt,Ae));const at=this._extendAABB(He,B,G,E);if(!at)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");He=at,t.af(Be,Be,dt);const tt=.5*(He.max[2]-He.min[2]),Je=this._minimumAABBFrustumDistance(B,He),mt=t.c5([],[0,0,1],tt),Pt=t.d8(mt,Be,mt),It=Je+(B.pitch===0?0:t.bG(Be,Pt)),ri=B.globeCenterInViewSpace,si=t.av([],Be,[ri[0],ri[1],ri[2]]);t.aw(si,si),t.c5(si,si,It);const _i=t.d8([],Be,si);t.af(_i,_i,nt);const Vi=t.eM/t.aD,Kt=t.ag(_i),bt=t.cf(Math.max(Kt*Vi-t.eM,Number.EPSILON),0),oi=Math.min(B.zoomFromMercatorZAdjusted(bt),G.maxZoom);return oi>.5*(t.c_+t.cL)?(B.setProjection({name:"mercator"}),B.zoom=oi,this._cameraForBounds(B,h,x,E,M,k)):{center:B.center,zoom:oi,bearing:E,pitch:M}}_extendAABB(r,h,x,E){const M=.5*((x.padding.left||0)+(x.padding.right||0)),k=.5*((x.padding.top||0)+(x.padding.bottom||0)),B=k,G=M,J=M,ee=k,ce=h.width-(G+J),le=h.height-(B+ee),he=t.av([],r.max,r.min),be=Math.min(ce/he[0],le/he[1]),_e=Math.min(h.scaleZoom(h.scale*be),x.maxZoom);if(isNaN(_e))return null;const ke=h.scale/h.zoomScale(_e),Ae=new t.d9([r.min[0]-G*ke,r.min[1]-ee*ke,r.min[2]],[r.max[0]+J*ke,r.max[1]+B*ke,r.max[2]]),Oe=(typeof x.offset.x=="number"&&typeof x.offset.y=="number"?new t.P(x.offset.x,x.offset.y):t.P.convert(x.offset)).rotate(-t.an(E));return Ae.center[0]-=Oe.x*ke,Ae.center[1]+=Oe.y*ke,Ae}queryTerrainElevation(r,h){const x=this.transform.elevation;return x?(h=Object.assign({},{exaggerated:!0},h),x.getAtPoint(t.ae.fromLngLat(r),null,h.exaggerated)):null}_cameraForBounds(r,h,x,E,M,k){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,h,x,E,M,k);const B=r.clone(),G=this._extendCameraOptions(k);B.bearing=E,B.pitch=M;const J=t.aT.convert(h),ee=t.aT.convert(x),ce=new t.aT(J.lng,ee.lat),le=new t.aT(ee.lng,J.lat),he=B.project(J),be=B.project(ee),_e=this.queryTerrainElevation(J),ke=this.queryTerrainElevation(ee),Ae=this.queryTerrainElevation(ce),Oe=this.queryTerrainElevation(le),He=[[he.x,he.y,Math.min(_e||0,ke||0,Ae||0,Oe||0)],[be.x,be.y,Math.max(_e||0,ke||0,Ae||0,Oe||0)]];let Be=t.d9.fromPoints(He);const dt=B.getWorldToCameraMatrix(),nt=t.bl(new Float64Array(16),dt);Be=t.d9.applyTransform(Be,dt);const at=this._extendAABB(Be,B,G,E);if(!at)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Be=at;const tt=.5*t.av([],Be.max,Be.min)[2],Je=this._minimumAABBFrustumDistance(B,Be),mt=[0,0,1,0];t.aC(mt,mt,dt),t.f1(mt,mt);const Pt=t.c5([],mt,Je+tt),It=t.d8([],Be.center,Pt);t.af(Be.center,Be.center,nt),t.af(It,It,nt);const ri=B.unproject(new t.P(Be.center[0],Be.center[1])),si=t.f2(B.projection,ri),_i=Math.pow(2,si),Vi=Math.min(B._zoomFromMercatorZ(It[2]*B.pixelsPerMeter*_i/B.worldSize),G.maxZoom);return B.mercatorFromTransition&&Vi<.5*(t.c_+t.cL)?(B.setProjection({name:"globe"}),B.zoom=Vi,this._cameraForBounds(B,h,x,E,M,k)):{center:ri,zoom:Vi,bearing:E,pitch:M}}fitBounds(r,h,x){const E=this.cameraForBounds(r,h);return this._fitInternal(E,h,x)}fitScreenCoordinates(r,h,x,E,M){const k=t.P.convert(r),B=t.P.convert(h),G=new t.P(Math.min(k.x,B.x),Math.min(k.y,B.y)),J=new t.P(Math.max(k.x,B.x),Math.max(k.y,B.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(k,B))return this;const ee=this.transform.pointLocation3D(G),ce=this.transform.pointLocation3D(J),le=this.transform.pointLocation3D(new t.P(G.x,J.y)),he=this.transform.pointLocation3D(new t.P(J.x,G.y)),be=[Math.min(ee.lng,ce.lng,le.lng,he.lng),Math.min(ee.lat,ce.lat,le.lat,he.lat)],_e=[Math.max(ee.lng,ce.lng,le.lng,he.lng),Math.max(ee.lat,ce.lat,le.lat,he.lat)],ke=E&&E.pitch?E.pitch:this.getPitch(),Ae=this._cameraForBounds(this.transform,be,_e,x,ke,E);return this._fitInternal(Ae,E,M)}_fitInternal(r,h,x){return r?(h=Object.assign(r,h)).linear?this.easeTo(h,x):this.flyTo(h,x):this}jumpTo(r,h){this.stop();const x=r.preloadOnly?this.transform.clone():this.transform;let E=!1,M=!1,k=!1;"zoom"in r&&x.zoom!==+r.zoom&&(E=!0,x.zoom=+r.zoom),r.center!==void 0&&(x.center=t.aT.convert(r.center)),"bearing"in r&&x.bearing!==+r.bearing&&(M=!0,x.bearing=+r.bearing),"pitch"in r&&x.pitch!==+r.pitch&&(k=!0,x.pitch=+r.pitch);const B=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!x.isPaddingEqual(B))if(r.retainPadding===!1){const G=x.clone();G.padding=B,x.setLocationAtPoint(x.center,G.centerPoint)}else x.padding=B;return r.preloadOnly?(this._preloadTiles(x),this):(this.fire(new t.z("movestart",h)).fire(new t.z("move",h)),E&&this.fire(new t.z("zoomstart",h)).fire(new t.z("zoom",h)).fire(new t.z("zoomend",h)),M&&this.fire(new t.z("rotatestart",h)).fire(new t.z("rotate",h)).fire(new t.z("rotateend",h)),k&&this.fire(new t.z("pitchstart",h)).fire(new t.z("pitch",h)).fire(new t.z("pitchend",h)),this.fire(new t.z("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(og),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,h){const x=this.transform;if(!x.projection.supportsFreeCamera)return t.w(og),this;this.stop();const E=x.zoom,M=x.pitch,k=x.bearing;x.setFreeCameraOptions(r);const B=E!==x.zoom,G=M!==x.pitch,J=k!==x.bearing;return this.fire(new t.z("movestart",h)).fire(new t.z("move",h)),B&&this.fire(new t.z("zoomstart",h)).fire(new t.z("zoom",h)).fire(new t.z("zoomend",h)),J&&this.fire(new t.z("rotatestart",h)).fire(new t.z("rotate",h)).fire(new t.z("rotateend",h)),G&&this.fire(new t.z("pitchstart",h)).fire(new t.z("pitch",h)).fire(new t.z("pitchend",h)),this.fire(new t.z("moveend",h)),this}easeTo(r,h){this._stop(!1,r.easeId),((r=Object.assign({offset:[0,0],duration:500,easing:t.eV},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const x=this.transform,E=this.getZoom(),M=this.getBearing(),k=this.getPitch(),B=this.getPadding(),G="zoom"in r?+r.zoom:E,J="bearing"in r?this._normalizeBearing(r.bearing,M):M,ee="pitch"in r?+r.pitch:k,ce=this._extendPadding(r.padding),le=t.P.convert(r.offset);let he,be,_e;if(x.projection.name==="globe"){const mt=t.ae.fromLngLat(x.center),Pt=le.rotate(-x.angle);mt.x+=Pt.x/x.worldSize,mt.y+=Pt.y/x.worldSize;const It=mt.toLngLat(),ri=t.aT.convert(r.center||It);this._normalizeCenter(ri),he=x.centerPoint.add(Pt),be=new t.P(mt.x,mt.y).mult(x.worldSize),_e=new t.P(t.aF(ri.lng),t.aJ(ri.lat)).mult(x.worldSize).sub(be)}else{he=x.centerPoint.add(le);const mt=x.pointLocation(he),Pt=t.aT.convert(r.center||mt);this._normalizeCenter(Pt),be=x.project(mt),_e=x.project(Pt).sub(be)}const ke=x.zoomScale(G-E);let Ae,Oe;r.around&&(Ae=t.aT.convert(r.around),Oe=x.locationPoint(Ae));const He=this._zooming||G!==E,Be=this._rotating||M!==J,dt=this._pitching||ee!==k,nt=!x.isPaddingEqual(ce),at=r.retainPadding===!1?x.clone():x,tt=mt=>Pt=>{if(He&&(mt.zoom=t.ak(E,G,Pt)),Be&&(mt.bearing=t.ak(M,J,Pt)),dt&&(mt.pitch=t.ak(k,ee,Pt)),nt&&(at.interpolatePadding(B,ce,Pt),he=at.centerPoint.add(le)),Ae)mt.setLocationAtPoint(Ae,Oe);else{const It=mt.zoomScale(mt.zoom-E),ri=G>E?Math.min(2,ke):Math.max(.5,ke),si=Math.pow(ri,1-Pt),_i=mt.unproject(be.add(_e.mult(Pt*si)).mult(It));mt.setLocationAtPoint(mt.renderWorldCopies?_i.wrap():_i,he)}return r.preloadOnly||this._fireMoveEvents(h),mt};if(r.preloadOnly){const mt=this._emulate(tt,r.duration,x);return this._preloadTiles(mt),this}const Je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=He,this._rotating=Be,this._pitching=dt,this._padding=nt,this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,Je),this._ease(tt(x),(mt=>{x.cameraElevationReference==="sea"&&x.recenterOnTerrain(),this._afterEase(h,mt)}),r),this}_prepareEase(r,h,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||x.moving||this.fire(new t.z("movestart",r)),this._zooming&&!x.zooming&&this.fire(new t.z("zoomstart",r)),this._rotating&&!x.rotating&&this.fire(new t.z("rotatestart",r)),this._pitching&&!x.pitching&&this.fire(new t.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new t.z("move",r)),this._zooming&&this.fire(new t.z("zoom",r)),this._rotating&&this.fire(new t.z("rotate",r)),this._pitching&&this.fire(new t.z("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,E=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new t.z("zoomend",r)),E&&this.fire(new t.z("rotateend",r)),M&&this.fire(new t.z("pitchend",r)),this.fire(new t.z("moveend",r))}flyTo(r,h){if(this._prefersReducedMotion(r)){const ni=t.aH(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ni,h)}this.stop(),r=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:t.eV},r);const x=this.transform,E=this.getZoom(),M=this.getBearing(),k=this.getPitch(),B=this.getPadding(),G="zoom"in r?t.aA(+r.zoom,x.minZoom,x.maxZoom):E,J="bearing"in r?this._normalizeBearing(r.bearing,M):M,ee="pitch"in r?+r.pitch:k,ce=this._extendPadding(r.padding),le=x.zoomScale(G-E),he=t.P.convert(r.offset);let be=x.centerPoint.add(he);const _e=x.pointLocation(be),ke=t.aT.convert(r.center||_e);this._normalizeCenter(ke);const Ae=x.project(_e),Oe=x.project(ke).sub(Ae);let He=r.curve;const Be=Math.max(x.width,x.height),dt=Be/le,nt=Oe.mag();if("minZoom"in r){const ni=t.aA(Math.min(r.minZoom,E,G),x.minZoom,x.maxZoom),Li=Be/x.zoomScale(ni-E);He=Math.sqrt(Li/nt*2)}const at=He*He;function tt(ni){const Li=(dt*dt-Be*Be+(ni?-1:1)*at*at*nt*nt)/(2*(ni?dt:Be)*at*nt);return Math.log(Math.sqrt(Li*Li+1)-Li)}function Je(ni){return(Math.exp(ni)-Math.exp(-ni))/2}function mt(ni){return(Math.exp(ni)+Math.exp(-ni))/2}const Pt=tt(0);let It=function(ni){return mt(Pt)/mt(Pt+He*ni)},ri=function(ni){return Be*((mt(Pt)*(Je(Li=Pt+He*ni)/mt(Li))-Je(Pt))/at)/nt;var Li},si=(tt(1)-Pt)/He;if(Math.abs(nt)<1e-6||!isFinite(si)){if(Math.abs(Be-dt)<1e-6)return this.easeTo(r,h);const ni=dt<Be?-1:1;si=Math.abs(Math.log(dt/Be))/He,ri=function(){return 0},It=function(Li){return Math.exp(ni*He*Li)}}r.duration="duration"in r?+r.duration:1e3*si/("screenSpeed"in r?+r.screenSpeed/He:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const _i=M!==J,Vi=ee!==k,Kt=!x.isPaddingEqual(ce),bt=r.retainPadding===!1?x.clone():x,oi=ni=>Li=>{const en=Li*si,xn=1/It(en);ni.zoom=Li===1?G:E+ni.scaleZoom(xn),_i&&(ni.bearing=t.ak(M,J,Li)),Vi&&(ni.pitch=t.ak(k,ee,Li)),Kt&&(bt.interpolatePadding(B,ce,Li),be=bt.centerPoint.add(he));const Yi=Li===1?ke:ni.unproject(Ae.add(Oe.mult(ri(en))).mult(xn));return ni.setLocationAtPoint(ni.renderWorldCopies?Yi.wrap():Yi,be),ni._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(h),ni};if(r.preloadOnly){const ni=this._emulate(oi,r.duration,x);return this._preloadTiles(ni),this}return this._zooming=!0,this._rotating=_i,this._pitching=Vi,this._padding=Kt,this._prepareEase(h,!1),this._ease(oi(x),(()=>this._afterEase(h)),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,h)}if(!r){const x=this.handlers;x&&x.stop(!1)}return this}_ease(r,h,x){x.animate===!1||x.duration===0?(r(1),h()):(this._easeStart=t.o.now(),this._easeOptions=x,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((t.o.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,h){r=t.bT(r,-180,180);const x=Math.abs(r-h);return Math.abs(r-360-h)<x&&(r-=360),Math.abs(r+360-h)<x&&(r+=360),r}_normalizeCenter(r){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const x=r.lng-h.center.lng;r.lng+=x>180?-360:x<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&t.o.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,h,x){const E=Math.ceil(15*h/1e3),M=[],k=r(x.clone());for(let B=0;B<=E;B++){const G=k(B/E);M.push(G.clone())}return M}_preloadTiles(r,h){}}class ag{constructor(r={}){this.options=r,t.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const h=this.options&&this.options.compact,x=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",x);const E=se("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",x),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.e.ACCESS_TOKEN}];if(r){const x=h.reduce(((E,M,k)=>(M.value&&(E+=`${M.key}=${M.value}${k<h.length-1?"&":""}`),E)),"?");r.href=`${t.e.FEEDBACK_URL}/${x}#${$o(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||(r.dataType!=="source"||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility")&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style._mergedSourceCaches;for(const E in h){const M=h[E];if(M.used){const k=M.getSource();k.attribution&&r.indexOf(k.attribution)<0&&r.push(k.attribution)}}r.sort(((E,M)=>E.length-M.length)),r=r.filter(((E,M)=>{for(let k=M+1;k<r.length;k++)if(r[k].indexOf(E)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const x=r.map((E=>(function(M){const k=new DOMParser().parseFromString(M,"text/html");return Array.from(k.body.querySelectorAll("*")).forEach((B=>{const G=B.textContent||"";if(B.tagName!=="A")return void B.replaceWith(k.createTextNode(G));const J=B.getAttribute("href");if(!J||!/^(https?:|mailto:)/i.test(J))return void B.replaceWith(k.createTextNode(G));const ee=k.createElement("a");ee.href=J,ee.textContent=G,ee.rel="noopener nofollow";const ce=B.getAttribute("class");ce&&(ee.className=ce),B.replaceWith(ee)})),k.body.innerHTML})(E))).join(" | ");x!==this._attribHTML&&(this._attribHTML=x,r.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class c_{constructor(){t.aY(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=se("div","mapboxgl-ctrl");const h=se("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const h in r){const x=r[h].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const h=r[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class lg{constructor(){t.aY(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(h=>this._onIndoorUpdate(h))),this._container}_createButton(r,h){const x=se("button",r,this._container);return x.type="button",x.addEventListener("click",h),x}_createSeparator(){return se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(r,h){this._map&&(r.setAttribute("aria-label",h),r.textContent=h)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return this._model=r,void(this._container.style.display="none");const h=this._model;this._model=r,this._container.style.display="inline-block",this._container.style.borderRadius="8px",h&&Array.from(this._container.children).forEach((x=>x.remove())),r.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(r.floors,r.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const r=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const h=this._map;this._model&&h&&h._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));se("span","mapboxgl-ctrl-icon",r).setAttribute("aria-hidden","true"),r.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&r.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(r),this._createSeparator()}_updateBuildingsButtonState(){const r=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");r&&this._model&&(this._model.activeFloorsVisible?r.classList.remove("mapboxgl-ctrl-level-button-selected"):r.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(r,h){for(let x=0;x<r.length;x++){const E=r[x],M=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(E.id)}));this._setButtonTitle(M,E.zIndex.toString()),this._model&&E.id===this._model.selectedFloorId&&h&&M.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(M),x<r.length-1&&this._createSeparator()}}}class Af{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,x=h?this._queue.concat(h):this._queue;for(const E of x)if(E.id===r)return void(E.cancelled=!0)}run(r=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const x of h)if(!x.cancelled&&(x.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class gh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const h=t.dD((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,h,x){this._start=this.getValue(h),this._end=r,this._startTime=h,this._endTime=h+x}}const Wh={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Pf extends t.z{constructor(r,h,x,E){const{point:M,lngLat:k,originalEvent:B,target:G}=r;super(r.type,{point:M,lngLat:k,originalEvent:B,target:G}),this.preventDefault=()=>{r.preventDefault()},this.id=h,this.interaction=x,this.feature=E}}class gc{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,h){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const x=h.filter;let E=h.type;x&&this.filters.set(r,t.b6(x)),E==="mouseover"&&(E="mouseenter"),E==="mouseout"&&(E="mouseleave");const M=this.interactionsByType.get(E)||new Map;E==="mouseenter"||E==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,h)):M.size===0&&this.map.on(E,this.handleType),M.size===0&&this.interactionsByType.set(E,M),M.set(r,h),this.typeById.set(r,E)}get(r){const h=this.typeById.get(r);if(!h)return;const x=this.interactionsByType.get(h);return x?x.get(r):void 0}remove(r){const h=this.typeById.get(r);if(!h)return;this.typeById.delete(r),this.filters.delete(r);const x=this.interactionsByType.get(h);x&&(x.delete(r),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):x.size===0&&this.map.off(h,this.handleType))}queryTargets(r,h){const x=[];for(const[E,M]of h)M.target&&x.push({targetId:E,target:M.target,filter:this.filters.get(E)});return this.map.style.queryRenderedTargets(r,x,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());h.length&&(r.type="mouseenter",this.handleType(r,h));const x=new Map;for(const[E,{feature:M}]of this.prevHoveredFeatures)this.hoveredFeatures.has(E)||x.set(M.id,M);x.size&&(r.type="mouseleave",this.handleType(r,Array.from(x.values())))}handleOut(r){const h=Array.from(this.hoveredFeatures.values()).map((({feature:x})=>x));h.length&&(r.type="mouseleave",this.handleType(r,h)),this.hoveredFeatures.clear()}handleType(r,h){const x=r.type==="mouseenter";if(x&&!this.interactionsByType.has(r.type))return void t.w("mouseenter interaction required for mouseleave to work.");const E=Array.from(this.interactionsByType.get(r.type)).reverse(),M=!!h;h=h||this.queryTargets(r.point,E);let k=!1;const B=new Set;for(const G of h){for(const[J,ee]of E){if(!ee.target)continue;const ce=G.variants?G.variants[J]:null;if(ce){for(const le of ce){if(Xu(le,G,B,J))continue;const he=new t.dx(G,le),be=Zd(le,G,J);M&&he.id!==void 0&&(he.state=this.map.getFeatureState(he));const _e=x?this.prevHoveredFeatures.get(be):null,ke=new Pf(r,J,ee,he),Ae=_e?_e.stop:ee.handler(ke);if(x&&this.hoveredFeatures.set(be,{feature:G,stop:Ae}),Ae!==!1){k=!0;break}}if(k)break}}if(k)break}if(!k)for(const[G,J]of E){const{handler:ee,target:ce}=J;if(!ce&&ee(new Pf(r,G,J,null))!==!1)break}}}function u_(v,r){if(Array.isArray(v)&&Array.isArray(r)){const h=new Set(v),x=new Set(r);return h.size===x.size&&v.every((E=>x.has(E)))}return t.by(v,r)}const Eb={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ib={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cb{constructor(r,h,x=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ng({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,x&&(this.mousePitch=new v0({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),t.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(r,h){this.mouseRotate.mousedown(r,h),this.mousePitch&&this.mousePitch.mousedown(r,h),Ee()}move(r,h){const x=this.map,E=this.mouseRotate.mousemoveWindow(r,h),M=E&&E.bearingDelta;if(M&&x.setBearing(x.getBearing()+M),this.mousePitch){const k=this.mousePitch.mousemoveWindow(r,h),B=k&&k.pitchDelta;B&&x.setPitch(x.getPitch()+B)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(Object.assign({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),je(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,je(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ye(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Ye(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function b0(v,r,h){if(v=new t.aT(v.lng,v.lat),r){const x=new t.aT(v.lng-360,v.lat),E=new t.aT(v.lng+360,v.lat),M=360*Math.ceil(Math.abs(v.lng-h.center.lng)/360),k=h.locationPoint3D(v).distSqr(r),B=r.x<0||r.y<0||r.x>h.width||r.y>h.height;h.locationPoint3D(x).distSqr(r)<k&&(B||Math.abs(x.lng-h.center.lng)<M)?v=x:h.locationPoint3D(E).distSqr(r)<k&&(B||Math.abs(E.lng-h.center.lng)<M)&&(v=E)}for(;Math.abs(v.lng-h.center.lng)>180;){const x=h.locationPoint3D(v);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;v.lng>h.center.lng?v.lng-=360:v.lng+=360}return v}const Ql={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},_h={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class gy extends t.E{constructor(r,h){super(),(r instanceof HTMLElement||h)&&(r=Object.assign({element:r},h)),t.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:x="center",color:E="#3FB1CE",scale:M=1,draggable:k=!1,clickTolerance:B=0,rotation:G=_h.rotation,rotationAlignment:J=_h.rotationAlignment,pitchAlignment:ee=_h.pitchAlignment,occludedOpacity:ce=_h.occludedOpacity,altitude:le=_h.altitude}=r||{};this._anchor=x,this._color=E,this._scale=M,this._draggable=k,this._clickTolerance=B,this._rotation=G,this._rotationAlignment=J,this._pitchAlignment=ee,this._occludedOpacity=ce,this._altitude=le,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=t.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=t.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(_e=>{_e.preventDefault()})),this._element.addEventListener("mousedown",(_e=>{_e.preventDefault()}));const he=this._element.classList;for(const _e in Ql)he.remove(`mapboxgl-marker-anchor-${_e}`);he.add(`mapboxgl-marker-anchor-${this._anchor}`);const be=r&&r.className?r.className.trim().split(/\s+/):[];he.add(...be),this._popup=null}_createDefaultMarker(){const r=se("div"),h=ie("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const x=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},h));ie("stop",{offset:"10%","stop-opacity":.4},x),ie("stop",{offset:"100%","stop-opacity":.05},x),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=t.aT.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||_h.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const h=r.code,x=r.charCode||r.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(r){const h=r.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,h=this._pos;if(!r||!h)return!1;const x=r.unproject(h,this._altitude),E=r.getFreeCameraOptions();if(!E.position)return!1;const M=E.position.toLngLat();return M.distanceTo(x)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const h=this._pos;if(!h||h.x<0||h.x>r.transform.width||h.y<0||h.y>r.transform.height)return void this._clearFadeTimer();const x=r.unproject(h,this._altitude);let E;r._showingGlobe()&&t.f5(r.transform,this._lngLat)?E=0:(E=1-r._queryFogOpacity(x),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Ql[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const r=this._pos,h=this._map,x=this.getPitchAlignment();if(!h||!r||x!=="map")return"";if(!h._showingGlobe()){const G=h.getPitch();return G?`rotateX(${G}deg)`:""}const E=t.cX(t.f6(h.transform,this._lngLat)),M=r.sub(t.f7(h.transform)),k=Math.abs(M.x)+Math.abs(M.y);if(k===0)return"";const B=E/k;return`rotateX(${-M.y*B}deg) rotateY(${M.x*B}deg)`}_calculateZTransform(){const r=this._pos,h=this._map;if(!h||!r)return"";let x=0;const E=this.getRotationAlignment();if(E==="map")if(h._showingGlobe()){const M=h.project(new t.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),k=h.project(new t.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(M);x=t.cX(Math.atan2(k.y,k.x))-90}else x=-h.getBearing();else if(E==="horizon"){const M=t.ah(4,6,h.getZoom()),k=t.f7(h.transform);k.y+=M*h.transform.height;const B=r.sub(k),G=t.cX(Math.atan2(B.y,B.x));x=(G>90?G-270:G+90)*(1-M)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=b0(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),h._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(r){return this._offset=t.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const h=this._map;if(!h)return;const x=this._pointerdownPos,E=this._positionDelta;if(x&&E){if(!this._isDragging){const M=this._clickTolerance||h._clickTolerance;if(r.point.dist(x)<M)return;this._isDragging=!0}this._pos=r.point.sub(E),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.z("dragstart"))),this.fire(new t.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.z("dragend")),this._state="inactive"}_addDragHandler(r){const h=this._map,x=this._pos;h&&x&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(x),this._pointerdownPos=r.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const h=this._map;return h&&(r?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||_h.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||_h.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||_h.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||_h.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const w0={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},cg={maxWidth:100,unit:"metric"},_y={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Mc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},yh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ra(v=new t.P(0,0),r="bottom"){if(typeof v=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(r){case"top":return new t.P(0,v);case"top-left":return new t.P(h,h);case"top-right":return new t.P(-h,h);case"bottom":return new t.P(0,-v);case"bottom-left":return new t.P(h,-h);case"bottom-right":return new t.P(-h,-h);case"left":return new t.P(v,0);case"right":return new t.P(-v,0)}return new t.P(0,0)}return v instanceof t.P||Array.isArray(v)?t.P.convert(v):t.P.convert(v[r]||[0,0])}return{version:P,supported:ae.supported,setRTLTextPlugin:t.fb,getRTLTextPluginStatus:t.fa,Map:class extends my{constructor(v){F.mark(O.create);const r=v;if((v=Object.assign({},Eb,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&t.f3(window)&&(v.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hf(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies,null,null),v),this._repaint=!!v.repaint,this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._collectResourceTiming=v.collectResourceTiming,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new Af,this._domRenderTaskQueue=new Af,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.b2(),this._locale=Object.assign({},Wh,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._tessellationStep=v.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=v.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=v.scaleFactor,this._requestManager=new Wt(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,this._contextCreateOptions=v.contextCreateOptions?Object.assign({},v.contextCreateOptions):{},typeof v.container=="string"){const h=document.getElementById(v.container);if(!h)throw new Error(`Container '${v.container.toString()}' not found.`);this._container=h}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),this._spriteFormat=v.spriteFormat,t.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Sb(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,(v.style||!v.testMode)&&this.setStyle(v.style||t.e.DEFAULT_STYLE,{config:v.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),v.hash&&(this._hash=new Qm(typeof v.hash=="string"&&v.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch});const h=v.bounds;h&&(this.resize(),this.fitBounds(h,Object.assign({},v.fitBoundsOptions,{duration:0})))}this.resize(),v.attributionControl&&this.addControl(new ag({customAttribution:v.customAttribution})),this._logoControl=new c_,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(h=>{this._update(h.dataType==="style"),this.fire(new t.z(`${h.dataType}data`,h))})),this.on("dataloading",(h=>{this.fire(new t.z(`${h.dataType}dataloading`,h))})),this._interactions=new gc(this)}_getMapId(){return this._mapId}addControl(v,r){if(r===void 0&&(r=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new t.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=v.onAdd(this);this._controls.push(v);const x=this._controlPositions[r];return r.indexOf("bottom")!==-1?x.insertBefore(h,x.firstChild):x.appendChild(h),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new t.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(v);return r>-1&&this._controls.splice(r,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new t.z("movestart",v)).fire(new t.z("move",v)),this.fire(new t.z("resize",v)),r&&this.fire(new t.z("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(t.aI.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(v){return this._scaleFactor=v,this.painter.scaleFactor=v,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((r=>r.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return v==="auto"?navigator.language:Array.isArray(v)?v.length===0?void 0:v.map((r=>r==="auto"?navigator.language:r)):v}setLanguage(v){const r=this._parseLanguage(v);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(v){return this._lazyInitEmptyStyle(),v?typeof v=="string"&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const v=this.transform,r=v.projection.name;let h;r==="globe"&&v.zoom>=t.cL?(v.setMercatorFromTransition(),h=!0):r==="mercator"&&v.zoom<t.cL&&(v.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(v,r){return this._updateProjection(v||r||{name:"mercator"})}_updateProjection(v){let r;const h=this.transform.mercatorFromTransition;r=v.name==="globe"&&this.transform.zoom>=t.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate();const x=this.transform.getProjection().name==="mercator"&&h!==this.transform.mercatorFromTransition;return(r||x)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(v,r){return this.transform.locationPoint3D(t.aT.convert(v),r)}unproject(v,r){return this.transform.pointLocation3D(t.P.convert(v),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(v,r,h){const x=E=>{let M=[];if(Array.isArray(r)){const k=r.filter((B=>this.getLayer(B)));M=k.length?this.queryRenderedFeatures(E,{layers:k}):[]}else M=this.queryRenderedFeatures(E,{target:r});return M};if(v==="mouseenter"||v==="mouseover"){let E=!1;return{listener:h,targets:r,delegates:{mousemove:k=>{const B=x(k.point);B.length?E||(E=!0,h.call(this,new kl(v,this,k.originalEvent,{features:B}))):E=!1},mouseout:()=>{E=!1}}}}if(v==="mouseleave"||v==="mouseout"){let E=!1;return{listener:h,targets:r,delegates:{mousemove:B=>{x(B.point).length?E=!0:E&&(E=!1,h.call(this,new kl(v,this,B.originalEvent)))},mouseout:B=>{E&&(E=!1,h.call(this,new kl(v,this,B.originalEvent)))}}}}{const E=M=>{const k=x(M.point);k.length&&(M.features=k,h.call(this,M),delete M.features)};return{listener:h,targets:r,delegates:{[v]:E}}}}on(v,r,h){if(typeof r=="function"||h===void 0)return super.on(v,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const x=this._createDelegatedListener(v,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(x);for(const E in x.delegates)this.on(E,x.delegates[E]);return this}once(v,r,h){if(typeof r=="function"||h===void 0)return super.once(v,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const x=this._createDelegatedListener(v,r,h);for(const E in x.delegates)this.once(E,x.delegates[E]);return this}off(v,r,h){if(typeof r=="function"||h===void 0)return super.off(v,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const x=this._delegatedListeners?this._delegatedListeners[v]:void 0;return x&&(E=>{for(let M=0;M<E.length;M++){const k=E[M];if(k.listener===h&&u_(k.targets,r)){for(const B in k.delegates)this.off(B,k.delegates[B]);return E.splice(M,1),this}}})(x),this}queryRenderedFeatures(v,r){if(!this.style)return[];if(v===void 0||v instanceof t.P||Array.isArray(v)||r!==void 0||(r=v,v=void 0),v=v||[[0,0],[this.transform.width,this.transform.height]],!r){const M=this.style.queryRenderedFeatures(v,void 0,this.transform),k=this.style.queryRenderedFeatureset(v,void 0,this.transform);return M.concat(k)}let h=!0;if(r.target&&(h=this._isTargetValid(r.target),h&&!r.layers))return this.style.queryRenderedFeatureset(v,r,this.transform);let x=!0;if(r.layers&&Array.isArray(r.layers)){for(const M of r.layers)if(!this._isValidId(M)){x=!1;break}if(x&&!r.target)return this.style.queryRenderedFeatures(v,r,this.transform)}let E=[];return x&&(E=E.concat(this.style.queryRenderedFeatures(v,r,this.transform))),h&&(E=E.concat(this.style.queryRenderedFeatureset(v,r,this.transform))),E}querySourceFeatures(v,r){return!v||typeof v=="string"&&!this._isValidId(v)?[]:this.style.querySourceFeatures(v,r)}queryRasterValue(v,r,h){return this._isValidId(v)?this.style.queryRasterValue(v,r,h):Promise.resolve(null)}isPointOnSurface(v){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&t.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(v))}addInteraction(v,r){return this._interactions.add(v,r),this}removeInteraction(v){return this._interactions.remove(v),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(v){return this._cooperativeGestures=v,this}setStyle(v,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&v&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(v,((h,x)=>{if(h){const E=typeof h=="string"?h:h instanceof Error?h.message:h.error;t.w(`Unable to perform style diff: ${E}. Rebuilding the style from scratch.`),this._updateStyle(v,r)}else x&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(v,r))}_getUIString(v){const r=this._locale[v];if(r==null)throw new Error(`Missing UI string '${v}'`);return r}_updateStyle(v,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v){const h=Object.assign({},r);r&&r.config&&(h.initialConfig=r.config,delete h.config),this.style=new Gc(this,h).load(v),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(v){return v==null?(this.fire(new t.y(new Error("IDs can't be empty."))),!1):!t.dr(v)||(this.fire(new t.y(new Error(`IDs can't contain special symbols: "${v}".`))),!1)}_isTargetValid(v){return"featuresetId"in v?this._isValidId("importId"in v?v.importId:v.featuresetId):"layerId"in v&&this._isValidId(v.layerId)}_areTargetsValid(v){if(Array.isArray(v)){for(const r of v)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(v)}addSource(v,r){return this._isValidId(v)?(this._lazyInitEmptyStyle(),this.style.addSource(v,r),this._update(!0)):this}isSourceLoaded(v){return!!this._isValidId(v)&&!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(v,r,h){this._lazyInitEmptyStyle(),this.style.addSourceType(v,r,h)}removeSource(v){return this._isValidId(v)?(this.style.removeSource(v),this._updateTerrain(),this._update(!0)):this}getSource(v){return this._isValidId(v)?this.style.getOwnSource(v):null}addImage(v,r,{pixelRatio:h=1,sdf:x=!1,stretchX:E,stretchY:M,content:k}={}){this._lazyInitEmptyStyle();const B=t.I.from(v);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:G,height:J,data:ee}=t.o.getImageData(r);this.style.addImage(B,{data:new t.q({width:G,height:J},ee),pixelRatio:h,stretchX:E,stretchY:M,content:k,sdf:x,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new t.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:G,height:J}=r,ee=r;this.style.addImage(B,{data:new t.q({width:G,height:J},new Uint8Array(ee.data)),pixelRatio:h,stretchX:E,stretchY:M,content:k,sdf:x,usvg:!1,version:0,userImage:ee}),ee.onAdd&&ee.onAdd(this,v)}}updateImage(v,r){this._lazyInitEmptyStyle();const h=t.I.from(v),x=this.style.getImage(h);if(!x)return void this.fire(new t.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?t.o.getImageData(r):r,{width:M,height:k,data:B}=E;if(M===void 0||k===void 0)return void this.fire(new t.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==(x.usvg?x.icon.usvg_tree.width:x.data.width)||k!==(x.usvg?x.icon.usvg_tree.height:x.data.height))return void this.fire(new t.y(new Error(`The width and height of the updated image (${M}, ${k})
                must be that same as the previous version of the image
                (${x.data.width}, ${x.data.height})`)));const G=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let J=!1;x.usvg?(x.data=new t.q({width:M,height:k},new Uint8Array(B)),x.usvg=!1,x.icon=void 0,J=!0):x.data.replace(B,G),this.style.updateImage(h,x,J)}hasImage(v){return v?!!this.style&&!!this.style.getImage(t.I.from(v)):(this.fire(new t.y(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(t.I.from(v))}loadImage(v,r){t.n(this._requestManager.transformRequest(v,t.R.Image),((h,x)=>{r(h,x instanceof HTMLImageElement?t.o.getImageData(x):x)}))}listImages(){return this.style.listImages().map((v=>v.name))}addModel(v,r){this._lazyInitEmptyStyle(),this.style.addModel(v,r)}hasModel(v){return v?this.style.hasModel(v):(this.fire(new t.y(new Error("Missing required model id"))),!1)}removeModel(v){this.style.removeModel(v)}listModels(){return this.style.listModels()}addLayer(v,r){return this._isValidId(v.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(v,r),this._update(!0)):this}getSlot(v){const r=this.getLayer(v);return r&&r.slot||null}setSlot(v,r){return this.style.setSlot(v,r),this.style.mergeLayers(),this._update(!0)}addImport(v,r){return this.style.addImport(v,r).catch((h=>this.fire(new t.y(new Error("Failed to add import",h))))),this}updateImport(v,r){return typeof r!="string"&&r.id!==v?(this.removeImport(v),this.addImport(r)):(this.style.updateImport(v,r),this._update(!0))}removeImport(v){return this.style.removeImport(v),this}moveImport(v,r){return this.style.moveImport(v,r),this._update(!0)}moveLayer(v,r){return this._isValidId(v)?(this.style.moveLayer(v,r),this._update(!0)):this}removeLayer(v){return this._isValidId(v)?(this.style.removeLayer(v),this._update(!0)):this}getLayer(v){if(!this._isValidId(v))return null;const r=this.style.getOwnLayer(v);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(v,r,h){return this._isValidId(v)?(this.style.setLayerZoomRange(v,r,h),this._update(!0)):this}setFilter(v,r,h={}){return this._isValidId(v)?(this.style.setFilter(v,r,h),this._update(!0)):this}getFilter(v){return this._isValidId(v)?this.style.getFilter(v):null}setPaintProperty(v,r,h,x={}){return this._isValidId(v)?(this.style.setPaintProperty(v,r,h,x),this._update(!0)):this}getPaintProperty(v,r){return this._isValidId(v)?this.style.getPaintProperty(v,r):null}setLayoutProperty(v,r,h,x={}){return this._isValidId(v)?(this.style.setLayoutProperty(v,r,h,x),this._update(!0)):this}getLayoutProperty(v,r){return this._isValidId(v)?this.style.getLayoutProperty(v,r):null}setLayerProperty(v,r,h,x={}){return this._isValidId(v)?(r==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(v,r,h,x),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(v){return this.style.setGlyphsUrl(v),this._update(!0)}getSchema(v){return this.style.getSchema(v)}setSchema(v,r){return this.style.setSchema(v,r),this._update(!0)}getConfig(v){return this.style.getConfig(v)}setConfig(v,r){return this.style.setConfig(v,r),this._update(!0)}getConfigProperty(v,r){return this.style.getConfigProperty(v,r)}setConfigProperty(v,r,h){return this.style.setConfigProperty(v,r,h),this._update(!0)}getFeaturesetDescriptors(v){return this.style.getFeaturesetDescriptors(v)}setLights(v){if(this._lazyInitEmptyStyle(),v&&v.length===1&&v[0].type==="flat"){const r=v[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(v),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const v=this.style.getLights()||[];return v.length===0&&v.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),v}setLight(v,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:v}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(v){return this._lazyInitEmptyStyle(),this.style.setSnow(v),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(v){return this._lazyInitEmptyStyle(),this.style.setRain(v),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(v){return this._lazyInitEmptyStyle(),this.style.setColorTheme(v),this._update(!0)}setImportColorTheme(v,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(v,r),this._update(!0)}setCamera(v){return this.style.setCamera(v),this._triggerCameraUpdate(v)}_triggerCameraUpdate(v){return this._update(this.transform.setOrthographicProjectionAtLowPitch(v["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aT.convert(v),this.transform):0}setFeatureState(v,r){return v.source&&!this._isValidId(v.source)?this:(this.style.setFeatureState(v,r),this._update())}removeFeatureState(v,r){return v.source&&!this._isValidId(v.source)?this:(this.style.removeFeatureState(v,r),this._update())}getFeatureState(v){return v.source&&!this._isValidId(v.source)?null:this.style.getFeatureState(v)}_selectIndoorFloor(v){this.indoor.selectFloor(v)}_setIndoorActiveFloorsVisibility(v){this.indoor.setActiveFloorsVisibility(v)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new lg),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let h,x,E,M=this._container;for(;M&&(!x||!E);){const k=window.getComputedStyle(M).transform;k&&k!=="none"&&(h=k.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(x=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(E=h[3])),M=M.parentElement}this._containerWidth=x?Math.abs(v/x):v,this._containerHeight=E?Math.abs(r/E):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Bg(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=se("div","mapboxgl-canvas-container",v);this._canvas=se("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=se("div","mapboxgl-control-container",v),x=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((E=>{x[E]=se("div",`mapboxgl-ctrl-${E}`,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,r){const h=t.o.devicePixelRatio||1;this._canvas.width=h*Math.ceil(v),this._canvas.height=h*Math.ceil(r),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${r}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const r=this._markers.indexOf(v);r!==-1&&this._markers.splice(r,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const r=this._popups.indexOf(v);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const v=Object.assign({},ae.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",v);r?(Ui(r,!0),this.painter=new qa(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),t.k.testSupport(r)):this.fire(new t.y(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.z("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new t.z("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let r;this.fire(new t.z("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,x=t.o.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=E.createQuery(),E.beginQuery(h.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const J=this.transform.zoom,ee=this.transform.pitch,ce=t.o.now(),le=new t.ac(J,{now:ce,fadeDuration:M,pitch:ee,transition:this.style.transition,worldview:this._worldview});this.style.update(le)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let k=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),k=this._updateAverageElevation(x),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):k=this._updateAverageElevation(x);const B=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),B&&(this._placementDirty=B.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(O.load),this.fire(new t.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const J=t.o.now()-x;E.endQuery(h.TIME_ELAPSED_EXT),setTimeout((()=>{const ee=E.getQueryParameter(r,E.QUERY_RESULT)/1e6;E.deleteQuery(r),this.fire(new t.z("gpu-timing-frame",{cpuTime:J,gpuTime:ee}))}),50)}if(this.listens("gpu-timing-layer")){const J=this.painter.collectGpuTimers();setTimeout((()=>{const ee=this.painter.queryGpuTimers(J);this.fire(new t.z("gpu-timing-layer",{layerTimes:ee}))}),50)}if(this.listens("gpu-timing-deferred-render")){const J=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const ee=this.painter.queryGpuTimeDeferredRender(J);this.fire(new t.z("gpu-timing-deferred-render",{gpuTime:ee}))}),50)}const G=this._sourcesDirty||this._styleDirty||this._placementDirty||k;if(G||this._repaint)this.triggerRepaint();else{const J=this.idle();if(J&&(k=this._updateAverageElevation(x,!0)),k)this.triggerRepaint();else if(this._triggerFrame(!1),J&&(this.fire(new t.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ee=this._calculateSpeedIndex();this.fire(new t.z("speedindexcompleted",{speedIndex:ee})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0,F.mark(O.fullLoad),this._performanceMetricsCollection&&St(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const r of this._markers)v&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!v||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(v,r=!1){const h=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const x=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(x||(r||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const E=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=v;const k=Math.abs(E-M);if(k>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(M),h(M);this._averageElevation.easeTo(M,v,300)}else if(k>1e-4)return this._averageElevation.jumpTo(M),h(M)}return!!this._averageElevation.isEasing(v)&&h(this._averageElevation.getValue(v))}_authenticate(){Ai(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(v=>{if(v&&(v.message===ci||v.status===401)){const r=this.painter.context.gl;Ui(r,!1),this._logoControl instanceof c_&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Sr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&ti(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Gi(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){nr(this._requestManager._customAccessToken)}_updateTerrain(){const v=this._isDragging();this.painter.updateTerrain(this.style,v)}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const h=this.painter.context.gl,x=h.createFramebuffer();function E(M){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,M,0);const k=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,k),k}return h.bindFramebuffer(h.FRAMEBUFFER,x),this._canvasPixelComparison(E(v),r.canvasCopies.map(E),r.timeStamps)}_canvasPixelComparison(v,r,h){let x=h[1]-h[0];const E=v.length/4;for(let M=0;M<r.length;M++){const k=r[M];let B=0;for(let G=0;G<k.length;G+=4)k[G]===v[G]&&k[G+1]===v[G+1]&&k[G+2]===v[G+2]&&k[G+3]===v[G+3]&&(B+=1);x+=(h[M+2]-h[M+1])*(1-B/E)}return x}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),hn.delete(this.painter.context.gl),Gt.remove(),mr.remove(),this._removed=!0,this.fire(new t.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=t.o.frame((r=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(r)})))}_preloadTiles(v){const r=this.style?this.style.getSourceCaches():[];return t.bw(r,((h,x)=>h._preloadTiles(v,x)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(v){this._showParseStatus!==v&&(this._showParseStatus=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(v){this._showLayers2DWireframe!==v&&(this._showLayers2DWireframe=v,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(v){this._showLayers3DWireframe!==v&&(this._showLayers3DWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,this.style&&v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,v&&this._update())}_setCacheLimits(v,r){t.f4(v,r)}get version(){return P}},NavigationControl:class{constructor(v={}){this.options=Object.assign({},Ib,v),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this.options.showZoom&&(t.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(r=>{this._map&&this._map.zoomIn({},{originalEvent:r})})),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(r=>{this._map&&this._map.zoomOut({},{originalEvent:r})})),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(r=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:r}):h.resetNorth({},{originalEvent:r}))})),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const r=v.getZoom(),h=r===v.getMaxZoom(),x=r===v.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=r)}))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cb(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,r){const h=se("button",v,this._container);return h.type="button",h.addEventListener("click",r),h}_setButtonTitle(v,r){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${r}`);v.setAttribute("aria-label",h),v.firstElementChild&&v.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends t.E{constructor(v={}){super();const r=navigator.geolocation;this.options=Object.assign({geolocation:r},w0,v),t.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const r=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,v(h)};this._supportsGeolocation!==void 0?v(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((h=>r(h.state!=="denied"))).catch((()=>r())):r()}_isOutOfMapMaxBounds(v){const r=this._map.getMaxBounds(),h=v.coords;return!!r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new t.z("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("geolocate",Object.assign({coords:v.coords,timestamp:v.timestamp},v.toJSON?{toJSON:v.toJSON.bind(v)}:{}))),this._finish()}}_updateCamera(v){const r=new t.aT(v.coords.longitude,v.coords.latitude),h=v.coords.accuracy,x=this._map.getBearing(),E=Object.assign({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(h),E,{geolocateSource:!0})}_updateMarker(v){if(v){const r=new t.aT(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,r=t.cf(1,v._center.lat)*v.worldSize,h=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new gy({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gy({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.z("trackuserlocationend")))}))}}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((r=>{r==="granted"&&v()})).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ag,ScaleControl:class{constructor(v={}){this.options=Object.assign({},cg,v),t.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,r=this._map,h=r._containerHeight/2,x=r._containerWidth/2-v/2,E=r.unproject([x,h]),M=r.unproject([x+v,h]),k=E.distanceTo(M);if(this.options.unit==="imperial"){const B=3.2808*k;B>5280?this._setScale(v,B/5280,"mile"):this._setScale(v,B,"foot")}else this.options.unit==="nautical"?this._setScale(v,k/1852,"nautical-mile"):k>=1e3?this._setScale(v,k/1e3,"kilometer"):this._setScale(v,k,"meter")}_setScale(v,r,h){this._map._requestDomTask((()=>{const x=(function(M){const k=Math.pow(10,`${Math.floor(M)}`.length-1);let B=M/k;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:(function(G){const J=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*J)/J})(B),k*B})(r),E=x/r;this._container.innerHTML=h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(x):`${x}&nbsp;${_y[h]}`,this._container.style.width=v*E+"px"}))}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v={}){this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:t.w("Full screen control 'container' must be a DOM element.")),t.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:lg,Popup:class extends t.E{constructor(v){super(),this.options=Object.assign(Object.create(Mc),v),this._altitude=this.options.altitude,t.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new t.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new t.z("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=t.aT.convert(v),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(v){return this._altitude=v,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const r=document.createDocumentFragment(),h=document.createElement("body");let x;for(h.innerHTML=v;x=h.firstChild,x;)r.appendChild(x);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(v),this.options.closeButton){const h=this._closeButton=se("button","mapboxgl-popup-close-button",r);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let r;return this._classList.delete(v)?r=!1:(this._classList.add(v),r=!0),this._updateClassList(),r}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const r=this._map,h=this._container,x=this._pos;if(!r||!h||!x)return"bottom";const E=h.offsetWidth,M=h.offsetHeight,k=x.x<E/2,B=x.x>r.transform.width-E/2;if(x.y+v<M)return k?"top-left":B?"top-right":"top";if(x.y>r.transform.height-M){if(k)return"bottom-left";if(B)return"bottom-right"}return k?"left":B?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),v.className=r.join(" ")}_update(v){const r=this._map,h=this._content;if(!r||!this._lngLat&&!this._trackPointer||!h)return;let x=this._container;if(x||(x=this._container=se("div","mapboxgl-popup",r.getContainer()),this._tip=se("div","mapboxgl-popup-tip",x),x.appendChild(h)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=b0(this._lngLat,this._pos,r.transform)),!this._trackPointer||v){const E=this._pos=this._trackPointer&&v instanceof t.P?v:r.project(this._lngLat,this._altitude),M=ra(this.options.offset),k=this._anchor=this._getAnchor(M.y),B=ra(this.options.offset,k),G=E.add(B).round();r._requestDomTask((()=>{this._container&&k&&(this._container.style.transform=`${Ql[k]} translate(${G.x}px,${G.y}px)`)}))}if(!this._marker&&r._showingGlobe()){const E=t.f5(r.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(yh);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:gy,Style:Gc,LngLat:t.aT,LngLatBounds:t.aI,Point:t.P,MercatorCoordinate:t.ae,FreeCameraOptions:Fl,Evented:t.E,config:t.e,prewarm:t.f9,clearPrewarmedResources:t.f8,get accessToken(){return t.e.ACCESS_TOKEN},set accessToken(v){t.e.ACCESS_TOKEN=v},get baseApiUrl(){return t.e.API_URL},set baseApiUrl(v){t.e.API_URL=v},get workerCount(){return t.fi.workerCount},set workerCount(v){t.fi.workerCount=v},get maxParallelImageRequests(){return t.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){t.e.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){t.fh(v)},get workerUrl(){return t.fg.workerUrl},set workerUrl(v){t.fg.workerUrl=v},get workerClass(){return t.fg.workerClass},set workerClass(v){t.fg.workerClass=v},get workerParams(){return t.fg.workerParams},set workerParams(v){t.fg.workerParams=v},get dracoUrl(){return t.ff()},set dracoUrl(v){t.fe(v)},get meshoptUrl(){return t.fd()},set meshoptUrl(v){t.fc(v)},setNow:t.o.setNow,restoreNow:t.o.restoreNow}}));var b=p;return b}))})(WS)),WS.exports}var Qfe=Jfe();const iv=Uf(Qfe);function epe(e){return Rp()?(H_(e),!0):!1}const tpe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ipe=e=>typeof e<"u";function npe(e){return Array.isArray(e)?e:[e]}function G_e(e,i,s={}){const{flush:l="sync",deep:p=!1,immediate:_=!0}=s,b=npe(i);return Qn(e,t=>b.forEach(P=>P.value=t),{flush:l,deep:p,immediate:_})}function rpe(e,i,s){return Qn(e,i,{...s,once:!0})}function q_e(e,i,s){const l=Qn(e,(p,_,b)=>{p&&(s?.once&&Da(()=>l()),i(p,_,b))},{...s,once:!1});return l}const spe=tpe?window:void 0;function MF(e){var i;const s=Rr(e);return(i=s?.$el)!=null?i:s}function ope(){const e=so(!1),i=ba();return i&&La(()=>{e.value=!0},i),e}function ape(e){const i=ope();return Ei(()=>(i.value,!!e()))}function lpe(e){return JSON.parse(JSON.stringify(e))}function cpe(e,i,s={}){const{window:l=spe,...p}=s;let _;const b=ape(()=>l&&"ResizeObserver"in l),t=()=>{_&&(_.disconnect(),_=void 0)},P=Ei(()=>{const $=Rr(e);return Array.isArray($)?$.map(W=>MF(W)):[MF($)]}),O=Qn(P,$=>{if(t(),b.value&&l){_=new ResizeObserver(i);for(const W of $)W&&_.observe(W,p)}},{immediate:!0,flush:"post"}),F=()=>{t(),O()};return epe(F),{isSupported:b,stop:F}}function H_e(e,i,s,l={}){var p,_,b;const{clone:t=!1,passive:P=!1,eventName:O,deep:F=!1,defaultValue:$,shouldEmit:W}=l,Y=ba(),ae=s||Y?.emit||((p=Y?.$emit)==null?void 0:p.bind(Y))||((b=(_=Y?.proxy)==null?void 0:_.$emit)==null?void 0:b.bind(Y?.proxy));let se=O;se=se||`update:${i.toString()}`;const ie=de=>t?typeof t=="function"?t(de):lpe(de):de,pe=()=>ipe(e[i])?ie(e[i]):$,ye=de=>{W?W(de)&&ae(se,de):ae(se,de)};if(P){const de=pe(),Ee=an(de);let Pe=!1;return Qn(()=>e[i],Ze=>{Pe||(Pe=!0,Ee.value=ie(Ze),Da(()=>Pe=!1))}),Qn(Ee,Ze=>{!Pe&&(Ze!==e[i]||F)&&ye(Ze)},{deep:F}),Ee}else return Ei({get(){return pe()},set(de){ye(de)}})}const upe=so({});function mI(){return upe}function $P(e){const i=mI();if(!i)return an();const s=so(i.value[e]?.map);return Qn(i,()=>{s.value=i.value[e]?.map,L_(s)}),s}function GP(e){return $P(e)}function W_e(e){return Ei(()=>mI()?.value[e])}function hpe(e){delete mI()?.value[e]}function dpe(){const e=X_("mapbox_init",()=>!1);if(e.value)return;e.value=!0;const i=jf();if(iv.accessToken=i.public.mapbox.accessToken,i.public.mapbox.baseApiUrl&&(iv.baseApiUrl=i.public.mapbox.baseApiUrl),i.public.mapbox.workerUrl&&(iv.workerUrl=i.public.mapbox.workerUrl),i.public.mapbox.workerCount&&(iv.workerCount=i.public.mapbox.workerCount),i.public.mapbox.prewarm&&iv.prewarm(),i.public.mapbox.RTLTextPlugin){const s="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js";typeof i.public.mapbox.RTLTextPlugin=="boolean"&&(i.public.mapbox.RTLTextPlugin={pluginURL:s,lazy:!1}),iv.setRTLTextPlugin(i.public.mapbox.RTLTextPlugin.pluginURL||s,()=>{},i.public.mapbox.RTLTextPlugin.lazy||!1)}}function fpe(e,i={container:e}){dpe();const s=mI();if(!s)return an();if(s.value[e])return console.warn(`Mapbox instance with key '${e}' was initialized multiple times. This can cause unexpected behaviour.`),GP(e);s.value[e]=Ip({map:new iv.Map(i),loaded:!1});const l=s.value[e];return l.map.on("load",()=>{l.loaded=!0,L_(s),l&&L_(Nc(l))}),l.map.on("style.load",()=>{l.loaded=!0,L_(s),l&&L_(Nc(l))}),l.map.on("idle",()=>{L_(s),l&&L_(Nc(l))}),l.map.on("data",()=>{L_(s),l&&L_(Nc(l))}),GP(e)}function ppe(e,i){const s=GP(e);if(s.value)return i(s.value);rpe(s,()=>{s.value&&i(s.value)})}const mpe=["id"],gpe={__name:"MapboxMap",props:{mapId:{type:String,required:!0},options:{type:Object,required:!1},onError:{type:Function,required:!1},onLoad:{type:Function,required:!1},onIdle:{type:Function,required:!1},onRemove:{type:Function,required:!1},onRender:{type:Function,required:!1},onResize:{type:Function,required:!1},onWebglcontextlost:{type:Function,required:!1},onWebglcontextrestored:{type:Function,required:!1},onDataloading:{type:Function,required:!1},onData:{type:Function,required:!1},onTiledataloading:{type:Function,required:!1},onSourcedataloading:{type:Function,required:!1},onStyledataloading:{type:Function,required:!1},onStyleImageMissing:{type:Function,required:!1},onStyleload:{type:Function,required:!1},onStyleimportload:{type:Function,required:!1},onSourcedata:{type:Function,required:!1},onStyledata:{type:Function,required:!1},onBoxzoomcancel:{type:Function,required:!1},onBoxzoomstart:{type:Function,required:!1},onBoxzoomend:{type:Function,required:!1},onTouchcancel:{type:Function,required:!1},onTouchmove:{type:Function,required:!1},onTouchend:{type:Function,required:!1},onTouchstart:{type:Function,required:!1},onClick:{type:Function,required:!1},onContextmenu:{type:Function,required:!1},onDblclick:{type:Function,required:!1},onMousemove:{type:Function,required:!1},onMouseup:{type:Function,required:!1},onMousedown:{type:Function,required:!1},onMouseout:{type:Function,required:!1},onMouseover:{type:Function,required:!1},onMovestart:{type:Function,required:!1},onMove:{type:Function,required:!1},onMoveend:{type:Function,required:!1},onZoomstart:{type:Function,required:!1},onZoom:{type:Function,required:!1},onZoomend:{type:Function,required:!1},onRotatestart:{type:Function,required:!1},onRotate:{type:Function,required:!1},onRotateend:{type:Function,required:!1},onDragstart:{type:Function,required:!1},onDrag:{type:Function,required:!1},onDragend:{type:Function,required:!1},onPitchstart:{type:Function,required:!1},onPitch:{type:Function,required:!1},onPitchend:{type:Function,required:!1},onWheel:{type:Function,required:!1}},emits:["resize","remove","load","render","idle","error","webglcontextlost","webglcontextrestored","data","styledata","sourcedata","dataloading","styledataloading","sourcedataloading","styleimagemissing","styleload","styleimportload","movestart","move","moveend","drag","dragend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","pitchstart","pitch","pitchend","boxzoomstart","boxzoomend","boxzoomcancel","mousedown","mouseup","mouseover","mousemove","preclick","click","dblclick","mouseout","contextmenu","wheel","touchstart","touchend","touchmove","touchcancel"],setup(e,{emit:i}){const s=e,l=i;Ka("MapID",s.mapId),Qn(()=>Object.entries(s).filter(_=>_[0].toString().startsWith("on")),_=>{for(const[b,t]of _)if(t){const P=["resize","remove","load","render","idle","error","webglcontextlost","webglcontextrestored"],O=b.toString().replace("on","").toLowerCase();let F=O;O==="styleload"&&(F="style.load"),O==="styleimportload"&&(F="style.import.load"),ppe(s.mapId,$=>{$.on(F,W=>{l(O,P.includes(O)?$:W)})})}},{immediate:!0}),Qn(()=>s.options,(_,b)=>{const t=$P(s.mapId);_&&(_.style&&b?.style!==_.style&&t.value?.setStyle(_.style),_.center&&b?.center!==_.center&&t.value?.setCenter(_.center),_.zoom&&b?.zoom!==_.zoom&&t.value?.setZoom(_.zoom),_.projection&&b?.projection!==_.projection&&t.value?.setProjection(_.projection),_.bearing&&b?.bearing!==_.bearing&&t.value?.setBearing(_.bearing),_.pitch&&b?.pitch!==_.pitch&&t.value?.setPitch(_.pitch),_.minZoom&&b?.minZoom!==_.minZoom&&t.value?.setMinZoom(_.minZoom),_.maxZoom&&b?.maxZoom!==_.maxZoom&&t.value?.setMaxZoom(_.maxZoom),_.bounds&&b?.bounds!==_.bounds&&t.value?.fitBounds(_.bounds))});const p=an();return La(()=>{let _=$P(s.mapId);_.value||(_=fpe(s.mapId,{...s.options,container:p.value||s.mapId})),cpe(p,()=>{setTimeout(()=>_.value?.resize(),0)})}),ru(()=>{hpe(s.mapId)}),(_,b)=>(li(),ir(qs,null,[Bn("div",{id:e.mapId,ref_key:"mapContainerRef",ref:p,class:_s(["mapboxgl-default-map-size",_.$attrs.class]),style:Su(_.$attrs.style)},null,14,mpe),Rs(_.$slots,"default")],64))}},_pe=8,ype="ChronoFrame Light",vpe={"mapbox:autocomposite":!1,"mapbox:type":"template","maputnik:renderer":"mbgljs","openmaptiles:version":"3.x","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t"},xpe=[116.4074,39.9042],bpe=2,wpe={type:"globe"},Tpe={openmaptiles:{type:"vector",url:"https://api.maptiler.com/tiles/v3-openmaptiles/tiles.json?key="}},Spe="https://openmaptiles.github.io/maptiler-basic-gl-style/sprite",Epe="https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=",Ipe=JSON.parse('[{"id":"background","type":"background","paint":{"background-color":"hsl(47, 26%, 88%)"}},{"id":"landuse-residential","type":"fill","source":"openmaptiles","source-layer":"landuse","filter":["all",["==","$type","Polygon"],["in","class","residential","suburb","neighbourhood"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(47, 13%, 86%)","fill-opacity":0.7}},{"id":"landcover_grass","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","grass"],"paint":{"fill-color":"hsl(82, 46%, 72%)","fill-opacity":0.45}},{"id":"landcover_wood","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","wood"],"paint":{"fill-color":"hsl(82, 46%, 72%)","fill-opacity":{"base":1,"stops":[[8,0.6],[22,1]]}}},{"id":"water","type":"fill","source":"openmaptiles","source-layer":"water","filter":["all",["==","$type","Polygon"],["!=","intermittent",1],["!=","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(205, 56%, 73%)"}},{"id":"water_intermittent","type":"fill","source":"openmaptiles","source-layer":"water","filter":["all",["==","$type","Polygon"],["==","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(205, 56%, 73%)","fill-opacity":0.7}},{"id":"landcover-ice-shelf","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","subclass","ice_shelf"],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(47, 26%, 88%)","fill-opacity":0.8}},{"id":"landcover-glacier","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","subclass","glacier"],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(47, 22%, 94%)","fill-opacity":{"base":1,"stops":[[0,1],[8,0.5]]}}},{"id":"landcover_sand","type":"fill","metadata":{},"source":"openmaptiles","source-layer":"landcover","filter":["all",["in","class","sand"]],"paint":{"fill-antialias":false,"fill-color":"rgba(232, 214, 38, 1)","fill-opacity":0.3}},{"id":"landuse","type":"fill","source":"openmaptiles","source-layer":"landuse","filter":["==","class","agriculture"],"layout":{"visibility":"visible"},"paint":{"fill-color":"#eae0d0"}},{"id":"landuse_overlay_national_park","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","national_park"],"paint":{"fill-color":"#E1EBB0","fill-opacity":{"base":1,"stops":[[5,0],[9,0.75]]}}},{"id":"waterway-tunnel","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-dasharray":[3,3],"line-gap-width":{"stops":[[12,0],[20,6]]},"line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,2]]}}},{"id":"waterway","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["!in","brunnel","tunnel","bridge"],["!=","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,8]]}}},{"id":"waterway_intermittent","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["!in","brunnel","tunnel","bridge"],["==","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-dasharray":[2,1],"line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,8]]}}},{"id":"tunnel_railway_transit","type":"line","source":"openmaptiles","source-layer":"transportation","minzoom":0,"filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["==","class","transit"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-dasharray":[3,3],"line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"building","type":"fill","source":"openmaptiles","source-layer":"building","paint":{"fill-antialias":true,"fill-color":"rgba(222, 211, 190, 1)","fill-opacity":{"base":1,"stops":[[13,0],[15,1]]},"fill-outline-color":{"stops":[[15,"rgba(212, 177, 146, 0)"],[16,"rgba(212, 177, 146, 0.5)"]]}}},{"id":"housenumber","type":"symbol","source":"openmaptiles","source-layer":"housenumber","minzoom":17,"filter":["==","$type","Point"],"layout":{"text-field":"{housenumber}","text-font":["Noto Sans Regular"],"text-size":10},"paint":{"text-color":"rgba(212, 177, 146, 1)"}},{"id":"road_area_pier","type":"fill","metadata":{},"source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","Polygon"],["==","class","pier"]],"layout":{"visibility":"visible"},"paint":{"fill-antialias":true,"fill-color":"hsl(47, 26%, 88%)"}},{"id":"road_pier","type":"line","metadata":{},"source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","pier"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"hsl(47, 26%, 88%)","line-width":{"base":1.2,"stops":[[15,1],[17,4]]}}},{"id":"road_bridge_area","type":"fill","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","Polygon"],["in","brunnel","bridge"]],"layout":{},"paint":{"fill-color":"hsl(47, 26%, 88%)","fill-opacity":0.5}},{"id":"road_path","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","path","track"]],"layout":{"line-cap":"square","line-join":"bevel"},"paint":{"line-color":"hsl(0, 0%, 97%)","line-dasharray":[1,1],"line-width":{"base":1.55,"stops":[[4,0.25],[20,10]]}}},{"id":"road_minor","type":"line","source":"openmaptiles","source-layer":"transportation","minzoom":13,"filter":["all",["==","$type","LineString"],["in","class","minor","service"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"hsl(0, 0%, 97%)","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"tunnel_minor","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["==","class","minor_road"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#efefef","line-dasharray":[0.36,0.18],"line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"tunnel_major","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#fff","line-dasharray":[0.28,0.14],"line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"aeroway-area","type":"fill","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":4,"filter":["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(255, 255, 255, 1)","fill-opacity":{"base":1,"stops":[[13,0],[14,1]]}}},{"id":"aeroway-taxiway","type":"line","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":12,"filter":["all",["in","class","taxiway"],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(255, 255, 255, 1)","line-opacity":1,"line-width":{"base":1.5,"stops":[[12,1],[17,10]]}}},{"id":"aeroway-runway","type":"line","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":4,"filter":["all",["in","class","runway"],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(255, 255, 255, 1)","line-opacity":1,"line-width":{"base":1.5,"stops":[[11,4],[17,50]]}}},{"id":"road_trunk_primary","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","trunk","primary"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#fff","line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"road_secondary_tertiary","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","secondary","tertiary"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#fff","line-width":{"base":1.4,"stops":[[6,0.5],[20,20]]}}},{"id":"road_major_motorway","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","class","motorway"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"hsl(0, 0%, 100%)","line-offset":0,"line-width":{"base":1.4,"stops":[[8,1],[16,10]]}}},{"id":"railway-transit","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","class","transit"],["!=","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"railway","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["==","class","rail"],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"waterway-bridge-case","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#bbbbbb","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"waterway-bridge","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"bridge_minor case","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["==","class","minor_road"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#dedede","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"bridge_major case","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#dedede","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"bridge_minor","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["==","class","minor_road"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#efefef","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"bridge_major","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#fff","line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"admin_sub","type":"line","source":"openmaptiles","source-layer":"boundary","filter":["in","admin_level",4,6,8],"layout":{"visibility":"visible"},"paint":{"line-color":"hsla(0, 0%, 60%, 0.5)","line-dasharray":[2,1]}},{"id":"admin_country_z0-4","type":"line","source":"openmaptiles","source-layer":"boundary","minzoom":0,"maxzoom":5,"filter":["all",["<=","admin_level",2],["==","$type","LineString"],["!has","claimed_by"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"hsl(0, 0%, 60%)","line-width":{"base":1.3,"stops":[[3,0.5],[22,15]]}}},{"id":"admin_country_z5-","type":"line","source":"openmaptiles","source-layer":"boundary","minzoom":5,"filter":["all",["<=","admin_level",2],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"hsl(0, 0%, 60%)","line-width":{"base":1.3,"stops":[[3,0.5],[22,15]]}}},{"id":"poi_label","type":"symbol","source":"openmaptiles","source-layer":"poi","minzoom":14,"filter":["all",["==","$type","Point"],["==","rank",1]],"layout":{"icon-size":1,"text-anchor":"top","text-field":"{name:latin}\\n{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":8,"text-offset":[0,0.5],"text-size":11,"visibility":"visible"},"paint":{"text-color":"#666","text-halo-blur":1,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":1}},{"id":"airport-label","type":"symbol","source":"openmaptiles","source-layer":"aerodrome_label","minzoom":10,"filter":["all",["has","iata"]],"layout":{"icon-size":1,"text-anchor":"top","text-field":"{name:latin}\\n{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":8,"text-offset":[0,0.5],"text-size":11,"visibility":"visible"},"paint":{"text-color":"#666","text-halo-blur":1,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":1}},{"id":"road_major_label","type":"symbol","source":"openmaptiles","source-layer":"transportation_name","minzoom":13,"filter":["==","$type","LineString"],"layout":{"symbol-placement":"line","text-field":"{name:latin} {name:nonlatin}","text-font":["Noto Sans Regular"],"text-letter-spacing":0.1,"text-rotation-alignment":"map","text-size":{"base":1.4,"stops":[[10,8],[20,14]]},"text-transform":"uppercase","visibility":"visible"},"paint":{"text-color":"#000","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":2}},{"id":"place_label_other","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":8,"filter":["all",["==","$type","Point"],["!in","class","city","state","country","continent"]],"layout":{"text-anchor":"center","text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":6,"text-size":{"stops":[[6,10],[12,14]]},"visibility":"visible"},"paint":{"text-color":"hsl(0, 0%, 25%)","text-halo-blur":0,"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":2}},{"id":"place_label_state","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":3,"maxzoom":16,"filter":["all",["==","$type","Point"],["in","class","state","region","province"]],"layout":{"text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,14],[8,20]]},"symbol-sort-key":10},"paint":{"text-color":"hsl(0, 0%, 0%)","text-halo-blur":0,"text-halo-color":"hsla(0, 0%, 100%, 0.75)","text-halo-width":2}},{"id":"place_label_state_tw","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":3,"maxzoom":16,"filter":["all",["==","$type","Point"],["==","class","country"],["any",["==","iso_a2","TW"],["==","wikidata","Q865"],["==","name:en","Taiwan"],["==","name","Taiwan"]]],"layout":{"text-field":"","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,14],[8,20]]},"symbol-sort-key":10},"paint":{"text-color":"hsl(0, 0%, 0%)","text-halo-blur":0,"text-halo-color":"hsla(0, 0%, 100%, 0.75)","text-halo-width":2}},{"id":"place_label_city","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":5,"maxzoom":16,"filter":["all",["==","$type","Point"],["==","class","city"]],"layout":{"text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[6,12],[10,16]]},"symbol-sort-key":1},"paint":{"text-color":"hsl(0, 0%, 0%)","text-halo-blur":0,"text-halo-color":"hsla(0, 0%, 100%, 0.75)","text-halo-width":2}},{"id":"country_label-other","type":"symbol","source":"openmaptiles","source-layer":"place","maxzoom":12,"filter":["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],"layout":{"text-field":"{name:latin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,12],[8,22]]},"visibility":"visible"},"paint":{"text-color":"hsl(0, 0%, 13%)","text-halo-blur":0,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":2}},{"id":"country_label","type":"symbol","source":"openmaptiles","source-layer":"place","maxzoom":12,"filter":["all",["==","$type","Point"],["==","class","country"],["has","iso_a2"],["!=","iso_a2","TW"]],"layout":{"text-field":"{name:latin}","text-font":["Noto Sans Bold"],"text-max-width":10,"text-size":{"stops":[[3,12],[8,22]]},"visibility":"visible"},"paint":{"text-color":"hsl(0, 0%, 13%)","text-halo-blur":0,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":2}}]'),Cpe="basic",Ape="ChronoFrame",Ppe={version:_pe,name:ype,metadata:vpe,center:xpe,zoom:bpe,projection:wpe,sources:Tpe,sprite:Spe,glyphs:Epe,layers:Ipe,id:Cpe,owner:Ape},Mpe=8,kpe="ChronoFrame Dark",Dpe={"mapbox:autocomposite":!1,"mapbox:type":"template","maputnik:renderer":"mbgljs","openmaptiles:version":"3.x","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t"},Lpe=[116.4074,39.9042],Rpe=2,zpe={type:"globe"},Ope={openmaptiles:{type:"vector",url:"https://api.maptiler.com/tiles/v3-openmaptiles/tiles.json?key="}},Fpe="https://openmaptiles.github.io/maptiler-basic-gl-style/sprite",Bpe="https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=",Npe=JSON.parse('[{"id":"background","type":"background","paint":{"background-color":"rgba(51, 51, 51, 1)"}},{"id":"landuse-residential","type":"fill","source":"openmaptiles","source-layer":"landuse","filter":["all",["==","$type","Polygon"],["in","class","residential","suburb","neighbourhood"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(74, 74, 74, 0.64)","fill-opacity":0.7}},{"id":"landcover_grass","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","grass"],"paint":{"fill-color":"rgba(150, 189, 109, 0.66)","fill-opacity":0.45}},{"id":"landcover_wood","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","wood"],"paint":{"fill-color":"rgba(94, 109, 75, 0.44)","fill-opacity":{"base":1,"stops":[[8,0.6],[22,1]]}}},{"id":"water","type":"fill","source":"openmaptiles","source-layer":"water","filter":["all",["==","$type","Polygon"],["!=","intermittent",1],["!=","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(148, 193, 225, 0.19)"}},{"id":"water_intermittent","type":"fill","source":"openmaptiles","source-layer":"water","filter":["all",["==","$type","Polygon"],["==","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(30, 30, 30, 1)","fill-opacity":0.7}},{"id":"landcover-ice-shelf","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","subclass","ice_shelf"],"layout":{"visibility":"visible"},"paint":{"fill-color":"hsl(47, 26%, 88%)","fill-opacity":0.8}},{"id":"landcover-glacier","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","subclass","glacier"],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(90, 90, 90, 1)","fill-opacity":{"base":1,"stops":[[0,1],[8,0.5]]}}},{"id":"landcover_sand","type":"fill","metadata":{},"source":"openmaptiles","source-layer":"landcover","filter":["all",["in","class","sand"]],"paint":{"fill-antialias":false,"fill-color":"rgba(232, 214, 38, 1)","fill-opacity":0.3}},{"id":"landuse","type":"fill","source":"openmaptiles","source-layer":"landuse","filter":["==","class","agriculture"],"layout":{"visibility":"visible"},"paint":{"fill-color":"#eae0d0"}},{"id":"landuse_overlay_national_park","type":"fill","source":"openmaptiles","source-layer":"landcover","filter":["==","class","national_park"],"paint":{"fill-color":"#E1EBB0","fill-opacity":{"base":1,"stops":[[5,0],[9,0.75]]}}},{"id":"waterway-tunnel","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-dasharray":[3,3],"line-gap-width":{"stops":[[12,0],[20,6]]},"line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,2]]}}},{"id":"waterway","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["!in","brunnel","tunnel","bridge"],["!=","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(148, 193, 225, 0.35)","line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,8]]}}},{"id":"waterway_intermittent","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["!in","brunnel","tunnel","bridge"],["==","intermittent",1]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-dasharray":[2,1],"line-opacity":1,"line-width":{"base":1.4,"stops":[[8,1],[20,8]]}}},{"id":"tunnel_railway_transit","type":"line","source":"openmaptiles","source-layer":"transportation","minzoom":0,"filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["==","class","transit"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-dasharray":[3,3],"line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"building","type":"fill","source":"openmaptiles","source-layer":"building","layout":{"visibility":"visible"},"paint":{"fill-antialias":true,"fill-color":"rgba(135, 135, 135, 1)","fill-opacity":{"base":1,"stops":[[13,0],[15,1]]},"fill-outline-color":{"stops":[[15,"rgba(212, 177, 146, 0)"],[16,"rgba(212, 177, 146, 0.5)"]]}}},{"id":"housenumber","type":"symbol","source":"openmaptiles","source-layer":"housenumber","minzoom":17,"filter":["==","$type","Point"],"layout":{"text-field":"{housenumber}","text-font":["Noto Sans Regular"],"text-size":10},"paint":{"text-color":"rgba(212, 177, 146, 1)"}},{"id":"road_area_pier","type":"fill","metadata":{},"source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","Polygon"],["==","class","pier"]],"layout":{"visibility":"visible"},"paint":{"fill-antialias":true,"fill-color":"hsl(47, 26%, 88%)"}},{"id":"road_pier","type":"line","metadata":{},"source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","pier"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"hsl(47, 26%, 88%)","line-width":{"base":1.2,"stops":[[15,1],[17,4]]}}},{"id":"road_bridge_area","type":"fill","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","Polygon"],["in","brunnel","bridge"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(90, 90, 90, 0.56)","fill-opacity":0.5}},{"id":"road_path","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","path","track"]],"layout":{"line-cap":"square","line-join":"bevel","visibility":"visible"},"paint":{"line-color":"rgba(125, 125, 125, 1)","line-dasharray":[1,1],"line-width":{"base":1.55,"stops":[[4,0.25],[20,10]]}}},{"id":"road_minor","type":"line","source":"openmaptiles","source-layer":"transportation","minzoom":13,"filter":["all",["==","$type","LineString"],["in","class","minor","service"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(88, 88, 88, 1)","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"tunnel_minor","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["==","class","minor_road"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#efefef","line-dasharray":[0.36,0.18],"line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"tunnel_major","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","tunnel"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#fff","line-dasharray":[0.28,0.14],"line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"aeroway-area","type":"fill","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":4,"filter":["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(80, 80, 80, 1)","fill-opacity":{"base":1,"stops":[[13,0],[14,1]]}}},{"id":"aeroway-taxiway","type":"line","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":12,"filter":["all",["in","class","taxiway"],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(103, 89, 41, 1)","line-opacity":1,"line-width":{"base":1.5,"stops":[[12,1],[17,10]]}}},{"id":"aeroway-runway","type":"line","metadata":{"mapbox:group":"1444849345966.4436"},"source":"openmaptiles","source-layer":"aeroway","minzoom":4,"filter":["all",["in","class","runway"],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(80, 80, 80, 1)","line-opacity":1,"line-width":{"base":1.5,"stops":[[11,4],[17,50]]}}},{"id":"road_trunk_primary","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","trunk","primary"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(88, 88, 88, 1)","line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"road_secondary_tertiary","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["in","class","secondary","tertiary"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(88, 88, 88, 1)","line-width":{"base":1.4,"stops":[[6,0.5],[20,20]]}}},{"id":"road_major_motorway","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","class","motorway"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(88, 88, 88, 1)","line-offset":0,"line-width":{"base":1.4,"stops":[[8,1],[16,10]]}}},{"id":"railway-transit","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","class","transit"],["!=","brunnel","tunnel"]],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"railway","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["==","class","rail"],"layout":{"visibility":"visible"},"paint":{"line-color":"hsl(34, 12%, 66%)","line-opacity":{"base":1,"stops":[[11,0],[16,1]]}}},{"id":"waterway-bridge-case","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#bbbbbb","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"waterway-bridge","type":"line","source":"openmaptiles","source-layer":"waterway","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"hsl(205, 56%, 73%)","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"bridge_minor case","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["==","class","minor_road"]],"layout":{"line-cap":"butt","line-join":"miter"},"paint":{"line-color":"#dedede","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"bridge_major case","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"butt","line-join":"miter","visibility":"visible"},"paint":{"line-color":"rgba(154, 154, 154, 1)","line-gap-width":{"base":1.55,"stops":[[4,0.25],[20,30]]},"line-width":{"base":1.6,"stops":[[12,0.5],[20,10]]}}},{"id":"bridge_minor","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["==","class","minor_road"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(135, 135, 135, 1)","line-width":{"base":1.55,"stops":[[4,0.25],[20,30]]}}},{"id":"bridge_major","type":"line","source":"openmaptiles","source-layer":"transportation","filter":["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(119, 119, 119, 1)","line-width":{"base":1.4,"stops":[[6,0.5],[20,30]]}}},{"id":"admin_sub","type":"line","source":"openmaptiles","source-layer":"boundary","filter":["in","admin_level",4,6,8],"layout":{"visibility":"visible"},"paint":{"line-color":"hsla(0, 0%, 60%, 0.5)","line-dasharray":[2,1]}},{"id":"admin_country_z0-4","type":"line","source":"openmaptiles","source-layer":"boundary","minzoom":0,"maxzoom":5,"filter":["all",["<=","admin_level",2],["==","$type","LineString"],["!has","claimed_by"]],"layout":{"line-cap":"round","line-join":"round","visibility":"none"},"paint":{"line-color":"hsl(0, 0%, 60%)","line-width":{"base":1.3,"stops":[[3,0.5],[22,15]]}}},{"id":"admin_country_z5-","type":"line","source":"openmaptiles","source-layer":"boundary","minzoom":5,"filter":["all",["<=","admin_level",2],["==","$type","LineString"]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"hsl(0, 0%, 60%)","line-width":{"base":1.3,"stops":[[3,0.5],[22,15]]}}},{"id":"poi_label","type":"symbol","source":"openmaptiles","source-layer":"poi","minzoom":14,"filter":["all",["==","$type","Point"],["==","rank",1]],"layout":{"icon-size":1,"text-anchor":"top","text-field":"{name:latin}\\n{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":8,"text-offset":[0,0.5],"text-size":11,"visibility":"visible"},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":1,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":1}},{"id":"airport-label","type":"symbol","source":"openmaptiles","source-layer":"aerodrome_label","minzoom":10,"filter":["all",["has","iata"]],"layout":{"icon-size":1,"text-anchor":"top","text-field":"{name:latin}\\n{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":8,"text-offset":[0,0.5],"text-size":11,"visibility":"visible"},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":1,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":1}},{"id":"road_major_label","type":"symbol","source":"openmaptiles","source-layer":"transportation_name","minzoom":13,"filter":["==","$type","LineString"],"layout":{"symbol-placement":"line","text-field":"{name:latin} {name:nonlatin}","text-font":["Noto Sans Regular"],"text-letter-spacing":0.1,"text-rotation-alignment":"map","text-size":{"base":1.4,"stops":[[10,8],[20,14]]},"text-transform":"uppercase","visibility":"visible"},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":2}},{"id":"place_label_other","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":8,"filter":["all",["==","$type","Point"],["!in","class","city","state","country","continent"]],"layout":{"text-anchor":"center","text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":6,"text-size":{"stops":[[6,10],[12,14]]},"visibility":"visible"},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":0,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":2}},{"id":"place_label_state","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":3,"maxzoom":16,"filter":["all",["==","$type","Point"],["in","class","state","region","province"]],"layout":{"text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,14],[8,20]]},"symbol-sort-key":10},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":0,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":2}},{"id":"place_label_state_tw","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":3,"maxzoom":16,"filter":["all",["==","$type","Point"],["==","class","country"],["any",["==","iso_a2","TW"],["==","wikidata","Q865"],["==","name:en","Taiwan"],["==","name","Taiwan"]]],"layout":{"text-field":"","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,14],[8,20]]},"symbol-sort-key":10},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":0,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":2}},{"id":"place_label_city","type":"symbol","source":"openmaptiles","source-layer":"place","minzoom":5,"maxzoom":16,"filter":["all",["==","$type","Point"],["==","class","city"]],"layout":{"text-field":"{name:nonlatin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[6,12],[10,16]]},"symbol-sort-key":1},"paint":{"text-color":"rgba(135, 135, 135, 1)","text-halo-blur":0,"text-halo-color":"rgba(47, 47, 47, 0.75)","text-halo-width":2}},{"id":"country_label-other","type":"symbol","source":"openmaptiles","source-layer":"place","maxzoom":12,"filter":["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],"layout":{"text-field":"{name:latin}","text-font":["Noto Sans Regular"],"text-max-width":10,"text-size":{"stops":[[3,12],[8,22]]},"visibility":"visible"},"paint":{"text-color":"hsl(0, 0%, 13%)","text-halo-blur":0,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":2}},{"id":"country_label","type":"symbol","source":"openmaptiles","source-layer":"place","maxzoom":12,"filter":["all",["==","$type","Point"],["==","class","country"],["has","iso_a2"],["!=","iso_a2","TW"]],"layout":{"text-field":"{name:latin}","text-font":["Noto Sans Bold"],"text-max-width":10,"text-size":{"stops":[[3,15],[8,22]]},"visibility":"visible"},"paint":{"text-color":"rgba(133, 133, 133, 1)","text-halo-blur":0,"text-halo-color":"rgba(65, 65, 65, 0.75)","text-halo-width":2}}]'),Vpe="basic",jpe="ChronoFrame",Upe={version:Mpe,name:kpe,metadata:Dpe,center:Lpe,zoom:Rpe,projection:zpe,sources:Ope,sprite:Fpe,glyphs:Bpe,layers:Npe,id:Vpe,owner:jpe},Dj=()=>X_("color-mode").value,$pe=kr({__name:"Provider",props:{class:{default:void 0},mapId:{default:void 0},center:{default:void 0},zoom:{default:2},interactive:{type:Boolean,default:!0},attributionControl:{type:[Boolean,Object],default:!1},language:{default:void 0}},emits:["load","zoom"],setup(e,{emit:i}){const s=i,l=Dj(),p=Ei(()=>{const t=pW("map");return typeof t=="object"&&t?t:{}}),_=Ei(()=>p.value.provider||"maplibre"),b=Ei(()=>{if(_.value==="mapbox")return p.value["mapbox.style"]||"mapbox://styles/mapbox/standard";{const t=l.value==="dark"?Upe:Ppe;return p.value["maplibre.style"]||{...t,sources:{openmaptiles:{...t.sources?.openmaptiles,url:`https://api.maptiler.com/tiles/v3-openmaptiles/tiles.json?key=${p.value["maplibre.token"]}`}},glyphs:`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${p.value["maplibre.token"]}`}}});return(t,P)=>{const O=Yfe,F=gpe,$=S4;return li(),ir("div",{class:_s(ut(q_)("w-full h-full",t.$props.class))},[tr($,null,{default:Jn(()=>[ut(_)==="maplibre"?(li(),En(O,{key:0,class:"w-full h-full","map-key":e.mapId,"map-style":ut(b),center:e.center,zoom:e.zoom,interactive:e.interactive,"attribution-control":e.attributionControl,"onMap:load":P[0]||(P[0]=W=>s("load",W.map)),"onMap:zoom":P[1]||(P[1]=W=>s("zoom"))},{default:Jn(()=>[Rs(t.$slots,"default")]),_:3},8,["map-key","map-style","center","zoom","interactive","attribution-control"])):(li(),En(F,{key:1,class:"w-full h-full","map-id":e.mapId||"cframe-mapbox-map",options:{accessToken:ut(p)["mapbox.token"],style:ut(b),center:e.center,zoom:e.zoom,interactive:e.interactive,attributionControl:e.attributionControl,language:e.language,config:{basemap:{lightPreset:t.$colorMode.value==="dark"?"night":"day",colorThemes:"faded"}}},onLoad:P[2]||(P[2]=W=>s("load",W)),onZoom:P[3]||(P[3]=W=>s("zoom"))},{default:Jn(()=>[Rs(t.$slots,"default")]),_:3},8,["map-id","options"]))]),_:3})],2)}}}),Gpe=Object.assign($pe,{__name:"MapProvider"}),qpe=(e,i)=>i==="mapbox",Hpe={class:"relative w-full h-44 overflow-hidden rounded-lg border border-white/10 dark:border-white/10"},Wpe={key:0,class:"absolute inset-0 bg-default/80 flex items-center justify-center backdrop-blur-sm"},Zpe={class:"text-xs font-medium text-white/60"},Xpe="minimap-info-panel",Ype=kr({__name:"MiniMap",props:{photo:{},latitude:{},longitude:{}},setup(e){const i=e,s=jf(),l=an(!1),p=an(!1),_=an(null);let b=null;const t=O=>{_.value=O,O.setCenter([i.longitude,i.latitude]),setTimeout(()=>{l.value=!0},100)},P=(O,F)=>{_.value&&l.value&&(b&&(clearTimeout(b),b=null),p.value=!0,_.value.flyTo({duration:1e3,center:[F,O],zoom:12,essential:!0}),b=setTimeout(()=>{p.value=!1,b=null},1e3))};return Qn([()=>i.latitude,()=>i.longitude],([O,F])=>{P(O,F);const $=_.value;if($&&qpe($,s.public.map.provider)){const Y=new Date(i.photo.dateTaken||0).getHours();Y>=5&&Y<7?$.setConfigProperty("basemap","lightPreset","dawn"):Y>=7&&Y<17?$.setConfigProperty("basemap","lightPreset","day"):Y>=17&&Y<21?$.setConfigProperty("basemap","lightPreset","dusk"):$.setConfigProperty("basemap","lightPreset","night")}}),ru(()=>{b&&(clearTimeout(b),b=null)}),(O,F)=>{const $=ym,W=Gpe;return li(),ir("div",Hpe,[tr(W,{class:"w-full h-full relative overflow-hidden","map-id":Xpe,zoom:12,interactive:!1,language:O.$i18n.locale,onLoad:t},{default:Jn(()=>[tr($,null,{default:Jn(()=>[ut(p)?gr("",!0):(li(),En(ut(Gl).div,{key:0,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},{default:Jn(()=>[...F[0]||(F[0]=[Bn("div",{class:"relative"},[Bn("div",{class:"absolute top-1/2 left-1/2 h-3 w-3 -translate-x-1/2 -translate-y-1/2 animate-ping rounded-full bg-primary/70"}),Bn("div",{class:"relative h-2 w-2 rounded-full bg-primary ring-2 ring-white/80"})],-1)])]),_:1}))]),_:1}),ut(l)?gr("",!0):(li(),ir("div",Wpe,[Bn("p",Zpe,Lr(O.$t("minimap.loading")),1)]))]),_:1},8,["language"])])}}}),Kpe=Object.assign(Ype,{__name:"PhotoMiniMap"}),Jpe={key:0,class:"space-y-3"},Qpe={class:"text-sm font-medium text-white uppercase tracking-wide"},eme={class:"space-y-2"},tme={key:0,class:"size-4 -mt-[1px]"},ime={class:"flex-1 min-w-0 flex gap-6 items-start justify-between font-medium"},nme={class:"text-white/80 text-nowrap"},rme={class:"text-white text-wrap tracking-tight wrap-anywhere text-end whitespace-pre-line"},sme=kr({__name:"KVRenderer",props:{data:{}},setup(e){return(i,s)=>{const l=Wd;return li(!0),ir(qs,null,Eu(e.data,(p,_)=>(li(),ir(qs,{key:_},[p.items.some(b=>b?.value)?(li(),ir("div",Jpe,[Bn("h4",Qpe,Lr(p.title),1),Bn("div",eme,[(li(!0),ir(qs,null,Eu(p.items.filter(Boolean),(b,t)=>(li(),ir("div",{key:t,class:"flex items-start gap-1 text-xs"},[b.icon==="placeholder"?(li(),ir("div",tme)):b.icon?(li(),En(l,{key:1,name:b.icon,class:"size-4 -mt-[1px] text-white/80 flex-shrink-0"},null,8,["name"])):gr("",!0),Bn("div",ime,[Bn("div",nme,Lr(b.label),1),Bn("div",rme,Lr(b.value),1)])]))),128))])])):gr("",!0)],64))),128)}}}),ome=Object.assign(sme,{__name:"PhotoKVRenderer"}),ame={name:"TablerStar"},lme={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function cme(e,i,s,l,p,_){return li(),ir("svg",lme,[...i[0]||(i[0]=[Bn("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m12 17.75l-6.172 3.245l1.179-6.873l-5-4.867l6.9-1l3.086-6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"},null,-1)])])}const kF=Object.assign(d0(ame,[["render",cme]]),{__name:"IconTablerStar"}),ume={name:"TablerStarFilled"},hme={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function dme(e,i,s,l,p,_){return li(),ir("svg",hme,[...i[0]||(i[0]=[Bn("path",{fill:"currentColor",d:"m8.243 7.34l-6.38.925l-.113.023a1 1 0 0 0-.44 1.684l4.622 4.499l-1.09 6.355l-.013.11a1 1 0 0 0 1.464.944l5.706-3l5.693 3l.1.046a1 1 0 0 0 1.352-1.1l-1.091-6.355l4.624-4.5l.078-.085a1 1 0 0 0-.633-1.62l-6.38-.926l-2.852-5.78a1 1 0 0 0-1.794 0z"},null,-1)])])}const DF=Object.assign(d0(ume,[["render",dme]]),{__name:"IconTablerStarFilled"}),fme={name:"TablerStarHalfFilled"},pme={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function mme(e,i,s,l,p,_){return li(),ir("svg",pme,[...i[0]||(i[0]=[Bn("path",{fill:"currentColor",d:"M12 1a1 1 0 0 1 .823.443l.067.116l2.852 5.781l6.38.925c.741.108 1.08.94.703 1.526l-.07.095l-.078.086l-4.624 4.499l1.09 6.355a1 1 0 0 1-1.249 1.135l-.101-.035l-.101-.046l-5.693-3l-5.706 3q-.158.082-.32.106l-.106.01a1.003 1.003 0 0 1-1.038-1.06l.013-.11l1.09-6.355l-4.623-4.5a1 1 0 0 1 .328-1.647l.113-.036l.114-.023l6.379-.925l2.853-5.78A.97.97 0 0 1 12 1m0 3.274V16.75a1 1 0 0 1 .239.029l.115.036l.112.05l4.363 2.299l-.836-4.873a1 1 0 0 1 .136-.696l.07-.099l.082-.09l3.546-3.453l-4.891-.708a1 1 0 0 1-.62-.344l-.073-.097l-.06-.106z"},null,-1)])])}const LF=Object.assign(d0(fme,[["render",mme]]),{__name:"IconTablerStarHalfFilled"}),gme=["onClick"],_me={class:"absolute inset-0 flex"},yme=["onClick"],vme=["onClick"],xme=kr({__name:"Rating",props:{modelValue:{},allowHalf:{type:Boolean,default:!0},allowClear:{type:Boolean,default:!0},size:{default:"md"},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:i}){const s=e,l=i,p={xs:"text-sm",sm:"text-base",md:"text-lg",lg:"text-xl",xl:"text-2xl"},_=(t,P=!1)=>{if(s.readonly)return;let O=t+(P?.5:1);s.allowClear&&s.modelValue===O&&(O=0),l("update:modelValue",O)},b=t=>{const P=s.modelValue;return P>=t+1?"filled":s.allowHalf&&P>=t+.5?"half":"empty"};return(t,P)=>(li(),ir("div",{class:_s(["rating flex items-center gap-1",[p[s.size],{"cursor-pointer":!s.readonly}]])},[s.allowHalf?(li(),ir(qs,{key:1},Eu(5,O=>Bn("div",{key:`half-${O}`,class:_s(["star relative",{readonly:s.readonly}])},[b(O-1)==="empty"?(li(),En(kF,{key:0,class:"text-neutral-500 dark:text-neutral-300"})):b(O-1)==="filled"?(li(),En(DF,{key:1,class:"text-yellow-400"})):(li(),En(LF,{key:2,class:"text-yellow-400"})),Bn("div",_me,[Bn("div",{class:"w-1/2",onClick:Sm(F=>_(O-1,!0),["stop"])},null,8,yme),Bn("div",{class:"w-1/2",onClick:Sm(F=>_(O-1),["stop"])},null,8,vme)])],2)),64)):(li(),ir(qs,{key:0},Eu(5,O=>Bn("div",{key:`no-half-${O}`,class:_s(["star relative",{readonly:s.readonly}]),onClick:F=>_(O-1)},[b(O-1)==="empty"?(li(),En(kF,{key:0,class:"text-neutral-500 dark:text-neutral-300"})):b(O-1)==="filled"?(li(),En(DF,{key:1,class:"text-yellow-400"})):(li(),En(LF,{key:2,class:"text-yellow-400"}))],10,gme)),64))],2))}}),bme=Object.assign(d0(xme,[["__scopeId","data-v-ff746135"]]),{__name:"Rating"}),wme={slots:{base:"font-medium inline-flex items-center",label:"truncate",leadingIcon:"shrink-0",leadingAvatar:"shrink-0",leadingAvatarSize:"",trailingIcon:"shrink-0"},variants:{fieldGroup:{horizontal:"not-only:first:rounded-e-none not-only:last:rounded-s-none not-last:not-first:rounded-none focus-visible:z-[1]",vertical:"not-only:first:rounded-b-none not-only:last:rounded-t-none not-last:not-first:rounded-none focus-visible:z-[1]"},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},variant:{solid:"",outline:"",soft:"",subtle:""},size:{xs:{base:"text-[8px]/3 px-1 py-0.5 gap-1 rounded-sm",leadingIcon:"size-3",leadingAvatarSize:"3xs",trailingIcon:"size-3"},sm:{base:"text-[10px]/3 px-1.5 py-1 gap-1 rounded-sm",leadingIcon:"size-3",leadingAvatarSize:"3xs",trailingIcon:"size-3"},md:{base:"text-xs px-2 py-1 gap-1 rounded-md",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},lg:{base:"text-sm px-2 py-1 gap-1.5 rounded-md",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},xl:{base:"text-base px-2.5 py-1 gap-1.5 rounded-md",leadingIcon:"size-6",leadingAvatarSize:"2xs",trailingIcon:"size-6"}},square:{true:""}},compoundVariants:[{color:"primary",variant:"solid",class:"bg-primary text-inverted"},{color:"secondary",variant:"solid",class:"bg-secondary text-inverted"},{color:"success",variant:"solid",class:"bg-success text-inverted"},{color:"info",variant:"solid",class:"bg-info text-inverted"},{color:"warning",variant:"solid",class:"bg-warning text-inverted"},{color:"error",variant:"solid",class:"bg-error text-inverted"},{color:"primary",variant:"outline",class:"text-primary ring ring-inset ring-primary/50"},{color:"secondary",variant:"outline",class:"text-secondary ring ring-inset ring-secondary/50"},{color:"success",variant:"outline",class:"text-success ring ring-inset ring-success/50"},{color:"info",variant:"outline",class:"text-info ring ring-inset ring-info/50"},{color:"warning",variant:"outline",class:"text-warning ring ring-inset ring-warning/50"},{color:"error",variant:"outline",class:"text-error ring ring-inset ring-error/50"},{color:"primary",variant:"soft",class:"bg-primary/10 text-primary"},{color:"secondary",variant:"soft",class:"bg-secondary/10 text-secondary"},{color:"success",variant:"soft",class:"bg-success/10 text-success"},{color:"info",variant:"soft",class:"bg-info/10 text-info"},{color:"warning",variant:"soft",class:"bg-warning/10 text-warning"},{color:"error",variant:"soft",class:"bg-error/10 text-error"},{color:"primary",variant:"subtle",class:"bg-primary/10 text-primary ring ring-inset ring-primary/25"},{color:"secondary",variant:"subtle",class:"bg-secondary/10 text-secondary ring ring-inset ring-secondary/25"},{color:"success",variant:"subtle",class:"bg-success/10 text-success ring ring-inset ring-success/25"},{color:"info",variant:"subtle",class:"bg-info/10 text-info ring ring-inset ring-info/25"},{color:"warning",variant:"subtle",class:"bg-warning/10 text-warning ring ring-inset ring-warning/25"},{color:"error",variant:"subtle",class:"bg-error/10 text-error ring ring-inset ring-error/25"},{color:"neutral",variant:"solid",class:"text-inverted bg-inverted"},{color:"neutral",variant:"outline",class:"ring ring-inset ring-accented text-default bg-default"},{color:"neutral",variant:"soft",class:"text-default bg-elevated"},{color:"neutral",variant:"subtle",class:"ring ring-inset ring-accented text-default bg-elevated"},{size:"xs",square:!0,class:"p-0.5"},{size:"sm",square:!0,class:"p-1"},{size:"md",square:!0,class:"p-1"},{size:"lg",square:!0,class:"p-1"},{size:"xl",square:!0,class:"p-1"}],defaultVariants:{color:"primary",variant:"solid",size:"md"}},Tme={__name:"UBadge",props:{as:{type:null,required:!1,default:"span"},label:{type:[String,Number],required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},square:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},leading:{type:Boolean,required:!1},leadingIcon:{type:null,required:!1},trailing:{type:Boolean,required:!1},trailingIcon:{type:null,required:!1}},setup(e){const i=e,s=GE(),l=hd(),{orientation:p,size:_}=ej(i),{isLeading:b,isTrailing:t,leadingIconName:P,trailingIconName:O}=QV(i),F=Ei(()=>Mh({extend:Mh(wme),...l.ui?.badge||{}})({color:i.color,variant:i.variant,size:_.value||i.size,square:i.square||!s.default&&!i.label,fieldGroup:p.value}));return($,W)=>(li(),En(ut(kh),{as:e.as,"data-slot":"base",class:_s(F.value.base({class:[i.ui?.base,i.class]}))},{default:Jn(()=>[Rs($.$slots,"leading",{ui:F.value},()=>[ut(b)&&ut(P)?(li(),En(ab,{key:0,name:ut(P),"data-slot":"leadingIcon",class:_s(F.value.leadingIcon({class:i.ui?.leadingIcon}))},null,8,["name","class"])):e.avatar?(li(),En(pk,Oo({key:1,size:i.ui?.leadingAvatarSize||F.value.leadingAvatarSize()},e.avatar,{"data-slot":"leadingAvatar",class:F.value.leadingAvatar({class:i.ui?.leadingAvatar})}),null,16,["size","class"])):gr("",!0)]),Rs($.$slots,"default",{ui:F.value},()=>[e.label!==void 0&&e.label!==null?(li(),ir("span",{key:0,"data-slot":"label",class:_s(F.value.label({class:i.ui?.label}))},Lr(e.label),3)):gr("",!0)]),Rs($.$slots,"trailing",{ui:F.value},()=>[ut(t)&&ut(O)?(li(),En(ab,{key:0,name:ut(O),"data-slot":"trailingIcon",class:_s(F.value.trailingIcon({class:i.ui?.trailingIcon}))},null,8,["name","class"])):gr("",!0)])]),_:3},8,["as","class"]))}},rw=e=>new Array(e).fill(0),vS=e=>{const i=rw(128);for(let s=0;s<e.length;s++)i[Math.floor(s/2)]+=e[s]??0;return i},Sme=e=>{const i={red:rw(256),green:rw(256),blue:rw(256),gray:rw(256)},{data:s}=e;for(let l=0;l<s.length;l+=4){const p=s[l],_=s[l+1],b=s[l+2],t=Math.round(.299*p+.587*_+.114*b);i.red[p]++,i.green[_]++,i.blue[b]++,i.gray[t]++}return{red:vS(i.red),green:vS(i.green),blue:vS(i.blue),gray:vS(i.gray)}},Eme=e=>1-Math.pow(1-e,3),RF=new WeakMap,Ime=(e,i,s={padding:0,colors:{background:"rgba(36, 36, 38, .65)",border:"rgba(255, 255, 255, .1)",grid:"rgba(255, 255, 255, .3)",red:"rgba(255, 98, 89, 1)",green:"rgba(46, 209, 87, 1)",blue:"rgba(59, 154, 255, 1)",gray:"rgba(255, 255, 255, 1)"}})=>{const l=e.getContext("2d");if(!l){console.error("Failed to get canvas context");return}let p=RF.get(e);p||(p={animationId:null,isAnimating:!1},RF.set(e,p)),p.isAnimating&&p.animationId&&clearTimeout(p.animationId);const _=e.getBoundingClientRect(),{width:b,height:t}=_,P=window.devicePixelRatio||1;e.width=b*P,e.height=t*P,l.scale(P,P),e.style.width=`${b}px`,e.style.height=`${t}px`;const O=Math.max(...i.red,...i.green,...i.blue,...i.gray);if(O===0)return;const F=b,$=t,W=F-s.padding*2,Y=$-s.padding*2,ae=(de,Ee,Pe=1,Ze=1)=>{const We=W/de.length;for(let je=0;je<de.length;je++){const ct=(de[je]??0)/O*Y*Ze,Lt=l.createLinearGradient(0,s.padding+Y-ct,0,s.padding+Y);Lt.addColorStop(0,Ee.replace(/[\d.]+\)$/,`${Pe})`)),Lt.addColorStop(1,Ee.replace(/[\d.]+\)$/,`${Pe*.3})`)),l.fillStyle=Lt,l.globalAlpha=Pe;const Ht=s.padding+je*We,ci=s.padding+Y-ct,Wt=We*.8,$t=ct,Dt=Math.min(Wt/2,2);l.beginPath(),l.roundRect(Ht,ci,Wt,$t,[Dt,Dt,0,0]),l.fill()}l.globalAlpha=1},se=de=>{l.clearRect(0,0,F,$),l.fillStyle=s.colors.background,l.fillRect(0,0,F,$),l.lineWidth=.2,l.strokeStyle=s.colors.grid;for(let Ee=1;Ee<=3;Ee++)l.beginPath(),l.moveTo(s.padding,s.padding+Y/4*Ee),l.lineTo(F-s.padding,s.padding+Y/4*Ee),l.stroke();ae(i.gray,s.colors.gray,.4,de),l.globalCompositeOperation="screen",ae(i.red,s.colors.red,.8,de),ae(i.green,s.colors.green,.8,de),ae(i.blue,s.colors.blue,.8,de),l.globalCompositeOperation="source-over",l.strokeStyle=s.colors.border,l.lineWidth=1,l.strokeRect(s.padding-.5,s.padding-.5,W+1,Y+1)};p.isAnimating=!0;const ie=Date.now(),pe=600,ye=()=>{const de=Date.now()-ie,Ee=Math.min(de/pe,1),Pe=Eme(Ee);se(Pe),Ee<1?p.animationId=window.setTimeout(ye,16):(p.isAnimating=!1,p.animationId=null)};se(0),ye()},Cme={key:0,class:"absolute inset-0 bg-neutral-900/50 flex flex-col gap-2 items-center justify-center rounded-lg backdrop-blur-xl z-10 text-white"},Ame={key:0,class:"absolute inset-0 bg-neutral-900/50 flex flex-col gap-2 items-center justify-center rounded-lg backdrop-blur-xl z-10 text-white"},Pme=kr({__name:"Histogram",props:{thumbnailUrl:{},options:{},class:{}},setup(e){const i=e,s=iM("canvasRef"),l=an(!0),p=an(!1),_=an(null);let b=null;const t=()=>{b&&(b.onload=null,b.onerror=null,b.src="",b=null)};return Ph(()=>{l.value=!0,p.value=!1,_.value=null,t();const P=new Image;b=P,P.crossOrigin="anonymous";const O=new URL(i.thumbnailUrl,window.location.origin);O.searchParams.set("_cors",Date.now().toString()),P.src=O.toString(),P.onload=()=>{if(P!==b)return;const F=document.createElement("canvas"),$=F.getContext("2d");if(!$){p.value=!0,l.value=!1;return}const W=360/Math.max(P.width,P.height),[Y,ae]=[Math.floor(P.width*W),Math.floor(P.height*W)];F.width=Y,F.height=ae,$.drawImage(P,0,0,Y,ae);try{const se=$.getImageData(0,0,Y,ae);_.value=Sme(se)}catch(se){p.value=!0,console.error("Failed to calculate histogram",se)}finally{l.value=!1,b=null}},P.onerror=()=>{P===b&&(p.value=!0,l.value=!1,b=null)}}),Ph(()=>{_.value&&s.value&&Ime(s.value,_.value,i.options)}),ru(t),(P,O)=>{const F=Wd;return li(),ir("div",{class:_s(ut(q_)("relative w-full h-32 group overflow-hidden",P.$props.class))},[tr(dw,{name:"fade"},{default:Jn(()=>[ut(l)?(li(),ir("div",Cme,[tr(F,{name:"tabler:loader",class:"text-xl animate-spin"}),O[0]||(O[0]=Bn("span",{class:"text-xs font-medium"},"Rendering",-1))])):gr("",!0)]),_:1}),tr(dw,{name:"fade"},{default:Jn(()=>[ut(p)?(li(),ir("div",Ame,[tr(F,{name:"tabler:alert-triangle",class:"text-xl"}),O[1]||(O[1]=Bn("span",{class:"text-xs font-medium"},"",-1))])):gr("",!0)]),_:1}),tr(dw,{name:"fade"},{default:Jn(()=>[ut(_)?(li(),ir("canvas",{key:0,ref_key:"canvasRef",ref:s,class:"w-full h-full rounded-lg backdrop-blur-xl"},null,512)):gr("",!0)]),_:1})],2)}}}),Mme=Object.assign(d0(Pme,[["__scopeId","data-v-f65ed064"]]),{__name:"Histogram"});function kme(e,i){if(!e&&!i)return"";if(!e)return i||"";if(!i)return e;const s={Canon:["canon","eos"],Nikon:["nikon"],Sony:["sony","ilce","dsc"],Fujifilm:["fujifilm","fuji","x-"],Olympus:["olympus","om-","e-"],Panasonic:["panasonic","lumix","dc-","dmc-"],Leica:["leica"],Pentax:["pentax","k-"],Ricoh:["ricoh","gr"],Hasselblad:["hasselblad"],"Phase One":["phase one"],Mamiya:["mamiya"],Apple:["apple"],Samsung:["samsung","galaxy","sm-"],Google:["pixel"],Xiaomi:["xiaomi","mi ","redmi"],Huawei:["huawei","p30","p40","p50","mate"],OnePlus:["oneplus"],OPPO:["oppo"],Vivo:["vivo"],Realme:["realme"],Honor:["honor"]},l=e.toLowerCase().trim(),p=i.toLowerCase().trim();return(s[e]||[l]).some(t=>p.includes(t.toLowerCase()))?i:`${e} ${i}`}function Dme(e,i){if(!e&&!i)return"";if(!e)return i||"";if(!i)return e;const s={Canon:["canon","ef","rf"],Nikon:["nikon","nikkor"],Sony:["sony","fe","e "],Sigma:["sigma"],Tamron:["tamron"],Tokina:["tokina"],Samyang:["samyang"],Zeiss:["zeiss"],Voigtlnder:["voigtlander","voigtlnder"],Leica:["leica"],Panasonic:["panasonic","lumix"],Olympus:["olympus","zuiko"],Fujifilm:["fujifilm","fujinon","xf","xc"]},l=e.toLowerCase().trim(),p=i.toLowerCase().trim();return(s[e]||[l]).some(t=>p.includes(t.toLowerCase()))?i:`${e} ${i}`}function Lj(){return zg}function Lme(e){return e.replace(/[^a-zA-Z0-9 ]+/g," ").trim().split(/\s+/).map((i,s)=>{const l=i.toLowerCase();return s===0?l:l.charAt(0).toUpperCase()+l.slice(1)}).join("")}function Rme(e,i,s){if(!i)return"";const l=String(i),p=Lme(l),_=`exif.values.${e}.${p}`;return s(_)}function zme(){const{$i18n:e}=Vs();return{localizeExif:(s,l)=>Rme(s,l,e.t)}}const Ome=e=>{if(e===0)return"0 B";const i=1024,s=["B","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,l)).toFixed(2))+" "+s[l]},Fme={class:"flex items-center justify-between px-4 py-3 border-b border-white/10 flex-shrink-0"},Bme={class:"font-black text-white text-ellipsis line-clamp-1"},Nme={key:0,class:"text-sm text-white text-justify"},Vme={key:3,class:"flex items-center gap-2 justify-between"},jme={class:"text-sm font-medium text-white uppercase tracking-wide"},Ume={key:4,class:"mt-4"},$me={class:"text-sm font-medium text-white/90 uppercase tracking-wide mb-2"},Gme={class:"space-y-2"},qme=["onClick"],Hme={class:"text-sm text-white font-medium line-clamp-1"},Wme={key:0,class:"text-xs text-white/60 line-clamp-1"},Zme={key:5,class:"mt-4"},Xme={class:"text-sm font-medium text-white/90 uppercase tracking-wide mb-2"},Yme={class:"flex flex-wrap gap-1"},Kme={class:"space-y-2"},Jme={class:"text-sm font-medium text-white uppercase tracking-wide"},Qme=kr({__name:"InfoPanel",props:{currentPhoto:{},exifData:{},onClose:{type:Function}},setup(e){const{t:i}=h0(),s=Lj(),l=nu(),{localizeExif:p}=zme(),_=e,{data:b}=C4(()=>`/api/photos/${_.currentPhoto.id}/albums`,{watch:[()=>_.currentPhoto.id]},"$g3KCOMe2wn"),t=Ei(()=>b.value||[]),P=ie=>{if(!ie)return"";let pe;if(typeof ie=="string"){if(ie.includes("/")){const ye=ie.split("/");if(ye.length===2&&ye[0]&&ye[1]){const de=parseFloat(ye[0]),Ee=parseFloat(ye[1]);if(!isNaN(de)&&!isNaN(Ee)&&Ee!==0)pe=de/Ee;else return ie}else return ie}else if(pe=parseFloat(ie),isNaN(pe))return ie}else pe=ie;return pe>=1?`${pe}s`:`1/${Math.round(1/pe)}`},O=(ie,pe)=>{const ye=ie>=0?"N":"S",de=pe>=0?"E":"W",Ee=Math.abs(ie),Pe=Math.abs(pe),Ze=Math.floor(Ee),We=Math.floor((Ee-Ze)*60),je=((Ee-Ze)*60-We)*60,Ye=Math.floor(Pe),ct=Math.floor((Pe-Ye)*60),Lt=((Pe-Ye)*60-ct)*60;return`${Ze}${We}'${je.toFixed(2)}"${ye}
${Ye}${ct}'${Lt.toFixed(2)}"${de}`},F=Ei(()=>{if(_.currentPhoto.latitude&&_.currentPhoto.longitude)return{latitude:_.currentPhoto.latitude,longitude:_.currentPhoto.longitude};if(!_.exifData)return null;const{GPSLatitude:ie,GPSLongitude:pe}=_.exifData;return ie&&pe?{latitude:parseFloat(`${ie}`),longitude:parseFloat(`${pe}`)}:null}),$=Ei(()=>{const ie={};return ie.basicInfo=[{title:i("exif.sections.basic"),items:[_.currentPhoto.storageKey?{label:i("exif.filename"),value:_.currentPhoto.storageKey.split("/").pop()||_.currentPhoto.storageKey,icon:"tabler:file"}:null,_.currentPhoto.fileSize?{label:i("exif.fileSize"),value:Ome(_.currentPhoto.fileSize),icon:"tabler:database"}:null,_.currentPhoto.width&&_.currentPhoto.height?{label:i("exif.resolution"),value:`${_.currentPhoto.width}  ${_.currentPhoto.height}`,icon:"tabler:dimensions"}:null,_.currentPhoto.width&&_.currentPhoto.height?{label:i("exif.pixels"),value:`${(_.currentPhoto.width*_.currentPhoto.height/1e6).toFixed(2)} MP`,icon:"tabler:grid-dots"}:null,_.exifData?.DateTimeOriginal?{label:i("exif.dateTaken.title"),value:s(_.exifData.DateTimeOriginal).format("L LT"),icon:"tabler:calendar"}:null,_.exifData?.ColorSpace?{label:i("exif.colorSpace.title"),value:p("colorSpace",_.exifData.ColorSpace),icon:"tabler:palette"}:null,_.exifData?.Artist?{label:i("exif.artist"),value:_.exifData.Artist,icon:"tabler:user"}:null,_.exifData?.Software?{label:i("exif.software"),value:_.exifData.Software,icon:"tabler:app-window"}:null,_.exifData?.tz?{label:i("exif.tz"),value:_.exifData.tz,icon:"tabler:world"}:null,_.currentPhoto.country?{label:i("exif.country"),value:_.currentPhoto.country,icon:"tabler:map-pin"}:null,_.currentPhoto.city?{label:i("exif.city"),value:_.currentPhoto.city,icon:"tabler:building"}:null,_.currentPhoto.latitude&&_.currentPhoto.longitude?{label:i("exif.gps.title"),value:O(_.currentPhoto.latitude,_.currentPhoto.longitude),icon:"tabler:gps"}:null]}],ie.captureParams=[{title:i("exif.sections.shooting.parameters"),items:[_.exifData?.FocalLengthIn35mmFormat?{label:i("exif.focal.length.actual"),value:`${_.exifData.FocalLengthIn35mmFormat}`,icon:"tabler:telescope"}:null,_.exifData?.FNumber?{label:i("exif.aperture"),value:`f/${_.exifData.FNumber}`,icon:"tabler:aperture"}:null,_.exifData?.ExposureTime?{label:i("exif.exposure.time"),value:P(_.exifData.ExposureTime),icon:"tabler:clock"}:null,_.exifData?.ISO?{label:"ISO",value:_.exifData.ISO.toString(),icon:"tabler:sun-electricity"}:null]}],ie.deviceInfo=[{title:i("exif.sections.deviceInfomation"),items:[_.exifData?.Make&&_.exifData?.Model?{label:i("exif.camera"),value:kme(_.exifData.Make,_.exifData.Model),icon:"tabler:camera"}:null,_.exifData?.LensModel?{label:i("exif.lens"),value:Dme(_.exifData.LensMake,_.exifData.LensModel),icon:"tabler:focus"}:null,_.exifData?.MaxApertureValue?{label:i("exif.maxAperture"),value:`f/${_.exifData.MaxApertureValue}`,icon:"tabler:aperture"}:null,_.exifData?.FocalLength?{label:i("exif.focal.length.actual"),value:_.exifData.FocalLength,icon:"tabler:telescope"}:null,_.exifData?.FocalLengthIn35mmFormat?{label:i("exif.focal.length.equivalent"),value:_.exifData.FocalLengthIn35mmFormat,icon:"tabler:zoom-in-area"}:null]}],ie.captureMode=[{title:i("exif.sections.shooting.mode"),items:[_.exifData?.WhiteBalance?{label:i("exif.wb.title"),value:p("whiteBalance",_.exifData.WhiteBalance),icon:"mdi:white-balance-auto"}:null,_.exifData?.WBShiftAB?{label:i("exif.wb.shiftAB"),value:`${_.exifData.WBShiftAB}`,icon:"mdi:white-balance-auto"}:null,_.exifData?.WBShiftGM?{label:i("exif.wb.shiftGM"),value:`${_.exifData.WBShiftGM}`,icon:"mdi:white-balance-auto"}:null,_.exifData?.WhiteBalanceBias?{label:i("exif.wb.bias"),value:`${_.exifData.WhiteBalanceBias}`,icon:"mdi:white-balance-auto"}:null,_.exifData?.WhiteBalanceFineTune?{label:i("exif.wb.fineTune"),value:`${_.exifData.WhiteBalanceFineTune}`,icon:"mdi:white-balance-auto"}:null,_.exifData?.ExposureProgram?{label:i("exif.exposure.program"),value:p("exposureProgram",_.exifData.ExposureProgram),icon:"tabler:exposure"}:null,_.exifData?.ExposureMode?{label:i("exif.exposure.mode"),value:p("exposureMode",_.exifData.ExposureMode),icon:"tabler:exposure-filled"}:null,_.exifData?.MeteringMode?{label:i("exif.metering.title"),value:p("meteringMode",_.exifData.MeteringMode),icon:"tabler:focus-auto"}:null,_.exifData?.Flash?{label:i("exif.flash.title"),value:p("flash",_.exifData.Flash),icon:"material-symbols:flash-on-rounded"}:null,_.exifData?.FlashMeteringMode?{label:i("exif.flash.meteringMode"),value:p("meteringMode",_.exifData.FlashMeteringMode),icon:"material-symbols:flash-on-rounded"}:null,_.exifData?.SceneCaptureType?{label:i("exif.scene.captureType"),value:p("sceneCaptureType",_.exifData.SceneCaptureType),icon:"material-symbols:scene"}:null]}],ie.technicalParams=[{title:i("exif.sections.specification"),items:[_.exifData?.BrightnessValue?{label:i("exif.brightness.value"),value:`${_.exifData.BrightnessValue.toFixed(1)} EV`,icon:"tabler:sun"}:null,_.exifData?.SensingMethod?{label:i("exif.sensing.method"),value:p("sensingMethod",_.exifData.SensingMethod),icon:"tabler:photo-sensor"}:null,_.exifData?.FocalPlaneXResolution&&_.exifData?.FocalPlaneYResolution?{label:i("exif.focal.plane.resolution"),value:`${_.exifData.FocalPlaneXResolution.toFixed(2)} x ${_.exifData.FocalPlaneYResolution.toFixed(2)}`,icon:"tabler:photo-sensor"}:null]}],ie}),W=jM("(max-width: 768px)"),Y=ie=>{window.open(`/globe?photoId=${ie}`)},ae=ie=>{l.push({path:"/",query:{tag:ie}})},se=ie=>{window.open(`/albums/${ie}`)};return(ie,pe)=>{const ye=Sw,de=Kpe,Ee=ome,Pe=bme,Ze=Tme,We=Mme;return li(),En(ut(Gl).div,{initial:{opacity:0,x:ut(W)?0:80,y:ut(W)?20:0},animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:ut(W)?0:80,y:ut(W)?20:0},transition:{type:"spring",duration:.4,bounce:0,delay:.1},class:_s(["bg-black/20 dark:bg-black/30 backdrop-blur-xl border-white/10",{"fixed inset-x-2 bottom-2 max-h-[70vh] border rounded-xl z-50 flex flex-col":ut(W),"w-80 border-l":!ut(W)}])},{default:Jn(()=>[Bn("div",Fme,[Bn("h3",Bme,Lr(e.currentPhoto.title),1),ut(W)&&e.onClose?(li(),En(ye,{key:0,icon:"tabler:x",variant:"ghost",color:"neutral",class:"text-white",size:"sm",onClick:e.onClose},null,8,["onClick"])):gr("",!0)]),Bn("div",{class:_s(["p-4 space-y-4 flex-1 min-h-0",{"overflow-y-auto":ut(W),"overflow-y-auto max-h-full pb-16":!ut(W)}])},[e.currentPhoto.description?(li(),ir("div",Nme,Lr(e.currentPhoto.description),1)):gr("",!0),F.value?(li(),En(de,{key:1,photo:e.currentPhoto,latitude:F.value?.latitude,longitude:F.value?.longitude,class:"cursor-pointer",onClick:pe[0]||(pe[0]=je=>Y(e.currentPhoto.id))},null,8,["photo","latitude","longitude"])):gr("",!0),$.value.basicInfo?(li(),En(Ee,{key:2,data:$.value.basicInfo},null,8,["data"])):gr("",!0),e.currentPhoto.exif?.Rating?(li(),ir("div",Vme,[Bn("h4",jme,Lr(ut(i)("exif.sections.rating")),1),tr(Pe,{"model-value":e.currentPhoto.exif.Rating,readonly:"",size:"sm"},null,8,["model-value"])])):gr("",!0),t.value&&t.value.length>0?(li(),ir("div",Ume,[Bn("h4",$me,Lr(ut(i)("exif.sections.albums")),1),Bn("div",Gme,[(li(!0),ir(qs,null,Eu(t.value,je=>(li(),ir("div",{key:je.id,class:"p-3 bg-white/5 border border-white/10 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",onClick:Ye=>se(je.id)},[Bn("p",Hme,Lr(je.title),1),je.description?(li(),ir("p",Wme,Lr(je.description),1)):gr("",!0)],8,qme))),128))])])):gr("",!0),e.currentPhoto.tags&&e.currentPhoto.tags.length>0?(li(),ir("div",Zme,[Bn("h4",Xme,Lr(ut(i)("exif.sections.tags")),1),Bn("div",Yme,[(li(!0),ir(qs,null,Eu(e.currentPhoto.tags,je=>(li(),En(Ze,{key:je,label:je,variant:"soft",size:"sm",color:"neutral",class:"bg-white/10 text-white cursor-pointer select-none hover:bg-white/20 transition-colors",onClick:Ye=>ae(je)},null,8,["label","onClick"]))),128))])])):gr("",!0),$.value.captureParams?(li(),En(Ee,{key:6,data:$.value.captureParams},null,8,["data"])):gr("",!0),Bn("div",Kme,[Bn("h4",Jme,Lr(ut(i)("exif.sections.histogram")),1),e.currentPhoto.thumbnailUrl?(li(),En(We,{key:0,"thumbnail-url":e.currentPhoto.thumbnailUrl},null,8,["thumbnail-url"])):gr("",!0)]),$.value.deviceInfo?(li(),En(Ee,{key:7,data:$.value.deviceInfo},null,8,["data"])):gr("",!0),$.value.captureMode?(li(),En(Ee,{key:8,data:$.value.captureMode},null,8,["data"])):gr("",!0),$.value.technicalParams?(li(),En(Ee,{key:9,data:$.value.technicalParams},null,8,["data"])):gr("",!0)],2)]),_:1},8,["initial","exit","class"])}}}),zF=Object.assign(d0(Qme,[["__scopeId","data-v-f609c203"]]),{__name:"PhotoInfoPanel"}),ege={class:"bg-white/90 dark:bg-neutral-800/90 backdrop-blur-xl rounded-2xl border border-neutral-200/50 dark:border-white/10 shadow-2xl shadow-black/10 dark:shadow-black/30 p-3"},tge={class:"grid grid-cols-4 gap-2 min-w-[220px]"},ige=kr({__name:"ReactionPicker",props:{isOpen:{type:Boolean},selectedReaction:{},reactionCounts:{}},emits:["select","close"],setup(e,{emit:i}){const{t:s}=h0(),l=e,p=i,_=an(null);kie(_,()=>{l.isOpen&&p("close")});const b=Ei(()=>[{id:"like",iconName:"fluent-emoji-flat:thumbs-up",label:s("viewer.reaction.like"),count:l.reactionCounts?.like||0},{id:"love",iconName:"fluent-emoji-flat:red-heart",label:s("viewer.reaction.love"),count:l.reactionCounts?.love||0},{id:"amazing",iconName:"fluent-emoji-flat:smiling-face-with-heart-eyes",label:s("viewer.reaction.amazing"),count:l.reactionCounts?.amazing||0},{id:"funny",iconName:"fluent-emoji-flat:face-with-tears-of-joy",label:s("viewer.reaction.funny"),count:l.reactionCounts?.funny||0},{id:"wow",iconName:"fluent-emoji-flat:face-with-open-mouth",label:s("viewer.reaction.wow"),count:l.reactionCounts?.wow||0},{id:"sad",iconName:"fluent-emoji-flat:crying-face",label:s("viewer.reaction.sad"),count:l.reactionCounts?.sad||0},{id:"fire",iconName:"fluent-emoji-flat:fire",label:s("viewer.reaction.fire"),count:l.reactionCounts?.fire||0},{id:"sparkle",iconName:"fluent-emoji-flat:sparkles",label:s("viewer.reaction.sparkle"),count:l.reactionCounts?.sparkle||0}]),t=O=>!O||O===0?"":O>=1e3?`${(O/1e3).toFixed(1)}k`:O.toString(),P=O=>{const F=b.value.find($=>$.id===O);F&&p("select",O,F.iconName)};return(O,F)=>{const $=Wd;return li(),En(ut(ym),null,{default:Jn(()=>[e.isOpen?(li(),En(ut(Gl).div,{key:0,ref_key:"pickerRef",ref:_,initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{type:"spring",stiffness:400,damping:25,mass:.8},class:"absolute bottom-full right-0 mb-2 z-30",onClick:F[0]||(F[0]=Sm(()=>{},["stop"]))},{default:Jn(()=>[Bn("div",ege,[Bn("div",tge,[(li(!0),ir(qs,null,Eu(ut(b),W=>(li(),En(ut(Gl).button,{key:W.id,type:"button",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",stiffness:500,damping:20,delay:ut(b).indexOf(W)*.03}},"while-hover":{scale:1.2,transition:{type:"spring",stiffness:500,damping:20}},"while-tap":{scale:.9,transition:{type:"spring",stiffness:500,damping:20}},class:_s(["relative aspect-square w-full min-w-[48px] rounded-xl flex items-center justify-center transition-colors cursor-pointer shrink-0 group","hover:bg-neutral-100/80 dark:hover:bg-white/10","active:bg-neutral-200/80 dark:active:bg-white/20",e.selectedReaction===W.id?"bg-blue-100 dark:bg-blue-500/20 ring-2 ring-blue-500/50":"bg-transparent"]),title:W.label,onClick:Y=>P(W.id)},{default:Jn(()=>[tr($,{name:W.iconName,class:"text-[28px] select-none",mode:"svg"},null,8,["name"]),W.count!==void 0&&W.count>0?(li(),En(ut(Gl).span,{key:0,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},class:_s(["absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1","flex items-center justify-center","text-[9px] font-bold leading-none","rounded-full","shadow-sm",e.selectedReaction===W.id?"bg-blue-500 text-white":"bg-gradient-to-br from-neutral-100 to-neutral-200 dark:from-neutral-700 dark:to-neutral-600 text-neutral-700 dark:text-neutral-100","border border-white/50 dark:border-neutral-800/50","group-hover:scale-110 transition-transform duration-150"])},{default:Jn(()=>[Gd(Lr(t(W.count)),1)]),_:2},1032,["class"])):gr("",!0)]),_:2},1032,["animate","class","title","onClick"]))),128))])])]),_:1},512)):gr("",!0)]),_:1})}}}),nge=Object.assign(ige,{__name:"PhotoReactionPicker"}),rge={class:"absolute inset-0 pointer-events-none overflow-visible flex items-center justify-center z-[9999]"},sge=kr({__name:"ReactionConfetti",props:{iconName:{},triggerCount:{}},setup(e){const i=e,s=Ei(()=>{if(i.triggerCount===0)return[];const p=18,_=[];for(let b=0;b<p;b++){const t=360/p*b,P=80+Math.random()*40,O=Math.random()*.15,F=1.2+Math.random()*.4,$=Math.random()*360-180,W=.7+Math.random()*.3;_.push({id:i.triggerCount*100+b,angle:t,distance:P,delay:O,duration:F,rotation:$,scale:W})}return _}),l=(p,_)=>{const b=p*Math.PI/180;return{x:Math.cos(b)*_,y:Math.sin(b)*_}};return(p,_)=>{const b=Wd;return li(),ir("div",rge,[(li(!0),ir(qs,null,Eu(ut(s),t=>(li(),En(ut(Gl).div,{key:t.id,initial:{x:0,y:0,scale:0,opacity:1,rotate:0},animate:{x:l(t.angle,t.distance).x,y:l(t.angle,t.distance).y,scale:[0,t.scale*1.1,t.scale,0],opacity:[0,1,1,0],rotate:t.rotation,transition:{duration:t.duration,delay:t.delay,ease:[.25,.46,.45,.94]}},class:"absolute z-[9999]",style:{"transform-origin":"center"}},{default:Jn(()=>[tr(b,{name:e.iconName,class:"text-[24px]",mode:"svg"},null,8,["name"])]),_:1},8,["animate"]))),128))])}}}),oge=Object.assign(sge,{__name:"PhotoReactionConfetti"}),OF=globalThis.setInterval,tu=an(new Map),age=()=>{const e=async(P,O)=>{const F=tu.value.get(O);if(F){const ae=Date.now(),se=1440*60*1e3;if(F.mp4Blob&&F.lastProcessed&&ae-F.lastProcessed<se)return F.mp4Blob;if(F.isProcessing)return new Promise(ie=>{const pe=setTimeout(()=>{ie(null)},3e4),ye=OF(()=>{const de=tu.value.get(O);de&&!de.isProcessing&&(clearInterval(ye),clearTimeout(pe),ie(de.mp4Blob))},100)})}const $=3,W=F?.retryCount||0;if(W>=$)return console.warn(`Max retries reached for LivePhoto ${O}`),null;const Y={isProcessing:!0,progress:0,mp4Blob:null,error:null,retryCount:W,lastProcessed:Date.now()};tu.value.set(O,Y);try{const ae=ct=>{Y.progress=ct,tu.value.set(O,{...Y})};ae(10);const se=new AbortController,ie=setTimeout(()=>se.abort(),3e4),pe=await fetch(P,{signal:se.signal,headers:{"Cache-Control":"max-age=3600"}});if(clearTimeout(ie),!pe.ok)throw new Error(`Failed to fetch MOV file: ${pe.status} ${pe.statusText}`);ae(30);const ye=pe.body?.getReader();if(!ye)throw new Error("Failed to get response reader");const de=[],Ee=parseInt(pe.headers.get("content-length")||"0");let Pe=0;for(;;){const{done:ct,value:Lt}=await ye.read();if(ct)break;if(de.push(Lt),Pe+=Lt.length,Ee>0){const Ht=30+Pe/Ee*40;ae(Math.round(Ht))}}const Ze=new Blob(de);ae(70);const We=new Blob([Ze],{type:"video/mp4"});ae(85);const je=URL.createObjectURL(We),Ye=document.createElement("video");return await new Promise((ct,Lt)=>{const Ht=setTimeout(()=>{Lt(new Error("Video validation timeout"))},5e3);Ye.onloadedmetadata=()=>{clearTimeout(Ht),ct()},Ye.onerror=()=>{clearTimeout(Ht),Lt(new Error("Video format not supported"))},Ye.src=je,Ye.load()}),URL.revokeObjectURL(je),ae(95),Y.isProcessing=!1,Y.progress=100,Y.mp4Blob=We,Y.lastProcessed=Date.now(),Y.error=null,tu.value.set(O,{...Y}),We}catch(ae){const se=ae instanceof Error?ae.message:"Unknown error";if(W<$-1){console.warn(`LivePhoto processing failed (attempt ${W+1}/${$}), retrying...`,se),Y.retryCount=W+1,Y.isProcessing=!1,Y.error=`Retrying... (${W+1}/${$})`,tu.value.set(O,{...Y});const ie=Math.min(1e3*Math.pow(2,W),5e3);return await new Promise(pe=>setTimeout(pe,ie)),e(P,O)}return Y.isProcessing=!1,Y.error=se,Y.lastProcessed=Date.now(),tu.value.set(O,{...Y}),console.error(`Failed to convert MOV to MP4 after ${$} attempts:`,ae),null}},i=P=>Ei(()=>tu.value.get(P)||null),s=async(P,O={})=>{const{maxConcurrent:F=2,prioritizeVisible:$=!0,prefetchDistance:W=3}=O,Y=P.filter(ae=>ae.livePhotoVideoUrl);if($){const ae=Y.filter(ie=>ie.isVisible),se=Y.filter(ie=>!ie.isVisible).slice(0,W);ae.length>0&&await l(ae,F),se.length>0&&l(se,Math.min(F,1))}else await l(Y,F)},l=async(P,O)=>{for(let F=0;F<P.length;F+=O){const $=P.slice(F,F+O);await Promise.allSettled($.map(W=>e(W.livePhotoVideoUrl,W.id))),F+O<P.length&&await new Promise(W=>setTimeout(W,100))}},p=async P=>{await s(P,{maxConcurrent:3})},_=()=>{const P=Date.now(),O=1440*60*1e3,F=50,$=Array.from(tu.value.entries()),W=[];$.forEach(([Y,ae])=>{ae.lastProcessed&&P-ae.lastProcessed>O&&W.push(Y)}),W.forEach(Y=>{const ae=tu.value.get(Y);ae?.mp4Blob&&(ae.mp4Blob=null),tu.value.delete(Y)}),tu.value.size>F&&$.filter(([se])=>!W.includes(se)).sort((se,ie)=>(se[1].lastProcessed||0)-(ie[1].lastProcessed||0)).slice(0,tu.value.size-F).forEach(([se,ie])=>{ie.mp4Blob&&(ie.mp4Blob=null),tu.value.delete(se)}),console.log(`Cleaned up ${W.length} expired LivePhoto cache entries`)},b=()=>{const P=tu.value.size;let O=0,F=0,$=0,W=0;return tu.value.forEach(Y=>{Y.mp4Blob?(O++,W+=Y.mp4Blob.size):Y.isProcessing?F++:Y.error&&$++}),{total:P,processed:O,processing:F,failed:$,totalSizeMB:Math.round(W/1048576*100)/100}},t=()=>{tu.value.forEach(P=>{P.mp4Blob&&(P.mp4Blob=null)}),tu.value.clear(),console.log("All LivePhoto cache cleared")};return typeof window<"u"&&OF(_,600*1e3),{convertMovToMp4:e,getProcessingState:i,batchProcessLivePhotos:p,preloadLivePhotosInViewport:s,cleanupExpiredCache:_,getCacheStats:b,clearProcessedCache:t,processedLivePhotos:Pp(tu)}},lge={class:"z-10 flex min-h-0 min-w-0 flex-1 flex-col"},cge={class:"group relative flex min-h-0 min-w-0 flex-1"},uge={class:"flex items-center gap-1"},hge={class:"flex items-center gap-2"},dge={class:"text-white font-medium"},fge={key:0},pge={key:1},mge={key:2},gge={class:"relative"},_ge={class:"flex flex-col items-start gap-0.5"},yge={class:"text-sm font-medium leading-none"},vge={key:0,class:"text-[10px] leading-none opacity-70"},xge=kr({__name:"Viewer",props:{photos:{},currentIndex:{},isOpen:{type:Boolean}},emits:["close","indexChange"],setup(e,{emit:i}){const s=e,l=i,p=mk(),_=an(),b=an(),t=an(),P=an(!1),O=an(!1),F=an(!1),$=an(null),W=an(0),Y=an(!1),ae=an(null),se=an(!1),ie=an(null),pe=an({}),ye=an(!1),de=an(null),Ee=an(0),Pe={like:"fluent-emoji-flat:thumbs-up",love:"fluent-emoji-flat:red-heart",amazing:"fluent-emoji-flat:smiling-face-with-heart-eyes",funny:"fluent-emoji-flat:face-with-tears-of-joy",wow:"fluent-emoji-flat:face-with-open-mouth",sad:"fluent-emoji-flat:crying-face",fire:"fluent-emoji-flat:fire",sparkle:"fluent-emoji-flat:sparkles"},Ze=Ei(()=>ie.value?Pe[ie.value]:null),We=Ei(()=>Object.values(pe.value).reduce((Hi,Bt)=>Hi+Bt,0)),je=async Hi=>{try{const Bt=await $fetch(`/api/photos/${Hi}/reactions`);ie.value=Bt.userReaction||null,pe.value=Bt.reactions||{}}catch(Bt){console.error("Failed to load reactions:",Bt)}},Ye=an(!1),ct=an(!1),Lt=an(!1),Ht=an(!0),ci=an(0),Wt=an(null),$t=an(null),Dt=Iae(),Ft=an(null),{convertMovToMp4:vt,getProcessingState:wi}=age(),Qi=Ei(()=>s.photos[s.currentIndex]),wn=jM("(max-width: 768px)"),qn=Ei(()=>Qi.value?wi(Qi.value.id):an(null));Qn(()=>s.isOpen,Hi=>{Hi?(document.body.style.overflow="hidden",Da(()=>{gn()})):(P.value=!1,O.value=!1,F.value=!1,$.value=null,W.value=0,Y.value=!1,se.value=!1,ie.value=null,de.value=null,Ee.value=0,Ye.value=!1,ct.value=!1,Lt.value=!1,ci.value=0,Ft.value&&(clearTimeout(Ft.value),Ft.value=null),$t.value&&(URL.revokeObjectURL($t.value),$t.value=null),Wt.value=null,ae.value&&(clearTimeout(ae.value),ae.value=null),document.body.style.overflow="")},{immediate:!0}),Qn(()=>s.currentIndex,Hi=>{b.value&&b.value.activeIndex!==Hi&&b.value.slideTo(Hi,300),P.value=!1,W.value=0,se.value=!1,ie.value=null,ct.value=!1,Ye.value=!1,Lt.value=!1,ci.value=0,Ft.value&&(clearTimeout(Ft.value),Ft.value=null),Da(()=>{gn()})}),Qn(P,Hi=>{b.value&&(b.value.allowTouchMove=!Hi)});const Fn=()=>{s.currentIndex>0&&(l("indexChange",s.currentIndex-1),b.value?.slidePrev())},mr=()=>{s.currentIndex<s.photos.length-1&&(l("indexChange",s.currentIndex+1),b.value?.slideNext())},Sr=Hi=>{b.value=Hi,Hi.allowTouchMove=!P.value},Hr=Hi=>{l("indexChange",Hi.activeIndex)},ti=(Hi,Bt)=>{P.value=Hi,Bt!==void 0&&(W.value=Bt,Y.value=!0,ae.value&&clearTimeout(ae.value),ae.value=setTimeout(()=>{Y.value=!1,ae.value=null},2e3))},sn=Hi=>{$.value=Hi},Gi=()=>{Y.value=!0,ae.value&&clearTimeout(ae.value),ae.value=setTimeout(()=>{Y.value=!1,ae.value=null},2e3)},gn=async()=>{const Hi=Qi.value;if(!(!Hi||!Hi.isLivePhoto||!Hi.livePhotoVideoUrl))try{const Bt=await vt(Hi.livePhotoVideoUrl,Hi.id);Bt&&(Wt.value=Bt,$t.value&&URL.revokeObjectURL($t.value),$t.value=URL.createObjectURL(Bt))}catch(Bt){console.error("Failed to process LivePhoto in viewer:",Bt)}},nr=()=>{!Dt.value||!$t.value||(Dt.value.currentTime=0,ct.value=!0,wn.value&&"vibrate"in navigator&&navigator.vibrate(50),Dt.value?.play().catch(Hi=>{console.warn("Failed to play LivePhoto video in viewer:",Hi),ct.value=!1}))},Ur=()=>{const Hi=ct.value;Dt.value&&!Dt.value.paused&&(Dt.value?.pause(),Dt.value.currentTime=0,wn.value&&Hi&&"vibrate"in navigator&&navigator.vibrate(25)),ct.value=!1},St=()=>{!wn.value&&Qi.value?.isLivePhoto&&$t.value&&(Ye.value=!0,nr())},Gt=()=>{wn.value||(Ye.value=!1,Ur())},Ai=Hi=>{if(wn.value&&Qi.value?.isLivePhoto&&$t.value&&(ci.value=Hi.touches.length,Hi.touches.length===1)){const Bt=Hi.target;Bt.closest("button")||Bt.closest('[role="button"]')||Bt.classList.contains("pointer-events-auto")||(Hi.preventDefault(),Lt.value=!0,Ft.value=setTimeout(()=>{Lt.value&&ci.value===1&&!P.value&&nr()},350))}},hn=()=>{wn.value&&(ci.value=0,Lt.value=!1,Ft.value&&(clearTimeout(Ft.value),Ft.value=null),Ur())},Ui=Hi=>{wn.value&&Lt.value&&(ci.value=Hi.touches.length,Hi.touches.length>1&&(Lt.value=!1,Ft.value&&(clearTimeout(Ft.value),Ft.value=null),Ur()))},pt=()=>{wn.value&&"vibrate"in navigator&&navigator.vibrate(30),Dt.value&&(Dt.value.currentTime=0)},Ot=hI(()=>{de.value=null},1600),vi=async(Hi,Bt)=>{if(Qi.value){ye.value=!0;try{if(ie.value===Hi)await $fetch(`/api/photos/${Qi.value.id}/reactions`,{method:"DELETE"}),ie.value=null,pe.value[Hi]&&pe.value[Hi]--;else{const Ii=ie.value;Ii&&pe.value[Ii]!==void 0&&pe.value[Ii]--,await $fetch(`/api/photos/${Qi.value.id}/reactions`,{method:"POST",body:{reactionType:Hi}}),ie.value=Hi,pe.value[Hi]=(pe.value[Hi]||0)+1,de.value=Bt,Ee.value++,Ot()}}catch(Ii){console.error("Failed to update reaction:",Ii),Ii?.statusCode===429?p.add({icon:"tabler:alert-circle",title:"",description:"",color:"warning"}):p.add({icon:"tabler:alert-circle",title:"",description:Ii instanceof Error?Ii.message:"",color:"warning"})}finally{ye.value=!1}se.value=!1}},qi=()=>{se.value=!se.value};Qn(()=>Qi.value?.id,Hi=>{Hi&&je(Hi)},{immediate:!0}),hj({escape:()=>{l("close")}}),ru(()=>{ae.value&&(clearTimeout(ae.value),ae.value=null),Ft.value&&(clearTimeout(Ft.value),Ft.value=null),$t.value&&(URL.revokeObjectURL($t.value),$t.value=null)});const on=[_de,mde,pde];return(Hi,Bt)=>{const Ii=RM,qt=Pae,Ne=Wd,Ge=kae,Ke=Nue;return li(),En(UE,{to:"body"},[tr(ut(ym),null,{default:Jn(()=>[e.isOpen?(li(),En(ut(Gl).div,{key:0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},class:"fixed inset-0 bg-white/50 dark:bg-black/50 backdrop-blur-2xl z-50",onClick:Bt[0]||(Bt[0]=At=>l("close"))})):gr("",!0)]),_:1}),tr(ut(ym),{mode:"sync"},{default:Jn(()=>[e.isOpen&&ut(Qi)?.thumbnailHash?(li(),En(ut(Gl).div,{key:ut(Qi).id,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},class:"fixed inset-0 z-40"},{default:Jn(()=>[tr(Ii,{thumbhash:ut(Qi).thumbnailHash,class:"w-full h-full scale-110"},null,8,["thumbhash"])]),_:1})):gr("",!0)]),_:1}),tr(ut(ym),null,{default:Jn(()=>[e.isOpen?(li(),En(ut(Gl).div,{key:0,ref_key:"containerRef",ref:_,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},class:"fixed inset-0 z-50 flex items-center justify-center",style:Su({touchAction:ut(wn)?"manipulation":"none"}),onClick:Bt[9]||(Bt[9]=Sm(At=>l("close"),["self"]))},{default:Jn(()=>[Bn("div",{class:_s(["flex w-full h-full",ut(wn)?"flex-col":"flex-row"])},[Bn("div",lge,[Bn("div",cge,[tr(ut(Gl).div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},class:_s(["absolute z-30 flex items-center justify-between",ut(wn)?"top-2 right-2 left-2":"top-4 right-4 left-4"])},{default:Jn(()=>[Bn("div",uge,[ut(Qi)?.isLivePhoto?(li(),En(qt,{key:0,class:_s(ut(wn)?"cursor-default":"cursor-pointer"),photo:ut(Qi),"is-video-playing":ut(ct),"processing-state":ut(qn)?.value||null,onMouseenter:St,onMouseleave:Gt},null,8,["class","photo","is-video-playing","processing-state"])):gr("",!0),ut(Qi)?.isLivePhoto?(li(),ir("div",{key:1,class:_s(["pointer-events-auto backdrop-blur-md bg-black/40 text-white rounded-full p-1 text-[13px] font-bold flex items-center gap-0.5 leading-0 select-none",ut(wn)?"cursor-default":"cursor-pointer"]),onClick:Bt[1]||(Bt[1]=At=>Ht.value=!ut(Ht))},[tr(Ne,{name:ut(Ht)?"tabler:volume-off":"tabler:volume",class:"size-[17px]"},null,8,["name"])],2)):gr("",!0)]),Bn("div",hge,[ut(wn)?(li(),En(Ge,{key:0,icon:"tabler:info-circle",class:_s(ut(O)?"bg-black/20 hover:bg-black/30 text-white":""),size:"sm",rounded:"",onClick:Bt[2]||(Bt[2]=At=>O.value=!ut(O))},null,8,["class"])):gr("",!0),tr(Ge,{icon:"tabler:share-3",size:"sm",rounded:"",onClick:Bt[3]||(Bt[3]=At=>F.value=!0)}),tr(Ge,{icon:"tabler:x",size:"sm",rounded:"",onClick:Bt[4]||(Bt[4]=At=>l("close"))})])]),_:1},8,["class"]),tr(kde,{ref_key:"loadingIndicatorRef",ref:t},null,512),tr(ut(dde),{modules:on,"space-between":0,"slides-per-view":1,"initial-slide":e.currentIndex,virtual:!0,keyboard:{enabled:!0,onlyInViewport:!0},class:"h-full w-full",style:Su({touchAction:ut(wn)?"pan-x":"pan-y"}),onSwiper:Sr,onSlideChange:Hr},{default:Jn(()=>[(li(!0),ir(qs,null,Eu(e.photos,(At,jt)=>(li(),En(ut(fde),{key:At.id,"virtual-index":jt,class:"flex items-center justify-center"},{default:Jn(()=>[tr(ut(Gl).div,{initial:{opacity:.5,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{type:"spring",duration:.4,bounce:0},class:"relative flex h-full w-full items-center justify-center",style:{"user-select":"none","-webkit-user-select":"none","-webkit-touch-callout":"none","-webkit-tap-highlight-color":"transparent"},onTouchstart:Ai,onTouchmove:Ui,onTouchend:hn,onTouchcancel:hn,onContextmenu:Bt[7]||(Bt[7]=Sm(()=>{},["prevent"]))},{default:Jn(()=>[tr(Mfe,{class:_s(["h-full w-full object-contain transition-opacity duration-400",{"opacity-0":ut(ct)&&ut(Qi)?.isLivePhoto}]),"loading-indicator-ref":ut(t)||null,"is-current-image":jt===e.currentIndex,src:At.originalUrl,"thumbnail-src":At.thumbnailUrl,thumbhash:At.thumbnailHash,alt:At.title||"",width:jt===e.currentIndex?ut(Qi)?.width??void 0:void 0,height:jt===e.currentIndex?ut(Qi)?.height??void 0:void 0,"enable-pan":jt===e.currentIndex?!ut(wn)||ut(P):!0,"enable-zoom":!0,"on-zoom-change":jt===e.currentIndex?ti:void 0,"on-blob-src-change":jt===e.currentIndex?sn:void 0,"on-image-loaded":jt===e.currentIndex?Gi:void 0,"is-live-photo":At.isLivePhoto===1,"live-photo-video-url":At.livePhotoVideoUrl||void 0},null,8,["class","loading-indicator-ref","is-current-image","src","thumbnail-src","thumbhash","alt","width","height","enable-pan","on-zoom-change","on-blob-src-change","on-image-loaded","is-live-photo","live-photo-video-url"]),At.isLivePhoto&&jt===e.currentIndex&&ut($t)?(li(),En(ut(Gl).video,{key:0,ref_for:!0,ref:bi=>{jt===e.currentIndex&&(Dt.value=bi)},src:ut($t),class:"absolute inset-0 w-full h-full object-contain pointer-events-none select-none touch-none",muted:ut(Ht),playsinline:"",preload:"metadata",initial:{opacity:0},animate:{opacity:ut(ct)?1:0},transition:{duration:.4,ease:[.25,.1,.25,1],delay:ut(ct)?.1:0},onEnded:pt,onContextmenu:Bt[5]||(Bt[5]=Sm(()=>{},["prevent"]))},null,8,["src","muted","animate","transition"])):gr("",!0),tr(ut(ym),null,{default:Jn(()=>[ut(Y)&&ut(W)>0?(li(),En(ut(Gl).div,{key:0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},class:"absolute bottom-4 left-4 z-20 bg-black/40 backdrop-blur-3xl rounded-xl border border-white/10 px-4 py-2 shadow-2xl"},{default:Jn(()=>[Bn("span",dge,Lr(ut(W))+"x",1)]),_:1})):gr("",!0)]),_:1}),tr(ut(ym),null,{default:Jn(()=>[!ut(P)&&!ut(ct)?(li(),En(ut(Gl).div,{key:0,initial:{opacity:0,scale:.95},animate:{opacity:.6,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},class:"absolute bottom-6 left-1/2 z-20 -translate-x-1/2 bg-black/50 rounded-lg border border-white/10 px-2 py-1 shadow-2xl text-white text-xs font-bold"},{default:Jn(()=>[ut(Qi)?.isLivePhoto&&ut(wn)?(li(),ir("span",fge,Lr(Hi.$t("viewer.hint.livePhoto.mobile")),1)):ut(Qi)?.isLivePhoto&&!ut(wn)?(li(),ir("span",pge,Lr(Hi.$t("viewer.hint.livePhoto.desktop")),1)):(li(),ir("span",mge,Lr(ut(wn)?Hi.$t("viewer.hint.mobile"):Hi.$t("viewer.hint.desktop")),1))]),_:1})):gr("",!0)]),_:1}),tr(ut(ym),null,{default:Jn(()=>[!ut(P)&&!ut(ct)?(li(),En(ut(Gl).div,{key:0,initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},transition:{type:"spring",stiffness:300,damping:20,delay:.1},class:"absolute bottom-4 right-4 z-20"},{default:Jn(()=>[Bn("div",gge,[tr(nge,{"is-open":ut(se),"selected-reaction":ut(ie),"reaction-counts":ut(pe),onSelect:vi,onClose:Bt[6]||(Bt[6]=bi=>se.value=!1)},null,8,["is-open","selected-reaction","reaction-counts"]),ut(de)?(li(),En(oge,{key:0,"icon-name":ut(de),"trigger-count":ut(Ee)},null,8,["icon-name","trigger-count"])):gr("",!0),tr(ut(Gl).button,{type:"button",initial:{scale:.8,opacity:0},animate:{scale:ut(se)?.92:1,opacity:1,transition:ut(se)?{duration:.2,ease:[.25,.1,.25,1]}:{type:"spring",stiffness:300,damping:25,mass:.8}},"while-hover":{scale:ut(se)?.95:1.05},"while-tap":{scale:.88},class:_s(["pointer-events-auto flex items-center justify-center gap-2 cursor-pointer","px-4 h-11 rounded-full","backdrop-blur-xl border shadow-lg","transition-all duration-200",ut(ie)?"bg-blue-500/90 border-blue-400/50 text-white shadow-blue-500/30":"bg-white/90 dark:bg-neutral-800/90 border-neutral-200/50 dark:border-white/10 text-neutral-700 dark:text-white/80 shadow-black/10 dark:shadow-black/30","hover:shadow-xl"]),onClick:qi},{default:Jn(()=>[ut(ie)&&ut(Ze)?(li(),En(Ne,{key:0,name:ut(Ze),class:"text-xl leading-none select-none"},null,8,["name"])):(li(),En(Ne,{key:1,name:"tabler:mood-smile",class:"text-xl"})),Bn("div",_ge,[Bn("span",yge,Lr(ut(ie)?Hi.$t("viewer.reaction.change"):Hi.$t("viewer.reaction.add")),1),ut(We)>0?(li(),ir("span",vge,Lr(Hi.$t("viewer.reaction.count",{count:ut(We)},ut(We))),1)):gr("",!0)])]),_:1},8,["animate","while-hover","class"])])]),_:1})):gr("",!0)]),_:1})]),_:2},1024)]),_:2},1032,["virtual-index"]))),128))]),_:1},8,["initial-slide","style"]),ut(wn)?gr("",!0):(li(),ir(qs,{key:0},[e.currentIndex>0?(li(),ir("button",{key:0,type:"button",class:"absolute top-1/2 left-4 z-20 flex size-8 -translate-y-1/2 items-center justify-center rounded-full text-white opacity-0 backdrop-blur-sm duration-200 group-hover:opacity-100 bg-black/30 hover:bg-black/40",onClick:Fn},[tr(Ne,{name:"tabler:chevron-left",class:"text-xl cursor-pointer"})])):gr("",!0),e.currentIndex<e.photos.length-1?(li(),ir("button",{key:1,type:"button",class:"absolute top-1/2 right-4 z-20 flex size-8 -translate-y-1/2 items-center justify-center rounded-full text-white opacity-0 backdrop-blur-sm duration-200 group-hover:opacity-100 bg-black/30 hover:bg-black/40",onClick:mr},[tr(Ne,{name:"tabler:chevron-right",class:"text-xl cursor-pointer"})])):gr("",!0)],64))]),tr(zfe,{"current-index":e.currentIndex,photos:e.photos,onIndexChange:Bt[8]||(Bt[8]=At=>l("indexChange",At))},null,8,["current-index","photos"])]),ut(wn)?(li(),En(ut(ym),{key:0},{default:Jn(()=>[ut(O)&&ut(Qi)?(li(),En(zF,{key:0,"current-photo":ut(Qi),"exif-data":ut(Qi)?.exif,"on-close":()=>O.value=!1},null,8,["current-photo","exif-data","on-close"])):gr("",!0)]),_:1})):ut(Qi)?(li(),En(zF,{key:1,"current-photo":ut(Qi),"exif-data":ut(Qi)?.exif},null,8,["current-photo","exif-data"])):gr("",!0)],2)]),_:1},8,["style"])):gr("",!0)]),_:1}),ut(Qi)?(li(),En(Ke,{key:0,"is-open":ut(F),photo:ut(Qi),onClose:Bt[10]||(Bt[10]=At=>F.value=!1)},null,8,["is-open","photo"])):gr("",!0)])}}}),bge=Object.assign(d0(xge,[["__scopeId","data-v-3a8c3532"]]),{__name:"PhotoViewer"}),Rj=Symbol("PhotosContext");function wge(e,i,s){const l={photos:e,status:i,refresh:s,getPhotoById:p=>e.value.find(_=>_.id===p),filterPhotos:p=>e.value.filter(p),totalCount:Ei(()=>e.value.length)};return Ka(Rj,l),l}function Z_e(){const e=Fo(Rj);if(!e)throw new Error("usePhotos must be used within a PhotosProvider");return e}const Tge=kr({__name:"PhotosProvider",props:{photos:{},refresh:{type:Function},status:{}},setup(e){const i=e,s=Nc(i,"photos"),l=Nc(i,"status"),p=i.refresh;return wge(s,l,p),(_,b)=>Rs(_.$slots,"default")}}),Sge=Object.assign(Tge,{__name:"PhotosProvider"});function Ege(e){return(i,s)=>Ige(i,s,ut(e))}function Ige(e,i,s){return Hx(s,`messages.${e}`,e).replace(/\{(\w+)\}/g,(p,_)=>`${i?.[_]??`{${_}}`}`)}function Cge(e){const i=Ei(()=>ut(e).name),s=Ei(()=>ut(e).code),l=Ei(()=>ut(e).dir),p=Wo(e)?e:an(e);return{lang:i,code:s,dir:l,locale:p,t:Ege(e)}}function Age(e){return a0(e,{dir:"ltr"})}const FF=Age({name:"English",code:"en",messages:{alert:{close:"Close"},authForm:{hidePassword:"Hide password",showPassword:"Show password",submit:"Continue"},banner:{close:"Close"},calendar:{nextMonth:"Next month",nextYear:"Next year",prevMonth:"Previous month",prevYear:"Previous year"},carousel:{dots:"Choose slide to display",goto:"Go to slide {slide}",next:"Next",prev:"Prev"},chatPrompt:{placeholder:"Type your message here"},chatPromptSubmit:{label:"Send prompt"},colorMode:{dark:"Dark",light:"Light",switchToDark:"Switch to dark mode",switchToLight:"Switch to light mode",system:"System"},commandPalette:{back:"Back",close:"Close",noData:"No data",noMatch:"No matching data",placeholder:"Type a command or search"},contentSearch:{links:"Links",theme:"Theme"},contentSearchButton:{label:"Search"},contentToc:{title:"On this page"},dashboardSearch:{theme:"Theme"},dashboardSearchButton:{label:"Search"},dashboardSidebarCollapse:{collapse:"Collapse sidebar",expand:"Expand sidebar"},dashboardSidebarToggle:{close:"Close sidebar",open:"Open sidebar"},error:{clear:"Back to home"},fileUpload:{removeFile:"Remove {filename}"},header:{close:"Close menu",open:"Open menu"},inputMenu:{create:'Create "{label}"',noData:"No data",noMatch:"No matching data"},inputNumber:{decrement:"Decrement",increment:"Increment"},modal:{close:"Close"},pricingTable:{caption:"Pricing plan comparison"},prose:{codeCollapse:{closeText:"Collapse",name:"code",openText:"Expand"},collapsible:{closeText:"Hide",name:"properties",openText:"Show"},pre:{copy:"Copy code to clipboard"}},selectMenu:{create:'Create "{label}"',noData:"No data",noMatch:"No matching data",search:"Search"},slideover:{close:"Close"},table:{noData:"No data"},toast:{close:"Close"}}}),zj=Symbol.for("nuxt-ui.locale-context"),Pge=e=>{const i=e||Nc(Fo(zj,FF));return Cge(Ei(()=>i.value||FF))},Oj=VM(Pge),Fj=Symbol("nuxt-ui.portal-target");function Mge(e){const i=Fo(Fj,void 0),s=Ei(()=>e.value===!0?i?.value:e.value),l=Ei(()=>typeof s.value=="boolean"?!s.value:!1),p=Ei(()=>typeof s.value=="boolean"?"body":s.value);return Ei(()=>({to:p.value,disabled:l.value}))}const kge={slots:{root:"gap-2",base:"relative overflow-hidden rounded-full bg-accented",indicator:"rounded-full size-full transition-transform duration-200 ease-out",status:"flex text-dimmed transition-[width] duration-200",steps:"grid items-end",step:"truncate text-end row-start-1 col-start-1 transition-opacity"},variants:{animation:{carousel:"","carousel-inverse":"",swing:"",elastic:""},color:{primary:{indicator:"bg-primary",steps:"text-primary"},secondary:{indicator:"bg-secondary",steps:"text-secondary"},success:{indicator:"bg-success",steps:"text-success"},info:{indicator:"bg-info",steps:"text-info"},warning:{indicator:"bg-warning",steps:"text-warning"},error:{indicator:"bg-error",steps:"text-error"},neutral:{indicator:"bg-inverted",steps:"text-inverted"}},size:{"2xs":{status:"text-xs",steps:"text-xs"},xs:{status:"text-xs",steps:"text-xs"},sm:{status:"text-sm",steps:"text-sm"},md:{status:"text-sm",steps:"text-sm"},lg:{status:"text-sm",steps:"text-sm"},xl:{status:"text-base",steps:"text-base"},"2xl":{status:"text-base",steps:"text-base"}},step:{active:{step:"opacity-100"},first:{step:"opacity-100 text-muted"},other:{step:"opacity-0"},last:{step:""}},orientation:{horizontal:{root:"w-full flex flex-col",base:"w-full",status:"flex-row items-center justify-end min-w-fit"},vertical:{root:"h-full flex flex-row-reverse",base:"h-full",status:"flex-col justify-end min-h-fit"}},inverted:{true:{status:"self-end"}}},compoundVariants:[{inverted:!0,orientation:"horizontal",class:{step:"text-start",status:"flex-row-reverse"}},{inverted:!0,orientation:"vertical",class:{steps:"items-start",status:"flex-col-reverse"}},{orientation:"horizontal",size:"2xs",class:"h-px"},{orientation:"horizontal",size:"xs",class:"h-0.5"},{orientation:"horizontal",size:"sm",class:"h-1"},{orientation:"horizontal",size:"md",class:"h-2"},{orientation:"horizontal",size:"lg",class:"h-3"},{orientation:"horizontal",size:"xl",class:"h-4"},{orientation:"horizontal",size:"2xl",class:"h-5"},{orientation:"vertical",size:"2xs",class:"w-px"},{orientation:"vertical",size:"xs",class:"w-0.5"},{orientation:"vertical",size:"sm",class:"w-1"},{orientation:"vertical",size:"md",class:"w-2"},{orientation:"vertical",size:"lg",class:"w-3"},{orientation:"vertical",size:"xl",class:"w-4"},{orientation:"vertical",size:"2xl",class:"w-5"},{orientation:"horizontal",animation:"carousel",class:{indicator:"data-[state=indeterminate]:animate-[carousel_2s_ease-in-out_infinite] data-[state=indeterminate]:rtl:animate-[carousel-rtl_2s_ease-in-out_infinite]"}},{orientation:"vertical",animation:"carousel",class:{indicator:"data-[state=indeterminate]:animate-[carousel-vertical_2s_ease-in-out_infinite]"}},{orientation:"horizontal",animation:"carousel-inverse",class:{indicator:"data-[state=indeterminate]:animate-[carousel-inverse_2s_ease-in-out_infinite] data-[state=indeterminate]:rtl:animate-[carousel-inverse-rtl_2s_ease-in-out_infinite]"}},{orientation:"vertical",animation:"carousel-inverse",class:{indicator:"data-[state=indeterminate]:animate-[carousel-inverse-vertical_2s_ease-in-out_infinite]"}},{orientation:"horizontal",animation:"swing",class:{indicator:"data-[state=indeterminate]:animate-[swing_2s_ease-in-out_infinite]"}},{orientation:"vertical",animation:"swing",class:{indicator:"data-[state=indeterminate]:animate-[swing-vertical_2s_ease-in-out_infinite]"}},{orientation:"horizontal",animation:"elastic",class:{indicator:"data-[state=indeterminate]:animate-[elastic_2s_ease-in-out_infinite]"}},{orientation:"vertical",animation:"elastic",class:{indicator:"data-[state=indeterminate]:animate-[elastic-vertical_2s_ease-in-out_infinite]"}}],defaultVariants:{animation:"carousel",color:"primary",size:"md"}},Dge={__name:"UProgress",props:{as:{type:null,required:!1},max:{type:[Number,Array],required:!1},status:{type:Boolean,required:!1},inverted:{type:Boolean,required:!1,default:!1},size:{type:null,required:!1},color:{type:null,required:!1},orientation:{type:null,required:!1,default:"horizontal"},animation:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},getValueLabel:{type:Function,required:!1},getValueText:{type:Function,required:!1},modelValue:{type:[Number,null],required:!1,default:null}},emits:["update:modelValue","update:max"],setup(e,{emit:i}){const s=e,l=i,p=GE(),{dir:_}=Oj(),b=hd(),t=HV(gb(s,"getValueLabel","getValueText","modelValue"),l),P=Ei(()=>t.value.modelValue===null),O=Ei(()=>Array.isArray(s.max)),F=Ei(()=>{if(!(P.value||!s.max))return Array.isArray(s.max)?s.max.length-1:Number(s.max)}),$=Ei(()=>{if(!P.value)switch(!0){case t.value.modelValue<0:return 0;case t.value.modelValue>(F.value??100):return 100;default:return Math.round(t.value.modelValue/(F.value??100)*100)}}),W=Ei(()=>{if($.value!==void 0)return s.orientation==="vertical"?{transform:`translateY(${s.inverted?"":"-"}${100-$.value}%)`}:_.value==="rtl"?{transform:`translateX(${s.inverted?"-":""}${100-$.value}%)`}:{transform:`translateX(${s.inverted?"":"-"}${100-$.value}%)`}}),Y=Ei(()=>{const de=`${Math.max($.value??0,0)}%`;return s.orientation==="vertical"?{height:de}:{width:de}});function ae(de){return de===Number(s.modelValue)}function se(de){return de===0}function ie(de){return de===F.value}function pe(de){return de=Number(de),ae(de)&&!se(de)?"active":se(de)&&ae(de)?"first":ie(de)&&ae(de)?"last":"other"}const ye=Ei(()=>Mh({extend:Mh(kge),...b.ui?.progress||{}})({animation:s.animation,size:s.size,color:s.color,orientation:s.orientation,inverted:s.inverted}));return(de,Ee)=>(li(),En(ut(kh),{as:e.as,"data-orientation":e.orientation,"data-slot":"root",class:_s(ye.value.root({class:[s.ui?.root,s.class]}))},{default:Jn(()=>[!P.value&&(e.status||p.status)?(li(),ir("div",{key:0,"data-slot":"status",class:_s(ye.value.status({class:s.ui?.status})),style:Su(Y.value)},[Rs(de.$slots,"status",{percent:$.value},()=>[Gd(Lr($.value)+"% ",1)])],6)):gr("",!0),tr(ut(Ale),Oo(ut(t),{max:F.value,"data-slot":"base",class:ye.value.base({class:s.ui?.base}),style:{transform:"translateZ(0)"}}),{default:Jn(()=>[tr(ut(Mle),{"data-slot":"indicator",class:_s(ye.value.indicator({class:s.ui?.indicator})),style:Su(W.value)},null,8,["class","style"])]),_:1},16,["max","class"]),O.value?(li(),ir("div",{key:1,"data-slot":"steps",class:_s(ye.value.steps({class:s.ui?.steps}))},[(li(!0),ir(qs,null,Eu(e.max,(Pe,Ze)=>(li(),ir("div",{key:Ze,"data-slot":"step",class:_s(ye.value.step({class:s.ui?.step,step:pe(Ze)}))},[Rs(de.$slots,`step-${Ze}`,{step:Pe},()=>[Gd(Lr(Pe),1)])],2))),128))],2)):gr("",!0)]),_:3},8,["as","data-orientation","class"]))}},Lge={slots:{root:"relative group overflow-hidden bg-default shadow-lg rounded-lg ring ring-default p-4 flex gap-2.5 focus:outline-none",wrapper:"w-0 flex-1 flex flex-col",title:"text-sm font-medium text-highlighted",description:"text-sm text-muted",icon:"shrink-0 size-5",avatar:"shrink-0",avatarSize:"2xl",actions:"flex gap-1.5 shrink-0",progress:"absolute inset-x-0 bottom-0",close:"p-0"},variants:{color:{primary:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary",icon:"text-primary"},secondary:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary",icon:"text-secondary"},success:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success",icon:"text-success"},info:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info",icon:"text-info"},warning:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning",icon:"text-warning"},error:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error",icon:"text-error"},neutral:{root:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-inverted",icon:"text-highlighted"}},orientation:{horizontal:{root:"items-center",actions:"items-center"},vertical:{root:"items-start",actions:"items-start mt-2.5"}},title:{true:{description:"mt-1"}}},defaultVariants:{color:"primary"}},Rge={__name:"UToast",props:{as:{type:null,required:!1},title:{type:[String,Object,Function],required:!1},description:{type:[String,Object,Function],required:!1},icon:{type:null,required:!1},avatar:{type:Object,required:!1},color:{type:null,required:!1},orientation:{type:null,required:!1,default:"vertical"},close:{type:[Boolean,Object],required:!1,default:!0},closeIcon:{type:null,required:!1},actions:{type:Array,required:!1},progress:{type:[Boolean,Object],required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1},defaultOpen:{type:Boolean,required:!1},open:{type:Boolean,required:!1},type:{type:String,required:!1},duration:{type:Number,required:!1}},emits:["escapeKeyDown","pause","resume","swipeStart","swipeMove","swipeCancel","swipeEnd","update:open"],setup(e,{expose:i,emit:s}){const l=e,p=s,_=GE(),{t:b}=Oj(),t=hd(),P=HV(gb(l,"as","defaultOpen","open","duration","type"),p),O=Ei(()=>Mh({extend:Mh(Lge),...t.ui?.toast||{}})({color:l.color,orientation:l.orientation,title:!!l.title||!!_.title})),F=iM("rootRef"),$=an(0);return La(()=>{F.value&&Da(()=>{$.value=F.value?.$el?.getBoundingClientRect()?.height})}),i({height:$}),(W,Y)=>(li(),En(ut(Qle),Oo({ref_key:"rootRef",ref:F},ut(P),{"data-orientation":e.orientation,"data-slot":"root",class:O.value.root({class:[l.ui?.root,l.class]}),style:{"--height":$.value}}),{default:Jn(({remaining:ae,duration:se,open:ie})=>[Rs(W.$slots,"leading",{ui:O.value},()=>[e.avatar?(li(),En(pk,Oo({key:0,size:l.ui?.avatarSize||O.value.avatarSize()},e.avatar,{"data-slot":"avatar",class:O.value.avatar({class:l.ui?.avatar})}),null,16,["size","class"])):e.icon?(li(),En(ab,{key:1,name:e.icon,"data-slot":"icon",class:_s(O.value.icon({class:l.ui?.icon}))},null,8,["name","class"])):gr("",!0)]),Bn("div",{"data-slot":"wrapper",class:_s(O.value.wrapper({class:l.ui?.wrapper}))},[e.title||_.title?(li(),En(ut(tce),{key:0,"data-slot":"title",class:_s(O.value.title({class:l.ui?.title}))},{default:Jn(()=>[Rs(W.$slots,"title",{},()=>[typeof e.title=="function"?(li(),En(Cg(e.title()),{key:0})):typeof e.title=="object"?(li(),En(Cg(e.title),{key:1})):(li(),ir(qs,{key:2},[Gd(Lr(e.title),1)],64))])]),_:3},8,["class"])):gr("",!0),e.description||_.description?(li(),En(ut(Xle),{key:1,"data-slot":"description",class:_s(O.value.description({class:l.ui?.description}))},{default:Jn(()=>[Rs(W.$slots,"description",{},()=>[typeof e.description=="function"?(li(),En(Cg(e.description()),{key:0})):typeof e.description=="object"?(li(),En(Cg(e.description),{key:1})):(li(),ir(qs,{key:2},[Gd(Lr(e.description),1)],64))])]),_:3},8,["class"])):gr("",!0),e.orientation==="vertical"&&(e.actions?.length||_.actions)?(li(),ir("div",{key:2,"data-slot":"actions",class:_s(O.value.actions({class:l.ui?.actions}))},[Rs(W.$slots,"actions",{},()=>[(li(!0),ir(qs,null,Eu(e.actions,(pe,ye)=>(li(),En(ut(JO),{key:ye,"alt-text":pe.label||"Action","as-child":"",onClick:Y[0]||(Y[0]=Sm(()=>{},["stop"]))},{default:Jn(()=>[tr(Sw,Oo({size:"xs",color:e.color},{ref_for:!0},pe),null,16,["color"])]),_:2},1032,["alt-text"]))),128))])],2)):gr("",!0)],2),e.orientation==="horizontal"&&(e.actions?.length||_.actions)||e.close?(li(),ir("div",{key:0,"data-slot":"actions",class:_s(O.value.actions({class:l.ui?.actions,orientation:"horizontal"}))},[e.orientation==="horizontal"&&(e.actions?.length||_.actions)?Rs(W.$slots,"actions",{key:0},()=>[(li(!0),ir(qs,null,Eu(e.actions,(pe,ye)=>(li(),En(ut(JO),{key:ye,"alt-text":pe.label||"Action","as-child":"",onClick:Y[1]||(Y[1]=Sm(()=>{},["stop"]))},{default:Jn(()=>[tr(Sw,Oo({size:"xs",color:e.color},{ref_for:!0},pe),null,16,["color"])]),_:2},1032,["alt-text"]))),128))]):gr("",!0),e.close||_.close?(li(),En(ut(JV),{key:1,"as-child":""},{default:Jn(()=>[Rs(W.$slots,"close",{ui:O.value},()=>[e.close?(li(),En(Sw,Oo({key:0,icon:e.closeIcon||ut(t).ui.icons.close,color:"neutral",variant:"link","aria-label":ut(b)("toast.close")},typeof e.close=="object"?e.close:{},{"data-slot":"close",class:O.value.close({class:l.ui?.close}),onClick:Y[2]||(Y[2]=Sm(()=>{},["stop"]))}),null,16,["icon","aria-label","class"])):gr("",!0)])]),_:3})):gr("",!0)],2)):gr("",!0),e.progress&&ie&&ae>0&&se?(li(),En(Dge,Oo({key:1,"model-value":ae/se*100,color:e.color},typeof e.progress=="object"?e.progress:{},{size:"sm","data-slot":"progress",class:O.value.progress({class:l.ui?.progress})}),null,16,["model-value","color","class"])):gr("",!0)]),_:3},16,["data-orientation","class","style"]))}},zge={slots:{viewport:"fixed flex flex-col w-[calc(100%-2rem)] sm:w-96 z-[100] data-[expanded=true]:h-(--height) focus:outline-none",base:"pointer-events-auto absolute inset-x-0 z-(--index) transform-(--transform) data-[expanded=false]:data-[front=false]:h-(--front-height) data-[expanded=false]:data-[front=false]:*:opacity-0 data-[front=false]:*:transition-opacity data-[front=false]:*:duration-100 data-[state=closed]:animate-[toast-closed_200ms_ease-in-out] data-[state=closed]:data-[expanded=false]:data-[front=false]:animate-[toast-collapsed-closed_200ms_ease-in-out] data-[swipe=move]:transition-none transition-[transform,translate,height] duration-200 ease-out"},variants:{position:{"top-left":{viewport:"left-4"},"top-center":{viewport:"left-1/2 transform -translate-x-1/2"},"top-right":{viewport:"right-4"},"bottom-left":{viewport:"left-4"},"bottom-center":{viewport:"left-1/2 transform -translate-x-1/2"},"bottom-right":{viewport:"right-4"}},swipeDirection:{up:"data-[swipe=end]:animate-[toast-slide-up_200ms_ease-out]",right:"data-[swipe=end]:animate-[toast-slide-right_200ms_ease-out]",down:"data-[swipe=end]:animate-[toast-slide-down_200ms_ease-out]",left:"data-[swipe=end]:animate-[toast-slide-left_200ms_ease-out]"}},compoundVariants:[{position:["top-left","top-center","top-right"],class:{viewport:"top-4",base:"top-0 data-[state=open]:animate-[slide-in-from-top_200ms_ease-in-out]"}},{position:["bottom-left","bottom-center","bottom-right"],class:{viewport:"bottom-4",base:"bottom-0 data-[state=open]:animate-[slide-in-from-bottom_200ms_ease-in-out]"}},{swipeDirection:["left","right"],class:"data-[swipe=move]:translate-x-(--reka-toast-swipe-move-x) data-[swipe=end]:translate-x-(--reka-toast-swipe-end-x) data-[swipe=cancel]:translate-x-0"},{swipeDirection:["up","down"],class:"data-[swipe=move]:translate-y-(--reka-toast-swipe-move-y) data-[swipe=end]:translate-y-(--reka-toast-swipe-end-y) data-[swipe=cancel]:translate-y-0"}],defaultVariants:{position:"bottom-right"}},Oge={name:"Toaster"},Fge=Object.assign(Oge,{props:{position:{type:null,required:!1},expand:{type:Boolean,required:!1,default:!0},progress:{type:Boolean,required:!1,default:!0},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},max:{type:Number,required:!1,default:5},class:{type:null,required:!1},ui:{type:null,required:!1},label:{type:String,required:!1},duration:{type:Number,required:!1,default:5e3},disableSwipe:{type:Boolean,required:!1},swipeThreshold:{type:Number,required:!1}},setup(e){const i=e,{toasts:s,remove:l}=mk(),p=hd();Ka(uj,Nc(()=>i.max));const _=xb(gb(i,"duration","label","swipeThreshold","disableSwipe")),b=Mge(Nc(()=>i.portal)),t=Ei(()=>{switch(i.position){case"top-center":return"up";case"top-right":case"bottom-right":return"right";case"bottom-center":return"down";case"top-left":case"bottom-left":return"left"}return"right"}),P=Ei(()=>Mh({extend:Mh(zge),...p.ui?.toaster||{}})({position:i.position,swipeDirection:t.value}));function O(ie,pe){ie||l(pe)}const F=an(!1),$=Ei(()=>i.expand||F.value),W=an([]),Y=Ei(()=>W.value.reduce((ie,{height:pe})=>ie+pe+16,0)),ae=Ei(()=>W.value[W.value.length-1]?.height||0);function se(ie){return W.value.slice(ie+1).reduce((pe,{height:ye})=>pe+ye+16,0)}return(ie,pe)=>(li(),En(ut(Rle),Oo({"swipe-direction":t.value},ut(_)),{default:Jn(()=>[Rs(ie.$slots,"default"),(li(!0),ir(qs,null,Eu(ut(s),(ye,de)=>(li(),En(Rge,Oo({key:ye.id,ref_for:!0,ref_key:"refs",ref:W,progress:e.progress},{ref_for:!0},ut(ij)(ye,["id","close"]),{close:ye.close,"data-expanded":$.value,"data-front":!$.value&&de===ut(s).length-1,style:{"--index":de-ut(s).length+ut(s).length,"--before":ut(s).length-1-de,"--offset":se(de),"--scale":$.value?"1":"calc(1 - var(--before) * var(--scale-factor))","--translate":$.value?"calc(var(--offset) * var(--translate-factor))":"calc(var(--before) * var(--gap))","--transform":"translateY(var(--translate)) scale(var(--scale))"},"data-slot":"base",class:P.value.base({class:[i.ui?.base,ye.onClick?"cursor-pointer":void 0]}),"onUpdate:open":Ee=>O(Ee,ye.id),onClick:Ee=>ye.onClick&&ye.onClick(ye)}),null,16,["progress","close","data-expanded","data-front","style","class","onUpdate:open","onClick"]))),128)),tr(ut(Kle),Ap(o0(ut(b))),{default:Jn(()=>[tr(ut(rce),{"data-expanded":$.value,"data-slot":"viewport",class:_s(P.value.viewport({class:[i.ui?.viewport,i.class]})),style:Su({"--scale-factor":"0.05","--translate-factor":e.position?.startsWith("top")?"1px":"-1px","--gap":e.position?.startsWith("top")?"16px":"-16px","--front-height":`${ae.value}px`,"--height":`${Y.value}px`}),onMouseenter:pe[0]||(pe[0]=ye=>F.value=!0),onMouseleave:pe[1]||(pe[1]=ye=>F.value=!1)},null,8,["data-expanded","class","style"])]),_:1},16)]),_:3},16,["swipe-direction"]))}}),Bge=Object.assign(Fge,{__name:"UToaster"});function Nge(){const e=Ip([]),i=(O,F)=>{const{props:$,defaultOpen:W,destroyOnClose:Y}=F||{},ae=Ol({id:Symbol(""),isOpen:!!W,component:uv(O),isMounted:!!W,destroyOnClose:!!Y,originalProps:$||{},props:{...$}});return e.push(ae),{...ae,open:se=>s(ae.id,se),close:se=>l(ae.id,se),patch:se=>b(ae.id,se)}},s=(O,F)=>{const $=t(O);F?$.props={...$.originalProps,...F}:$.props={...$.originalProps},$.isOpen=!0,$.isMounted=!0;const W=new Promise(Y=>$.resolvePromise=Y);return Object.assign(W,{id:O,isMounted:$.isMounted,isOpen:$.isOpen,result:W})},l=(O,F)=>{const $=t(O);$.isOpen=!1,$.resolvePromise&&($.resolvePromise(F),$.resolvePromise=void 0)},p=()=>{e.forEach(O=>l(O.id))},_=O=>{const F=t(O);if(F.isMounted=!1,F.destroyOnClose){const $=e.findIndex(W=>W.id===O);e.splice($,1)}},b=(O,F)=>{const $=t(O);$.props={...$.props,...F}},t=O=>{const F=e.find($=>$.id===O);if(!F)throw new Error("Overlay not found");return F};return{overlays:e,open:s,close:l,closeAll:p,create:i,patch:b,unmount:_,isOpen:O=>t(O).isOpen}}const Vge=VM(Nge),jge={__name:"UOverlayProvider",setup(e){const{overlays:i,unmount:s,close:l}=Vge(),p=Ei(()=>i.filter(t=>t.isMounted)),_=t=>{l(t),s(t)},b=(t,P)=>{l(t,P)};return(t,P)=>(li(!0),ir(qs,null,Eu(p.value,O=>(li(),En(Cg(O.component),Oo({key:O.id},{ref_for:!0},O.props,{open:O.isOpen,"onUpdate:open":F=>O.isOpen=F,onClose:F=>b(O.id,F),"onAfter:leave":F=>_(O.id)}),null,16,["open","onUpdate:open","onClose","onAfter:leave"]))),128))}},Uge={name:"App"},$ge=Object.assign(Uge,{props:{tooltip:{type:Object,required:!1},toaster:{type:[Object,null],required:!1},locale:{type:Object,required:!1},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:"body"},dir:{type:String,required:!1},scrollBody:{type:[Boolean,Object],required:!1},nonce:{type:String,required:!1}},setup(e){const i=e,s=xb(gb(i,"scrollBody")),l=Nc(()=>i.tooltip),p=Nc(()=>i.toaster),_=Nc(()=>i.locale);Ka(zj,_);const b=Nc(()=>i.portal);return Ka(Fj,b),(t,P)=>(li(),En(ut(Rae),Oo({"use-id":()=>P$(),dir:i.dir||_.value?.dir,locale:_.value?.code},ut(s)),{default:Jn(()=>[tr(ut(ace),Ap(o0(l.value)),{default:Jn(()=>[e.toaster!==null?(li(),En(Bge,Ap(Oo({key:0},p.value)),{default:Jn(()=>[Rs(t.$slots,"default")]),_:3},16)):Rs(t.$slots,"default",{key:1}),tr(jge)]),_:3},16)]),_:3},16,["use-id","dir","locale"]))}}),Gge=Object.assign($ge,{__name:"UApp"});var ZS={exports:{}},qge=ZS.exports,BF;function Hge(){return BF||(BF=1,(function(e,i){(function(s,l){e.exports=l(lI())})(qge,(function(s){function l(b){return b&&typeof b=="object"&&"default"in b?b:{default:b}}var p=l(s),_={name:"zh-tw",weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),ordinal:function(b,t){return t==="W"?b+"":b+""},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},relativeTime:{future:"%s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},meridiem:function(b,t){var P=100*b+t;return P<600?"":P<900?"":P<1100?"":P<1300?"":P<1800?"":""}};return p.default.locale(_,null,!0),_}))})(ZS)),ZS.exports}var Wge=Hge();const Zge=Uf(Wge),NF=XB("photo-viewer-state",()=>{const e=an(0),i=an(!1),s=an(null),l=an(!1);return{currentPhotoIndex:e,isViewerOpen:i,returnRoute:s,isDirectAccess:l,openViewer:(P,O)=>{e.value=P,i.value=!0,O?(s.value=O,l.value=!1):l.value=!0},switchToIndex:P=>{e.value=P},closeViewer:()=>{i.value=!1},clearReturnRoute:()=>{s.value=null}}}),Xge=kr({__name:"app",async setup(e){let i,s;const l=nu(),p=Lj(),_=Dj(),{locale:b}=h0(),t=JE();[i,s]=$$(()=>t.initSettings()),await i,s();const P=$R("app:title");_.preference=$R("app:appearance.theme").value,hb({titleTemplate:Ze=>`${Ze?Ze+" | ":""}${P.value||"ChronoFrame"}`});const{data:O,refresh:F,status:$}=C4("/api/photos","$3oRWNoOsuN"),W=Ei(()=>O.value||[]),{switchToIndex:Y,closeViewer:ae,clearReturnRoute:se}=NF(),{currentPhotoIndex:ie,isViewerOpen:pe,returnRoute:ye,isDirectAccess:de}=$G(NF()),Ee=Ze=>{Y(Ze),l.replace(`/${W.value[Ze]?.id}`)},Pe=()=>{if(ae(),de.value)de.value=!1,l.replace("/");else if(ye.value){const Ze=ye.value;se(),l.replace(Ze)}else window.history.length>1?l.back():l.replace("/")};return Ph(()=>{p.locale("zh-Hans",SK),p.locale("zh-Hant-TW",Zge),p.locale("zh-Hant-HK",AK),p.locale(b.value)}),Ka("photosFiltering",Ol({activeFilters:{tags:[],cameras:[],lenses:[],cities:[],ratings:[]}})),(Ze,We)=>{const je=XQ,Ye=KQ,ct=ree,Lt=bge,Ht=S4,ci=Sge,Wt=Gge;return li(),En(Wt,null,{default:Jn(()=>[tr(je),tr(ci,{photos:ut(W),refresh:ut(F),status:ut($)},{default:Jn(()=>[tr(ct,null,{default:Jn(()=>[tr(Ye)]),_:1}),tr(Ht,null,{default:Jn(()=>[tr(Lt,{photos:ut(W),"current-index":ut(ie),"is-open":ut(pe),onClose:Pe,onIndexChange:Ee},null,8,["photos","current-index","is-open"])]),_:1})]),_:1},8,["photos","refresh","status"])]),_:1})}}}),Yge={__name:"nuxt-error-page",props:{error:Object},setup(e){const s=e.error,l=Number(s.statusCode||500),p=l===404,_=s.statusMessage??(p?"Page Not Found":"Internal Server Error"),b=s.message||s.toString(),t=void 0,F=p?Ux(()=>va(()=>import("./D3HY_UOx.js"),__vite__mapDeps([72,73]),import.meta.url)):Ux(()=>va(()=>import("./WLSwQphl.js"),__vite__mapDeps([74,75]),import.meta.url));return($,W)=>(li(),En(ut(F),Ap(o0({statusCode:ut(l),statusMessage:ut(_),description:ut(b),stack:ut(t)})),null,16))}},Kge={key:0},VF={__name:"nuxt-root",setup(e){const i=()=>null,s=Vs(),l=s.deferHydration();if(s.isHydrating){const O=s.hooks.hookOnce("app:error",l);nu().beforeEach(O)}const p=!1;Ka(mv,Qw()),s.hooks.callHookWith(O=>O.map(F=>F()),"vue:setup");const _=e2(),b=!1,t=/bot\b|chrome-lighthouse|facebookexternalhit|google\b/i;D5((O,F,$)=>{if(s.hooks.callHook("vue:error",O,F,$).catch(W=>console.error("[nuxt] Error in `vue:error` hook",W)),t.test(navigator.userAgent))return s.hooks.callHook("app:error",O),console.error(`[nuxt] Not rendering error page for bot with user agent \`${navigator.userAgent}\`:`,O),!1;if(GB(O)&&(O.fatal||O.unhandled))return s.runWithContext(()=>ev(O)),!1});const P=!1;return(O,F)=>(li(),En(uM,{onResolve:ut(l)},{default:Jn(()=>[ut(b)?(li(),ir("div",Kge)):ut(_)?(li(),En(ut(Yge),{key:1,error:ut(_)},null,8,["error"])):ut(P)?(li(),En(ut(i),{key:2,context:ut(P)},null,8,["context"])):ut(p)?(li(),En(Cg(ut(p)),{key:3})):(li(),En(ut(Xge),{key:4}))]),_:1},8,["onResolve"]))}};let jF;{let e;jF=async function(){if(e)return e;const s=!!(window.__NUXT__?.serverRendered??document.getElementById("__NUXT_DATA__")?.dataset.ssr==="true"),l=s?c9(VF):l9(VF),p=wG({vueApp:l});async function _(b){await p.callHook("app:error",b),p.payload.error||=i0(b)}l.config.errorHandler=_,p.hook("app:suspense:resolve",()=>{l.config.errorHandler===_&&(l.config.errorHandler=void 0)}),!s&&uR.id&&p.hook("app:suspense:resolve",()=>{document.getElementById(uR.id)?.remove()});try{await EG(p,qQ)}catch(b){_(b)}try{await p.hooks.callHook("app:created",l),await p.hooks.callHook("app:beforeMount",l),l.mount(vG),await p.hooks.callHook("app:mounted",l),await Da()}catch(b){_(b)}return l},e=jF().catch(i=>{throw console.error("Error while mounting app:",i),i})}export{o0 as $,Da as A,bv as B,kr as C,Mp as D,Ns as E,qs as F,uc as G,Oo as H,kp as I,Rr as J,Ol as K,dk as L,En as M,Rs as N,ut as O,Su as P,$V as Q,gr as R,Qge as S,UE as T,i_e as U,__e as V,RP as W,E_e as X,Sm as Y,Ap as Z,d0 as _,Bn as a,XV as a$,Gl as a0,zde as a1,_s as a2,q_ as a3,ym as a4,Eu as a5,Wd as a6,Lj as a7,kae as a8,h0 as a9,C4 as aA,Ome as aB,Dge as aC,i0 as aD,sM as aE,LL as aF,x5 as aG,gB as aH,l2 as aI,zp as aJ,A_e as aK,fk as aL,kh as aM,r_e as aN,QE as aO,l_e as aP,h_e as aQ,U$ as aR,GE as aS,K$ as aT,hd as aU,Oj as aV,a_e as aW,N_e as aX,Mh as aY,pk as aZ,Cg as a_,Qw as aa,nu as ab,Z_e as ac,s_e as ad,S4 as ae,Gpe as af,Sie as ag,LB as ah,Sw as ai,V3 as aj,mk as ak,jf as al,Vs as am,NF as an,$G as ao,X_ as ap,pW as aq,MW as ar,jM as as,Wo as at,e_e as au,ab as av,Tme as aw,Vf as ax,$$ as ay,OF as az,tr as b,jW as b$,Mge as b0,HV as b1,Tie as b2,U_e as b3,Hx as b4,ij as b5,sue as b6,Ace as b7,cj as b8,gb as b9,M_e as bA,C_e as bB,ob as bC,ble as bD,j_e as bE,so as bF,ZO as bG,S$ as bH,n_e as bI,P_e as bJ,pce as bK,H_ as bL,L_ as bM,B_e as bN,F_e as bO,eF as bP,hce as bQ,u_e as bR,dce as bS,cce as bT,O_e as bU,uce as bV,S_e as bW,b_e as bX,t_e as bY,KQ as bZ,sle as b_,a0 as ba,ej as bb,QV as bc,iM as bd,zo as be,Pp as bf,bme as bg,iue as bh,W_e as bi,rpe as bj,q_e as bk,iv as bl,H_e as bm,G_e as bn,$_e as bo,XB as bp,d_e as bq,Dj as br,FV as bs,Gw as bt,lle as bu,P$ as bv,f_e as bw,V_e as bx,xb as by,BV as bz,ir as c,$ie as c0,age as c1,p_e as c2,c_e as c3,hI as c4,cue as c5,Iae as c6,Pae as c7,kme as c8,x_e as c9,z_e as ca,UV as cb,hue as cc,Rp as cd,Jge as ce,I_e as cf,g_e as cg,w_e as ch,v_e as ci,vle as cj,k_e as ck,iA as cl,ZV as cm,D_e as cn,L_e as co,R_e as cp,Gd as d,XW as e,sw as f,ba as g,cd as h,Fo as i,Ei as j,Lp as k,Nc as l,T_e as m,ny as n,li as o,Ka as p,Ph as q,an as r,y_e as s,Lr as t,hb as u,La as v,Jn as w,ry as x,Qn as y,ru as z};
