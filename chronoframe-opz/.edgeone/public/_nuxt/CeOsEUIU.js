import{C as B,j as v,c as _,o as u,b as a,O as t,a4 as Ct,w as s,M as U,R,a as n,t as x,a0 as at,aj as Pt,N as nt,Z as Rt,H as Mt,ab as mt,br as zt,r as T,P as st,aq as I,a6 as Tt,a2 as J,ai as pt,bh as It,F as jt,a5 as Ot,d as ut,a9 as At,ao as Ut,an as Vt,as as Yt,c1 as Lt,c2 as Bt,c3 as dt,y as et,v as Dt,ag as Ft,A as Z,z as Ht,aF as Et,a7 as Wt,c4 as Nt,_ as it,u as qt,ac as Gt,ae as Qt}from"./j4_2ViiT.js";import{_ as ft}from"./nEL9po5J.js";import{_ as Zt}from"./kxNjjyPT.js";import{_ as Jt}from"./BO8mcGYI.js";import{_ as Kt}from"./BTYdLthq.js";import{u as ht,a as gt}from"./B6BfULBN.js";import{_ as Xt}from"./6olYxYgE.js";import"./DunIxK-L.js";import"./1YPYiat5.js";import"./C851_8qb.js";import"./DMD2K3S7.js";import"./CdZjkl3L.js";import"./GguNupJU.js";import"./CDvuUz3z.js";import"./6RnN_7Mu.js";import"./LY-Canmp.js";import"./-JUN05xP.js";import"./l95s9gFx.js";import"./Bqx6RqRL.js";import"./BraUrjWQ.js";import"./DJ9TepYI.js";const te={class:"text-white text-4xl font-black leading-normal tracking-wide"},ee={key:0,class:"text-white/80 text-xl font-bold"},oe={class:"bg-black/60 backdrop-blur-3xl border-b border-white/10 px-4 py-2 shadow-2xl flex flex-col"},ae={class:"text-white text-lg font-medium"},ne={key:0,class:"text-white/80 text-xs"},se=B({__name:"DateRangeIndicator",props:{dateRange:{},locations:{},isVisible:{type:Boolean},isMobile:{type:Boolean},class:{}},setup(m){const f=m,d=v(()=>f.isVisible&&!!f.dateRange),r={initial:{opacity:0,x:-20,scale:.95},animate:{opacity:1,x:0,scale:1}},y={initial:{opacity:0,y:-20},animate:{opacity:1,y:0}};return(O,j)=>(u(),_("div",null,[a(t(Ct),null,{default:s(()=>[t(d)&&!m.isMobile?(u(),U(t(at).div,{key:0,class:"fixed top-4 left-4 z-50 lg:top-6 lg:left-6 flex flex-col gap-1 bg-black/40 backdrop-blur-3xl rounded-xl border border-white/10 px-4 py-2 pb-4 shadow-2xl",initial:r.initial,animate:r.animate,exit:r.initial,transition:{type:"spring",duration:.4,bounce:.15}},{default:s(()=>[n("span",te,x(m.dateRange),1),m.locations?(u(),_("span",ee,x(m.locations),1)):R("",!0)]),_:1},8,["initial","animate","exit"])):R("",!0),t(d)&&m.isMobile?(u(),U(t(at).div,{key:1,class:"fixed inset-0 bottom-auto z-50",initial:y.initial,animate:y.animate,exit:y.initial,transition:{type:"spring",duration:.3,bounce:.1}},{default:s(()=>[n("div",oe,[n("span",ae,x(m.dateRange),1),m.locations?(u(),_("span",ne,x(m.locations),1)):R("",!0)])]),_:1},8,["initial","animate","exit"])):R("",!0)]),_:1})]))}}),ie=Object.assign(se,{__name:"DateRangeIndicator"}),re=B({__name:"AuthState",setup(m){const{loggedIn:f,user:d,session:r,clear:y,ready:O}=Pt();return(j,D)=>t(O)?nt(j.$slots,"default",Rt(Mt({key:0},{loggedIn:t(f),user:t(d),session:t(r),clear:t(y)}))):nt(j.$slots,"placeholder",{key:1})}}),le=Object.assign(re,{__name:"AuthState"}),ce={class:"w-full relative overflow-hidden"},ue={class:"flex flex-col items-center py-6 pb-0 gap-2"},de={class:"flex flex-col items-center gap-2"},me={class:"relative mx-auto"},pe={key:0,class:"absolute -bottom-0.5 -right-0.5 bg-amber-500 text-white rounded-full flex items-center justify-center size-5 text-xs drop-shadow-lg drop-shadow-amber-500/30"},fe=["src","onClick"],he={class:"text-2xl font-bold text-neutral-900 dark:text-white/90 mb-2"},ge={class:"text-neutral-600 dark:text-white/30 space-y-1 text-center"},ve={key:0,class:"text-xs font-medium"},_e={key:1,class:"text-xs font-medium"},be={key:2,class:"font-[Pacifico]"},xe={class:"flex items-center gap-0 p-1 bg-white/30 dark:bg-neutral-900/50 rounded-full"},ye={class:"font-bold text-sm p-1"},ke={class:"space-y-1"},we={class:"w-full px-2 pb-1 pt-1.5 bg-neutral-200/50 dark:bg-neutral-900/50 flex justify-between items-center gap-2"},$e={key:0,class:"text-xs text-neutral-500/80 dark:text-neutral-500 font-medium truncate"},Se={class:"text-xs text-neutral-500/60 dark:text-neutral-500/80 font-medium inline-flex justify-center items-center gap-0.5"},Ce=B({__name:"Header",props:{stats:{},dateRangeText:{}},setup(m){const f=mt(),d=zt(),r=v({get(){return d.value==="dark"},set(o){d.preference=o?"dark":"light"}}),y=()=>{f.push("/signin")},{hasActiveFilters:O,selectedCounts:j}=ht(),{currentSortLabel:D,currentSortIcon:k,currentSortOption:F,availableSorts:K,setSortOption:H}=gt(),X=v(()=>Object.values(j.value).reduce((o,i)=>o+i,0)),w=T(!1);return(o,i)=>{const N=Tt,$=pt,M=ft,q=It,A=Zt,G=Jt,E=Kt,V=le;return u(),_("div",ce,[n("div",{class:"absolute inset-0 -z-10 blur-3xl scale-110 bg-cover bg-center opacity-35",style:st({backgroundImage:`url(${("getSetting"in o?o.getSetting:t(I))("app:avatarUrl")||"/web-app-manifest-192x192.png"})`})},null,4),i[4]||(i[4]=n("div",{class:"absolute inset-0 -z-10 bg-white/50 dark:bg-neutral-900/50"},null,-1)),n("div",ue,[a(V,null,{default:s(({loggedIn:z,clear:Q})=>[n("div",de,[n("div",me,[z?(u(),_("div",pe,[a(N,{name:"tabler:star-filled"})])):R("",!0),n("img",{src:("getSetting"in o?o.getSetting:t(I))("app:avatarUrl")||"/web-app-manifest-192x192.png",class:J(["size-16 rounded-full object-cover",!z&&"cursor-pointer"]),alt:"Author's avatar",onClick:S=>!z&&y()},null,10,fe)]),n("h1",he,x(("getSetting"in o?o.getSetting:t(I))("app:title")),1)]),n("div",ge,[m.stats?.total?(u(),_("p",ve,x(o.$t("ui.stats.totalPhotosWithRange",{range:m.dateRangeText,count:m.stats?.total})),1)):(u(),_("p",_e,x(o.$t("ui.stats.noPhotosTip")),1)),("getSetting"in o?o.getSetting:t(I))("app:slogan")?(u(),_("p",be,x(("getSetting"in o?o.getSetting:t(I))("app:slogan")),1)):R("",!0)]),n("div",xe,[a(M,{text:o.$t("ui.action.globe.tooltip")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:map-pin-2",size:"sm",to:"/globe"})]),_:1},8,["text"]),a(M,{text:o.$t("title.albums")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:photo",size:"sm",to:"/albums"})]),_:1},8,["text"]),a(E,null,{content:s(()=>[a(G,{variant:"glassmorphism"},{default:s(()=>[a(A)]),_:1})]),default:s(()=>[a(M,{text:o.$t("ui.action.filter.tooltip")},{default:s(()=>[a(q,{inset:"",size:"sm",color:"info",show:t(X)>0},{default:s(()=>[a($,{variant:"soft",color:t(O)?"info":"neutral",class:"bg-transparent rounded-full cursor-pointer relative",icon:"tabler:filter",size:"sm"},null,8,["color"])]),_:1},8,["show"])]),_:1},8,["text"])]),_:1}),a(E,null,{content:s(()=>[a(G,{variant:"glassmorphism",class:"w-3xs"},{header:s(()=>[n("h3",ye,x(o.$t("ui.action.sort.title")),1)]),default:s(()=>[n("div",ke,[(u(!0),_(jt,null,Ot(t(K),S=>(u(),U($,{key:S.key,variant:t(D)===S.labelI18n?"soft":"ghost",color:t(D)===S.labelI18n?"info":"neutral",icon:S.icon,size:"sm",block:"",class:"justify-start",onClick:W=>t(H)(S.key)},{default:s(()=>[ut(x(o.$t(S.labelI18n)),1)]),_:2},1032,["variant","color","icon","onClick"]))),128))])]),_:1})]),default:s(()=>[a(M,{text:o.$t("ui.action.sort.tooltip")},{default:s(()=>[a($,{variant:"soft",color:t(F)?.key==="dateTaken-desc"?"neutral":"info",class:"bg-transparent rounded-full cursor-pointer",icon:t(k),size:"sm"},null,8,["color","icon"])]),_:1},8,["text"])]),_:1}),a(M,{text:o.$t("ui.action.theme.tooltip")},{default:s(()=>[a($,{variant:"soft",color:"neutral",class:"bg-transparent rounded-full cursor-pointer",icon:t(r)?"tabler:sun":"tabler:moon",size:"sm",onClick:i[0]||(i[0]=S=>r.value=!t(r))},null,8,["icon"])]),_:1},8,["text"]),z?(u(),U(M,{key:0,text:o.$t("ui.action.dashboard.tooltip")},{default:s(()=>[a($,{size:"sm",color:"info",variant:"soft",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:dashboard",to:"/dashboard"})]),_:1},8,["text"])):R("",!0),z?(u(),U(M,{key:1,text:o.$t("ui.action.logout.tooltip")},{default:s(()=>[a($,{size:"sm",color:"error",variant:"soft",class:"bg-transparent rounded-full cursor-pointer",icon:"tabler:logout",onClick:Q},null,8,["onClick"])]),_:2},1032,["text"])):R("",!0)])]),_:1}),n("div",we,[("getSetting"in o?o.getSetting:t(I))("app:author")||("getSetting"in o?o.getSetting:t(I))("app:title")?(u(),_("div",$e," © "+x(o.$dayjs().format("YYYY"))+" "+x(("getSetting"in o?o.getSetting:t(I))("app:author")||("getSetting"in o?o.getSetting:t(I))("app:title")),1)):R("",!0),n("div",Se,[n("a",{ref:"projectLink",href:"https://github.com/HoshinoSuzumi/chronoframe",target:"_blank",rel:"noopener noreferrer",class:"hover:underline inline-flex items-center gap-0.5 group",onMouseenter:i[1]||(i[1]=z=>w.value=!0),onMouseleave:i[2]||(i[2]=z=>w.value=!1)},[a(N,{name:"mdi:github",class:"inline-block text-sm -mt-px",mode:"svg"}),i[3]||(i[3]=ut(" ChronoFrame-fix-2025-12-31 ",-1))],544)])])])])}}}),Pe=Object.assign(Ce,{__name:"MasonryItemHeader"}),Re={class:"relative w-full"},Me=50,ot=8,ze=B({__name:"Root",props:{photos:{},columns:{default:"auto"}},setup(m){const{t:f}=At(),d=m,r=Wt(),y=mt(),{filteredPhotos:O,hasActiveFilters:j}=ht(),{sortedPhotos:D}=gt(),k=v(()=>j.value?O.value:D.value),{currentPhotoIndex:F,isViewerOpen:K}=Ut(Vt()),H=T(),X=T(!1),w=T(),o=T(new Set),i=Yt("(max-width: 768px)"),{batchProcessLivePhotos:N}=Lt(),$=T(new Set),M=T(),q=T(0),A=T(0),{y:G}=Bt(),E=v(()=>G.value>500),V=v(()=>(d.columns==="auto"&&i.value,280)),z=v(()=>d.columns!=="auto"?d.columns:i.value?2:8),Q=v(()=>d.columns!=="auto"?d.columns:2),S=v(()=>k.value?.map((e,l)=>({id:e.id,photo:e,originalIndex:l}))??[]);dt(M,e=>{const l=e[0];l&&(q.value=l.contentRect.height)});const W=()=>{requestAnimationFrame(()=>{if(i.value){A.value=0;return}const e=H.value?.querySelector(".masonry-wall .masonry-column");if(e){A.value=e.getBoundingClientRect().width;return}A.value=V.value})},tt=Ft(W,100);dt(H,()=>{tt()});const vt=v(()=>i.value?0:q.value+ot),_t=v(()=>{const e={};if(i.value)return e.width="100%",e.marginBottom=`${ot}px`,e;const l=A.value||V.value;return e.width=`${l}px`,e});et([V,z,Q],()=>{i.value||Z(W)}),et(i,e=>{if(e){A.value=0;return}Z(W)});const rt=v(()=>{const e=k.value||[],l=e.length;if(l===0)return{total:0,withDates:0,withTitles:0,withExif:0,dateRange:null};let h=0,p=0,g=0,C="",b="";for(const c of e)c.dateTaken&&(h++,(!C||c.dateTaken<C)&&(C=c.dateTaken),(!b||c.dateTaken>b)&&(b=c.dateTaken)),c.title&&p++,c.exif&&g++;const P=C&&b?{start:r(C).format("ll"),end:r(b).format("ll")}:null;return{total:l,withDates:h,withTitles:p,withExif:g,dateRange:P}}),bt=v(()=>{const e=rt.value?.dateRange;return!e||!e.start||!e.end?"":`${e.start} - ${e.end}`}),xt=Nt(()=>{wt(),kt()},150),yt=({index:e,isVisible:l})=>{l?o.value.add(e):o.value.delete(e),xt()},kt=async()=>{if(o.value.size===0)return;const e=Array.from(o.value),l=[];for(const h of e){const p=k.value[h];p&&p.isLivePhoto===1&&p.livePhotoVideoUrl&&!$.value.has(p.id)&&(l.push(p),$.value.add(p.id))}l.length!==0&&N(l.map(h=>({id:h.id,livePhotoVideoUrl:h.livePhotoVideoUrl})))},Y=T(),wt=()=>{if(o.value.size===0){w.value=void 0,Y.value=void 0;return}const e=Array.from(o.value);if(e.length===0)return;const l=Math.min(...e),h=Math.max(...e),p=e.map(L=>k.value[L]?.city).filter(L=>!!L),g=[...new Set(p)];g.length===0?Y.value=void 0:g.length===1?Y.value=g[0]:g.length<=3?Y.value=g.join("、"):Y.value=`${g.slice(0,2).join("、")} `+f("ui.indexPanelCountCity",{count:g.length});const C=k.value[l],b=k.value[h];if(!C?.dateTaken||!b?.dateTaken){w.value=void 0;return}const P=r(C.dateTaken),c=r(b.dateTaken);P.isSame(c,"day")?w.value=P.format("ll"):P.isSame(c,"month")?w.value=P.format("MMM YYYY"):P.isSame(c,"year")?w.value=`${P.format("MMM")} - ${c.format("MMM YYYY")}`:w.value=`${P.format("ll")} - ${c.format("ll")}`},$t=()=>{window.scrollTo({top:0,behavior:"smooth"})};Dt(()=>{window.addEventListener("resize",tt),Z(()=>{W(),F.value&&lt(F.value)})}),Ht(()=>{window.removeEventListener("resize",tt)});const St=e=>{y.push(`/${k.value[e]?.id}`)},lt=e=>{if(!k.value[e])return;const l=k.value[e].id,h=document.querySelector(`[data-photo-id="${l}"]`);if(h){const p=h.getBoundingClientRect(),g=window.innerHeight,b=window.pageYOffset+p.top-g/2+p.height/2;window.scrollTo({top:Math.max(0,b),behavior:"smooth"})}};return et(F,e=>{K.value&&e>=0&&Z(()=>{lt(e)})}),(e,l)=>{const h=ie,p=pt,g=ft,C=Pe,b=Xt,P=Et("MasonryWall");return u(),_("div",Re,[a(h,{"date-range":t(w),locations:t(Y),"is-visible":!!t(w)&&t(E),"is-mobile":t(i)},null,8,["date-range","locations","is-visible","is-mobile"]),t(E)?(u(),U(t(at).div,{key:0,class:"fixed bottom-6 right-6 z-50",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2}},{default:s(()=>[a(g,{text:t(f)("ui.action.backtotop.tooltip")||"回到顶部"},{default:s(()=>[a(p,{variant:"soft",color:"neutral",class:"cursor-pointer bg-white/80 dark:bg-neutral-900/80 backdrop-blur-sm flex justify-center items-center rounded-full shadow-lg hover:bg-white dark:hover:bg-neutral-800 transition-all duration-300 border border-neutral-200/50 dark:border-neutral-700/50",icon:"tabler:arrow-up",size:"lg","aria-label":t(f)("ui.action.backtotop.ariaLabel")||"回到顶部",onClick:$t},null,8,["aria-label"])]),_:1},8,["text"])]),_:1})):R("",!0),n("div",{class:J(["lg:px-0 lg:pb-0",t(i)?"px-1 pb-1":"p-1"])},[n("div",{ref_key:"masonryWrapper",ref:H,class:J(["relative",{"pt-2":t(i)}]),style:st({"--masonry-header-offset":`${t(vt)}px`})},[n("div",{ref_key:"headerRef",ref:M,class:J(["masonry-header-wrapper",{"masonry-header-desktop":!t(i)}]),style:st(t(_t))},[a(C,{stats:t(rt),"date-range-text":t(bt)},null,8,["stats","date-range-text"])],6),a(P,{class:"masonry-wall-with-header",items:t(S),"column-width":t(V),gap:ot,"min-columns":t(Q),"max-columns":t(z),"ssr-columns":2,"key-mapper":(c,L,De,ct)=>t(S)[ct]?.originalIndex??ct},{default:s(({item:c})=>[c.photo&&typeof c.originalIndex=="number"?(u(),U(b,{key:c.photo.id,photo:c.photo,index:c.originalIndex,"has-animated":t(X),"first-screen-items":Me,class:"masonry-item-optimizer",onVisibilityChange:yt,onOpenViewer:l[0]||(l[0]=L=>St(L))},null,8,["photo","index","has-animated"])):R("",!0)]),_:1},8,["items","column-width","min-columns","max-columns","key-mapper"])],6)],2)])}}}),Te=Object.assign(it(ze,[["__scopeId","data-v-e33392f9"]]),{__name:"MasonryRoot"}),Ie={class:"relative flex items-center justify-center size-24 group"},je={class:"absolute inset-2 rounded-full overflow-hidden shadow-sm bg-neutral-100 dark:bg-neutral-800 z-10"},Oe=["src"],Ae=B({__name:"Avatar",setup(m){const f=v(()=>{const d=I("app:avatarUrl");return d?d.toString():"/web-app-manifest-192x192.png"});return(d,r)=>(u(),_("div",Ie,[r[0]||(r[0]=n("div",{class:"absolute inset-2 bg-primary-500/20 dark:bg-primary-400/20 rounded-full blur-xl animate-pulse-slow will-change-opacity"},null,-1)),r[1]||(r[1]=n("svg",{class:"absolute inset-0 size-full -rotate-90 animate-spin-slow text-primary-500 dark:text-primary-400",viewBox:"0 0 100 100"},[n("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"currentColor","stroke-width":"4",class:"opacity-10 dark:opacity-20"}),n("circle",{cx:"50",cy:"50",r:"46",fill:"none",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-dasharray":"200","stroke-dashoffset":"80"})],-1)),n("div",je,[n("img",{class:"w-full h-full object-cover transition-transform duration-1000 ease-in-out group-hover:scale-110 animate-breathe",src:t(f),alt:"Loading...",draggable:"false",loading:"eager"},null,8,Oe)])]))}}),Ue=Object.assign(it(Ae,[["__scopeId","data-v-2612a411"]]),{__name:"LoaderAvatar"}),Ve={class:"relative h-screen"},Ye={class:"h-svh px-1"},Le={class:"fixed inset-0 flex flex-col gap-4 items-center justify-center"},Be=B({__name:"masonry",setup(m){qt({title:""});const{photos:f}=Gt();return(d,r)=>{const y=Te,O=Ue,j=Qt;return u(),_("div",Ve,[n("div",Ye,[a(j,null,{fallback:s(()=>[n("div",Le,[a(O),r[0]||(r[0]=n("span",{class:"loading-scan-wrapper"},[n("span",{class:"text-base font-medium loading-scan-text"}," LOADING ")],-1))])]),default:s(()=>[a(y,{photos:t(f),columns:"auto"},null,8,["photos"])]),_:1}),nt(d.$slots,"default",{},void 0,!0)])])}}}),co=it(Be,[["__scopeId","data-v-b82d8a2a"]]);export{co as default};
